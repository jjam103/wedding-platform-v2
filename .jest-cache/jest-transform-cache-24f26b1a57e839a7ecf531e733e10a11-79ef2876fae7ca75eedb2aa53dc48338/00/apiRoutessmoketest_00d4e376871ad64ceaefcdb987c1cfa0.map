{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/smoke/apiRoutes.smoke.test.ts"],"sourcesContent":["/**\n * API Smoke Tests\n * \n * Quick tests that verify all API endpoints respond without 500 errors.\n * These tests don't validate functionality, just that routes exist and respond.\n * \n * Run with: npm run test:smoke\n */\n\nconst API_BASE_URL = process.env.TEST_API_URL || 'http://localhost:3000';\n\n/**\n * All API routes in the application\n * Format: [method, path, expectedStatusCodes]\n */\nconst API_ROUTES: Array<[string, string, number[]]> = [\n  // Auth routes\n  ['POST', '/api/auth/logout', [200, 401]],\n  \n  // Admin routes - Locations\n  ['GET', '/api/admin/locations', [200, 401]],\n  ['POST', '/api/admin/locations', [201, 400, 401]],\n  \n  // Admin routes - Content Pages\n  ['GET', '/api/admin/content-pages', [200, 401]],\n  ['POST', '/api/admin/content-pages', [201, 400, 401]],\n  \n  // Admin routes - Guests\n  ['GET', '/api/admin/guests', [200, 401]],\n  ['POST', '/api/admin/guests', [201, 400, 401]],\n  \n  // Admin routes - Activities\n  ['GET', '/api/admin/activities', [200, 401]],\n  ['POST', '/api/admin/activities', [201, 400, 401]],\n  \n  // Admin routes - Events\n  ['GET', '/api/admin/events', [200, 401]],\n  ['POST', '/api/admin/events', [201, 400, 401]],\n  \n  // Admin routes - Accommodations\n  ['GET', '/api/admin/accommodations', [200, 401]],\n  ['POST', '/api/admin/accommodations', [201, 400, 401]],\n  \n  // Admin routes - Room Types\n  ['GET', '/api/admin/room-types', [200, 401]],\n  \n  // Admin routes - RSVPs\n  ['GET', '/api/admin/rsvps', [200, 401]],\n  \n  // Admin routes - Photos\n  ['GET', '/api/admin/photos', [200, 401]],\n  \n  // Admin routes - Home Page\n  ['GET', '/api/admin/home-page', [200, 401]],\n  ['PUT', '/api/admin/home-page', [200, 400, 401]],\n  \n  // Admin routes - RSVP Analytics\n  ['GET', '/api/admin/rsvp-analytics', [200, 401]],\n  \n  // Admin routes - Audit Logs\n  ['GET', '/api/admin/audit-logs', [200, 401]],\n  \n  // Admin routes - Transportation\n  ['GET', '/api/admin/transportation/arrivals', [200, 401]],\n  ['GET', '/api/admin/transportation/departures', [200, 401]],\n  ['GET', '/api/admin/transportation/vehicle-requirements', [200, 401]],\n  \n  // Admin routes - Budget\n  ['GET', '/api/admin/budget/breakdown', [200, 401]],\n  ['GET', '/api/admin/budget/subsidies', [200, 401]],\n  ['GET', '/api/admin/budget/payment-status', [200, 401]],\n  \n  // Admin routes - References\n  ['GET', '/api/admin/references/search', [200, 400, 401]],\n];\n\ndescribe('API Smoke Tests', () => {\n  // Skip if no server is running\n  let serverAvailable = false;\n\n  beforeAll(async () => {\n    try {\n      const response = await fetch(API_BASE_URL);\n      serverAvailable = response.ok || response.status === 404;\n    } catch {\n      serverAvailable = false;\n    }\n\n    if (!serverAvailable) {\n      console.warn('⚠️  Server not available at', API_BASE_URL);\n      console.warn('   Run \"npm run dev\" in another terminal to enable smoke tests');\n    }\n  });\n\n  describe.each(API_ROUTES)('%s %s', (method, path, expectedStatuses) => {\n    test(`should respond with valid status code`, async () => {\n      if (!serverAvailable) {\n        console.log('⏭️  Skipping - server not available');\n        return;\n      }\n\n      const response = await fetch(`${API_BASE_URL}${path}`, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        // Add empty body for POST/PUT/PATCH\n        ...(method !== 'GET' && method !== 'DELETE' ? { body: JSON.stringify({}) } : {}),\n      });\n\n      // Should not return 500 (server error)\n      expect(response.status).toBeLessThan(500);\n      \n      // Should return one of the expected status codes\n      expect(expectedStatuses).toContain(response.status);\n      \n      // Should return JSON\n      const contentType = response.headers.get('content-type');\n      expect(contentType).toContain('application/json');\n      \n      // Should have valid JSON body\n      const data = await response.json();\n      expect(data).toBeDefined();\n      expect(data).toHaveProperty('success');\n    });\n  });\n\n  describe('Response Format Consistency', () => {\n    test('all endpoints should return consistent error format', async () => {\n      if (!serverAvailable) {\n        return;\n      }\n\n      // Test a few endpoints\n      const testEndpoints = [\n        '/api/admin/locations',\n        '/api/admin/content-pages',\n        '/api/admin/guests',\n      ];\n\n      for (const endpoint of testEndpoints) {\n        const response = await fetch(`${API_BASE_URL}${endpoint}`);\n        const data = await response.json();\n\n        // Should have success field\n        expect(data).toHaveProperty('success');\n        expect(typeof data.success).toBe('boolean');\n\n        // If error, should have proper error structure\n        if (!data.success) {\n          expect(data).toHaveProperty('error');\n          expect(data.error).toHaveProperty('code');\n          expect(data.error).toHaveProperty('message');\n          expect(typeof data.error.code).toBe('string');\n          expect(typeof data.error.message).toBe('string');\n        }\n      }\n    });\n  });\n\n  describe('Performance', () => {\n    test('endpoints should respond within reasonable time', async () => {\n      if (!serverAvailable) {\n        return;\n      }\n\n      const startTime = Date.now();\n      await fetch(`${API_BASE_URL}/api/admin/locations`);\n      const endTime = Date.now();\n      \n      const responseTime = endTime - startTime;\n      \n      // Should respond within 5 seconds (generous for cold start)\n      expect(responseTime).toBeLessThan(5000);\n    });\n  });\n});\n\n/**\n * Usage:\n * \n * 1. Add to package.json:\n *    \"test:smoke\": \"jest --testPathPattern=smoke\"\n * \n * 2. Run with dev server:\n *    npm run dev (terminal 1)\n *    npm run test:smoke (terminal 2)\n * \n * 3. Run in CI/CD:\n *    - Start server\n *    - Run smoke tests\n *    - Stop server\n */\n"],"names":["API_BASE_URL","process","env","TEST_API_URL","API_ROUTES","describe","serverAvailable","beforeAll","response","fetch","ok","status","console","warn","each","method","path","expectedStatuses","test","log","headers","body","JSON","stringify","expect","toBeLessThan","toContain","contentType","get","data","json","toBeDefined","toHaveProperty","testEndpoints","endpoint","success","toBe","error","code","message","startTime","Date","now","endTime","responseTime"],"mappings":"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"}