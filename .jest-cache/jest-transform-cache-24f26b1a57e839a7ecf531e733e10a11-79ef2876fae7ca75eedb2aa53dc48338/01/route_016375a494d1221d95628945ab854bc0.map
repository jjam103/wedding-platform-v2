{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/references/[type]/[id]/route.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\n\ninterface EntityPreview {\n  id: string;\n  name: string;\n  type: string;\n  slug?: string;\n  status?: string;\n  details: Record<string, any>;\n}\n\n/**\n * Get entity preview details for reference cards\n * \n * @param request - Request object\n * @param params - Route params with type and id\n * @returns Entity preview details\n */\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ type: string; id: string }> }\n): Promise<NextResponse> {\n  try {\n    // 1. Authenticate\n    const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n        },\n        { status: 401 }\n      );\n    }\n\n    // 2. Validate parameters\n    const resolvedParams = await params;\n    const { type, id } = resolvedParams;\n    const validTypes = ['event', 'activity', 'accommodation', 'room_type', 'content_page'];\n\n    if (!validTypes.includes(type)) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: `Invalid entity type. Must be one of: ${validTypes.join(', ')}`,\n          },\n        },\n        { status: 400 }\n      );\n    }\n\n    // 3. Fetch entity based on type\n    let preview: EntityPreview | null = null;\n\n    switch (type) {\n      case 'event': {\n        const { data: event, error } = await supabase\n          .from('events')\n          .select('id, name, slug, is_active, start_time, end_time, description, event_type, locations(name)')\n          .eq('id', id)\n          .single();\n\n        if (error || !event) {\n          return NextResponse.json(\n            {\n              success: false,\n              error: { code: 'NOT_FOUND', message: 'Event not found' },\n            },\n            { status: 404 }\n          );\n        }\n\n        preview = {\n          id: event.id,\n          name: event.name,\n          type: 'event',\n          slug: event.slug,\n          status: event.is_active ? 'active' : 'inactive',\n          details: {\n            eventType: event.event_type,\n            startTime: event.start_time,\n            endTime: event.end_time,\n            description: event.description,\n            location: (event.locations as any)?.name,\n          },\n        };\n        break;\n      }\n\n      case 'activity': {\n        const { data: activity, error } = await supabase\n          .from('activities')\n          .select('id, name, slug, capacity, start_time, end_time, description, activity_type, cost_per_person, locations(name)')\n          .eq('id', id)\n          .single();\n\n        if (error || !activity) {\n          return NextResponse.json(\n            {\n              success: false,\n              error: { code: 'NOT_FOUND', message: 'Activity not found' },\n            },\n            { status: 404 }\n          );\n        }\n\n        // Get RSVP count\n        const { count: rsvpCount } = await supabase\n          .from('rsvps')\n          .select('*', { count: 'exact', head: true })\n          .eq('activity_id', id)\n          .eq('status', 'attending');\n\n        preview = {\n          id: activity.id,\n          name: activity.name,\n          type: 'activity',\n          slug: activity.slug,\n          details: {\n            activityType: activity.activity_type,\n            startTime: activity.start_time,\n            endTime: activity.end_time,\n            description: activity.description,\n            capacity: activity.capacity,\n            attendees: rsvpCount || 0,\n            costPerPerson: activity.cost_per_person,\n            location: (activity.locations as any)?.name,\n          },\n        };\n        break;\n      }\n\n      case 'accommodation': {\n        const { data: accommodation, error } = await supabase\n          .from('accommodations')\n          .select('id, name, slug, check_in_date, check_out_date, description, address, locations(name)')\n          .eq('id', id)\n          .single();\n\n        if (error || !accommodation) {\n          return NextResponse.json(\n            {\n              success: false,\n              error: { code: 'NOT_FOUND', message: 'Accommodation not found' },\n            },\n            { status: 404 }\n          );\n        }\n\n        // Get room type count\n        const { count: roomTypeCount } = await supabase\n          .from('room_types')\n          .select('*', { count: 'exact', head: true })\n          .eq('accommodation_id', id);\n\n        preview = {\n          id: accommodation.id,\n          name: accommodation.name,\n          type: 'accommodation',\n          slug: accommodation.slug,\n          details: {\n            checkInDate: accommodation.check_in_date,\n            checkOutDate: accommodation.check_out_date,\n            description: accommodation.description,\n            address: accommodation.address,\n            location: (accommodation.locations as any)?.name,\n            roomTypeCount: roomTypeCount || 0,\n          },\n        };\n        break;\n      }\n\n      case 'room_type': {\n        const { data: roomType, error } = await supabase\n          .from('room_types')\n          .select('id, name, capacity, price_per_night, description, check_in_date, check_out_date, accommodations(name)')\n          .eq('id', id)\n          .single();\n\n        if (error || !roomType) {\n          return NextResponse.json(\n            {\n              success: false,\n              error: { code: 'NOT_FOUND', message: 'Room type not found' },\n            },\n            { status: 404 }\n          );\n        }\n\n        // Get guest assignment count\n        const { count: guestCount } = await supabase\n          .from('room_assignments')\n          .select('*', { count: 'exact', head: true })\n          .eq('room_type_id', id);\n\n        preview = {\n          id: roomType.id,\n          name: roomType.name,\n          type: 'room_type',\n          details: {\n            accommodationName: (roomType.accommodations as any)?.name,\n            capacity: roomType.capacity,\n            pricePerNight: roomType.price_per_night,\n            description: roomType.description,\n            checkInDate: roomType.check_in_date,\n            checkOutDate: roomType.check_out_date,\n            guestCount: guestCount || 0,\n          },\n        };\n        break;\n      }\n\n      case 'content_page': {\n        const { data: page, error } = await supabase\n          .from('content_pages')\n          .select('id, title, slug, status, created_at, updated_at')\n          .eq('id', id)\n          .single();\n\n        if (error || !page) {\n          return NextResponse.json(\n            {\n              success: false,\n              error: { code: 'NOT_FOUND', message: 'Content page not found' },\n            },\n            { status: 404 }\n          );\n        }\n\n        // Get section count\n        const { count: sectionCount } = await supabase\n          .from('content_sections')\n          .select('*', { count: 'exact', head: true })\n          .eq('page_type', 'custom')\n          .eq('page_id', id);\n\n        preview = {\n          id: page.id,\n          name: page.title,\n          type: 'content_page',\n          slug: page.slug,\n          status: page.status,\n          details: {\n            createdAt: page.created_at,\n            updatedAt: page.updated_at,\n            sectionCount: sectionCount || 0,\n          },\n        };\n        break;\n      }\n    }\n\n    // 4. Return preview\n    return NextResponse.json({\n      success: true,\n      data: preview,\n    });\n  } catch (error) {\n    console.error('Entity preview error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'INTERNAL_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","request","params","cookieStore","cookies","supabase","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","getAll","setAll","cookiesToSet","forEach","name","value","set","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","resolvedParams","type","id","validTypes","includes","join","preview","event","from","select","eq","single","slug","is_active","details","eventType","event_type","startTime","start_time","endTime","end_time","description","location","locations","activity","count","rsvpCount","head","activityType","activity_type","capacity","attendees","costPerPerson","cost_per_person","accommodation","roomTypeCount","checkInDate","check_in_date","checkOutDate","check_out_date","address","roomType","guestCount","accommodationName","accommodations","pricePerNight","price_per_night","page","sectionCount","title","createdAt","created_at","updatedAt","updated_at","console","Error"],"mappings":"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"}