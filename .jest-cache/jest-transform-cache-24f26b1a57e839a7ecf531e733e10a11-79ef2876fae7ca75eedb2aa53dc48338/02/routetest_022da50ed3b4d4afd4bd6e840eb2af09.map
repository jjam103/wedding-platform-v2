{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/auth/guest/email-match/route.test.ts"],"sourcesContent":["import { POST } from './route';\nimport { createSupabaseClient } from '@/lib/supabase';\nimport { cookies } from 'next/headers';\n\n// Mock dependencies\njest.mock('@/lib/supabase');\njest.mock('next/headers', () => ({\n  cookies: jest.fn(),\n}));\n\nconst mockSupabase = {\n  from: jest.fn().mockReturnThis(),\n  select: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  single: jest.fn(),\n  insert: jest.fn().mockReturnThis(),\n};\n\nconst mockCookies = {\n  set: jest.fn(),\n};\n\ndescribe('POST /api/auth/guest/email-match', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (createSupabaseClient as jest.Mock).mockReturnValue(mockSupabase);\n    (cookies as jest.Mock).mockResolvedValue(mockCookies);\n  });\n\n  describe('Successful authentication', () => {\n    it('should authenticate guest with valid email', async () => {\n      // Arrange\n      const mockGuest = {\n        id: 'guest-123',\n        email: 'john@example.com',\n        group_id: 'group-456',\n        first_name: 'John',\n        last_name: 'Doe',\n        auth_method: 'email_matching',\n      };\n\n      const mockSession = {\n        id: 'session-789',\n        guest_id: 'guest-123',\n        token: 'mock-token',\n        expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),\n      };\n\n      mockSupabase.single\n        .mockResolvedValueOnce({ data: mockGuest, error: null }) // Guest lookup\n        .mockResolvedValueOnce({ data: mockSession, error: null }); // Session creation\n\n      mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null }); // Audit log\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-forwarded-for': '192.168.1.1',\n          'user-agent': 'Mozilla/5.0',\n        },\n        body: JSON.stringify({ email: 'john@example.com' }),\n      });\n\n      // Act\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual({\n        guestId: 'guest-123',\n        groupId: 'group-456',\n        firstName: 'John',\n        lastName: 'Doe',\n      });\n\n      // Verify guest lookup\n      expect(mockSupabase.from).toHaveBeenCalledWith('guests');\n      expect(mockSupabase.eq).toHaveBeenCalledWith('email', 'john@example.com');\n      expect(mockSupabase.eq).toHaveBeenCalledWith('auth_method', 'email_matching');\n\n      // Verify session creation\n      expect(mockSupabase.from).toHaveBeenCalledWith('guest_sessions');\n      expect(mockSupabase.insert).toHaveBeenCalled();\n\n      // Verify cookie set\n      expect(mockCookies.set).toHaveBeenCalledWith(\n        'guest_session',\n        expect.any(String),\n        expect.objectContaining({\n          httpOnly: true,\n          sameSite: 'lax',\n          maxAge: 60 * 60 * 24,\n          path: '/',\n        })\n      );\n\n      // Verify audit log\n      expect(mockSupabase.from).toHaveBeenCalledWith('audit_logs');\n    });\n\n    it('should normalize email to lowercase', async () => {\n      // Arrange\n      const mockGuest = {\n        id: 'guest-123',\n        email: 'john@example.com',\n        group_id: 'group-456',\n        first_name: 'John',\n        last_name: 'Doe',\n        auth_method: 'email_matching',\n      };\n\n      mockSupabase.single.mockResolvedValueOnce({ data: mockGuest, error: null });\n      mockSupabase.single.mockResolvedValueOnce({ data: {}, error: null });\n      mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'JOHN@EXAMPLE.COM' }),\n      });\n\n      // Act\n      await POST(request);\n\n      // Assert\n      expect(mockSupabase.eq).toHaveBeenCalledWith('email', 'john@example.com');\n    });\n  });\n\n  describe('Validation errors', () => {\n    it('should return 400 for invalid email format', async () => {\n      // Arrange\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'invalid-email' }),\n      });\n\n      // Act\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(data.error.message).toContain('Invalid email format');\n    });\n\n    it('should return 400 for missing email', async () => {\n      // Arrange\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({}),\n      });\n\n      // Act\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n  });\n\n  describe('Authentication errors', () => {\n    it('should return 404 when email not found', async () => {\n      // Arrange\n      mockSupabase.single.mockResolvedValueOnce({ data: null, error: { message: 'Not found' } });\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'notfound@example.com' }),\n      });\n\n      // Act\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n      expect(data.error.message).toContain('Email not found');\n    });\n\n    it('should return 404 when guest uses magic_link auth method', async () => {\n      // Arrange\n      mockSupabase.single.mockResolvedValueOnce({ data: null, error: { message: 'Not found' } });\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'magiclink@example.com' }),\n      });\n\n      // Act\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n  });\n\n  describe('Session creation errors', () => {\n    it('should return 500 when session creation fails', async () => {\n      // Arrange\n      const mockGuest = {\n        id: 'guest-123',\n        email: 'john@example.com',\n        group_id: 'group-456',\n        first_name: 'John',\n        last_name: 'Doe',\n        auth_method: 'email_matching',\n      };\n\n      mockSupabase.single\n        .mockResolvedValueOnce({ data: mockGuest, error: null })\n        .mockResolvedValueOnce({ data: null, error: { message: 'Database error' } });\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'john@example.com' }),\n      });\n\n      // Act\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('SESSION_ERROR');\n    });\n  });\n\n  describe('Security features', () => {\n    it('should sanitize email input', async () => {\n      // Arrange\n      const mockGuest = {\n        id: 'guest-123',\n        email: 'john@example.com',\n        group_id: 'group-456',\n        first_name: 'John',\n        last_name: 'Doe',\n        auth_method: 'email_matching',\n      };\n\n      mockSupabase.single.mockResolvedValueOnce({ data: mockGuest, error: null });\n      mockSupabase.single.mockResolvedValueOnce({ data: {}, error: null });\n      mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: '<script>alert(\"xss\")</script>john@example.com' }),\n      });\n\n      // Act\n      await POST(request);\n\n      // Assert\n      // Email should be sanitized (script tags removed)\n      const emailArg = mockSupabase.eq.mock.calls.find(call => call[0] === 'email')?.[1];\n      expect(emailArg).not.toContain('<script>');\n      expect(emailArg).not.toContain('alert');\n    });\n\n    it('should set secure cookie in production', async () => {\n      // Arrange\n      const originalEnv = process.env.NODE_ENV;\n      process.env.NODE_ENV = 'production';\n\n      const mockGuest = {\n        id: 'guest-123',\n        email: 'john@example.com',\n        group_id: 'group-456',\n        first_name: 'John',\n        last_name: 'Doe',\n        auth_method: 'email_matching',\n      };\n\n      mockSupabase.single.mockResolvedValueOnce({ data: mockGuest, error: null });\n      mockSupabase.single.mockResolvedValueOnce({ data: {}, error: null });\n      mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'john@example.com' }),\n      });\n\n      // Act\n      await POST(request);\n\n      // Assert\n      expect(mockCookies.set).toHaveBeenCalledWith(\n        'guest_session',\n        expect.any(String),\n        expect.objectContaining({\n          secure: true,\n        })\n      );\n\n      // Cleanup\n      process.env.NODE_ENV = originalEnv;\n    });\n\n    it('should log IP address and user agent', async () => {\n      // Arrange\n      const mockGuest = {\n        id: 'guest-123',\n        email: 'john@example.com',\n        group_id: 'group-456',\n        first_name: 'John',\n        last_name: 'Doe',\n        auth_method: 'email_matching',\n      };\n\n      mockSupabase.single.mockResolvedValueOnce({ data: mockGuest, error: null });\n      mockSupabase.single.mockResolvedValueOnce({ data: {}, error: null });\n      mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n      const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-forwarded-for': '192.168.1.100',\n          'user-agent': 'Test Browser',\n        },\n        body: JSON.stringify({ email: 'john@example.com' }),\n      });\n\n      // Act\n      await POST(request);\n\n      // Assert\n      const sessionInsertCall = mockSupabase.insert.mock.calls.find(\n        call => mockSupabase.from.mock.calls.some(fromCall => fromCall[0] === 'guest_sessions')\n      );\n      expect(sessionInsertCall).toBeDefined();\n    });\n  });\n});\n"],"names":["jest","mock","cookies","fn","mockSupabase","from","mockReturnThis","select","eq","single","insert","mockCookies","set","describe","beforeEach","clearAllMocks","createSupabaseClient","mockReturnValue","mockResolvedValue","it","mockGuest","id","email","group_id","first_name","last_name","auth_method","mockSession","guest_id","token","expires_at","Date","now","toISOString","mockResolvedValueOnce","data","error","request","Request","method","headers","body","JSON","stringify","response","POST","json","expect","status","toBe","success","toEqual","guestId","groupId","firstName","lastName","toHaveBeenCalledWith","toHaveBeenCalled","any","String","objectContaining","httpOnly","sameSite","maxAge","path","code","message","toContain","emailArg","calls","find","call","not","originalEnv","process","env","NODE_ENV","secure","sessionInsertCall","some","fromCall","toBeDefined"],"mappings":"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"}