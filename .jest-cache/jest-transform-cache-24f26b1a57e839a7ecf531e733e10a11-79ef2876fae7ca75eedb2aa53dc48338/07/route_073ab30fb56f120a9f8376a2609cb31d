c05fb8fee43518830f24d5b0169653dd
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "PUT", {
    enumerable: true,
    get: function() {
        return PUT;
    }
});
const _supabaseServer = require("../../../../../../lib/supabaseServer");
const _server = require("next/server");
const _zod = require("zod");
/**
 * PUT /api/admin/guests/[id]/auth-method
 * 
 * Updates authentication method for a specific guest
 * 
 * Requirements: 22.3
 */ const updateAuthMethodSchema = _zod.z.object({
    auth_method: _zod.z.enum([
        'email_matching',
        'magic_link'
    ])
});
function getStatusCode(errorCode) {
    const statusMap = {
        'VALIDATION_ERROR': 400,
        'UNAUTHORIZED': 401,
        'FORBIDDEN': 403,
        'NOT_FOUND': 404,
        'GUEST_NOT_FOUND': 404,
        'DATABASE_ERROR': 500,
        'INTERNAL_ERROR': 500
    };
    return statusMap[errorCode] || 500;
}
async function PUT(request, { params }) {
    try {
        // Await params (Next.js 15 requirement)
        const { id } = await params;
        // 1. AUTHENTICATION
        const supabase = await (0, _supabaseServer.createAuthenticatedClient)();
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // 2. VALIDATION
        // Validate guest ID
        const idValidation = _zod.z.string().uuid().safeParse(id);
        if (!idValidation.success) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid guest ID format'
                }
            }, {
                status: 400
            });
        }
        // Validate request body
        const body = await request.json();
        const validation = updateAuthMethodSchema.safeParse(body);
        if (!validation.success) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid request data',
                    details: validation.error.issues
                }
            }, {
                status: 400
            });
        }
        // 3. SERVICE CALL
        const { data: guest, error: updateError } = await supabase.from('guests').update({
            auth_method: validation.data.auth_method
        }).eq('id', id).select().single();
        if (updateError) {
            if (updateError.code === 'PGRST116') {
                return _server.NextResponse.json({
                    success: false,
                    error: {
                        code: 'GUEST_NOT_FOUND',
                        message: 'Guest not found'
                    }
                }, {
                    status: 404
                });
            }
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: 'Failed to update guest',
                    details: updateError
                }
            }, {
                status: 500
            });
        }
        // 4. RESPONSE
        return _server.NextResponse.json({
            success: true,
            data: {
                id: guest.id,
                auth_method: guest.auth_method,
                email: guest.email,
                first_name: guest.first_name,
                last_name: guest.last_name
            }
        }, {
            status: 200
        });
    } catch (error) {
        console.error('API Error:', {
            path: request.url,
            method: request.method,
            error
        });
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'INTERNAL_ERROR',
                message: 'An unexpected error occurred'
            }
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9ndWVzdHMvW2lkXS9hdXRoLW1ldGhvZC9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2VTZXJ2ZXInO1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbi8qKlxuICogUFVUIC9hcGkvYWRtaW4vZ3Vlc3RzL1tpZF0vYXV0aC1tZXRob2RcbiAqIFxuICogVXBkYXRlcyBhdXRoZW50aWNhdGlvbiBtZXRob2QgZm9yIGEgc3BlY2lmaWMgZ3Vlc3RcbiAqIFxuICogUmVxdWlyZW1lbnRzOiAyMi4zXG4gKi9cblxuY29uc3QgdXBkYXRlQXV0aE1ldGhvZFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgYXV0aF9tZXRob2Q6IHouZW51bShbJ2VtYWlsX21hdGNoaW5nJywgJ21hZ2ljX2xpbmsnXSksXG59KTtcblxuZnVuY3Rpb24gZ2V0U3RhdHVzQ29kZShlcnJvckNvZGU6IHN0cmluZyk6IG51bWJlciB7XG4gIGNvbnN0IHN0YXR1c01hcDogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcbiAgICAnVkFMSURBVElPTl9FUlJPUic6IDQwMCxcbiAgICAnVU5BVVRIT1JJWkVEJzogNDAxLFxuICAgICdGT1JCSURERU4nOiA0MDMsXG4gICAgJ05PVF9GT1VORCc6IDQwNCxcbiAgICAnR1VFU1RfTk9UX0ZPVU5EJzogNDA0LFxuICAgICdEQVRBQkFTRV9FUlJPUic6IDUwMCxcbiAgICAnSU5URVJOQUxfRVJST1InOiA1MDAsXG4gIH07XG4gIHJldHVybiBzdGF0dXNNYXBbZXJyb3JDb2RlXSB8fCA1MDA7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQVVQoXG4gIHJlcXVlc3Q6IFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiBQcm9taXNlPHsgaWQ6IHN0cmluZyB9PiB9XG4pIHtcbiAgdHJ5IHtcbiAgICAvLyBBd2FpdCBwYXJhbXMgKE5leHQuanMgMTUgcmVxdWlyZW1lbnQpXG4gICAgY29uc3QgeyBpZCB9ID0gYXdhaXQgcGFyYW1zO1xuXG4gICAgLy8gMS4gQVVUSEVOVElDQVRJT05cbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQoKTtcbiAgICBjb25zdCB7XG4gICAgICBkYXRhOiB7IHNlc3Npb24gfSxcbiAgICAgIGVycm9yOiBhdXRoRXJyb3IsXG4gICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpO1xuXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhc2Vzc2lvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBjb2RlOiAnVU5BVVRIT1JJWkVEJywgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyB9IH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyAyLiBWQUxJREFUSU9OXG4gICAgLy8gVmFsaWRhdGUgZ3Vlc3QgSURcbiAgICBjb25zdCBpZFZhbGlkYXRpb24gPSB6LnN0cmluZygpLnV1aWQoKS5zYWZlUGFyc2UoaWQpO1xuICAgIGlmICghaWRWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLCBtZXNzYWdlOiAnSW52YWxpZCBndWVzdCBJRCBmb3JtYXQnIH0gfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHJlcXVlc3QgYm9keVxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdXBkYXRlQXV0aE1ldGhvZFNjaGVtYS5zYWZlUGFyc2UoYm9keSk7XG5cbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHJlcXVlc3QgZGF0YScsXG4gICAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gMy4gU0VSVklDRSBDQUxMXG4gICAgY29uc3QgeyBkYXRhOiBndWVzdCwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2d1ZXN0cycpXG4gICAgICAudXBkYXRlKHsgYXV0aF9tZXRob2Q6IHZhbGlkYXRpb24uZGF0YS5hdXRoX21ldGhvZCB9KVxuICAgICAgLmVxKCdpZCcsIGlkKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcbiAgICAgIGlmICh1cGRhdGVFcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBjb2RlOiAnR1VFU1RfTk9UX0ZPVU5EJywgbWVzc2FnZTogJ0d1ZXN0IG5vdCBmb3VuZCcgfSB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHsgY29kZTogJ0RBVEFCQVNFX0VSUk9SJywgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgZ3Vlc3QnLCBkZXRhaWxzOiB1cGRhdGVFcnJvciB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gNC4gUkVTUE9OU0VcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogZ3Vlc3QuaWQsXG4gICAgICAgICAgYXV0aF9tZXRob2Q6IGd1ZXN0LmF1dGhfbWV0aG9kLFxuICAgICAgICAgIGVtYWlsOiBndWVzdC5lbWFpbCxcbiAgICAgICAgICBmaXJzdF9uYW1lOiBndWVzdC5maXJzdF9uYW1lLFxuICAgICAgICAgIGxhc3RfbmFtZTogZ3Vlc3QubGFzdF9uYW1lLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiAyMDAgfVxuICAgICk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQVBJIEVycm9yOicsIHsgcGF0aDogcmVxdWVzdC51cmwsIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsIGVycm9yIH0pO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdJTlRFUk5BTF9FUlJPUicsIG1lc3NhZ2U6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyB9IH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiUFVUIiwidXBkYXRlQXV0aE1ldGhvZFNjaGVtYSIsInoiLCJvYmplY3QiLCJhdXRoX21ldGhvZCIsImVudW0iLCJnZXRTdGF0dXNDb2RlIiwiZXJyb3JDb2RlIiwic3RhdHVzTWFwIiwicmVxdWVzdCIsInBhcmFtcyIsImlkIiwic3VwYWJhc2UiLCJjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50IiwiZGF0YSIsInNlc3Npb24iLCJlcnJvciIsImF1dGhFcnJvciIsImF1dGgiLCJnZXRTZXNzaW9uIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsInN1Y2Nlc3MiLCJjb2RlIiwibWVzc2FnZSIsInN0YXR1cyIsImlkVmFsaWRhdGlvbiIsInN0cmluZyIsInV1aWQiLCJzYWZlUGFyc2UiLCJib2R5IiwidmFsaWRhdGlvbiIsImRldGFpbHMiLCJpc3N1ZXMiLCJndWVzdCIsInVwZGF0ZUVycm9yIiwiZnJvbSIsInVwZGF0ZSIsImVxIiwic2VsZWN0Iiwic2luZ2xlIiwiZW1haWwiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwiY29uc29sZSIsInBhdGgiLCJ1cmwiLCJtZXRob2QiXSwibWFwcGluZ3MiOiI7Ozs7K0JBNkJzQkE7OztlQUFBQTs7O2dDQTdCb0I7d0JBQ2I7cUJBQ1g7QUFFbEI7Ozs7OztDQU1DLEdBRUQsTUFBTUMseUJBQXlCQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztJQUN0Q0MsYUFBYUYsTUFBQyxDQUFDRyxJQUFJLENBQUM7UUFBQztRQUFrQjtLQUFhO0FBQ3REO0FBRUEsU0FBU0MsY0FBY0MsU0FBaUI7SUFDdEMsTUFBTUMsWUFBb0M7UUFDeEMsb0JBQW9CO1FBQ3BCLGdCQUFnQjtRQUNoQixhQUFhO1FBQ2IsYUFBYTtRQUNiLG1CQUFtQjtRQUNuQixrQkFBa0I7UUFDbEIsa0JBQWtCO0lBQ3BCO0lBQ0EsT0FBT0EsU0FBUyxDQUFDRCxVQUFVLElBQUk7QUFDakM7QUFFTyxlQUFlUCxJQUNwQlMsT0FBZ0IsRUFDaEIsRUFBRUMsTUFBTSxFQUF1QztJQUUvQyxJQUFJO1FBQ0Ysd0NBQXdDO1FBQ3hDLE1BQU0sRUFBRUMsRUFBRSxFQUFF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