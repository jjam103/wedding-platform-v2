{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/emailApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Test: Email API\n * \n * Tests email sending, template management, and email logs API endpoints.\n */\n\n// Polyfill Web APIs for Next.js server components\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder as any;\n\n// Mock the email service BEFORE importing route handlers\njest.mock('@/services/emailService', () => ({\n  getEmailLogs: jest.fn(),\n  sendBulkEmail: jest.fn(),\n  listTemplates: jest.fn(),\n  createTemplate: jest.fn(),\n  getTemplate: jest.fn(),\n  updateTemplate: jest.fn(),\n  deleteTemplate: jest.fn(),\n  getEmailAnalytics: jest.fn(),\n}));\n\n// Mock Next.js server module\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n  NextRequest: jest.fn(),\n}));\n\n// Mock the Supabase server client\njest.mock('@/lib/supabaseServer', () => ({\n  createAuthenticatedClient: jest.fn(),\n}));\n\n// Import route handlers after mocking\nimport { GET as getEmailLogs } from '@/app/api/admin/emails/route';\nimport { POST as sendBulkEmail } from '@/app/api/admin/emails/send/route';\nimport { GET as getEmailTemplates, POST as createEmailTemplate } from '@/app/api/admin/emails/templates/route';\nimport { GET as getEmailTemplate, PUT as updateEmailTemplate, DELETE as deleteEmailTemplate } from '@/app/api/admin/emails/templates/[id]/route';\nimport { GET as getEmailAnalytics } from '@/app/api/admin/emails/analytics/route';\n\ndescribe('Email API Integration Tests', () => {\n  let mockSupabase: any;\n  let mockGetEmailLogs: jest.Mock;\n  let mockSendBulkEmail: jest.Mock;\n  let mockListTemplates: jest.Mock;\n  let mockCreateTemplate: jest.Mock;\n  let mockGetTemplate: jest.Mock;\n  let mockUpdateTemplate: jest.Mock;\n  let mockDeleteTemplate: jest.Mock;\n  let mockGetEmailAnalytics: jest.Mock;\n\n  beforeEach(() => {\n    // Reset all mocks\n    jest.clearAllMocks();\n\n    // Mock Supabase client\n    mockSupabase = {\n      auth: {\n        getSession: jest.fn(),\n      },\n    };\n\n    // Mock service functions\n    mockGetEmailLogs = require('@/services/emailService').getEmailLogs;\n    mockSendBulkEmail = require('@/services/emailService').sendBulkEmail;\n    mockListTemplates = require('@/services/emailService').listTemplates;\n    mockCreateTemplate = require('@/services/emailService').createTemplate;\n    mockGetTemplate = require('@/services/emailService').getTemplate;\n    mockUpdateTemplate = require('@/services/emailService').updateTemplate;\n    mockDeleteTemplate = require('@/services/emailService').deleteTemplate;\n    mockGetEmailAnalytics = require('@/services/emailService').getEmailAnalytics;\n\n    // Mock createAuthenticatedClient\n    const { createAuthenticatedClient } = require('@/lib/supabaseServer');\n    createAuthenticatedClient.mockResolvedValue(mockSupabase);\n\n    // Mock successful authentication by default\n    mockSupabase.auth.getSession.mockResolvedValue({\n      data: {\n        session: {\n          user: { id: 'user-1', email: 'admin@example.com' },\n          access_token: 'mock-token',\n        },\n      },\n      error: null,\n    });\n  });\n\n  describe('GET /api/admin/emails', () => {\n    it('should return email logs when authenticated', async () => {\n      // Arrange\n      const mockEmailLogs = [\n        {\n          id: 'log-1',\n          recipient_email: 'guest@example.com',\n          subject: 'RSVP Reminder',\n          delivery_status: 'delivered',\n          sent_at: '2024-01-01T10:00:00Z',\n          delivered_at: '2024-01-01T10:01:00Z',\n          created_at: '2024-01-01T10:00:00Z',\n        },\n        {\n          id: 'log-2',\n          recipient_email: 'guest2@example.com',\n          subject: 'Welcome Email',\n          delivery_status: 'sent',\n          sent_at: '2024-01-01T11:00:00Z',\n          created_at: '2024-01-01T11:00:00Z',\n        },\n      ];\n\n      mockGetEmailLogs.mockResolvedValue({\n        success: true,\n        data: mockEmailLogs,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailLogs(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockEmailLogs);\n      expect(mockGetEmailLogs).toHaveBeenCalledWith();\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailLogs(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(mockGetEmailLogs).not.toHaveBeenCalled();\n    });\n\n    it('should return 500 when service fails', async () => {\n      // Arrange\n      mockGetEmailLogs.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Database connection failed',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailLogs(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n\n    it('should handle authentication errors', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: { message: 'Session expired' },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailLogs(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n  });\n\n  describe('POST /api/admin/emails/send', () => {\n    it('should send bulk email when authenticated with valid data', async () => {\n      // Arrange\n      const bulkEmailData = {\n        recipients: ['guest1@example.com', 'guest2@example.com'],\n        subject: 'Wedding Update',\n        html: '<p>Important wedding information</p>',\n        text: 'Important wedding information',\n      };\n\n      mockSendBulkEmail.mockResolvedValue({\n        success: true,\n        data: { sent: 2, failed: 0 },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(bulkEmailData),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.sent).toBe(2);\n      expect(data.data.failed).toBe(0);\n      expect(mockSendBulkEmail).toHaveBeenCalledWith(bulkEmailData);\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          recipients: ['test@example.com'],\n          subject: 'Test',\n          html: '<p>Test</p>',\n        }),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(mockSendBulkEmail).not.toHaveBeenCalled();\n    });\n\n    it('should return 400 for invalid email data', async () => {\n      // Arrange\n      const invalidData = {\n        recipients: ['invalid-email'], // Invalid email format\n        subject: '', // Empty subject\n        html: '', // Empty HTML\n      };\n\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(invalidData),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(data.error.details).toBeDefined();\n      expect(mockSendBulkEmail).not.toHaveBeenCalled();\n    });\n\n    it('should return 400 for missing required fields', async () => {\n      // Arrange\n      const incompleteData = {\n        recipients: ['test@example.com'],\n        // Missing subject and html\n      };\n\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(incompleteData),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(mockSendBulkEmail).not.toHaveBeenCalled();\n    });\n\n    it('should return 500 when email service fails', async () => {\n      // Arrange\n      const validData = {\n        recipients: ['test@example.com'],\n        subject: 'Test Subject',\n        html: '<p>Test content</p>',\n      };\n\n      mockSendBulkEmail.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'EMAIL_SERVICE_ERROR',\n          message: 'Resend API error',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(validData),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('EMAIL_SERVICE_ERROR');\n    });\n\n    it('should handle template-based bulk emails', async () => {\n      // Arrange\n      const templateData = {\n        recipients: ['guest1@example.com', 'guest2@example.com'],\n        subject: 'RSVP Reminder',\n        html: '<p>Please RSVP by {{deadline}}</p>',\n        template_id: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID format\n        variables: { deadline: '2024-02-01' },\n      };\n\n      mockSendBulkEmail.mockResolvedValue({\n        success: true,\n        data: { sent: 2, failed: 0 },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(templateData),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(mockSendBulkEmail).toHaveBeenCalledWith(templateData);\n    });\n\n    it('should validate maximum recipients limit', async () => {\n      // Arrange - Create array with 101 recipients (over limit)\n      const tooManyRecipients = Array.from({ length: 101 }, (_, i) => `user${i}@example.com`);\n      const invalidData = {\n        recipients: tooManyRecipients,\n        subject: 'Test',\n        html: '<p>Test</p>',\n      };\n\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(invalidData),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(mockSendBulkEmail).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('GET /api/admin/emails/templates', () => {\n    it('should return email templates when authenticated', async () => {\n      // Arrange\n      const mockTemplates = [\n        {\n          id: 'template-1',\n          name: 'RSVP Reminder',\n          subject: 'Please RSVP by {{deadline}}',\n          body_html: '<p>Dear {{guest_name}}, please RSVP by {{deadline}}</p>',\n          body_text: 'Dear {{guest_name}}, please RSVP by {{deadline}}',\n          variables: ['guest_name', 'deadline'],\n          created_at: '2024-01-01T10:00:00Z',\n          updated_at: '2024-01-01T10:00:00Z',\n        },\n        {\n          id: 'template-2',\n          name: 'Welcome Email',\n          subject: 'Welcome to our wedding!',\n          body_html: '<p>Welcome {{guest_name}}! We are excited to celebrate with you.</p>',\n          body_text: 'Welcome {{guest_name}}! We are excited to celebrate with you.',\n          variables: ['guest_name'],\n          created_at: '2024-01-01T11:00:00Z',\n          updated_at: '2024-01-01T11:00:00Z',\n        },\n      ];\n\n      mockListTemplates.mockResolvedValue({\n        success: true,\n        data: mockTemplates,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplates(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockTemplates);\n      expect(data.data).toHaveLength(2);\n      expect(mockListTemplates).toHaveBeenCalledWith();\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplates(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(mockListTemplates).not.toHaveBeenCalled();\n    });\n\n    it('should return empty array when no templates exist', async () => {\n      // Arrange\n      mockListTemplates.mockResolvedValue({\n        success: true,\n        data: [],\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplates(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual([]);\n      expect(data.data).toHaveLength(0);\n    });\n\n    it('should return 500 when service fails', async () => {\n      // Arrange\n      mockListTemplates.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to fetch templates',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplates(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n\n    it('should handle templates with complex variables', async () => {\n      // Arrange\n      const complexTemplate = {\n        id: 'template-complex',\n        name: 'Activity Reminder',\n        subject: '{{activity_name}} reminder for {{event_date}}',\n        body_html: `\n          <h1>{{activity_name}}</h1>\n          <p>Dear {{guest_name}},</p>\n          <p>This is a reminder about {{activity_name}} on {{event_date}} at {{event_time}}.</p>\n          <p>Location: {{location_name}}</p>\n          <p>Please arrive by {{arrival_time}}.</p>\n        `,\n        body_text: 'Dear {{guest_name}}, reminder about {{activity_name}} on {{event_date}} at {{event_time}}. Location: {{location_name}}. Please arrive by {{arrival_time}}.',\n        variables: ['guest_name', 'activity_name', 'event_date', 'event_time', 'location_name', 'arrival_time'],\n        created_at: '2024-01-01T12:00:00Z',\n        updated_at: '2024-01-01T12:00:00Z',\n      };\n\n      mockListTemplates.mockResolvedValue({\n        success: true,\n        data: [complexTemplate],\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplates(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data[0].variables).toHaveLength(6);\n      expect(data.data[0].variables).toContain('guest_name');\n      expect(data.data[0].variables).toContain('activity_name');\n    });\n  });\n\n  describe('POST /api/admin/emails/templates', () => {\n    it('should create email template when authenticated with valid data', async () => {\n      // Arrange\n      const templateData = {\n        name: 'New Template',\n        subject: 'Hello {{guest_name}}',\n        body_html: '<p>Hello {{guest_name}}, welcome!</p>',\n        body_text: 'Hello {{guest_name}}, welcome!',\n        variables: ['guest_name'],\n      };\n\n      const createdTemplate = {\n        id: 'template-new',\n        ...templateData,\n        created_at: '2024-01-01T10:00:00Z',\n        updated_at: '2024-01-01T10:00:00Z',\n      };\n\n      mockCreateTemplate.mockResolvedValue({\n        success: true,\n        data: createdTemplate,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(templateData),\n      });\n\n      // Act\n      const response = await createEmailTemplate(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(data.success).toBe(true);\n      expect(data.data.id).toBe('template-new');\n      expect(data.data.name).toBe('New Template');\n      expect(mockCreateTemplate).toHaveBeenCalledWith(templateData);\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          name: 'Test Template',\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n        }),\n      });\n\n      // Act\n      const response = await createEmailTemplate(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(mockCreateTemplate).not.toHaveBeenCalled();\n    });\n\n    it('should return 400 for invalid template data', async () => {\n      // Arrange\n      const invalidData = {\n        name: '', // Empty name\n        subject: 'Test',\n        body_html: '', // Empty HTML\n      };\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(invalidData),\n      });\n\n      // Act\n      const response = await createEmailTemplate(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(data.error.details).toBeDefined();\n      expect(mockCreateTemplate).not.toHaveBeenCalled();\n    });\n\n    it('should return 500 when service fails', async () => {\n      // Arrange\n      const validData = {\n        name: 'Test Template',\n        subject: 'Test Subject',\n        body_html: '<p>Test content</p>',\n        body_text: 'Test content',\n        variables: ['guest_name'],\n      };\n\n      mockCreateTemplate.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to create template',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(validData),\n      });\n\n      // Act\n      const response = await createEmailTemplate(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('GET /api/admin/emails/templates/[id]', () => {\n    it('should return specific template when authenticated', async () => {\n      // Arrange\n      const mockTemplate = {\n        id: 'template-1',\n        name: 'RSVP Reminder',\n        subject: 'Please RSVP by {{deadline}}',\n        body_html: '<p>Dear {{guest_name}}, please RSVP by {{deadline}}</p>',\n        body_text: 'Dear {{guest_name}}, please RSVP by {{deadline}}',\n        variables: ['guest_name', 'deadline'],\n        created_at: '2024-01-01T10:00:00Z',\n        updated_at: '2024-01-01T10:00:00Z',\n      };\n\n      mockGetTemplate.mockResolvedValue({\n        success: true,\n        data: mockTemplate,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/template-1', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplate(request, { params: Promise.resolve({ id: 'template-1' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockTemplate);\n      expect(mockGetTemplate).toHaveBeenCalledWith('template-1');\n    });\n\n    it('should return 404 when template not found', async () => {\n      // Arrange\n      mockGetTemplate.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'NOT_FOUND',\n          message: 'Template not found',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/nonexistent', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplate(request, { params: Promise.resolve({ id: 'nonexistent' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/template-1', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailTemplate(request, { params: Promise.resolve({ id: 'template-1' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(mockGetTemplate).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('PUT /api/admin/emails/templates/[id]', () => {\n    it('should update template when authenticated with valid data', async () => {\n      // Arrange\n      const updateData = {\n        name: 'Updated Template',\n        subject: 'Updated {{guest_name}}',\n        body_html: '<p>Updated {{guest_name}}</p>',\n      };\n\n      const updatedTemplate = {\n        id: 'template-1',\n        ...updateData,\n        body_text: 'Updated {{guest_name}}',\n        variables: ['guest_name'],\n        created_at: '2024-01-01T10:00:00Z',\n        updated_at: '2024-01-01T11:00:00Z',\n      };\n\n      mockUpdateTemplate.mockResolvedValue({\n        success: true,\n        data: updatedTemplate,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/template-1', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updateData),\n      });\n\n      // Act\n      const response = await updateEmailTemplate(request, { params: Promise.resolve({ id: 'template-1' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.name).toBe('Updated Template');\n      expect(mockUpdateTemplate).toHaveBeenCalledWith('template-1', updateData);\n    });\n\n    it('should return 404 when template not found', async () => {\n      // Arrange\n      mockUpdateTemplate.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'NOT_FOUND',\n          message: 'Template not found',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/nonexistent', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name: 'Updated' }),\n      });\n\n      // Act\n      const response = await updateEmailTemplate(request, { params: Promise.resolve({ id: 'nonexistent' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should return 400 for invalid update data', async () => {\n      // Arrange\n      const invalidData = {\n        name: '', // Empty name\n      };\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/template-1', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(invalidData),\n      });\n\n      // Act\n      const response = await updateEmailTemplate(request, { params: Promise.resolve({ id: 'template-1' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(mockUpdateTemplate).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('DELETE /api/admin/emails/templates/[id]', () => {\n    it('should delete template when authenticated', async () => {\n      // Arrange\n      mockDeleteTemplate.mockResolvedValue({\n        success: true,\n        data: undefined,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/template-1', {\n        method: 'DELETE',\n      });\n\n      // Act\n      const response = await deleteEmailTemplate(request, { params: Promise.resolve({ id: 'template-1' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(mockDeleteTemplate).toHaveBeenCalledWith('template-1');\n    });\n\n    it('should return 404 when template not found', async () => {\n      // Arrange\n      mockDeleteTemplate.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'NOT_FOUND',\n          message: 'Template not found',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/nonexistent', {\n        method: 'DELETE',\n      });\n\n      // Act\n      const response = await deleteEmailTemplate(request, { params: Promise.resolve({ id: 'nonexistent' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/templates/template-1', {\n        method: 'DELETE',\n      });\n\n      // Act\n      const response = await deleteEmailTemplate(request, { params: Promise.resolve({ id: 'template-1' }) });\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(mockDeleteTemplate).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('GET /api/admin/emails/analytics', () => {\n    it('should return email analytics when authenticated', async () => {\n      // Arrange\n      const mockAnalytics = {\n        total: 150,\n        delivered: 140,\n        bounced: 5,\n        failed: 5,\n        delivery_rate: 93.33,\n        bounce_rate: 3.33,\n        failure_rate: 3.33,\n        recent_activity: [\n          {\n            date: '2024-01-01',\n            sent: 25,\n            delivered: 24,\n            bounced: 1,\n            failed: 0,\n          },\n          {\n            date: '2024-01-02',\n            sent: 30,\n            delivered: 28,\n            bounced: 1,\n            failed: 1,\n          },\n        ],\n      };\n\n      mockGetEmailAnalytics.mockResolvedValue({\n        success: true,\n        data: mockAnalytics,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/analytics', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailAnalytics(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.total).toBe(150);\n      expect(data.data.delivery_rate).toBe(93.33);\n      expect(data.data.recent_activity).toHaveLength(2);\n      expect(mockGetEmailAnalytics).toHaveBeenCalledWith();\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/analytics', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailAnalytics(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(mockGetEmailAnalytics).not.toHaveBeenCalled();\n    });\n\n    it('should return 500 when service fails', async () => {\n      // Arrange\n      mockGetEmailAnalytics.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to fetch analytics',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/analytics', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailAnalytics(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n\n    it('should handle empty analytics data', async () => {\n      // Arrange\n      const emptyAnalytics = {\n        total: 0,\n        delivered: 0,\n        bounced: 0,\n        failed: 0,\n        delivery_rate: 0,\n        bounce_rate: 0,\n        failure_rate: 0,\n        recent_activity: [],\n      };\n\n      mockGetEmailAnalytics.mockResolvedValue({\n        success: true,\n        data: emptyAnalytics,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/emails/analytics', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailAnalytics(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.total).toBe(0);\n      expect(data.data.recent_activity).toHaveLength(0);\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle malformed JSON in POST requests', async () => {\n      // Arrange\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: 'invalid json{',\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNKNOWN_ERROR');\n    });\n\n    it('should handle missing Content-Type header', async () => {\n      // Arrange\n      const request = new Request('http://localhost:3000/api/admin/emails/send', {\n        method: 'POST',\n        body: JSON.stringify({\n          recipients: ['test@example.com'],\n          subject: 'Test',\n          html: '<p>Test</p>',\n        }),\n      });\n\n      // Act\n      const response = await sendBulkEmail(request);\n      const data = await response.json();\n\n      // Assert - Should still work as Next.js handles JSON parsing\n      expect(response.status).toBe(200);\n      expect(mockSendBulkEmail).toHaveBeenCalled();\n    });\n\n    it('should handle service throwing unexpected errors', async () => {\n      // Arrange\n      mockGetEmailLogs.mockRejectedValue(new Error('Unexpected service error'));\n\n      const request = new Request('http://localhost:3000/api/admin/emails', {\n        method: 'GET',\n      });\n\n      // Act\n      const response = await getEmailLogs(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNKNOWN_ERROR');\n      expect(data.error.message).toBe('Unexpected service error');\n    });\n  });\n});"],"names":["jest","mock","getEmailLogs","fn","sendBulkEmail","listTemplates","createTemplate","getTemplate","updateTemplate","deleteTemplate","getEmailAnalytics","NextResponse","json","data","init","status","NextRequest","createAuthenticatedClient","global","TextEncoder","TextDecoder","describe","mockSupabase","mockGetEmailLogs","mockSendBulkEmail","mockListTemplates","mockCreateTemplate","mockGetTemplate","mockUpdateTemplate","mockDeleteTemplate","mockGetEmailAnalytics","beforeEach","clearAllMocks","auth","getSession","require","mockResolvedValue","session","user","id","email","access_token","error","it","mockEmailLogs","recipient_email","subject","delivery_status","sent_at","delivered_at","created_at","success","request","Request","method","response","expect","toBe","toEqual","toHaveBeenCalledWith","code","not","toHaveBeenCalled","message","bulkEmailData","recipients","html","text","sent","failed","headers","body","JSON","stringify","invalidData","details","toBeDefined","incompleteData","validData","templateData","template_id","variables","deadline","tooManyRecipients","Array","from","length","_","i","mockTemplates","name","body_html","body_text","updated_at","getEmailTemplates","toHaveLength","complexTemplate","toContain","createdTemplate","createEmailTemplate","mockTemplate","getEmailTemplate","params","Promise","resolve","updateData","updatedTemplate","updateEmailTemplate","undefined","deleteEmailTemplate","mockAnalytics","total","delivered","bounced","delivery_rate","bounce_rate","failure_rate","recent_activity","date","emptyAnalytics","mockRejectedValue","Error"],"mappings":"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"}