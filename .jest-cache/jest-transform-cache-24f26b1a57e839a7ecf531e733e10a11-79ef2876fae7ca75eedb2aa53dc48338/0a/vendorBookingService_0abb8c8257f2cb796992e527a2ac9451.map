{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/vendorBookingService.ts"],"sourcesContent":["/**\n * Vendor Booking Service\n * \n * Handles vendor-to-activity/event associations and cost propagation\n * when vendor information changes.\n * \n * Requirements: 8.2, 8.4, 8.9, 8.10\n */\n\nimport { createClient } from '@supabase/supabase-js';\nimport {\n  createVendorBookingSchema,\n  updateVendorBookingSchema,\n  vendorBookingFilterSchema,\n  type CreateVendorBookingDTO,\n  type UpdateVendorBookingDTO,\n  type VendorBookingFilterDTO,\n  type VendorBooking,\n  type PaginatedVendorBookings,\n  type VendorBookingWithDetails,\n} from '../schemas/vendorBookingSchemas';\nimport { sanitizeInput } from '../utils/sanitization';\n\n// Result type for consistent error handling\ntype Result<T> =\n  | { success: true; data: T }\n  | { success: false; error: { code: string; message: string; details?: unknown } };\n\n// Initialize Supabase client\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\n/**\n * Creates a new vendor booking linking a vendor to an activity or event.\n * \n * @param data - Booking data including vendor ID, activity/event ID, and booking date\n * @returns Result containing the created booking or error details\n * \n * @example\n * const result = await vendorBookingService.create({\n *   vendorId: 'vendor-uuid',\n *   activityId: 'activity-uuid',\n *   bookingDate: '2025-06-15',\n * });\n */\nexport async function create(data: CreateVendorBookingDTO): Promise<Result<VendorBooking>> {\n  try {\n    // 1. Validate\n    const validation = createVendorBookingSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 2. Sanitize user input\n    const sanitized = {\n      ...validation.data,\n      notes: validation.data.notes ? sanitizeInput(validation.data.notes) : null,\n    };\n\n    // 3. Calculate total cost based on pricing model\n    const totalCost = sanitized.pricingModel === 'per_guest'\n      ? sanitized.baseCost * (sanitized.guestCount || 0)\n      : sanitized.baseCost;\n\n    // 4. Database operation\n    const { data: booking, error } = await supabase\n      .from('vendor_bookings')\n      .insert({\n        vendor_id: sanitized.vendorId,\n        activity_id: sanitized.activityId || null,\n        event_id: sanitized.eventId || null,\n        booking_date: sanitized.bookingDate,\n        base_cost: sanitized.baseCost,\n        guest_count: sanitized.guestCount || null,\n        pricing_model: sanitized.pricingModel,\n        total_cost: totalCost,\n        host_subsidy: sanitized.hostSubsidy,\n        notes: sanitized.notes,\n      })\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: mapBookingFromDb(booking),\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred',\n      },\n    };\n  }\n}\n\n/**\n * Retrieves a vendor booking by ID.\n * \n * @param id - Booking UUID\n * @returns Result containing the booking or error details\n */\nexport async function get(id: string): Promise<Result<VendorBooking>> {\n  try {\n    const { data: booking, error } = await supabase\n      .from('vendor_bookings')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: {\n            code: 'NOT_FOUND',\n            message: 'Vendor booking not found',\n          },\n        };\n      }\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: mapBookingFromDb(booking),\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred',\n      },\n    };\n  }\n}\n\n/**\n * Updates an existing vendor booking.\n * \n * @param id - Booking UUID\n * @param data - Partial booking data to update\n * @returns Result containing the updated booking or error details\n */\nexport async function update(id: string, data: UpdateVendorBookingDTO): Promise<Result<VendorBooking>> {\n  try {\n    // 1. Validate\n    const validation = updateVendorBookingSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 2. Get current booking to calculate total cost if needed\n    const currentBooking = await get(id);\n    if (!currentBooking.success) {\n      return currentBooking;\n    }\n\n    // 3. Sanitize user input and prepare update data\n    const sanitized: Record<string, unknown> = {};\n    if (validation.data.notes !== undefined) {\n      sanitized.notes = validation.data.notes ? sanitizeInput(validation.data.notes) : null;\n    }\n    if (validation.data.vendorId !== undefined) {\n      sanitized.vendor_id = validation.data.vendorId;\n    }\n    if (validation.data.activityId !== undefined) {\n      sanitized.activity_id = validation.data.activityId || null;\n    }\n    if (validation.data.eventId !== undefined) {\n      sanitized.event_id = validation.data.eventId || null;\n    }\n    if (validation.data.bookingDate !== undefined) {\n      sanitized.booking_date = validation.data.bookingDate;\n    }\n    if (validation.data.baseCost !== undefined) {\n      sanitized.base_cost = validation.data.baseCost;\n    }\n    if (validation.data.guestCount !== undefined) {\n      sanitized.guest_count = validation.data.guestCount || null;\n    }\n    if (validation.data.pricingModel !== undefined) {\n      sanitized.pricing_model = validation.data.pricingModel;\n    }\n    if (validation.data.hostSubsidy !== undefined) {\n      sanitized.host_subsidy = validation.data.hostSubsidy;\n    }\n\n    // 4. Calculate total cost if pricing-related fields changed\n    const baseCost = validation.data.baseCost ?? currentBooking.data.baseCost;\n    const guestCount = validation.data.guestCount ?? currentBooking.data.guestCount;\n    const pricingModel = validation.data.pricingModel ?? currentBooking.data.pricingModel;\n    \n    const totalCost = pricingModel === 'per_guest'\n      ? baseCost * (guestCount || 0)\n      : baseCost;\n    \n    sanitized.total_cost = totalCost;\n\n    // 5. Database operation\n    const { data: booking, error } = await supabase\n      .from('vendor_bookings')\n      .update(sanitized)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: {\n            code: 'NOT_FOUND',\n            message: 'Vendor booking not found',\n          },\n        };\n      }\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: mapBookingFromDb(booking),\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred',\n      },\n    };\n  }\n}\n\n/**\n * Deletes a vendor booking from the system.\n * \n * @param id - Booking UUID\n * @returns Result indicating success or error details\n */\nexport async function deleteBooking(id: string): Promise<Result<void>> {\n  try {\n    const { error } = await supabase\n      .from('vendor_bookings')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred',\n      },\n    };\n  }\n}\n\n/**\n * Lists vendor bookings with optional filtering and pagination.\n * \n * @param filters - Optional filters for vendor, activity, event, and pagination\n * @returns Result containing paginated booking list or error details\n */\nexport async function list(filters: VendorBookingFilterDTO = {}): Promise<Result<PaginatedVendorBookings>> {\n  try {\n    // Validate filters\n    const validation = vendorBookingFilterSchema.safeParse(filters);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid filters',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { vendorId, activityId, eventId, page = 1, pageSize = 50 } = validation.data;\n\n    // Build query\n    let query = supabase.from('vendor_bookings').select('*', { count: 'exact' });\n\n    if (vendorId) {\n      query = query.eq('vendor_id', vendorId);\n    }\n    if (activityId) {\n      query = query.eq('activity_id', activityId);\n    }\n    if (eventId) {\n      query = query.eq('event_id', eventId);\n    }\n\n    // Apply pagination\n    const from = (page - 1) * pageSize;\n    const to = from + pageSize - 1;\n    query = query.range(from, to).order('booking_date', { ascending: true });\n\n    const { data: bookings, error, count } = await query;\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    const total = count || 0;\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      success: true,\n      data: {\n        bookings: bookings.map(mapBookingFromDb),\n        total,\n        page,\n        pageSize,\n        totalPages,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred',\n      },\n    };\n  }\n}\n\n/**\n * Gets vendor bookings with full details including vendor and activity/event names.\n * \n * @param filters - Optional filters for vendor, activity, event\n * @returns Result containing bookings with details or error details\n */\nexport async function listWithDetails(filters: VendorBookingFilterDTO = {}): Promise<Result<VendorBookingWithDetails[]>> {\n  try {\n    // Validate filters\n    const validation = vendorBookingFilterSchema.safeParse(filters);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid filters',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { vendorId, activityId, eventId } = validation.data;\n\n    // Build query with joins\n    let query = supabase\n      .from('vendor_bookings')\n      .select(`\n        *,\n        vendors (id, name, category),\n        activities (id, name),\n        events (id, name)\n      `);\n\n    if (vendorId) {\n      query = query.eq('vendor_id', vendorId);\n    }\n    if (activityId) {\n      query = query.eq('activity_id', activityId);\n    }\n    if (eventId) {\n      query = query.eq('event_id', eventId);\n    }\n\n    const { data: bookings, error } = await query.order('booking_date', { ascending: true });\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    const bookingsWithDetails: VendorBookingWithDetails[] = bookings.map((booking: any) => ({\n      id: booking.id,\n      vendorId: booking.vendor_id,\n      vendorName: booking.vendors?.name || 'Unknown',\n      vendorCategory: booking.vendors?.category || 'other',\n      activityId: booking.activity_id,\n      activityName: booking.activities?.name || null,\n      eventId: booking.event_id,\n      eventName: booking.events?.name || null,\n      bookingDate: booking.booking_date,\n      baseCost: booking.base_cost,\n      guestCount: booking.guest_count,\n      pricingModel: booking.pricing_model,\n      totalCost: booking.total_cost,\n      hostSubsidy: booking.host_subsidy,\n      notes: booking.notes,\n      createdAt: booking.created_at,\n    }));\n\n    return {\n      success: true,\n      data: bookingsWithDetails,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred',\n      },\n    };\n  }\n}\n\n/**\n * Gets all bookings for a specific vendor.\n * \n * @param vendorId - Vendor UUID\n * @returns Result containing vendor's bookings or error details\n */\nexport async function getVendorBookings(vendorId: string): Promise<Result<VendorBookingWithDetails[]>> {\n  return listWithDetails({ vendorId });\n}\n\n/**\n * Gets all bookings for a specific activity.\n * \n * @param activityId - Activity UUID\n * @returns Result containing activity's bookings or error details\n */\nexport async function getActivityBookings(activityId: string): Promise<Result<VendorBookingWithDetails[]>> {\n  return listWithDetails({ activityId });\n}\n\n/**\n * Gets all bookings for a specific event.\n * \n * @param eventId - Event UUID\n * @returns Result containing event's bookings or error details\n */\nexport async function getEventBookings(eventId: string): Promise<Result<VendorBookingWithDetails[]>> {\n  return listWithDetails({ eventId });\n}\n\n/**\n * Propagates vendor cost changes to all related bookings.\n * This is called when a vendor's cost is updated to ensure\n * budget calculations reflect the new cost.\n * \n * @param vendorId - Vendor UUID\n * @returns Result indicating success or error details\n */\nexport async function propagateVendorCostChange(vendorId: string): Promise<Result<void>> {\n  try {\n    // Get all bookings for this vendor\n    const bookingsResult = await getVendorBookings(vendorId);\n    if (!bookingsResult.success) {\n      return bookingsResult as Result<void>;\n    }\n\n    // Note: In a real implementation, this would trigger recalculation\n    // of budget totals for all activities/events associated with this vendor.\n    // For now, we just return success as the budget service will\n    // recalculate on-demand when requested.\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error occurred',\n      },\n    };\n  }\n}\n\n/**\n * Maps database booking record to VendorBooking type.\n */\nfunction mapBookingFromDb(dbBooking: any): VendorBooking {\n  return {\n    id: dbBooking.id,\n    vendorId: dbBooking.vendor_id,\n    activityId: dbBooking.activity_id,\n    eventId: dbBooking.event_id,\n    bookingDate: dbBooking.booking_date,\n    baseCost: dbBooking.base_cost,\n    guestCount: dbBooking.guest_count,\n    pricingModel: dbBooking.pricing_model,\n    totalCost: dbBooking.total_cost,\n    hostSubsidy: dbBooking.host_subsidy,\n    notes: dbBooking.notes,\n    createdAt: dbBooking.created_at,\n  };\n}\n"],"names":["create","deleteBooking","get","getActivityBookings","getEventBookings","getVendorBookings","list","listWithDetails","propagateVendorCostChange","update","supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","data","validation","createVendorBookingSchema","safeParse","success","error","code","message","details","issues","sanitized","notes","sanitizeInput","totalCost","pricingModel","baseCost","guestCount","booking","from","insert","vendor_id","vendorId","activity_id","activityId","event_id","eventId","booking_date","bookingDate","base_cost","guest_count","pricing_model","total_cost","host_subsidy","hostSubsidy","select","single","mapBookingFromDb","Error","id","eq","updateVendorBookingSchema","currentBooking","undefined","delete","filters","vendorBookingFilterSchema","page","pageSize","query","count","to","range","order","ascending","bookings","total","totalPages","Math","ceil","map","bookingsWithDetails","vendorName","vendors","name","vendorCategory","category","activityName","activities","eventName","events","createdAt","created_at","bookingsResult","dbBooking"],"mappings":"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"}