{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/build/nextjs.build.test.ts"],"sourcesContent":["/**\n * Next.js Build Validation Tests\n * \n * These tests validate that Next.js builds successfully.\n * They catch issues specific to Next.js compilation and static generation.\n * \n * Why this exists:\n * - Next.js has its own compiler (Turbopack/Webpack)\n * - Static generation can fail even if TypeScript passes\n * - Build-time errors only appear during production build\n */\n\nimport { execSync } from 'child_process';\n\ndescribe('Next.js Build', () => {\n  it('should build successfully', () => {\n    expect(() => {\n      execSync('npm run build', { \n        stdio: 'pipe',\n        encoding: 'utf-8'\n      });\n    }).not.toThrow();\n  }, 120000); // 2 minute timeout for full build\n\n  it('should generate all static pages', () => {\n    const output = execSync('npm run build', { \n      encoding: 'utf-8',\n      stdio: 'pipe'\n    });\n    \n    // Verify static generation completed\n    expect(output).toContain('Generating static pages');\n    expect(output).not.toContain('Failed to compile');\n    expect(output).not.toContain('Error occurred prerendering page');\n    \n    // Check that we generated the expected number of pages\n    // Adjust this number based on your actual page count\n    expect(output).toMatch(/\\(\\d+\\/\\d+\\)/);\n  }, 120000);\n\n  it('should not have any build warnings', () => {\n    const output = execSync('npm run build', { \n      encoding: 'utf-8',\n      stdio: 'pipe'\n    });\n    \n    // Check for common warnings\n    expect(output).not.toContain('Warning:');\n    expect(output).not.toContain('deprecated');\n    \n    // Allow some warnings but fail if there are too many\n    const warningCount = (output.match(/warn/gi) || []).length;\n    expect(warningCount).toBeLessThan(5);\n  }, 120000);\n\n  it('should have reasonable build size', () => {\n    const output = execSync('npm run build', { \n      encoding: 'utf-8',\n      stdio: 'pipe'\n    });\n    \n    // Extract build size information\n    // This is a basic check - adjust thresholds based on your app\n    const sizeMatch = output.match(/Total size: ([\\d.]+) kB/);\n    \n    if (sizeMatch) {\n      const totalSize = parseFloat(sizeMatch[1]);\n      \n      // Warn if bundle is getting too large (adjust threshold as needed)\n      if (totalSize > 5000) {\n        console.warn(`Warning: Total bundle size is ${totalSize} kB. Consider code splitting.`);\n      }\n      \n      // Fail if bundle is unreasonably large\n      expect(totalSize).toBeLessThan(10000); // 10 MB\n    }\n  }, 120000);\n\n  it('should not have duplicate dependencies', () => {\n    try {\n      const output = execSync('npm ls --depth=0', { \n        encoding: 'utf-8',\n        stdio: 'pipe'\n      });\n      \n      // Check for duplicate packages\n      expect(output).not.toContain('UNMET DEPENDENCY');\n      expect(output).not.toContain('extraneous');\n    } catch (error: any) {\n      // npm ls returns non-zero if there are issues\n      if (error.stdout) {\n        fail(`Dependency issues found:\\n${error.stdout}`);\n      }\n    }\n  });\n\n  it('should have valid next.config', async () => {\n    const { readFile } = await import('fs/promises');\n    \n    // Verify next.config.ts exists and is valid\n    const configContent = await readFile('next.config.ts', 'utf-8');\n    \n    expect(configContent).toContain('NextConfig');\n    expect(configContent).not.toContain('TODO');\n    expect(configContent).not.toContain('FIXME');\n  });\n});\n"],"names":["describe","it","expect","execSync","stdio","encoding","not","toThrow","output","toContain","toMatch","warningCount","match","length","toBeLessThan","sizeMatch","totalSize","parseFloat","console","warn","error","stdout","fail","readFile","configContent"],"mappings":"AAAA;;;;;;;;;;CAUC;;;;+BAEwB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEzBA,SAAS,iBAAiB;IACxBC,GAAG,6BAA6B;QAC9BC,OAAO;YACLC,IAAAA,uBAAQ,EAAC,iBAAiB;gBACxBC,OAAO;gBACPC,UAAU;YACZ;QACF,GAAGC,GAAG,CAACC,OAAO;IAChB,GAAG,SAAS,kCAAkC;IAE9CN,GAAG,oCAAoC;QACrC,MAAMO,SAASL,IAAAA,uBAAQ,EAAC,iBAAiB;YACvCE,UAAU;YACVD,OAAO;QACT;QAEA,qCAAqC;QACrCF,OAAOM,QAAQC,SAAS,CAAC;QACzBP,OAAOM,QAAQF,GAAG,CAACG,SAAS,CAAC;QAC7BP,OAAOM,QAAQF,GAAG,CAACG,SAAS,CAAC;QAE7B,uDAAuD;QACvD,qDAAqD;QACrDP,OAAOM,QAAQE,OAAO,CAAC;IACzB,GAAG;IAEHT,GAAG,sCAAsC;QACvC,MAAMO,SAASL,IAAAA,uBAAQ,EAAC,iBAAiB;YACvCE,UAAU;YACVD,OAAO;QACT;QAEA,4BAA4B;QAC5BF,OAAOM,QAAQF,GAAG,CAACG,SAAS,CAAC;QAC7BP,OAAOM,QAAQF,GAAG,CAACG,SAAS,CAAC;QAE7B,qDAAqD;QACrD,MAAME,eAAe,AAACH,CAAAA,OAAOI,KAAK,CAAC,aAAa,EAAE,AAAD,EAAGC,MAAM;QAC1DX,OAAOS,cAAcG,YAAY,CAAC;IACpC,GAAG;IAEHb,GAAG,qCAAqC;QACtC,MAAMO,SAASL,IAAAA,uBAAQ,EAAC,iBAAiB;YACvCE,UAAU;YACVD,OAAO;QACT;QAEA,iCAAiC;QACjC,8DAA8D;QAC9D,MAAMW,YAAYP,OAAOI,KAAK,CAAC;QAE/B,IAAIG,WAAW;YACb,MAAMC,YAAYC,WAAWF,SAAS,CAAC,EAAE;YAEzC,mEAAmE;YACnE,IAAIC,YAAY,MAAM;gBACpBE,QAAQC,IAAI,CAAC,CAAC,8BAA8B,EAAEH,UAAU,6BAA6B,CAAC;YACxF;YAEA,uCAAuC;YACvCd,OAAOc,WAAWF,YAAY,CAAC,QAAQ,QAAQ;QACjD;IACF,GAAG;IAEHb,GAAG,0CAA0C;QAC3C,IAAI;YACF,MAAMO,SAASL,IAAAA,uBAAQ,EAAC,oBAAoB;gBAC1CE,UAAU;gBACVD,OAAO;YACT;YAEA,+BAA+B;YAC/BF,OAAOM,QAAQF,GAAG,CAACG,SAAS,CAAC;YAC7BP,OAAOM,QAAQF,GAAG,CAACG,SAAS,CAAC;QAC/B,EAAE,OAAOW,OAAY;YACnB,8CAA8C;YAC9C,IAAIA,MAAMC,MAAM,EAAE;gBAChBC,KAAK,CAAC,0BAA0B,EAAEF,MAAMC,MAAM,EAAE;YAClD;QACF;IACF;IAEApB,GAAG,iCAAiC;QAClC,MAAM,EAAEsB,QAAQ,EAAE,GAAG,MAAM,mEAAA,QAAO;QAElC,4CAA4C;QAC5C,MAAMC,gBAAgB,MAAMD,SAAS,kBAAkB;QAEvDrB,OAAOsB,eAAef,SAAS,CAAC;QAChCP,OAAOsB,eAAelB,GAAG,CAACG,SAAS,CAAC;QACpCP,OAAOsB,eAAelB,GAAG,CAACG,SAAS,CAAC;IACtC;AACF"}