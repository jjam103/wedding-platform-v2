{"version":3,"names":["GET","request","cov_1tbz92vg26","f","s","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","guest","guestError","from","select","eq","user","email","single","searchParams","URL","url","get","to","isNaN","Date","parse","itineraryResult","_itineraryService","generateItinerary","id","filteredItinerary","events","filter","event","eventDate","date","firstName","first_name","lastName","last_name","activities","generatedAt","toISOString","console","path"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/itinerary/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport * as itineraryService from '@/services/itineraryService';\n\n/**\n * GET /api/guest/itinerary\n * \n * Returns the personalized itinerary for the authenticated guest.\n * Only includes activities the guest is attending, sorted chronologically.\n * \n * Query Parameters:\n * - from: ISO date string (optional) - Filter activities from this date\n * - to: ISO date string (optional) - Filter activities to this date\n * \n * Requirements: 26.1, 26.2, 26.6\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. AUTHENTICATION\n    const supabase = createRouteHandlerClient({ cookies });\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // Get guest ID from session\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, first_name, last_name, group_id')\n      .eq('email', session.user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // 2. VALIDATION (query parameters)\n    const { searchParams } = new URL(request.url);\n    const from = searchParams.get('from');\n    const to = searchParams.get('to');\n    \n    // Validate date formats if provided\n    if (from && isNaN(Date.parse(from))) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid from date format' } },\n        { status: 400 }\n      );\n    }\n    \n    if (to && isNaN(Date.parse(to))) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid to date format' } },\n        { status: 400 }\n      );\n    }\n    \n    // 3. SERVICE CALL - Generate personalized itinerary\n    const itineraryResult = await itineraryService.generateItinerary(guest.id);\n    \n    if (!itineraryResult.success) {\n      return NextResponse.json(itineraryResult, { status: 500 });\n    }\n    \n    // Filter by date range if provided\n    let filteredItinerary = itineraryResult.data;\n    if (from || to) {\n      filteredItinerary = {\n        ...itineraryResult.data,\n        events: itineraryResult.data.events.filter(event => {\n          const eventDate = new Date(event.date);\n          if (from && eventDate < new Date(from)) return false;\n          if (to && eventDate > new Date(to)) return false;\n          return true;\n        })\n      };\n    }\n    \n    // 4. RESPONSE\n    return NextResponse.json({\n      success: true,\n      data: {\n        guest: {\n          id: guest.id,\n          firstName: guest.first_name,\n          lastName: guest.last_name,\n        },\n        activities: filteredItinerary,\n        generatedAt: new Date().toISOString(),\n      },\n    });\n    \n  } catch (error) {\n    console.error('API Error:', { path: request.url, error });\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}