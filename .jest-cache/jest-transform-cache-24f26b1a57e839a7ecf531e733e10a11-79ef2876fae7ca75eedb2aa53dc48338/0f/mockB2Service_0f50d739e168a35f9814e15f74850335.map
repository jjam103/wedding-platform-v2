{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/mocks/mockB2Service.ts"],"sourcesContent":["/**\n * Mock B2 Storage Service for E2E Testing\n * \n * This mock service simulates Backblaze B2 storage operations without making real API calls.\n * It provides realistic responses for testing photo upload and storage functionality.\n */\n\nimport type { Result } from '@/types';\n\ninterface UploadResult {\n  url: string;\n  key: string;\n}\n\ninterface HealthCheckResult {\n  healthy: boolean;\n  lastChecked: Date;\n  error?: string;\n}\n\ninterface B2Config {\n  endpoint: string;\n  region: string;\n  accessKeyId: string;\n  secretAccessKey: string;\n  bucket: string;\n  cdnDomain: string;\n}\n\n// Track mock uploads for debugging\nconst mockUploads: Array<{\n  fileName: string;\n  contentType: string;\n  timestamp: number;\n  key: string;\n  url: string;\n}> = [];\n\nlet mockHealthStatus: HealthCheckResult = {\n  healthy: true,\n  lastChecked: new Date(),\n};\n\n/**\n * Mock B2 configuration validation\n */\nexport function validateB2Config(): Result<B2Config> {\n  // In test environment, always return success with mock config\n  return {\n    success: true,\n    data: {\n      endpoint: 'https://s3.us-west-004.backblazeb2.com',\n      region: 'us-west-004',\n      accessKeyId: 'test-b2-key-id',\n      secretAccessKey: 'test-b2-key',\n      bucket: 'test-bucket',\n      cdnDomain: 'test-cdn.example.com',\n    },\n  };\n}\n\n/**\n * Mock B2 client initialization\n */\nexport function initializeB2Client(config: B2Config): Result<void> {\n  console.log('ðŸ§ª [MOCK B2] Client initialized with config:', {\n    endpoint: config.endpoint,\n    region: config.region,\n    bucket: config.bucket,\n    cdnDomain: config.cdnDomain,\n  });\n\n  return { success: true, data: undefined };\n}\n\n/**\n * Mock file upload to B2\n * Returns a mock CDN URL without making real API calls\n */\nexport async function uploadToB2(\n  file: Buffer,\n  fileName: string,\n  contentType: string\n): Promise<Result<UploadResult>> {\n  try {\n    // Simulate network delay\n    await new Promise((resolve) => setTimeout(resolve, 100));\n\n    // Generate mock key and URL\n    const timestamp = Date.now();\n    const sanitizedFileName = fileName.replace(/[^a-zA-Z0-9._-]/g, '_');\n    const key = `photos/${timestamp}-${sanitizedFileName}`;\n    const url = `https://test-cdn.example.com/${key}`;\n\n    // Track upload for debugging\n    mockUploads.push({\n      fileName,\n      contentType,\n      timestamp,\n      key,\n      url,\n    });\n\n    console.log('ðŸ§ª [MOCK B2] File uploaded:', {\n      fileName,\n      contentType,\n      size: file.length,\n      key,\n      url,\n    });\n\n    return {\n      success: true,\n      data: { url, key },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UPLOAD_ERROR',\n        message: error instanceof Error ? error.message : 'Mock upload failed',\n        details: error,\n      },\n    };\n  }\n}\n\n/**\n * Mock B2 health check\n * Always returns healthy status in test environment\n */\nexport async function checkB2Health(): Promise<Result<HealthCheckResult>> {\n  mockHealthStatus = {\n    healthy: true,\n    lastChecked: new Date(),\n  };\n\n  console.log('ðŸ§ª [MOCK B2] Health check performed:', mockHealthStatus);\n\n  return { success: true, data: mockHealthStatus };\n}\n\n/**\n * Get current mock health status\n */\nexport function getB2HealthStatus(): HealthCheckResult {\n  return mockHealthStatus;\n}\n\n/**\n * Generate mock CDN URL\n */\nexport function generateCDNUrl(key: string): string {\n  return `https://test-cdn.example.com/${key}`;\n}\n\n/**\n * Check if B2 is healthy (always true in mock)\n */\nexport async function isB2Healthy(): Promise<Result<boolean>> {\n  return { success: true, data: true };\n}\n\n/**\n * Reset mock state (for test cleanup)\n */\nexport function resetB2Client(): void {\n  mockUploads.length = 0;\n  mockHealthStatus = {\n    healthy: true,\n    lastChecked: new Date(),\n  };\n  console.log('ðŸ§ª [MOCK B2] Client reset');\n}\n\n/**\n * Get all mock uploads (for test verification)\n */\nexport function getMockUploads() {\n  return [...mockUploads];\n}\n\n/**\n * Simulate B2 failure for error testing\n */\nexport function simulateB2Failure(errorMessage: string = 'Simulated B2 failure'): void {\n  mockHealthStatus = {\n    healthy: false,\n    lastChecked: new Date(),\n    error: errorMessage,\n  };\n  console.log('ðŸ§ª [MOCK B2] Simulating failure:', errorMessage);\n}\n"],"names":["checkB2Health","generateCDNUrl","getB2HealthStatus","getMockUploads","initializeB2Client","isB2Healthy","resetB2Client","simulateB2Failure","uploadToB2","validateB2Config","mockUploads","mockHealthStatus","healthy","lastChecked","Date","success","data","endpoint","region","accessKeyId","secretAccessKey","bucket","cdnDomain","config","console","log","undefined","file","fileName","contentType","Promise","resolve","setTimeout","timestamp","now","sanitizedFileName","replace","key","url","push","size","length","error","code","message","Error","details","errorMessage"],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;QA8HqBA;eAAAA;;QAqBNC;eAAAA;;QAPAC;eAAAA;;QAiCAC;eAAAA;;QAlHAC;eAAAA;;QA+FMC;eAAAA;;QAONC;eAAAA;;QAmBAC;eAAAA;;QA1GMC;eAAAA;;QAjCNC;eAAAA;;;AAjBhB,mCAAmC;AACnC,MAAMC,cAMD,EAAE;AAEP,IAAIC,mBAAsC;IACxCC,SAAS;IACTC,aAAa,IAAIC;AACnB;AAKO,SAASL;IACd,8DAA8D;IAC9D,OAAO;QACLM,SAAS;QACTC,MAAM;YACJC,UAAU;YACVC,QAAQ;YACRC,aAAa;YACbC,iBAAiB;YACjBC,QAAQ;YACRC,WAAW;QACb;IACF;AACF;AAKO,SAASlB,mBAAmBmB,MAAgB;IACjDC,QAAQC,GAAG,CAAC,gDAAgD;QAC1DR,UAAUM,OAAON,QAAQ;QACzBC,QAAQK,OAAOL,MAAM;QACrBG,QAAQE,OAAOF,MAAM;QACrBC,WAAWC,OAAOD,SAAS;IAC7B;IAEA,OAAO;QAAEP,SAAS;QAAMC,MAAMU;IAAU;AAC1C;AAMO,eAAelB,WACpBmB,IAAY,EACZC,QAAgB,EAChBC,WAAmB;IAEnB,IAAI;QACF,yBAAyB;QACzB,MAAM,IAAIC,QAAQ,CAACC,UAAYC,WAAWD,SAAS;QAEnD,4BAA4B;QAC5B,MAAME,YAAYnB,KAAKoB,GAAG;QAC1B,MAAMC,oBAAoBP,SAASQ,OAAO,CAAC,oBAAoB;QAC/D,MAAMC,MAAM,CAAC,OAAO,EAAEJ,UAAU,CAAC,EAAEE,mBAAmB;QACtD,MAAMG,MAAM,CAAC,6BAA6B,EAAED,KAAK;QAEjD,6BAA6B;QAC7B3B,YAAY6B,IAAI,CAAC;YACfX;YACAC;YACAI;YACAI;YACAC;QACF;QAEAd,QAAQC,GAAG,CAAC,+BAA+B;YACzCG;YACAC;YACAW,MAAMb,KAAKc,MAAM;YACjBJ;YACAC;QACF;QAEA,OAAO;YACLvB,SAAS;YACTC,MAAM;gBAAEsB;gBAAKD;YAAI;QACnB;IACF,EAAE,OAAOK,OAAO;QACd,OAAO;YACL3B,SAAS;YACT2B,OAAO;gBACLC,MAAM;gBACNC,SAASF,iBAAiBG,QAAQH,MAAME,OAAO,GAAG;gBAClDE,SAASJ;YACX;QACF;IACF;AACF;AAMO,eAAe1C;IACpBW,mBAAmB;QACjBC,SAAS;QACTC,aAAa,IAAIC;IACnB;IAEAU,QAAQC,GAAG,CAAC,wCAAwCd;IAEpD,OAAO;QAAEI,SAAS;QAAMC,MAAML;IAAiB;AACjD;AAKO,SAAST;IACd,OAAOS;AACT;AAKO,SAASV,eAAeoC,GAAW;IACxC,OAAO,CAAC,6BAA6B,EAAEA,KAAK;AAC9C;AAKO,eAAehC;IACpB,OAAO;QAAEU,SAAS;QAAMC,MAAM;IAAK;AACrC;AAKO,SAASV;IACdI,YAAY+B,MAAM,GAAG;IACrB9B,mBAAmB;QACjBC,SAAS;QACTC,aAAa,IAAIC;IACnB;IACAU,QAAQC,GAAG,CAAC;AACd;AAKO,SAAStB;IACd,OAAO;WAAIO;KAAY;AACzB;AAKO,SAASH,kBAAkBwC,eAAuB,sBAAsB;IAC7EpC,mBAAmB;QACjBC,SAAS;QACTC,aAAa,IAAIC;QACjB4B,OAAOK;IACT;IACAvB,QAAQC,GAAG,CAAC,oCAAoCsB;AAClD"}