a6de1f06b31c57b2c5b0ea47a7278ccf
/**
 * API Route: POST /api/admin/sections/validate-refs
 * 
 * Validates references in section content
 * 
 * Validates: Requirements 15.6
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "POST", {
    enumerable: true,
    get: function() {
        return POST;
    }
});
const _zod = require("zod");
const _apiHelpers = require("../../../../../lib/apiHelpers");
const _sectionsService = require("../../../../../services/sectionsService");
const validateRefsSchema = _zod.z.object({
    references: _zod.z.array(_zod.z.object({
        id: _zod.z.string().uuid(),
        type: _zod.z.enum([
            'activity',
            'event',
            'accommodation',
            'location'
        ]),
        name: _zod.z.string().optional(),
        slug: _zod.z.string().optional()
    }))
});
async function POST(request) {
    try {
        // 1. Verify authentication
        const authResult = await (0, _apiHelpers.verifyAuth)();
        if (!authResult.success) {
            return (0, _apiHelpers.errorResponse)('UNAUTHORIZED', 'Authentication required', 401);
        }
        // 2. Parse and validate request body
        const body = await request.json();
        const validation = (0, _apiHelpers.validateBody)(body, validateRefsSchema);
        if (!validation.success) {
            return (0, _apiHelpers.errorResponse)(validation.error.code, validation.error.message, 400, validation.error.details);
        }
        // 3. Validate references
        const result = await (0, _sectionsService.validateReferences)(validation.data.references);
        // 4. Return response
        if (!result.success) {
            return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, 500, result.error.details);
        }
        return (0, _apiHelpers.successResponse)(result.data);
    } catch (error) {
        return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', error instanceof Error ? error.message : 'Unknown error', 500);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9zZWN0aW9ucy92YWxpZGF0ZS1yZWZzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQVBJIFJvdXRlOiBQT1NUIC9hcGkvYWRtaW4vc2VjdGlvbnMvdmFsaWRhdGUtcmVmc1xuICogXG4gKiBWYWxpZGF0ZXMgcmVmZXJlbmNlcyBpbiBzZWN0aW9uIGNvbnRlbnRcbiAqIFxuICogVmFsaWRhdGVzOiBSZXF1aXJlbWVudHMgMTUuNlxuICovXG5cbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgdmVyaWZ5QXV0aCwgZXJyb3JSZXNwb25zZSwgc3VjY2Vzc1Jlc3BvbnNlLCB2YWxpZGF0ZUJvZHkgfSBmcm9tICdAL2xpYi9hcGlIZWxwZXJzJztcbmltcG9ydCB7IHZhbGlkYXRlUmVmZXJlbmNlcyB9IGZyb20gJ0Avc2VydmljZXMvc2VjdGlvbnNTZXJ2aWNlJztcblxuY29uc3QgdmFsaWRhdGVSZWZzU2NoZW1hID0gei5vYmplY3Qoe1xuICByZWZlcmVuY2VzOiB6LmFycmF5KFxuICAgIHoub2JqZWN0KHtcbiAgICAgIGlkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgICAgIHR5cGU6IHouZW51bShbJ2FjdGl2aXR5JywgJ2V2ZW50JywgJ2FjY29tbW9kYXRpb24nLCAnbG9jYXRpb24nXSksXG4gICAgICBuYW1lOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICBzbHVnOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgfSlcbiAgKSxcbn0pO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gMS4gVmVyaWZ5IGF1dGhlbnRpY2F0aW9uXG4gICAgY29uc3QgYXV0aFJlc3VsdCA9IGF3YWl0IHZlcmlmeUF1dGgoKTtcbiAgICBpZiAoIWF1dGhSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoJ1VOQVVUSE9SSVpFRCcsICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsIDQwMSk7XG4gICAgfVxuXG4gICAgLy8gMi4gUGFyc2UgYW5kIHZhbGlkYXRlIHJlcXVlc3QgYm9keVxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdmFsaWRhdGVCb2R5KGJvZHksIHZhbGlkYXRlUmVmc1NjaGVtYSk7XG5cbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgIHZhbGlkYXRpb24uZXJyb3IuY29kZSxcbiAgICAgICAgdmFsaWRhdGlvbi5lcnJvci5tZXNzYWdlLFxuICAgICAgICA0MDAsXG4gICAgICAgIHZhbGlkYXRpb24uZXJyb3IuZGV0YWlsc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyAzLiBWYWxpZGF0ZSByZWZlcmVuY2VzXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVSZWZlcmVuY2VzKHZhbGlkYXRpb24uZGF0YS5yZWZlcmVuY2VzKTtcblxuICAgIC8vIDQuIFJldHVybiByZXNwb25zZVxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICByZXN1bHQuZXJyb3IuY29kZSxcbiAgICAgICAgcmVzdWx0LmVycm9yLm1lc3NhZ2UsXG4gICAgICAgIDUwMCxcbiAgICAgICAgcmVzdWx0LmVycm9yLmRldGFpbHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Y2Nlc3NSZXNwb25zZShyZXN1bHQuZGF0YSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAnSU5URVJOQUxfRVJST1InLFxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICA1MDBcbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiUE9TVCIsInZhbGlkYXRlUmVmc1NjaGVtYSIsInoiLCJvYmplY3QiLCJyZWZlcmVuY2VzIiwiYXJyYXkiLCJpZCIsInN0cmluZyIsInV1aWQiLCJ0eXBlIiwiZW51bSIsIm5hbWUiLCJvcHRpb25hbCIsInNsdWciLCJyZXF1ZXN0IiwiYXV0aFJlc3VsdCIsInZlcmlmeUF1dGgiLCJzdWNjZXNzIiwiZXJyb3JSZXNwb25zZSIsImJvZHkiLCJqc29uIiwidmFsaWRhdGlvbiIsInZhbGlkYXRlQm9keSIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJkZXRhaWxzIiwicmVzdWx0IiwidmFsaWRhdGVSZWZlcmVuY2VzIiwiZGF0YSIsInN1Y2Nlc3NSZXNwb25zZSIsIkVycm9yIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0NBTUM7Ozs7K0JBa0JxQkE7OztlQUFBQTs7O3FCQWZKOzRCQUN1RDtpQ0FDdEM7QUFFbkMsTUFBTUMscUJBQXFCQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztJQUNsQ0MsWUFBWUYsTUFBQyxDQUFDRyxLQUFLLENBQ2pCSCxNQUFDLENBQUNDLE1BQU0sQ0FBQztRQUNQRyxJQUFJSixNQUFDLENBQUNLLE1BQU0sR0FBR0MsSUFBSTtRQUNuQkMsTUFBTVAsTUFBQyxDQUFDUSxJQUFJLENBQUM7WUFBQztZQUFZO1lBQVM7WUFBaUI7U0FBVztRQUMvREMsTUFBTVQsTUFBQyxDQUFDSyxNQUFNLEdBQUdLLFFBQVE7UUFDekJDLE1BQU1YLE1BQUMsQ0FBQ0ssTUFBTSxHQUFHSyxRQUFRO0lBQzNCO0FBRUo7QUFFTyxlQUFlWixLQUFLYyxPQUFnQjtJQUN6QyxJQUFJO1FBQ0YsMkJBQTJCO1FBQzNCLE1BQU1DLGFBQWEsTUFBTUMsSUFBQUEsc0JBQVU7UUFDbkMsSUFBSSxDQUFDRCxXQUFXRSxPQUFPLEVBQUU7WUFDdkIsT0FBT0MsSUFBQUEseUJBQWEsRUFBQyxnQkFBZ0IsMkJBQTJCO1FBQ2xFO1FBRUEscUNBQXFDO1FBQ3JDLE1BQU1DLE9BQU8sTUFBTUwsUUFBUU0sSUFBSTtRQUMvQixNQUFNQyxhQUFhQyxJQUFBQSx3QkFBWSxFQUFDSCxNQUFNbEI7UUFFdEMsSUFBSSxDQUFDb0IsV0FBV0osT0FBTyxFQUFFO1lBQ3ZCLE9BQU9DLElBQUFBLHlCQUFhLEVBQ2xCRyxXQUFXRSxLQUFLLENBQUNDLElBQUksRUFDckJILFdBQVdFLEtBQUssQ0FBQ0UsT0FBTyxFQUN4QixLQUNBSixXQUFXRSxLQUFLLENBQUNHLE9BQU87UUFFNUI7UUFFQSx5QkFBeUI7UUFDekIsTUFBTUMsU0FBUyxNQUFNQyxJQUFBQSxtQ0FBa0IsRUFBQ1AsV0FBV1EsSUFBSSxDQUFDekIsVUFBVTtRQUVsRSxxQkFBcUI7UUFDckIsSUFBSSxDQUFDdUIsT0FBT1YsT0FBTyxFQUFFO1lBQ25CLE9BQU9DLElBQUFBLHlCQUFhLEVBQ2xCUyxPQUFPSixLQUFLLENBQUNDLElBQUksRUFDakJHLE9BQU9KLEtBQUssQ0FBQ0UsT0FBTyxFQUNwQixLQUNBRSxPQUFPSixLQUFLLENBQUNHLE9BQU87UUFFeEI7UUFFQSxPQUFPSSxJQUFBQSwyQkFBZSxFQUFDSCxPQUFPRSxJQUFJO0lBQ3BDLEVBQUUsT0FBT04sT0FBTztRQUNkLE9BQU9MLElBQUFBLHlCQUFhLEVBQ2xCLGtCQUNBSyxpQkFBaUJRLFFBQVFSLE1BQU1FLE9BQU8sR0FBRyxpQkFDekM7SUFFSjtBQUNGIn0=