{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/slugManagement.regression.test.ts"],"sourcesContent":["/**\n * Regression Test Suite: Slug Management\n * \n * Tests slug generation and management to prevent regressions in:\n * - Slug generation from titles\n * - Slug uniqueness enforcement\n * - Slug preservation on updates\n * - Slug-based routing\n * - URL safety\n * \n * Requirements: 24.1, 24.3, 24.7, 24.10\n * \n * Validates: Requirements 24.1, 24.2, 24.3, 24.4, 24.5, 24.6, 24.7, 24.8, 24.9, 24.10\n */\n\nimport { createMockSupabaseClient } from '@/__tests__/helpers/mockSupabase';\n\n// Mock Supabase\njest.mock('@/lib/supabase', () => ({\n  createClient: jest.fn(() => createMockSupabaseClient()),\n}));\n\ndescribe('Regression: Slug Management', () => {\n  let mockSupabase: ReturnType<typeof createMockSupabaseClient>;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockSupabase = createMockSupabaseClient();\n  });\n\n  describe('Slug Generation', () => {\n    it('should generate slug from title on creation', async () => {\n      mockSupabase.from.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'event-1',\n                title: 'Wedding Ceremony',\n                slug: 'wedding-ceremony',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Slug should be generated: \"Wedding Ceremony\" → \"wedding-ceremony\"\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should convert title to lowercase', async () => {\n      const title = 'Beach VOLLEYBALL Tournament';\n      const expectedSlug = 'beach-volleyball-tournament';\n\n      expect(expectedSlug).toBe(title.toLowerCase().replace(/\\s+/g, '-'));\n    });\n\n    it('should replace spaces with hyphens', async () => {\n      const title = 'Our Wedding Story';\n      const expectedSlug = 'our-wedding-story';\n\n      expect(expectedSlug).toBe(title.toLowerCase().replace(/\\s+/g, '-'));\n    });\n\n    it('should remove special characters', async () => {\n      const title = 'Welcome! (2024) - Our Story';\n      const expectedSlug = 'welcome-2024-our-story';\n\n      // Remove special characters: ! ( ) -\n      const slug = title\n        .toLowerCase()\n        .replace(/[^a-z0-9\\s-]/g, '')\n        .replace(/\\s+/g, '-')\n        .replace(/-+/g, '-');\n\n      expect(slug).toBe(expectedSlug);\n    });\n\n    it('should handle multiple consecutive spaces', async () => {\n      const title = 'Wedding    Ceremony    Details';\n      const expectedSlug = 'wedding-ceremony-details';\n\n      const slug = title\n        .toLowerCase()\n        .replace(/\\s+/g, '-');\n\n      expect(slug).toBe(expectedSlug);\n    });\n\n    it('should handle leading and trailing spaces', async () => {\n      const title = '  Wedding Ceremony  ';\n      const expectedSlug = 'wedding-ceremony';\n\n      const slug = title\n        .trim()\n        .toLowerCase()\n        .replace(/\\s+/g, '-');\n\n      expect(slug).toBe(expectedSlug);\n    });\n\n    it('should handle accented characters', async () => {\n      const title = 'Café Reception';\n      const expectedSlug = 'cafe-reception';\n\n      // Accented characters should be normalized\n      const slug = title\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .toLowerCase()\n        .replace(/\\s+/g, '-');\n\n      expect(slug).toBe(expectedSlug);\n    });\n\n    it('should handle empty title', async () => {\n      const title = '';\n      const expectedSlug = 'untitled';\n\n      const slug = title || 'untitled';\n\n      expect(slug).toBe(expectedSlug);\n    });\n\n    it('should truncate very long slugs', async () => {\n      const title = 'A'.repeat(200);\n      const maxLength = 100;\n\n      const slug = title\n        .toLowerCase()\n        .substring(0, maxLength);\n\n      expect(slug.length).toBeLessThanOrEqual(maxLength);\n    });\n  });\n\n  describe('Slug Uniqueness', () => {\n    it('should enforce unique slugs within entity type', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'event-1', slug: 'wedding-ceremony' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Attempting to create another event with same slug should fail\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should append numeric suffix for duplicate slugs', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'event-1', slug: 'wedding-ceremony' },\n            ],\n            error: null,\n          }),\n        }),\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'event-2',\n                title: 'Wedding Ceremony',\n                slug: 'wedding-ceremony-2',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Second event with same title should get slug: \"wedding-ceremony-2\"\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should increment suffix for multiple duplicates', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'event-1', slug: 'wedding-ceremony' },\n              { id: 'event-2', slug: 'wedding-ceremony-2' },\n              { id: 'event-3', slug: 'wedding-ceremony-3' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Next event should get slug: \"wedding-ceremony-4\"\n      const nextSuffix = 4;\n      expect(nextSuffix).toBe(4);\n    });\n\n    it('should allow same slug across different entity types', async () => {\n      // Event can have slug \"ceremony\"\n      // Activity can also have slug \"ceremony\"\n      // Content page can also have slug \"ceremony\"\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              data: [],\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Slugs are unique within entity type, not globally\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should check uniqueness before saving', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            neq: jest.fn().mockResolvedValue({\n              data: [\n                { id: 'event-2', slug: 'wedding-ceremony' },\n              ],\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Uniqueness check should exclude current entity (neq id)\n      expect(mockSupabase.from).toBeDefined();\n    });\n  });\n\n  describe('Slug Preservation', () => {\n    it('should preserve slug when updating title', async () => {\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'event-1',\n              title: 'Updated Wedding Ceremony',\n              slug: 'wedding-ceremony', // Slug unchanged\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Slug should not change when title is updated\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should allow manual slug update', async () => {\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'event-1',\n              title: 'Wedding Ceremony',\n              slug: 'ceremony', // Manually updated\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Admin can manually update slug\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should validate manual slug for URL safety', async () => {\n      const manualSlug = 'my-custom-slug!@#';\n      const isValid = /^[a-z0-9-]+$/.test(manualSlug);\n\n      expect(isValid).toBe(false);\n    });\n\n    it('should prevent changing slug to duplicate', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            neq: jest.fn().mockResolvedValue({\n              data: [\n                { id: 'event-2', slug: 'reception' },\n              ],\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Attempting to change slug to existing slug should fail\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should maintain slug history for redirects', async () => {\n      // When slug changes, old slug should redirect to new slug\n      const slugHistory = [\n        { old_slug: 'wedding-ceremony-old', new_slug: 'wedding-ceremony', created_at: '2024-01-15' },\n      ];\n\n      expect(slugHistory.length).toBe(1);\n      expect(slugHistory[0].old_slug).toBeDefined();\n      expect(slugHistory[0].new_slug).toBeDefined();\n    });\n  });\n\n  describe('Slug-Based Routing', () => {\n    it('should route to event by slug', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'event-1',\n                title: 'Wedding Ceremony',\n                slug: 'wedding-ceremony',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Route: /event/wedding-ceremony\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should route to activity by slug', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'activity-1',\n                title: 'Beach Volleyball',\n                slug: 'beach-volleyball',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Route: /activity/beach-volleyball\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should route to content page by slug', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'page-1',\n                title: 'Our Story',\n                slug: 'our-story',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Route: /content-page/our-story\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should return 404 for non-existent slug', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'No rows returned' },\n            }),\n          }),\n        }),\n      } as any);\n\n      // Should return 404 Not Found\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should redirect old slug to new slug', async () => {\n      // Old URL: /event/wedding-ceremony-old\n      // Should redirect to: /event/wedding-ceremony\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                old_slug: 'wedding-ceremony-old',\n                new_slug: 'wedding-ceremony',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Should return 301 Permanent Redirect\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should support preview mode with slug', async () => {\n      // Route: /event/wedding-ceremony?preview=true\n      const previewMode = true;\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'event-1',\n                title: 'Wedding Ceremony',\n                slug: 'wedding-ceremony',\n                status: 'draft',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Preview mode should show draft content\n      expect(previewMode).toBe(true);\n    });\n\n    it('should maintain backward compatibility with ID-based URLs', async () => {\n      // Old URL: /event/event-1\n      // Should redirect to: /event/wedding-ceremony\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'event-1',\n                slug: 'wedding-ceremony',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Should return 301 Permanent Redirect to slug-based URL\n      expect(mockSupabase.from).toBeDefined();\n    });\n  });\n\n  describe('URL Safety', () => {\n    it('should only allow lowercase letters, numbers, and hyphens', async () => {\n      const validSlug = 'wedding-ceremony-2024';\n      const isValid = /^[a-z0-9-]+$/.test(validSlug);\n\n      expect(isValid).toBe(true);\n    });\n\n    it('should reject uppercase letters', async () => {\n      const invalidSlug = 'Wedding-Ceremony';\n      const isValid = /^[a-z0-9-]+$/.test(invalidSlug);\n\n      expect(isValid).toBe(false);\n    });\n\n    it('should reject special characters', async () => {\n      const invalidSlug = 'wedding-ceremony!@#';\n      const isValid = /^[a-z0-9-]+$/.test(invalidSlug);\n\n      expect(isValid).toBe(false);\n    });\n\n    it('should reject spaces', async () => {\n      const invalidSlug = 'wedding ceremony';\n      const isValid = /^[a-z0-9-]+$/.test(invalidSlug);\n\n      expect(isValid).toBe(false);\n    });\n\n    it('should reject underscores', async () => {\n      const invalidSlug = 'wedding_ceremony';\n      const isValid = /^[a-z0-9-]+$/.test(invalidSlug);\n\n      expect(isValid).toBe(false);\n    });\n\n    it('should reject leading hyphen', async () => {\n      const invalidSlug = '-wedding-ceremony';\n      const isValid = /^[a-z0-9][a-z0-9-]*$/.test(invalidSlug);\n\n      expect(isValid).toBe(false);\n    });\n\n    it('should reject trailing hyphen', async () => {\n      const invalidSlug = 'wedding-ceremony-';\n      const isValid = /^[a-z0-9-]*[a-z0-9]$/.test(invalidSlug);\n\n      expect(isValid).toBe(false);\n    });\n\n    it('should reject consecutive hyphens', async () => {\n      const invalidSlug = 'wedding--ceremony';\n      const hasConsecutiveHyphens = /--/.test(invalidSlug);\n\n      expect(hasConsecutiveHyphens).toBe(true);\n    });\n\n    it('should be URL-encodable without changes', async () => {\n      const slug = 'wedding-ceremony-2024';\n      const encoded = encodeURIComponent(slug);\n\n      expect(encoded).toBe(slug);\n    });\n\n    it('should be safe for file systems', async () => {\n      const slug = 'wedding-ceremony-2024';\n      const unsafeChars = /[<>:\"/\\\\|?*]/;\n\n      expect(unsafeChars.test(slug)).toBe(false);\n    });\n  });\n\n  describe('Slug Validation', () => {\n    it('should validate slug length (min: 1, max: 100)', async () => {\n      const tooShort = '';\n      const tooLong = 'a'.repeat(101);\n      const valid = 'wedding-ceremony';\n\n      expect(tooShort.length).toBeLessThan(1);\n      expect(tooLong.length).toBeGreaterThan(100);\n      expect(valid.length).toBeGreaterThanOrEqual(1);\n      expect(valid.length).toBeLessThanOrEqual(100);\n    });\n\n    it('should validate slug format on creation', async () => {\n      const slug = 'wedding-ceremony';\n      const isValid = /^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$/.test(slug);\n\n      expect(isValid).toBe(true);\n    });\n\n    it('should validate slug format on update', async () => {\n      const slug = 'updated-ceremony';\n      const isValid = /^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$/.test(slug);\n\n      expect(isValid).toBe(true);\n    });\n\n    it('should return validation error for invalid slug', async () => {\n      const invalidSlug = 'Invalid Slug!';\n      const error = {\n        code: 'VALIDATION_ERROR',\n        message: 'Slug must contain only lowercase letters, numbers, and hyphens',\n      };\n\n      expect(error.code).toBe('VALIDATION_ERROR');\n      expect(error.message).toContain('lowercase letters');\n    });\n\n    it('should return validation error for duplicate slug', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            neq: jest.fn().mockResolvedValue({\n              data: [\n                { id: 'event-2', slug: 'wedding-ceremony' },\n              ],\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      const error = {\n        code: 'CONFLICT',\n        message: 'Slug already exists',\n      };\n\n      expect(error.code).toBe('CONFLICT');\n      expect(error.message).toContain('already exists');\n    });\n  });\n\n  describe('Slug Migration', () => {\n    it('should generate slugs for existing records without slugs', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          is: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'event-1', title: 'Wedding Ceremony', slug: null },\n              { id: 'event-2', title: 'Reception', slug: null },\n            ],\n            error: null,\n          }),\n        }),\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'event-1',\n              slug: 'wedding-ceremony',\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Migration should generate slugs for all records\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should handle slug conflicts during migration', async () => {\n      // Multiple records with same title should get unique slugs\n      const records = [\n        { id: 'event-1', title: 'Wedding Ceremony' },\n        { id: 'event-2', title: 'Wedding Ceremony' },\n        { id: 'event-3', title: 'Wedding Ceremony' },\n      ];\n\n      const expectedSlugs = [\n        'wedding-ceremony',\n        'wedding-ceremony-2',\n        'wedding-ceremony-3',\n      ];\n\n      expect(expectedSlugs.length).toBe(records.length);\n    });\n\n    it('should log migration progress', async () => {\n      const migrationLog = {\n        total_records: 100,\n        processed: 100,\n        successful: 98,\n        failed: 2,\n        duration_ms: 5000,\n      };\n\n      expect(migrationLog.successful).toBe(98);\n      expect(migrationLog.failed).toBe(2);\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","createMockSupabaseClient","describe","mockSupabase","beforeEach","clearAllMocks","it","from","mockReturnValue","insert","select","single","mockResolvedValue","data","id","title","slug","error","expect","toBeDefined","expectedSlug","toBe","toLowerCase","replace","trim","normalize","repeat","maxLength","substring","length","toBeLessThanOrEqual","eq","nextSuffix","neq","update","manualSlug","isValid","test","slugHistory","old_slug","new_slug","created_at","message","previewMode","status","validSlug","invalidSlug","hasConsecutiveHyphens","encoded","encodeURIComponent","unsafeChars","tooShort","tooLong","valid","toBeLessThan","toBeGreaterThan","toBeGreaterThanOrEqual","code","toContain","is","records","expectedSlugs","migrationLog","total_records","processed","successful","failed","duration_ms"],"mappings":"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"}