{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/utils/sanitization.ts"],"sourcesContent":["/**\n * Server-safe sanitization utilities\n * These use simple regex-based sanitization that works in both server and client contexts\n * For client-side components, use sanitization.client.ts which uses DOMPurify\n * \n * Requirements 19.2-19.3: Input sanitization for plain text and rich text\n */\n\n/**\n * Sanitizes plain text input by removing all HTML tags and scripts.\n * Use this for user inputs that should not contain any HTML.\n * \n * Requirement 19.2: Sanitize plain text input (remove all HTML)\n * \n * @param input - The input string to sanitize\n * @returns Sanitized string with all HTML removed\n * \n * @example\n * sanitizeInput('<script>alert(\"xss\")</script>Hello')\n * // Returns: 'Hello'\n * \n * @example\n * sanitizeInput('<p>Hello <b>World</b></p>')\n * // Returns: 'Hello World'\n */\nexport function sanitizeInput(input: string | null | undefined): string {\n  if (!input) {\n    return '';\n  }\n\n  // Remove all HTML tags\n  let sanitized = input.replace(/<[^>]*>/g, '');\n  \n  // Remove any remaining script content\n  sanitized = sanitized.replace(/javascript:/gi, '');\n  sanitized = sanitized.replace(/on\\w+\\s*=/gi, '');\n  \n  return sanitized.trim();\n}\n\n/**\n * Sanitizes rich text HTML content, allowing only safe HTML tags.\n * Use this for user inputs that should support basic formatting.\n * \n * Requirement 19.3: Sanitize rich text input (allow only safe HTML tags)\n * Allowed tags: p, br, strong, em, u, a, ul, ol, li\n * \n * @param html - The HTML string to sanitize\n * @returns Sanitized HTML with only safe tags preserved\n * \n * @example\n * sanitizeRichText('<p>Hello <script>alert(\"xss\")</script></p>')\n * // Returns: '<p>Hello </p>'\n * \n * @example\n * sanitizeRichText('<p>Hello <strong>World</strong></p>')\n * // Returns: '<p>Hello <strong>World</strong></p>'\n */\nexport function sanitizeRichText(html: string | null | undefined): string {\n  if (!html) {\n    return '';\n  }\n\n  // Remove script tags and their content\n  let sanitized = html.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '');\n  \n  // Remove event handlers\n  sanitized = sanitized.replace(/on\\w+\\s*=\\s*[\"'][^\"']*[\"']/gi, '');\n  sanitized = sanitized.replace(/on\\w+\\s*=\\s*[^\\s>]*/gi, '');\n  \n  // Remove javascript: protocol\n  sanitized = sanitized.replace(/javascript:/gi, '');\n  \n  // Remove dangerous tags (including base, form, input, video, audio, svg, img, body, marquee, details)\n  sanitized = sanitized.replace(/<(iframe|embed|object|frame|frameset|applet|meta|link|style|base|form|input|video|audio|svg|img|body|marquee|details)[^>]*>/gi, '');\n  \n  return sanitized;\n}\n\n/**\n * Sanitizes an array of strings.\n * \n * @param inputs - Array of strings to sanitize\n * @returns Array of sanitized strings\n */\nexport function sanitizeArray(inputs: string[]): string[] {\n  return inputs.map(input => sanitizeInput(input));\n}\n\n/**\n * Sanitizes an object's string properties recursively.\n * \n * @param obj - Object to sanitize\n * @returns Object with sanitized string properties\n */\nexport function sanitizeObject<T extends Record<string, unknown>>(obj: T): T {\n  const sanitized: Record<string, unknown> = {};\n\n  for (const [key, value] of Object.entries(obj)) {\n    if (typeof value === 'string') {\n      sanitized[key] = sanitizeInput(value);\n    } else if (Array.isArray(value)) {\n      sanitized[key] = value.map(item => \n        typeof item === 'string' ? sanitizeInput(item) : item\n      );\n    } else if (value && typeof value === 'object') {\n      sanitized[key] = sanitizeObject(value as Record<string, unknown>);\n    } else {\n      sanitized[key] = value;\n    }\n  }\n\n  return sanitized as T;\n}\n"],"names":["sanitizeArray","sanitizeInput","sanitizeObject","sanitizeRichText","input","sanitized","replace","trim","html","inputs","map","obj","key","value","Object","entries","Array","isArray","item"],"mappings":"AAAA;;;;;;CAMC,GAED;;;;;;;;;;;;;;;;CAgBC;;;;;;;;;;;QA6DeA;eAAAA;;QA5DAC;eAAAA;;QAsEAC;eAAAA;;QArCAC;eAAAA;;;AAjCT,SAASF,cAAcG,KAAgC;IAC5D,IAAI,CAACA,OAAO;QACV,OAAO;IACT;IAEA,uBAAuB;IACvB,IAAIC,YAAYD,MAAME,OAAO,CAAC,YAAY;IAE1C,sCAAsC;IACtCD,YAAYA,UAAUC,OAAO,CAAC,iBAAiB;IAC/CD,YAAYA,UAAUC,OAAO,CAAC,eAAe;IAE7C,OAAOD,UAAUE,IAAI;AACvB;AAoBO,SAASJ,iBAAiBK,IAA+B;IAC9D,IAAI,CAACA,MAAM;QACT,OAAO;IACT;IAEA,uCAAuC;IACvC,IAAIH,YAAYG,KAAKF,OAAO,CAAC,uDAAuD;IAEpF,wBAAwB;IACxBD,YAAYA,UAAUC,OAAO,CAAC,gCAAgC;IAC9DD,YAAYA,UAAUC,OAAO,CAAC,yBAAyB;IAEvD,8BAA8B;IAC9BD,YAAYA,UAAUC,OAAO,CAAC,iBAAiB;IAE/C,sGAAsG;IACtGD,YAAYA,UAAUC,OAAO,CAAC,iIAAiI;IAE/J,OAAOD;AACT;AAQO,SAASL,cAAcS,MAAgB;IAC5C,OAAOA,OAAOC,GAAG,CAACN,CAAAA,QAASH,cAAcG;AAC3C;AAQO,SAASF,eAAkDS,GAAM;IACtE,MAAMN,YAAqC,CAAC;IAE5C,KAAK,MAAM,CAACO,KAAKC,MAAM,IAAIC,OAAOC,OAAO,CAACJ,KAAM;QAC9C,IAAI,OAAOE,UAAU,UAAU;YAC7BR,SAAS,CAACO,IAAI,GAAGX,cAAcY;QACjC,OAAO,IAAIG,MAAMC,OAAO,CAACJ,QAAQ;YAC/BR,SAAS,CAACO,IAAI,GAAGC,MAAMH,GAAG,CAACQ,CAAAA,OACzB,OAAOA,SAAS,WAAWjB,cAAciB,QAAQA;QAErD,OAAO,IAAIL,SAAS,OAAOA,UAAU,UAAU;YAC7CR,SAAS,CAACO,IAAI,GAAGV,eAAeW;QAClC,OAAO;YACLR,SAAS,CAACO,IAAI,GAAGC;QACnB;IACF;IAEA,OAAOR;AACT"}