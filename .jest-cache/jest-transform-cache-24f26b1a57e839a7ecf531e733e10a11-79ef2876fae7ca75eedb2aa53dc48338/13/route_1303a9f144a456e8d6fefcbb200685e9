639d4122d7652ba97bce6d5aa5d20bb5
/**
 * API Routes: PUT/DELETE /api/admin/sections/:id
 * 
 * Updates or deletes a section
 * 
 * Validates: Requirements 15.3, 15.4
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get DELETE () {
        return DELETE;
    },
    get PUT () {
        return PUT;
    }
});
const _apiHelpers = require("../../../../../lib/apiHelpers");
const _sectionsService = require("../../../../../services/sectionsService");
const _cmsSchemas = require("../../../../../schemas/cmsSchemas");
async function PUT(request, { params }) {
    try {
        // 1. Verify authentication
        const authResult = await (0, _apiHelpers.verifyAuth)();
        if (!authResult.success) {
            return (0, _apiHelpers.errorResponse)('UNAUTHORIZED', 'Authentication required', 401);
        }
        // 2. Parse and validate request body
        const body = await request.json();
        console.log('[Section Update] Request body:', JSON.stringify(body, null, 2));
        const validation = (0, _apiHelpers.validateBody)(body, _cmsSchemas.updateSectionSchema);
        if (!validation.success) {
            console.error('[Section Update] Validation failed:', JSON.stringify(validation.error, null, 2));
            return (0, _apiHelpers.errorResponse)(validation.error.code, validation.error.message, 400, validation.error.details);
        }
        console.log('[Section Update] Validation passed, updating section...');
        // 3. Update section
        const resolvedParams = await params;
        const result = await (0, _sectionsService.updateSection)(resolvedParams.id, validation.data);
        // 4. Return response
        if (!result.success) {
            console.error('[Section Update] Service error:', result.error);
            const statusCode = result.error.code === 'NOT_FOUND' ? 404 : 500;
            return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, statusCode, result.error.details);
        }
        console.log('[Section Update] Success');
        return (0, _apiHelpers.successResponse)(result.data);
    } catch (error) {
        console.error('[Section Update] Unexpected error:', error);
        return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', error instanceof Error ? error.message : 'Unknown error', 500);
    }
}
async function DELETE(request, { params }) {
    try {
        // 1. Verify authentication
        const authResult = await (0, _apiHelpers.verifyAuth)();
        if (!authResult.success) {
            return (0, _apiHelpers.errorResponse)('UNAUTHORIZED', 'Authentication required', 401);
        }
        // 2. Resolve params and delete section
        const resolvedParams = await params;
        const result = await (0, _sectionsService.deleteSection)(resolvedParams.id);
        // 3. Return response
        if (!result.success) {
            return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, 500, result.error.details);
        }
        return (0, _apiHelpers.successResponse)({
            message: 'Section deleted successfully'
        });
    } catch (error) {
        return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', error instanceof Error ? error.message : 'Unknown error', 500);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9zZWN0aW9ucy9baWRdL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQVBJIFJvdXRlczogUFVUL0RFTEVURSAvYXBpL2FkbWluL3NlY3Rpb25zLzppZFxuICogXG4gKiBVcGRhdGVzIG9yIGRlbGV0ZXMgYSBzZWN0aW9uXG4gKiBcbiAqIFZhbGlkYXRlczogUmVxdWlyZW1lbnRzIDE1LjMsIDE1LjRcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB2ZXJpZnlBdXRoLCBlcnJvclJlc3BvbnNlLCBzdWNjZXNzUmVzcG9uc2UsIHZhbGlkYXRlQm9keSB9IGZyb20gJ0AvbGliL2FwaUhlbHBlcnMnO1xuaW1wb3J0IHsgdXBkYXRlU2VjdGlvbiwgZGVsZXRlU2VjdGlvbiB9IGZyb20gJ0Avc2VydmljZXMvc2VjdGlvbnNTZXJ2aWNlJztcbmltcG9ydCB7IHVwZGF0ZVNlY3Rpb25TY2hlbWEgfSBmcm9tICdAL3NjaGVtYXMvY21zU2NoZW1hcyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQVVQoXG4gIHJlcXVlc3Q6IFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiBQcm9taXNlPHsgaWQ6IHN0cmluZyB9PiB9XG4pIHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWZXJpZnkgYXV0aGVudGljYXRpb25cbiAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgdmVyaWZ5QXV0aCgpO1xuICAgIGlmICghYXV0aFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZSgnVU5BVVRIT1JJWkVEJywgJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJywgNDAxKTtcbiAgICB9XG5cbiAgICAvLyAyLiBQYXJzZSBhbmQgdmFsaWRhdGUgcmVxdWVzdCBib2R5XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnNvbGUubG9nKCdbU2VjdGlvbiBVcGRhdGVdIFJlcXVlc3QgYm9keTonLCBKU09OLnN0cmluZ2lmeShib2R5LCBudWxsLCAyKSk7XG4gICAgXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlQm9keShib2R5LCB1cGRhdGVTZWN0aW9uU2NoZW1hKTtcblxuICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU2VjdGlvbiBVcGRhdGVdIFZhbGlkYXRpb24gZmFpbGVkOicsIEpTT04uc3RyaW5naWZ5KHZhbGlkYXRpb24uZXJyb3IsIG51bGwsIDIpKTtcbiAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICB2YWxpZGF0aW9uLmVycm9yLmNvZGUsXG4gICAgICAgIHZhbGlkYXRpb24uZXJyb3IubWVzc2FnZSxcbiAgICAgICAgNDAwLFxuICAgICAgICB2YWxpZGF0aW9uLmVycm9yLmRldGFpbHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tTZWN0aW9uIFVwZGF0ZV0gVmFsaWRhdGlvbiBwYXNzZWQsIHVwZGF0aW5nIHNlY3Rpb24uLi4nKTtcblxuICAgIC8vIDMuIFVwZGF0ZSBzZWN0aW9uXG4gICAgY29uc3QgcmVzb2x2ZWRQYXJhbXMgPSBhd2FpdCBwYXJhbXM7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVTZWN0aW9uKHJlc29sdmVkUGFyYW1zLmlkLCB2YWxpZGF0aW9uLmRhdGEpO1xuXG4gICAgLy8gNC4gUmV0dXJuIHJlc3BvbnNlXG4gICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgY29uc29sZS5lcnJvcignW1NlY3Rpb24gVXBkYXRlXSBTZXJ2aWNlIGVycm9yOicsIHJlc3VsdC5lcnJvcik7XG4gICAgICBjb25zdCBzdGF0dXNDb2RlID0gcmVzdWx0LmVycm9yLmNvZGUgPT09ICdOT1RfRk9VTkQnID8gNDA0IDogNTAwO1xuICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgIHJlc3VsdC5lcnJvci5jb2RlLFxuICAgICAgICByZXN1bHQuZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhdHVzQ29kZSxcbiAgICAgICAgcmVzdWx0LmVycm9yLmRldGFpbHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tTZWN0aW9uIFVwZGF0ZV0gU3VjY2VzcycpO1xuICAgIHJldHVybiBzdWNjZXNzUmVzcG9uc2UocmVzdWx0LmRhdGEpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTZWN0aW9uIFVwZGF0ZV0gVW5leHBlY3RlZCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAnSU5URVJOQUxfRVJST1InLFxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICA1MDBcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUoXG4gIHJlcXVlc3Q6IFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiBQcm9taXNlPHsgaWQ6IHN0cmluZyB9PiB9XG4pIHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWZXJpZnkgYXV0aGVudGljYXRpb25cbiAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgdmVyaWZ5QXV0aCgpO1xuICAgIGlmICghYXV0aFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZSgnVU5BVVRIT1JJWkVEJywgJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJywgNDAxKTtcbiAgICB9XG5cbiAgICAvLyAyLiBSZXNvbHZlIHBhcmFtcyBhbmQgZGVsZXRlIHNlY3Rpb25cbiAgICBjb25zdCByZXNvbHZlZFBhcmFtcyA9IGF3YWl0IHBhcmFtcztcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWxldGVTZWN0aW9uKHJlc29sdmVkUGFyYW1zLmlkKTtcblxuICAgIC8vIDMuIFJldHVybiByZXNwb25zZVxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICByZXN1bHQuZXJyb3IuY29kZSxcbiAgICAgICAgcmVzdWx0LmVycm9yLm1lc3NhZ2UsXG4gICAgICAgIDUwMCxcbiAgICAgICAgcmVzdWx0LmVycm9yLmRldGFpbHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Y2Nlc3NSZXNwb25zZSh7IG1lc3NhZ2U6ICdTZWN0aW9uIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICdJTlRFUk5BTF9FUlJPUicsXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIDUwMFxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJERUxFVEUiLCJQVVQiLCJyZXF1ZXN0IiwicGFyYW1zIiwiYXV0aFJlc3VsdCIsInZlcmlmeUF1dGgiLCJzdWNjZXNzIiwiZXJyb3JSZXNwb25zZSIsImJvZHkiLCJqc29uIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ2YWxpZGF0aW9uIiwidmFsaWRhdGVCb2R5IiwidXBkYXRlU2VjdGlvblNjaGVtYSIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJkZXRhaWxzIiwicmVzb2x2ZWRQYXJhbXMiLCJyZXN1bHQiLCJ1cGRhdGVTZWN0aW9uIiwiaWQiLCJkYXRhIiwic3RhdHVzQ29kZSIsInN1Y2Nlc3NSZXNwb25zZSIsIkVycm9yIiwiZGVsZXRlU2VjdGlvbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztDQU1DOzs7Ozs7Ozs7OztRQWlFcUJBO2VBQUFBOztR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