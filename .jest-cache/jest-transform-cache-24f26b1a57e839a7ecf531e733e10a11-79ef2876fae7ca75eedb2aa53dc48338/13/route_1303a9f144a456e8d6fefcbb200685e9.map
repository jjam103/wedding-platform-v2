{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/sections/[id]/route.ts"],"sourcesContent":["/**\n * API Routes: PUT/DELETE /api/admin/sections/:id\n * \n * Updates or deletes a section\n * \n * Validates: Requirements 15.3, 15.4\n */\n\nimport { NextResponse } from 'next/server';\nimport { verifyAuth, errorResponse, successResponse, validateBody } from '@/lib/apiHelpers';\nimport { updateSection, deleteSection } from '@/services/sectionsService';\nimport { updateSectionSchema } from '@/schemas/cmsSchemas';\n\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Verify authentication\n    const authResult = await verifyAuth();\n    if (!authResult.success) {\n      return errorResponse('UNAUTHORIZED', 'Authentication required', 401);\n    }\n\n    // 2. Parse and validate request body\n    const body = await request.json();\n    console.log('[Section Update] Request body:', JSON.stringify(body, null, 2));\n    \n    const validation = validateBody(body, updateSectionSchema);\n\n    if (!validation.success) {\n      console.error('[Section Update] Validation failed:', JSON.stringify(validation.error, null, 2));\n      return errorResponse(\n        validation.error.code,\n        validation.error.message,\n        400,\n        validation.error.details\n      );\n    }\n\n    console.log('[Section Update] Validation passed, updating section...');\n\n    // 3. Update section\n    const resolvedParams = await params;\n\n    const result = await updateSection(resolvedParams.id, validation.data);\n\n    // 4. Return response\n    if (!result.success) {\n      console.error('[Section Update] Service error:', result.error);\n      const statusCode = result.error.code === 'NOT_FOUND' ? 404 : 500;\n      return errorResponse(\n        result.error.code,\n        result.error.message,\n        statusCode,\n        result.error.details\n      );\n    }\n\n    console.log('[Section Update] Success');\n    return successResponse(result.data);\n  } catch (error) {\n    console.error('[Section Update] Unexpected error:', error);\n    return errorResponse(\n      'INTERNAL_ERROR',\n      error instanceof Error ? error.message : 'Unknown error',\n      500\n    );\n  }\n}\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Verify authentication\n    const authResult = await verifyAuth();\n    if (!authResult.success) {\n      return errorResponse('UNAUTHORIZED', 'Authentication required', 401);\n    }\n\n    // 2. Resolve params and delete section\n    const resolvedParams = await params;\n    const result = await deleteSection(resolvedParams.id);\n\n    // 3. Return response\n    if (!result.success) {\n      return errorResponse(\n        result.error.code,\n        result.error.message,\n        500,\n        result.error.details\n      );\n    }\n\n    return successResponse({ message: 'Section deleted successfully' });\n  } catch (error) {\n    return errorResponse(\n      'INTERNAL_ERROR',\n      error instanceof Error ? error.message : 'Unknown error',\n      500\n    );\n  }\n}\n"],"names":["DELETE","PUT","request","params","authResult","verifyAuth","success","errorResponse","body","json","console","log","JSON","stringify","validation","validateBody","updateSectionSchema","error","code","message","details","resolvedParams","result","updateSection","id","data","statusCode","successResponse","Error","deleteSection"],"mappings":"AAAA;;;;;;CAMC;;;;;;;;;;;QAiEqBA;eAAAA;;QA1DAC;eAAAA;;;4BAJmD;iCAC5B;4BACT;AAE7B,eAAeA,IACpBC,OAAgB,EAChB,EAAEC,MAAM,EAAuC;IAE/C,IAAI;QACF,2BAA2B;QAC3B,MAAMC,aAAa,MAAMC,IAAAA,sBAAU;QACnC,IAAI,CAACD,WAAWE,OAAO,EAAE;YACvB,OAAOC,IAAAA,yBAAa,EAAC,gBAAgB,2BAA2B;QAClE;QAEA,qCAAqC;QACrC,MAAMC,OAAO,MAAMN,QAAQO,IAAI;QAC/BC,QAAQC,GAAG,CAAC,kCAAkCC,KAAKC,SAAS,CAACL,MAAM,MAAM;QAEzE,MAAMM,aAAaC,IAAAA,wBAAY,EAACP,MAAMQ,+BAAmB;QAEzD,IAAI,CAACF,WAAWR,OAAO,EAAE;YACvBI,QAAQO,KAAK,CAAC,uCAAuCL,KAAKC,SAAS,CAACC,WAAWG,KAAK,EAAE,MAAM;YAC5F,OAAOV,IAAAA,yBAAa,EAClBO,WAAWG,KAAK,CAACC,IAAI,EACrBJ,WAAWG,KAAK,CAACE,OAAO,EACxB,KACAL,WAAWG,KAAK,CAACG,OAAO;QAE5B;QAEAV,QAAQC,GAAG,CAAC;QAEZ,oBAAoB;QACpB,MAAMU,iBAAiB,MAAMlB;QAE7B,MAAMmB,SAAS,MAAMC,IAAAA,8BAAa,EAACF,eAAeG,EAAE,EAAEV,WAAWW,IAAI;QAErE,qBAAqB;QACrB,IAAI,CAACH,OAAOhB,OAAO,EAAE;YACnBI,QAAQO,KAAK,CAAC,mCAAmCK,OAAOL,KAAK;YAC7D,MAAMS,aAAaJ,OAAOL,KAAK,CAACC,IAAI,KAAK,cAAc,MAAM;YAC7D,OAAOX,IAAAA,yBAAa,EAClBe,OAAOL,KAAK,CAACC,IAAI,EACjBI,OAAOL,KAAK,CAACE,OAAO,EACpBO,YACAJ,OAAOL,KAAK,CAACG,OAAO;QAExB;QAEAV,QAAQC,GAAG,CAAC;QACZ,OAAOgB,IAAAA,2BAAe,EAACL,OAAOG,IAAI;IACpC,EAAE,OAAOR,OAAO;QACdP,QAAQO,KAAK,CAAC,sCAAsCA;QACpD,OAAOV,IAAAA,yBAAa,EAClB,kBACAU,iBAAiBW,QAAQX,MAAME,OAAO,GAAG,iBACzC;IAEJ;AACF;AAEO,eAAenB,OACpBE,OAAgB,EAChB,EAAEC,MAAM,EAAuC;IAE/C,IAAI;QACF,2BAA2B;QAC3B,MAAMC,aAAa,MAAMC,IAAAA,sBAAU;QACnC,IAAI,CAACD,WAAWE,OAAO,EAAE;YACvB,OAAOC,IAAAA,yBAAa,EAAC,gBAAgB,2BAA2B;QAClE;QAEA,uCAAuC;QACvC,MAAMc,iBAAiB,MAAMlB;QAC7B,MAAMmB,SAAS,MAAMO,IAAAA,8BAAa,EAACR,eAAeG,EAAE;QAEpD,qBAAqB;QACrB,IAAI,CAACF,OAAOhB,OAAO,EAAE;YACnB,OAAOC,IAAAA,yBAAa,EAClBe,OAAOL,KAAK,CAACC,IAAI,EACjBI,OAAOL,KAAK,CAACE,OAAO,EACpB,KACAG,OAAOL,KAAK,CAACG,OAAO;QAExB;QAEA,OAAOO,IAAAA,2BAAe,EAAC;YAAER,SAAS;QAA+B;IACnE,EAAE,OAAOF,OAAO;QACd,OAAOV,IAAAA,yBAAa,EAClB,kBACAU,iBAAiBW,QAAQX,MAAME,OAAO,GAAG,iBACzC;IAEJ;AACF"}