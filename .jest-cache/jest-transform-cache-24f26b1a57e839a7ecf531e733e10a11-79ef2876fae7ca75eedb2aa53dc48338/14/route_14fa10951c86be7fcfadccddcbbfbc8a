a2288132120354fa460f650d702c7a39
/**
 * API Routes: PUT/DELETE /api/admin/sections/:id
 * 
 * Updates or deletes a section
 * 
 * Validates: Requirements 15.3, 15.4
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get DELETE () {
        return DELETE;
    },
    get PUT () {
        return PUT;
    }
});
const _apiHelpers = require("../../../../../lib/apiHelpers");
const _sectionsService = require("../../../../../services/sectionsService");
const _cmsSchemas = require("../../../../../schemas/cmsSchemas");
async function PUT(request, { params }) {
    try {
        // 1. Verify authentication
        const authResult = await (0, _apiHelpers.verifyAuth)();
        if (!authResult.success) {
            return (0, _apiHelpers.errorResponse)('UNAUTHORIZED', 'Authentication required', 401);
        }
        // 2. Parse and validate request body
        const body = await request.json();
        const validation = (0, _apiHelpers.validateBody)(body, _cmsSchemas.updateSectionSchema);
        if (!validation.success) {
            return (0, _apiHelpers.errorResponse)(validation.error.code, validation.error.message, 400, validation.error.details);
        }
        // 3. Update section
        const resolvedParams = await params;
        const result = await (0, _sectionsService.updateSection)(resolvedParams.id, validation.data);
        // 4. Return response
        if (!result.success) {
            const statusCode = result.error.code === 'NOT_FOUND' ? 404 : 500;
            return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, statusCode, result.error.details);
        }
        return (0, _apiHelpers.successResponse)(result.data);
    } catch (error) {
        return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', error instanceof Error ? error.message : 'Unknown error', 500);
    }
}
async function DELETE(request, { params }) {
    try {
        // 1. Verify authentication
        const authResult = await (0, _apiHelpers.verifyAuth)();
        if (!authResult.success) {
            return (0, _apiHelpers.errorResponse)('UNAUTHORIZED', 'Authentication required', 401);
        }
        // 2. Resolve params and delete section
        const resolvedParams = await params;
        const result = await (0, _sectionsService.deleteSection)(resolvedParams.id);
        // 3. Return response
        if (!result.success) {
            return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, 500, result.error.details);
        }
        return (0, _apiHelpers.successResponse)({
            message: 'Section deleted successfully'
        });
    } catch (error) {
        return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', error instanceof Error ? error.message : 'Unknown error', 500);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9zZWN0aW9ucy9baWRdL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQVBJIFJvdXRlczogUFVUL0RFTEVURSAvYXBpL2FkbWluL3NlY3Rpb25zLzppZFxuICogXG4gKiBVcGRhdGVzIG9yIGRlbGV0ZXMgYSBzZWN0aW9uXG4gKiBcbiAqIFZhbGlkYXRlczogUmVxdWlyZW1lbnRzIDE1LjMsIDE1LjRcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB2ZXJpZnlBdXRoLCBlcnJvclJlc3BvbnNlLCBzdWNjZXNzUmVzcG9uc2UsIHZhbGlkYXRlQm9keSB9IGZyb20gJ0AvbGliL2FwaUhlbHBlcnMnO1xuaW1wb3J0IHsgdXBkYXRlU2VjdGlvbiwgZGVsZXRlU2VjdGlvbiB9IGZyb20gJ0Avc2VydmljZXMvc2VjdGlvbnNTZXJ2aWNlJztcbmltcG9ydCB7IHVwZGF0ZVNlY3Rpb25TY2hlbWEgfSBmcm9tICdAL3NjaGVtYXMvY21zU2NoZW1hcyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQVVQoXG4gIHJlcXVlc3Q6IFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiBQcm9taXNlPHsgaWQ6IHN0cmluZyB9PiB9XG4pIHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWZXJpZnkgYXV0aGVudGljYXRpb25cbiAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgdmVyaWZ5QXV0aCgpO1xuICAgIGlmICghYXV0aFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZSgnVU5BVVRIT1JJWkVEJywgJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJywgNDAxKTtcbiAgICB9XG5cbiAgICAvLyAyLiBQYXJzZSBhbmQgdmFsaWRhdGUgcmVxdWVzdCBib2R5XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZUJvZHkoYm9keSwgdXBkYXRlU2VjdGlvblNjaGVtYSk7XG5cbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgIHZhbGlkYXRpb24uZXJyb3IuY29kZSxcbiAgICAgICAgdmFsaWRhdGlvbi5lcnJvci5tZXNzYWdlLFxuICAgICAgICA0MDAsXG4gICAgICAgIHZhbGlkYXRpb24uZXJyb3IuZGV0YWlsc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyAzLiBVcGRhdGUgc2VjdGlvblxuICAgIGNvbnN0IHJlc29sdmVkUGFyYW1zID0gYXdhaXQgcGFyYW1zO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXBkYXRlU2VjdGlvbihyZXNvbHZlZFBhcmFtcy5pZCwgdmFsaWRhdGlvbi5kYXRhKTtcblxuICAgIC8vIDQuIFJldHVybiByZXNwb25zZVxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIGNvbnN0IHN0YXR1c0NvZGUgPSByZXN1bHQuZXJyb3IuY29kZSA9PT0gJ05PVF9GT1VORCcgPyA0MDQgOiA1MDA7XG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICAgcmVzdWx0LmVycm9yLmNvZGUsXG4gICAgICAgIHJlc3VsdC5lcnJvci5tZXNzYWdlLFxuICAgICAgICBzdGF0dXNDb2RlLFxuICAgICAgICByZXN1bHQuZXJyb3IuZGV0YWlsc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VjY2Vzc1Jlc3BvbnNlKHJlc3VsdC5kYXRhKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICdJTlRFUk5BTF9FUlJPUicsXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIDUwMFxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIERFTEVURShcbiAgcmVxdWVzdDogUmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH1cbikge1xuICB0cnkge1xuICAgIC8vIDEuIFZlcmlmeSBhdXRoZW50aWNhdGlvblxuICAgIGNvbnN0IGF1dGhSZXN1bHQgPSBhd2FpdCB2ZXJpZnlBdXRoKCk7XG4gICAgaWYgKCFhdXRoUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKCdVTkFVVEhPUklaRUQnLCAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLCA0MDEpO1xuICAgIH1cblxuICAgIC8vIDIuIFJlc29sdmUgcGFyYW1zIGFuZCBkZWxldGUgc2VjdGlvblxuICAgIGNvbnN0IHJlc29sdmVkUGFyYW1zID0gYXdhaXQgcGFyYW1zO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRlbGV0ZVNlY3Rpb24ocmVzb2x2ZWRQYXJhbXMuaWQpO1xuXG4gICAgLy8gMy4gUmV0dXJuIHJlc3BvbnNlXG4gICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgIHJlc3VsdC5lcnJvci5jb2RlLFxuICAgICAgICByZXN1bHQuZXJyb3IubWVzc2FnZSxcbiAgICAgICAgNTAwLFxuICAgICAgICByZXN1bHQuZXJyb3IuZGV0YWlsc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VjY2Vzc1Jlc3BvbnNlKHsgbWVzc2FnZTogJ1NlY3Rpb24gZGVsZXRlZCBzdWNjZXNzZnVsbHknIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgJ0lOVEVSTkFMX0VSUk9SJyxcbiAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgNTAwXG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkRFTEVURSIsIlBVVCIsInJlcXVlc3QiLCJwYXJhbXMiLCJhdXRoUmVzdWx0IiwidmVyaWZ5QXV0aCIsInN1Y2Nlc3MiLCJlcnJvclJlc3BvbnNlIiwiYm9keSIsImpzb24iLCJ2YWxpZGF0aW9uIiwidmFsaWRhdGVCb2R5IiwidXBkYXRlU2VjdGlvblNjaGVtYSIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJkZXRhaWxzIiwicmVzb2x2ZWRQYXJhbXMiLCJyZXN1bHQiLCJ1cGRhdGVTZWN0aW9uIiwiaWQiLCJkYXRhIiwic3RhdHVzQ29kZSIsInN1Y2Nlc3NSZXNwb25zZSIsIkVycm9yIiwiZGVsZXRlU2VjdGlvbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztDQU1DOzs7Ozs7Ozs7OztRQXlEcUJBO2VBQUFBOztRQWxEQUM7ZUFBQUE7Ozs0QkFKbUQ7aUNBQzVCOzRCQUNUO0FBRTdCLGVBQWVBLElBQ3BCQyxPQUFnQixFQUNoQixFQUFFQyxNQUFNLEVBQXVDO0lBRS9DLElBQUk7UUFDRiwyQkFBMkI7UUFDM0IsTUFBTUMsYUFBYSxNQUFNQyxJQUFBQSxzQkFBVTtRQUNuQyxJQUFJLENBQUNELFdBQVdFLE9BQU8sRUFBRTtZQUN2QixPQUFPQyxJQUFBQSx5QkFBYSxFQUFDLGdCQUFnQiwyQkFBMkI7UUFDbEU7UUFFQSxxQ0FBcUM7UUFDckMsTUFBTUMsT0FBTyxNQUFNTixRQUFRTyxJQUFJO1FBQy9CLE1BQU1DLGFBQWFDLElBQUFBLHdCQUFZLEVBQUNILE1BQU1JLCtCQUFtQjtRQUV6RCxJQUFJLENBQUNGLFdBQVdKLE9BQU8sRUFBRTtZQUN2QixPQUFPQyxJQUFBQSx5QkFBYSxFQUNsQkcsV0FBV0csS0FBSyxDQUFDQyxJQUFJLEVBQ3JCSixXQUFXRyxLQUFLLENBQUNFLE9BQU8sRUFDeEIsS0FDQUwsV0FBV0csS0FBSyxDQUFDRyxPQUFPO1FBRTVCO1FBRUEsb0JBQW9CO1FBQ3BCLE1BQU1DLGlCQUFpQixNQUFNZDtRQUU3QixNQUFNZSxTQUFTLE1BQU1DLElBQUFBLDhCQUFhLEVBQUNGLGVBQWVHLEVBQUUsRUFBRVYsV0FBV1csSUFBSTtRQUVyRSxxQkFBcUI7UUFDckIsSUFBSSxDQUFDSCxPQUFPWixPQUFPLEVBQUU7WUFDbkIsTUFBTWdCLGFBQWFKLE9BQU9MLEtBQUssQ0FBQ0MsSUFBSSxLQUFLLGNBQWMsTUFBTTtZQUM3RCxPQUFPUCxJQUFBQSx5QkFBYSxFQUNsQlcsT0FBT0wsS0FBSyxDQUFDQyxJQUFJLEVBQ2pCSSxPQUFPTCxLQUFLLENBQUNFLE9BQU8sRUFDcEJPLFlBQ0FKLE9BQU9MLEtBQUssQ0FBQ0csT0FBTztRQUV4QjtRQUVBLE9BQU9PLElBQUFBLDJCQUFlLEVBQUNMLE9BQU9HLElBQUk7SUFDcEMsRUFBRSxPQUFPUixPQUFPO1FBQ2QsT0FBT04sSUFBQUEseUJBQWEsRUFDbEIsa0JBQ0FNLGlCQUFpQlcsUUFBUVgsTUFBTUUsT0FBTyxHQUFHLGlCQUN6QztJQUVKO0FBQ0Y7QUFFTyxlQUFlZixPQUNwQkUsT0FBZ0IsRUFDaEIsRUFBRUMsTUFBTSxFQUF1QztJQUUvQyxJQUFJO1FBQ0YsMkJBQTJCO1FBQzNCLE1BQU1DLGFBQWEsTUFBTUMsSUFBQUEsc0JBQVU7UUFDbkMsSUFBSSxDQUFDRCxXQUFXRSxPQUFPLEVBQUU7WUFDdkIsT0FBT0MsSUFBQUEseUJBQWEsRUFBQyxnQkFBZ0IsMkJBQTJCO1FBQ2xFO1FBRUEsdUNBQXVDO1FBQ3ZDLE1BQU1VLGlCQUFpQixNQUFNZDtRQUM3QixNQUFNZSxTQUFTLE1BQU1PLElBQUFBLDhCQUFhLEVBQUNSLGVBQWVHLEVBQUU7UUFFcEQscUJBQXFCO1FBQ3JCLElBQUksQ0FBQ0YsT0FBT1osT0FBTyxFQUFFO1lBQ25CLE9BQU9DLElBQUFBLHlCQUFhLEVBQ2xCVyxPQUFPTCxLQUFLLENBQUNDLElBQUksRUFDakJJLE9BQU9MLEtBQUssQ0FBQ0UsT0FBTyxFQUNwQixLQUNBRyxPQUFPTCxLQUFLLENBQUNHLE9BQU87UUFFeEI7UUFFQSxPQUFPTyxJQUFBQSwyQkFBZSxFQUFDO1lBQUVSLFNBQVM7UUFBK0I7SUFDbkUsRUFBRSxPQUFPRixPQUFPO1FBQ2QsT0FBT04sSUFBQUEseUJBQWEsRUFDbEIsa0JBQ0FNLGlCQUFpQlcsUUFBUVgsTUFBTUUsT0FBTyxHQUFHLGlCQUN6QztJQUVKO0FBQ0YifQ==