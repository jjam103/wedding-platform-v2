026bc3e6d12f84af40d51c1f7d0f06fe
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get calculateNetCost () {
        return calculateNetCost;
    },
    get create () {
        return create;
    },
    get deleteActivity () {
        return deleteActivity;
    },
    get get () {
        return get;
    },
    get getCapacityInfo () {
        return getCapacityInfo;
    },
    get list () {
        return list;
    },
    get search () {
        return search;
    },
    get update () {
        return update;
    }
});
const _supabasejs = require("@supabase/supabase-js");
const _sanitization = require("../utils/sanitization");
const _activitySchemas = require("../schemas/activitySchemas");
/**
 * Converts camelCase to snake_case for database columns.
 */ function toSnakeCase(obj) {
    const snakeObj = {};
    for(const key in obj){
        const snakeKey = key.replace(/[A-Z]/g, (letter)=>`_${letter.toLowerCase()}`);
        snakeObj[snakeKey] = obj[key];
    }
    return snakeObj;
}
/**
 * Converts snake_case to camelCase for TypeScript objects.
 */ function toCamelCase(obj) {
    const camelObj = {};
    for(const key in obj){
        const camelKey = key.replace(/_([a-z])/g, (_, letter)=>letter.toUpperCase());
        camelObj[camelKey] = obj[key];
    }
    return camelObj;
}
async function create(data) {
    try {
        // 1. Validate
        const validation = _activitySchemas.createActivitySchema.safeParse(data);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        // 2. Sanitize user input
        const sanitized = {
            ...validation.data,
            name: (0, _sanitization.sanitizeInput)(validation.data.name),
            description: validation.data.description ? (0, _sanitization.sanitizeRichText)(validation.data.description) : null,
            activityType: (0, _sanitization.sanitizeInput)(validation.data.activityType)
        };
        // 3. Database operation
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        const dbData = toSnakeCase(sanitized);
        const { data: result, error } = await supabase.from('activities').insert(dbData).select().single();
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: toCamelCase(result)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function get(id) {
    try {
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        const { data, error } = await supabase.from('activities').select('*').eq('id', id).single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Activity not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: toCamelCase(data)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function update(id, data) {
    try {
        // 1. Validate
        const validation = _activitySchemas.updateActivitySchema.safeParse(data);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        // 2. Sanitize user input
        const sanitized = {
            ...validation.data
        };
        if (sanitized.name) {
            sanitized.name = (0, _sanitization.sanitizeInput)(sanitized.name);
        }
        if (sanitized.description) {
            sanitized.description = (0, _sanitization.sanitizeRichText)(sanitized.description);
        }
        if (sanitized.activityType) {
            sanitized.activityType = (0, _sanitization.sanitizeInput)(sanitized.activityType);
        }
        // 3. Database operation
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        const dbData = toSnakeCase(sanitized);
        const { data: result, error } = await supabase.from('activities').update(dbData).eq('id', id).select().single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Activity not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: toCamelCase(result)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function deleteActivity(id) {
    try {
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        const { error } = await supabase.from('activities').delete().eq('id', id);
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: undefined
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function list(filters = {}) {
    try {
        // 1. Validate
        const validation = _activitySchemas.activityFilterSchema.safeParse(filters);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        const { page = 1, pageSize = 50, ...filterParams } = validation.data;
        const from = (page - 1) * pageSize;
        const to = from + pageSize - 1;
        // 2. Database operation
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        let query = supabase.from('activities').select('*', {
            count: 'exact'
        });
        // Apply filters
        if (filterParams.eventId !== undefined) {
            if (filterParams.eventId === null) {
                query = query.is('event_id', null);
            } else {
                query = query.eq('event_id', filterParams.eventId);
            }
        }
        if (filterParams.activityType) {
            query = query.eq('activity_type', filterParams.activityType);
        }
        if (filterParams.status) {
            query = query.eq('status', filterParams.status);
        }
        if (filterParams.locationId) {
            query = query.eq('location_id', filterParams.locationId);
        }
        if (filterParams.adultsOnly !== undefined) {
            query = query.eq('adults_only', filterParams.adultsOnly);
        }
        if (filterParams.startTimeFrom) {
            query = query.gte('start_time', filterParams.startTimeFrom);
        }
        if (filterParams.startTimeTo) {
            query = query.lte('start_time', filterParams.startTimeTo);
        }
        // Apply pagination and ordering
        query = query.order('start_time', {
            ascending: true
        }).range(from, to);
        const { data, error, count } = await query;
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        const activities = data.map((activity)=>toCamelCase(activity));
        const total = count || 0;
        const totalPages = Math.ceil(total / pageSize);
        return {
            success: true,
            data: {
                activities,
                total,
                page,
                pageSize,
                totalPages
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function search(searchParams) {
    try {
        // 1. Validate
        const validation = _activitySchemas.activitySearchSchema.safeParse(searchParams);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        const { query, page = 1, pageSize = 50 } = validation.data;
        const from = (page - 1) * pageSize;
        const to = from + pageSize - 1;
        // 2. Sanitize search query
        const sanitizedQuery = (0, _sanitization.sanitizeInput)(query);
        // 3. Database operation
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        const { data, error, count } = await supabase.from('activities').select('*', {
            count: 'exact'
        }).or(`name.ilike.%${sanitizedQuery}%,description.ilike.%${sanitizedQuery}%`).order('start_time', {
            ascending: true
        }).range(from, to);
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        const activities = data.map((activity)=>toCamelCase(activity));
        const total = count || 0;
        const totalPages = Math.ceil(total / pageSize);
        return {
            success: true,
            data: {
                activities,
                total,
                page,
                pageSize,
                totalPages
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function getCapacityInfo(activityId) {
    try {
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        // Get activity details
        const { data: activity, error: activityError } = await supabase.from('activities').select('id, name, capacity').eq('id', activityId).single();
        if (activityError) {
            if (activityError.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Activity not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: activityError.message,
                    details: activityError
                }
            };
        }
        // Count attending RSVPs
        const { count, error: countError } = await supabase.from('rsvps').select('*', {
            count: 'exact',
            head: true
        }).eq('activity_id', activityId).eq('status', 'attending');
        if (countError) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: countError.message,
                    details: countError
                }
            };
        }
        const currentAttendees = count || 0;
        const capacity = activity.capacity;
        const availableSpots = capacity !== null ? capacity - currentAttendees : null;
        const utilizationPercentage = capacity !== null ? currentAttendees / capacity * 100 : null;
        const isNearCapacity = utilizationPercentage !== null && utilizationPercentage >= 90;
        const isAtCapacity = utilizationPercentage !== null && utilizationPercentage >= 100;
        return {
            success: true,
            data: {
                activityId: activity.id,
                activityName: activity.name,
                capacity,
                currentAttendees,
                availableSpots,
                utilizationPercentage,
                isNearCapacity,
                isAtCapacity
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function calculateNetCost(activityId) {
    try {
        const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
        const { data: activity, error } = await supabase.from('activities').select('cost_per_person, host_subsidy').eq('id', activityId).single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Activity not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        const costPerPerson = activity.cost_per_person || 0;
        const hostSubsidy = activity.host_subsidy || 0;
        const netCost = Math.max(0, costPerPerson - hostSubsidy);
        return {
            success: true,
            data: netCost
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvYWN0aXZpdHlTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyBzYW5pdGl6ZUlucHV0LCBzYW5pdGl6ZVJpY2hUZXh0IH0gZnJvbSBcIi4uL3V0aWxzL3Nhbml0aXphdGlvblwiO1xuaW1wb3J0IHtcbiAgY3JlYXRlQWN0aXZpdHlTY2hlbWEsXG4gIHVwZGF0ZUFjdGl2aXR5U2NoZW1hLFxuICBhY3Rpdml0eUZpbHRlclNjaGVtYSxcbiAgYWN0aXZpdHlTZWFyY2hTY2hlbWEsXG4gIHR5cGUgQ3JlYXRlQWN0aXZpdHlEVE8sXG4gIHR5cGUgVXBkYXRlQWN0aXZpdHlEVE8sXG4gIHR5cGUgQWN0aXZpdHlGaWx0ZXJEVE8sXG4gIHR5cGUgQWN0aXZpdHlTZWFyY2hEVE8sXG4gIHR5cGUgQWN0aXZpdHksXG4gIHR5cGUgUGFnaW5hdGVkQWN0aXZpdGllcyxcbiAgdHlwZSBBY3Rpdml0eUNhcGFjaXR5LFxufSBmcm9tICcuLi9zY2hlbWFzL2FjdGl2aXR5U2NoZW1hcyc7XG5cbi8qKlxuICogUmVzdWx0IHR5cGUgZm9yIGNvbnNpc3RlbnQgZXJyb3IgaGFuZGxpbmcuXG4gKi9cbnR5cGUgUmVzdWx0PFQ+ID1cbiAgfCB7IHN1Y2Nlc3M6IHRydWU7IGRhdGE6IFQgfVxuICB8IHsgc3VjY2VzczogZmFsc2U7IGVycm9yOiB7IGNvZGU6IHN0cmluZzsgbWVzc2FnZTogc3RyaW5nOyBkZXRhaWxzPzogYW55IH0gfTtcblxuLyoqXG4gKiBDb252ZXJ0cyBjYW1lbENhc2UgdG8gc25ha2VfY2FzZSBmb3IgZGF0YWJhc2UgY29sdW1ucy5cbiAqL1xuZnVuY3Rpb24gdG9TbmFrZUNhc2Uob2JqOiBhbnkpOiBhbnkge1xuICBjb25zdCBzbmFrZU9iajogYW55ID0ge307XG4gIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgIGNvbnN0IHNuYWtlS2V5ID0ga2V5LnJlcGxhY2UoL1tBLVpdL2csIChsZXR0ZXIpID0+IGBfJHtsZXR0ZXIudG9Mb3dlckNhc2UoKX1gKTtcbiAgICBzbmFrZU9ialtzbmFrZUtleV0gPSBvYmpba2V5XTtcbiAgfVxuICByZXR1cm4gc25ha2VPYmo7XG59XG5cbi8qKlxuICogQ29udmVydHMgc25ha2VfY2FzZSB0byBjYW1lbENhc2UgZm9yIFR5cGVTY3JpcHQgb2JqZWN0cy5cbiAqL1xuZnVuY3Rpb24gdG9DYW1lbENhc2Uob2JqOiBhbnkpOiBhbnkge1xuICBjb25zdCBjYW1lbE9iajogYW55ID0ge307XG4gIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgIGNvbnN0IGNhbWVsS2V5ID0ga2V5LnJlcGxhY2UoL18oW2Etel0pL2csIChfLCBsZXR0ZXIpID0+IGxldHRlci50b1VwcGVyQ2FzZSgpKTtcbiAgICBjYW1lbE9ialtjYW1lbEtleV0gPSBvYmpba2V5XTtcbiAgfVxuICByZXR1cm4gY2FtZWxPYmo7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBhY3Rpdml0eSBpbiB0aGUgc3lzdGVtLlxuICpcbiAqIEBwYXJhbSBkYXRhIC0gQWN0aXZpdHkgZGF0YSBpbmNsdWRpbmcgbmFtZSwgdHlwZSwgdGltZSwgYW5kIGNhcGFjaXR5XG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB0aGUgY3JlYXRlZCBhY3Rpdml0eSBvciBlcnJvciBkZXRhaWxzXG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjdGl2aXR5U2VydmljZS5jcmVhdGUoe1xuICogICBuYW1lOiAnQmVhY2ggVm9sbGV5YmFsbCcsXG4gKiAgIGFjdGl2aXR5VHlwZTogJ2FjdGl2aXR5JyxcbiAqICAgc3RhcnRUaW1lOiAnMjAyNS0wNi0xNVQxMDowMDowMFonLFxuICogICBjYXBhY2l0eTogMjAsXG4gKiB9KTtcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZShkYXRhOiBDcmVhdGVBY3Rpdml0eURUTyk6IFByb21pc2U8UmVzdWx0PEFjdGl2aXR5Pj4ge1xuICB0cnkge1xuICAgIC8vIDEuIFZhbGlkYXRlXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IGNyZWF0ZUFjdGl2aXR5U2NoZW1hLnNhZmVQYXJzZShkYXRhKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIDIuIFNhbml0aXplIHVzZXIgaW5wdXRcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSB7XG4gICAgICAuLi52YWxpZGF0aW9uLmRhdGEsXG4gICAgICBuYW1lOiBzYW5pdGl6ZUlucHV0KHZhbGlkYXRpb24uZGF0YS5uYW1lKSxcbiAgICAgIGRlc2NyaXB0aW9uOiB2YWxpZGF0aW9uLmRhdGEuZGVzY3JpcHRpb24gPyBzYW5pdGl6ZVJpY2hUZXh0KHZhbGlkYXRpb24uZGF0YS5kZXNjcmlwdGlvbikgOiBudWxsLFxuICAgICAgYWN0aXZpdHlUeXBlOiBzYW5pdGl6ZUlucHV0KHZhbGlkYXRpb24uZGF0YS5hY3Rpdml0eVR5cGUpLFxuICAgIH07XG5cbiAgICAvLyAzLiBEYXRhYmFzZSBvcGVyYXRpb25cbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuICAgICk7XG5cbiAgICBjb25zdCBkYkRhdGEgPSB0b1NuYWtlQ2FzZShzYW5pdGl6ZWQpO1xuICAgIGNvbnN0IHsgZGF0YTogcmVzdWx0LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdhY3Rpdml0aWVzJylcbiAgICAgIC5pbnNlcnQoZGJEYXRhKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogeyBjb2RlOiAnREFUQUJBU0VfRVJST1InLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLCBkZXRhaWxzOiBlcnJvciB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB0b0NhbWVsQ2FzZShyZXN1bHQpIGFzIEFjdGl2aXR5IH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHJpZXZlcyBhIHNpbmdsZSBhY3Rpdml0eSBieSBJRC5cbiAqXG4gKiBAcGFyYW0gaWQgLSBBY3Rpdml0eSBVVUlEXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB0aGUgYWN0aXZpdHkgb3IgZXJyb3IgZGV0YWlsc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0KGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDxBY3Rpdml0eT4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuICAgICk7XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2FjdGl2aXRpZXMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ2lkJywgaWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHsgY29kZTogJ05PVF9GT1VORCcsIG1lc3NhZ2U6ICdBY3Rpdml0eSBub3QgZm91bmQnIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHsgY29kZTogJ0RBVEFCQVNFX0VSUk9SJywgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwgZGV0YWlsczogZXJyb3IgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdG9DYW1lbENhc2UoZGF0YSkgYXMgQWN0aXZpdHkgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogVXBkYXRlcyBhbiBleGlzdGluZyBhY3Rpdml0eS5cbiAqXG4gKiBAcGFyYW0gaWQgLSBBY3Rpdml0eSBVVUlEXG4gKiBAcGFyYW0gZGF0YSAtIFBhcnRpYWwgYWN0aXZpdHkgZGF0YSB0byB1cGRhdGVcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIHRoZSB1cGRhdGVkIGFjdGl2aXR5IG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZShpZDogc3RyaW5nLCBkYXRhOiBVcGRhdGVBY3Rpdml0eURUTyk6IFByb21pc2U8UmVzdWx0PEFjdGl2aXR5Pj4ge1xuICB0cnkge1xuICAgIC8vIDEuIFZhbGlkYXRlXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHVwZGF0ZUFjdGl2aXR5U2NoZW1hLnNhZmVQYXJzZShkYXRhKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIDIuIFNhbml0aXplIHVzZXIgaW5wdXRcbiAgICBjb25zdCBzYW5pdGl6ZWQ6IGFueSA9IHsgLi4udmFsaWRhdGlvbi5kYXRhIH07XG4gICAgaWYgKHNhbml0aXplZC5uYW1lKSB7XG4gICAgICBzYW5pdGl6ZWQubmFtZSA9IHNhbml0aXplSW5wdXQoc2FuaXRpemVkLm5hbWUpO1xuICAgIH1cbiAgICBpZiAoc2FuaXRpemVkLmRlc2NyaXB0aW9uKSB7XG4gICAgICBzYW5pdGl6ZWQuZGVzY3JpcHRpb24gPSBzYW5pdGl6ZVJpY2hUZXh0KHNhbml0aXplZC5kZXNjcmlwdGlvbik7XG4gICAgfVxuICAgIGlmIChzYW5pdGl6ZWQuYWN0aXZpdHlUeXBlKSB7XG4gICAgICBzYW5pdGl6ZWQuYWN0aXZpdHlUeXBlID0gc2FuaXRpemVJbnB1dChzYW5pdGl6ZWQuYWN0aXZpdHlUeXBlKTtcbiAgICB9XG5cbiAgICAvLyAzLiBEYXRhYmFzZSBvcGVyYXRpb25cbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuICAgICk7XG5cbiAgICBjb25zdCBkYkRhdGEgPSB0b1NuYWtlQ2FzZShzYW5pdGl6ZWQpO1xuICAgIGNvbnN0IHsgZGF0YTogcmVzdWx0LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdhY3Rpdml0aWVzJylcbiAgICAgIC51cGRhdGUoZGJEYXRhKVxuICAgICAgLmVxKCdpZCcsIGlkKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHsgY29kZTogJ05PVF9GT1VORCcsIG1lc3NhZ2U6ICdBY3Rpdml0eSBub3QgZm91bmQnIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHsgY29kZTogJ0RBVEFCQVNFX0VSUk9SJywgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwgZGV0YWlsczogZXJyb3IgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdG9DYW1lbENhc2UocmVzdWx0KSBhcyBBY3Rpdml0eSB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBEZWxldGVzIGFuIGFjdGl2aXR5IGJ5IElELlxuICpcbiAqIEBwYXJhbSBpZCAtIEFjdGl2aXR5IFVVSURcbiAqIEByZXR1cm5zIFJlc3VsdCBpbmRpY2F0aW5nIHN1Y2Nlc3Mgb3IgZXJyb3IgZGV0YWlsc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQWN0aXZpdHkoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVzdWx0PHZvaWQ+PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgICAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSFcbiAgICApO1xuXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnYWN0aXZpdGllcycpLmRlbGV0ZSgpLmVxKCdpZCcsIGlkKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7IGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsIGRldGFpbHM6IGVycm9yIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHVuZGVmaW5lZCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBMaXN0cyBhY3Rpdml0aWVzIHdpdGggb3B0aW9uYWwgZmlsdGVyaW5nIGFuZCBwYWdpbmF0aW9uLlxuICpcbiAqIEBwYXJhbSBmaWx0ZXJzIC0gRmlsdGVyIGNyaXRlcmlhIGFuZCBwYWdpbmF0aW9uIG9wdGlvbnNcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIHBhZ2luYXRlZCBhY3Rpdml0aWVzIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3QoZmlsdGVyczogQWN0aXZpdHlGaWx0ZXJEVE8gPSB7fSk6IFByb21pc2U8UmVzdWx0PFBhZ2luYXRlZEFjdGl2aXRpZXM+PiB7XG4gIHRyeSB7XG4gICAgLy8gMS4gVmFsaWRhdGVcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gYWN0aXZpdHlGaWx0ZXJTY2hlbWEuc2FmZVBhcnNlKGZpbHRlcnMpO1xuICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgeyBwYWdlID0gMSwgcGFnZVNpemUgPSA1MCwgLi4uZmlsdGVyUGFyYW1zIH0gPSB2YWxpZGF0aW9uLmRhdGE7XG4gICAgY29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZTtcbiAgICBjb25zdCB0byA9IGZyb20gKyBwYWdlU2l6ZSAtIDE7XG5cbiAgICAvLyAyLiBEYXRhYmFzZSBvcGVyYXRpb25cbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuICAgICk7XG5cbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCdhY3Rpdml0aWVzJykuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JyB9KTtcblxuICAgIC8vIEFwcGx5IGZpbHRlcnNcbiAgICBpZiAoZmlsdGVyUGFyYW1zLmV2ZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKGZpbHRlclBhcmFtcy5ldmVudElkID09PSBudWxsKSB7XG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaXMoJ2V2ZW50X2lkJywgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdldmVudF9pZCcsIGZpbHRlclBhcmFtcy5ldmVudElkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGZpbHRlclBhcmFtcy5hY3Rpdml0eVR5cGUpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2FjdGl2aXR5X3R5cGUnLCBmaWx0ZXJQYXJhbXMuYWN0aXZpdHlUeXBlKTtcbiAgICB9XG4gICAgaWYgKGZpbHRlclBhcmFtcy5zdGF0dXMpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3N0YXR1cycsIGZpbHRlclBhcmFtcy5zdGF0dXMpO1xuICAgIH1cbiAgICBpZiAoZmlsdGVyUGFyYW1zLmxvY2F0aW9uSWQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2xvY2F0aW9uX2lkJywgZmlsdGVyUGFyYW1zLmxvY2F0aW9uSWQpO1xuICAgIH1cbiAgICBpZiAoZmlsdGVyUGFyYW1zLmFkdWx0c09ubHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnYWR1bHRzX29ubHknLCBmaWx0ZXJQYXJhbXMuYWR1bHRzT25seSk7XG4gICAgfVxuICAgIGlmIChmaWx0ZXJQYXJhbXMuc3RhcnRUaW1lRnJvbSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5ndGUoJ3N0YXJ0X3RpbWUnLCBmaWx0ZXJQYXJhbXMuc3RhcnRUaW1lRnJvbSk7XG4gICAgfVxuICAgIGlmIChmaWx0ZXJQYXJhbXMuc3RhcnRUaW1lVG8pIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubHRlKCdzdGFydF90aW1lJywgZmlsdGVyUGFyYW1zLnN0YXJ0VGltZVRvKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBwYWdpbmF0aW9uIGFuZCBvcmRlcmluZ1xuICAgIHF1ZXJ5ID0gcXVlcnkub3JkZXIoJ3N0YXJ0X3RpbWUnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KS5yYW5nZShmcm9tLCB0byk7XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogeyBjb2RlOiAnREFUQUJBU0VfRVJST1InLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLCBkZXRhaWxzOiBlcnJvciB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBhY3Rpdml0aWVzID0gZGF0YS5tYXAoKGFjdGl2aXR5KSA9PiB0b0NhbWVsQ2FzZShhY3Rpdml0eSkgYXMgQWN0aXZpdHkpO1xuICAgIGNvbnN0IHRvdGFsID0gY291bnQgfHwgMDtcbiAgICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKHRvdGFsIC8gcGFnZVNpemUpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGFjdGl2aXRpZXMsXG4gICAgICAgIHRvdGFsLFxuICAgICAgICBwYWdlLFxuICAgICAgICBwYWdlU2l6ZSxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogU2VhcmNoZXMgYWN0aXZpdGllcyBieSBuYW1lIG9yIGRlc2NyaXB0aW9uLlxuICpcbiAqIEBwYXJhbSBzZWFyY2hQYXJhbXMgLSBTZWFyY2ggcXVlcnkgYW5kIHBhZ2luYXRpb24gb3B0aW9uc1xuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgcGFnaW5hdGVkIHNlYXJjaCByZXN1bHRzIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaChzZWFyY2hQYXJhbXM6IEFjdGl2aXR5U2VhcmNoRFRPKTogUHJvbWlzZTxSZXN1bHQ8UGFnaW5hdGVkQWN0aXZpdGllcz4+IHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWYWxpZGF0ZVxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBhY3Rpdml0eVNlYXJjaFNjaGVtYS5zYWZlUGFyc2Uoc2VhcmNoUGFyYW1zKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHsgcXVlcnksIHBhZ2UgPSAxLCBwYWdlU2l6ZSA9IDUwIH0gPSB2YWxpZGF0aW9uLmRhdGE7XG4gICAgY29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZTtcbiAgICBjb25zdCB0byA9IGZyb20gKyBwYWdlU2l6ZSAtIDE7XG5cbiAgICAvLyAyLiBTYW5pdGl6ZSBzZWFyY2ggcXVlcnlcbiAgICBjb25zdCBzYW5pdGl6ZWRRdWVyeSA9IHNhbml0aXplSW5wdXQocXVlcnkpO1xuXG4gICAgLy8gMy4gRGF0YWJhc2Ugb3BlcmF0aW9uXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgICAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSFcbiAgICApO1xuXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciwgY291bnQgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYWN0aXZpdGllcycpXG4gICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JyB9KVxuICAgICAgLm9yKGBuYW1lLmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSUsZGVzY3JpcHRpb24uaWxpa2UuJSR7c2FuaXRpemVkUXVlcnl9JWApXG4gICAgICAub3JkZXIoJ3N0YXJ0X3RpbWUnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KVxuICAgICAgLnJhbmdlKGZyb20sIHRvKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7IGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsIGRldGFpbHM6IGVycm9yIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IGFjdGl2aXRpZXMgPSBkYXRhLm1hcCgoYWN0aXZpdHkpID0+IHRvQ2FtZWxDYXNlKGFjdGl2aXR5KSBhcyBBY3Rpdml0eSk7XG4gICAgY29uc3QgdG90YWwgPSBjb3VudCB8fCAwO1xuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWwgLyBwYWdlU2l6ZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgYWN0aXZpdGllcyxcbiAgICAgICAgdG90YWwsXG4gICAgICAgIHBhZ2UsXG4gICAgICAgIHBhZ2VTaXplLFxuICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgfSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGVzIGNhcGFjaXR5IGluZm9ybWF0aW9uIGZvciBhbiBhY3Rpdml0eS5cbiAqXG4gKiBAcGFyYW0gYWN0aXZpdHlJZCAtIEFjdGl2aXR5IFVVSURcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIGNhcGFjaXR5IGluZm9ybWF0aW9uIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENhcGFjaXR5SW5mbyhhY3Rpdml0eUlkOiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDxBY3Rpdml0eUNhcGFjaXR5Pj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxuICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICAgIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkhXG4gICAgKTtcblxuICAgIC8vIEdldCBhY3Rpdml0eSBkZXRhaWxzXG4gICAgY29uc3QgeyBkYXRhOiBhY3Rpdml0eSwgZXJyb3I6IGFjdGl2aXR5RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYWN0aXZpdGllcycpXG4gICAgICAuc2VsZWN0KCdpZCwgbmFtZSwgY2FwYWNpdHknKVxuICAgICAgLmVxKCdpZCcsIGFjdGl2aXR5SWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoYWN0aXZpdHlFcnJvcikge1xuICAgICAgaWYgKGFjdGl2aXR5RXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7IGNvZGU6ICdOT1RfRk9VTkQnLCBtZXNzYWdlOiAnQWN0aXZpdHkgbm90IGZvdW5kJyB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7IGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsIG1lc3NhZ2U6IGFjdGl2aXR5RXJyb3IubWVzc2FnZSwgZGV0YWlsczogYWN0aXZpdHlFcnJvciB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBDb3VudCBhdHRlbmRpbmcgUlNWUHNcbiAgICBjb25zdCB7IGNvdW50LCBlcnJvcjogY291bnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdyc3ZwcycpXG4gICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxuICAgICAgLmVxKCdhY3Rpdml0eV9pZCcsIGFjdGl2aXR5SWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhdHRlbmRpbmcnKTtcblxuICAgIGlmIChjb3VudEVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHsgY29kZTogJ0RBVEFCQVNFX0VSUk9SJywgbWVzc2FnZTogY291bnRFcnJvci5tZXNzYWdlLCBkZXRhaWxzOiBjb3VudEVycm9yIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRBdHRlbmRlZXMgPSBjb3VudCB8fCAwO1xuICAgIGNvbnN0IGNhcGFjaXR5ID0gYWN0aXZpdHkuY2FwYWNpdHk7XG4gICAgY29uc3QgYXZhaWxhYmxlU3BvdHMgPSBjYXBhY2l0eSAhPT0gbnVsbCA/IGNhcGFjaXR5IC0gY3VycmVudEF0dGVuZGVlcyA6IG51bGw7XG4gICAgY29uc3QgdXRpbGl6YXRpb25QZXJjZW50YWdlID0gY2FwYWNpdHkgIT09IG51bGwgPyAoY3VycmVudEF0dGVuZGVlcyAvIGNhcGFjaXR5KSAqIDEwMCA6IG51bGw7XG4gICAgY29uc3QgaXNOZWFyQ2FwYWNpdHkgPSB1dGlsaXphdGlvblBlcmNlbnRhZ2UgIT09IG51bGwgJiYgdXRpbGl6YXRpb25QZXJjZW50YWdlID49IDkwO1xuICAgIGNvbnN0IGlzQXRDYXBhY2l0eSA9IHV0aWxpemF0aW9uUGVyY2VudGFnZSAhPT0gbnVsbCAmJiB1dGlsaXphdGlvblBlcmNlbnRhZ2UgPj0gMTAwO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGFjdGl2aXR5SWQ6IGFjdGl2aXR5LmlkLFxuICAgICAgICBhY3Rpdml0eU5hbWU6IGFjdGl2aXR5Lm5hbWUsXG4gICAgICAgIGNhcGFjaXR5LFxuICAgICAgICBjdXJyZW50QXR0ZW5kZWVzLFxuICAgICAgICBhdmFpbGFibGVTcG90cyxcbiAgICAgICAgdXRpbGl6YXRpb25QZXJjZW50YWdlLFxuICAgICAgICBpc05lYXJDYXBhY2l0eSxcbiAgICAgICAgaXNBdENhcGFjaXR5LFxuICAgICAgfSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGVzIGNvc3QgZm9yIGFuIGFjdGl2aXR5IGFmdGVyIGFwcGx5aW5nIGhvc3Qgc3Vic2lkeS5cbiAqXG4gKiBAcGFyYW0gYWN0aXZpdHlJZCAtIEFjdGl2aXR5IFVVSURcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIG5ldCBjb3N0IHBlciBwZXJzb24gb3IgZXJyb3IgZGV0YWlsc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2FsY3VsYXRlTmV0Q29zdChhY3Rpdml0eUlkOiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDxudW1iZXI+PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgICAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSFcbiAgICApO1xuXG4gICAgY29uc3QgeyBkYXRhOiBhY3Rpdml0eSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYWN0aXZpdGllcycpXG4gICAgICAuc2VsZWN0KCdjb3N0X3Blcl9wZXJzb24sIGhvc3Rfc3Vic2lkeScpXG4gICAgICAuZXEoJ2lkJywgYWN0aXZpdHlJZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogeyBjb2RlOiAnTk9UX0ZPVU5EJywgbWVzc2FnZTogJ0FjdGl2aXR5IG5vdCBmb3VuZCcgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogeyBjb2RlOiAnREFUQUJBU0VfRVJST1InLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLCBkZXRhaWxzOiBlcnJvciB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjb3N0UGVyUGVyc29uID0gYWN0aXZpdHkuY29zdF9wZXJfcGVyc29uIHx8IDA7XG4gICAgY29uc3QgaG9zdFN1YnNpZHkgPSBhY3Rpdml0eS5ob3N0X3N1YnNpZHkgfHwgMDtcbiAgICBjb25zdCBuZXRDb3N0ID0gTWF0aC5tYXgoMCwgY29zdFBlclBlcnNvbiAtIGhvc3RTdWJzaWR5KTtcblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IG5ldENvc3QgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG4iXSwibmFtZXMiOlsiY2FsY3VsYXRlTmV0Q29zdCIsImNyZWF0ZSIsImRlbGV0ZUFjdGl2aXR5IiwiZ2V0IiwiZ2V0Q2FwYWNpdHlJbmZvIiwibGlzdCIsInNlYXJjaCIsInVwZGF0ZSIsInRvU25ha2VDYXNlIiwib2JqIiwic25ha2VPYmoiLCJrZXkiLCJzbmFrZUtleSIsInJlcGxhY2UiLCJsZXR0ZXIiLCJ0b0xvd2VyQ2FzZSIsInRvQ2FtZWxDYXNlIiwiY2FtZWxPYmoiLCJjYW1lbEtleSIsIl8iLCJ0b1VwcGVyQ2FzZSIsImRhdGEiLCJ2YWxpZGF0aW9uIiwiY3JlYXRlQWN0aXZpdHlTY2hlbWEiLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwiZXJyb3IiLCJjb2RlIiwibWVzc2FnZSIsImRldGFpbHMiLCJpc3N1ZXMiLCJzYW5pdGl6ZWQiLCJuYW1lIiwic2FuaXRpemVJbnB1dCIsImRlc2NyaXB0aW9uIiwic2FuaXRpemVSaWNoVGV4dCIsImFjdGl2aXR5VHlwZSIsInN1cGFiYXNlIiwiY3JlYXRlQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJkYkRhdGEiLCJyZXN1bHQiLCJmcm9tIiwiaW5zZXJ0Iiwic2VsZWN0Iiwic2luZ2xlIiwiRXJyb3IiLCJpZCIsImVxIiwidXBkYXRlQWN0aXZpdHlTY2hlbWEiLCJkZWxldGUiLCJ1bmRlZmluZWQiLCJmaWx0ZXJzIiwiYWN0aXZpdHlGaWx0ZXJTY2hlbWEiLCJwYWdlIiwicGFnZVNpemUiLCJmaWx0ZXJQYXJhbXMiLCJ0byIsInF1ZXJ5IiwiY291bnQiLCJldmVudElkIiwiaXMiLCJzdGF0dXMiLCJsb2NhdGlvbklkIiwiYWR1bHRzT25seSIsInN0YXJ0VGltZUZyb20iLCJndGUiLCJzdGFydFRpbWVUbyIsImx0ZSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwicmFuZ2UiLCJhY3Rpdml0aWVzIiwibWFwIiwiYWN0aXZpdHkiLCJ0b3RhbCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsInNlYXJjaFBhcmFtcyIsImFjdGl2aXR5U2VhcmNoU2NoZW1hIiwic2FuaXRpemVkUXVlcnkiLCJvciIsImFjdGl2aXR5SWQiLCJhY3Rpdml0eUVycm9yIiwiY291bnRFcnJvciIsImhlYWQiLCJjdXJyZW50QXR0ZW5kZWVzIiwiY2FwYWNpdHkiLCJhdmFpbGFibGVTcG90cyIsInV0aWxpemF0aW9uUGVyY2VudGFnZSIsImlzTmVhckNhcGFjaXR5IiwiaXNBdENhcGFjaXR5IiwiYWN0aXZpdHlOYW1lIiwiY29zdFBlclBlcnNvbiIsImNvc3RfcGVyX3BlcnNvbiIsImhvc3RTdWJzaWR5IiwiaG9zdF9zdWJzaWR5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