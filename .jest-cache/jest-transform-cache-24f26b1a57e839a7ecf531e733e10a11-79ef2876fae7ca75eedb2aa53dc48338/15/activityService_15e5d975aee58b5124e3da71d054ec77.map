{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/activityService.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\nimport { sanitizeInput, sanitizeRichText } from \"../utils/sanitization\";\nimport {\n  createActivitySchema,\n  updateActivitySchema,\n  activityFilterSchema,\n  activitySearchSchema,\n  type CreateActivityDTO,\n  type UpdateActivityDTO,\n  type ActivityFilterDTO,\n  type ActivitySearchDTO,\n  type Activity,\n  type PaginatedActivities,\n  type ActivityCapacity,\n} from '../schemas/activitySchemas';\n\n/**\n * Result type for consistent error handling.\n */\ntype Result<T> =\n  | { success: true; data: T }\n  | { success: false; error: { code: string; message: string; details?: any } };\n\n/**\n * Converts camelCase to snake_case for database columns.\n */\nfunction toSnakeCase(obj: any): any {\n  const snakeObj: any = {};\n  for (const key in obj) {\n    const snakeKey = key.replace(/[A-Z]/g, (letter) => `_${letter.toLowerCase()}`);\n    snakeObj[snakeKey] = obj[key];\n  }\n  return snakeObj;\n}\n\n/**\n * Converts snake_case to camelCase for TypeScript objects.\n */\nfunction toCamelCase(obj: any): any {\n  const camelObj: any = {};\n  for (const key in obj) {\n    const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\n    camelObj[camelKey] = obj[key];\n  }\n  return camelObj;\n}\n\n/**\n * Creates a new activity in the system.\n *\n * @param data - Activity data including name, type, time, and capacity\n * @returns Result containing the created activity or error details\n *\n * @example\n * const result = await activityService.create({\n *   name: 'Beach Volleyball',\n *   activityType: 'activity',\n *   startTime: '2025-06-15T10:00:00Z',\n *   capacity: 20,\n * });\n */\nexport async function create(data: CreateActivityDTO): Promise<Result<Activity>> {\n  try {\n    // 1. Validate\n    const validation = createActivitySchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 2. Sanitize user input\n    const sanitized = {\n      ...validation.data,\n      name: sanitizeInput(validation.data.name),\n      description: validation.data.description ? sanitizeRichText(validation.data.description) : null,\n      activityType: sanitizeInput(validation.data.activityType),\n    };\n\n    // 3. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('activities')\n      .insert(dbData)\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as Activity };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Retrieves a single activity by ID.\n *\n * @param id - Activity UUID\n * @returns Result containing the activity or error details\n */\nexport async function get(id: string): Promise<Result<Activity>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { data, error } = await supabase\n      .from('activities')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(data) as Activity };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Updates an existing activity.\n *\n * @param id - Activity UUID\n * @param data - Partial activity data to update\n * @returns Result containing the updated activity or error details\n */\nexport async function update(id: string, data: UpdateActivityDTO): Promise<Result<Activity>> {\n  try {\n    // 1. Validate\n    const validation = updateActivitySchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 2. Sanitize user input\n    const sanitized: any = { ...validation.data };\n    if (sanitized.name) {\n      sanitized.name = sanitizeInput(sanitized.name);\n    }\n    if (sanitized.description) {\n      sanitized.description = sanitizeRichText(sanitized.description);\n    }\n    if (sanitized.activityType) {\n      sanitized.activityType = sanitizeInput(sanitized.activityType);\n    }\n\n    // 3. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('activities')\n      .update(dbData)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as Activity };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Deletes an activity by ID.\n *\n * @param id - Activity UUID\n * @returns Result indicating success or error details\n */\nexport async function deleteActivity(id: string): Promise<Result<void>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { error } = await supabase.from('activities').delete().eq('id', id);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Lists activities with optional filtering and pagination.\n *\n * @param filters - Filter criteria and pagination options\n * @returns Result containing paginated activities or error details\n */\nexport async function list(filters: ActivityFilterDTO = {}): Promise<Result<PaginatedActivities>> {\n  try {\n    // 1. Validate\n    const validation = activityFilterSchema.safeParse(filters);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { page = 1, pageSize = 50, ...filterParams } = validation.data;\n    const from = (page - 1) * pageSize;\n    const to = from + pageSize - 1;\n\n    // 2. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    let query = supabase.from('activities').select('*', { count: 'exact' });\n\n    // Apply filters\n    if (filterParams.eventId !== undefined) {\n      if (filterParams.eventId === null) {\n        query = query.is('event_id', null);\n      } else {\n        query = query.eq('event_id', filterParams.eventId);\n      }\n    }\n    if (filterParams.activityType) {\n      query = query.eq('activity_type', filterParams.activityType);\n    }\n    if (filterParams.status) {\n      query = query.eq('status', filterParams.status);\n    }\n    if (filterParams.locationId) {\n      query = query.eq('location_id', filterParams.locationId);\n    }\n    if (filterParams.adultsOnly !== undefined) {\n      query = query.eq('adults_only', filterParams.adultsOnly);\n    }\n    if (filterParams.startTimeFrom) {\n      query = query.gte('start_time', filterParams.startTimeFrom);\n    }\n    if (filterParams.startTimeTo) {\n      query = query.lte('start_time', filterParams.startTimeTo);\n    }\n\n    // Apply pagination and ordering\n    query = query.order('start_time', { ascending: true }).range(from, to);\n\n    const { data, error, count } = await query;\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const activities = data.map((activity) => toCamelCase(activity) as Activity);\n    const total = count || 0;\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      success: true,\n      data: {\n        activities,\n        total,\n        page,\n        pageSize,\n        totalPages,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Searches activities by name or description.\n *\n * @param searchParams - Search query and pagination options\n * @returns Result containing paginated search results or error details\n */\nexport async function search(searchParams: ActivitySearchDTO): Promise<Result<PaginatedActivities>> {\n  try {\n    // 1. Validate\n    const validation = activitySearchSchema.safeParse(searchParams);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { query, page = 1, pageSize = 50 } = validation.data;\n    const from = (page - 1) * pageSize;\n    const to = from + pageSize - 1;\n\n    // 2. Sanitize search query\n    const sanitizedQuery = sanitizeInput(query);\n\n    // 3. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { data, error, count } = await supabase\n      .from('activities')\n      .select('*', { count: 'exact' })\n      .or(`name.ilike.%${sanitizedQuery}%,description.ilike.%${sanitizedQuery}%`)\n      .order('start_time', { ascending: true })\n      .range(from, to);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const activities = data.map((activity) => toCamelCase(activity) as Activity);\n    const total = count || 0;\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      success: true,\n      data: {\n        activities,\n        total,\n        page,\n        pageSize,\n        totalPages,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Calculates capacity information for an activity.\n *\n * @param activityId - Activity UUID\n * @returns Result containing capacity information or error details\n */\nexport async function getCapacityInfo(activityId: string): Promise<Result<ActivityCapacity>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    // Get activity details\n    const { data: activity, error: activityError } = await supabase\n      .from('activities')\n      .select('id, name, capacity')\n      .eq('id', activityId)\n      .single();\n\n    if (activityError) {\n      if (activityError.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: activityError.message, details: activityError },\n      };\n    }\n\n    // Count attending RSVPs\n    const { count, error: countError } = await supabase\n      .from('rsvps')\n      .select('*', { count: 'exact', head: true })\n      .eq('activity_id', activityId)\n      .eq('status', 'attending');\n\n    if (countError) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: countError.message, details: countError },\n      };\n    }\n\n    const currentAttendees = count || 0;\n    const capacity = activity.capacity;\n    const availableSpots = capacity !== null ? capacity - currentAttendees : null;\n    const utilizationPercentage = capacity !== null ? (currentAttendees / capacity) * 100 : null;\n    const isNearCapacity = utilizationPercentage !== null && utilizationPercentage >= 90;\n    const isAtCapacity = utilizationPercentage !== null && utilizationPercentage >= 100;\n\n    return {\n      success: true,\n      data: {\n        activityId: activity.id,\n        activityName: activity.name,\n        capacity,\n        currentAttendees,\n        availableSpots,\n        utilizationPercentage,\n        isNearCapacity,\n        isAtCapacity,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Calculates cost for an activity after applying host subsidy.\n *\n * @param activityId - Activity UUID\n * @returns Result containing net cost per person or error details\n */\nexport async function calculateNetCost(activityId: string): Promise<Result<number>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { data: activity, error } = await supabase\n      .from('activities')\n      .select('cost_per_person, host_subsidy')\n      .eq('id', activityId)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const costPerPerson = activity.cost_per_person || 0;\n    const hostSubsidy = activity.host_subsidy || 0;\n    const netCost = Math.max(0, costPerPerson - hostSubsidy);\n\n    return { success: true, data: netCost };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n"],"names":["calculateNetCost","create","deleteActivity","get","getCapacityInfo","list","search","update","toSnakeCase","obj","snakeObj","key","snakeKey","replace","letter","toLowerCase","toCamelCase","camelObj","camelKey","_","toUpperCase","data","validation","createActivitySchema","safeParse","success","error","code","message","details","issues","sanitized","name","sanitizeInput","description","sanitizeRichText","activityType","supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","dbData","result","from","insert","select","single","Error","id","eq","updateActivitySchema","delete","undefined","filters","activityFilterSchema","page","pageSize","filterParams","to","query","count","eventId","is","status","locationId","adultsOnly","startTimeFrom","gte","startTimeTo","lte","order","ascending","range","activities","map","activity","total","totalPages","Math","ceil","searchParams","activitySearchSchema","sanitizedQuery","or","activityId","activityError","countError","head","currentAttendees","capacity","availableSpots","utilizationPercentage","isNearCapacity","isAtCapacity","activityName","costPerPerson","cost_per_person","hostSubsidy","host_subsidy","netCost","max"],"mappings":"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"}