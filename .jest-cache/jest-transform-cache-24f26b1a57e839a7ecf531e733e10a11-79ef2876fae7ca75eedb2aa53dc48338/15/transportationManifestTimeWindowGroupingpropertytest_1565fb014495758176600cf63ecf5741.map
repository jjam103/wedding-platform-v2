{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/transportationManifestTimeWindowGrouping.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { generateArrivalManifest, generateDepartureManifest } from './transportationService';\nimport { createClient } from '@supabase/supabase-js';\n\n// Mock Supabase client\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(),\n}));\n\n// Mock the supabase module\njest.mock('@/lib/supabase', () => ({\n  supabase: {\n    from: jest.fn(),\n  },\n}));\n\n/**\n * Feature: destination-wedding-platform, Property 28: Transportation Manifest Time Window Grouping\n * \n * For any set of guests with arrival times, the manifest generation should group guests\n * into time windows such that all guests in a window arrive within the specified time\n * threshold (e.g., 2 hours).\n * \n * Validates: Requirements 20.1\n */\ndescribe('Feature: destination-wedding-platform, Property 28: Transportation Manifest Time Window Grouping', () => {\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Create a properly chained mock\n    mockSupabase = {\n      from: jest.fn().mockReturnThis(),\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      not: jest.fn().mockReturnThis(),\n      insert: jest.fn().mockReturnThis(),\n      single: jest.fn(),\n    };\n    \n    // Mock the lazy-loaded supabase\n    jest.resetModules();\n    jest.doMock('@/lib/supabase', () => ({\n      supabase: mockSupabase,\n    }));\n  });\n\n  it('should group guests into time windows within the specified threshold', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Generate a date\n        fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }),\n        // Generate time window threshold (1-4 hours)\n        fc.integer({ min: 1, max: 4 }),\n        // Generate array of guests with arrival times\n        fc.array(\n          fc.record({\n            id: fc.uuid(),\n            first_name: fc.string({ minLength: 1, maxLength: 50 }),\n            last_name: fc.string({ minLength: 1, maxLength: 50 }),\n            arrival_date: fc.constant('2025-06-01'),\n            arrival_time: fc.integer({ min: 0, max: 23 }).map(h => `${String(h).padStart(2, '0')}:00:00`),\n            airport_code: fc.constantFrom('SJO', 'LIR', 'Other'),\n            flight_number: fc.option(fc.string({ minLength: 4, maxLength: 10 })),\n          }),\n          { minLength: 1, maxLength: 20 }\n        ),\n        async (date, timeWindowHours, guests) => {\n          const dateStr = date.toISOString().split('T')[0];\n          \n          // Set up mock to return guests with arrival times\n          mockSupabase.not.mockResolvedValue({\n            data: guests.map(g => ({ ...g, arrival_date: dateStr })),\n            error: null,\n          });\n          \n          // Track manifests created\n          const createdManifests: any[] = [];\n          mockSupabase.single.mockImplementation(() => {\n            // Get the insert data from the previous call\n            const insertCall = mockSupabase.insert.mock.calls[mockSupabase.insert.mock.calls.length - 1];\n            const manifestData = insertCall[0];\n            \n            const manifest = {\n              id: fc.sample(fc.uuid(), 1)[0],\n              ...manifestData,\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            };\n            \n            createdManifests.push(manifest);\n            \n            return Promise.resolve({\n              data: manifest,\n              error: null,\n            });\n          });\n\n          // Generate arrival manifest\n          const result = await generateArrivalManifest(date, timeWindowHours);\n\n          // Property: Result should be successful\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            // Property: All manifests should have time windows within threshold\n            for (const manifest of result.data) {\n              const startParts = manifest.time_window_start.split(':');\n              const endParts = manifest.time_window_end.split(':');\n              \n              const startHour = parseInt(startParts[0], 10);\n              const endHour = parseInt(endParts[0], 10);\n              \n              const windowDuration = endHour - startHour;\n              \n              // Property: Window duration should equal the threshold\n              expect(windowDuration).toBe(timeWindowHours);\n              \n              // Property: Window should be aligned to threshold boundaries\n              expect(startHour % timeWindowHours).toBe(0);\n            }\n\n            // Property: All guests should be assigned to exactly one manifest\n            const allAssignedGuestIds = result.data.flatMap(m => m.guest_ids);\n            const uniqueGuestIds = new Set(allAssignedGuestIds);\n            \n            // No duplicate assignments\n            expect(allAssignedGuestIds.length).toBe(uniqueGuestIds.size);\n            \n            // All guests are assigned\n            expect(uniqueGuestIds.size).toBe(guests.length);\n            \n            // Property: Guests in same window should have arrival times within threshold\n            for (const manifest of result.data) {\n              const windowStartHour = parseInt(manifest.time_window_start.split(':')[0], 10);\n              const windowEndHour = parseInt(manifest.time_window_end.split(':')[0], 10);\n              \n              // Check each guest in this manifest\n              for (const guestId of manifest.guest_ids) {\n                const guest = guests.find(g => g.id === guestId);\n                if (guest && guest.arrival_time) {\n                  const guestHour = parseInt(guest.arrival_time.split(':')[0], 10);\n                  \n                  // Guest's arrival hour should fall within the window\n                  expect(guestHour).toBeGreaterThanOrEqual(windowStartHour);\n                  expect(guestHour).toBeLessThan(windowEndHour);\n                }\n              }\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle empty guest list gracefully', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }),\n        fc.integer({ min: 1, max: 4 }),\n        async (date, timeWindowHours) => {\n          // Mock empty guest list\n          mockSupabase.not.mockResolvedValue({\n            data: [],\n            error: null,\n          });\n\n          const result = await generateArrivalManifest(date, timeWindowHours);\n\n          // Property: Should return success with empty array\n          expect(result.success).toBe(true);\n          if (result.success) {\n            expect(result.data).toEqual([]);\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should group departure manifests with same time window logic', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }),\n        fc.integer({ min: 1, max: 4 }),\n        fc.array(\n          fc.record({\n            id: fc.uuid(),\n            first_name: fc.string({ minLength: 1, maxLength: 50 }),\n            last_name: fc.string({ minLength: 1, maxLength: 50 }),\n            departure_date: fc.constant('2025-06-05'),\n            departure_time: fc.integer({ min: 0, max: 23 }).map(h => `${String(h).padStart(2, '0')}:00:00`),\n            airport_code: fc.constantFrom('SJO', 'LIR', 'Other'),\n            flight_number: fc.option(fc.string({ minLength: 4, maxLength: 10 })),\n          }),\n          { minLength: 1, maxLength: 20 }\n        ),\n        async (date, timeWindowHours, guests) => {\n          const dateStr = date.toISOString().split('T')[0];\n          \n          // Set up mock to return guests\n          mockSupabase.not.mockResolvedValue({\n            data: guests.map(g => ({ ...g, departure_date: dateStr })),\n            error: null,\n          });\n          \n          // Mock manifest creation\n          mockSupabase.single.mockImplementation(() => {\n            const insertCall = mockSupabase.insert.mock.calls[mockSupabase.insert.mock.calls.length - 1];\n            const manifestData = insertCall[0];\n            \n            return Promise.resolve({\n              data: {\n                id: fc.sample(fc.uuid(), 1)[0],\n                ...manifestData,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n              },\n              error: null,\n            });\n          });\n\n          // Generate departure manifest\n          const result = await generateDepartureManifest(date, timeWindowHours);\n\n          // Property: Result should be successful\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            // Property: All manifests should have correct type\n            for (const manifest of result.data) {\n              expect(manifest.manifest_type).toBe('departure');\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain time window consistency across multiple guests', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }),\n        fc.constantFrom(1, 2, 3, 4), // Common time window values\n        fc.array(\n          fc.record({\n            id: fc.uuid(),\n            first_name: fc.string({ minLength: 1, maxLength: 50 }),\n            last_name: fc.string({ minLength: 1, maxLength: 50 }),\n            arrival_date: fc.constant('2025-06-01'),\n            arrival_time: fc.integer({ min: 0, max: 23 }).map(h => `${String(h).padStart(2, '0')}:00:00`),\n            airport_code: fc.constantFrom('SJO', 'LIR', 'Other'),\n            flight_number: fc.option(fc.string({ minLength: 4, maxLength: 10 })),\n          }),\n          { minLength: 5, maxLength: 30 }\n        ),\n        async (date, timeWindowHours, guests) => {\n          const dateStr = date.toISOString().split('T')[0];\n          \n          mockSupabase.not.mockResolvedValue({\n            data: guests.map(g => ({ ...g, arrival_date: dateStr })),\n            error: null,\n          });\n          \n          mockSupabase.single.mockImplementation(() => {\n            const insertCall = mockSupabase.insert.mock.calls[mockSupabase.insert.mock.calls.length - 1];\n            const manifestData = insertCall[0];\n            \n            return Promise.resolve({\n              data: {\n                id: fc.sample(fc.uuid(), 1)[0],\n                ...manifestData,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n              },\n              error: null,\n            });\n          });\n\n          const result = await generateArrivalManifest(date, timeWindowHours);\n\n          expect(result.success).toBe(true);\n\n          if (result.success && result.data.length > 0) {\n            // Property: Each manifest should have non-overlapping time windows\n            const sortedManifests = result.data.sort((a, b) => \n              a.time_window_start.localeCompare(b.time_window_start)\n            );\n\n            for (let i = 0; i < sortedManifests.length - 1; i++) {\n              const current = sortedManifests[i];\n              const next = sortedManifests[i + 1];\n              \n              // Current window end should be <= next window start\n              expect(current.time_window_end <= next.time_window_start).toBe(true);\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["jest","mock","createClient","fn","supabase","from","describe","mockSupabase","beforeEach","clearAllMocks","mockReturnThis","select","eq","not","insert","single","resetModules","doMock","it","fc","assert","asyncProperty","date","min","Date","max","integer","array","record","id","uuid","first_name","string","minLength","maxLength","last_name","arrival_date","constant","arrival_time","map","h","String","padStart","airport_code","constantFrom","flight_number","option","timeWindowHours","guests","dateStr","toISOString","split","mockResolvedValue","data","g","error","createdManifests","mockImplementation","insertCall","calls","length","manifestData","manifest","sample","created_at","updated_at","push","Promise","resolve","result","generateArrivalManifest","expect","success","toBe","startParts","time_window_start","endParts","time_window_end","startHour","parseInt","endHour","windowDuration","allAssignedGuestIds","flatMap","m","guest_ids","uniqueGuestIds","Set","size","windowStartHour","windowEndHour","guestId","guest","find","guestHour","toBeGreaterThanOrEqual","toBeLessThan","numRuns","toEqual","departure_date","departure_time","generateDepartureManifest","manifest_type","sortedManifests","sort","a","b","localeCompare","i","current","next"],"mappings":"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"}