{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/home-page/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport dynamic from 'next/dynamic';\nimport { Button } from '@/components/ui/Button';\nimport { Card } from '@/components/ui/Card';\nimport { RichTextEditorSkeleton } from '@/components/admin/RichTextEditorSkeleton';\nimport { SectionEditorSkeleton } from '@/components/admin/SectionEditorSkeleton';\n\n// Lazy load heavy components\nconst RichTextEditor = dynamic(() => import('@/components/admin/RichTextEditor').then(mod => ({ default: mod.RichTextEditor })), {\n  loading: () => <RichTextEditorSkeleton />,\n  ssr: false,\n});\n\nconst SectionEditor = dynamic(() => import('@/components/admin/SectionEditor').then(mod => ({ default: mod.SectionEditor })), {\n  loading: () => <SectionEditorSkeleton />,\n  ssr: false,\n});\n\ninterface HomePageConfig {\n  title: string | null;\n  subtitle: string | null;\n  welcomeMessage: string | null;\n  heroImageUrl: string | null;\n}\n\n/**\n * Home Page Editor\n * \n * Allows admins to customize the wedding homepage with:\n * - Title and subtitle\n * - Welcome message (rich text)\n * - Hero image URL\n * - Manage sections button (opens SectionEditor)\n * - Preview button (opens guest-facing homepage)\n * - Auto-save draft every 30 seconds\n */\nexport default function HomePageEditorPage() {\n  const router = useRouter();\n  const [config, setConfig] = useState<HomePageConfig>({\n    title: null,\n    subtitle: null,\n    welcomeMessage: null,\n    heroImageUrl: null,\n  });\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [isDirty, setIsDirty] = useState(false);\n  const [showSectionEditor, setShowSectionEditor] = useState(false);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n  const autoSaveTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Load home page config\n  const loadConfig = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const response = await fetch('/api/admin/home-page');\n      const result = await response.json();\n      \n      if (result.success) {\n        setConfig(result.data);\n      } else {\n        setError(result.error.message);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load home page config');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Save home page config\n  const saveConfig = useCallback(async (showToast = true) => {\n    try {\n      setSaving(true);\n      setError(null);\n      \n      const response = await fetch('/api/admin/home-page', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(config),\n      });\n      \n      const result = await response.json();\n      \n      if (result.success) {\n        setConfig(result.data);\n        setIsDirty(false);\n        setLastSaved(new Date());\n        \n        if (showToast) {\n          // Show success toast (would use toast context in real implementation)\n          console.log('Home page saved successfully');\n        }\n      } else {\n        setError(result.error.message);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to save home page config');\n    } finally {\n      setSaving(false);\n    }\n  }, [config]);\n\n  // Auto-save every 30 seconds if dirty\n  useEffect(() => {\n    if (isDirty && !saving) {\n      autoSaveTimerRef.current = setTimeout(() => {\n        saveConfig(false); // Silent auto-save\n      }, 30000); // 30 seconds\n    }\n    \n    return () => {\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n      }\n    };\n  }, [isDirty, saving, saveConfig]);\n\n  // Load config on mount\n  useEffect(() => {\n    loadConfig();\n  }, [loadConfig]);\n\n  // Warn before leaving with unsaved changes\n  useEffect(() => {\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\n      if (isDirty) {\n        e.preventDefault();\n        e.returnValue = '';\n      }\n    };\n    \n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\n  }, [isDirty]);\n\n  const handleFieldChange = (field: keyof HomePageConfig, value: string | null) => {\n    setConfig(prev => ({ ...prev, [field]: value }));\n    setIsDirty(true);\n  };\n\n  const handlePreview = () => {\n    // Open guest-facing homepage in new tab\n    window.open('/', '_blank');\n  };\n\n  const handleManageSections = () => {\n    setShowSectionEditor(true);\n  };\n\n  const handleSectionEditorClose = () => {\n    setShowSectionEditor(false);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-6\"></div>\n          <div className=\"space-y-4\">\n            <div className=\"h-10 bg-gray-200 rounded\"></div>\n            <div className=\"h-10 bg-gray-200 rounded\"></div>\n            <div className=\"h-32 bg-gray-200 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (showSectionEditor) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"mb-6 flex items-center justify-between\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Home Page Sections</h1>\n          <Button onClick={handleSectionEditorClose} variant=\"secondary\">\n            Back to Home Page Editor\n          </Button>\n        </div>\n        <SectionEditor pageType=\"home\" pageId=\"home\" onSave={handleSectionEditorClose} />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 max-w-4xl mx-auto\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Home Page Editor</h1>\n        <p className=\"text-gray-600\">\n          Customize your wedding homepage with a title, subtitle, welcome message, and hero image.\n        </p>\n        {lastSaved && (\n          <p className=\"text-sm text-gray-500 mt-2\">\n            Last saved: {lastSaved.toLocaleTimeString()}\n          </p>\n        )}\n      </div>\n\n      {error && (\n        <Card className=\"mb-6 p-4 bg-red-50 border-red-200\">\n          <p className=\"text-red-800\">{error}</p>\n        </Card>\n      )}\n\n      <div className=\"space-y-6\">\n        {/* Wedding Title */}\n        <Card className=\"p-6\">\n          <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Wedding Title *\n          </label>\n          <input\n            id=\"title\"\n            type=\"text\"\n            value={config.title || ''}\n            onChange={(e) => handleFieldChange('title', e.target.value)}\n            placeholder=\"Sarah & Michael's Costa Rica Wedding\"\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            disabled={saving}\n          />\n          <p className=\"mt-1 text-sm text-gray-500\">\n            The main title displayed on your wedding homepage\n          </p>\n        </Card>\n\n        {/* Subtitle */}\n        <Card className=\"p-6\">\n          <label htmlFor=\"subtitle\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Subtitle\n          </label>\n          <input\n            id=\"subtitle\"\n            type=\"text\"\n            value={config.subtitle || ''}\n            onChange={(e) => handleFieldChange('subtitle', e.target.value)}\n            placeholder=\"June 14-16, 2025 â€¢ Tamarindo, Costa Rica\"\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            disabled={saving}\n          />\n          <p className=\"mt-1 text-sm text-gray-500\">\n            Optional subtitle with date and location\n          </p>\n        </Card>\n\n        {/* Hero Image URL */}\n        <Card className=\"p-6\">\n          <label htmlFor=\"heroImageUrl\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Hero Image URL\n          </label>\n          <input\n            id=\"heroImageUrl\"\n            type=\"url\"\n            value={config.heroImageUrl || ''}\n            onChange={(e) => handleFieldChange('heroImageUrl', e.target.value)}\n            placeholder=\"https://example.com/hero-image.jpg\"\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            disabled={saving}\n          />\n          {config.heroImageUrl && (\n            <div className=\"mt-3\">\n              <img\n                src={config.heroImageUrl}\n                alt=\"Hero preview\"\n                className=\"max-w-xs rounded-md border border-gray-300\"\n                onError={(e) => {\n                  (e.target as HTMLImageElement).style.display = 'none';\n                }}\n              />\n            </div>\n          )}\n          <p className=\"mt-1 text-sm text-gray-500\">\n            URL of the hero image displayed at the top of the homepage\n          </p>\n        </Card>\n\n        {/* Welcome Message */}\n        <Card className=\"p-6\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Welcome Message\n          </label>\n          <RichTextEditor\n            value={config.welcomeMessage || ''}\n            onChange={(html) => handleFieldChange('welcomeMessage', html)}\n            placeholder=\"Write a welcome message for your guests...\"\n            disabled={saving}\n          />\n          <p className=\"mt-1 text-sm text-gray-500\">\n            Rich text welcome message displayed on the homepage\n          </p>\n        </Card>\n\n        {/* Action Buttons */}\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"flex gap-3\">\n            <Button\n              onClick={handleManageSections}\n              variant=\"secondary\"\n              disabled={saving}\n            >\n              Manage Sections\n            </Button>\n            <Button\n              onClick={handlePreview}\n              variant=\"secondary\"\n              disabled={saving}\n            >\n              Preview\n            </Button>\n          </div>\n          <Button\n            onClick={() => saveConfig(true)}\n            disabled={saving || !isDirty}\n          >\n            {saving ? 'Saving...' : 'Save Changes'}\n          </Button>\n        </div>\n\n        {isDirty && !saving && (\n          <p className=\"text-sm text-amber-600\">\n            You have unsaved changes. They will be auto-saved in 30 seconds.\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":["HomePageEditorPage","RichTextEditor","dynamic","then","mod","default","loading","RichTextEditorSkeleton","ssr","SectionEditor","SectionEditorSkeleton","router","useRouter","config","setConfig","useState","title","subtitle","welcomeMessage","heroImageUrl","setLoading","saving","setSaving","error","setError","isDirty","setIsDirty","showSectionEditor","setShowSectionEditor","lastSaved","setLastSaved","autoSaveTimerRef","useRef","loadConfig","useCallback","response","fetch","result","json","success","data","message","err","Error","saveConfig","showToast","method","headers","body","JSON","stringify","Date","console","log","useEffect","current","setTimeout","clearTimeout","handleBeforeUnload","e","preventDefault","returnValue","window","addEventListener","removeEventListener","handleFieldChange","field","value","prev","handlePreview","open","handleManageSections","handleSectionEditorClose","div","className","h1","Button","onClick","variant","pageType","pageId","onSave","p","toLocaleTimeString","Card","label","htmlFor","input","id","type","onChange","target","placeholder","disabled","img","src","alt","onError","style","display","html"],"mappings":"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"}