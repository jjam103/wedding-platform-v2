{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/unit/realtime-subscriptions.test.ts"],"sourcesContent":["/**\n * Real-time Subscriptions Unit Tests\n * \n * Tests for Supabase real-time subscription setup in admin pages.\n * These tests verify that the subscription logic is correctly configured.\n */\n\nimport { createClient } from '@supabase/supabase-js';\n\n// Mock Supabase client\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(),\n}));\n\ndescribe('Real-time Subscriptions', () => {\n  let mockChannel: any;\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    // Reset mocks\n    jest.clearAllMocks();\n\n    // Create mock channel\n    mockChannel = {\n      on: jest.fn().mockReturnThis(),\n      subscribe: jest.fn().mockReturnThis(),\n    };\n\n    // Create mock Supabase client\n    mockSupabase = {\n      channel: jest.fn().mockReturnValue(mockChannel),\n      removeChannel: jest.fn(),\n    };\n\n    // Mock createClient to return our mock Supabase client\n    (createClient as jest.Mock).mockReturnValue(mockSupabase);\n  });\n\n  describe('Guest Subscriptions', () => {\n    it('should create Supabase client with correct credentials', () => {\n      const supabaseUrl = 'https://test.supabase.co';\n      const supabaseAnonKey = 'test-anon-key';\n\n      // Set environment variables\n      process.env.NEXT_PUBLIC_SUPABASE_URL = supabaseUrl;\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = supabaseAnonKey;\n\n      // Create client\n      const client = createClient(supabaseUrl, supabaseAnonKey);\n\n      expect(createClient).toHaveBeenCalledWith(supabaseUrl, supabaseAnonKey);\n      expect(client).toBe(mockSupabase);\n    });\n\n    it('should subscribe to guests table changes', () => {\n      const supabaseUrl = 'https://test.supabase.co';\n      const supabaseAnonKey = 'test-anon-key';\n\n      process.env.NEXT_PUBLIC_SUPABASE_URL = supabaseUrl;\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = supabaseAnonKey;\n\n      const client = createClient(supabaseUrl, supabaseAnonKey);\n      \n      // Set up subscription\n      const channel = client\n        .channel('guests-changes')\n        .on(\n          'postgres_changes',\n          {\n            event: '*',\n            schema: 'public',\n            table: 'guests',\n          },\n          () => {}\n        )\n        .subscribe();\n\n      expect(mockSupabase.channel).toHaveBeenCalledWith('guests-changes');\n      expect(mockChannel.on).toHaveBeenCalledWith(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'guests',\n        },\n        expect.any(Function)\n      );\n      expect(mockChannel.subscribe).toHaveBeenCalled();\n    });\n  });\n\n  describe('Photo Subscriptions', () => {\n    it('should subscribe to photos table changes', () => {\n      const supabaseUrl = 'https://test.supabase.co';\n      const supabaseAnonKey = 'test-anon-key';\n\n      process.env.NEXT_PUBLIC_SUPABASE_URL = supabaseUrl;\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = supabaseAnonKey;\n\n      const client = createClient(supabaseUrl, supabaseAnonKey);\n      \n      // Set up subscription\n      const channel = client\n        .channel('photos-changes')\n        .on(\n          'postgres_changes',\n          {\n            event: '*',\n            schema: 'public',\n            table: 'photos',\n          },\n          () => {}\n        )\n        .subscribe();\n\n      expect(mockSupabase.channel).toHaveBeenCalledWith('photos-changes');\n      expect(mockChannel.on).toHaveBeenCalledWith(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'photos',\n        },\n        expect.any(Function)\n      );\n      expect(mockChannel.subscribe).toHaveBeenCalled();\n    });\n  });\n\n  describe('RSVP Subscriptions', () => {\n    it('should subscribe to rsvps table changes', () => {\n      const supabaseUrl = 'https://test.supabase.co';\n      const supabaseAnonKey = 'test-anon-key';\n\n      process.env.NEXT_PUBLIC_SUPABASE_URL = supabaseUrl;\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = supabaseAnonKey;\n\n      const client = createClient(supabaseUrl, supabaseAnonKey);\n      \n      // Set up subscription\n      const channel = client\n        .channel('rsvps-changes')\n        .on(\n          'postgres_changes',\n          {\n            event: '*',\n            schema: 'public',\n            table: 'rsvps',\n          },\n          () => {}\n        )\n        .subscribe();\n\n      expect(mockSupabase.channel).toHaveBeenCalledWith('rsvps-changes');\n      expect(mockChannel.on).toHaveBeenCalledWith(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'rsvps',\n        },\n        expect.any(Function)\n      );\n      expect(mockChannel.subscribe).toHaveBeenCalled();\n    });\n  });\n\n  describe('Cleanup', () => {\n    it('should remove channel on cleanup', () => {\n      const supabaseUrl = 'https://test.supabase.co';\n      const supabaseAnonKey = 'test-anon-key';\n\n      process.env.NEXT_PUBLIC_SUPABASE_URL = supabaseUrl;\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = supabaseAnonKey;\n\n      const client = createClient(supabaseUrl, supabaseAnonKey);\n      const channel = client.channel('test-channel');\n\n      // Simulate cleanup\n      client.removeChannel(channel);\n\n      expect(mockSupabase.removeChannel).toHaveBeenCalledWith(channel);\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","describe","mockChannel","mockSupabase","beforeEach","clearAllMocks","on","mockReturnThis","subscribe","channel","mockReturnValue","removeChannel","it","supabaseUrl","supabaseAnonKey","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","client","expect","toHaveBeenCalledWith","toBe","event","schema","table","any","Function","toHaveBeenCalled"],"mappings":"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"}