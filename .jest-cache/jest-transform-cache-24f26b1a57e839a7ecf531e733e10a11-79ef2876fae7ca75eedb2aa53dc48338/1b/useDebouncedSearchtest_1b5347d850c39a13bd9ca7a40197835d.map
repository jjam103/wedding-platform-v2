{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/hooks/useDebouncedSearch.test.ts"],"sourcesContent":["/**\n * Tests for debounced search hooks\n * \n * Validates:\n * - 300ms debounce delay\n * - Loading indicator during search\n * - Cleanup on unmount\n */\n\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { useDebouncedSearch, useDebounce, useDebouncedCallback } from './useDebouncedSearch';\n\n// Mock timers\njest.useFakeTimers();\n\ndescribe('useDebouncedSearch', () => {\n  afterEach(() => {\n    jest.clearAllTimers();\n  });\n\n  it('should initialize with initial value', () => {\n    const { result } = renderHook(() => useDebouncedSearch('initial'));\n\n    expect(result.current.value).toBe('initial');\n    expect(result.current.debouncedValue).toBe('initial');\n    expect(result.current.isSearching).toBe(false);\n  });\n\n  it('should debounce value changes by 300ms', () => {\n    const { result } = renderHook(() => useDebouncedSearch(''));\n\n    // Change value\n    act(() => {\n      result.current.setValue('test');\n    });\n\n    // Value should update immediately\n    expect(result.current.value).toBe('test');\n    expect(result.current.debouncedValue).toBe('');\n    expect(result.current.isSearching).toBe(true);\n\n    // Fast-forward 299ms (not enough)\n    act(() => {\n      jest.advanceTimersByTime(299);\n    });\n\n    expect(result.current.debouncedValue).toBe('');\n    expect(result.current.isSearching).toBe(true);\n\n    // Fast-forward 1ms more (total 300ms)\n    act(() => {\n      jest.advanceTimersByTime(1);\n    });\n\n    expect(result.current.debouncedValue).toBe('test');\n    expect(result.current.isSearching).toBe(false);\n  });\n\n  it('should show loading indicator during debounce', () => {\n    const { result } = renderHook(() => useDebouncedSearch(''));\n\n    act(() => {\n      result.current.setValue('searching');\n    });\n\n    expect(result.current.isSearching).toBe(true);\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(result.current.isSearching).toBe(false);\n  });\n\n  it('should cancel previous timeout on rapid changes', () => {\n    const { result } = renderHook(() => useDebouncedSearch(''));\n\n    // First change\n    act(() => {\n      result.current.setValue('a');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(100);\n    });\n\n    // Second change before first completes\n    act(() => {\n      result.current.setValue('ab');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(100);\n    });\n\n    // Third change\n    act(() => {\n      result.current.setValue('abc');\n    });\n\n    // Only the last value should be debounced\n    expect(result.current.debouncedValue).toBe('');\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(result.current.debouncedValue).toBe('abc');\n  });\n\n  it('should reset value and debounced value', () => {\n    const { result } = renderHook(() => useDebouncedSearch('initial'));\n\n    act(() => {\n      result.current.setValue('changed');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(result.current.value).toBe('changed');\n    expect(result.current.debouncedValue).toBe('changed');\n\n    act(() => {\n      result.current.reset();\n    });\n\n    expect(result.current.value).toBe('');\n    expect(result.current.debouncedValue).toBe('');\n    expect(result.current.isSearching).toBe(false);\n  });\n\n  it('should cleanup timeout on unmount', () => {\n    const { result, unmount } = renderHook(() => useDebouncedSearch(''));\n\n    act(() => {\n      result.current.setValue('test');\n    });\n\n    expect(result.current.isSearching).toBe(true);\n\n    unmount();\n\n    // Should not throw error\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n  });\n\n  it('should support custom delay', () => {\n    const { result } = renderHook(() => useDebouncedSearch('', 500));\n\n    act(() => {\n      result.current.setValue('test');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(result.current.debouncedValue).toBe('');\n\n    act(() => {\n      jest.advanceTimersByTime(200);\n    });\n\n    expect(result.current.debouncedValue).toBe('test');\n  });\n});\n\ndescribe('useDebounce', () => {\n  afterEach(() => {\n    jest.clearAllTimers();\n  });\n\n  it('should debounce value changes', () => {\n    const { result, rerender } = renderHook(\n      ({ value }) => useDebounce(value, 300),\n      { initialProps: { value: 'initial' } }\n    );\n\n    expect(result.current).toBe('initial');\n\n    rerender({ value: 'changed' });\n\n    expect(result.current).toBe('initial');\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(result.current).toBe('changed');\n  });\n\n  it('should work with non-string values', () => {\n    const { result, rerender } = renderHook(\n      ({ value }) => useDebounce(value, 300),\n      { initialProps: { value: 0 } }\n    );\n\n    expect(result.current).toBe(0);\n\n    rerender({ value: 42 });\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(result.current).toBe(42);\n  });\n\n  it('should work with objects', () => {\n    const obj1 = { id: 1, name: 'Test' };\n    const obj2 = { id: 2, name: 'Updated' };\n\n    const { result, rerender } = renderHook(\n      ({ value }) => useDebounce(value, 300),\n      { initialProps: { value: obj1 } }\n    );\n\n    expect(result.current).toBe(obj1);\n\n    rerender({ value: obj2 });\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(result.current).toBe(obj2);\n  });\n});\n\ndescribe('useDebouncedCallback', () => {\n  afterEach(() => {\n    jest.clearAllTimers();\n  });\n\n  it('should debounce callback execution', () => {\n    const callback = jest.fn();\n    const { result } = renderHook(() => useDebouncedCallback(callback, 300));\n\n    act(() => {\n      result.current('test');\n    });\n\n    expect(callback).not.toHaveBeenCalled();\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(callback).toHaveBeenCalledWith('test');\n    expect(callback).toHaveBeenCalledTimes(1);\n  });\n\n  it('should cancel previous callback on rapid calls', () => {\n    const callback = jest.fn();\n    const { result } = renderHook(() => useDebouncedCallback(callback, 300));\n\n    act(() => {\n      result.current('first');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(100);\n    });\n\n    act(() => {\n      result.current('second');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(100);\n    });\n\n    act(() => {\n      result.current('third');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    // Only the last call should execute\n    expect(callback).toHaveBeenCalledWith('third');\n    expect(callback).toHaveBeenCalledTimes(1);\n  });\n\n  it('should handle multiple arguments', () => {\n    const callback = jest.fn();\n    const { result } = renderHook(() => useDebouncedCallback(callback, 300));\n\n    act(() => {\n      result.current('arg1', 'arg2', 'arg3');\n    });\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    expect(callback).toHaveBeenCalledWith('arg1', 'arg2', 'arg3');\n  });\n\n  it('should update callback reference', () => {\n    const callback1 = jest.fn();\n    const callback2 = jest.fn();\n\n    const { result, rerender } = renderHook(\n      ({ cb }) => useDebouncedCallback(cb, 300),\n      { initialProps: { cb: callback1 } }\n    );\n\n    act(() => {\n      result.current('test');\n    });\n\n    // Update callback before timeout\n    rerender({ cb: callback2 });\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    // Should call the updated callback\n    expect(callback1).not.toHaveBeenCalled();\n    expect(callback2).toHaveBeenCalledWith('test');\n  });\n\n  it('should cleanup timeout on unmount', () => {\n    const callback = jest.fn();\n    const { result, unmount } = renderHook(() => useDebouncedCallback(callback, 300));\n\n    act(() => {\n      result.current('test');\n    });\n\n    unmount();\n\n    act(() => {\n      jest.advanceTimersByTime(300);\n    });\n\n    // Callback should not be called after unmount\n    expect(callback).not.toHaveBeenCalled();\n  });\n});\n"],"names":["jest","useFakeTimers","describe","afterEach","clearAllTimers","it","result","renderHook","useDebouncedSearch","expect","current","value","toBe","debouncedValue","isSearching","act","setValue","advanceTimersByTime","reset","unmount","rerender","useDebounce","initialProps","obj1","id","name","obj2","callback","fn","useDebouncedCallback","not","toHaveBeenCalled","toHaveBeenCalledWith","toHaveBeenCalledTimes","callback1","callback2","cb"],"mappings":"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"}