{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/mocks/mockTwilioService.ts"],"sourcesContent":["/**\n * Mock Twilio SMS Service for E2E Testing\n * \n * This mock service simulates Twilio SMS operations without sending real SMS messages.\n * It provides realistic responses for testing SMS functionality.\n */\n\nimport type { Result } from '@/types';\nimport { ERROR_CODES } from '@/types';\n\ninterface SMSMessage {\n  to: string;\n  from: string;\n  body: string;\n  sid: string;\n  timestamp: number;\n  status: 'queued' | 'sent' | 'delivered' | 'failed';\n}\n\n// Track sent SMS messages for debugging and verification\nconst sentMessages: SMSMessage[] = [];\n\n// Simulate SMS delivery failures for testing\nlet shouldFailNextSMS = false;\nlet failureReason = 'Simulated SMS failure';\n\n/**\n * Mock Twilio client\n */\nexport class MockTwilioClient {\n  messages = {\n    /**\n     * Mock create SMS message method\n     */\n    create: async (params: {\n      to: string;\n      from: string;\n      body: string;\n    }): Promise<{ sid: string; status: string }> => {\n      try {\n        // Simulate network delay\n        await new Promise((resolve) => setTimeout(resolve, 50));\n\n        // Check for simulated failure\n        if (shouldFailNextSMS) {\n          shouldFailNextSMS = false;\n          console.log('ðŸ§ª [MOCK TWILIO] SMS failed (simulated):', {\n            to: params.to,\n            reason: failureReason,\n          });\n\n          throw new Error(failureReason);\n        }\n\n        // Generate mock message SID\n        const sid = `SM${Date.now()}${Math.random().toString(36).substring(7)}`;\n\n        // Track sent message\n        const message: SMSMessage = {\n          to: params.to,\n          from: params.from,\n          body: params.body,\n          sid,\n          timestamp: Date.now(),\n          status: 'sent',\n        };\n        sentMessages.push(message);\n\n        console.log('ðŸ§ª [MOCK TWILIO] SMS sent:', {\n          sid,\n          to: params.to,\n          from: params.from,\n          bodyLength: params.body.length,\n        });\n\n        return {\n          sid,\n          status: 'sent',\n        };\n      } catch (error) {\n        throw error;\n      }\n    },\n  };\n}\n\n/**\n * Mock Twilio factory function\n */\nexport function mockTwilio(accountSid: string, authToken: string): MockTwilioClient {\n  console.log('ðŸ§ª [MOCK TWILIO] Client created with:', {\n    accountSid: accountSid.substring(0, 10) + '...',\n    authToken: '***',\n  });\n  return new MockTwilioClient();\n}\n\n/**\n * Get all sent SMS messages (for test verification)\n */\nexport function getSentMessages(): SMSMessage[] {\n  return [...sentMessages];\n}\n\n/**\n * Get sent messages by recipient\n */\nexport function getSentMessagesByRecipient(recipient: string): SMSMessage[] {\n  return sentMessages.filter((msg) => msg.to === recipient);\n}\n\n/**\n * Get sent messages containing text\n */\nexport function getSentMessagesContaining(text: string): SMSMessage[] {\n  return sentMessages.filter((msg) => msg.body.includes(text));\n}\n\n/**\n * Clear sent messages (for test cleanup)\n */\nexport function clearSentMessages(): void {\n  sentMessages.length = 0;\n  console.log('ðŸ§ª [MOCK TWILIO] Sent messages cleared');\n}\n\n/**\n * Simulate SMS delivery failure for next send\n */\nexport function simulateSMSFailure(reason: string = 'Simulated SMS failure'): void {\n  shouldFailNextSMS = true;\n  failureReason = reason;\n  console.log('ðŸ§ª [MOCK TWILIO] Next SMS will fail:', reason);\n}\n\n/**\n * Simulate SMS delivery (update status to delivered)\n */\nexport function simulateSMSDelivery(sid: string): boolean {\n  const message = sentMessages.find((m) => m.sid === sid);\n  if (message) {\n    message.status = 'delivered';\n    console.log('ðŸ§ª [MOCK TWILIO] SMS delivered:', sid);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Reset mock state\n */\nexport function resetMockTwilio(): void {\n  sentMessages.length = 0;\n  shouldFailNextSMS = false;\n  failureReason = 'Simulated SMS failure';\n  console.log('ðŸ§ª [MOCK TWILIO] Mock reset');\n}\n\n/**\n * Get message count\n */\nexport function getMessageCount(): number {\n  return sentMessages.length;\n}\n\n/**\n * Verify SMS was sent\n */\nexport function verifySMSSent(criteria: {\n  to?: string;\n  containsText?: string;\n}): boolean {\n  return sentMessages.some((msg) => {\n    if (criteria.to && msg.to !== criteria.to) {\n      return false;\n    }\n\n    if (criteria.containsText && !msg.body.includes(criteria.containsText)) {\n      return false;\n    }\n\n    return true;\n  });\n}\n\n/**\n * Get last sent message\n */\nexport function getLastSentMessage(): SMSMessage | undefined {\n  return sentMessages[sentMessages.length - 1];\n}\n"],"names":["MockTwilioClient","clearSentMessages","getLastSentMessage","getMessageCount","getSentMessages","getSentMessagesByRecipient","getSentMessagesContaining","mockTwilio","resetMockTwilio","simulateSMSDelivery","simulateSMSFailure","verifySMSSent","sentMessages","shouldFailNextSMS","failureReason","messages","create","params","Promise","resolve","setTimeout","console","log","to","reason","Error","sid","Date","now","Math","random","toString","substring","message","from","body","timestamp","status","push","bodyLength","length","error","accountSid","authToken","recipient","filter","msg","text","includes","find","m","criteria","some","containsText"],"mappings":"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"}