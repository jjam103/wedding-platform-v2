{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/cleanupService.test.ts"],"sourcesContent":["// Mock fs promises\njest.mock('fs', () => ({\n  promises: {\n    access: jest.fn(),\n    readdir: jest.fn(),\n    stat: jest.fn(),\n    unlink: jest.fn(),\n  },\n}));\n\n// Mock cronService\njest.mock('./cronService', () => ({\n  executeCronJob: jest.fn().mockImplementation(async (jobType, fn) => {\n    try {\n      const result = await fn();\n      return {\n        success: true,\n        data: {\n          jobType,\n          status: 'completed',\n          itemsProcessed: result.itemsProcessed,\n          itemsFailed: result.itemsFailed,\n          durationMs: 100,\n          errors: [],\n        },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      };\n    }\n  }),\n}));\n\n// Mock Supabase client creation - service creates its own client\njest.mock('@supabase/supabase-js', () => {\n  const mockFrom = jest.fn();\n  const mockSupabaseClient = {\n    from: mockFrom,\n  };\n  \n  return {\n    createClient: jest.fn(() => mockSupabaseClient),\n    // Export mockFrom so we can access it in tests\n    __mockFrom: mockFrom,\n  };\n});\n\n// Import service AFTER mocking dependencies\nimport {\n  cleanupTempFiles,\n  cleanupExpiredSessions,\n  cleanupOldAuditLogs,\n  cleanupOldCronLogs,\n  cleanupOldEmailLogs,\n  cleanupOldWebhookLogs,\n  runAllCleanupTasks,\n} from './cleanupService';\n\n// Get the mocked from function\nconst { __mockFrom: mockFrom } = require('@supabase/supabase-js');\n\ndescribe('cleanupService', () => {\n  const fs = require('fs').promises;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Set up environment variables\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n    \n    // Reset Supabase mocks to default successful state\n    const mockSelect = jest.fn().mockResolvedValue({ data: [], error: null });\n    const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n    const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n    mockFrom.mockReturnValue({ delete: mockDelete });\n  });\n\n  describe('cleanupTempFiles', () => {\n    it('should return success with cleanup stats when files deleted', async () => {\n      const mockFiles = ['old-file.tmp', 'recent-file.tmp'];\n      const oldFileStats = { mtimeMs: Date.now() - 25 * 60 * 60 * 1000, size: 1024 }; // 25 hours old\n      const recentFileStats = { mtimeMs: Date.now() - 1 * 60 * 60 * 1000, size: 512 }; // 1 hour old\n\n      fs.access.mockResolvedValue(undefined);\n      fs.readdir.mockResolvedValue(mockFiles);\n      fs.stat\n        .mockResolvedValueOnce(oldFileStats)\n        .mockResolvedValueOnce(recentFileStats);\n      fs.unlink.mockResolvedValue(undefined);\n\n      const result = await cleanupTempFiles(24); // 24 hours\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.filesDeleted).toBe(1);\n        expect(result.data.bytesFreed).toBe(1024);\n      }\n      expect(fs.unlink).toHaveBeenCalledTimes(1);\n    });\n\n    it('should return success with zero stats when no files to delete', async () => {\n      fs.access.mockResolvedValue(undefined);\n      fs.readdir.mockResolvedValue([]);\n\n      const result = await cleanupTempFiles(24);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.filesDeleted).toBe(0);\n        expect(result.data.bytesFreed).toBe(0);\n      }\n    });\n\n    it('should return success with zero stats when temp directory does not exist', async () => {\n      fs.access.mockRejectedValue(new Error('ENOENT: no such file or directory'));\n\n      const result = await cleanupTempFiles(24);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.filesDeleted).toBe(0);\n        expect(result.data.bytesFreed).toBe(0);\n      }\n    });\n\n    it('should return UNKNOWN_ERROR when unexpected error occurs', async () => {\n      fs.access.mockResolvedValue(undefined);\n      fs.readdir.mockRejectedValue(new Error('Unexpected error'));\n\n      const result = await cleanupTempFiles(24);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('UNKNOWN_ERROR');\n      }\n    });\n  });\n\n  describe('cleanupExpiredSessions', () => {\n    it('should return success with zero sessions deleted (handled by Supabase Auth)', async () => {\n      const result = await cleanupExpiredSessions();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.sessionsDeleted).toBe(0);\n      }\n    });\n  });\n\n  describe('cleanupOldAuditLogs', () => {\n    it('should return success with logs deleted count when logs cleaned up', async () => {\n      const mockData = [{ id: 'log-1' }, { id: 'log-2' }];\n      \n      // Set up the complete mock chain for this specific test\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldAuditLogs(90);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.logsDeleted).toBe(2);\n      }\n      expect(mockFrom).toHaveBeenCalledWith('audit_logs');\n    });\n\n    it('should return DATABASE_ERROR when delete operation fails', async () => {\n      // Set up the mock chain to return an error\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldAuditLogs(90);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n\n    it('should return success with zero count when no data returned', async () => {\n      // Set up the mock chain to return null data but no error\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: null,\n        error: null,\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldAuditLogs(90);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.logsDeleted).toBe(0);\n      }\n    });\n  });\n\n  describe('cleanupOldCronLogs', () => {\n    it('should return success with logs deleted count when logs cleaned up', async () => {\n      const mockData = [{ id: 'log-1' }, { id: 'log-2' }, { id: 'log-3' }];\n      \n      // Set up the mock chain for this specific test\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldCronLogs(30);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.logsDeleted).toBe(3);\n      }\n      expect(mockFrom).toHaveBeenCalledWith('cron_job_logs');\n    });\n\n    it('should return DATABASE_ERROR when delete operation fails', async () => {\n      // Set up the mock chain for this specific test\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldCronLogs(30);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('cleanupOldEmailLogs', () => {\n    it('should return success with logs deleted count when logs cleaned up', async () => {\n      const mockData = [{ id: 'log-1' }];\n      \n      // Set up the mock chain for this specific test\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldEmailLogs(180);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.logsDeleted).toBe(1);\n      }\n      expect(mockFrom).toHaveBeenCalledWith('email_logs');\n    });\n\n    it('should return DATABASE_ERROR when delete operation fails', async () => {\n      // Set up the mock chain for this specific test\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldEmailLogs(180);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('cleanupOldWebhookLogs', () => {\n    it('should return success with logs deleted count when logs cleaned up', async () => {\n      const mockData = [{ id: 'log-1' }, { id: 'log-2' }];\n      \n      // Set up the mock chain for this specific test\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldWebhookLogs(30);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.logsDeleted).toBe(2);\n      }\n      expect(mockFrom).toHaveBeenCalledWith('webhook_delivery_logs');\n    });\n\n    it('should return DATABASE_ERROR when delete operation fails', async () => {\n      // Set up the mock chain for this specific test\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await cleanupOldWebhookLogs(30);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('runAllCleanupTasks', () => {\n    it('should return success when all cleanup tasks complete successfully', async () => {\n      // Mock fs operations for temp file cleanup\n      fs.access.mockResolvedValue(undefined);\n      fs.readdir.mockResolvedValue([]);\n      \n      // Mock database operations for log cleanup - return empty arrays for successful cleanup\n      const mockSelect = jest.fn().mockResolvedValue({ data: [], error: null });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await runAllCleanupTasks();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.itemsProcessed).toBeGreaterThanOrEqual(0);\n        expect(result.data.itemsFailed).toBeGreaterThanOrEqual(0);\n      }\n    });\n\n    it('should handle individual cleanup task failures gracefully', async () => {\n      // Mock some cleanup functions to fail\n      fs.access.mockRejectedValue(new Error('File system error'));\n      \n      // Mock database operations to fail for some operations\n      const mockSelect = jest.fn().mockResolvedValue({ \n        data: null, \n        error: { message: 'Database error', code: 'CONNECTION_ERROR' } \n      });\n      const mockLt = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockDelete = jest.fn().mockReturnValue({ lt: mockLt });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await runAllCleanupTasks();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.itemsFailed).toBeGreaterThan(0);\n      }\n    });\n  });\n});"],"names":["jest","mock","promises","access","fn","readdir","stat","unlink","executeCronJob","mockImplementation","jobType","result","success","data","status","itemsProcessed","itemsFailed","durationMs","errors","error","code","message","Error","mockFrom","mockSupabaseClient","from","createClient","__mockFrom","require","describe","fs","beforeEach","clearAllMocks","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","mockSelect","mockResolvedValue","mockLt","mockReturnValue","select","mockDelete","lt","delete","it","mockFiles","oldFileStats","mtimeMs","Date","now","size","recentFileStats","undefined","mockResolvedValueOnce","cleanupTempFiles","expect","toBe","filesDeleted","bytesFreed","toHaveBeenCalledTimes","mockRejectedValue","cleanupExpiredSessions","sessionsDeleted","mockData","id","cleanupOldAuditLogs","logsDeleted","toHaveBeenCalledWith","cleanupOldCronLogs","cleanupOldEmailLogs","cleanupOldWebhookLogs","runAllCleanupTasks","toBeGreaterThanOrEqual","toBeGreaterThan"],"mappings":"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"}