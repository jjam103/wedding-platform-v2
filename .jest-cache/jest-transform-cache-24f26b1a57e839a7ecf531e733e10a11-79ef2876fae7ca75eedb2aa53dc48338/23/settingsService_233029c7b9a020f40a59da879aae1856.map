{"version":3,"names":["getSettings","cov_wexyv07j","f","s","updateSettings","_supabase","getSupabase","b","supabase","require","data","error","from","select","single","code","success","id","wedding_date","venue_name","couple_name_1","couple_name_2","timezone","send_rsvp_confirmations","send_activity_reminders","send_deadline_reminders","reminder_days_before","require_photo_moderation","max_photos_per_guest","allowed_photo_formats","home_page_title","home_page_subtitle","home_page_welcome_message","home_page_hero_image_url","created_at","Date","toISOString","updated_at","message","details","Error","validation","_settingsSchemas","updateSystemSettingsSchema","safeParse","issues","existing","result","updated","update","eq","created","insert"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/settingsService.ts"],"sourcesContent":["import {\n  systemSettingsSchema,\n  updateSystemSettingsSchema,\n  type SystemSettings,\n  type UpdateSystemSettingsDTO,\n} from '../schemas/settingsSchemas';\n\ntype Result<T> =\n  | { success: true; data: T }\n  | { success: false; error: { code: string; message: string; details?: any } };\n\n// Lazy load supabase to avoid initialization issues in tests\nlet _supabase: any = null;\nfunction getSupabase() {\n  if (!_supabase) {\n    const { supabase } = require('../lib/supabase');\n    _supabase = supabase;\n  }\n  return _supabase;\n}\n\n/**\n * Gets system settings\n * \n * @returns Result containing system settings or error details\n * \n * @example\n * const result = await settingsService.getSettings();\n * if (result.success) {\n *   console.log(result.data.wedding_date);\n * }\n */\nexport async function getSettings(): Promise<Result<SystemSettings>> {\n  try {\n    const supabase = getSupabase();\n    const { data, error } = await supabase\n      .from('system_settings')\n      .select('*')\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        // No settings found, return default settings\n        return {\n          success: true,\n          data: {\n            id: '',\n            wedding_date: null,\n            venue_name: null,\n            couple_name_1: null,\n            couple_name_2: null,\n            timezone: 'America/Costa_Rica',\n            send_rsvp_confirmations: true,\n            send_activity_reminders: true,\n            send_deadline_reminders: true,\n            reminder_days_before: 7,\n            require_photo_moderation: true,\n            max_photos_per_guest: 20,\n            allowed_photo_formats: ['jpg', 'jpeg', 'png', 'heic'],\n            home_page_title: null,\n            home_page_subtitle: null,\n            home_page_welcome_message: null,\n            home_page_hero_image_url: null,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n          },\n        };\n      }\n\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    return { success: true, data };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Updates system settings\n * \n * @param data - Settings data to update\n * @returns Result containing the updated settings or error details\n * \n * @example\n * const result = await settingsService.updateSettings({\n *   wedding_date: '2024-06-15T00:00:00Z',\n *   venue_name: 'Dreams Las Mareas',\n *   couple_name_1: 'John',\n *   couple_name_2: 'Jane',\n * });\n */\nexport async function updateSettings(data: UpdateSystemSettingsDTO): Promise<Result<SystemSettings>> {\n  try {\n    // 1. Validate\n    const validation = updateSystemSettingsSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 2. Check if settings exist\n    const supabase = getSupabase();\n    const { data: existing } = await supabase\n      .from('system_settings')\n      .select('id')\n      .single();\n\n    let result;\n    if (existing) {\n      // Update existing settings\n      const { data: updated, error } = await supabase\n        .from('system_settings')\n        .update(validation.data)\n        .eq('id', existing.id)\n        .select()\n        .single();\n\n      if (error) {\n        return {\n          success: false,\n          error: {\n            code: 'DATABASE_ERROR',\n            message: error.message,\n            details: error,\n          },\n        };\n      }\n\n      result = updated;\n    } else {\n      // Create new settings\n      const { data: created, error } = await supabase\n        .from('system_settings')\n        .insert(validation.data)\n        .select()\n        .single();\n\n      if (error) {\n        return {\n          success: false,\n          error: {\n            code: 'DATABASE_ERROR',\n            message: error.message,\n            details: error,\n          },\n        };\n      }\n\n      result = created;\n    }\n\n    return { success: true, data: result };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}