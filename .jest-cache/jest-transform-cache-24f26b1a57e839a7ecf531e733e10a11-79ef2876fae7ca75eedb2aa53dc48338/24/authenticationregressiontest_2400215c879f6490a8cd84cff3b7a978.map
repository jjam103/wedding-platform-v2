{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/authentication.regression.test.ts"],"sourcesContent":["/**\n * Regression Test Suite: Authentication Flows\n * \n * Tests authentication and authorization flows to prevent regressions in:\n * - Login with email/password\n * - Magic link authentication\n * - Session management\n * - Role-based access control\n * - Session expiration handling\n * \n * Requirements: 21.1, 21.2\n */\n\nimport * as authService from '@/services/authService';\nimport * as accessControlService from '@/services/accessControlService';\n\n// Mock Supabase client\nconst mockSupabase = {\n  auth: {\n    signInWithPassword: jest.fn(),\n    signInWithOtp: jest.fn(),\n    getSession: jest.fn(),\n    signOut: jest.fn(),\n  },\n  from: jest.fn().mockReturnThis(),\n  select: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  single: jest.fn(),\n};\n\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(() => mockSupabase),\n}));\n\ndescribe('Regression: Authentication Flows', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Login with Email/Password', () => {\n    it('should successfully authenticate valid credentials', async () => {\n      const mockSession = {\n        access_token: 'mock-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: Date.now() / 1000 + 3600,\n        user: { id: 'user-1', email: 'test@example.com' },\n      };\n\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: mockSession, user: mockSession.user },\n        error: null,\n      });\n\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      });\n\n      const result = await authService.loginWithPassword({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.user).toBeDefined();\n        expect(result.data.user.email).toBe('test@example.com');\n        expect(result.data.accessToken).toBe('mock-token');\n      }\n    });\n\n    it('should reject invalid credentials', async () => {\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: null, user: null },\n        error: { message: 'Invalid credentials' },\n      });\n\n      const result = await authService.loginWithPassword({\n        email: 'test@example.com',\n        password: 'wrongpassword',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('INVALID_CREDENTIALS');\n      }\n    });\n\n    it('should handle missing email', async () => {\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: null, user: null },\n        error: { message: 'Email is required' },\n      });\n\n      const result = await authService.loginWithPassword({\n        email: '',\n        password: 'password123',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('INVALID_CREDENTIALS');\n      }\n    });\n\n    it('should handle missing password', async () => {\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: null, user: null },\n        error: { message: 'Password is required' },\n      });\n\n      const result = await authService.loginWithPassword({\n        email: 'test@example.com',\n        password: '',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('INVALID_CREDENTIALS');\n      }\n    });\n  });\n\n  describe('Magic Link Authentication', () => {\n    it('should send magic link to valid email', async () => {\n      mockSupabase.auth.signInWithOtp.mockResolvedValue({\n        data: {},\n        error: null,\n      });\n\n      const result = await authService.sendMagicLink({\n        email: 'test@example.com',\n      });\n\n      expect(result.success).toBe(true);\n      expect(mockSupabase.auth.signInWithOtp).toHaveBeenCalledWith({\n        email: 'test@example.com',\n        options: {\n          emailRedirectTo: undefined,\n        },\n      });\n    });\n\n    it('should reject invalid email format', async () => {\n      mockSupabase.auth.signInWithOtp.mockResolvedValue({\n        data: null,\n        error: { message: 'Invalid email format' },\n      });\n\n      const result = await authService.sendMagicLink({\n        email: 'invalid-email',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('EXTERNAL_SERVICE_ERROR');\n      }\n    });\n\n    it('should handle email service failure', async () => {\n      mockSupabase.auth.signInWithOtp.mockResolvedValue({\n        data: null,\n        error: { message: 'Email service unavailable' },\n      });\n\n      const result = await authService.sendMagicLink({\n        email: 'test@example.com',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('EXTERNAL_SERVICE_ERROR');\n      }\n    });\n  });\n\n  describe('Session Management', () => {\n    it('should retrieve active session', async () => {\n      const mockSession = {\n        access_token: 'mock-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: Date.now() / 1000 + 3600,\n        user: { id: 'user-1', email: 'test@example.com' },\n      };\n\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: mockSession },\n        error: null,\n      });\n\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      });\n\n      const result = await authService.getSession();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.user).toBeDefined();\n        expect(result.data.accessToken).toBe('mock-token');\n      }\n    });\n\n    it('should handle expired session', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: { message: 'Session expired' },\n      });\n\n      const result = await authService.getSession();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('SESSION_EXPIRED');\n      }\n    });\n\n    it('should successfully sign out', async () => {\n      mockSupabase.auth.signOut.mockResolvedValue({\n        error: null,\n      });\n\n      const result = await authService.logout();\n\n      expect(result.success).toBe(true);\n      expect(mockSupabase.auth.signOut).toHaveBeenCalled();\n    });\n  });\n\n  describe('Role-Based Access Control', () => {\n    it('should allow super_admin to access all resources', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'user-1', role: 'super_admin' },\n        error: null,\n      });\n\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-1',\n        role: 'super_admin',\n        resource: 'admin',\n        action: 'create',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(true);\n      }\n    });\n\n    it('should allow host to access admin resources', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'user-2', role: 'host' },\n        error: null,\n      });\n\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-2',\n        role: 'host',\n        resource: 'guests',\n        action: 'create',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(true);\n      }\n    });\n\n    it('should deny guest access to admin resources', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'user-3', role: 'guest' },\n        error: null,\n      });\n\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-3',\n        role: 'guest',\n        resource: 'guests',\n        action: 'create',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(false);\n      }\n    });\n\n    it('should allow guest to read their own data', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'user-3', role: 'guest' },\n        error: null,\n      });\n\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-3',\n        role: 'guest',\n        resource: 'events',\n        action: 'read',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(true);\n      }\n    });\n  });\n\n  describe('Session Security', () => {\n    it('should not expose sensitive session data', async () => {\n      const mockSession = {\n        access_token: 'mock-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: Date.now() / 1000 + 3600,\n        user: { id: 'user-1', email: 'test@example.com' },\n      };\n\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: mockSession },\n        error: null,\n      });\n\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      });\n\n      const result = await authService.getSession();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // Ensure tokens are not exposed in logs or responses\n        const sessionString = JSON.stringify(result.data);\n        expect(sessionString).toContain('user-1');\n        // Tokens should be present but handled securely\n        expect(result.data.accessToken).toBeDefined();\n        expect(result.data.refreshToken).toBeDefined();\n      }\n    });\n\n    it('should handle concurrent session requests', async () => {\n      const mockSession = {\n        access_token: 'mock-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: Date.now() / 1000 + 3600,\n        user: { id: 'user-1', email: 'test@example.com' },\n      };\n\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: mockSession },\n        error: null,\n      });\n\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      });\n\n      // Simulate concurrent requests\n      const results = await Promise.all([\n        authService.getSession(),\n        authService.getSession(),\n        authService.getSession(),\n      ]);\n\n      results.forEach((result) => {\n        expect(result.success).toBe(true);\n      });\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","mockSupabase","auth","signInWithPassword","signInWithOtp","getSession","signOut","from","mockReturnThis","select","eq","single","describe","beforeEach","clearAllMocks","it","mockSession","access_token","refresh_token","expires_at","Date","now","user","id","email","mockResolvedValue","data","session","error","role","result","authService","loginWithPassword","password","expect","success","toBe","toBeDefined","accessToken","message","code","sendMagicLink","toHaveBeenCalledWith","options","emailRedirectTo","undefined","logout","toHaveBeenCalled","accessControlService","canPerformAction","userId","resource","action","allowed","sessionString","JSON","stringify","toContain","refreshToken","results","Promise","all","forEach"],"mappings":"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"}