{"version":3,"names":["checkB2Health","cov_vvzfumcib","f","s","generateCDNUrl","getB2HealthStatus","initializeB2Client","isB2Healthy","resetB2Client","uploadToB2","s3Client","healthStatus","healthy","lastChecked","Date","config","b","endpoint","accessKeyId","secretAccessKey","bucket","success","error","code","message","details","_clients3","S3Client","region","credentials","forcePathStyle","data","undefined","Error","file","fileName","contentType","circuitBreaker","_circuitBreaker","getCircuitBreaker","failureThreshold","successThreshold","timeout","execute","sanitizedFileName","_sanitization","sanitizeInput","replace","timestamp","now","key","command","PutObjectCommand","Bucket","process","env","B2_BUCKET_NAME","Key","Body","ContentType","CacheControl","send","cdnDomain","B2_CDN_DOMAIN","url","HeadBucketCommand","fiveMinutesAgo","getTime","checkResult"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/b2Service.ts"],"sourcesContent":["import { S3Client, PutObjectCommand, HeadBucketCommand } from '@aws-sdk/client-s3';\nimport { sanitizeInput, sanitizeRichText } from \"../utils/sanitization\";\nimport { getCircuitBreaker } from '../utils/circuitBreaker';\nimport { retryWithBackoff, RetryPresets } from '../utils/retry';\n\ntype Result<T> = \n  | { success: true; data: T } \n  | { success: false; error: { code: string; message: string; details?: any } };\n\ninterface B2Config {\n  endpoint: string;\n  region: string;\n  accessKeyId: string;\n  secretAccessKey: string;\n  bucket: string;\n  cdnDomain: string;\n}\n\ninterface UploadResult {\n  url: string;\n  key: string;\n}\n\ninterface HealthCheckResult {\n  healthy: boolean;\n  lastChecked: Date;\n  error?: string;\n}\n\nlet s3Client: S3Client | null = null;\nlet healthStatus: HealthCheckResult = {\n  healthy: false,\n  lastChecked: new Date(0),\n};\n\n/**\n * Initializes the B2 S3-compatible client with configuration.\n * \n * @param config - B2 configuration including endpoint, credentials, and CDN domain\n * @returns Result indicating success or configuration error\n */\nexport function initializeB2Client(config: B2Config): Result<void> {\n  try {\n    if (!config.endpoint || !config.accessKeyId || !config.secretAccessKey || !config.bucket) {\n      return {\n        success: false,\n        error: {\n          code: 'CONFIGURATION_ERROR',\n          message: 'Missing required B2 configuration',\n          details: { config },\n        },\n      };\n    }\n\n    s3Client = new S3Client({\n      endpoint: config.endpoint,\n      region: config.region,\n      credentials: {\n        accessKeyId: config.accessKeyId,\n        secretAccessKey: config.secretAccessKey,\n      },\n      forcePathStyle: true, // Required for B2 S3-compatible API\n    });\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'INITIALIZATION_ERROR',\n        message: error instanceof Error ? error.message : 'Failed to initialize B2 client',\n        details: error,\n      },\n    };\n  }\n}\n\n/**\n * Uploads a file to Backblaze B2 storage using S3-compatible API.\n * Includes circuit breaker protection and automatic retry with exponential backoff.\n * \n * @param file - File buffer to upload\n * @param fileName - Name for the file (will be sanitized)\n * @param contentType - MIME type of the file\n * @returns Result containing the CDN URL and storage key\n * \n * @example\n * const result = await uploadToB2(fileBuffer, 'photo.jpg', 'image/jpeg');\n * if (result.success) {\n *   console.log('Photo URL:', result.data.url);\n * }\n */\nexport async function uploadToB2(\n  file: Buffer,\n  fileName: string,\n  contentType: string\n): Promise<Result<UploadResult>> {\n  // Get circuit breaker for B2 service\n  const circuitBreaker = getCircuitBreaker('b2-storage', {\n    failureThreshold: 3,\n    successThreshold: 2,\n    timeout: 60000, // 1 minute\n  });\n\n  // Execute with circuit breaker protection\n  return await circuitBreaker.execute(async () => {\n    try {\n      if (!s3Client) {\n        return {\n          success: false,\n          error: {\n            code: 'CLIENT_NOT_INITIALIZED',\n            message: 'B2 client not initialized. Call initializeB2Client first.',\n          },\n        };\n      }\n\n      // Sanitize filename to prevent path traversal\n      const sanitizedFileName = sanitizeInput(fileName).replace(/[^a-zA-Z0-9._-]/g, '_');\n\n      // Generate unique key with timestamp\n      const timestamp = Date.now();\n      const key = `photos/${timestamp}-${sanitizedFileName}`;\n\n      const command = new PutObjectCommand({\n        Bucket: process.env.B2_BUCKET_NAME || '',\n        Key: key,\n        Body: file,\n        ContentType: contentType,\n        CacheControl: 'public, max-age=31536000', // 1 year cache\n      });\n\n      await s3Client.send(command);\n\n      // Generate Cloudflare CDN URL\n      const cdnDomain = process.env.B2_CDN_DOMAIN || '';\n      const url = `https://${cdnDomain}/${key}`;\n\n      return {\n        success: true,\n        data: { url, key },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: {\n          code: 'UPLOAD_ERROR',\n          message: error instanceof Error ? error.message : 'Failed to upload to B2',\n          details: error,\n        },\n      };\n    }\n  });\n}\n\n/**\n * Performs a health check on the B2 storage service.\n * Checks if the bucket is accessible and updates the health status.\n * Includes retry logic for transient failures.\n * \n * @returns Result containing the health check status\n * \n * @example\n * const result = await checkB2Health();\n * if (result.success && result.data.healthy) {\n *   console.log('B2 storage is healthy');\n * }\n */\nexport async function checkB2Health(): Promise<Result<HealthCheckResult>> {\n  try {\n    if (!s3Client) {\n      healthStatus = {\n        healthy: false,\n        lastChecked: new Date(),\n        error: 'B2 client not initialized',\n      };\n      return { success: true, data: healthStatus };\n    }\n\n    const command = new HeadBucketCommand({\n      Bucket: process.env.B2_BUCKET_NAME || '',\n    });\n\n    await s3Client.send(command);\n\n    healthStatus = {\n      healthy: true,\n      lastChecked: new Date(),\n    };\n\n    return { success: true, data: healthStatus };\n  } catch (error) {\n    healthStatus = {\n      healthy: false,\n      lastChecked: new Date(),\n      error: error instanceof Error ? error.message : 'Health check failed',\n    };\n\n    return { success: true, data: healthStatus };\n  }\n}\n\n/**\n * Gets the current health status of B2 storage.\n * Returns cached status without performing a new check.\n * \n * @returns Current health status\n */\nexport function getB2HealthStatus(): HealthCheckResult {\n  return healthStatus;\n}\n\n/**\n * Generates a Cloudflare CDN URL for a given B2 storage key.\n * \n * @param key - Storage key (path) of the file\n * @returns CDN URL for the file\n * \n * @example\n * const url = generateCDNUrl('photos/1234567890-photo.jpg');\n * // Returns: https://cdn.example.com/photos/1234567890-photo.jpg\n */\nexport function generateCDNUrl(key: string): string {\n  const cdnDomain = process.env.B2_CDN_DOMAIN || '';\n  return `https://${cdnDomain}/${key}`;\n}\n\n/**\n * Checks if B2 storage is currently healthy based on the last health check.\n * If the last check was more than 5 minutes ago, performs a new check.\n * \n * @returns Result indicating if B2 is healthy\n */\nexport async function isB2Healthy(): Promise<Result<boolean>> {\n  const now = new Date();\n  const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000);\n\n  // If last check was more than 5 minutes ago, perform new check\n  if (healthStatus.lastChecked < fiveMinutesAgo) {\n    const checkResult = await checkB2Health();\n    if (!checkResult.success) {\n      return checkResult;\n    }\n  }\n\n  return { success: true, data: healthStatus.healthy };\n}\n\n/**\n * Resets the B2 client and health status.\n * Used primarily for testing purposes.\n */\nexport function resetB2Client(): void {\n  s3Client = null;\n  healthStatus = {\n    healthy: false,\n    lastChecked: new Date(0),\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}