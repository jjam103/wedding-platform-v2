{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/sectionsService.circularReferenceDetectionAPI.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { jest, describe, it, expect, beforeEach } from '@jest/globals';\n\n// Mock Supabase before importing services\nconst mockFrom = jest.fn() as jest.MockedFunction<any>;\nconst mockSupabase = {\n  from: mockFrom,\n  auth: {\n    getSession: jest.fn(),\n  },\n};\n\njest.mock('../lib/supabase', () => ({\n  supabase: mockSupabase,\n}));\n\n// Import after mocking\nimport { detectCircularReferences } from './sectionsService';\nimport type { Reference } from '../schemas/cmsSchemas';\n\n// Helper to create properly typed mock chain for sections query\nfunction createSectionsQueryChain(resolvedValue: { data: any; error: any }) {\n  const mockEq2 = (jest.fn() as any).mockResolvedValue(resolvedValue);\n  const mockEq1 = (jest.fn() as any).mockReturnValue({ eq: mockEq2 });\n  const mockSelect = (jest.fn() as any).mockReturnValue({ eq: mockEq1 });\n  return { select: mockSelect } as any;\n}\n\n// Helper to create properly typed mock chain for columns query\nfunction createColumnsQueryChain(resolvedValue: { data: any; error: any }) {\n  const mockEq = (jest.fn() as any).mockResolvedValue(resolvedValue);\n  const mockIn = (jest.fn() as any).mockReturnValue({ eq: mockEq });\n  const mockSelect = (jest.fn() as any).mockReturnValue({ in: mockIn });\n  return { select: mockSelect } as any;\n}\n\n/**\n * Feature: admin-backend-integration-cms, Property 16: Circular Reference Detection API\n * \n * Property: For any reference graph containing a cycle, the circular reference detection API \n * SHALL return true indicating a cycle was found.\n * \n * Validates: Requirements 15.7\n * \n * This test validates that the API correctly detects circular references in various graph structures:\n * - Simple cycles (A → B → A)\n * - Complex cycles (A → B → C → A)\n * - Self-references (A → A)\n * - Multiple reference chains\n */\ndescribe('Feature: admin-backend-integration-cms, Property 16: Circular Reference Detection API', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should detect circular references in any reference graph with cycles', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          // Generate a circular reference graph\n          pageAId: fc.uuid(),\n          pageBId: fc.uuid(),\n          pageCId: fc.uuid(),\n          pageType: fc.constantFrom('activity', 'event', 'accommodation', 'room_type', 'custom'),\n          // Generate cycle type: 2-node (A→B→A) or 3-node (A→B→C→A)\n          cycleLength: fc.constantFrom(2, 3),\n        }).filter(data => {\n          // Ensure all IDs are distinct for valid cycle testing\n          return data.pageAId !== data.pageBId && \n                 data.pageBId !== data.pageCId && \n                 data.pageCId !== data.pageAId;\n        }),\n        async (testData) => {\n          // Property: For any reference graph containing a cycle,\n          // the API SHALL return success: true, data: true\n\n          if (testData.cycleLength === 2) {\n            // Test 2-node cycle: A → B → A\n            \n            // Mock for checking page B\n            mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n              data: [{ id: 'section-b' }],\n              error: null,\n            }));\n\n            // Page B references back to A (creating cycle)\n            mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n              data: [{\n                section_id: 'section-b',\n                content_type: 'references',\n                content_data: {\n                  references: [{\n                    type: testData.pageType,\n                    id: testData.pageAId, // References back to A!\n                  }],\n                },\n              }],\n              error: null,\n            }));\n\n            const references: Reference[] = [{\n              type: testData.pageType as any,\n              id: testData.pageBId,\n            }];\n\n            const result = await detectCircularReferences(testData.pageAId, references);\n\n            // Property validation: API must succeed\n            expect(result.success).toBe(true);\n            \n            if (result.success) {\n              // Property validation: Must detect the cycle\n              expect(result.data).toBe(true);\n            }\n          } else {\n            // Test 3-node cycle: A → B → C → A\n            \n            // Mock for checking page B\n            mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n              data: [{ id: 'section-b' }],\n              error: null,\n            }));\n\n            // Page B references C\n            mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n              data: [{\n                section_id: 'section-b',\n                content_type: 'references',\n                content_data: {\n                  references: [{\n                    type: testData.pageType,\n                    id: testData.pageCId,\n                  }],\n                },\n              }],\n              error: null,\n            }));\n\n            // Mock for checking page C\n            mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n              data: [{ id: 'section-c' }],\n              error: null,\n            }));\n\n            // Page C references back to A (creating cycle)\n            mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n              data: [{\n                section_id: 'section-c',\n                content_type: 'references',\n                content_data: {\n                  references: [{\n                    type: testData.pageType,\n                    id: testData.pageAId, // References back to A!\n                  }],\n                },\n              }],\n              error: null,\n            }));\n\n            const references: Reference[] = [{\n              type: testData.pageType as any,\n              id: testData.pageBId,\n            }];\n\n            const result = await detectCircularReferences(testData.pageAId, references);\n\n            // Property validation: API must succeed\n            expect(result.success).toBe(true);\n            \n            if (result.success) {\n              // Property validation: Must detect the cycle\n              expect(result.data).toBe(true);\n            }\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should detect self-references as circular', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          pageId: fc.uuid(),\n          pageType: fc.constantFrom('activity', 'event', 'accommodation', 'room_type', 'custom'),\n        }),\n        async (testData) => {\n          // Property: Self-reference (A → A) is a special case of circular reference\n          // The API should detect this immediately\n          \n          const references: Reference[] = [{\n            type: testData.pageType as any,\n            id: testData.pageId, // Self-reference\n          }];\n\n          const result = await detectCircularReferences(testData.pageId, references);\n\n          // Property validation: API must succeed\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            // Property validation: Must detect self-reference as circular\n            expect(result.data).toBe(true);\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should not detect cycles in acyclic graphs', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          pageAId: fc.uuid(),\n          pageBId: fc.uuid(),\n          pageCId: fc.uuid(),\n          pageType: fc.constantFrom('activity', 'event', 'accommodation', 'room_type', 'custom'),\n        }).filter(data => {\n          // Ensure all IDs are distinct\n          return data.pageAId !== data.pageBId && \n                 data.pageBId !== data.pageCId && \n                 data.pageCId !== data.pageAId;\n        }),\n        async (testData) => {\n          // Property: For acyclic graphs (A → B → C), the API should return false\n          \n          // Mock for checking page B\n          mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n            data: [{ id: 'section-b' }],\n            error: null,\n          }));\n\n          // Page B references C (no cycle)\n          mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n            data: [{\n              section_id: 'section-b',\n              content_type: 'references',\n              content_data: {\n                references: [{\n                  type: testData.pageType,\n                  id: testData.pageCId,\n                }],\n              },\n            }],\n            error: null,\n          }));\n\n          // Mock for checking page C\n          mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n            data: [{ id: 'section-c' }],\n            error: null,\n          }));\n\n          // Page C has no references (terminates the chain)\n          mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n            data: [], // No references\n            error: null,\n          }));\n\n          const references: Reference[] = [{\n            type: testData.pageType as any,\n            id: testData.pageBId,\n          }];\n\n          const result = await detectCircularReferences(testData.pageAId, references);\n\n          // Property validation: API must succeed\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            // Property validation: Must NOT detect a cycle in acyclic graph\n            expect(result.data).toBe(false);\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle multiple references correctly', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          pageAId: fc.uuid(),\n          pageBId: fc.uuid(),\n          pageCId: fc.uuid(),\n          pageDId: fc.uuid(),\n          pageType: fc.constantFrom('activity', 'event', 'accommodation', 'room_type', 'custom'),\n          // One reference creates a cycle, one doesn't\n          cyclicRefIndex: fc.constantFrom(0, 1),\n        }).filter(data => {\n          // Ensure all IDs are distinct\n          const ids = [data.pageAId, data.pageBId, data.pageCId, data.pageDId];\n          return new Set(ids).size === ids.length;\n        }),\n        async (testData) => {\n          // Property: When checking multiple references, if ANY creates a cycle,\n          // the API should detect it\n          \n          // Setup: B creates a cycle (B → A), D does not (D has no refs)\n          \n          if (testData.cyclicRefIndex === 0) {\n            // First reference (B) creates cycle\n            \n            // Mock for checking page B (cyclic)\n            mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n              data: [{ id: 'section-b' }],\n              error: null,\n            }));\n\n            // Page B references back to A (cycle!)\n            mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n              data: [{\n                section_id: 'section-b',\n                content_type: 'references',\n                content_data: {\n                  references: [{\n                    type: testData.pageType,\n                    id: testData.pageAId,\n                  }],\n                },\n              }],\n              error: null,\n            }));\n\n            const references: Reference[] = [\n              {\n                type: testData.pageType as any,\n                id: testData.pageBId, // Cyclic\n              },\n              {\n                type: testData.pageType as any,\n                id: testData.pageDId, // Non-cyclic (won't be checked due to early detection)\n              },\n            ];\n\n            const result = await detectCircularReferences(testData.pageAId, references);\n\n            // Property validation: API must succeed\n            expect(result.success).toBe(true);\n            \n            if (result.success) {\n              // Property validation: Must detect the cycle\n              expect(result.data).toBe(true);\n            }\n          } else {\n            // Second reference (D) would create cycle, but we check first ref (C) first\n            \n            // Mock for checking page C (non-cyclic)\n            mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n              data: [{ id: 'section-c' }],\n              error: null,\n            }));\n\n            // Page C has no references\n            mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n              data: [],\n              error: null,\n            }));\n\n            // Mock for checking page D (cyclic)\n            mockFrom.mockReturnValueOnce(createSectionsQueryChain({\n              data: [{ id: 'section-d' }],\n              error: null,\n            }));\n\n            // Page D references back to A (cycle!)\n            mockFrom.mockReturnValueOnce(createColumnsQueryChain({\n              data: [{\n                section_id: 'section-d',\n                content_type: 'references',\n                content_data: {\n                  references: [{\n                    type: testData.pageType,\n                    id: testData.pageAId,\n                  }],\n                },\n              }],\n              error: null,\n            }));\n\n            const references: Reference[] = [\n              {\n                type: testData.pageType as any,\n                id: testData.pageCId, // Non-cyclic\n              },\n              {\n                type: testData.pageType as any,\n                id: testData.pageDId, // Cyclic\n              },\n            ];\n\n            const result = await detectCircularReferences(testData.pageAId, references);\n\n            // Property validation: API must succeed\n            expect(result.success).toBe(true);\n            \n            if (result.success) {\n              // Property validation: Must detect the cycle\n              expect(result.data).toBe(true);\n            }\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 50 } // Fewer runs due to complex setup\n    );\n  });\n\n  it('should handle empty reference arrays', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          pageId: fc.uuid(),\n        }),\n        async (testData) => {\n          // Property: Empty reference array should not detect cycles\n          \n          const references: Reference[] = [];\n\n          const result = await detectCircularReferences(testData.pageId, references);\n\n          // Property validation: API must succeed\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            // Property validation: No cycles in empty array\n            expect(result.data).toBe(false);\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["mockFrom","jest","fn","mockSupabase","from","auth","getSession","mock","supabase","createSectionsQueryChain","resolvedValue","mockEq2","mockResolvedValue","mockEq1","mockReturnValue","eq","mockSelect","select","createColumnsQueryChain","mockEq","mockIn","in","describe","beforeEach","clearAllMocks","it","fc","assert","asyncProperty","record","pageAId","uuid","pageBId","pageCId","pageType","constantFrom","cycleLength","filter","data","testData","mockReturnValueOnce","id","error","section_id","content_type","content_data","references","type","result","detectCircularReferences","expect","success","toBe","numRuns","pageId","pageDId","cyclicRefIndex","ids","Set","size","length"],"mappings":"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"}