{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/SectionEditor.photoIntegration.test.tsx"],"sourcesContent":["/**\n * Unit Tests for SectionEditor Photo Integration\n * \n * Tests:\n * - Photo selection\n * - Multiple photo handling\n * - Photo preview\n * \n * Requirements: 2.4\n */\n\nimport { render, screen, fireEvent, waitFor, cleanup } from '@testing-library/react';\nimport { SectionEditor } from './SectionEditor';\n\n// Mock fetch globally\nglobal.fetch = jest.fn();\n\n// Mock window.confirm\nconst originalConfirm = window.confirm;\n\n// Mock scrollIntoView\nElement.prototype.scrollIntoView = jest.fn();\n\n// Mock photo data\nconst mockPhotos = [\n  {\n    id: 'photo-1',\n    photo_url: 'https://example.com/photo1.jpg',\n    caption: 'Beach sunset',\n    alt_text: 'Beautiful sunset at the beach',\n    moderation_status: 'approved' as const,\n    created_at: '2025-01-01T00:00:00Z',\n  },\n  {\n    id: 'photo-2',\n    photo_url: 'https://example.com/photo2.jpg',\n    caption: 'Wedding ceremony',\n    alt_text: 'Ceremony at the venue',\n    moderation_status: 'approved' as const,\n    created_at: '2025-01-02T00:00:00Z',\n  },\n  {\n    id: 'photo-3',\n    photo_url: 'https://example.com/photo3.jpg',\n    caption: 'Reception dinner',\n    alt_text: 'Dinner reception',\n    moderation_status: 'approved' as const,\n    created_at: '2025-01-03T00:00:00Z',\n  },\n];\n\n// Mock section with photo gallery column\nconst mockPhotoSection = {\n  id: 'section-1',\n  page_type: 'custom' as const,\n  page_id: 'page-1',\n  display_order: 0,\n  created_at: '2024-01-01T00:00:00Z',\n  updated_at: '2024-01-01T00:00:00Z',\n  columns: [\n    {\n      id: 'column-1',\n      section_id: 'section-1',\n      column_number: 1 as const,\n      content_type: 'photo_gallery' as const,\n      content_data: { photo_ids: [] },\n      created_at: '2024-01-01T00:00:00Z',\n      updated_at: '2024-01-01T00:00:00Z',\n    },\n  ],\n};\n\nconst mockPhotoSectionWithPhotos = {\n  ...mockPhotoSection,\n  columns: [\n    {\n      ...mockPhotoSection.columns[0],\n      content_data: { photo_ids: ['photo-1', 'photo-2'] },\n    },\n  ],\n};\n\ndescribe('SectionEditor - Photo Integration', () => {\n  let mockOnSave: jest.Mock;\n  let mockOnClose: jest.Mock;\n\n  beforeEach(() => {\n    mockOnSave = jest.fn();\n    mockOnClose = jest.fn();\n    window.confirm = jest.fn().mockReturnValue(true);\n    (global.fetch as jest.Mock).mockReset();\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    cleanup();\n    window.confirm = originalConfirm;\n  });\n\n  const mockFetchSuccess = (data: any) => {\n    (global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ success: true, data }),\n    });\n  };\n\n  describe('Photo Selection', () => {\n    it('should display PhotoPicker component for photo_gallery column type', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        // PhotoPicker should render the \"Add Photos from Gallery\" button\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n    });\n\n    it('should open photo picker modal when add photos button is clicked', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // Photos API response\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n    });\n\n    it('should fetch photos when photo picker opens', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 });\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('/api/admin/photos')\n        );\n      });\n    });\n\n    it('should update section when photo is selected', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // Photos API\n      mockFetchSuccess(mockPhotoSectionWithPhotos); // Update section API\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByAltText('Beautiful sunset at the beach')).toBeInTheDocument();\n      });\n\n      // Select a photo\n      fireEvent.click(screen.getByAltText('Beautiful sunset at the beach'));\n\n      // Close the modal\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('/api/admin/sections/section-1'),\n          expect.objectContaining({\n            method: 'PUT',\n            body: expect.stringContaining('photo_ids'),\n          })\n        );\n      });\n    });\n\n    it('should pass correct pageType to PhotoPicker', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"event\"\n          pageId=\"event-123\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        // The PhotoPicker should be rendered with the correct pageType\n        // This is verified by checking that the component renders\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n    });\n\n    it('should pass correct pageId to PhotoPicker', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 });\n\n      render(\n        <SectionEditor\n          pageType=\"activity\"\n          pageId=\"activity-456\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('page_id=activity-456')\n        );\n      });\n    });\n\n    it('should disable photo picker when section is saving', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      \n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      // Mock a delayed response for section update\n      (global.fetch as jest.Mock).mockImplementationOnce(() =>\n        new Promise(resolve => setTimeout(() => resolve({\n          ok: true,\n          json: async () => ({ success: true, data: mockPhotoSection }),\n        }), 100))\n      );\n\n      // Trigger a save operation by toggling layout\n      const layoutSelect = screen.getAllByRole('combobox')[0]; // First select is layout\n      fireEvent.change(layoutSelect, { target: { value: 'two-column' } });\n\n      // Photo picker button should be disabled during save\n      await waitFor(() => {\n        const addPhotosButton = screen.getByText('+ Add Photos from Gallery');\n        expect(addPhotosButton).toBeDisabled();\n      });\n    });\n  });\n\n  describe('Multiple Photo Handling', () => {\n    it('should display selected photos count', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n    });\n\n    it('should display all selected photos in preview grid', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker\n      // Mock individual photo fetches for selected photos\n      mockFetchSuccess(mockPhotos[0]); // photo-1\n      mockFetchSuccess(mockPhotos[1]); // photo-2\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Wait for photos to be fetched and displayed\n      await waitFor(() => {\n        const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n        const images = photoGrid?.querySelectorAll('img');\n        expect(images?.length).toBe(2);\n      }, { timeout: 3000 });\n    });\n\n    it('should allow selecting multiple photos', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // Photos API\n      mockFetchSuccess(mockPhotoSection); // First update with 1 photo\n      mockFetchSuccess(mockPhotoSectionWithPhotos); // Second update with 2 photos\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByAltText('Beautiful sunset at the beach')).toBeInTheDocument();\n      });\n\n      // Select first photo\n      fireEvent.click(screen.getByAltText('Beautiful sunset at the beach'));\n      \n      // Wait for first update\n      await waitFor(() => {\n        const firstUpdateCall = (global.fetch as jest.Mock).mock.calls.find(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(firstUpdateCall).toBeDefined();\n      });\n\n      // Select second photo\n      fireEvent.click(screen.getByAltText('Ceremony at the venue'));\n\n      // Close modal\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Should have made at least 2 update calls (one for each photo selection)\n        const updateCalls = (global.fetch as jest.Mock).mock.calls.filter(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(updateCalls.length).toBeGreaterThanOrEqual(1);\n        \n        // The last update should contain both photos\n        const lastUpdateCall = updateCalls[updateCalls.length - 1];\n        if (lastUpdateCall) {\n          const body = JSON.parse(lastUpdateCall[1].body);\n          // Should have at least one photo selected\n          expect(body.columns[0].content_data.photo_ids.length).toBeGreaterThan(0);\n        }\n      });\n    });\n\n    it('should allow removing individual photos from selection', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      // Mock individual photo fetches for selected photos\n      mockFetchSuccess(mockPhotos[0]); // photo-1\n      mockFetchSuccess(mockPhotos[1]); // photo-2\n      mockFetchSuccess(mockPhotoSection); // Update with 1 photo after removal\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Wait for photos to be fetched and displayed\n      await waitFor(() => {\n        const removeButtons = screen.getAllByLabelText('Remove photo');\n        expect(removeButtons.length).toBeGreaterThan(0);\n        fireEvent.click(removeButtons[0]);\n      }, { timeout: 3000 });\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('/api/admin/sections/section-1'),\n          expect.objectContaining({\n            method: 'PUT',\n          })\n        );\n      });\n    });\n\n    it('should allow clearing all selected photos', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess(mockPhotoSection); // Update with 0 photos\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Click \"Clear All\" button\n      fireEvent.click(screen.getByText('Clear All'));\n\n      await waitFor(() => {\n        const updateCall = (global.fetch as jest.Mock).mock.calls.find(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(updateCall).toBeDefined();\n        const body = JSON.parse(updateCall[1].body);\n        expect(body.columns[0].content_data.photo_ids).toHaveLength(0);\n      });\n    });\n\n    it('should maintain photo order in selection', async () => {\n      const orderedPhotoSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_data: { photo_ids: ['photo-3', 'photo-1', 'photo-2'] },\n          },\n        ],\n      };\n      mockFetchSuccess([orderedPhotoSection]);\n      // Mock individual photo fetches in order\n      mockFetchSuccess(mockPhotos[2]); // photo-3\n      mockFetchSuccess(mockPhotos[0]); // photo-1\n      mockFetchSuccess(mockPhotos[1]); // photo-2\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (3)')).toBeInTheDocument();\n      });\n\n      // Wait for photos to be fetched and displayed\n      await waitFor(() => {\n        const photoGrid = screen.getByText('Selected Photos (3)').closest('.border');\n        const images = photoGrid?.querySelectorAll('img');\n        expect(images?.length).toBe(3);\n      }, { timeout: 3000 });\n    });\n\n    it('should handle empty photo selection', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        // Should not show \"Selected Photos\" section when no photos selected\n        expect(screen.queryByText(/Selected Photos/)).not.toBeInTheDocument();\n        \n        // Should show the add photos button\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n    });\n  });\n\n  describe('Photo Preview', () => {\n    it('should display photo thumbnails in selected photos section', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      // Mock individual photo fetches for selected photos\n      mockFetchSuccess(mockPhotos[0]); // photo-1\n      mockFetchSuccess(mockPhotos[1]); // photo-2\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Wait for photos to be fetched and displayed\n      await waitFor(() => {\n        const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n        const images = photoGrid?.querySelectorAll('img');\n        expect(images?.length).toBe(2);\n      }, { timeout: 3000 });\n    });\n\n    it('should display photo captions in preview', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker to resolve photo details\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Captions should be visible in the preview grid\n      const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n      expect(photoGrid).toBeInTheDocument();\n    });\n\n    it('should show photos in guest preview modal', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Open preview modal by clicking Guest Preview button\n      fireEvent.click(screen.getByText('Guest Preview'));\n\n      await waitFor(() => {\n        // Preview should show photo placeholders\n        const previewSection = screen.getByText('Guest Preview').closest('.border');\n        expect(previewSection).toBeInTheDocument();\n        \n        // The preview will show photo content or loading state\n        expect(previewSection?.textContent).toContain('photo');\n      }, { timeout: 3000 });\n    });\n\n    it('should show \"No photos selected\" message in preview when empty', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Open preview by clicking Guest Preview button\n      fireEvent.click(screen.getByText('Guest Preview'));\n\n      await waitFor(() => {\n        // Should show empty state message\n        expect(screen.getByText('No photos selected')).toBeInTheDocument();\n      });\n    });\n\n    it('should display photo grid layout in preview', async () => {\n      const multiPhotoSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_data: { photo_ids: ['photo-1', 'photo-2', 'photo-3'] },\n          },\n        ],\n      };\n      mockFetchSuccess([multiPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Open preview by clicking Guest Preview button\n      fireEvent.click(screen.getByText('Guest Preview'));\n\n      await waitFor(() => {\n        // Preview should use grid layout for photos\n        const previewSection = screen.getByText('Guest Preview').closest('.border');\n        const photoGrid = previewSection?.querySelector('.grid.grid-cols-2');\n        expect(photoGrid).toBeInTheDocument();\n      });\n    });\n\n    it('should show hover effects on photo thumbnails', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      // Mock individual photo fetches for selected photos\n      mockFetchSuccess(mockPhotos[0]); // photo-1\n      mockFetchSuccess(mockPhotos[1]); // photo-2\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Wait for photos to be fetched and displayed\n      await waitFor(() => {\n        const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n        const photoContainers = photoGrid?.querySelectorAll('.group');\n        expect(photoContainers?.length).toBeGreaterThan(0);\n      }, { timeout: 3000 });\n    });\n\n    it('should display remove button on hover', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      // Mock individual photo fetches for selected photos\n      mockFetchSuccess(mockPhotos[0]); // photo-1\n      mockFetchSuccess(mockPhotos[1]); // photo-2\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Wait for photos to be fetched and displayed\n      await waitFor(() => {\n        const removeButtons = screen.getAllByLabelText('Remove photo');\n        expect(removeButtons.length).toBe(2);\n        \n        // Buttons should have group-hover:opacity-100 class\n        removeButtons.forEach(button => {\n          expect(button.className).toContain('group-hover:opacity-100');\n        });\n      }, { timeout: 3000 });\n    });\n  });\n\n  describe('Column Type Change to Photo Gallery', () => {\n    it('should initialize empty photo_ids when changing to photo_gallery type', async () => {\n      const richTextSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_type: 'rich_text' as const,\n            content_data: { html: '<p>Some text</p>' },\n          },\n        ],\n      };\n      mockFetchSuccess([richTextSection]);\n      mockFetchSuccess(mockPhotoSection); // Updated to photo_gallery\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        // Find the column type selector (second combobox - first is layout selector)\n        const selects = screen.getAllByRole('combobox');\n        expect(selects.length).toBeGreaterThan(1);\n      });\n\n      // Change column type to photo_gallery (second combobox)\n      const selects = screen.getAllByRole('combobox');\n      const columnTypeSelect = selects[1]; // Second select is column type\n      fireEvent.change(columnTypeSelect, { target: { value: 'photo_gallery' } });\n\n      await waitFor(() => {\n        const updateCall = (global.fetch as jest.Mock).mock.calls.find(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(updateCall).toBeDefined();\n        const body = JSON.parse(updateCall[1].body);\n        expect(body.columns[0].content_type).toBe('photo_gallery');\n        expect(body.columns[0].content_data).toEqual({ photo_ids: [], display_mode: 'gallery' });\n      });\n    });\n\n    it('should display PhotoPicker after changing column type to photo_gallery', async () => {\n      const richTextSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_type: 'rich_text' as const,\n            content_data: { html: '<p>Some text</p>' },\n          },\n        ],\n      };\n      mockFetchSuccess([richTextSection]);\n      mockFetchSuccess(mockPhotoSection); // Updated to photo_gallery\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('#1')).toBeInTheDocument();\n      });\n\n      // Click Edit button to expand section\n      fireEvent.click(screen.getByRole('button', { name: /edit/i }));\n\n      await waitFor(() => {\n        // Find the column type selector (second combobox)\n        const selects = screen.getAllByRole('combobox');\n        expect(selects.length).toBeGreaterThan(1);\n      });\n\n      // Change column type to photo_gallery (second combobox)\n      const selects = screen.getAllByRole('combobox');\n      const columnTypeSelect = selects[1]; // Second select is column type\n      fireEvent.change(columnTypeSelect, { target: { value: 'photo_gallery' } });\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n    });\n  });\n});\n"],"names":["global","fetch","jest","fn","originalConfirm","window","confirm","Element","prototype","scrollIntoView","mockPhotos","id","photo_url","caption","alt_text","moderation_status","created_at","mockPhotoSection","page_type","page_id","display_order","updated_at","columns","section_id","column_number","content_type","content_data","photo_ids","mockPhotoSectionWithPhotos","describe","mockOnSave","mockOnClose","beforeEach","mockReturnValue","mockReset","clearAllMocks","afterEach","cleanup","mockFetchSuccess","data","mockResolvedValueOnce","ok","json","success","it","render","SectionEditor","pageType","pageId","onSave","onClose","waitFor","expect","screen","getByText","toBeInTheDocument","fireEvent","click","getByRole","name","photos","total","toHaveBeenCalledWith","stringContaining","getByAltText","objectContaining","method","body","mockImplementationOnce","Promise","resolve","setTimeout","layoutSelect","getAllByRole","change","target","value","addPhotosButton","toBeDisabled","photoGrid","closest","images","querySelectorAll","length","toBe","timeout","firstUpdateCall","mock","calls","find","call","includes","toBeDefined","updateCalls","filter","toBeGreaterThanOrEqual","lastUpdateCall","JSON","parse","toBeGreaterThan","removeButtons","getAllByLabelText","updateCall","toHaveLength","orderedPhotoSection","queryByText","not","previewSection","textContent","toContain","multiPhotoSection","querySelector","photoContainers","forEach","button","className","richTextSection","html","selects","columnTypeSelect","toEqual","display_mode"],"mappings":"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"}