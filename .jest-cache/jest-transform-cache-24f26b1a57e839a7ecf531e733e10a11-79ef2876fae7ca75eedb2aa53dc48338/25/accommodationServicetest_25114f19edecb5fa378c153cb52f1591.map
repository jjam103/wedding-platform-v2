{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/accommodationService.test.ts"],"sourcesContent":["/**\n * Test Suite: Accommodation Service\n * \n * Tests for accommodation management service including room type management\n * and guest assignments.\n * \n * Follows the 4-path testing pattern:\n * 1. Success path - Valid input returns success\n * 2. Validation error - Invalid input returns VALIDATION_ERROR\n * 3. Database error - DB failure returns DATABASE_ERROR\n * 4. Security - Malicious input is sanitized\n */\n\nimport { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';\nimport type { \n  CreateAccommodationDTO, \n  UpdateAccommodationDTO,\n  CreateRoomTypeDTO,\n  UpdateRoomTypeDTO,\n  CreateRoomAssignmentDTO,\n  UpdateRoomAssignmentDTO,\n  CalculateCostDTO\n} from '@/schemas/accommodationSchemas';\n\n// Set up environment variables BEFORE any imports\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\nprocess.env.SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n\n// Mock Supabase client creation BEFORE any imports - Pattern A\njest.mock('@supabase/supabase-js', () => {\n  const mockFrom = jest.fn();\n  const mockSupabaseClient = {\n    from: mockFrom,\n  };\n  \n  return {\n    createClient: jest.fn(() => mockSupabaseClient),\n    __mockFrom: mockFrom, // Export for test access\n  };\n});\n\n// Import service using require() AFTER mocking\nconst accommodationService = require('./accommodationService');\n\n// Get the mocked from function\nconst { __mockFrom: mockFrom } = require('@supabase/supabase-js');\n\ndescribe('accommodationService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Set up environment variables for the service\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n    \n    // Reset Supabase mocks to default successful state\n    mockFrom.mockReturnValue({\n      select: jest.fn().mockResolvedValue({ data: [], error: null }),\n      insert: jest.fn().mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({ data: null, error: null }),\n        }),\n      }),\n    });\n  });\n\n  // ============================================================================\n  // ACCOMMODATION CRUD OPERATIONS TESTS\n  // ============================================================================\n\n  describe('createAccommodation', () => {\n    const validData: CreateAccommodationDTO = {\n      name: 'Costa Rica Beach Resort',\n      locationId: '123e4567-e89b-12d3-a456-426614174000',\n      description: 'Beautiful beachfront resort',\n      address: '123 Beach Road, Costa Rica',\n      status: 'published',\n    };\n\n    it('should return success with accommodation data when valid input provided', async () => {\n      const mockAccommodation = {\n        id: 'accommodation-1',\n        name: validData.name,\n        location_id: validData.locationId,\n        description: validData.description,\n        address: validData.address,\n        status: validData.status,\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockAccommodation, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createAccommodation(validData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('accommodation-1');\n        expect(result.data.name).toBe('Costa Rica Beach Resort');\n        expect(result.data.locationId).toBe(validData.locationId);\n      }\n    });\n\n    it('should return VALIDATION_ERROR when name is missing', async () => {\n      const invalidData = { ...validData, name: '' };\n      const result = await accommodationService.createAccommodation(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return VALIDATION_ERROR when name exceeds 200 characters', async () => {\n      const invalidData = { ...validData, name: 'a'.repeat(201) };\n      const result = await accommodationService.createAccommodation(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return DATABASE_ERROR when insert fails', async () => {\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ \n              data: null, \n              error: { message: 'Connection failed', code: 'DB_ERROR' } \n            }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createAccommodation(validData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n\n    it('should sanitize input to prevent XSS attacks', async () => {\n      const maliciousData = {\n        ...validData,\n        name: '<script>alert(\"xss\")</script>Resort',\n        description: '<img src=x onerror=alert(1)>Description',\n        address: '<script>alert(\"xss\")</script>123 Beach Road',\n      };\n\n      const mockAccommodation = {\n        id: 'accommodation-1',\n        name: 'Resort',\n        location_id: validData.locationId,\n        description: 'Description',\n        address: '123 Beach Road',\n        status: validData.status,\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockAccommodation, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createAccommodation(maliciousData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.name).not.toContain('<script>');\n        expect(result.data.description).not.toContain('<img');\n        expect(result.data.address).not.toContain('<script>');\n      }\n    });\n  });\n\n  describe('getAccommodation', () => {\n    const validId = '123e4567-e89b-12d3-a456-426614174000';\n\n    it('should return accommodation when valid ID provided', async () => {\n      const mockAccommodation = {\n        id: validId,\n        name: 'Costa Rica Beach Resort',\n        location_id: null,\n        description: 'Beautiful resort',\n        address: '123 Beach Road',\n        status: 'published',\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockAccommodation, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.getAccommodation(validId);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe(validId);\n        expect(result.data.name).toBe('Costa Rica Beach Resort');\n      }\n    });\n\n    it('should return NOT_FOUND when accommodation does not exist', async () => {\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ \n              data: null, \n              error: { code: 'PGRST116', message: 'No rows found' } \n            }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.getAccommodation(validId);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('NOT_FOUND');\n      }\n    });\n\n    it('should return DATABASE_ERROR when database query fails', async () => {\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ \n              data: null, \n              error: { message: 'Connection failed', code: 'DB_ERROR' } \n            }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.getAccommodation(validId);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  // ============================================================================\n  // ROOM TYPE CRUD OPERATIONS TESTS\n  // ============================================================================\n\n  describe('createRoomType', () => {\n    const validData: CreateRoomTypeDTO = {\n      accommodationId: '123e4567-e89b-12d3-a456-426614174000',\n      name: 'Deluxe Ocean View',\n      description: 'Spacious room with ocean view',\n      capacity: 2,\n      totalRooms: 10,\n      pricePerNight: 200,\n      hostSubsidyPerNight: 50,\n      status: 'published',\n    };\n\n    it('should return success with room type data when valid input provided', async () => {\n      const mockRoomType = {\n        id: 'room-type-1',\n        accommodation_id: validData.accommodationId,\n        name: validData.name,\n        description: validData.description,\n        capacity: validData.capacity,\n        total_rooms: validData.totalRooms,\n        price_per_night: validData.pricePerNight,\n        host_subsidy_per_night: validData.hostSubsidyPerNight,\n        status: validData.status,\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockRoomType, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createRoomType(validData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('room-type-1');\n        expect(result.data.name).toBe('Deluxe Ocean View');\n        expect(result.data.capacity).toBe(2);\n        expect(result.data.totalRooms).toBe(10);\n        expect(result.data.pricePerNight).toBe(200);\n        expect(result.data.hostSubsidyPerNight).toBe(50);\n      }\n    });\n\n    it('should return VALIDATION_ERROR when name is missing', async () => {\n      const invalidData = { ...validData, name: '' };\n      const result = await accommodationService.createRoomType(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return VALIDATION_ERROR when capacity is not positive', async () => {\n      const invalidData = { ...validData, capacity: 0 };\n      const result = await accommodationService.createRoomType(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return VALIDATION_ERROR when hostSubsidyPerNight exceeds pricePerNight', async () => {\n      const invalidData = { ...validData, hostSubsidyPerNight: 250 }; // Greater than pricePerNight (200)\n      const result = await accommodationService.createRoomType(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should sanitize input to prevent XSS attacks', async () => {\n      const maliciousData = {\n        ...validData,\n        name: '<script>alert(\"xss\")</script>Deluxe Room',\n        description: '<img src=x onerror=alert(1)>Ocean view room',\n      };\n\n      const mockRoomType = {\n        id: 'room-type-1',\n        accommodation_id: validData.accommodationId,\n        name: 'Deluxe Room',\n        description: 'Ocean view room',\n        capacity: validData.capacity,\n        total_rooms: validData.totalRooms,\n        price_per_night: validData.pricePerNight,\n        host_subsidy_per_night: validData.hostSubsidyPerNight,\n        status: validData.status,\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockRoomType, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createRoomType(maliciousData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.name).not.toContain('<script>');\n        expect(result.data.description).not.toContain('<img');\n      }\n    });\n  });\n\n  describe('listRoomTypes', () => {\n    const accommodationId = '123e4567-e89b-12d3-a456-426614174000';\n\n    it('should return room types for accommodation', async () => {\n      const mockRoomTypes = [\n        {\n          id: 'room-type-1',\n          accommodation_id: accommodationId,\n          name: 'Standard Room',\n          description: null,\n          capacity: 2,\n          total_rooms: 5,\n          price_per_night: 150,\n          host_subsidy_per_night: null,\n          status: 'published',\n          created_at: '2024-01-01T00:00:00Z',\n          updated_at: '2024-01-01T00:00:00Z',\n        },\n        {\n          id: 'room-type-2',\n          accommodation_id: accommodationId,\n          name: 'Deluxe Room',\n          description: 'Ocean view',\n          capacity: 2,\n          total_rooms: 3,\n          price_per_night: 200,\n          host_subsidy_per_night: 50,\n          status: 'published',\n          created_at: '2024-01-01T00:00:00Z',\n          updated_at: '2024-01-01T00:00:00Z',\n        },\n      ];\n\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({ data: mockRoomTypes, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.listRoomTypes(accommodationId);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toHaveLength(2);\n        expect(result.data[0].name).toBe('Standard Room');\n        expect(result.data[1].name).toBe('Deluxe Room');\n      }\n    });\n\n    it('should return DATABASE_ERROR when query fails', async () => {\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({ \n              data: null, \n              error: { message: 'Connection failed', code: 'DB_ERROR' } \n            }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.listRoomTypes(accommodationId);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  // ============================================================================\n  // ROOM ASSIGNMENT OPERATIONS TESTS\n  // ============================================================================\n\n  describe('createRoomAssignment', () => {\n    const validData: CreateRoomAssignmentDTO = {\n      roomTypeId: '123e4567-e89b-12d3-a456-426614174000',\n      guestId: '456e7890-e89b-12d3-a456-426614174000',\n      checkIn: '2024-06-01',\n      checkOut: '2024-06-05',\n      notes: 'Special dietary requirements',\n    };\n\n    it('should return success with room assignment data when valid input provided', async () => {\n      const mockAssignment = {\n        id: 'assignment-1',\n        room_type_id: validData.roomTypeId,\n        guest_id: validData.guestId,\n        check_in: validData.checkIn,\n        check_out: validData.checkOut,\n        notes: validData.notes,\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockAssignment, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createRoomAssignment(validData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('assignment-1');\n        expect(result.data.roomTypeId).toBe(validData.roomTypeId);\n        expect(result.data.guestId).toBe(validData.guestId);\n        expect(result.data.checkIn).toBe(validData.checkIn);\n        expect(result.data.checkOut).toBe(validData.checkOut);\n      }\n    });\n\n    it('should return VALIDATION_ERROR when checkOut is before checkIn', async () => {\n      const invalidData = { \n        ...validData, \n        checkIn: '2024-06-05',\n        checkOut: '2024-06-01' \n      };\n      const result = await accommodationService.createRoomAssignment(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return CONFLICT when guest already has assignment for dates', async () => {\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ \n              data: null, \n              error: { code: '23505', message: 'Duplicate key violation' } \n            }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createRoomAssignment(validData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CONFLICT');\n      }\n    });\n\n    it('should sanitize notes to prevent XSS attacks', async () => {\n      const maliciousData = {\n        ...validData,\n        notes: '<script>alert(\"xss\")</script>Special requirements',\n      };\n\n      const mockAssignment = {\n        id: 'assignment-1',\n        room_type_id: validData.roomTypeId,\n        guest_id: validData.guestId,\n        check_in: validData.checkIn,\n        check_out: validData.checkOut,\n        notes: 'Special requirements',\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockAssignment, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.createRoomAssignment(maliciousData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.notes).not.toContain('<script>');\n      }\n    });\n  });\n\n  describe('listGuestRoomAssignments', () => {\n    const guestId = '456e7890-e89b-12d3-a456-426614174000';\n\n    it('should return room assignments for guest', async () => {\n      const mockAssignments = [\n        {\n          id: 'assignment-1',\n          room_type_id: '123e4567-e89b-12d3-a456-426614174000',\n          guest_id: guestId,\n          check_in: '2024-06-01',\n          check_out: '2024-06-05',\n          notes: null,\n          created_at: '2024-01-01T00:00:00Z',\n          updated_at: '2024-01-01T00:00:00Z',\n        },\n      ];\n\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({ data: mockAssignments, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.listGuestRoomAssignments(guestId);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toHaveLength(1);\n        expect(result.data[0].guestId).toBe(guestId);\n      }\n    });\n  });\n\n  describe('listRoomTypeAssignments', () => {\n    const roomTypeId = '123e4567-e89b-12d3-a456-426614174000';\n\n    it('should return room assignments for room type', async () => {\n      const mockAssignments = [\n        {\n          id: 'assignment-1',\n          room_type_id: roomTypeId,\n          guest_id: '456e7890-e89b-12d3-a456-426614174000',\n          check_in: '2024-06-01',\n          check_out: '2024-06-05',\n          notes: null,\n          created_at: '2024-01-01T00:00:00Z',\n          updated_at: '2024-01-01T00:00:00Z',\n        },\n      ];\n\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({ data: mockAssignments, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.listRoomTypeAssignments(roomTypeId);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toHaveLength(1);\n        expect(result.data[0].roomTypeId).toBe(roomTypeId);\n      }\n    });\n  });\n\n  // ============================================================================\n  // COST CALCULATION OPERATIONS TESTS\n  // ============================================================================\n\n  describe('calculateRoomCost', () => {\n    const validParams: CalculateCostDTO = {\n      roomTypeId: '123e4567-e89b-12d3-a456-426614174000',\n      checkIn: '2024-06-01',\n      checkOut: '2024-06-05',\n    };\n\n    it('should calculate cost correctly with subsidy', async () => {\n      const mockRoomType = {\n        id: validParams.roomTypeId,\n        accommodation_id: '123e4567-e89b-12d3-a456-426614174000',\n        name: 'Deluxe Room',\n        description: null,\n        capacity: 2,\n        total_rooms: 10,\n        price_per_night: 200,\n        host_subsidy_per_night: 50,\n        status: 'published',\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      // Mock the query chain for getRoomType\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockRoomType, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.calculateRoomCost(validParams);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.numberOfNights).toBe(4); // June 1-5 = 4 nights\n        expect(result.data.pricePerNight).toBe(200);\n        expect(result.data.subsidyPerNight).toBe(50);\n        expect(result.data.totalCost).toBe(800); // 200 * 4\n        expect(result.data.totalSubsidy).toBe(200); // 50 * 4\n        expect(result.data.guestCost).toBe(600); // 800 - 200\n      }\n    });\n\n    it('should calculate cost correctly without subsidy', async () => {\n      const mockRoomType = {\n        id: validParams.roomTypeId,\n        accommodation_id: '123e4567-e89b-12d3-a456-426614174000',\n        name: 'Standard Room',\n        description: null,\n        capacity: 2,\n        total_rooms: 10,\n        price_per_night: 150,\n        host_subsidy_per_night: null,\n        status: 'published',\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      mockFrom.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({ data: mockRoomType, error: null }),\n          }),\n        }),\n      });\n\n      const result = await accommodationService.calculateRoomCost(validParams);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.numberOfNights).toBe(4);\n        expect(result.data.pricePerNight).toBe(150);\n        expect(result.data.subsidyPerNight).toBe(0);\n        expect(result.data.totalCost).toBe(600); // 150 * 4\n        expect(result.data.totalSubsidy).toBe(0);\n        expect(result.data.guestCost).toBe(600); // 600 - 0\n      }\n    });\n\n    it('should return error when room type not found', async () => {\n      // Mock getRoomType to return NOT_FOUND error\n      const mockSingle = jest.fn().mockResolvedValue({ \n        data: null, \n        error: { code: 'PGRST116', message: 'No rows found' } \n      });\n      \n      const mockEq = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      \n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await accommodationService.calculateRoomCost(validParams);\n\n      console.log('mockFrom called:', mockFrom.mock.calls.length, 'times');\n      console.log('mockSelect called:', mockSelect.mock.calls.length, 'times');\n      console.log('mockEq called:', mockEq.mock.calls.length, 'times');\n      console.log('mockSingle called:', mockSingle.mock.calls.length, 'times');\n      console.log('Result:', JSON.stringify(result, null, 2));\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('NOT_FOUND');\n      }\n    });\n  });\n});"],"names":["process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","jest","mock","mockFrom","fn","mockSupabaseClient","from","createClient","__mockFrom","accommodationService","require","describe","beforeEach","clearAllMocks","mockReturnValue","select","mockResolvedValue","data","error","insert","single","validData","name","locationId","description","address","status","it","mockAccommodation","id","location_id","created_at","updated_at","result","createAccommodation","expect","success","toBe","invalidData","code","repeat","message","maliciousData","not","toContain","validId","eq","getAccommodation","accommodationId","capacity","totalRooms","pricePerNight","hostSubsidyPerNight","mockRoomType","accommodation_id","total_rooms","price_per_night","host_subsidy_per_night","createRoomType","mockRoomTypes","order","listRoomTypes","toHaveLength","roomTypeId","guestId","checkIn","checkOut","notes","mockAssignment","room_type_id","guest_id","check_in","check_out","createRoomAssignment","mockAssignments","listGuestRoomAssignments","listRoomTypeAssignments","validParams","calculateRoomCost","numberOfNights","subsidyPerNight","totalCost","totalSubsidy","guestCost","mockSingle","mockEq","mockSelect","console","log","calls","length","JSON","stringify"],"mappings":"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"}