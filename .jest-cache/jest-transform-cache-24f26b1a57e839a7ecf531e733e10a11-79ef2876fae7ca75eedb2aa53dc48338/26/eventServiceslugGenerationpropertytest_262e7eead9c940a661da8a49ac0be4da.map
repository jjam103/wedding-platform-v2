{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/eventService.slugGeneration.property.test.ts"],"sourcesContent":["/**\n * Property-Based Tests for Event Service Slug Generation from Title\n * \n * **Property 26: Slug Generation from Title**\n * **Validates: Requirements 24.1**\n * \n * Tests that slugs are correctly generated from event names following all transformation rules.\n */\n\nimport * as fc from 'fast-check';\nimport { create, deleteEvent } from './eventService';\nimport { generateSlug } from '../utils/slugs';\n\ndescribe('Feature: guest-portal-and-admin-enhancements, Property 26: Slug Generation from Title', () => {\n  // Clean up test events after each test\n  const createdEventIds: string[] = [];\n\n  afterEach(async () => {\n    // Clean up all created events\n    for (const id of createdEventIds) {\n      await deleteEvent(id);\n    }\n    createdEventIds.length = 0;\n  });\n\n  /**\n   * Property: Generated slug matches the expected transformation of the event name\n   * \n   * The slug should be:\n   * - Lowercase\n   * - Spaces replaced with hyphens\n   * - Special characters removed\n   * - Multiple hyphens collapsed to single hyphen\n   * - Leading/trailing hyphens removed\n   */\n  it('should generate slug that matches expected transformation of event name', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.string({ minLength: 3, maxLength: 50 }).filter(s => /[a-zA-Z0-9]/.test(s)),\n        fc.date(),\n        async (name, startDate) => {\n          const result = await create({\n            name,\n            eventType: 'ceremony',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          createdEventIds.push(result.data.id);\n\n          // Generate expected slug using the same utility function\n          const expectedBaseSlug = generateSlug(name);\n\n          // The actual slug should either match the expected slug or have a numeric suffix\n          const actualSlug = result.data.slug;\n          const hasNumericSuffix = /-\\d+$/.test(actualSlug);\n\n          if (hasNumericSuffix) {\n            // Remove suffix and check base matches\n            const baseSlug = actualSlug.replace(/-\\d+$/, '');\n            expect(baseSlug).toBe(expectedBaseSlug);\n          } else {\n            // Should match exactly\n            expect(actualSlug).toBe(expectedBaseSlug);\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  /**\n   * Property: Slug generation is deterministic for the same input\n   */\n  it('should generate the same base slug for identical event names', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.string({ minLength: 3, maxLength: 30 }).filter(s => /[a-zA-Z0-9]/.test(s)),\n        fc.date(),\n        async (name, startDate) => {\n          // Create first event\n          const result1 = await create({\n            name,\n            eventType: 'reception',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result1.success) {\n            return true;\n          }\n\n          createdEventIds.push(result1.data.id);\n          const slug1 = result1.data.slug;\n\n          // Create second event with same name\n          const result2 = await create({\n            name,\n            eventType: 'reception',\n            startDate: new Date(startDate.getTime() + 3600000).toISOString(),\n          });\n\n          if (!result2.success) {\n            return true;\n          }\n\n          createdEventIds.push(result2.data.id);\n          const slug2 = result2.data.slug;\n\n          // Second slug should be first slug with -2 suffix\n          expect(slug2).toBe(`${slug1}-2`);\n\n          return true;\n        }\n      ),\n      { numRuns: 30 }\n    );\n  });\n\n  /**\n   * Property: Slug generation handles mixed case correctly\n   */\n  it('should convert mixed case event names to lowercase slugs', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(fc.string({ minLength: 1, maxLength: 10 }), { minLength: 2, maxLength: 4 }),\n        fc.date(),\n        async (words, startDate) => {\n          // Create name with mixed case\n          const name = words.map((word, i) => \n            i % 2 === 0 ? word.toUpperCase() : word.toLowerCase()\n          ).join(' ');\n\n          if (!/[a-zA-Z0-9]/.test(name)) {\n            return true;\n          }\n\n          const result = await create({\n            name,\n            eventType: 'meal',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          createdEventIds.push(result.data.id);\n\n          // Slug should be all lowercase\n          expect(result.data.slug).toBe(result.data.slug.toLowerCase());\n          expect(result.data.slug).not.toMatch(/[A-Z]/);\n\n          return true;\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  /**\n   * Property: Slug generation removes leading and trailing whitespace\n   */\n  it('should trim whitespace from event names when generating slugs', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.string({ minLength: 3, maxLength: 20 }).filter(s => /[a-zA-Z0-9]/.test(s)),\n        fc.nat({ max: 5 }),\n        fc.nat({ max: 5 }),\n        fc.date(),\n        async (baseName, leadingSpaces, trailingSpaces, startDate) => {\n          const name = ' '.repeat(leadingSpaces) + baseName + ' '.repeat(trailingSpaces);\n\n          const result = await create({\n            name,\n            eventType: 'activity',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          createdEventIds.push(result.data.id);\n\n          // Slug should not have leading or trailing hyphens\n          expect(result.data.slug).not.toMatch(/^-/);\n          expect(result.data.slug).not.toMatch(/-$/);\n\n          return true;\n        }\n      ),\n      { numRuns: 40 }\n    );\n  });\n\n  /**\n   * Property: Slug generation collapses multiple spaces to single hyphen\n   */\n  it('should collapse multiple spaces to single hyphen in slugs', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(fc.string({ minLength: 1, maxLength: 10 }).filter(s => /[a-zA-Z0-9]/.test(s)), { minLength: 2, maxLength: 4 }),\n        fc.nat({ min: 2, max: 5 }),\n        fc.date(),\n        async (words, spaceCount, startDate) => {\n          const name = words.join(' '.repeat(spaceCount));\n\n          const result = await create({\n            name,\n            eventType: 'transport',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          createdEventIds.push(result.data.id);\n\n          // Slug should not have consecutive hyphens\n          expect(result.data.slug).not.toMatch(/--/);\n\n          return true;\n        }\n      ),\n      { numRuns: 40 }\n    );\n  });\n\n  /**\n   * Property: Slug generation is consistent with utility function\n   */\n  it('should generate slugs consistent with generateSlug utility', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.constantFrom(\n          'Wedding Ceremony',\n          'Reception Party',\n          'Beach Volleyball',\n          'Sunset Dinner',\n          'Welcome Drinks',\n          'Farewell Brunch'\n        ),\n        fc.date(),\n        async (name, startDate) => {\n          const result = await create({\n            name,\n            eventType: 'ceremony',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          createdEventIds.push(result.data.id);\n\n          // Generate expected slug\n          const expectedSlug = generateSlug(name);\n\n          // Actual slug should match or have numeric suffix\n          const actualSlug = result.data.slug;\n          expect(actualSlug === expectedSlug || actualSlug.startsWith(`${expectedSlug}-`)).toBe(true);\n\n          return true;\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n});\n"],"names":["describe","createdEventIds","afterEach","id","deleteEvent","length","it","fc","assert","asyncProperty","string","minLength","maxLength","filter","s","test","date","name","startDate","result","create","eventType","toISOString","success","push","data","expectedBaseSlug","generateSlug","actualSlug","slug","hasNumericSuffix","baseSlug","replace","expect","toBe","numRuns","result1","slug1","result2","Date","getTime","slug2","array","words","map","word","i","toUpperCase","toLowerCase","join","not","toMatch","nat","max","baseName","leadingSpaces","trailingSpaces","repeat","min","spaceCount","constantFrom","expectedSlug","startsWith"],"mappings":"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"}