{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/rsvpAnalyticsService.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\nimport type { Result } from '@/types';\nimport { ERROR_CODES } from '@/types';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\nconst supabase = createClient(supabaseUrl, supabaseKey);\n\n/**\n * Response rate statistics for RSVPs.\n * Requirements: 6.5, 15.1\n */\nexport interface ResponseRateStats {\n  total_invited: number;\n  total_responded: number;\n  total_pending: number;\n  response_rate: number; // Percentage (0-100)\n  by_status: {\n    attending: number;\n    declined: number;\n    maybe: number;\n    pending: number;\n  };\n  by_guest_type?: Record<string, {\n    total: number;\n    responded: number;\n    response_rate: number;\n  }>;\n}\n\n/**\n * Attendance projection data.\n * Requirements: 15.1, 15.5\n */\nexport interface AttendanceProjection {\n  confirmed_attending: number;\n  maybe_attending: number;\n  projected_total: number; // confirmed + (maybe * probability factor)\n  pending_count: number;\n  declined_count: number;\n}\n\n/**\n * Dietary restriction summary.\n * Requirements: 15.5\n */\nexport interface DietaryRestrictionSummary {\n  total_with_restrictions: number;\n  restrictions: Record<string, number>; // restriction type -> count\n  notes: Array<{\n    guest_id: string;\n    guest_name: string;\n    dietary_notes: string;\n  }>;\n}\n\n/**\n * Calculates response rates for an event or activity.\n * \n * @param targetId - Event ID or Activity ID\n * @param targetType - 'event' or 'activity'\n * @param includeGuestTypeBreakdown - Whether to include breakdown by guest type\n * @returns Result containing response rate statistics or error details\n * \n * Requirements: 6.5, 15.1\n */\nexport async function calculateResponseRate(\n  targetId: string,\n  targetType: 'event' | 'activity',\n  includeGuestTypeBreakdown: boolean = false\n): Promise<Result<ResponseRateStats>> {\n  try {\n    // Build query based on target type\n    const idField = targetType === 'event' ? 'event_id' : 'activity_id';\n    \n    // Get all RSVPs for this target\n    const { data: rsvps, error: rsvpError } = await supabase\n      .from('rsvps')\n      .select('id, guest_id, status')\n      .eq(idField, targetId);\n\n    if (rsvpError) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: rsvpError.message,\n          details: rsvpError,\n        },\n      };\n    }\n\n    const total_invited = rsvps.length;\n    const total_responded = rsvps.filter(r => r.status !== 'pending').length;\n    const total_pending = rsvps.filter(r => r.status === 'pending').length;\n    const response_rate = total_invited > 0 ? (total_responded / total_invited) * 100 : 0;\n\n    const by_status = {\n      attending: rsvps.filter(r => r.status === 'attending').length,\n      declined: rsvps.filter(r => r.status === 'declined').length,\n      maybe: rsvps.filter(r => r.status === 'maybe').length,\n      pending: total_pending,\n    };\n\n    let by_guest_type: Record<string, { total: number; responded: number; response_rate: number }> | undefined;\n\n    if (includeGuestTypeBreakdown) {\n      // Get guest types for all RSVPs\n      const guestIds = rsvps.map(r => r.guest_id);\n      const { data: guests, error: guestError } = await supabase\n        .from('guests')\n        .select('id, guest_type')\n        .in('id', guestIds);\n\n      if (guestError) {\n        return {\n          success: false,\n          error: {\n            code: ERROR_CODES.DATABASE_ERROR,\n            message: guestError.message,\n            details: guestError,\n          },\n        };\n      }\n\n      // Create guest type map\n      const guestTypeMap = new Map(guests.map(g => [g.id, g.guest_type]));\n\n      // Calculate stats by guest type\n      by_guest_type = {};\n      for (const rsvp of rsvps) {\n        const guestType = guestTypeMap.get(rsvp.guest_id) || 'unknown';\n        if (!by_guest_type[guestType]) {\n          by_guest_type[guestType] = { total: 0, responded: 0, response_rate: 0 };\n        }\n        by_guest_type[guestType].total++;\n        if (rsvp.status !== 'pending') {\n          by_guest_type[guestType].responded++;\n        }\n      }\n\n      // Calculate response rates\n      for (const type in by_guest_type) {\n        const stats = by_guest_type[type];\n        stats.response_rate = stats.total > 0 ? (stats.responded / stats.total) * 100 : 0;\n      }\n    }\n\n    return {\n      success: true,\n      data: {\n        total_invited,\n        total_responded,\n        total_pending,\n        response_rate: Math.round(response_rate * 100) / 100, // Round to 2 decimal places\n        by_status,\n        by_guest_type,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Projects attendance numbers based on current RSVPs.\n * \n * @param targetId - Event ID or Activity ID\n * @param targetType - 'event' or 'activity'\n * @param maybeProbability - Probability factor for 'maybe' responses (default: 0.5)\n * @returns Result containing attendance projection or error details\n * \n * Requirements: 15.1, 15.5\n */\nexport async function projectAttendance(\n  targetId: string,\n  targetType: 'event' | 'activity',\n  maybeProbability: number = 0.5\n): Promise<Result<AttendanceProjection>> {\n  try {\n    const idField = targetType === 'event' ? 'event_id' : 'activity_id';\n\n    // Get all RSVPs with guest counts\n    const { data: rsvps, error } = await supabase\n      .from('rsvps')\n      .select('status, guest_count')\n      .eq(idField, targetId);\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: error.message,\n          details: error,\n        },\n      };\n    }\n\n    // Calculate totals\n    const confirmed_attending = rsvps\n      .filter(r => r.status === 'attending')\n      .reduce((sum, r) => sum + (r.guest_count || 1), 0);\n\n    const maybe_attending = rsvps\n      .filter(r => r.status === 'maybe')\n      .reduce((sum, r) => sum + (r.guest_count || 1), 0);\n\n    const declined_count = rsvps\n      .filter(r => r.status === 'declined')\n      .reduce((sum, r) => sum + (r.guest_count || 1), 0);\n\n    const pending_count = rsvps\n      .filter(r => r.status === 'pending')\n      .reduce((sum, r) => sum + (r.guest_count || 1), 0);\n\n    // Project total attendance\n    const projected_total = confirmed_attending + Math.round(maybe_attending * maybeProbability);\n\n    return {\n      success: true,\n      data: {\n        confirmed_attending,\n        maybe_attending,\n        projected_total,\n        pending_count,\n        declined_count,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Generates a summary of dietary restrictions for an event or activity.\n * \n * @param targetId - Event ID or Activity ID\n * @param targetType - 'event' or 'activity'\n * @returns Result containing dietary restriction summary or error details\n * \n * Requirements: 15.5\n */\nexport async function summarizeDietaryRestrictions(\n  targetId: string,\n  targetType: 'event' | 'activity'\n): Promise<Result<DietaryRestrictionSummary>> {\n  try {\n    const idField = targetType === 'event' ? 'event_id' : 'activity_id';\n\n    // Get RSVPs with dietary notes for attending guests\n    const { data: rsvps, error: rsvpError } = await supabase\n      .from('rsvps')\n      .select('guest_id, dietary_notes')\n      .eq(idField, targetId)\n      .eq('status', 'attending')\n      .not('dietary_notes', 'is', null);\n\n    if (rsvpError) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: rsvpError.message,\n          details: rsvpError,\n        },\n      };\n    }\n\n    // Get guest information\n    const guestIds = rsvps.map(r => r.guest_id);\n    const { data: guests, error: guestError } = await supabase\n      .from('guests')\n      .select('id, first_name, last_name, dietary_restrictions')\n      .in('id', guestIds);\n\n    if (guestError) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: guestError.message,\n          details: guestError,\n        },\n      };\n    }\n\n    // Create guest map\n    const guestMap = new Map(guests.map(g => [g.id, g]));\n\n    // Collect all dietary information\n    const restrictions: Record<string, number> = {};\n    const notes: Array<{ guest_id: string; guest_name: string; dietary_notes: string }> = [];\n\n    for (const rsvp of rsvps) {\n      const guest = guestMap.get(rsvp.guest_id);\n      if (!guest) continue;\n\n      // Add RSVP dietary notes\n      if (rsvp.dietary_notes) {\n        notes.push({\n          guest_id: guest.id,\n          guest_name: `${guest.first_name} ${guest.last_name}`,\n          dietary_notes: rsvp.dietary_notes,\n        });\n      }\n\n      // Parse and count dietary restrictions from guest profile\n      if (guest.dietary_restrictions) {\n        const guestRestrictions = guest.dietary_restrictions\n          .split(',')\n          .map((r: string) => r.trim().toLowerCase())\n          .filter((r: string) => r.length > 0);\n\n        for (const restriction of guestRestrictions) {\n          restrictions[restriction] = (restrictions[restriction] || 0) + 1;\n        }\n      }\n    }\n\n    const total_with_restrictions = Object.keys(restrictions).length > 0 \n      ? Object.values(restrictions).reduce((sum, count) => sum + count, 0) \n      : 0;\n\n    return {\n      success: true,\n      data: {\n        total_with_restrictions,\n        restrictions,\n        notes,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Gets comprehensive analytics for an event.\n * \n * @param eventId - Event ID\n * @returns Result containing all analytics data or error details\n * \n * Requirements: 6.5, 15.1, 15.5\n */\nexport async function getEventAnalytics(eventId: string): Promise<Result<{\n  response_rates: ResponseRateStats;\n  attendance_projection: AttendanceProjection;\n  dietary_summary: DietaryRestrictionSummary;\n}>> {\n  try {\n    const [responseResult, attendanceResult, dietaryResult] = await Promise.all([\n      calculateResponseRate(eventId, 'event', true),\n      projectAttendance(eventId, 'event'),\n      summarizeDietaryRestrictions(eventId, 'event'),\n    ]);\n\n    if (!responseResult.success) {\n      return responseResult;\n    }\n    if (!attendanceResult.success) {\n      return attendanceResult;\n    }\n    if (!dietaryResult.success) {\n      return dietaryResult;\n    }\n\n    return {\n      success: true,\n      data: {\n        response_rates: responseResult.data,\n        attendance_projection: attendanceResult.data,\n        dietary_summary: dietaryResult.data,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Gets comprehensive analytics for an activity.\n * \n * @param activityId - Activity ID\n * @returns Result containing all analytics data or error details\n * \n * Requirements: 6.5, 15.1, 15.5\n */\nexport async function getActivityAnalytics(activityId: string): Promise<Result<{\n  response_rates: ResponseRateStats;\n  attendance_projection: AttendanceProjection;\n  dietary_summary: DietaryRestrictionSummary;\n}>> {\n  try {\n    const [responseResult, attendanceResult, dietaryResult] = await Promise.all([\n      calculateResponseRate(activityId, 'activity', true),\n      projectAttendance(activityId, 'activity'),\n      summarizeDietaryRestrictions(activityId, 'activity'),\n    ]);\n\n    if (!responseResult.success) {\n      return responseResult;\n    }\n    if (!attendanceResult.success) {\n      return attendanceResult;\n    }\n    if (!dietaryResult.success) {\n      return dietaryResult;\n    }\n\n    return {\n      success: true,\n      data: {\n        response_rates: responseResult.data,\n        attendance_projection: attendanceResult.data,\n        dietary_summary: dietaryResult.data,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n"],"names":["calculateResponseRate","getActivityAnalytics","getEventAnalytics","projectAttendance","summarizeDietaryRestrictions","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","supabase","createClient","targetId","targetType","includeGuestTypeBreakdown","idField","data","rsvps","error","rsvpError","from","select","eq","success","code","ERROR_CODES","DATABASE_ERROR","message","details","total_invited","length","total_responded","filter","r","status","total_pending","response_rate","by_status","attending","declined","maybe","pending","by_guest_type","guestIds","map","guest_id","guests","guestError","in","guestTypeMap","Map","g","id","guest_type","rsvp","guestType","get","total","responded","type","stats","Math","round","UNKNOWN_ERROR","Error","maybeProbability","confirmed_attending","reduce","sum","guest_count","maybe_attending","declined_count","pending_count","projected_total","not","guestMap","restrictions","notes","guest","dietary_notes","push","guest_name","first_name","last_name","dietary_restrictions","guestRestrictions","split","trim","toLowerCase","restriction","total_with_restrictions","Object","keys","values","count","eventId","responseResult","attendanceResult","dietaryResult","Promise","all","response_rates","attendance_projection","dietary_summary","activityId"],"mappings":"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"}