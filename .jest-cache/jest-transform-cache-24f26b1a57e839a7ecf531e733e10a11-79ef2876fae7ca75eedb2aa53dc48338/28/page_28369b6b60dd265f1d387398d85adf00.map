{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/events/page.tsx"],"sourcesContent":["'use client';\n\nexport const dynamic = 'force-dynamic';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { DataTableWithSuspense as DataTable, type ColumnDef } from '@/components/ui/DataTableWithSuspense';\nimport { CollapsibleForm } from '@/components/admin/CollapsibleForm';\nimport { InlineSectionEditor } from '@/components/admin/InlineSectionEditor';\nimport { LocationSelector } from '@/components/admin/LocationSelector';\nimport { ConfirmDialog } from '@/components/ui/ConfirmDialog';\nimport { Button } from '@/components/ui/Button';\nimport { StatusBadge } from '@/components/ui/StatusBadge';\nimport { useToast } from '@/components/ui/ToastContext';\nimport type { Event } from '@/schemas/eventSchemas';\nimport { createEventSchema, updateEventSchema } from '@/schemas/eventSchemas';\nimport type { FormField } from '@/components/ui/DynamicForm';\nimport { useRouter } from 'next/navigation';\n\ninterface Location {\n  id: string;\n  name: string;\n  parentLocationId?: string | null;\n}\n\n/**\n * Event Management Page\n * \n * Provides CRUD interface for managing wedding events with collapsible forms.\n * Features:\n * - Data table with sorting, filtering, and search\n * - Collapsible inline form for create/edit operations\n * - LocationSelector with hierarchical location support\n * - Scheduling conflict detection\n * - Section editor integration\n * - Delete confirmation dialog\n * - Toast notifications for success/error feedback\n * - Real-time data refresh after operations\n * \n * Requirements: 6.1-6.8, 28.1-28.8\n */\nexport default function EventsPage() {\n  const { addToast } = useToast();\n  const router = useRouter();\n  \n  // State management\n  const [events, setEvents] = useState<Event[]>([]);\n  const [locations, setLocations] = useState<Location[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n  const [selectedEvent, setSelectedEvent] = useState<Event | null>(null);\n  const [eventToDelete, setEventToDelete] = useState<Event | null>(null);\n  const [selectedLocationId, setSelectedLocationId] = useState<string>('');\n  const [conflictError, setConflictError] = useState<string | null>(null);\n  \n  // Ref for scrolling to newly created event\n  const newEventRef = useRef<string | null>(null);\n\n  /**\n   * Fetch events from API\n   */\n  const fetchEvents = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      const response = await fetch('/api/admin/events');\n      if (!response.ok) {\n        throw new Error('Failed to fetch events');\n      }\n\n      const result = await response.json();\n      if (result.success) {\n        setEvents(result.data.events || []);\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Failed to load events',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Failed to load events',\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [addToast]);\n\n  /**\n   * Fetch locations for dropdown\n   */\n  const fetchLocations = useCallback(async () => {\n    try {\n      const response = await fetch('/api/admin/locations');\n      if (!response.ok) {\n        return;\n      }\n\n      const result = await response.json();\n      if (result.success) {\n        setLocations(result.data || []);\n      }\n    } catch (error) {\n      // Silently fail for locations - not critical\n      console.error('Failed to fetch locations:', error);\n    }\n  }, []);\n\n  // Load data on mount\n  useEffect(() => {\n    fetchEvents();\n    fetchLocations();\n  }, [fetchEvents, fetchLocations]);\n\n  /**\n   * Handle row click - open edit form\n   */\n  const handleRowClick = useCallback((event: Event) => {\n    setSelectedEvent(event);\n    setSelectedLocationId(event.locationId || '');\n    setConflictError(null);\n    setIsFormOpen(true);\n  }, []);\n\n  /**\n   * Handle add event button click\n   */\n  const handleAddEvent = useCallback(() => {\n    setSelectedEvent(null);\n    setSelectedLocationId('');\n    setConflictError(null);\n    setIsFormOpen(true);\n  }, []);\n\n  /**\n   * Handle delete button click\n   */\n  const handleDeleteClick = useCallback((event: Event) => {\n    setEventToDelete(event);\n    setIsDeleteDialogOpen(true);\n  }, []);\n\n  /**\n   * Handle form submission (create or update)\n   */\n  const handleSubmit = useCallback(async (data: any) => {\n    try {\n      setConflictError(null);\n      const isEdit = !!selectedEvent;\n      \n      // Add selected location to data\n      const submitData = {\n        ...data,\n        locationId: selectedLocationId || null,\n      };\n      \n      const url = isEdit ? `/api/admin/events/${selectedEvent.id}` : '/api/admin/events';\n      const method = isEdit ? 'PUT' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(submitData),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: isEdit ? 'Event updated successfully' : 'Event created successfully',\n        });\n        \n        // Store new event ID for scrolling\n        if (!isEdit && result.data?.id) {\n          newEventRef.current = result.data.id;\n        }\n        \n        // Refresh event list\n        await fetchEvents();\n        \n        // Close form\n        setIsFormOpen(false);\n        setSelectedEvent(null);\n        setSelectedLocationId('');\n        \n        // Scroll to new event after a short delay\n        if (newEventRef.current) {\n          setTimeout(() => {\n            const element = document.querySelector(`[data-row-id=\"${newEventRef.current}\"]`);\n            if (element) {\n              element.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }\n            newEventRef.current = null;\n          }, 100);\n        }\n      } else {\n        // Check for scheduling conflict\n        if (result.error?.code === 'SCHEDULING_CONFLICT') {\n          const conflicts = result.error.details || [];\n          const conflictMessages = conflicts.map((c: any) => \n            `\"${c.name}\" (${new Date(c.startDate).toLocaleString()})`\n          ).join(', ');\n          setConflictError(\n            `This event conflicts with existing events at this location: ${conflictMessages}`\n          );\n        } else {\n          addToast({\n            type: 'error',\n            message: result.error?.message || 'Operation failed',\n          });\n        }\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Operation failed',\n      });\n    }\n  }, [selectedEvent, selectedLocationId, addToast, fetchEvents, router]);\n\n  /**\n   * Handle delete confirmation\n   */\n  const handleDeleteConfirm = useCallback(async () => {\n    if (!eventToDelete) return;\n\n    try {\n      const response = await fetch(`/api/admin/events/${eventToDelete.id}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: 'Event deleted successfully',\n        });\n        \n        // Refresh event list\n        await fetchEvents();\n        \n        // Close dialog\n        setIsDeleteDialogOpen(false);\n        setEventToDelete(null);\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Failed to delete event',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Failed to delete event',\n      });\n    }\n  }, [eventToDelete, addToast, fetchEvents]);\n\n  /**\n   * Format date for display\n   */\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n    });\n  };\n\n  /**\n   * Format time for display\n   */\n  const formatTime = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleTimeString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  // Define table columns\n  const columns: ColumnDef<Event>[] = [\n    {\n      key: 'name',\n      label: 'Name',\n      sortable: true,\n    },\n    {\n      key: 'startDate',\n      label: 'Date',\n      sortable: true,\n      render: (value) => formatDate(value as string),\n    },\n    {\n      key: 'startTime',\n      label: 'Time',\n      sortable: false,\n      render: (value, row) => formatTime((row as Event).startDate),\n    },\n    {\n      key: 'locationId',\n      label: 'Location',\n      sortable: true,\n      render: (value) => {\n        if (!value) return '-';\n        const location = locations.find(l => l.id === value);\n        return location?.name || '-';\n      },\n    },\n    {\n      key: 'status',\n      label: 'Status',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { label: 'Draft', value: 'draft' },\n        { label: 'Published', value: 'published' },\n      ],\n      render: (value) => {\n        // Map event status to StatusBadge status types\n        const statusMap: Record<string, 'event-active' | 'event-inactive'> = {\n          published: 'event-active',\n          draft: 'event-inactive',\n        };\n        return <StatusBadge status={statusMap[value as string] || 'event-inactive'} />;\n      },\n    },\n    {\n      key: 'eventType',\n      label: 'Type',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { label: 'Ceremony', value: 'ceremony' },\n        { label: 'Reception', value: 'reception' },\n        { label: 'Pre-wedding', value: 'pre_wedding' },\n        { label: 'Post-wedding', value: 'post_wedding' },\n      ],\n      render: (value) => {\n        const labels: Record<string, string> = {\n          ceremony: 'Ceremony',\n          reception: 'Reception',\n          pre_wedding: 'Pre-wedding',\n          post_wedding: 'Post-wedding',\n        };\n        return labels[value as string] || value;\n      },\n    },\n    {\n      key: 'actions',\n      label: 'Actions',\n      sortable: false,\n      render: (_, row) => (\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            onClick={(e) => {\n              e.stopPropagation();\n              window.location.href = `/guest/events/${(row as Event).id}`;\n            }}\n          >\n            View\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  // Define form fields\n  const formFields: FormField[] = [\n    {\n      name: 'name',\n      label: 'Event Name',\n      type: 'text',\n      required: true,\n      placeholder: 'Enter event name',\n    },\n    {\n      name: 'eventType',\n      label: 'Event Type',\n      type: 'select',\n      required: true,\n      options: [\n        { label: 'Ceremony', value: 'ceremony' },\n        { label: 'Reception', value: 'reception' },\n        { label: 'Pre-wedding', value: 'pre_wedding' },\n        { label: 'Post-wedding', value: 'post_wedding' },\n      ],\n    },\n    {\n      name: 'description',\n      label: 'Description',\n      type: 'richtext',\n      required: false,\n      placeholder: 'Enter event description',\n      helpText: 'Rich text editor for detailed event description',\n    },\n    {\n      name: 'startDate',\n      label: 'Start Date & Time',\n      type: 'datetime-local',\n      required: true,\n    },\n    {\n      name: 'endDate',\n      label: 'End Date & Time',\n      type: 'datetime-local',\n      required: false,\n      helpText: 'Optional end date for multi-day events',\n    },\n    {\n      name: 'status',\n      label: 'Status',\n      type: 'select',\n      required: true,\n      options: [\n        { label: 'Draft', value: 'draft' },\n        { label: 'Published', value: 'published' },\n      ],\n    },\n    {\n      name: 'rsvpRequired',\n      label: 'RSVP Required',\n      type: 'checkbox',\n      required: false,\n    },\n    {\n      name: 'rsvpDeadline',\n      label: 'RSVP Deadline',\n      type: 'datetime-local',\n      required: false,\n      helpText: 'Deadline for guests to RSVP',\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Page Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-sage-900\">Event Management</h1>\n          <p className=\"text-sage-600 mt-1\">Manage your wedding events</p>\n        </div>\n        <Button\n          variant=\"primary\"\n          onClick={handleAddEvent}\n          aria-label=\"Create new event\"\n          data-action=\"add-new\"\n        >\n          + Add Event\n        </Button>\n      </div>\n\n      {/* Collapsible Form */}\n      <CollapsibleForm\n        isOpen={isFormOpen}\n        onToggle={() => {\n          setIsFormOpen(!isFormOpen);\n          if (isFormOpen) {\n            setSelectedEvent(null);\n            setSelectedLocationId('');\n            setConflictError(null);\n          }\n        }}\n        title={selectedEvent ? 'Edit Event' : 'Add New Event'}\n        fields={formFields}\n        schema={selectedEvent ? updateEventSchema : createEventSchema}\n        onSubmit={handleSubmit}\n        onCancel={() => {\n          setIsFormOpen(false);\n          setSelectedEvent(null);\n          setSelectedLocationId('');\n          setConflictError(null);\n        }}\n        initialData={selectedEvent || {}}\n        submitLabel={selectedEvent ? 'Update Event' : 'Create Event'}\n      >\n        {/* Location Selector - Custom field */}\n        <div className=\"mb-4\">\n          <label className=\"block text-sm font-medium text-sage-700 mb-2\">\n            Location\n          </label>\n          <LocationSelector\n            locations={locations}\n            selectedLocationId={selectedLocationId}\n            onSelect={setSelectedLocationId}\n            placeholder=\"Select event location\"\n          />\n          <p className=\"mt-1 text-sm text-sage-500\">\n            Select the location where this event will take place\n          </p>\n        </div>\n        \n        {/* Conflict Error Display */}\n        {conflictError && (\n          <div className=\"mb-4 p-4 bg-red-50 border border-red-200 rounded-md\">\n            <div className=\"flex\">\n              <div className=\"flex-shrink-0\">\n                <svg className=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\n                </svg>\n              </div>\n              <div className=\"ml-3\">\n                <h3 className=\"text-sm font-medium text-red-800\">Scheduling Conflict</h3>\n                <div className=\"mt-2 text-sm text-red-700\">\n                  <p>{conflictError}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </CollapsibleForm>\n\n      {/* Inline Section Editor - Shows when editing an existing event */}\n      {isFormOpen && selectedEvent && (\n        <InlineSectionEditor\n          pageType=\"event\"\n          pageId={selectedEvent.id}\n          entityName={selectedEvent.name}\n          defaultExpanded={false}\n        />\n      )}\n\n      {/* Data Table */}\n      <DataTable\n        data={events}\n        columns={columns}\n        loading={loading}\n        onRowClick={handleRowClick}\n        onDelete={handleDeleteClick}\n        totalCount={events.length}\n        currentPage={1}\n        pageSize={25}\n        idField=\"id\"\n      />\n\n      {/* Delete Confirmation Dialog */}\n      <ConfirmDialog\n        isOpen={isDeleteDialogOpen}\n        onClose={() => {\n          setIsDeleteDialogOpen(false);\n          setEventToDelete(null);\n        }}\n        onConfirm={handleDeleteConfirm}\n        title=\"Delete Event\"\n        message={`Are you sure you want to delete \"${eventToDelete?.name}\"? This action cannot be undone.`}\n        confirmLabel=\"Delete\"\n        cancelLabel=\"Cancel\"\n        variant=\"danger\"\n      />\n    </div>\n  );\n}\n"],"names":["EventsPage","dynamic","addToast","useToast","router","useRouter","events","setEvents","useState","locations","setLocations","loading","setLoading","isFormOpen","setIsFormOpen","isDeleteDialogOpen","setIsDeleteDialogOpen","selectedEvent","setSelectedEvent","eventToDelete","setEventToDelete","selectedLocationId","setSelectedLocationId","conflictError","setConflictError","newEventRef","useRef","fetchEvents","useCallback","response","fetch","ok","Error","result","json","success","data","type","message","error","fetchLocations","console","useEffect","handleRowClick","event","locationId","handleAddEvent","handleDeleteClick","handleSubmit","isEdit","submitData","url","id","method","headers","body","JSON","stringify","current","setTimeout","element","document","querySelector","scrollIntoView","behavior","block","code","conflicts","details","conflictMessages","map","c","name","Date","startDate","toLocaleString","join","handleDeleteConfirm","formatDate","dateString","date","toLocaleDateString","year","month","day","formatTime","toLocaleTimeString","hour","minute","columns","key","label","sortable","render","value","row","location","find","l","filterable","filterType","filterOptions","statusMap","published","draft","StatusBadge","status","labels","ceremony","reception","pre_wedding","post_wedding","_","div","className","Button","variant","size","onClick","e","stopPropagation","window","href","formFields","required","placeholder","options","helpText","h1","p","aria-label","data-action","CollapsibleForm","isOpen","onToggle","title","fields","schema","updateEventSchema","createEventSchema","onSubmit","onCancel","initialData","submitLabel","LocationSelector","onSelect","svg","viewBox","fill","path","fillRule","d","clipRule","h3","InlineSectionEditor","pageType","pageId","entityName","defaultExpanded","DataTable","onRowClick","onDelete","totalCount","length","currentPage","pageSize","idField","ConfirmDialog","onClose","onConfirm","confirmLabel","cancelLabel"],"mappings":"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"}