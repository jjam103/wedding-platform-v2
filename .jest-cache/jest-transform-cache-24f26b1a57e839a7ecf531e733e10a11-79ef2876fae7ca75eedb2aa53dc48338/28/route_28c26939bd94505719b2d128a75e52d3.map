{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/rsvps/route.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport { listRSVPsSchema } from '@/schemas/rsvpSchemas';\n\n/**\n * GET /api/admin/rsvps\n * List RSVPs with optional filters\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. Auth check\n    const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. Parse query parameters\n    const { searchParams } = new URL(request.url);\n    const params = {\n      guest_id: searchParams.get('guest_id') || undefined,\n      event_id: searchParams.get('event_id') || undefined,\n      activity_id: searchParams.get('activity_id') || undefined,\n      status: searchParams.get('status') || undefined,\n      page: searchParams.get('page') ? parseInt(searchParams.get('page')!) : 1,\n      page_size: searchParams.get('page_size') ? parseInt(searchParams.get('page_size')!) : 50,\n    };\n\n    // 3. Validate parameters\n    const validation = listRSVPsSchema.safeParse(params);\n    if (!validation.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: { \n            code: 'VALIDATION_ERROR', \n            message: 'Invalid request parameters', \n            details: validation.error.issues \n          } \n        },\n        { status: 400 }\n      );\n    }\n\n    // 4. Build query\n    let query = supabase\n      .from('rsvps')\n      .select('*', { count: 'exact' });\n\n    if (validation.data.guest_id) {\n      query = query.eq('guest_id', validation.data.guest_id);\n    }\n    if (validation.data.event_id) {\n      query = query.eq('event_id', validation.data.event_id);\n    }\n    if (validation.data.activity_id) {\n      query = query.eq('activity_id', validation.data.activity_id);\n    }\n    if (validation.data.status) {\n      query = query.eq('status', validation.data.status);\n    }\n\n    // 5. Execute query with pagination\n    const from = (validation.data.page - 1) * validation.data.page_size;\n    const to = from + validation.data.page_size - 1;\n    \n    const { data, error, count } = await query.range(from, to);\n\n    if (error) {\n      return NextResponse.json(\n        { success: false, error: { code: 'DATABASE_ERROR', message: error.message } },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: data || [],\n      pagination: {\n        total: count || 0,\n        page: validation.data.page,\n        page_size: validation.data.page_size,\n        total_pages: Math.ceil((count || 0) / validation.data.page_size),\n      },\n    });\n  } catch (error) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: { \n          code: 'INTERNAL_ERROR', \n          message: error instanceof Error ? error.message : 'Internal server error' \n        } \n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","request","cookieStore","cookies","supabase","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","getAll","setAll","cookiesToSet","forEach","name","value","set","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","searchParams","URL","url","params","guest_id","get","undefined","event_id","activity_id","page","parseInt","page_size","validation","listRSVPsSchema","safeParse","details","issues","query","from","select","count","eq","to","range","pagination","total","total_pages","Math","ceil","Error"],"mappings":"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"}