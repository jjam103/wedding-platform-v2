{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/rsvpCapacity.regression.test.ts"],"sourcesContent":["/**\n * Regression Test Suite: RSVP Capacity Management\n * \n * Tests RSVP capacity tracking and alerts to prevent regressions in:\n * - Capacity calculations\n * - Capacity limit enforcement\n * - Alert generation at thresholds\n * - Waitlist management\n * - Real-time capacity updates\n * \n * Requirements: 21.4\n */\n\nimport * as rsvpService from '@/services/rsvpService';\nimport * as rsvpAnalyticsService from '@/services/rsvpAnalyticsService';\nimport * as capacityReportService from '@/services/capacityReportService';\n\n// Mock Supabase client\nconst mockSupabase = {\n  from: jest.fn().mockReturnThis(),\n  select: jest.fn().mockReturnThis(),\n  insert: jest.fn().mockReturnThis(),\n  update: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  in: jest.fn().mockReturnThis(),\n  single: jest.fn(),\n};\n\njest.mock('@/lib/supabase', () => ({\n  createClient: jest.fn(() => mockSupabase),\n}));\n\ndescribe('Regression: RSVP Capacity Management', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Capacity Calculations', () => {\n    it('should calculate current capacity correctly', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: 100,\n      };\n\n      const rsvps = [\n        { status: 'attending', guestCount: 2 },\n        { status: 'attending', guestCount: 3 },\n        { status: 'attending', guestCount: 1 },\n        { status: 'declined', guestCount: 2 },\n        { status: 'pending', guestCount: 1 },\n      ];\n\n      mockSupabase.select.mockResolvedValue({\n        data: rsvps,\n        error: null,\n      });\n\n      const result = await rsvpAnalyticsService.calculateCapacity(\n        'activity-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // Only attending RSVPs count: 2 + 3 + 1 = 6\n        expect(result.data.currentAttendees).toBe(6);\n        expect(result.data.capacity).toBe(100);\n        expect(result.data.availableSpots).toBe(94);\n        expect(result.data.utilizationPercent).toBe(6);\n      }\n    });\n\n    it('should handle activities without capacity limits', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: null,\n      };\n\n      const rsvps = [\n        { status: 'attending', guestCount: 50 },\n        { status: 'attending', guestCount: 75 },\n      ];\n\n      mockSupabase.select.mockResolvedValue({\n        data: rsvps,\n        error: null,\n      });\n\n      const result = await rsvpAnalyticsService.calculateCapacity(\n        'activity-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.currentAttendees).toBe(125);\n        expect(result.data.capacity).toBeNull();\n        expect(result.data.availableSpots).toBeNull();\n      }\n    });\n\n    it('should handle zero attendees', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: 50,\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: [],\n        error: null,\n      });\n\n      const result = await rsvpAnalyticsService.calculateCapacity(\n        'activity-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.currentAttendees).toBe(0);\n        expect(result.data.availableSpots).toBe(50);\n        expect(result.data.utilizationPercent).toBe(0);\n      }\n    });\n  });\n\n  describe('Capacity Alert Generation', () => {\n    it('should generate alert at 90% capacity', async () => {\n      const activity = {\n        id: 'activity-1',\n        name: 'Beach Volleyball',\n        capacity: 100,\n      };\n\n      const rsvps = Array(90).fill({ status: 'attending', guestCount: 1 });\n\n      mockSupabase.select.mockResolvedValue({\n        data: rsvps,\n        error: null,\n      });\n\n      const result = await capacityReportService.checkCapacityAlerts(\n        'activity-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.shouldAlert).toBe(true);\n        expect(result.data.alertLevel).toBe('warning');\n        expect(result.data.utilizationPercent).toBe(90);\n      }\n    });\n\n    it('should generate critical alert at 100% capacity', async () => {\n      const activity = {\n        id: 'activity-1',\n        name: 'Beach Volleyball',\n        capacity: 100,\n      };\n\n      const rsvps = Array(100).fill({ status: 'attending', guestCount: 1 });\n\n      mockSupabase.select.mockResolvedValue({\n        data: rsvps,\n        error: null,\n      });\n\n      const result = await capacityReportService.checkCapacityAlerts(\n        'activity-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.shouldAlert).toBe(true);\n        expect(result.data.alertLevel).toBe('critical');\n        expect(result.data.utilizationPercent).toBe(100);\n      }\n    });\n\n    it('should not alert below 90% capacity', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: 100,\n      };\n\n      const rsvps = Array(85).fill({ status: 'attending', guestCount: 1 });\n\n      mockSupabase.select.mockResolvedValue({\n        data: rsvps,\n        error: null,\n      });\n\n      const result = await capacityReportService.checkCapacityAlerts(\n        'activity-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.shouldAlert).toBe(false);\n        expect(result.data.utilizationPercent).toBe(85);\n      }\n    });\n\n    it('should handle over-capacity situations', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: 100,\n      };\n\n      const rsvps = Array(110).fill({ status: 'attending', guestCount: 1 });\n\n      mockSupabase.select.mockResolvedValue({\n        data: rsvps,\n        error: null,\n      });\n\n      const result = await capacityReportService.checkCapacityAlerts(\n        'activity-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.shouldAlert).toBe(true);\n        expect(result.data.alertLevel).toBe('over_capacity');\n        expect(result.data.utilizationPercent).toBe(110);\n      }\n    });\n  });\n\n  describe('Capacity Limit Enforcement', () => {\n    it('should prevent RSVP when at capacity', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: 100,\n      };\n\n      // Mock current capacity at 100\n      mockSupabase.select.mockResolvedValue({\n        data: Array(100).fill({ status: 'attending', guestCount: 1 }),\n        error: null,\n      });\n\n      const result = await rsvpService.create({\n        guestId: 'guest-1',\n        activityId: 'activity-1',\n        status: 'attending',\n        guestCount: 1,\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CAPACITY_EXCEEDED');\n      }\n    });\n\n    it('should allow RSVP when capacity available', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: 100,\n      };\n\n      // Mock current capacity at 95\n      mockSupabase.select.mockResolvedValue({\n        data: Array(95).fill({ status: 'attending', guestCount: 1 }),\n        error: null,\n      });\n\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'rsvp-1',\n          guestId: 'guest-1',\n          activityId: 'activity-1',\n          status: 'attending',\n          guestCount: 1,\n        },\n        error: null,\n      });\n\n      const result = await rsvpService.create({\n        guestId: 'guest-1',\n        activityId: 'activity-1',\n        status: 'attending',\n        guestCount: 1,\n      });\n\n      expect(result.success).toBe(true);\n    });\n\n    it('should allow declining RSVP even at capacity', async () => {\n      const activity = {\n        id: 'activity-1',\n        capacity: 100,\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: Array(100).fill({ status: 'attending', guestCount: 1 }),\n        error: null,\n      });\n\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'rsvp-1',\n          guestId: 'guest-1',\n          activityId: 'activity-1',\n          status: 'declined',\n          guestCount: 0,\n        },\n        error: null,\n      });\n\n      const result = await rsvpService.create({\n        guestId: 'guest-1',\n        activityId: 'activity-1',\n        status: 'declined',\n        guestCount: 0,\n      });\n\n      expect(result.success).toBe(true);\n    });\n  });\n\n  describe('Real-Time Capacity Updates', () => {\n    it('should update capacity when RSVP status changes', async () => {\n      // Initial state: 95 attending\n      mockSupabase.select\n        .mockResolvedValueOnce({\n          data: Array(95).fill({ status: 'attending', guestCount: 1 }),\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: Array(94).fill({ status: 'attending', guestCount: 1 }),\n          error: null,\n        });\n\n      // Check initial capacity\n      const initialResult = await rsvpAnalyticsService.calculateCapacity(\n        'activity-1'\n      );\n\n      expect(initialResult.success).toBe(true);\n      if (initialResult.success) {\n        expect(initialResult.data.currentAttendees).toBe(95);\n      }\n\n      // Update RSVP to declined\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'rsvp-1',\n          status: 'declined',\n        },\n        error: null,\n      });\n\n      await rsvpService.update('rsvp-1', { status: 'declined' });\n\n      // Check updated capacity\n      const updatedResult = await rsvpAnalyticsService.calculateCapacity(\n        'activity-1'\n      );\n\n      expect(updatedResult.success).toBe(true);\n      if (updatedResult.success) {\n        expect(updatedResult.data.currentAttendees).toBe(94);\n      }\n    });\n\n    it('should handle guest count changes', async () => {\n      mockSupabase.select\n        .mockResolvedValueOnce({\n          data: [\n            { status: 'attending', guestCount: 2 },\n            { status: 'attending', guestCount: 3 },\n          ],\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: [\n            { status: 'attending', guestCount: 4 },\n            { status: 'attending', guestCount: 3 },\n          ],\n          error: null,\n        });\n\n      // Initial: 2 + 3 = 5\n      const initialResult = await rsvpAnalyticsService.calculateCapacity(\n        'activity-1'\n      );\n\n      expect(initialResult.success).toBe(true);\n      if (initialResult.success) {\n        expect(initialResult.data.currentAttendees).toBe(5);\n      }\n\n      // Update guest count from 2 to 4\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'rsvp-1', guestCount: 4 },\n        error: null,\n      });\n\n      await rsvpService.update('rsvp-1', { guestCount: 4 });\n\n      // Updated: 4 + 3 = 7\n      const updatedResult = await rsvpAnalyticsService.calculateCapacity(\n        'activity-1'\n      );\n\n      expect(updatedResult.success).toBe(true);\n      if (updatedResult.success) {\n        expect(updatedResult.data.currentAttendees).toBe(7);\n      }\n    });\n  });\n\n  describe('Multiple Activities Capacity', () => {\n    it('should track capacity across multiple activities', async () => {\n      const activities = [\n        { id: 'activity-1', capacity: 50 },\n        { id: 'activity-2', capacity: 75 },\n        { id: 'activity-3', capacity: 100 },\n      ];\n\n      mockSupabase.select\n        .mockResolvedValueOnce({\n          data: Array(45).fill({ status: 'attending', guestCount: 1 }),\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: Array(70).fill({ status: 'attending', guestCount: 1 }),\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: Array(95).fill({ status: 'attending', guestCount: 1 }),\n          error: null,\n        });\n\n      const results = await Promise.all(\n        activities.map((activity) =>\n          rsvpAnalyticsService.calculateCapacity(activity.id)\n        )\n      );\n\n      expect(results[0].success && results[0].data.utilizationPercent).toBe(\n        90\n      );\n      expect(results[1].success && results[1].data.utilizationPercent).toBeCloseTo(\n        93.33,\n        2\n      );\n      expect(results[2].success && results[2].data.utilizationPercent).toBe(\n        95\n      );\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","mockSupabase","from","mockReturnThis","select","insert","update","eq","in","single","describe","beforeEach","clearAllMocks","it","activity","id","capacity","rsvps","status","guestCount","mockResolvedValue","data","error","result","rsvpAnalyticsService","calculateCapacity","expect","success","toBe","currentAttendees","availableSpots","utilizationPercent","toBeNull","name","Array","fill","capacityReportService","checkCapacityAlerts","shouldAlert","alertLevel","rsvpService","create","guestId","activityId","code","mockResolvedValueOnce","initialResult","updatedResult","activities","results","Promise","all","map","toBeCloseTo"],"mappings":"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"}