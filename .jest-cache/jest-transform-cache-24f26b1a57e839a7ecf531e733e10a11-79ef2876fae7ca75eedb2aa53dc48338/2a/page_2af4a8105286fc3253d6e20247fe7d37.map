{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/guests/page.tsx"],"sourcesContent":["'use client';\n\nexport const dynamic = 'force-dynamic';\n\nimport { useState, useEffect, useCallback, useMemo, lazy, Suspense } from 'react';\nimport { createClient } from '@supabase/supabase-js';\nimport { DataTableWithSuspense as DataTable, type ColumnDef } from '@/components/ui/DataTableWithSuspense';\nimport { CollapsibleForm } from '@/components/admin/CollapsibleForm';\nimport { ConfirmDialog } from '@/components/ui/ConfirmDialog';\nimport { Button } from '@/components/ui/Button';\nimport { useToast } from '@/components/ui/ToastContext';\nimport { ComponentErrorBoundary } from '@/components/ui/ErrorBoundary';\nimport type { Guest } from '@/schemas/guestSchemas';\nimport { createGuestSchema, updateGuestSchema } from '@/schemas/guestSchemas';\nimport { exportToCSV as exportGuestsToCSV, importFromCSV as importGuestsFromCSV } from '@/services/guestService';\nimport { Loader2 } from 'lucide-react';\n\n// Lazy load InlineRSVPEditor for better performance\nconst InlineRSVPEditor = lazy(() => \n  import('@/components/admin/InlineRSVPEditor').then(mod => ({ default: mod.InlineRSVPEditor }))\n);\n\ninterface Group {\n  id: string;\n  name: string;\n  description?: string | null;\n  guestCount?: number;\n}\n\ninterface Activity {\n  id: string;\n  name: string;\n}\n\ninterface GuestFormField {\n  name: string;\n  label: string;\n  type: 'text' | 'email' | 'number' | 'textarea' | 'select' | 'date' | 'datetime-local';\n  placeholder?: string;\n  required?: boolean;\n  options?: Array<{ value: string; label: string }>;\n  rows?: number;\n}\n\n/**\n * Guest Management Page\n * \n * Provides CRUD interface for managing wedding guests.\n * Features:\n * - Data table with sorting, filtering, and search\n * - Create/edit modal with form validation\n * - Delete confirmation dialog\n * - Toast notifications for success/error feedback\n * - Real-time data refresh after operations\n */\nexport default function GuestsPage() {\n  const { addToast } = useToast();\n  \n  // State management\n  const [guests, setGuests] = useState<Guest[]>([]);\n  const [groups, setGroups] = useState<Group[]>([]);\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n  const [selectedGuest, setSelectedGuest] = useState<Guest | null>(null);\n  const [guestToDelete, setGuestToDelete] = useState<Guest | null>(null);\n  const [isBulkDeleteDialogOpen, setIsBulkDeleteDialogOpen] = useState(false);\n  const [selectedGuestIds, setSelectedGuestIds] = useState<string[]>([]);\n  const [csvImportErrors, setCsvImportErrors] = useState<string[]>([]);\n  const [isImportDialogOpen, setIsImportDialogOpen] = useState(false);\n  \n  // Group management state\n  const [isGroupFormOpen, setIsGroupFormOpen] = useState(false);\n  const [selectedGroup, setSelectedGroup] = useState<Group | null>(null);\n  const [groupToDelete, setGroupToDelete] = useState<Group | null>(null);\n  const [isGroupDeleteDialogOpen, setIsGroupDeleteDialogOpen] = useState(false);\n  \n  // Advanced filter state\n  const [rsvpStatusFilter, setRsvpStatusFilter] = useState<string>('');\n  const [activityFilter, setActivityFilter] = useState<string>('');\n  const [transportationFilter, setTransportationFilter] = useState<string>('');\n  const [ageGroupFilter, setAgeGroupFilter] = useState<string>('');\n  const [airportFilter, setAirportFilter] = useState<string>('');\n  const [groupingField, setGroupingField] = useState<string>('');\n  const [expandedGuestIds, setExpandedGuestIds] = useState<Set<string>>(new Set());\n\n  /**\n   * Fetch guests from API with filters\n   */\n  const fetchGuests = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      // Build query parameters\n      const params = new URLSearchParams();\n      if (rsvpStatusFilter) params.append('rsvpStatus', rsvpStatusFilter);\n      if (activityFilter) params.append('activityId', activityFilter);\n      if (transportationFilter) params.append('hasTransportation', transportationFilter);\n      if (ageGroupFilter) params.append('ageType', ageGroupFilter);\n      if (airportFilter) params.append('airportCode', airportFilter);\n      \n      const url = `/api/admin/guests${params.toString() ? `?${params.toString()}` : ''}`;\n      const response = await fetch(url);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch guests');\n      }\n\n      const result = await response.json();\n      if (result.success) {\n        setGuests(result.data.guests || []);\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Failed to load guests',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Failed to load guests',\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [addToast, rsvpStatusFilter, activityFilter, transportationFilter, ageGroupFilter, airportFilter]);\n\n  /**\n   * Fetch groups for filter dropdown\n   */\n  const fetchGroups = useCallback(async () => {\n    try {\n      const response = await fetch('/api/admin/guest-groups');\n      if (!response.ok) {\n        return;\n      }\n\n      const result = await response.json();\n      if (result.success) {\n        setGroups(result.data || []);\n      }\n    } catch (error) {\n      // Silently fail for groups - not critical\n      console.error('Failed to fetch groups:', error);\n    }\n  }, []);\n\n  /**\n   * Fetch activities for filter dropdown\n   */\n  const fetchActivities = useCallback(async () => {\n    try {\n      const response = await fetch('/api/admin/activities');\n      if (!response.ok) {\n        return;\n      }\n\n      const result = await response.json();\n      if (result.success) {\n        // Handle paginated response - extract activities array\n        const activitiesData = result.data?.activities || result.data || [];\n        setActivities(Array.isArray(activitiesData) ? activitiesData : []);\n      }\n    } catch (error) {\n      // Silently fail for activities - not critical\n      console.error('Failed to fetch activities:', error);\n    }\n  }, []);\n\n  // Load data on mount and when filters change\n  useEffect(() => {\n    fetchGuests();\n    fetchGroups();\n    fetchActivities();\n  }, [fetchGuests, fetchGroups, fetchActivities]);\n\n  /**\n   * Set up real-time subscription for guest changes\n   */\n  useEffect(() => {\n    // Create Supabase client for real-time subscriptions\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n    if (!supabaseUrl || !supabaseAnonKey) {\n      console.error('Missing Supabase environment variables for real-time subscriptions');\n      return;\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n    // Subscribe to guest table changes\n    const channel = supabase\n      .channel('guests-changes')\n      .on(\n        'postgres_changes',\n        {\n          event: '*', // Listen to all events (INSERT, UPDATE, DELETE)\n          schema: 'public',\n          table: 'guests',\n        },\n        (payload) => {\n          console.log('Guest change detected:', payload);\n\n          // Show notification when data is updated by another user\n          if (payload.eventType === 'INSERT') {\n            addToast({\n              type: 'info',\n              message: 'A new guest was added by another user',\n            });\n          } else if (payload.eventType === 'UPDATE') {\n            addToast({\n              type: 'info',\n              message: 'A guest was updated by another user',\n            });\n          } else if (payload.eventType === 'DELETE') {\n            addToast({\n              type: 'info',\n              message: 'A guest was deleted by another user',\n            });\n          }\n\n          // Refresh the guest list\n          fetchGuests();\n        }\n      )\n      .subscribe();\n\n    // Cleanup subscription on unmount\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [fetchGuests, addToast]);\n\n  /**\n   * Handle row click - open edit form\n   */\n  const handleRowClick = useCallback((guest: Guest) => {\n    setSelectedGuest(guest);\n    setIsFormOpen(true);\n  }, []);\n\n  /**\n   * Toggle RSVP expansion for a guest\n   */\n  const toggleRSVPExpansion = useCallback((guestId: string) => {\n    setExpandedGuestIds(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(guestId)) {\n        newSet.delete(guestId);\n      } else {\n        newSet.add(guestId);\n      }\n      return newSet;\n    });\n  }, []);\n\n  /**\n   * Handle add guest button click\n   */\n  const handleAddGuest = useCallback(() => {\n    setSelectedGuest(null);\n    setIsFormOpen(true);\n  }, []);\n\n  /**\n   * Handle delete button click\n   */\n  const handleDeleteClick = useCallback((guest: Guest) => {\n    setGuestToDelete(guest);\n    setIsDeleteDialogOpen(true);\n  }, []);\n\n  /**\n   * Handle form submission (create or update)\n   */\n  const handleSubmit = useCallback(async (data: any) => {\n    try {\n      const isEdit = !!selectedGuest;\n      const url = isEdit ? `/api/admin/guests/${selectedGuest.id}` : '/api/admin/guests';\n      const method = isEdit ? 'PUT' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: isEdit ? 'Guest updated successfully' : 'Guest created successfully',\n        });\n        \n        // Refresh guest list\n        await fetchGuests();\n        \n        // Close form\n        setIsFormOpen(false);\n        setSelectedGuest(null);\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Operation failed',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Operation failed',\n      });\n    }\n  }, [selectedGuest, addToast, fetchGuests]);\n\n  /**\n   * Handle delete confirmation\n   */\n  const handleDeleteConfirm = useCallback(async () => {\n    if (!guestToDelete) return;\n\n    try {\n      const response = await fetch(`/api/admin/guests/${guestToDelete.id}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: 'Guest deleted successfully',\n        });\n        \n        // Refresh guest list\n        await fetchGuests();\n        \n        // Close dialog\n        setIsDeleteDialogOpen(false);\n        setGuestToDelete(null);\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Failed to delete guest',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Failed to delete guest',\n      });\n    }\n  }, [guestToDelete, addToast, fetchGuests]);\n\n  /**\n   * Handle bulk delete\n   */\n  const handleBulkDelete = useCallback(async (ids: string[]) => {\n    setSelectedGuestIds(ids);\n    setIsBulkDeleteDialogOpen(true);\n  }, []);\n\n  /**\n   * Handle CSV import\n   */\n  const handleImportCSV = useCallback(async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    try {\n      // Read file content\n      const content = await file.text();\n      \n      // Import guests\n      const result = await importGuestsFromCSV(content);\n      \n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: `Successfully imported ${result.data.length} guests`,\n        });\n        \n        // Refresh guest list\n        await fetchGuests();\n        \n        // Clear any previous errors\n        setCsvImportErrors([]);\n      } else {\n        // Display validation errors\n        const errorMessages = Array.isArray(result.error?.details) \n          ? result.error.details.map((detail: any) => \n              `Row ${detail.row || 'unknown'}: ${detail.message || detail.path?.join('.') || 'Validation error'}`\n            )\n          : [result.error?.message || 'Import failed'];\n        \n        setCsvImportErrors(errorMessages);\n        setIsImportDialogOpen(true);\n        \n        addToast({\n          type: 'error',\n          message: 'CSV import failed. Please check the errors.',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Failed to import CSV',\n      });\n    }\n    \n    // Reset file input\n    event.target.value = '';\n  }, [addToast, fetchGuests]);\n\n  /**\n   * Handle CSV export\n   */\n  const handleExportCSV = useCallback(async () => {\n    try {\n      // Export all guests (not just filtered ones)\n      const result = await exportGuestsToCSV(guests);\n      \n      if (result.success) {\n        // Create blob and download\n        const blob = new Blob([result.data], { type: 'text/csv;charset=utf-8;' });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `guests-${new Date().toISOString().split('T')[0]}.csv`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n        \n        addToast({\n          type: 'success',\n          message: `Exported ${guests.length} guests to CSV`,\n        });\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Failed to export CSV',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Failed to export CSV',\n      });\n    }\n  }, [guests, addToast]);\n\n  /**\n   * Handle bulk delete confirmation\n   */\n  const handleBulkDeleteConfirm = useCallback(async () => {\n    if (selectedGuestIds.length === 0) return;\n\n    try {\n      let successCount = 0;\n      let errorCount = 0;\n\n      // Delete each guest sequentially\n      for (const id of selectedGuestIds) {\n        try {\n          const response = await fetch(`/api/admin/guests/${id}`, {\n            method: 'DELETE',\n          });\n\n          const result = await response.json();\n          if (result.success) {\n            successCount++;\n          } else {\n            errorCount++;\n          }\n        } catch {\n          errorCount++;\n        }\n      }\n\n      // Show result toast\n      if (successCount > 0) {\n        addToast({\n          type: 'success',\n          message: `Successfully deleted ${successCount} guest${successCount > 1 ? 's' : ''}`,\n        });\n      }\n\n      if (errorCount > 0) {\n        addToast({\n          type: 'error',\n          message: `Failed to delete ${errorCount} guest${errorCount > 1 ? 's' : ''}`,\n        });\n      }\n\n      // Refresh guest list\n      await fetchGuests();\n\n      // Close dialog\n      setIsBulkDeleteDialogOpen(false);\n      setSelectedGuestIds([]);\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Bulk delete failed',\n      });\n    }\n  }, [selectedGuestIds, addToast, fetchGuests]);\n\n  /**\n   * Handle group form submission (create or update)\n   */\n  const handleGroupSubmit = useCallback(async (data: any) => {\n    try {\n      const isEdit = !!selectedGroup;\n      const url = isEdit ? `/api/admin/guest-groups/${selectedGroup.id}` : '/api/admin/guest-groups';\n      const method = isEdit ? 'PUT' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n        credentials: 'include', // Important: Include cookies for authentication\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: isEdit ? 'Group updated successfully' : 'Group created successfully',\n        });\n        \n        // Refresh groups list\n        await fetchGroups();\n        \n        // Clear selected group (form will stay open for creating more)\n        setSelectedGroup(null);\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Operation failed',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Operation failed',\n      });\n    }\n  }, [selectedGroup, addToast, fetchGroups]);\n\n  /**\n   * Handle group delete click\n   */\n  const handleGroupDeleteClick = useCallback((group: Group) => {\n    setGroupToDelete(group);\n    setIsGroupDeleteDialogOpen(true);\n  }, []);\n\n  /**\n   * Handle group delete confirmation\n   */\n  const handleGroupDeleteConfirm = useCallback(async () => {\n    if (!groupToDelete) return;\n\n    try {\n      const response = await fetch(`/api/admin/guest-groups/${groupToDelete.id}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: 'Group deleted successfully',\n        });\n        \n        // Refresh groups list\n        await fetchGroups();\n        \n        // Close dialog\n        setIsGroupDeleteDialogOpen(false);\n        setGroupToDelete(null);\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Failed to delete group',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: error instanceof Error ? error.message : 'Failed to delete group',\n      });\n    }\n  }, [groupToDelete, addToast, fetchGroups]);\n\n  // Define table columns\n  const columns: ColumnDef<Guest>[] = [\n    {\n      key: 'rsvpExpand',\n      label: '',\n      render: (_, guest) => (\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            toggleRSVPExpansion(guest.id);\n          }}\n          className=\"text-sage-600 hover:text-sage-900 p-1\"\n          aria-label={expandedGuestIds.has(guest.id) ? 'Collapse RSVPs' : 'Expand RSVPs'}\n        >\n          {expandedGuestIds.has(guest.id) ? '▼' : '▶'}\n        </button>\n      ),\n    },\n    {\n      key: 'firstName',\n      label: 'First Name',\n      sortable: true,\n    },\n    {\n      key: 'lastName',\n      label: 'Last Name',\n      sortable: true,\n    },\n    {\n      key: 'email',\n      label: 'Email',\n      sortable: true,\n      render: (value) => value || '-',\n    },\n    {\n      key: 'groupId',\n      label: 'Group',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: groups.map(g => ({ label: g.name, value: g.id })),\n      render: (value) => {\n        const group = groups.find(g => g.id === value);\n        return group?.name || '-';\n      },\n    },\n    {\n      key: 'guestType',\n      label: 'Guest Type',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { label: 'Wedding Party', value: 'wedding_party' },\n        { label: 'Wedding Guest', value: 'wedding_guest' },\n        { label: 'Pre-wedding Only', value: 'prewedding_only' },\n        { label: 'Post-wedding Only', value: 'postwedding_only' },\n      ],\n      render: (value) => {\n        const labels: Record<string, string> = {\n          wedding_party: 'Wedding Party',\n          wedding_guest: 'Wedding Guest',\n          prewedding_only: 'Pre-wedding Only',\n          postwedding_only: 'Post-wedding Only',\n        };\n        return labels[value] || value;\n      },\n    },\n    {\n      key: 'ageType',\n      label: 'Age Type',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { label: 'Adult', value: 'adult' },\n        { label: 'Child', value: 'child' },\n        { label: 'Senior', value: 'senior' },\n      ],\n      render: (value) => {\n        const labels: Record<string, string> = {\n          adult: 'Adult',\n          child: 'Child',\n          senior: 'Senior',\n        };\n        return labels[value] || value;\n      },\n    },\n    {\n      key: 'airportCode',\n      label: 'Airport',\n      sortable: true,\n      render: (value) => value || '-',\n    },\n  ];\n\n  // Define form fields - memoized to update when groups change\n  const formFields: GuestFormField[] = useMemo(() => [\n    {\n      name: 'groupId',\n      label: 'Group',\n      type: 'select',\n      required: true,\n      options: groups.map(g => ({ label: g.name, value: g.id })),\n    },\n    {\n      name: 'firstName',\n      label: 'First Name',\n      type: 'text',\n      required: true,\n      placeholder: 'Enter first name',\n    },\n    {\n      name: 'lastName',\n      label: 'Last Name',\n      type: 'text',\n      required: true,\n      placeholder: 'Enter last name',\n    },\n    {\n      name: 'email',\n      label: 'Email',\n      type: 'email',\n      required: false,\n      placeholder: 'Enter email address',\n    },\n    {\n      name: 'phone',\n      label: 'Phone',\n      type: 'text',\n      required: false,\n      placeholder: 'Enter phone number',\n    },\n    {\n      name: 'ageType',\n      label: 'Age Type',\n      type: 'select',\n      required: true,\n      options: [\n        { label: 'Adult', value: 'adult' },\n        { label: 'Child', value: 'child' },\n        { label: 'Senior', value: 'senior' },\n      ],\n    },\n    {\n      name: 'guestType',\n      label: 'Guest Type',\n      type: 'select',\n      required: true,\n      options: [\n        { label: 'Wedding Party', value: 'wedding_party' },\n        { label: 'Wedding Guest', value: 'wedding_guest' },\n        { label: 'Pre-wedding Only', value: 'prewedding_only' },\n        { label: 'Post-wedding Only', value: 'postwedding_only' },\n      ],\n    },\n    {\n      name: 'dietaryRestrictions',\n      label: 'Dietary Restrictions',\n      type: 'textarea',\n      required: false,\n      placeholder: 'Enter any dietary restrictions',\n      rows: 3,\n    },\n    // Travel Information Section\n    {\n      name: 'arrivalDate',\n      label: 'Arrival Date',\n      type: 'date',\n      required: false,\n    },\n    {\n      name: 'departureDate',\n      label: 'Departure Date',\n      type: 'date',\n      required: false,\n    },\n    {\n      name: 'airportCode',\n      label: 'Airport',\n      type: 'select',\n      required: false,\n      options: [\n        { label: 'SJO (San José)', value: 'SJO' },\n        { label: 'LIR (Liberia)', value: 'LIR' },\n        { label: 'Other', value: 'Other' },\n      ],\n    },\n    {\n      name: 'flightNumber',\n      label: 'Flight Number',\n      type: 'text',\n      required: false,\n      placeholder: 'Enter flight number',\n    },\n    // Plus-One Information Section\n    {\n      name: 'plusOneName',\n      label: 'Plus-One Name',\n      type: 'text',\n      required: false,\n      placeholder: 'Enter plus-one name',\n    },\n    {\n      name: 'notes',\n      label: 'Notes',\n      type: 'textarea',\n      required: false,\n      placeholder: 'Enter any additional notes',\n      rows: 3,\n    },\n  ], [groups]); // Re-create formFields when groups change\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Page Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-sage-900\">Guest Management</h1>\n          <p className=\"text-sage-600 mt-1\">Manage your wedding guest list and groups</p>\n        </div>\n        <div className=\"flex gap-2\">\n          <label className=\"cursor-pointer\">\n            <Button\n              variant=\"secondary\"\n              onClick={() => document.getElementById('csv-import-input')?.click()}\n              aria-label=\"Import guests from CSV\"\n            >\n              Import CSV\n            </Button>\n            <input\n              id=\"csv-import-input\"\n              type=\"file\"\n              accept=\".csv\"\n              onChange={handleImportCSV}\n              className=\"hidden\"\n            />\n          </label>\n          <Button\n            variant=\"secondary\"\n            onClick={handleExportCSV}\n            aria-label=\"Export guests to CSV\"\n          >\n            Export CSV\n          </Button>\n        </div>\n      </div>\n\n      {/* Manage Groups Section */}\n      <div className=\"bg-white rounded-lg shadow-sm border border-sage-200\">\n        {/* Header */}\n        <button\n          onClick={() => setIsGroupFormOpen(!isGroupFormOpen)}\n          className=\"w-full flex items-center justify-between px-4 py-3 bg-sage-50 hover:bg-sage-100 transition-colors rounded-t-lg\"\n          aria-expanded={isGroupFormOpen}\n        >\n          <div className=\"flex-1 text-left\">\n            <h2 className=\"text-lg font-semibold text-sage-900\">Manage Groups</h2>\n            <p className=\"text-sm text-sage-600 mt-1\">\n              {groups.length} group{groups.length !== 1 ? 's' : ''} • Click to {isGroupFormOpen ? 'collapse' : 'expand'}\n            </p>\n          </div>\n          <span \n            className={`text-sage-600 transition-transform duration-300 ${isGroupFormOpen ? 'rotate-180' : ''}`}\n            aria-hidden=\"true\"\n          >\n            ▼\n          </span>\n        </button>\n\n        {/* Collapsible Content */}\n        {isGroupFormOpen && (\n          <div className=\"p-4 space-y-4 border-t border-sage-200\">\n            {/* Add Group Form */}\n            <div className=\"bg-sage-50 p-4 rounded-lg border border-sage-200\">\n              <h3 className=\"text-md font-semibold text-sage-900 mb-3\">\n                {selectedGroup ? 'Edit Group' : 'Add New Group'}\n              </h3>\n              <form\n                onSubmit={async (e) => {\n                  e.preventDefault();\n                  const form = e.currentTarget;\n                  const formData = new FormData(form);\n                  const data = {\n                    name: formData.get('name') as string,\n                    description: formData.get('description') as string || null,\n                  };\n                  \n                  // Call submit handler\n                  await handleGroupSubmit(data);\n                  \n                  // Reset form only if not editing (editing closes the form)\n                  if (!selectedGroup && form) {\n                    form.reset();\n                  }\n                }}\n                className=\"space-y-3\"\n              >\n                <div>\n                  <label htmlFor=\"group-name\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                    Group Name <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    id=\"group-name\"\n                    name=\"name\"\n                    type=\"text\"\n                    required\n                    defaultValue={selectedGroup?.name || ''}\n                    placeholder=\"e.g., Smith Family, Bride's Friends\"\n                    className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500\"\n                  />\n                </div>\n                <div>\n                  <label htmlFor=\"group-description\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                    Description\n                  </label>\n                  <textarea\n                    id=\"group-description\"\n                    name=\"description\"\n                    rows={2}\n                    defaultValue={selectedGroup?.description || ''}\n                    placeholder=\"Optional description of the group\"\n                    className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500\"\n                  />\n                </div>\n                <div className=\"flex gap-2 pt-2\">\n                  <button\n                    type=\"submit\"\n                    className=\"px-4 py-2 bg-jungle-600 text-white rounded-lg hover:bg-jungle-700 transition-colors font-medium shadow-sm\"\n                  >\n                    {selectedGroup ? 'Update Group' : 'Create Group'}\n                  </button>\n                  {selectedGroup && (\n                    <button\n                      type=\"button\"\n                      onClick={() => setSelectedGroup(null)}\n                      className=\"px-4 py-2 bg-sage-200 text-sage-800 rounded-lg hover:bg-sage-300 transition-colors font-medium\"\n                    >\n                      Cancel\n                    </button>\n                  )}\n                </div>\n              </form>\n            </div>\n\n            {/* Current Groups List */}\n            {groups.length > 0 && (\n              <div>\n                <h3 className=\"text-md font-semibold text-sage-900 mb-3\">Current Groups</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                  {groups.map((group) => (\n                    <div\n                      key={group.id}\n                      className=\"flex items-center justify-between p-3 bg-white rounded-lg border border-sage-200 hover:border-jungle-300 transition-colors\"\n                    >\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-medium text-sage-900 truncate\">{group.name}</p>\n                        {group.description && (\n                          <p className=\"text-sm text-sage-600 truncate\">{group.description}</p>\n                        )}\n                        {group.guestCount !== undefined && (\n                          <p className=\"text-xs text-sage-500 mt-1\">\n                            {group.guestCount} guest{group.guestCount !== 1 ? 's' : ''}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"flex gap-2 ml-3\">\n                        <button\n                          onClick={() => setSelectedGroup(group)}\n                          className=\"text-ocean-600 hover:text-ocean-800 text-sm font-medium\"\n                          aria-label={`Edit ${group.name}`}\n                        >\n                          Edit\n                        </button>\n                        <button\n                          onClick={() => handleGroupDeleteClick(group)}\n                          className=\"text-volcano-600 hover:text-volcano-800 text-sm font-medium\"\n                          aria-label={`Delete ${group.name}`}\n                        >\n                          Delete\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Add New Guest Section - Collapsible */}\n      <div className=\"bg-white rounded-lg shadow-sm border border-sage-200\">\n        {/* Header */}\n        <button\n          onClick={() => setIsFormOpen(!isFormOpen)}\n          className=\"w-full flex items-center justify-between px-4 py-3 bg-sage-50 hover:bg-sage-100 transition-colors rounded-t-lg\"\n          aria-expanded={isFormOpen}\n        >\n          <div className=\"flex-1 text-left\">\n            <h2 className=\"text-lg font-semibold text-sage-900\">Add New Guest</h2>\n            <p className=\"text-sm text-sage-600 mt-1\">\n              Click to {isFormOpen ? 'collapse' : 'expand'}\n            </p>\n          </div>\n          <span \n            className={`text-sage-600 transition-transform duration-300 ${isFormOpen ? 'rotate-180' : ''}`}\n            aria-hidden=\"true\"\n          >\n            ▼\n          </span>\n        </button>\n\n        {/* Collapsible Form Content */}\n        {isFormOpen && (\n          <div className=\"p-4 border-t border-sage-200\">\n            <CollapsibleForm\n              title={selectedGuest ? 'Edit Guest' : 'Add Guest'}\n              fields={formFields}\n              schema={selectedGuest ? updateGuestSchema : createGuestSchema}\n              onSubmit={handleSubmit}\n              onCancel={() => {\n                setIsFormOpen(false);\n                setSelectedGuest(null);\n              }}\n              initialData={selectedGuest || {}}\n              isOpen={true}\n              onToggle={() => {}}\n              submitLabel={selectedGuest ? 'Update' : 'Create'}\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Advanced Filters */}\n      <div className=\"bg-white p-4 rounded-lg shadow-sm border border-sage-200\">\n        <h2 className=\"text-lg font-semibold text-sage-900 mb-4\">Filters</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4\">\n          {/* RSVP Status Filter */}\n          <div>\n            <label htmlFor=\"rsvpStatus\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n              RSVP Status\n            </label>\n            <select\n              id=\"rsvpStatus\"\n              value={rsvpStatusFilter}\n              onChange={(e) => setRsvpStatusFilter(e.target.value)}\n              className=\"w-full px-3 py-2 border border-sage-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ocean-500\"\n            >\n              <option value=\"\">All</option>\n              <option value=\"pending\">Pending</option>\n              <option value=\"attending\">Attending</option>\n              <option value=\"declined\">Declined</option>\n              <option value=\"maybe\">Maybe</option>\n            </select>\n          </div>\n\n          {/* Activity Filter */}\n          <div>\n            <label htmlFor=\"activity\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n              Activity\n            </label>\n            <select\n              id=\"activity\"\n              value={activityFilter}\n              onChange={(e) => setActivityFilter(e.target.value)}\n              className=\"w-full px-3 py-2 border border-sage-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ocean-500\"\n            >\n              <option value=\"\">All</option>\n              {activities.map(activity => (\n                <option key={activity.id} value={activity.id}>\n                  {activity.name}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* Transportation Filter */}\n          <div>\n            <label htmlFor=\"transportation\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n              Transportation\n            </label>\n            <select\n              id=\"transportation\"\n              value={transportationFilter}\n              onChange={(e) => setTransportationFilter(e.target.value)}\n              className=\"w-full px-3 py-2 border border-sage-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ocean-500\"\n            >\n              <option value=\"\">All</option>\n              <option value=\"true\">Has Transportation</option>\n              <option value=\"false\">No Transportation</option>\n            </select>\n          </div>\n\n          {/* Age Group Filter */}\n          <div>\n            <label htmlFor=\"ageGroup\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n              Age Group\n            </label>\n            <select\n              id=\"ageGroup\"\n              value={ageGroupFilter}\n              onChange={(e) => setAgeGroupFilter(e.target.value)}\n              className=\"w-full px-3 py-2 border border-sage-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ocean-500\"\n            >\n              <option value=\"\">All</option>\n              <option value=\"adult\">Adult</option>\n              <option value=\"child\">Child</option>\n              <option value=\"senior\">Senior</option>\n            </select>\n          </div>\n\n          {/* Airport Filter */}\n          <div>\n            <label htmlFor=\"airport\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n              Airport\n            </label>\n            <select\n              id=\"airport\"\n              value={airportFilter}\n              onChange={(e) => setAirportFilter(e.target.value)}\n              className=\"w-full px-3 py-2 border border-sage-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ocean-500\"\n            >\n              <option value=\"\">All</option>\n              <option value=\"SJO\">SJO (San José)</option>\n              <option value=\"LIR\">LIR (Liberia)</option>\n              <option value=\"Other\">Other</option>\n            </select>\n          </div>\n        </div>\n\n        {/* Grouping Options */}\n        <div className=\"mt-4\">\n          <label htmlFor=\"grouping\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n            Group By\n          </label>\n          <select\n            id=\"grouping\"\n            value={groupingField}\n            onChange={(e) => setGroupingField(e.target.value)}\n            className=\"w-full md:w-64 px-3 py-2 border border-sage-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ocean-500\"\n          >\n            <option value=\"\">None</option>\n            <option value=\"groupId\">Group</option>\n            <option value=\"guestType\">Guest Type</option>\n            <option value=\"ageType\">Age Type</option>\n            <option value=\"airportCode\">Airport</option>\n          </select>\n        </div>\n\n        {/* Clear Filters Button */}\n        <div className=\"mt-4\">\n          <Button\n            variant=\"secondary\"\n            onClick={() => {\n              setRsvpStatusFilter('');\n              setActivityFilter('');\n              setTransportationFilter('');\n              setAgeGroupFilter('');\n              setAirportFilter('');\n              setGroupingField('');\n            }}\n          >\n            Clear All Filters\n          </Button>\n        </div>\n      </div>\n\n      {/* Data Table */}\n      <ComponentErrorBoundary componentName=\"Guest Table\">\n        <DataTable\n          data={guests}\n          columns={columns}\n          loading={loading}\n          onRowClick={handleRowClick}\n          onDelete={handleDeleteClick}\n          totalCount={guests.length}\n          currentPage={1}\n          pageSize={50}\n          idField=\"id\"\n          selectable={true}\n          onBulkDelete={handleBulkDelete}\n          entityType=\"guests\"\n          showBulkEmail={true}\n        />\n        \n        {/* Inline RSVP Management */}\n        {guests.map(guest => (\n          expandedGuestIds.has(guest.id) && (\n            <div key={`rsvp-${guest.id}`} className=\"mt-2 p-4 bg-sage-50 rounded-lg border border-sage-200\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-semibold text-sage-900\">\n                  RSVP Management for {guest.firstName} {guest.lastName}\n                </h3>\n                <button\n                  onClick={() => toggleRSVPExpansion(guest.id)}\n                  className=\"text-sm text-sage-600 hover:text-sage-900\"\n                  aria-label=\"Close RSVP management\"\n                >\n                  Close\n                </button>\n              </div>\n              <Suspense \n                fallback={\n                  <div className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"w-6 h-6 text-emerald-600 animate-spin\" />\n                    <span className=\"ml-2 text-gray-600\">Loading RSVP editor...</span>\n                  </div>\n                }\n              >\n                <InlineRSVPEditor \n                  guestId={guest.id} \n                  onUpdate={fetchGuests}\n                />\n              </Suspense>\n            </div>\n          )\n        ))}\n      </ComponentErrorBoundary>\n\n      {/* Delete Confirmation Dialog */}\n      <ConfirmDialog\n        isOpen={isDeleteDialogOpen}\n        onClose={() => {\n          setIsDeleteDialogOpen(false);\n          setGuestToDelete(null);\n        }}\n        onConfirm={handleDeleteConfirm}\n        title=\"Delete Guest\"\n        message={`Are you sure you want to delete ${guestToDelete?.firstName} ${guestToDelete?.lastName}? This action cannot be undone.`}\n        confirmLabel=\"Delete\"\n        cancelLabel=\"Cancel\"\n        variant=\"danger\"\n      />\n\n      {/* Bulk Delete Confirmation Dialog */}\n      <ConfirmDialog\n        isOpen={isBulkDeleteDialogOpen}\n        onClose={() => {\n          setIsBulkDeleteDialogOpen(false);\n          setSelectedGuestIds([]);\n        }}\n        onConfirm={handleBulkDeleteConfirm}\n        title=\"Delete Multiple Guests\"\n        message={`Are you sure you want to delete ${selectedGuestIds.length} guest${selectedGuestIds.length > 1 ? 's' : ''}? This action cannot be undone.`}\n        confirmLabel=\"Delete\"\n        cancelLabel=\"Cancel\"\n        variant=\"danger\"\n      />\n\n      {/* CSV Import Errors Dialog */}\n      {isImportDialogOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden\">\n            <div className=\"p-6 border-b border-sage-200\">\n              <h2 className=\"text-xl font-semibold text-sage-900\">CSV Import Errors</h2>\n            </div>\n            <div className=\"p-6 overflow-y-auto max-h-96\">\n              <p className=\"text-sm text-sage-700 mb-3\">\n                The following errors were found in your CSV file. Please fix them and try again.\n              </p>\n              <div className=\"bg-sage-50 p-4 rounded border border-sage-200 space-y-2\">\n                {csvImportErrors.map((error, index) => (\n                  <div key={index} className=\"text-sm text-red-600\">\n                    • {error}\n                  </div>\n                ))}\n              </div>\n            </div>\n            <div className=\"p-6 border-t border-sage-200 flex justify-end\">\n              <Button\n                variant=\"primary\"\n                onClick={() => {\n                  setIsImportDialogOpen(false);\n                  setCsvImportErrors([]);\n                }}\n              >\n                OK\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Group Delete Confirmation Dialog */}\n      <ConfirmDialog\n        isOpen={isGroupDeleteDialogOpen}\n        onClose={() => {\n          setIsGroupDeleteDialogOpen(false);\n          setGroupToDelete(null);\n        }}\n        onConfirm={handleGroupDeleteConfirm}\n        title=\"Delete Group\"\n        message={\n          groupToDelete?.guestCount && groupToDelete.guestCount > 0\n            ? `Cannot delete \"${groupToDelete?.name}\" because it has ${groupToDelete.guestCount} guest${groupToDelete.guestCount > 1 ? 's' : ''}. Please reassign or delete the guests first.`\n            : `Are you sure you want to delete \"${groupToDelete?.name}\"? This action cannot be undone.`\n        }\n        confirmLabel=\"Delete\"\n        cancelLabel=\"Cancel\"\n        variant=\"danger\"\n      />\n    </div>\n  );\n}\n"],"names":["GuestsPage","dynamic","InlineRSVPEditor","lazy","then","mod","default","addToast","useToast","guests","setGuests","useState","groups","setGroups","activities","setActivities","loading","setLoading","isFormOpen","setIsFormOpen","isDeleteDialogOpen","setIsDeleteDialogOpen","selectedGuest","setSelectedGuest","guestToDelete","setGuestToDelete","isBulkDeleteDialogOpen","setIsBulkDeleteDialogOpen","selectedGuestIds","setSelectedGuestIds","csvImportErrors","setCsvImportErrors","isImportDialogOpen","setIsImportDialogOpen","isGroupFormOpen","setIsGroupFormOpen","selectedGroup","setSelectedGroup","groupToDelete","setGroupToDelete","isGroupDeleteDialogOpen","setIsGroupDeleteDialogOpen","rsvpStatusFilter","setRsvpStatusFilter","activityFilter","setActivityFilter","transportationFilter","setTransportationFilter","ageGroupFilter","setAgeGroupFilter","airportFilter","setAirportFilter","groupingField","setGroupingField","expandedGuestIds","setExpandedGuestIds","Set","fetchGuests","useCallback","params","URLSearchParams","append","url","toString","response","fetch","ok","Error","result","json","success","data","type","message","error","fetchGroups","console","fetchActivities","activitiesData","Array","isArray","useEffect","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","supabase","createClient","channel","on","event","schema","table","payload","log","eventType","subscribe","removeChannel","handleRowClick","guest","toggleRSVPExpansion","guestId","prev","newSet","has","delete","add","handleAddGuest","handleDeleteClick","handleSubmit","isEdit","id","method","headers","body","JSON","stringify","handleDeleteConfirm","handleBulkDelete","ids","handleImportCSV","file","target","files","content","text","importGuestsFromCSV","length","errorMessages","details","map","detail","row","path","join","value","handleExportCSV","exportGuestsToCSV","blob","Blob","URL","createObjectURL","link","document","createElement","href","download","Date","toISOString","split","appendChild","click","removeChild","revokeObjectURL","handleBulkDeleteConfirm","successCount","errorCount","handleGroupSubmit","credentials","handleGroupDeleteClick","group","handleGroupDeleteConfirm","columns","key","label","render","_","button","onClick","e","stopPropagation","className","aria-label","sortable","filterable","filterType","filterOptions","g","name","find","labels","wedding_party","wedding_guest","prewedding_only","postwedding_only","adult","child","senior","formFields","useMemo","required","options","placeholder","rows","div","h1","p","Button","variant","getElementById","input","accept","onChange","aria-expanded","h2","span","aria-hidden","h3","form","onSubmit","preventDefault","currentTarget","formData","FormData","get","description","reset","htmlFor","defaultValue","textarea","guestCount","undefined","CollapsibleForm","title","fields","updateGuestSchema","createGuestSchema","onCancel","initialData","isOpen","onToggle","submitLabel","select","option","activity","ComponentErrorBoundary","componentName","DataTable","onRowClick","onDelete","totalCount","currentPage","pageSize","idField","selectable","onBulkDelete","entityType","showBulkEmail","firstName","lastName","Suspense","fallback","Loader2","onUpdate","ConfirmDialog","onClose","onConfirm","confirmLabel","cancelLabel","index"],"mappings":"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"}