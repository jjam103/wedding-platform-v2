{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/hooks/useLocations.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\n\ninterface Location {\n  id: string;\n  name: string;\n  address?: string;\n  description?: string;\n  parentLocationId?: string;\n  children?: Location[];\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface UseLocationsReturn {\n  data: Location[];\n  loading: boolean;\n  error: Error | null;\n  refetch: () => Promise<void>;\n  create: (data: Partial<Location>) => Promise<{ success: boolean; data?: Location; error?: string }>;\n  update: (id: string, data: Partial<Location>) => Promise<{ success: boolean; data?: Location; error?: string }>;\n  remove: (id: string) => Promise<{ success: boolean; error?: string }>;\n  validateParent: (id: string, parentId: string) => Promise<{ success: boolean; error?: string }>;\n}\n\n/**\n * Custom hook for managing hierarchical locations\n * \n * Provides:\n * - Data fetching with loading and error states\n * - CRUD operations (create, update, delete)\n * - Parent validation (circular reference prevention)\n * - Tree structure support\n * - Automatic refetch after mutations\n */\nexport function useLocations(): UseLocationsReturn {\n  const [data, setData] = useState<Location[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const refetch = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await fetch('/api/admin/locations');\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        throw new Error(result.error?.message || 'Failed to fetch locations');\n      }\n\n      setData(result.data || []);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Unknown error');\n      setError(errorObj);\n      console.error('Failed to fetch locations:', errorObj);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const create = useCallback(async (locationData: Partial<Location>) => {\n    try {\n      const response = await fetch('/api/admin/locations', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(locationData),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Failed to create location',\n        };\n      }\n\n      // Refetch to get updated tree structure\n      await refetch();\n\n      return { success: true, data: result.data };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to create location:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, [refetch]);\n\n  const update = useCallback(async (id: string, locationData: Partial<Location>) => {\n    try {\n      const response = await fetch(`/api/admin/locations/${id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(locationData),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Failed to update location',\n        };\n      }\n\n      // Refetch to get updated tree structure\n      await refetch();\n\n      return { success: true, data: result.data };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to update location:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, [refetch]);\n\n  const remove = useCallback(async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/locations/${id}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Failed to delete location',\n        };\n      }\n\n      // Refetch to get updated tree structure\n      await refetch();\n\n      return { success: true };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to delete location:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, [refetch]);\n\n  const validateParent = useCallback(async (id: string, parentId: string) => {\n    try {\n      const response = await fetch(`/api/admin/locations/${id}/validate-parent`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ parentId }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Invalid parent location',\n        };\n      }\n\n      return { success: true };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to validate parent location:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, []);\n\n  useEffect(() => {\n    refetch();\n  }, [refetch]);\n\n  return {\n    data,\n    loading,\n    error,\n    refetch,\n    create,\n    update,\n    remove,\n    validateParent,\n  };\n}\n"],"names":["useLocations","data","setData","useState","loading","setLoading","error","setError","refetch","useCallback","response","fetch","result","json","ok","success","Error","message","err","errorObj","console","create","locationData","method","headers","body","JSON","stringify","errorMsg","update","id","remove","validateParent","parentId","useEffect"],"mappings":"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"}