6756063578925f4274b3e5473be5f78b
/**
 * Vendor Booking Service
 * 
 * Handles vendor-to-activity/event associations and cost propagation
 * when vendor information changes.
 * 
 * Requirements: 8.2, 8.4, 8.9, 8.10
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get create () {
        return create;
    },
    get deleteBooking () {
        return deleteBooking;
    },
    get get () {
        return get;
    },
    get getActivityBookings () {
        return getActivityBookings;
    },
    get getEventBookings () {
        return getEventBookings;
    },
    get getVendorBookings () {
        return getVendorBookings;
    },
    get list () {
        return list;
    },
    get listWithDetails () {
        return listWithDetails;
    },
    get propagateVendorCostChange () {
        return propagateVendorCostChange;
    },
    get update () {
        return update;
    }
});
const _supabasejs = require("@supabase/supabase-js");
const _vendorBookingSchemas = require("../schemas/vendorBookingSchemas");
const _sanitization = require("../utils/sanitization");
// Initialize Supabase client
const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);
async function create(data) {
    try {
        // 1. Validate
        const validation = _vendorBookingSchemas.createVendorBookingSchema.safeParse(data);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        // 2. Sanitize user input
        const sanitized = {
            ...validation.data,
            notes: validation.data.notes ? (0, _sanitization.sanitizeInput)(validation.data.notes) : null
        };
        // 3. Database operation
        const { data: booking, error } = await supabase.from('vendor_bookings').insert({
            vendor_id: sanitized.vendorId,
            activity_id: sanitized.activityId,
            event_id: sanitized.eventId,
            booking_date: sanitized.bookingDate,
            guest_count: sanitized.guestCount,
            pricing_model: sanitized.pricingModel,
            total_cost: sanitized.totalCost,
            host_subsidy: sanitized.hostSubsidy,
            notes: sanitized.notes
        }).select().single();
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: mapBookingFromDb(booking)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function get(id) {
    try {
        const { data: booking, error } = await supabase.from('vendor_bookings').select('*').eq('id', id).single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Vendor booking not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: mapBookingFromDb(booking)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function update(id, data) {
    try {
        // 1. Validate
        const validation = _vendorBookingSchemas.updateVendorBookingSchema.safeParse(data);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        // 2. Sanitize user input
        const sanitized = {};
        if (validation.data.notes !== undefined) {
            sanitized.notes = validation.data.notes ? (0, _sanitization.sanitizeInput)(validation.data.notes) : null;
        }
        if (validation.data.vendorId !== undefined) {
            sanitized.vendor_id = validation.data.vendorId;
        }
        if (validation.data.activityId !== undefined) {
            sanitized.activity_id = validation.data.activityId;
        }
        if (validation.data.eventId !== undefined) {
            sanitized.event_id = validation.data.eventId;
        }
        if (validation.data.bookingDate !== undefined) {
            sanitized.booking_date = validation.data.bookingDate;
        }
        if (validation.data.guestCount !== undefined) {
            sanitized.guest_count = validation.data.guestCount;
        }
        if (validation.data.pricingModel !== undefined) {
            sanitized.pricing_model = validation.data.pricingModel;
        }
        if (validation.data.totalCost !== undefined) {
            sanitized.total_cost = validation.data.totalCost;
        }
        if (validation.data.hostSubsidy !== undefined) {
            sanitized.host_subsidy = validation.data.hostSubsidy;
        }
        // 3. Database operation
        const { data: booking, error } = await supabase.from('vendor_bookings').update(sanitized).eq('id', id).select().single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Vendor booking not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: mapBookingFromDb(booking)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function deleteBooking(id) {
    try {
        const { error } = await supabase.from('vendor_bookings').delete().eq('id', id);
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: undefined
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function list(filters = {}) {
    try {
        // Validate filters
        const validation = _vendorBookingSchemas.vendorBookingFilterSchema.safeParse(filters);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid filters',
                    details: validation.error.issues
                }
            };
        }
        const { vendorId, activityId, eventId, page = 1, pageSize = 50 } = validation.data;
        // Build query
        let query = supabase.from('vendor_bookings').select('*', {
            count: 'exact'
        });
        if (vendorId) {
            query = query.eq('vendor_id', vendorId);
        }
        if (activityId) {
            query = query.eq('activity_id', activityId);
        }
        if (eventId) {
            query = query.eq('event_id', eventId);
        }
        // Apply pagination
        const from = (page - 1) * pageSize;
        const to = from + pageSize - 1;
        query = query.range(from, to).order('booking_date', {
            ascending: true
        });
        const { data: bookings, error, count } = await query;
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        const total = count || 0;
        const totalPages = Math.ceil(total / pageSize);
        return {
            success: true,
            data: {
                bookings: bookings.map(mapBookingFromDb),
                total,
                page,
                pageSize,
                totalPages
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function listWithDetails(filters = {}) {
    try {
        // Validate filters
        const validation = _vendorBookingSchemas.vendorBookingFilterSchema.safeParse(filters);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid filters',
                    details: validation.error.issues
                }
            };
        }
        const { vendorId, activityId, eventId } = validation.data;
        // Build query with joins
        let query = supabase.from('vendor_bookings').select(`
        *,
        vendors (id, name, category),
        activities (id, name),
        events (id, name)
      `);
        if (vendorId) {
            query = query.eq('vendor_id', vendorId);
        }
        if (activityId) {
            query = query.eq('activity_id', activityId);
        }
        if (eventId) {
            query = query.eq('event_id', eventId);
        }
        const { data: bookings, error } = await query.order('booking_date', {
            ascending: true
        });
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        const bookingsWithDetails = bookings.map((booking)=>({
                id: booking.id,
                vendorId: booking.vendor_id,
                vendorName: booking.vendors?.name || 'Unknown',
                vendorCategory: booking.vendors?.category || 'other',
                activityId: booking.activity_id,
                activityName: booking.activities?.name || null,
                eventId: booking.event_id,
                eventName: booking.events?.name || null,
                bookingDate: booking.booking_date,
                guestCount: booking.guest_count,
                pricingModel: booking.pricing_model,
                totalCost: booking.total_cost,
                hostSubsidy: booking.host_subsidy,
                notes: booking.notes,
                createdAt: booking.created_at
            }));
        return {
            success: true,
            data: bookingsWithDetails
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function getVendorBookings(vendorId) {
    return listWithDetails({
        vendorId
    });
}
async function getActivityBookings(activityId) {
    return listWithDetails({
        activityId
    });
}
async function getEventBookings(eventId) {
    return listWithDetails({
        eventId
    });
}
async function propagateVendorCostChange(vendorId) {
    try {
        // Get all bookings for this vendor
        const bookingsResult = await getVendorBookings(vendorId);
        if (!bookingsResult.success) {
            return bookingsResult;
        }
        // Note: In a real implementation, this would trigger recalculation
        // of budget totals for all activities/events associated with this vendor.
        // For now, we just return success as the budget service will
        // recalculate on-demand when requested.
        return {
            success: true,
            data: undefined
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
/**
 * Maps database booking record to VendorBooking type.
 */ function mapBookingFromDb(dbBooking) {
    return {
        id: dbBooking.id,
        vendorId: dbBooking.vendor_id,
        activityId: dbBooking.activity_id,
        eventId: dbBooking.event_id,
        bookingDate: dbBooking.booking_date,
        guestCount: dbBooking.guest_count,
        pricingModel: dbBooking.pricing_model,
        totalCost: dbBooking.total_cost,
        hostSubsidy: dbBooking.host_subsidy,
        notes: dbBooking.notes,
        createdAt: dbBooking.created_at
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvdmVuZG9yQm9va2luZ1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBWZW5kb3IgQm9va2luZyBTZXJ2aWNlXG4gKiBcbiAqIEhhbmRsZXMgdmVuZG9yLXRvLWFjdGl2aXR5L2V2ZW50IGFzc29jaWF0aW9ucyBhbmQgY29zdCBwcm9wYWdhdGlvblxuICogd2hlbiB2ZW5kb3IgaW5mb3JtYXRpb24gY2hhbmdlcy5cbiAqIFxuICogUmVxdWlyZW1lbnRzOiA4LjIsIDguNCwgOC45LCA4LjEwXG4gKi9cblxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbmltcG9ydCB7XG4gIGNyZWF0ZVZlbmRvckJvb2tpbmdTY2hlbWEsXG4gIHVwZGF0ZVZlbmRvckJvb2tpbmdTY2hlbWEsXG4gIHZlbmRvckJvb2tpbmdGaWx0ZXJTY2hlbWEsXG4gIHR5cGUgQ3JlYXRlVmVuZG9yQm9va2luZ0RUTyxcbiAgdHlwZSBVcGRhdGVWZW5kb3JCb29raW5nRFRPLFxuICB0eXBlIFZlbmRvckJvb2tpbmdGaWx0ZXJEVE8sXG4gIHR5cGUgVmVuZG9yQm9va2luZyxcbiAgdHlwZSBQYWdpbmF0ZWRWZW5kb3JCb29raW5ncyxcbiAgdHlwZSBWZW5kb3JCb29raW5nV2l0aERldGFpbHMsXG59IGZyb20gJy4uL3NjaGVtYXMvdmVuZG9yQm9va2luZ1NjaGVtYXMnO1xuaW1wb3J0IHsgc2FuaXRpemVJbnB1dCB9IGZyb20gJy4uL3V0aWxzL3Nhbml0aXphdGlvbic7XG5cbi8vIFJlc3VsdCB0eXBlIGZvciBjb25zaXN0ZW50IGVycm9yIGhhbmRsaW5nXG50eXBlIFJlc3VsdDxUPiA9XG4gIHwgeyBzdWNjZXNzOiB0cnVlOyBkYXRhOiBUIH1cbiAgfCB7IHN1Y2Nlc3M6IGZhbHNlOyBlcnJvcjogeyBjb2RlOiBzdHJpbmc7IG1lc3NhZ2U6IHN0cmluZzsgZGV0YWlscz86IHVua25vd24gfSB9O1xuXG4vLyBJbml0aWFsaXplIFN1cGFiYXNlIGNsaWVudFxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuKTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHZlbmRvciBib29raW5nIGxpbmtpbmcgYSB2ZW5kb3IgdG8gYW4gYWN0aXZpdHkgb3IgZXZlbnQuXG4gKiBcbiAqIEBwYXJhbSBkYXRhIC0gQm9va2luZyBkYXRhIGluY2x1ZGluZyB2ZW5kb3IgSUQsIGFjdGl2aXR5L2V2ZW50IElELCBhbmQgYm9va2luZyBkYXRlXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB0aGUgY3JlYXRlZCBib29raW5nIG9yIGVycm9yIGRldGFpbHNcbiAqIFxuICogQGV4YW1wbGVcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZlbmRvckJvb2tpbmdTZXJ2aWNlLmNyZWF0ZSh7XG4gKiAgIHZlbmRvcklkOiAndmVuZG9yLXV1aWQnLFxuICogICBhY3Rpdml0eUlkOiAnYWN0aXZpdHktdXVpZCcsXG4gKiAgIGJvb2tpbmdEYXRlOiAnMjAyNS0wNi0xNScsXG4gKiB9KTtcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZShkYXRhOiBDcmVhdGVWZW5kb3JCb29raW5nRFRPKTogUHJvbWlzZTxSZXN1bHQ8VmVuZG9yQm9va2luZz4+IHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWYWxpZGF0ZVxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBjcmVhdGVWZW5kb3JCb29raW5nU2NoZW1hLnNhZmVQYXJzZShkYXRhKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIDIuIFNhbml0aXplIHVzZXIgaW5wdXRcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSB7XG4gICAgICAuLi52YWxpZGF0aW9uLmRhdGEsXG4gICAgICBub3RlczogdmFsaWRhdGlvbi5kYXRhLm5vdGVzID8gc2FuaXRpemVJbnB1dCh2YWxpZGF0aW9uLmRhdGEubm90ZXMpIDogbnVsbCxcbiAgICB9O1xuXG4gICAgLy8gMy4gRGF0YWJhc2Ugb3BlcmF0aW9uXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd2ZW5kb3JfYm9va2luZ3MnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHZlbmRvcl9pZDogc2FuaXRpemVkLnZlbmRvcklkLFxuICAgICAgICBhY3Rpdml0eV9pZDogc2FuaXRpemVkLmFjdGl2aXR5SWQsXG4gICAgICAgIGV2ZW50X2lkOiBzYW5pdGl6ZWQuZXZlbnRJZCxcbiAgICAgICAgYm9va2luZ19kYXRlOiBzYW5pdGl6ZWQuYm9va2luZ0RhdGUsXG4gICAgICAgIGd1ZXN0X2NvdW50OiBzYW5pdGl6ZWQuZ3Vlc3RDb3VudCxcbiAgICAgICAgcHJpY2luZ19tb2RlbDogc2FuaXRpemVkLnByaWNpbmdNb2RlbCxcbiAgICAgICAgdG90YWxfY29zdDogc2FuaXRpemVkLnRvdGFsQ29zdCxcbiAgICAgICAgaG9zdF9zdWJzaWR5OiBzYW5pdGl6ZWQuaG9zdFN1YnNpZHksXG4gICAgICAgIG5vdGVzOiBzYW5pdGl6ZWQubm90ZXMsXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBtYXBCb29raW5nRnJvbURiKGJvb2tpbmcpLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHJpZXZlcyBhIHZlbmRvciBib29raW5nIGJ5IElELlxuICogXG4gKiBAcGFyYW0gaWQgLSBCb29raW5nIFVVSURcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIHRoZSBib29raW5nIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldChpZDogc3RyaW5nKTogUHJvbWlzZTxSZXN1bHQ8VmVuZG9yQm9va2luZz4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGE6IGJvb2tpbmcsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3ZlbmRvcl9ib29raW5ncycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaWQnLCBpZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmVuZG9yIGJvb2tpbmcgbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IG1hcEJvb2tpbmdGcm9tRGIoYm9va2luZyksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogVXBkYXRlcyBhbiBleGlzdGluZyB2ZW5kb3IgYm9va2luZy5cbiAqIFxuICogQHBhcmFtIGlkIC0gQm9va2luZyBVVUlEXG4gKiBAcGFyYW0gZGF0YSAtIFBhcnRpYWwgYm9va2luZyBkYXRhIHRvIHVwZGF0ZVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgdGhlIHVwZGF0ZWQgYm9va2luZyBvciBlcnJvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGUoaWQ6IHN0cmluZywgZGF0YTogVXBkYXRlVmVuZG9yQm9va2luZ0RUTyk6IFByb21pc2U8UmVzdWx0PFZlbmRvckJvb2tpbmc+PiB7XG4gIHRyeSB7XG4gICAgLy8gMS4gVmFsaWRhdGVcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdXBkYXRlVmVuZG9yQm9va2luZ1NjaGVtYS5zYWZlUGFyc2UoZGF0YSk7XG4gICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyAyLiBTYW5pdGl6ZSB1c2VyIGlucHV0XG4gICAgY29uc3Qgc2FuaXRpemVkOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuICAgIGlmICh2YWxpZGF0aW9uLmRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLm5vdGVzID0gdmFsaWRhdGlvbi5kYXRhLm5vdGVzID8gc2FuaXRpemVJbnB1dCh2YWxpZGF0aW9uLmRhdGEubm90ZXMpIDogbnVsbDtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRpb24uZGF0YS52ZW5kb3JJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzYW5pdGl6ZWQudmVuZG9yX2lkID0gdmFsaWRhdGlvbi5kYXRhLnZlbmRvcklkO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGlvbi5kYXRhLmFjdGl2aXR5SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLmFjdGl2aXR5X2lkID0gdmFsaWRhdGlvbi5kYXRhLmFjdGl2aXR5SWQ7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0aW9uLmRhdGEuZXZlbnRJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzYW5pdGl6ZWQuZXZlbnRfaWQgPSB2YWxpZGF0aW9uLmRhdGEuZXZlbnRJZDtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRpb24uZGF0YS5ib29raW5nRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzYW5pdGl6ZWQuYm9va2luZ19kYXRlID0gdmFsaWRhdGlvbi5kYXRhLmJvb2tpbmdEYXRlO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGlvbi5kYXRhLmd1ZXN0Q291bnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLmd1ZXN0X2NvdW50ID0gdmFsaWRhdGlvbi5kYXRhLmd1ZXN0Q291bnQ7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0aW9uLmRhdGEucHJpY2luZ01vZGVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNhbml0aXplZC5wcmljaW5nX21vZGVsID0gdmFsaWRhdGlvbi5kYXRhLnByaWNpbmdNb2RlbDtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRpb24uZGF0YS50b3RhbENvc3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLnRvdGFsX2Nvc3QgPSB2YWxpZGF0aW9uLmRhdGEudG90YWxDb3N0O1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGlvbi5kYXRhLmhvc3RTdWJzaWR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNhbml0aXplZC5ob3N0X3N1YnNpZHkgPSB2YWxpZGF0aW9uLmRhdGEuaG9zdFN1YnNpZHk7XG4gICAgfVxuXG4gICAgLy8gMy4gRGF0YWJhc2Ugb3BlcmF0aW9uXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd2ZW5kb3JfYm9va2luZ3MnKVxuICAgICAgLnVwZGF0ZShzYW5pdGl6ZWQpXG4gICAgICAuZXEoJ2lkJywgaWQpXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmVuZG9yIGJvb2tpbmcgbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IG1hcEJvb2tpbmdGcm9tRGIoYm9va2luZyksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogRGVsZXRlcyBhIHZlbmRvciBib29raW5nIGZyb20gdGhlIHN5c3RlbS5cbiAqIFxuICogQHBhcmFtIGlkIC0gQm9va2luZyBVVUlEXG4gKiBAcmV0dXJucyBSZXN1bHQgaW5kaWNhdGluZyBzdWNjZXNzIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUJvb2tpbmcoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVzdWx0PHZvaWQ+PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd2ZW5kb3JfYm9va2luZ3MnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ2lkJywgaWQpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnREFUQUJBU0VfRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZGV0YWlsczogZXJyb3IsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHVuZGVmaW5lZCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvciBvY2N1cnJlZCcsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBMaXN0cyB2ZW5kb3IgYm9va2luZ3Mgd2l0aCBvcHRpb25hbCBmaWx0ZXJpbmcgYW5kIHBhZ2luYXRpb24uXG4gKiBcbiAqIEBwYXJhbSBmaWx0ZXJzIC0gT3B0aW9uYWwgZmlsdGVycyBmb3IgdmVuZG9yLCBhY3Rpdml0eSwgZXZlbnQsIGFuZCBwYWdpbmF0aW9uXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyBwYWdpbmF0ZWQgYm9va2luZyBsaXN0IG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3QoZmlsdGVyczogVmVuZG9yQm9va2luZ0ZpbHRlckRUTyA9IHt9KTogUHJvbWlzZTxSZXN1bHQ8UGFnaW5hdGVkVmVuZG9yQm9va2luZ3M+PiB7XG4gIHRyeSB7XG4gICAgLy8gVmFsaWRhdGUgZmlsdGVyc1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2ZW5kb3JCb29raW5nRmlsdGVyU2NoZW1hLnNhZmVQYXJzZShmaWx0ZXJzKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGZpbHRlcnMnLFxuICAgICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHZlbmRvcklkLCBhY3Rpdml0eUlkLCBldmVudElkLCBwYWdlID0gMSwgcGFnZVNpemUgPSA1MCB9ID0gdmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgLy8gQnVpbGQgcXVlcnlcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCd2ZW5kb3JfYm9va2luZ3MnKS5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnIH0pO1xuXG4gICAgaWYgKHZlbmRvcklkKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCd2ZW5kb3JfaWQnLCB2ZW5kb3JJZCk7XG4gICAgfVxuICAgIGlmIChhY3Rpdml0eUlkKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdhY3Rpdml0eV9pZCcsIGFjdGl2aXR5SWQpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZXZlbnRfaWQnLCBldmVudElkKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBwYWdpbmF0aW9uXG4gICAgY29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZTtcbiAgICBjb25zdCB0byA9IGZyb20gKyBwYWdlU2l6ZSAtIDE7XG4gICAgcXVlcnkgPSBxdWVyeS5yYW5nZShmcm9tLCB0bykub3JkZXIoJ2Jvb2tpbmdfZGF0ZScsIHsgYXNjZW5kaW5nOiB0cnVlIH0pO1xuXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5ncywgZXJyb3IsIGNvdW50IH0gPSBhd2FpdCBxdWVyeTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB0b3RhbCA9IGNvdW50IHx8IDA7XG4gICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBib29raW5nczogYm9va2luZ3MubWFwKG1hcEJvb2tpbmdGcm9tRGIpLFxuICAgICAgICB0b3RhbCxcbiAgICAgICAgcGFnZSxcbiAgICAgICAgcGFnZVNpemUsXG4gICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICB9LFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldHMgdmVuZG9yIGJvb2tpbmdzIHdpdGggZnVsbCBkZXRhaWxzIGluY2x1ZGluZyB2ZW5kb3IgYW5kIGFjdGl2aXR5L2V2ZW50IG5hbWVzLlxuICogXG4gKiBAcGFyYW0gZmlsdGVycyAtIE9wdGlvbmFsIGZpbHRlcnMgZm9yIHZlbmRvciwgYWN0aXZpdHksIGV2ZW50XG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyBib29raW5ncyB3aXRoIGRldGFpbHMgb3IgZXJyb3IgZGV0YWlsc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdFdpdGhEZXRhaWxzKGZpbHRlcnM6IFZlbmRvckJvb2tpbmdGaWx0ZXJEVE8gPSB7fSk6IFByb21pc2U8UmVzdWx0PFZlbmRvckJvb2tpbmdXaXRoRGV0YWlsc1tdPj4ge1xuICB0cnkge1xuICAgIC8vIFZhbGlkYXRlIGZpbHRlcnNcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdmVuZG9yQm9va2luZ0ZpbHRlclNjaGVtYS5zYWZlUGFyc2UoZmlsdGVycyk7XG4gICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBmaWx0ZXJzJyxcbiAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgeyB2ZW5kb3JJZCwgYWN0aXZpdHlJZCwgZXZlbnRJZCB9ID0gdmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgLy8gQnVpbGQgcXVlcnkgd2l0aCBqb2luc1xuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndmVuZG9yX2Jvb2tpbmdzJylcbiAgICAgIC5zZWxlY3QoYFxuICAgICAgICAqLFxuICAgICAgICB2ZW5kb3JzIChpZCwgbmFtZSwgY2F0ZWdvcnkpLFxuICAgICAgICBhY3Rpdml0aWVzIChpZCwgbmFtZSksXG4gICAgICAgIGV2ZW50cyAoaWQsIG5hbWUpXG4gICAgICBgKTtcblxuICAgIGlmICh2ZW5kb3JJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgndmVuZG9yX2lkJywgdmVuZG9ySWQpO1xuICAgIH1cbiAgICBpZiAoYWN0aXZpdHlJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnYWN0aXZpdHlfaWQnLCBhY3Rpdml0eUlkKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50SWQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2V2ZW50X2lkJywgZXZlbnRJZCk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5ncywgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5Lm9yZGVyKCdib29raW5nX2RhdGUnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBib29raW5nc1dpdGhEZXRhaWxzOiBWZW5kb3JCb29raW5nV2l0aERldGFpbHNbXSA9IGJvb2tpbmdzLm1hcCgoYm9va2luZzogYW55KSA9PiAoe1xuICAgICAgaWQ6IGJvb2tpbmcuaWQsXG4gICAgICB2ZW5kb3JJZDogYm9va2luZy52ZW5kb3JfaWQsXG4gICAgICB2ZW5kb3JOYW1lOiBib29raW5nLnZlbmRvcnM/Lm5hbWUgfHwgJ1Vua25vd24nLFxuICAgICAgdmVuZG9yQ2F0ZWdvcnk6IGJvb2tpbmcudmVuZG9ycz8uY2F0ZWdvcnkgfHwgJ290aGVyJyxcbiAgICAgIGFjdGl2aXR5SWQ6IGJvb2tpbmcuYWN0aXZpdHlfaWQsXG4gICAgICBhY3Rpdml0eU5hbWU6IGJvb2tpbmcuYWN0aXZpdGllcz8ubmFtZSB8fCBudWxsLFxuICAgICAgZXZlbnRJZDogYm9va2luZy5ldmVudF9pZCxcbiAgICAgIGV2ZW50TmFtZTogYm9va2luZy5ldmVudHM/Lm5hbWUgfHwgbnVsbCxcbiAgICAgIGJvb2tpbmdEYXRlOiBib29raW5nLmJvb2tpbmdfZGF0ZSxcbiAgICAgIGd1ZXN0Q291bnQ6IGJvb2tpbmcuZ3Vlc3RfY291bnQsXG4gICAgICBwcmljaW5nTW9kZWw6IGJvb2tpbmcucHJpY2luZ19tb2RlbCxcbiAgICAgIHRvdGFsQ29zdDogYm9va2luZy50b3RhbF9jb3N0LFxuICAgICAgaG9zdFN1YnNpZHk6IGJvb2tpbmcuaG9zdF9zdWJzaWR5LFxuICAgICAgbm90ZXM6IGJvb2tpbmcubm90ZXMsXG4gICAgICBjcmVhdGVkQXQ6IGJvb2tpbmcuY3JlYXRlZF9hdCxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGJvb2tpbmdzV2l0aERldGFpbHMsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogR2V0cyBhbGwgYm9va2luZ3MgZm9yIGEgc3BlY2lmaWMgdmVuZG9yLlxuICogXG4gKiBAcGFyYW0gdmVuZG9ySWQgLSBWZW5kb3IgVVVJRFxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgdmVuZG9yJ3MgYm9va2luZ3Mgb3IgZXJyb3IgZGV0YWlsc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VmVuZG9yQm9va2luZ3ModmVuZG9ySWQ6IHN0cmluZyk6IFByb21pc2U8UmVzdWx0PFZlbmRvckJvb2tpbmdXaXRoRGV0YWlsc1tdPj4ge1xuICByZXR1cm4gbGlzdFdpdGhEZXRhaWxzKHsgdmVuZG9ySWQgfSk7XG59XG5cbi8qKlxuICogR2V0cyBhbGwgYm9va2luZ3MgZm9yIGEgc3BlY2lmaWMgYWN0aXZpdHkuXG4gKiBcbiAqIEBwYXJhbSBhY3Rpdml0eUlkIC0gQWN0aXZpdHkgVVVJRFxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgYWN0aXZpdHkncyBib29raW5ncyBvciBlcnJvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUJvb2tpbmdzKGFjdGl2aXR5SWQ6IHN0cmluZyk6IFByb21pc2U8UmVzdWx0PFZlbmRvckJvb2tpbmdXaXRoRGV0YWlsc1tdPj4ge1xuICByZXR1cm4gbGlzdFdpdGhEZXRhaWxzKHsgYWN0aXZpdHlJZCB9KTtcbn1cblxuLyoqXG4gKiBHZXRzIGFsbCBib29raW5ncyBmb3IgYSBzcGVjaWZpYyBldmVudC5cbiAqIFxuICogQHBhcmFtIGV2ZW50SWQgLSBFdmVudCBVVUlEXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyBldmVudCdzIGJvb2tpbmdzIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEV2ZW50Qm9va2luZ3MoZXZlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxSZXN1bHQ8VmVuZG9yQm9va2luZ1dpdGhEZXRhaWxzW10+PiB7XG4gIHJldHVybiBsaXN0V2l0aERldGFpbHMoeyBldmVudElkIH0pO1xufVxuXG4vKipcbiAqIFByb3BhZ2F0ZXMgdmVuZG9yIGNvc3QgY2hhbmdlcyB0byBhbGwgcmVsYXRlZCBib29raW5ncy5cbiAqIFRoaXMgaXMgY2FsbGVkIHdoZW4gYSB2ZW5kb3IncyBjb3N0IGlzIHVwZGF0ZWQgdG8gZW5zdXJlXG4gKiBidWRnZXQgY2FsY3VsYXRpb25zIHJlZmxlY3QgdGhlIG5ldyBjb3N0LlxuICogXG4gKiBAcGFyYW0gdmVuZG9ySWQgLSBWZW5kb3IgVVVJRFxuICogQHJldHVybnMgUmVzdWx0IGluZGljYXRpbmcgc3VjY2VzcyBvciBlcnJvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9wYWdhdGVWZW5kb3JDb3N0Q2hhbmdlKHZlbmRvcklkOiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDx2b2lkPj4ge1xuICB0cnkge1xuICAgIC8vIEdldCBhbGwgYm9va2luZ3MgZm9yIHRoaXMgdmVuZG9yXG4gICAgY29uc3QgYm9va2luZ3NSZXN1bHQgPSBhd2FpdCBnZXRWZW5kb3JCb29raW5ncyh2ZW5kb3JJZCk7XG4gICAgaWYgKCFib29raW5nc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gYm9va2luZ3NSZXN1bHQgYXMgUmVzdWx0PHZvaWQ+O1xuICAgIH1cblxuICAgIC8vIE5vdGU6IEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCB0cmlnZ2VyIHJlY2FsY3VsYXRpb25cbiAgICAvLyBvZiBidWRnZXQgdG90YWxzIGZvciBhbGwgYWN0aXZpdGllcy9ldmVudHMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgdmVuZG9yLlxuICAgIC8vIEZvciBub3csIHdlIGp1c3QgcmV0dXJuIHN1Y2Nlc3MgYXMgdGhlIGJ1ZGdldCBzZXJ2aWNlIHdpbGxcbiAgICAvLyByZWNhbGN1bGF0ZSBvbi1kZW1hbmQgd2hlbiByZXF1ZXN0ZWQuXG5cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB1bmRlZmluZWQgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTWFwcyBkYXRhYmFzZSBib29raW5nIHJlY29yZCB0byBWZW5kb3JCb29raW5nIHR5cGUuXG4gKi9cbmZ1bmN0aW9uIG1hcEJvb2tpbmdGcm9tRGIoZGJCb29raW5nOiBhbnkpOiBWZW5kb3JCb29raW5nIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogZGJCb29raW5nLmlkLFxuICAgIHZlbmRvcklkOiBkYkJvb2tpbmcudmVuZG9yX2lkLFxuICAgIGFjdGl2aXR5SWQ6IGRiQm9va2luZy5hY3Rpdml0eV9pZCxcbiAgICBldmVudElkOiBkYkJvb2tpbmcuZXZlbnRfaWQsXG4gICAgYm9va2luZ0RhdGU6IGRiQm9va2luZy5ib29raW5nX2RhdGUsXG4gICAgZ3Vlc3RDb3VudDogZGJCb29raW5nLmd1ZXN0X2NvdW50LFxuICAgIHByaWNpbmdNb2RlbDogZGJCb29raW5nLnByaWNpbmdfbW9kZWwsXG4gICAgdG90YWxDb3N0OiBkYkJvb2tpbmcudG90YWxfY29zdCxcbiAgICBob3N0U3Vic2lkeTogZGJCb29raW5nLmhvc3Rfc3Vic2lkeSxcbiAgICBub3RlczogZGJCb29raW5nLm5vdGVzLFxuICAgIGNyZWF0ZWRBdDogZGJCb29raW5nLmNyZWF0ZWRfYXQsXG4gIH07XG59XG4iXSwibmFtZXMiOlsiY3JlYXRlIiwiZGVsZXRlQm9va2luZyIsImdldCIsImdldEFjdGl2aXR5Qm9va2luZ3MiLCJnZXRFdmVudEJvb2tpbmdzIiwiZ2V0VmVuZG9yQm9va2luZ3MiLCJsaXN0IiwibGlzdFdpdGhEZXRhaWxzIiwicHJvcGFnYXRlVmVuZG9yQ29zdENoYW5nZSIsInVwZGF0ZSIsInN1cGFiYXNlIiwiY3JlYXRlQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGF0YSIsInZhbGlkYXRpb24iLCJjcmVhdGVWZW5kb3JCb29raW5nU2NoZW1hIiwic2FmZVBhcnNlIiwic3VjY2VzcyIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJkZXRhaWxzIiwiaXNzdWVzIiwic2FuaXRpemVkIiwibm90ZXMiLCJzYW5pdGl6ZUlucHV0IiwiYm9va2luZyIsImZyb20iLCJpbnNlcnQiLCJ2ZW5kb3JfaWQiLCJ2ZW5kb3JJZCIsImFjdGl2aXR5X2lkIiwiYWN0aXZpdHlJZCIsImV2ZW50X2lkIiwiZXZlbnRJZCIsImJvb2tpbmdfZGF0ZSIsImJvb2tpbmdEYXRlIiwiZ3Vlc3RfY291bnQiLCJndWVzdENvdW50IiwicHJpY2luZ19tb2RlbCIsInByaWNpbmdNb2RlbCIsInRvdGFsX2Nvc3QiLCJ0b3RhbENvc3QiLCJob3N0X3N1YnNpZHkiLCJob3N0U3Vic2lkeSIsInNlbGVjdCIsInNpbmdsZSIsIm1hcEJvb2tpbmdGcm9tRGIiLCJFcnJvciIsImlkIiwiZXEiLCJ1cGRhdGVWZW5kb3JCb29raW5nU2NoZW1hIiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiZmlsdGVycyIsInZlbmRvckJvb2tpbmdGaWx0ZXJTY2hlbWEiLCJwYWdlIiwicGFnZVNpemUiLCJxdWVyeSIsImNvdW50IiwidG8iLCJyYW5nZSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiYm9va2luZ3MiLCJ0b3RhbCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsIm1hcCIsImJvb2tpbmdzV2l0aERldGFpbHMiLCJ2ZW5kb3JOYW1lIiwidmVuZG9ycyIsIm5hbWUiLCJ2ZW5kb3JDYXRlZ29yeSIsImNhdGVnb3J5IiwiYWN0aXZpdHlOYW1lIiwiYWN0aXZpdGllcyIsImV2ZW50TmFtZSIsImV2ZW50cyIsImNyZWF0ZWRBdCIsImNyZWF0ZWRfYXQiLCJib29raW5nc1Jlc3VsdCIsImRiQm9va2lu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