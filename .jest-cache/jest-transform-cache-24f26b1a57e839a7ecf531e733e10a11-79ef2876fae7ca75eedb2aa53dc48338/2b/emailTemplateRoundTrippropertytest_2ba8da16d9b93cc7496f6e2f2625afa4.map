{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/emailTemplateRoundTrip.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\n\n/**\n * Property-Based Test for Email Template Round-Trip\n * Feature: destination-wedding-platform, Property 25: Email Template Round-Trip\n * \n * Property: For any valid email template object, the sequence of operations \n * (format to string → parse from string → format to string again) should produce \n * an equivalent template with all fields and variables preserved.\n * \n * Validates: Requirements 20.7\n */\n\n/**\n * Email template formatter - converts template object to string format.\n */\nfunction formatEmailTemplate(template: {\n  name: string;\n  subject: string;\n  body_html: string;\n  body_text: string;\n  variables: string[];\n}): string {\n  return JSON.stringify({\n    name: template.name,\n    subject: template.subject,\n    body_html: template.body_html,\n    body_text: template.body_text,\n    variables: template.variables,\n  });\n}\n\n/**\n * Email template parser - parses string format back to template object.\n */\nfunction parseEmailTemplate(templateString: string): {\n  name: string;\n  subject: string;\n  body_html: string;\n  body_text: string;\n  variables: string[];\n} {\n  const parsed = JSON.parse(templateString);\n  return {\n    name: parsed.name,\n    subject: parsed.subject,\n    body_html: parsed.body_html,\n    body_text: parsed.body_text,\n    variables: parsed.variables || [],\n  };\n}\n\ndescribe('Feature: destination-wedding-platform, Property 25: Email Template Round-Trip', () => {\n  // Arbitrary for valid email template\n  const emailTemplateArbitrary = fc.record({\n    name: fc.string({ minLength: 1, maxLength: 100 }),\n    subject: fc.string({ minLength: 1, maxLength: 200 }),\n    body_html: fc.string({ minLength: 1, maxLength: 1000 }),\n    body_text: fc.string({ minLength: 1, maxLength: 1000 }),\n    variables: fc.array(\n      fc.string({ minLength: 1, maxLength: 50 }).filter(s => !s.includes('\"') && !s.includes('\\\\')),\n      { maxLength: 20 }\n    ),\n  });\n\n  it('should preserve all template fields through format → parse → format cycle', () => {\n    fc.assert(\n      fc.property(emailTemplateArbitrary, (template) => {\n        // Format to string\n        const formatted1 = formatEmailTemplate(template);\n        \n        // Parse back to object\n        const parsed = parseEmailTemplate(formatted1);\n        \n        // Format again\n        const formatted2 = formatEmailTemplate(parsed);\n        \n        // The two formatted strings should be identical\n        expect(formatted1).toBe(formatted2);\n        \n        // The parsed object should match the original\n        expect(parsed.name).toBe(template.name);\n        expect(parsed.subject).toBe(template.subject);\n        expect(parsed.body_html).toBe(template.body_html);\n        expect(parsed.body_text).toBe(template.body_text);\n        expect(parsed.variables).toEqual(template.variables);\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should preserve template with no variables', () => {\n    fc.assert(\n      fc.property(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.string({ minLength: 1, maxLength: 1000 }),\n          body_text: fc.string({ minLength: 1, maxLength: 1000 }),\n          variables: fc.constant([]),\n        }),\n        (template) => {\n          const formatted = formatEmailTemplate(template);\n          const parsed = parseEmailTemplate(formatted);\n          \n          expect(parsed.variables).toEqual([]);\n          expect(parsed.name).toBe(template.name);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should preserve template with special characters in content', () => {\n    fc.assert(\n      fc.property(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.constantFrom(\n            '<p>Hello {{guest_name}}</p>',\n            '<div><strong>Welcome</strong> to our wedding!</div>',\n            '<a href=\"https://example.com\">Click here</a>',\n            '<ul><li>Item 1</li><li>Item 2</li></ul>'\n          ),\n          body_text: fc.constantFrom(\n            'Hello {{guest_name}}',\n            'Welcome to our wedding!',\n            'RSVP by {{deadline}}',\n            'Event: {{event_name}} at {{location}}'\n          ),\n          variables: fc.array(fc.string({ minLength: 1, maxLength: 20 }), { maxLength: 10 }),\n        }),\n        (template) => {\n          const formatted1 = formatEmailTemplate(template);\n          const parsed = parseEmailTemplate(formatted1);\n          const formatted2 = formatEmailTemplate(parsed);\n          \n          expect(formatted1).toBe(formatted2);\n          expect(parsed.body_html).toBe(template.body_html);\n          expect(parsed.body_text).toBe(template.body_text);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should preserve template with multiple variables', () => {\n    fc.assert(\n      fc.property(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.string({ minLength: 1, maxLength: 1000 }),\n          body_text: fc.string({ minLength: 1, maxLength: 1000 }),\n          variables: fc.array(\n            fc.string({ minLength: 1, maxLength: 20 }),\n            { minLength: 1, maxLength: 20 }\n          ),\n        }),\n        (template) => {\n          const formatted = formatEmailTemplate(template);\n          const parsed = parseEmailTemplate(formatted);\n          \n          // Variables array should be preserved exactly\n          expect(parsed.variables).toEqual(template.variables);\n          expect(parsed.variables.length).toBe(template.variables.length);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle templates with unicode characters', () => {\n    fc.assert(\n      fc.property(\n        fc.record({\n          name: fc.fullUnicodeString({ minLength: 1, maxLength: 100 }),\n          subject: fc.fullUnicodeString({ minLength: 1, maxLength: 200 }),\n          body_html: fc.fullUnicodeString({ minLength: 1, maxLength: 500 }),\n          body_text: fc.fullUnicodeString({ minLength: 1, maxLength: 500 }),\n          variables: fc.array(fc.string({ minLength: 1, maxLength: 20 }), { maxLength: 5 }),\n        }),\n        (template) => {\n          const formatted1 = formatEmailTemplate(template);\n          const parsed = parseEmailTemplate(formatted1);\n          const formatted2 = formatEmailTemplate(parsed);\n          \n          // Should preserve unicode characters\n          expect(formatted1).toBe(formatted2);\n          expect(parsed.name).toBe(template.name);\n          expect(parsed.subject).toBe(template.subject);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should preserve template with newlines and whitespace', () => {\n    fc.assert(\n      fc.property(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.constantFrom(\n            '<p>Line 1\\nLine 2\\nLine 3</p>',\n            '<div>  Spaces  and  tabs\\t\\there  </div>',\n            '<p>\\n\\n\\nMultiple newlines\\n\\n\\n</p>'\n          ),\n          body_text: fc.constantFrom(\n            'Line 1\\nLine 2\\nLine 3',\n            '  Spaces  and  tabs\\t\\there  ',\n            '\\n\\n\\nMultiple newlines\\n\\n\\n'\n          ),\n          variables: fc.array(fc.string({ minLength: 1, maxLength: 20 }), { maxLength: 5 }),\n        }),\n        (template) => {\n          const formatted1 = formatEmailTemplate(template);\n          const parsed = parseEmailTemplate(formatted1);\n          const formatted2 = formatEmailTemplate(parsed);\n          \n          // Whitespace should be preserved\n          expect(formatted1).toBe(formatted2);\n          expect(parsed.body_html).toBe(template.body_html);\n          expect(parsed.body_text).toBe(template.body_text);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should be idempotent - multiple round trips produce same result', () => {\n    fc.assert(\n      fc.property(emailTemplateArbitrary, (template) => {\n        // First round trip\n        const formatted1 = formatEmailTemplate(template);\n        const parsed1 = parseEmailTemplate(formatted1);\n        const formatted2 = formatEmailTemplate(parsed1);\n        \n        // Second round trip\n        const parsed2 = parseEmailTemplate(formatted2);\n        const formatted3 = formatEmailTemplate(parsed2);\n        \n        // Third round trip\n        const parsed3 = parseEmailTemplate(formatted3);\n        const formatted4 = formatEmailTemplate(parsed3);\n        \n        // All formatted strings should be identical\n        expect(formatted1).toBe(formatted2);\n        expect(formatted2).toBe(formatted3);\n        expect(formatted3).toBe(formatted4);\n        \n        // All parsed objects should be equivalent\n        expect(parsed1).toEqual(parsed2);\n        expect(parsed2).toEqual(parsed3);\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should preserve empty strings in fields', () => {\n    fc.assert(\n      fc.property(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.string({ minLength: 1, maxLength: 1000 }),\n          body_text: fc.constant(''), // Empty text body\n          variables: fc.array(fc.string({ minLength: 1, maxLength: 20 }), { maxLength: 5 }),\n        }),\n        (template) => {\n          const formatted = formatEmailTemplate(template);\n          const parsed = parseEmailTemplate(formatted);\n          \n          // Empty string should be preserved, not converted to undefined\n          expect(parsed.body_text).toBe('');\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["formatEmailTemplate","template","JSON","stringify","name","subject","body_html","body_text","variables","parseEmailTemplate","templateString","parsed","parse","describe","emailTemplateArbitrary","fc","record","string","minLength","maxLength","array","filter","s","includes","it","assert","property","formatted1","formatted2","expect","toBe","toEqual","numRuns","constant","formatted","constantFrom","length","fullUnicodeString","parsed1","parsed2","formatted3","parsed3","formatted4"],"mappings":"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"}