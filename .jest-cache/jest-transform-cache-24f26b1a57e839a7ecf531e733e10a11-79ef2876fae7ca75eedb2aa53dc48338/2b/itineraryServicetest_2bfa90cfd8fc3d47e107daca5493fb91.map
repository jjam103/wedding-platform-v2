{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/itineraryService.test.ts"],"sourcesContent":["import { describe, it, expect, jest, beforeEach } from '@jest/globals';\nimport {\n  generateItinerary,\n  cacheItinerary,\n  getCachedItinerary,\n  invalidateCache,\n} from './itineraryService';\nimport { createMockSupabaseClient } from '../__tests__/helpers/mockSupabase';\n\n// Mock the supabase lib at the module level\nconst mockSupabase = createMockSupabaseClient();\njest.mock('../lib/supabase', () => ({\n  supabase: mockSupabase,\n}));\n\n// Mock localStorage for browser environment\nconst mockLocalStorage = {\n  getItem: jest.fn(),\n  setItem: jest.fn(),\n  removeItem: jest.fn(),\n};\n\n// Mock window and localStorage\nObject.defineProperty(global, 'window', {\n  value: {\n    localStorage: mockLocalStorage,\n  },\n  writable: true,\n});\n\ndescribe('itineraryService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // Reset localStorage mocks\n    mockLocalStorage.getItem.mockReset();\n    mockLocalStorage.setItem.mockReset();\n    mockLocalStorage.removeItem.mockReset();\n  });\n\n  describe('generateItinerary', () => {\n    it('should return success with guest itinerary when guest exists', async () => {\n      const mockGuest = {\n        id: 'guest-1',\n        first_name: 'John',\n        last_name: 'Doe',\n        email: 'john@example.com',\n        guest_type: 'wedding_guest',\n        airport_code: 'SJO',\n        flight_number: 'AA123',\n        arrival_date: '2025-06-14',\n        departure_date: '2025-06-17',\n      };\n\n      const mockEvents = [\n        {\n          id: 'event-1',\n          name: 'Wedding Ceremony',\n          event_type: 'ceremony',\n          start_date: '2025-06-15T14:00:00Z',\n          end_date: '2025-06-15T15:00:00Z',\n          location_id: 'location-1',\n          description: 'Beach ceremony',\n        },\n      ];\n\n      const mockActivities = [\n        {\n          id: 'activity-1',\n          name: 'Beach Volleyball',\n          activity_type: 'sport',\n          start_time: '2025-06-16T10:00:00Z',\n          end_time: '2025-06-16T12:00:00Z',\n          location_id: 'location-2',\n          description: 'Fun beach activity',\n        },\n      ];\n\n      const mockRsvps = [\n        { event_id: 'event-1', activity_id: null, status: 'attending' },\n        { event_id: null, activity_id: 'activity-1', status: 'maybe' },\n      ];\n\n      const mockRoomAssignment = {\n        check_in: '2025-06-14',\n        check_out: '2025-06-17',\n        room_types: {\n          name: 'Ocean View Suite',\n          accommodations: {\n            name: 'Beach Resort',\n            address: '123 Beach Road',\n          },\n        },\n      };\n\n      // Set up mock responses for different table queries\n      mockSupabase.from.mockImplementation((table: string) => {\n        if (table === 'guests') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: mockGuest,\n                  error: null,\n                }),\n              }),\n            }),\n          };\n        }\n        if (table === 'events') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                or: jest.fn().mockReturnValue({\n                  order: jest.fn().mockResolvedValue({\n                    data: mockEvents,\n                    error: null,\n                  }),\n                }),\n              }),\n            }),\n          };\n        }\n        if (table === 'activities') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                or: jest.fn().mockReturnValue({\n                  order: jest.fn().mockResolvedValue({\n                    data: mockActivities,\n                    error: null,\n                  }),\n                }),\n              }),\n            }),\n          };\n        }\n        if (table === 'rsvps') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockResolvedValue({\n                data: mockRsvps,\n                error: null,\n              }),\n            }),\n          };\n        }\n        if (table === 'room_assignments') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                maybeSingle: jest.fn().mockResolvedValue({\n                  data: mockRoomAssignment,\n                  error: null,\n                }),\n              }),\n            }),\n          };\n        }\n        return {};\n      });\n\n      const result = await generateItinerary('guest-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.guest_name).toBe('John Doe');\n        expect(result.data.events).toHaveLength(2); // 1 event + 1 activity\n        expect(result.data.events[0].name).toBe('Wedding Ceremony');\n        expect(result.data.events[0].rsvp_status).toBe('attending');\n        expect(result.data.events[1].name).toBe('Beach Volleyball');\n        expect(result.data.events[1].rsvp_status).toBe('maybe');\n        expect(result.data.accommodation?.accommodation_name).toBe('Beach Resort');\n        expect(result.data.transportation?.airport_code).toBe('SJO');\n      }\n    });\n\n    it('should return GUEST_NOT_FOUND when guest does not exist', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { code: 'PGRST116' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await generateItinerary('nonexistent-guest');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('GUEST_NOT_FOUND');\n      }\n    });\n\n    it('should return DATABASE_ERROR when events query fails', async () => {\n      const mockGuest = {\n        id: 'guest-1',\n        first_name: 'John',\n        last_name: 'Doe',\n        guest_type: 'wedding_guest',\n      };\n\n      mockSupabase.from.mockImplementation((table: string) => {\n        if (table === 'guests') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: mockGuest,\n                  error: null,\n                }),\n              }),\n            }),\n          };\n        }\n        if (table === 'events') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                or: jest.fn().mockReturnValue({\n                  order: jest.fn().mockResolvedValue({\n                    data: null,\n                    error: { message: 'Connection failed' },\n                  }),\n                }),\n              }),\n            }),\n          };\n        }\n        return {};\n      });\n\n      const result = await generateItinerary('guest-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('cacheItinerary', () => {\n    it('should return success when itinerary is cached successfully', async () => {\n      const mockItinerary = {\n        guest_id: 'guest-1',\n        guest_name: 'John Doe',\n        events: [],\n        generated_at: '2025-01-01T00:00:00Z',\n      };\n\n      const result = await cacheItinerary('guest-1', mockItinerary);\n\n      expect(result.success).toBe(true);\n      expect(mockLocalStorage.setItem).toHaveBeenCalledWith(\n        'itinerary-guest-1',\n        JSON.stringify(mockItinerary)\n      );\n    });\n\n    it('should return STORAGE_UNAVAILABLE when localStorage is not available', async () => {\n      // Mock window.localStorage as undefined\n      Object.defineProperty(global, 'window', {\n        value: undefined,\n        writable: true,\n      });\n\n      const mockItinerary = {\n        guest_id: 'guest-1',\n        guest_name: 'John Doe',\n        events: [],\n        generated_at: '2025-01-01T00:00:00Z',\n      };\n\n      const result = await cacheItinerary('guest-1', mockItinerary);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('STORAGE_UNAVAILABLE');\n      }\n\n      // Restore window\n      Object.defineProperty(global, 'window', {\n        value: {\n          localStorage: mockLocalStorage,\n        },\n        writable: true,\n      });\n    });\n  });\n\n  describe('getCachedItinerary', () => {\n    it('should return success with cached itinerary when it exists', async () => {\n      const mockItinerary = {\n        guest_id: 'guest-1',\n        guest_name: 'John Doe',\n        events: [],\n        generated_at: '2025-01-01T00:00:00Z',\n      };\n\n      mockLocalStorage.getItem.mockReturnValue(JSON.stringify(mockItinerary));\n\n      const result = await getCachedItinerary('guest-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toEqual(mockItinerary);\n      }\n      expect(mockLocalStorage.getItem).toHaveBeenCalledWith('itinerary-guest-1');\n    });\n\n    it('should return success with null when no cached itinerary exists', async () => {\n      mockLocalStorage.getItem.mockReturnValue(null);\n\n      const result = await getCachedItinerary('guest-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBeNull();\n      }\n    });\n\n    it('should return STORAGE_UNAVAILABLE when localStorage is not available', async () => {\n      // Mock window as undefined\n      Object.defineProperty(global, 'window', {\n        value: undefined,\n        writable: true,\n      });\n\n      const result = await getCachedItinerary('guest-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('STORAGE_UNAVAILABLE');\n      }\n\n      // Restore window\n      Object.defineProperty(global, 'window', {\n        value: {\n          localStorage: mockLocalStorage,\n        },\n        writable: true,\n      });\n    });\n  });\n\n  describe('invalidateCache', () => {\n    it('should return success when cache is invalidated successfully', async () => {\n      const result = await invalidateCache('guest-1');\n\n      expect(result.success).toBe(true);\n      expect(mockLocalStorage.removeItem).toHaveBeenCalledWith('itinerary-guest-1');\n    });\n\n    it('should return STORAGE_UNAVAILABLE when localStorage is not available', async () => {\n      // Mock window as undefined\n      Object.defineProperty(global, 'window', {\n        value: undefined,\n        writable: true,\n      });\n\n      const result = await invalidateCache('guest-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('STORAGE_UNAVAILABLE');\n      }\n\n      // Restore window\n      Object.defineProperty(global, 'window', {\n        value: {\n          localStorage: mockLocalStorage,\n        },\n        writable: true,\n      });\n    });\n  });\n});"],"names":["mockSupabase","createMockSupabaseClient","jest","mock","supabase","mockLocalStorage","getItem","fn","setItem","removeItem","Object","defineProperty","global","value","localStorage","writable","describe","beforeEach","clearAllMocks","mockReset","it","mockGuest","id","first_name","last_name","email","guest_type","airport_code","flight_number","arrival_date","departure_date","mockEvents","name","event_type","start_date","end_date","location_id","description","mockActivities","activity_type","start_time","end_time","mockRsvps","event_id","activity_id","status","mockRoomAssignment","check_in","check_out","room_types","accommodations","address","from","mockImplementation","table","select","mockReturnValue","eq","single","mockResolvedValue","data","error","or","order","maybeSingle","result","generateItinerary","expect","success","toBe","guest_name","events","toHaveLength","rsvp_status","accommodation","accommodation_name","transportation","code","message","mockItinerary","guest_id","generated_at","cacheItinerary","toHaveBeenCalledWith","JSON","stringify","undefined","getCachedItinerary","toEqual","toBeNull","invalidateCache"],"mappings":"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"}