7d4e61f53f630ec3c4b1123eb577f34d
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "GET", {
    enumerable: true,
    get: function() {
        return GET;
    }
});
const _zod = require("zod");
const _apiHelpers = require("../../../../lib/apiHelpers");
const _rsvpManagementService = /*#__PURE__*/ _interop_require_wildcard(require("../../../../services/rsvpManagementService"));
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
/**
 * GET /api/admin/rsvps
 * 
 * List all RSVPs with filtering, pagination, and statistics
 * 
 * Query Parameters:
 * - page: number (default: 1)
 * - limit: number (default: 50, max: 100)
 * - eventId: string (UUID)
 * - activityId: string (UUID)
 * - status: 'pending' | 'attending' | 'declined' | 'maybe'
 * - guestId: string (UUID)
 * - searchQuery: string (searches guest name and email)
 * 
 * Returns:
 * - data: Array of RSVP view models
 * - pagination: { page, limit, total, totalPages }
 * - statistics: { totalRSVPs, byStatus, totalGuestCount }
 * 
 * **Validates: Requirements 6.2, 6.5**
 */ // Query parameter validation schema
const queryParamsSchema = _zod.z.object({
    page: _zod.z.coerce.number().int().positive().default(1),
    limit: _zod.z.coerce.number().int().positive().max(100).default(50),
    eventId: _zod.z.string().uuid().optional(),
    activityId: _zod.z.string().uuid().optional(),
    status: _zod.z.enum([
        'pending',
        'attending',
        'declined',
        'maybe'
    ]).optional(),
    guestId: _zod.z.string().uuid().optional(),
    searchQuery: _zod.z.string().max(100).optional()
});
/**
 * Map error codes to HTTP status codes
 */ function getStatusCode(errorCode) {
    const statusMap = {
        'VALIDATION_ERROR': 400,
        'INVALID_INPUT': 400,
        'UNAUTHORIZED': 401,
        'AUTHENTICATION_REQUIRED': 401,
        'FORBIDDEN': 403,
        'NOT_FOUND': 404,
        'DATABASE_ERROR': 500,
        'INTERNAL_ERROR': 500,
        'UNKNOWN_ERROR': 500
    };
    return statusMap[errorCode] || 500;
}
async function GET(request) {
    return (0, _apiHelpers.withAuth)(async (userId)=>{
        try {
            // 1. Parse and validate query parameters
            const { searchParams } = new URL(request.url);
            const queryValidation = queryParamsSchema.safeParse({
                page: searchParams.get('page'),
                limit: searchParams.get('limit'),
                eventId: searchParams.get('eventId'),
                activityId: searchParams.get('activityId'),
                status: searchParams.get('status'),
                guestId: searchParams.get('guestId'),
                searchQuery: searchParams.get('searchQuery')
            });
            if (!queryValidation.success) {
                return (0, _apiHelpers.errorResponse)('VALIDATION_ERROR', 'Invalid query parameters', 400, {
                    fields: queryValidation.error.issues
                });
            }
            const { page, limit, ...filters } = queryValidation.data;
            // 2. Call service layer
            const result = await _rsvpManagementService.listRSVPs(filters, {
                page,
                limit
            });
            // 3. Handle service errors
            if (!result.success) {
                return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, getStatusCode(result.error.code), result.error.details);
            }
            // 4. Return success response
            return (0, _apiHelpers.successResponse)(result.data, 200);
        } catch (error) {
            console.error('GET /api/admin/rsvps error:', {
                error: error instanceof Error ? error.message : 'Unknown error',
                stack: error instanceof Error ? error.stack : undefined
            });
            return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', 'Failed to fetch RSVPs', 500);
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9yc3Zwcy9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCB7IHdpdGhBdXRoLCBlcnJvclJlc3BvbnNlLCBzdWNjZXNzUmVzcG9uc2UgfSBmcm9tICdAL2xpYi9hcGlIZWxwZXJzJztcbmltcG9ydCAqIGFzIHJzdnBNYW5hZ2VtZW50U2VydmljZSBmcm9tICdAL3NlcnZpY2VzL3JzdnBNYW5hZ2VtZW50U2VydmljZSc7XG5cbi8qKlxuICogR0VUIC9hcGkvYWRtaW4vcnN2cHNcbiAqIFxuICogTGlzdCBhbGwgUlNWUHMgd2l0aCBmaWx0ZXJpbmcsIHBhZ2luYXRpb24sIGFuZCBzdGF0aXN0aWNzXG4gKiBcbiAqIFF1ZXJ5IFBhcmFtZXRlcnM6XG4gKiAtIHBhZ2U6IG51bWJlciAoZGVmYXVsdDogMSlcbiAqIC0gbGltaXQ6IG51bWJlciAoZGVmYXVsdDogNTAsIG1heDogMTAwKVxuICogLSBldmVudElkOiBzdHJpbmcgKFVVSUQpXG4gKiAtIGFjdGl2aXR5SWQ6IHN0cmluZyAoVVVJRClcbiAqIC0gc3RhdHVzOiAncGVuZGluZycgfCAnYXR0ZW5kaW5nJyB8ICdkZWNsaW5lZCcgfCAnbWF5YmUnXG4gKiAtIGd1ZXN0SWQ6IHN0cmluZyAoVVVJRClcbiAqIC0gc2VhcmNoUXVlcnk6IHN0cmluZyAoc2VhcmNoZXMgZ3Vlc3QgbmFtZSBhbmQgZW1haWwpXG4gKiBcbiAqIFJldHVybnM6XG4gKiAtIGRhdGE6IEFycmF5IG9mIFJTVlAgdmlldyBtb2RlbHNcbiAqIC0gcGFnaW5hdGlvbjogeyBwYWdlLCBsaW1pdCwgdG90YWwsIHRvdGFsUGFnZXMgfVxuICogLSBzdGF0aXN0aWNzOiB7IHRvdGFsUlNWUHMsIGJ5U3RhdHVzLCB0b3RhbEd1ZXN0Q291bnQgfVxuICogXG4gKiAqKlZhbGlkYXRlczogUmVxdWlyZW1lbnRzIDYuMiwgNi41KipcbiAqL1xuXG4vLyBRdWVyeSBwYXJhbWV0ZXIgdmFsaWRhdGlvbiBzY2hlbWFcbmNvbnN0IHF1ZXJ5UGFyYW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICBwYWdlOiB6LmNvZXJjZS5udW1iZXIoKS5pbnQoKS5wb3NpdGl2ZSgpLmRlZmF1bHQoMSksXG4gIGxpbWl0OiB6LmNvZXJjZS5udW1iZXIoKS5pbnQoKS5wb3NpdGl2ZSgpLm1heCgxMDApLmRlZmF1bHQoNTApLFxuICBldmVudElkOiB6LnN0cmluZygpLnV1aWQoKS5vcHRpb25hbCgpLFxuICBhY3Rpdml0eUlkOiB6LnN0cmluZygpLnV1aWQoKS5vcHRpb25hbCgpLFxuICBzdGF0dXM6IHouZW51bShbJ3BlbmRpbmcnLCAnYXR0ZW5kaW5nJywgJ2RlY2xpbmVkJywgJ21heWJlJ10pLm9wdGlvbmFsKCksXG4gIGd1ZXN0SWQ6IHouc3RyaW5nKCkudXVpZCgpLm9wdGlvbmFsKCksXG4gIHNlYXJjaFF1ZXJ5OiB6LnN0cmluZygpLm1heCgxMDApLm9wdGlvbmFsKCksXG59KTtcblxuLyoqXG4gKiBNYXAgZXJyb3IgY29kZXMgdG8gSFRUUCBzdGF0dXMgY29kZXNcbiAqL1xuZnVuY3Rpb24gZ2V0U3RhdHVzQ29kZShlcnJvckNvZGU6IHN0cmluZyk6IG51bWJlciB7XG4gIGNvbnN0IHN0YXR1c01hcDogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcbiAgICAnVkFMSURBVElPTl9FUlJPUic6IDQwMCxcbiAgICAnSU5WQUxJRF9JTlBVVCc6IDQwMCxcbiAgICAnVU5BVVRIT1JJWkVEJzogNDAxLFxuICAgICdBVVRIRU5USUNBVElPTl9SRVFVSVJFRCc6IDQwMSxcbiAgICAnRk9SQklEREVOJzogNDAzLFxuICAgICdOT1RfRk9VTkQnOiA0MDQsXG4gICAgJ0RBVEFCQVNFX0VSUk9SJzogNTAwLFxuICAgICdJTlRFUk5BTF9FUlJPUic6IDUwMCxcbiAgICAnVU5LTk9XTl9FUlJPUic6IDUwMCxcbiAgfTtcbiAgXG4gIHJldHVybiBzdGF0dXNNYXBbZXJyb3JDb2RlXSB8fCA1MDA7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogUmVxdWVzdCkge1xuICByZXR1cm4gd2l0aEF1dGgoYXN5bmMgKHVzZXJJZCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyAxLiBQYXJzZSBhbmQgdmFsaWRhdGUgcXVlcnkgcGFyYW1ldGVyc1xuICAgICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuICAgICAgXG4gICAgICBjb25zdCBxdWVyeVZhbGlkYXRpb24gPSBxdWVyeVBhcmFtc1NjaGVtYS5zYWZlUGFyc2Uoe1xuICAgICAgICBwYWdlOiBzZWFyY2hQYXJhbXMuZ2V0KCdwYWdlJyksXG4gICAgICAgIGxpbWl0OiBzZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpLFxuICAgICAgICBldmVudElkOiBzZWFyY2hQYXJhbXMuZ2V0KCdldmVudElkJyksXG4gICAgICAgIGFjdGl2aXR5SWQ6IHNlYXJjaFBhcmFtcy5nZXQoJ2FjdGl2aXR5SWQnKSxcbiAgICAgICAgc3RhdHVzOiBzZWFyY2hQYXJhbXMuZ2V0KCdzdGF0dXMnKSxcbiAgICAgICAgZ3Vlc3RJZDogc2VhcmNoUGFyYW1zLmdldCgnZ3Vlc3RJZCcpLFxuICAgICAgICBzZWFyY2hRdWVyeTogc2VhcmNoUGFyYW1zLmdldCgnc2VhcmNoUXVlcnknKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXF1ZXJ5VmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICAgICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICAnSW52YWxpZCBxdWVyeSBwYXJhbWV0ZXJzJyxcbiAgICAgICAgICA0MDAsXG4gICAgICAgICAgeyBmaWVsZHM6IHF1ZXJ5VmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IHBhZ2UsIGxpbWl0LCAuLi5maWx0ZXJzIH0gPSBxdWVyeVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgLy8gMi4gQ2FsbCBzZXJ2aWNlIGxheWVyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByc3ZwTWFuYWdlbWVudFNlcnZpY2UubGlzdFJTVlBzKFxuICAgICAgICBmaWx0ZXJzLFxuICAgICAgICB7IHBhZ2UsIGxpbWl0IH1cbiAgICAgICk7XG5cbiAgICAgIC8vIDMuIEhhbmRsZSBzZXJ2aWNlIGVycm9yc1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICAgICByZXN1bHQuZXJyb3IuY29kZSxcbiAgICAgICAgICByZXN1bHQuZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBnZXRTdGF0dXNDb2RlKHJlc3VsdC5lcnJvci5jb2RlKSxcbiAgICAgICAgICByZXN1bHQuZXJyb3IuZGV0YWlsc1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyA0LiBSZXR1cm4gc3VjY2VzcyByZXNwb25zZVxuICAgICAgcmV0dXJuIHN1Y2Nlc3NSZXNwb25zZShyZXN1bHQuZGF0YSwgMjAwKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdHRVQgL2FwaS9hZG1pbi9yc3ZwcyBlcnJvcjonLCB7XG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICAgJ0lOVEVSTkFMX0VSUk9SJyxcbiAgICAgICAgJ0ZhaWxlZCB0byBmZXRjaCBSU1ZQcycsXG4gICAgICAgIDUwMFxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xufVxuIl0sIm5hbWVzIjpbIkdFVCIsInF1ZXJ5UGFyYW1zU2NoZW1hIiwieiIsIm9iamVjdCIsInBhZ2UiLCJjb2VyY2UiLCJudW1iZXIiLCJpbnQiLCJwb3NpdGl2ZSIsImRlZmF1bHQiLCJsaW1pdCIsIm1heCIsImV2ZW50SWQiLCJzdHJpbmciLCJ1dWlkIiwib3B0aW9uYWwiLCJhY3Rpdml0eUlkIiwic3RhdHVzIiwiZW51bSIsImd1ZXN0SWQiLCJzZWFyY2hRdWVyeSIsImdldFN0YXR1c0NvZGUiLCJlcnJvckNvZGUiLCJzdGF0dXNNYXAiLCJyZXF1ZXN0Iiwid2l0aEF1dGgiLCJ1c2VySWQiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJxdWVyeVZhbGlkYXRpb24iLCJzYWZlUGFyc2UiLCJnZXQiLCJzdWNjZXNzIiwiZXJyb3JSZXNwb25zZSIsImZpZWxkcyIsImVycm9yIiwiaXNzdWVzIiwiZmlsdGVycyIsImRhdGEiLCJyZXN1bHQiLCJyc3ZwTWFuYWdlbWVudFNlcnZpY2UiLCJsaXN0UlNWUHMiLCJjb2RlIiwibWVzc2FnZSIsImRldGFpbHMiLCJzdWNjZXNzUmVzcG9uc2UiLCJjb25zb2xlIiwiRXJyb3IiLCJzdGFjayIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6Ijs7OzsrQkF5RHNCQTs7O2VBQUFBOzs7cUJBeERKOzRCQUN1QzsrRUFDbEI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUV2Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Q0FvQkMsR0FFRCxvQ0FBb0M7QUFDcEMsTUFBTUMsb0JBQW9CQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztJQUNqQ0MsTUFBTUYsTUFBQyxDQUFDRyxNQUFNLENBQUNDLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxRQUFRLEdBQUdDLE9BQU8sQ0FBQztJQUNqREMsT0FBT1IsTUFBQyxDQUFDRyxNQUFNLENBQUNDLE1BQU0sR0FB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