411b604602ab30b591317fdbf85660af
"use strict";
// Mock Supabase
jest.mock('@supabase/supabase-js');
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _accessControlService = /*#__PURE__*/ _interop_require_wildcard(require("./accessControlService"));
const _supabasejs = require("@supabase/supabase-js");
const _types = require("../types");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
describe('accessControlService', ()=>{
    let mockSupabase;
    beforeEach(()=>{
        jest.clearAllMocks();
        mockSupabase = {
            from: jest.fn().mockReturnThis(),
            select: jest.fn().mockReturnThis(),
            eq: jest.fn().mockReturnThis(),
            single: jest.fn()
        };
        _supabasejs.createClient.mockReturnValue(mockSupabase);
        process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';
    });
    describe('hasRole', ()=>{
        it('should return true when user has the required role', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'super_admin'
                },
                error: null
            });
            const result = await _accessControlService.hasRole('user-123', 'super_admin');
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.hasRole).toBe(true);
                expect(result.data.userRole).toBe('super_admin');
            }
        });
        it('should return false when user does not have the required role', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'guest'
                },
                error: null
            });
            const result = await _accessControlService.hasRole('user-123', 'super_admin');
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.hasRole).toBe(false);
                expect(result.data.userRole).toBe('guest');
            }
        });
        it('should return NOT_FOUND when user does not exist', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: null,
                error: {
                    message: 'User not found'
                }
            });
            const result = await _accessControlService.hasRole('user-123', 'super_admin');
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe(_types.ERROR_CODES.NOT_FOUND);
            }
        });
    });
    describe('hasAnyRole', ()=>{
        it('should return true when user has one of the allowed roles', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'host'
                },
                error: null
            });
            const result = await _accessControlService.hasAnyRole('user-123', [
                'super_admin',
                'host'
            ]);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.hasRole).toBe(true);
                expect(result.data.userRole).toBe('host');
            }
        });
        it('should return false when user does not have any allowed role', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'guest'
                },
                error: null
            });
            const result = await _accessControlService.hasAnyRole('user-123', [
                'super_admin',
                'host'
            ]);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.hasRole).toBe(false);
                expect(result.data.userRole).toBe('guest');
            }
        });
    });
    describe('canAccessGroup', ()=>{
        it('should return true for super_admin accessing any group', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'super_admin'
                },
                error: null
            });
            const result = await _accessControlService.canAccessGroup({
                userId: 'user-123',
                groupId: 'group-456'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.canAccess).toBe(true);
                expect(result.data.role).toBe('super_admin');
            }
        });
        it('should return true for group owner accessing their group', async ()=>{
            mockSupabase.single.mockResolvedValueOnce({
                data: {
                    role: 'host'
                },
                error: null
            }).mockResolvedValueOnce({
                data: {
                    role: 'owner'
                },
                error: null
            });
            const result = await _accessControlService.canAccessGroup({
                userId: 'user-123',
                groupId: 'group-456'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.canAccess).toBe(true);
            }
        });
        it('should return false for user not in group', async ()=>{
            mockSupabase.single.mockResolvedValueOnce({
                data: {
                    role: 'host'
                },
                error: null
            }).mockResolvedValueOnce({
                data: null,
                error: {
                    message: 'Not found'
                }
            });
            const result = await _accessControlService.canAccessGroup({
                userId: 'user-123',
                groupId: 'group-456'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.canAccess).toBe(false);
            }
        });
        it('should return false for group viewer (not owner)', async ()=>{
            mockSupabase.single.mockResolvedValueOnce({
                data: {
                    role: 'host'
                },
                error: null
            }).mockResolvedValueOnce({
                data: {
                    role: 'viewer'
                },
                error: null
            });
            const result = await _accessControlService.canAccessGroup({
                userId: 'user-123',
                groupId: 'group-456'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.canAccess).toBe(false);
            }
        });
    });
    describe('canPerformAction', ()=>{
        it('should allow super_admin to perform any action', async ()=>{
            const result = await _accessControlService.canPerformAction({
                userId: 'user-123',
                role: 'super_admin',
                resource: 'guests',
                action: 'delete'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.allowed).toBe(true);
            }
        });
        it('should allow host to manage wedding resources', async ()=>{
            const result = await _accessControlService.canPerformAction({
                userId: 'user-123',
                role: 'host',
                resource: 'guests',
                action: 'create'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.allowed).toBe(true);
            }
        });
        it('should not allow host to access non-wedding resources', async ()=>{
            const result = await _accessControlService.canPerformAction({
                userId: 'user-123',
                role: 'host',
                resource: 'system_settings',
                action: 'update'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.allowed).toBe(false);
            }
        });
        it('should allow guest to read public resources', async ()=>{
            const result = await _accessControlService.canPerformAction({
                userId: 'user-123',
                role: 'guest',
                resource: 'events',
                action: 'read'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.allowed).toBe(true);
            }
        });
        it('should allow guest to create RSVPs', async ()=>{
            const result = await _accessControlService.canPerformAction({
                userId: 'user-123',
                role: 'guest',
                resource: 'rsvps',
                action: 'create'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.allowed).toBe(true);
            }
        });
        it('should not allow guest to delete resources', async ()=>{
            const result = await _accessControlService.canPerformAction({
                userId: 'user-123',
                role: 'guest',
                resource: 'events',
                action: 'delete'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.allowed).toBe(false);
            }
        });
    });
    describe('requireRole', ()=>{
        it('should return success when user has required role', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'super_admin'
                },
                error: null
            });
            const result = await _accessControlService.requireRole('user-123', 'super_admin');
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.userRole).toBe('super_admin');
            }
        });
        it('should return INSUFFICIENT_PERMISSIONS when user lacks role', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'guest'
                },
                error: null
            });
            const result = await _accessControlService.requireRole('user-123', 'super_admin');
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe(_types.ERROR_CODES.INSUFFICIENT_PERMISSIONS);
            }
        });
    });
    describe('requireAnyRole', ()=>{
        it('should return success when user has one of the required roles', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'host'
                },
                error: null
            });
            const result = await _accessControlService.requireAnyRole('user-123', [
                'super_admin',
                'host'
            ]);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.userRole).toBe('host');
            }
        });
        it('should return INSUFFICIENT_PERMISSIONS when user lacks all roles', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'guest'
                },
                error: null
            });
            const result = await _accessControlService.requireAnyRole('user-123', [
                'super_admin',
                'host'
            ]);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe(_types.ERROR_CODES.INSUFFICIENT_PERMISSIONS);
            }
        });
    });
    describe('requireGroupAccess', ()=>{
        it('should return success when user can access group', async ()=>{
            mockSupabase.single.mockResolvedValue({
                data: {
                    role: 'super_admin'
                },
                error: null
            });
            const result = await _accessControlService.requireGroupAccess({
                userId: 'user-123',
                groupId: 'group-456'
            });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.role).toBe('super_admin');
            }
        });
        it('should return INSUFFICIENT_PERMISSIONS when user cannot access group', async ()=>{
            mockSupabase.single.mockResolvedValueOnce({
                data: {
                    role: 'host'
                },
                error: null
            }).mockResolvedValueOnce({
                data: null,
                error: {
                    message: 'Not found'
                }
            });
            const result = await _accessControlService.requireGroupAccess({
                userId: 'user-123',
                groupId: 'group-456'
            });
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe(_types.ERROR_CODES.INSUFFICIENT_PERMISSIONS);
            }
        });
    });
    describe('getUserGroups', ()=>{
        it('should return all groups for super_admin', async ()=>{
            // First call: get user role
            const mockUserQuery = {
                select: jest.fn().mockReturnThis(),
                eq: jest.fn().mockReturnThis(),
                single: jest.fn().mockResolvedValue({
                    data: {
                        role: 'super_admin'
                    },
                    error: null
                })
            };
            // Second call: get all groups
            const mockGroupsQuery = {
                select: jest.fn().mockResolvedValue({
                    data: [
                        {
                            id: 'group-1'
                        },
                        {
                            id: 'group-2'
                        },
                        {
                            id: 'group-3'
                        }
                    ],
                    error: null
                })
            };
            mockSupabase.from.mockReturnValueOnce(mockUserQuery).mockReturnValueOnce(mockGroupsQuery);
            const result = await _accessControlService.getUserGroups('user-123');
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.groupIds).toHaveLength(3);
                expect(result.data.role).toBe('super_admin');
            }
        });
        it('should return only owned groups for non-admin users', async ()=>{
            // First call: get user role
            const mockUserQuery = {
                select: jest.fn().mockReturnThis(),
                eq: jest.fn().mockReturnThis(),
                single: jest.fn().mockResolvedValue({
                    data: {
                        role: 'host'
                    },
                    error: null
                })
            };
            // Second call: get group_members with two eq() calls
            const mockMembersQuery = {
                select: jest.fn().mockReturnThis(),
                eq: jest.fn().mockReturnThis()
            };
            // The second eq() call returns the final result
            mockMembersQuery.eq.mockReturnValueOnce(mockMembersQuery).mockReturnValueOnce({
                data: [
                    {
                        group_id: 'group-1'
                    },
                    {
                        group_id: 'group-2'
                    }
                ],
                error: null
            });
            mockSupabase.from.mockReturnValueOnce(mockUserQuery).mockReturnValueOnce(mockMembersQuery);
            const result = await _accessControlService.getUserGroups('user-123');
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.groupIds).toHaveLength(2);
                expect(result.data.groupIds).toContain('group-1');
                expect(result.data.groupIds).toContain('group-2');
            }
        });
        it('should return empty array when user has no groups', async ()=>{
            // First call: get user role
            const mockUserQuery = {
                select: jest.fn().mockReturnThis(),
                eq: jest.fn().mockReturnThis(),
                single: jest.fn().mockResolvedValue({
                    data: {
                        role: 'host'
                    },
                    error: null
                })
            };
            // Second call: get group_members with two eq() calls
            const mockMembersQuery = {
                select: jest.fn().mockReturnThis(),
                eq: jest.fn().mockReturnThis()
            };
            // The second eq() call returns the final result
            mockMembersQuery.eq.mockReturnValueOnce(mockMembersQuery).mockReturnValueOnce({
                data: [],
                error: null
            });
            mockSupabase.from.mockReturnValueOnce(mockUserQuery).mockReturnValueOnce(mockMembersQuery);
            const result = await _accessControlService.getUserGroups('user-123');
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.groupIds).toHaveLength(0);
            }
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvYWNjZXNzQ29udHJvbFNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBhY2Nlc3NDb250cm9sU2VydmljZSBmcm9tICcuL2FjY2Vzc0NvbnRyb2xTZXJ2aWNlJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyBFUlJPUl9DT0RFUyB9IGZyb20gJ0AvdHlwZXMnO1xuXG4vLyBNb2NrIFN1cGFiYXNlXG5qZXN0Lm1vY2soJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcycpO1xuXG5kZXNjcmliZSgnYWNjZXNzQ29udHJvbFNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBtb2NrU3VwYWJhc2U6IGFueTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcblxuICAgIG1vY2tTdXBhYmFzZSA9IHtcbiAgICAgIGZyb206IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIHNpbmdsZTogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICAoY3JlYXRlQ2xpZW50IGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKG1vY2tTdXBhYmFzZSk7XG5cbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgPSAnaHR0cHM6Ly90ZXN0LnN1cGFiYXNlLmNvJztcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSA9ICd0ZXN0LWFub24ta2V5JztcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hhc1JvbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIHVzZXIgaGFzIHRoZSByZXF1aXJlZCByb2xlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N1cGFiYXNlLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcm9sZTogJ3N1cGVyX2FkbWluJyB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UuaGFzUm9sZSgndXNlci0xMjMnLCAnc3VwZXJfYWRtaW4nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5oYXNSb2xlKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEudXNlclJvbGUpLnRvQmUoJ3N1cGVyX2FkbWluJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIHVzZXIgZG9lcyBub3QgaGF2ZSB0aGUgcmVxdWlyZWQgcm9sZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdXBhYmFzZS5zaW5nbGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7IHJvbGU6ICdndWVzdCcgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjY2Vzc0NvbnRyb2xTZXJ2aWNlLmhhc1JvbGUoJ3VzZXItMTIzJywgJ3N1cGVyX2FkbWluJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuaGFzUm9sZSkudG9CZShmYWxzZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS51c2VyUm9sZSkudG9CZSgnZ3Vlc3QnKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIE5PVF9GT1VORCB3aGVuIHVzZXIgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3VwYWJhc2Uuc2luZ2xlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyB9LFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5oYXNSb2xlKCd1c2VyLTEyMycsICdzdXBlcl9hZG1pbicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLmNvZGUpLnRvQmUoRVJST1JfQ09ERVMuTk9UX0ZPVU5EKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hhc0FueVJvbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIHVzZXIgaGFzIG9uZSBvZiB0aGUgYWxsb3dlZCByb2xlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdXBhYmFzZS5zaW5nbGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7IHJvbGU6ICdob3N0JyB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UuaGFzQW55Um9sZSgndXNlci0xMjMnLCBbJ3N1cGVyX2FkbWluJywgJ2hvc3QnXSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuaGFzUm9sZSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLnVzZXJSb2xlKS50b0JlKCdob3N0Jyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIHVzZXIgZG9lcyBub3QgaGF2ZSBhbnkgYWxsb3dlZCByb2xlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N1cGFiYXNlLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcm9sZTogJ2d1ZXN0JyB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UuaGFzQW55Um9sZSgndXNlci0xMjMnLCBbJ3N1cGVyX2FkbWluJywgJ2hvc3QnXSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuaGFzUm9sZSkudG9CZShmYWxzZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS51c2VyUm9sZSkudG9CZSgnZ3Vlc3QnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbkFjY2Vzc0dyb3VwJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgZm9yIHN1cGVyX2FkbWluIGFjY2Vzc2luZyBhbnkgZ3JvdXAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3VwYWJhc2Uuc2luZ2xlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyByb2xlOiAnc3VwZXJfYWRtaW4nIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5jYW5BY2Nlc3NHcm91cCh7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgZ3JvdXBJZDogJ2dyb3VwLTQ1NicsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5jYW5BY2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5yb2xlKS50b0JlKCdzdXBlcl9hZG1pbicpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSBmb3IgZ3JvdXAgb3duZXIgYWNjZXNzaW5nIHRoZWlyIGdyb3VwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N1cGFiYXNlLnNpbmdsZVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICBkYXRhOiB7IHJvbGU6ICdob3N0JyB9LFxuICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICB9KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICBkYXRhOiB7IHJvbGU6ICdvd25lcicgfSxcbiAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjY2Vzc0NvbnRyb2xTZXJ2aWNlLmNhbkFjY2Vzc0dyb3VwKHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICBncm91cElkOiAnZ3JvdXAtNDU2JyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmNhbkFjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGZvciB1c2VyIG5vdCBpbiBncm91cCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdXBhYmFzZS5zaW5nbGVcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgZGF0YTogeyByb2xlOiAnaG9zdCcgfSxcbiAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgfSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnTm90IGZvdW5kJyB9LFxuICAgICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UuY2FuQWNjZXNzR3JvdXAoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIGdyb3VwSWQ6ICdncm91cC00NTYnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuY2FuQWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGZvciBncm91cCB2aWV3ZXIgKG5vdCBvd25lciknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3VwYWJhc2Uuc2luZ2xlXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICAgIGRhdGE6IHsgcm9sZTogJ2hvc3QnIH0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICAgIGRhdGE6IHsgcm9sZTogJ3ZpZXdlcicgfSxcbiAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjY2Vzc0NvbnRyb2xTZXJ2aWNlLmNhbkFjY2Vzc0dyb3VwKHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICBncm91cElkOiAnZ3JvdXAtNDU2JyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmNhbkFjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYW5QZXJmb3JtQWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWxsb3cgc3VwZXJfYWRtaW4gdG8gcGVyZm9ybSBhbnkgYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UuY2FuUGVyZm9ybUFjdGlvbih7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgcm9sZTogJ3N1cGVyX2FkbWluJyxcbiAgICAgICAgcmVzb3VyY2U6ICdndWVzdHMnLFxuICAgICAgICBhY3Rpb246ICdkZWxldGUnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuYWxsb3dlZCkudG9CZSh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgaG9zdCB0byBtYW5hZ2Ugd2VkZGluZyByZXNvdXJjZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5jYW5QZXJmb3JtQWN0aW9uKHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICByb2xlOiAnaG9zdCcsXG4gICAgICAgIHJlc291cmNlOiAnZ3Vlc3RzJyxcbiAgICAgICAgYWN0aW9uOiAnY3JlYXRlJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmFsbG93ZWQpLnRvQmUodHJ1ZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyBob3N0IHRvIGFjY2VzcyBub24td2VkZGluZyByZXNvdXJjZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5jYW5QZXJmb3JtQWN0aW9uKHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICByb2xlOiAnaG9zdCcsXG4gICAgICAgIHJlc291cmNlOiAnc3lzdGVtX3NldHRpbmdzJyxcbiAgICAgICAgYWN0aW9uOiAndXBkYXRlJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBndWVzdCB0byByZWFkIHB1YmxpYyByZXNvdXJjZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5jYW5QZXJmb3JtQWN0aW9uKHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICByb2xlOiAnZ3Vlc3QnLFxuICAgICAgICByZXNvdXJjZTogJ2V2ZW50cycsXG4gICAgICAgIGFjdGlvbjogJ3JlYWQnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuYWxsb3dlZCkudG9CZSh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgZ3Vlc3QgdG8gY3JlYXRlIFJTVlBzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UuY2FuUGVyZm9ybUFjdGlvbih7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgcm9sZTogJ2d1ZXN0JyxcbiAgICAgICAgcmVzb3VyY2U6ICdyc3ZwcycsXG4gICAgICAgIGFjdGlvbjogJ2NyZWF0ZScsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5hbGxvd2VkKS50b0JlKHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgYWxsb3cgZ3Vlc3QgdG8gZGVsZXRlIHJlc291cmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjY2Vzc0NvbnRyb2xTZXJ2aWNlLmNhblBlcmZvcm1BY3Rpb24oe1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIHJvbGU6ICdndWVzdCcsXG4gICAgICAgIHJlc291cmNlOiAnZXZlbnRzJyxcbiAgICAgICAgYWN0aW9uOiAnZGVsZXRlJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVxdWlyZVJvbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc3VjY2VzcyB3aGVuIHVzZXIgaGFzIHJlcXVpcmVkIHJvbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3VwYWJhc2Uuc2luZ2xlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyByb2xlOiAnc3VwZXJfYWRtaW4nIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5yZXF1aXJlUm9sZSgndXNlci0xMjMnLCAnc3VwZXJfYWRtaW4nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS51c2VyUm9sZSkudG9CZSgnc3VwZXJfYWRtaW4nKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIElOU1VGRklDSUVOVF9QRVJNSVNTSU9OUyB3aGVuIHVzZXIgbGFja3Mgcm9sZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdXBhYmFzZS5zaW5nbGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7IHJvbGU6ICdndWVzdCcgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjY2Vzc0NvbnRyb2xTZXJ2aWNlLnJlcXVpcmVSb2xlKCd1c2VyLTEyMycsICdzdXBlcl9hZG1pbicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLmNvZGUpLnRvQmUoRVJST1JfQ09ERVMuSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlcXVpcmVBbnlSb2xlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHN1Y2Nlc3Mgd2hlbiB1c2VyIGhhcyBvbmUgb2YgdGhlIHJlcXVpcmVkIHJvbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N1cGFiYXNlLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcm9sZTogJ2hvc3QnIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5yZXF1aXJlQW55Um9sZSgndXNlci0xMjMnLCBbJ3N1cGVyX2FkbWluJywgJ2hvc3QnXSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEudXNlclJvbGUpLnRvQmUoJ2hvc3QnKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIElOU1VGRklDSUVOVF9QRVJNSVNTSU9OUyB3aGVuIHVzZXIgbGFja3MgYWxsIHJvbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N1cGFiYXNlLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcm9sZTogJ2d1ZXN0JyB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UucmVxdWlyZUFueVJvbGUoJ3VzZXItMTIzJywgWydzdXBlcl9hZG1pbicsICdob3N0J10pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLmNvZGUpLnRvQmUoRVJST1JfQ09ERVMuSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlcXVpcmVHcm91cEFjY2VzcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBzdWNjZXNzIHdoZW4gdXNlciBjYW4gYWNjZXNzIGdyb3VwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N1cGFiYXNlLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcm9sZTogJ3N1cGVyX2FkbWluJyB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UucmVxdWlyZUdyb3VwQWNjZXNzKHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICBncm91cElkOiAnZ3JvdXAtNDU2JyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLnJvbGUpLnRvQmUoJ3N1cGVyX2FkbWluJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMgd2hlbiB1c2VyIGNhbm5vdCBhY2Nlc3MgZ3JvdXAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3VwYWJhc2Uuc2luZ2xlXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICAgIGRhdGE6IHsgcm9sZTogJ2hvc3QnIH0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ05vdCBmb3VuZCcgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjY2Vzc0NvbnRyb2xTZXJ2aWNlLnJlcXVpcmVHcm91cEFjY2Vzcyh7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgZ3JvdXBJZDogJ2dyb3VwLTQ1NicsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvci5jb2RlKS50b0JlKEVSUk9SX0NPREVTLklOU1VGRklDSUVOVF9QRVJNSVNTSU9OUyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRVc2VyR3JvdXBzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGFsbCBncm91cHMgZm9yIHN1cGVyX2FkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QgY2FsbDogZ2V0IHVzZXIgcm9sZVxuICAgICAgY29uc3QgbW9ja1VzZXJRdWVyeSA9IHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgZGF0YTogeyByb2xlOiAnc3VwZXJfYWRtaW4nIH0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgLy8gU2Vjb25kIGNhbGw6IGdldCBhbGwgZ3JvdXBzXG4gICAgICBjb25zdCBtb2NrR3JvdXBzUXVlcnkgPSB7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBkYXRhOiBbeyBpZDogJ2dyb3VwLTEnIH0sIHsgaWQ6ICdncm91cC0yJyB9LCB7IGlkOiAnZ3JvdXAtMycgfV0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgbW9ja1N1cGFiYXNlLmZyb21cbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UobW9ja1VzZXJRdWVyeSlcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UobW9ja0dyb3Vwc1F1ZXJ5KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWNjZXNzQ29udHJvbFNlcnZpY2UuZ2V0VXNlckdyb3VwcygndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5ncm91cElkcykudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEucm9sZSkudG9CZSgnc3VwZXJfYWRtaW4nKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG9ubHkgb3duZWQgZ3JvdXBzIGZvciBub24tYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBGaXJzdCBjYWxsOiBnZXQgdXNlciByb2xlXG4gICAgICBjb25zdCBtb2NrVXNlclF1ZXJ5ID0ge1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBkYXRhOiB7IHJvbGU6ICdob3N0JyB9LFxuICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICB9KSxcbiAgICAgIH07XG5cbiAgICAgIC8vIFNlY29uZCBjYWxsOiBnZXQgZ3JvdXBfbWVtYmVycyB3aXRoIHR3byBlcSgpIGNhbGxzXG4gICAgICBjb25zdCBtb2NrTWVtYmVyc1F1ZXJ5ID0ge1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBUaGUgc2Vjb25kIGVxKCkgY2FsbCByZXR1cm5zIHRoZSBmaW5hbCByZXN1bHRcbiAgICAgIG1vY2tNZW1iZXJzUXVlcnkuZXEubW9ja1JldHVyblZhbHVlT25jZShtb2NrTWVtYmVyc1F1ZXJ5KS5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcbiAgICAgICAgZGF0YTogW3sgZ3JvdXBfaWQ6ICdncm91cC0xJyB9LCB7IGdyb3VwX2lkOiAnZ3JvdXAtMicgfV0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tTdXBhYmFzZS5mcm9tXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKG1vY2tVc2VyUXVlcnkpXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKG1vY2tNZW1iZXJzUXVlcnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2Nlc3NDb250cm9sU2VydmljZS5nZXRVc2VyR3JvdXBzKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmdyb3VwSWRzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5ncm91cElkcykudG9Db250YWluKCdncm91cC0xJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5ncm91cElkcykudG9Db250YWluKCdncm91cC0yJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSB3aGVuIHVzZXIgaGFzIG5vIGdyb3VwcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEZpcnN0IGNhbGw6IGdldCB1c2VyIHJvbGVcbiAgICAgIGNvbnN0IG1vY2tVc2VyUXVlcnkgPSB7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGRhdGE6IHsgcm9sZTogJ2hvc3QnIH0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgLy8gU2Vjb25kIGNhbGw6IGdldCBncm91cF9tZW1iZXJzIHdpdGggdHdvIGVxKCkgY2FsbHNcbiAgICAgIGNvbnN0IG1vY2tNZW1iZXJzUXVlcnkgPSB7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIFRoZSBzZWNvbmQgZXEoKSBjYWxsIHJldHVybnMgdGhlIGZpbmFsIHJlc3VsdFxuICAgICAgbW9ja01lbWJlcnNRdWVyeS5lcS5tb2NrUmV0dXJuVmFsdWVPbmNlKG1vY2tNZW1iZXJzUXVlcnkpLm1vY2tSZXR1cm5WYWx1ZU9uY2Uoe1xuICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgbW9ja1N1cGFiYXNlLmZyb21cbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UobW9ja1VzZXJRdWVyeSlcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UobW9ja01lbWJlcnNRdWVyeSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjY2Vzc0NvbnRyb2xTZXJ2aWNlLmdldFVzZXJHcm91cHMoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuZ3JvdXBJZHMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImRlc2NyaWJlIiwibW9ja1N1cGFiYXNlIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJmcm9tIiwiZm4iLCJtb2NrUmV0dXJuVGhpcyIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiY3JlYXRlQ2xpZW50IiwibW9ja1JldHVyblZhbHVlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiaXQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsImRhdGEiLCJyb2xlIiwiZXJyb3IiLCJyZXN1bHQiLCJhY2Nlc3NDb250cm9sU2VydmljZSIsImhhc1JvbGUiLCJleHBlY3QiLCJzdWNjZXNzIiwidG9CZSIsInVzZXJSb2xlIiwibWVzc2FnZSIsImNvZGUiLCJFUlJPUl9DT0RFUyIsIk5PVF9GT1VORCIsImhhc0FueVJvbGUiLCJjYW5BY2Nlc3NHcm91cCIsInVzZXJJZCIsImdyb3VwSWQiLCJjYW5BY2Nlc3MiLCJtb2NrUmVzb2x2ZWRWYWx1ZU9uY2UiLCJjYW5QZXJmb3JtQWN0aW9uIiwicmVzb3VyY2UiLCJhY3Rpb24iLCJhbGxvd2VkIiwicmVxdWlyZVJvbGUiLCJJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMiLCJyZXF1aXJlQW55Um9sZSIsInJlcXVpcmVHcm91cEFjY2VzcyIsIm1vY2tVc2VyUXVlcnkiLCJtb2NrR3JvdXBzUXVlcnkiLCJpZCIsIm1vY2tSZXR1cm5WYWx1ZU9uY2UiLCJnZXRVc2VyR3JvdXBzIiwiZ3JvdXBJZHMiLCJ0b0hhdmVMZW5ndGgiLCJtb2NrTWVtYmVyc1F1ZXJ5IiwiZ3JvdXBfaWQiLCJ0b0NvbnRhaW4iXSwibWFwcGluZ3MiOiI7QUFJQSxnQkFBZ0I7QUFDaEJBLEtBQUtDLElBQUksQ0FBQzs7Ozs4RUFMNEI7NEJBQ1Q7dUJBQ0Q7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUs1QkMsU0FBUyx3QkFBd0I7SUFDL0IsSUFBSUM7SUFFSkMsV0FBVztRQUNUSixLQUFLSyxhQUFhO1FBRWxCRixlQUFlO1lBQ2JHLE1BQU1OLEtBQUtPLEVBQUUsR0FBR0MsY0FBYztZQUM5QkMsUUFBUVQsS0FBS08sRUFBRSxHQUFHQyxjQUFjO1lBQ2hDRSxJQUFJVixLQUFLTyxFQUFFLEdBQUdDLGNBQWM7WUFDNUJHLFFBQVFYLEtBQUtPLEVBQUU7UUFDakI7UUFFQ0ssd0JBQVksQ0FBZUMsZUFBZSxDQUFDVjtRQUU1Q1csUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0IsR0FBRztRQUN2Q0YsUUFBUUMsR0FBRyxDQUFDRSw2QkFBNkIsR0FBRztJQUM5QztJQUVBZixTQUFTLFdBQVc7UUFDbEJnQixHQUFHLHNEQUFzRDtZQUN2RGYsYUFBYVEsTUFBTSxDQUFDUSxpQkFBaUIsQ0FBQztnQkFDcENDLE1BQU07b0JBQUVDLE1BQU07Z0JBQWM7Z0JBQzVCQyxPQUFPO1lBQ1Q7WUFFQSxNQUFNQyxTQUFTLE1BQU1DLHNCQUFxQkMsT0FBTyxDQUFDLFlBQVk7WUFFOURDLE9BQU9ILE9BQU9JLE9BQU8sRUFBRUMsSUFBSSxDQUFDO1lBQzVCLElBQUlMLE9BQU9JLE9B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