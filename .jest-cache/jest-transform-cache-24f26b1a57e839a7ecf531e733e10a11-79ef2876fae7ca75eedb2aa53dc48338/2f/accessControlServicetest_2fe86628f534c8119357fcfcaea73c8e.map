{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/accessControlService.test.ts"],"sourcesContent":["import * as accessControlService from './accessControlService';\nimport { createClient } from '@supabase/supabase-js';\nimport { ERROR_CODES } from '@/types';\n\n// Mock Supabase\njest.mock('@supabase/supabase-js');\n\ndescribe('accessControlService', () => {\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n\n    mockSupabase = {\n      from: jest.fn().mockReturnThis(),\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn(),\n    };\n\n    (createClient as jest.Mock).mockReturnValue(mockSupabase);\n\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';\n  });\n\n  describe('hasRole', () => {\n    it('should return true when user has the required role', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'super_admin' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.hasRole('user-123', 'super_admin');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasRole).toBe(true);\n        expect(result.data.userRole).toBe('super_admin');\n      }\n    });\n\n    it('should return false when user does not have the required role', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.hasRole('user-123', 'super_admin');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasRole).toBe(false);\n        expect(result.data.userRole).toBe('guest');\n      }\n    });\n\n    it('should return NOT_FOUND when user does not exist', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: null,\n        error: { message: 'User not found' },\n      } as any);\n\n      const result = await accessControlService.hasRole('user-123', 'super_admin');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.NOT_FOUND);\n      }\n    });\n  });\n\n  describe('hasAnyRole', () => {\n    it('should return true when user has one of the allowed roles', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'host' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.hasAnyRole('user-123', ['super_admin', 'host']);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasRole).toBe(true);\n        expect(result.data.userRole).toBe('host');\n      }\n    });\n\n    it('should return false when user does not have any allowed role', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.hasAnyRole('user-123', ['super_admin', 'host']);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasRole).toBe(false);\n        expect(result.data.userRole).toBe('guest');\n      }\n    });\n  });\n\n  describe('canAccessGroup', () => {\n    it('should return true for super_admin accessing any group', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'super_admin' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.canAccessGroup({\n        userId: 'user-123',\n        groupId: 'group-456',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.canAccess).toBe(true);\n        expect(result.data.role).toBe('super_admin');\n      }\n    });\n\n    it('should return true for group owner accessing their group', async () => {\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: { role: 'host' },\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: { role: 'owner' },\n          error: null,\n        });\n\n      const result = await accessControlService.canAccessGroup({\n        userId: 'user-123',\n        groupId: 'group-456',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.canAccess).toBe(true);\n      }\n    });\n\n    it('should return false for user not in group', async () => {\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: { role: 'host' },\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: null,\n          error: { message: 'Not found' },\n        });\n\n      const result = await accessControlService.canAccessGroup({\n        userId: 'user-123',\n        groupId: 'group-456',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.canAccess).toBe(false);\n      }\n    });\n\n    it('should return false for group viewer (not owner)', async () => {\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: { role: 'host' },\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: { role: 'viewer' },\n          error: null,\n        });\n\n      const result = await accessControlService.canAccessGroup({\n        userId: 'user-123',\n        groupId: 'group-456',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.canAccess).toBe(false);\n      }\n    });\n  });\n\n  describe('canPerformAction', () => {\n    it('should allow super_admin to perform any action', async () => {\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-123',\n        role: 'super_admin',\n        resource: 'guests',\n        action: 'delete',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(true);\n      }\n    });\n\n    it('should allow host to manage wedding resources', async () => {\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-123',\n        role: 'host',\n        resource: 'guests',\n        action: 'create',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(true);\n      }\n    });\n\n    it('should not allow host to access non-wedding resources', async () => {\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-123',\n        role: 'host',\n        resource: 'system_settings',\n        action: 'update',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(false);\n      }\n    });\n\n    it('should allow guest to read public resources', async () => {\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-123',\n        role: 'guest',\n        resource: 'events',\n        action: 'read',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(true);\n      }\n    });\n\n    it('should allow guest to create RSVPs', async () => {\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-123',\n        role: 'guest',\n        resource: 'rsvps',\n        action: 'create',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(true);\n      }\n    });\n\n    it('should not allow guest to delete resources', async () => {\n      const result = await accessControlService.canPerformAction({\n        userId: 'user-123',\n        role: 'guest',\n        resource: 'events',\n        action: 'delete',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.allowed).toBe(false);\n      }\n    });\n  });\n\n  describe('requireRole', () => {\n    it('should return success when user has required role', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'super_admin' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.requireRole('user-123', 'super_admin');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.userRole).toBe('super_admin');\n      }\n    });\n\n    it('should return INSUFFICIENT_PERMISSIONS when user lacks role', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.requireRole('user-123', 'super_admin');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.INSUFFICIENT_PERMISSIONS);\n      }\n    });\n  });\n\n  describe('requireAnyRole', () => {\n    it('should return success when user has one of the required roles', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'host' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.requireAnyRole('user-123', ['super_admin', 'host']);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.userRole).toBe('host');\n      }\n    });\n\n    it('should return INSUFFICIENT_PERMISSIONS when user lacks all roles', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.requireAnyRole('user-123', ['super_admin', 'host']);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.INSUFFICIENT_PERMISSIONS);\n      }\n    });\n  });\n\n  describe('requireGroupAccess', () => {\n    it('should return success when user can access group', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'super_admin' },\n        error: null,\n      } as any);\n\n      const result = await accessControlService.requireGroupAccess({\n        userId: 'user-123',\n        groupId: 'group-456',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.role).toBe('super_admin');\n      }\n    });\n\n    it('should return INSUFFICIENT_PERMISSIONS when user cannot access group', async () => {\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: { role: 'host' },\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: null,\n          error: { message: 'Not found' },\n        });\n\n      const result = await accessControlService.requireGroupAccess({\n        userId: 'user-123',\n        groupId: 'group-456',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.INSUFFICIENT_PERMISSIONS);\n      }\n    });\n  });\n\n  describe('getUserGroups', () => {\n    it('should return all groups for super_admin', async () => {\n      // First call: get user role\n      const mockUserQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        single: jest.fn().mockResolvedValue({\n          data: { role: 'super_admin' },\n          error: null,\n        }),\n      };\n\n      // Second call: get all groups\n      const mockGroupsQuery = {\n        select: jest.fn().mockResolvedValue({\n          data: [{ id: 'group-1' }, { id: 'group-2' }, { id: 'group-3' }],\n          error: null,\n        }),\n      };\n\n      mockSupabase.from\n        .mockReturnValueOnce(mockUserQuery)\n        .mockReturnValueOnce(mockGroupsQuery);\n\n      const result = await accessControlService.getUserGroups('user-123');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.groupIds).toHaveLength(3);\n        expect(result.data.role).toBe('super_admin');\n      }\n    });\n\n    it('should return only owned groups for non-admin users', async () => {\n      // First call: get user role\n      const mockUserQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        single: jest.fn().mockResolvedValue({\n          data: { role: 'host' },\n          error: null,\n        }),\n      };\n\n      // Second call: get group_members with two eq() calls\n      const mockMembersQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n      };\n      \n      // The second eq() call returns the final result\n      mockMembersQuery.eq.mockReturnValueOnce(mockMembersQuery).mockReturnValueOnce({\n        data: [{ group_id: 'group-1' }, { group_id: 'group-2' }],\n        error: null,\n      });\n\n      mockSupabase.from\n        .mockReturnValueOnce(mockUserQuery)\n        .mockReturnValueOnce(mockMembersQuery);\n\n      const result = await accessControlService.getUserGroups('user-123');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.groupIds).toHaveLength(2);\n        expect(result.data.groupIds).toContain('group-1');\n        expect(result.data.groupIds).toContain('group-2');\n      }\n    });\n\n    it('should return empty array when user has no groups', async () => {\n      // First call: get user role\n      const mockUserQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        single: jest.fn().mockResolvedValue({\n          data: { role: 'host' },\n          error: null,\n        }),\n      };\n\n      // Second call: get group_members with two eq() calls\n      const mockMembersQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n      };\n      \n      // The second eq() call returns the final result\n      mockMembersQuery.eq.mockReturnValueOnce(mockMembersQuery).mockReturnValueOnce({\n        data: [],\n        error: null,\n      });\n\n      mockSupabase.from\n        .mockReturnValueOnce(mockUserQuery)\n        .mockReturnValueOnce(mockMembersQuery);\n\n      const result = await accessControlService.getUserGroups('user-123');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.groupIds).toHaveLength(0);\n      }\n    });\n  });\n});\n"],"names":["jest","mock","describe","mockSupabase","beforeEach","clearAllMocks","from","fn","mockReturnThis","select","eq","single","createClient","mockReturnValue","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","it","mockResolvedValue","data","role","error","result","accessControlService","hasRole","expect","success","toBe","userRole","message","code","ERROR_CODES","NOT_FOUND","hasAnyRole","canAccessGroup","userId","groupId","canAccess","mockResolvedValueOnce","canPerformAction","resource","action","allowed","requireRole","INSUFFICIENT_PERMISSIONS","requireAnyRole","requireGroupAccess","mockUserQuery","mockGroupsQuery","id","mockReturnValueOnce","getUserGroups","groupIds","toHaveLength","mockMembersQuery","group_id","toContain"],"mappings":"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"}