c67e42f35da5d695eccbe40b529460e9
/**
 * Guest View Navigation Tests for Accommodations
 * 
 * Tests the "View as Guest" functionality for accommodations.
 * Requirements: 32.4
 */ "use strict";
// Mock dependencies
jest.mock('@/components/ui/ToastContext');
jest.mock('next/navigation', ()=>({
        useRouter: jest.fn(),
        useSearchParams: ()=>({
                get: jest.fn(),
                getAll: jest.fn(),
                has: jest.fn(),
                keys: jest.fn(),
                values: jest.fn(),
                entries: jest.fn(),
                forEach: jest.fn(),
                toString: jest.fn()
            }),
        usePathname: ()=>'/admin/accommodations'
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = require("@testing-library/react");
const _page = /*#__PURE__*/ _interop_require_default(require("./page"));
const _ToastContext = require("../../../components/ui/ToastContext");
const _navigation = require("next/navigation");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
// Mock fetch
global.fetch = jest.fn();
// Mock window.location
delete window.location;
window.location = {
    href: ''
};
const mockUseToast = _ToastContext.useToast;
const mockUseRouter = _navigation.useRouter;
describe('AccommodationsPage - Guest View Navigation', ()=>{
    const mockAddToast = jest.fn();
    const mockPush = jest.fn();
    const mockAccommodations = [
        {
            id: 'accommodation-1',
            name: 'Tamarindo Diria Beach Resort',
            address: '123 Beach Road, Tamarindo',
            description: 'Beachfront resort',
            locationId: 'loc-1',
            checkInDate: '2025-06-14',
            checkOutDate: '2025-06-17',
            status: 'available'
        },
        {
            id: 'accommodation-2',
            name: 'Sunset Villa',
            address: '456 Hill Street, Tamarindo',
            description: 'Luxury villa',
            locationId: 'loc-2',
            checkInDate: '2025-06-14',
            checkOutDate: '2025-06-17',
            status: 'booked'
        }
    ];
    const mockLocations = [
        {
            id: 'loc-1',
            name: 'Tamarindo Beach'
        },
        {
            id: 'loc-2',
            name: 'Tamarindo Hills'
        }
    ];
    beforeEach(()=>{
        jest.clearAllMocks();
        mockUseToast.mockReturnValue({
            addToast: mockAddToast,
            toasts: [],
            removeToast: jest.fn()
        });
        mockUseRouter.mockReturnValue({
            push: mockPush,
            replace: jest.fn(),
            refresh: jest.fn(),
            back: jest.fn(),
            forward: jest.fn(),
            prefetch: jest.fn()
        });
        // Mock fetch responses
        global.fetch.mockImplementation((url)=>{
            if (url.includes('/api/admin/accommodations')) {
                return Promise.resolve({
                    ok: true,
                    json: ()=>Promise.resolve({
                            success: true,
                            data: {
                                accommodations: mockAccommodations
                            }
                        })
                });
            }
            if (url.includes('/api/admin/locations')) {
                return Promise.resolve({
                    ok: true,
                    json: ()=>Promise.resolve({
                            success: true,
                            data: mockLocations
                        })
                });
            }
            return Promise.reject(new Error('Unknown URL'));
        });
    });
    describe('View Button', ()=>{
        it('should render View button for each accommodation', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            expect(viewButtons.length).toBeGreaterThan(0);
        });
        it('should navigate to guest-facing accommodation page when View button is clicked', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toBe('/guest/accommodation/accommodation-1');
        });
        it('should generate correct URL for each accommodation ID', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);
            });
            // Test first accommodation
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toBe('/guest/accommodation/accommodation-1');
            // Reset location
            window.location.href = '';
            // Test second accommodation (accounting for possible duplicates)
            const secondButtonIndex = viewButtons.length > 2 ? 2 : 1;
            if (viewButtons.length > secondButtonIndex) {
                _react.fireEvent.click(viewButtons[secondButtonIndex]);
                expect(window.location.href).toBe('/guest/accommodation/accommodation-2');
            }
        });
        it('should not propagate click event to row', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            const clickEvent = new MouseEvent('click', {
                bubbles: true
            });
            const stopPropagationSpy = jest.spyOn(clickEvent, 'stopPropagation');
            viewButtons[0].dispatchEvent(clickEvent);
            expect(stopPropagationSpy).toHaveBeenCalled();
        });
    });
    describe('Link Generation', ()=>{
        it('should generate URL with /guest/accommodation/ prefix', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toMatch(/^\/guest\/accommodation\//);
        });
        it('should use accommodation ID in URL', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toContain('accommodation-1');
        });
        it('should use singular "accommodation" not plural in URL', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getByText('Tamarindo Diria Beach Resort')).toBeInTheDocument();
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toContain('/accommodation/');
            expect(window.location.href).not.toContain('/accommodations/');
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FkbWluL2FjY29tbW9kYXRpb25zL3BhZ2UuZ3Vlc3RWaWV3LnRlc3QudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogR3Vlc3QgVmlldyBOYXZpZ2F0aW9uIFRlc3RzIGZvciBBY2NvbW1vZGF0aW9uc1xuICogXG4gKiBUZXN0cyB0aGUgXCJWaWV3IGFzIEd1ZXN0XCIgZnVuY3Rpb25hbGl0eSBmb3IgYWNjb21tb2RhdGlvbnMuXG4gKiBSZXF1aXJlbWVudHM6IDMyLjRcbiAqL1xuXG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50LCB3YWl0Rm9yIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCc7XG5pbXBvcnQgQWNjb21tb2RhdGlvbnNQYWdlIGZyb20gJy4vcGFnZSc7XG5pbXBvcnQgeyB1c2VUb2FzdCB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9Ub2FzdENvbnRleHQnO1xuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAnbmV4dC9uYXZpZ2F0aW9uJztcblxuLy8gTW9jayBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnQC9jb21wb25lbnRzL3VpL1RvYXN0Q29udGV4dCcpO1xuamVzdC5tb2NrKCduZXh0L25hdmlnYXRpb24nLCAoKSA9PiAoe1xuICB1c2VSb3V0ZXI6IGplc3QuZm4oKSxcbiAgdXNlU2VhcmNoUGFyYW1zOiAoKSA9PiAoe1xuICAgIGdldDogamVzdC5mbigpLFxuICAgIGdldEFsbDogamVzdC5mbigpLFxuICAgIGhhczogamVzdC5mbigpLFxuICAgIGtleXM6IGplc3QuZm4oKSxcbiAgICB2YWx1ZXM6IGplc3QuZm4oKSxcbiAgICBlbnRyaWVzOiBqZXN0LmZuKCksXG4gICAgZm9yRWFjaDogamVzdC5mbigpLFxuICAgIHRvU3RyaW5nOiBqZXN0LmZuKCksXG4gIH0pLFxuICB1c2VQYXRobmFtZTogKCkgPT4gJy9hZG1pbi9hY2NvbW1vZGF0aW9ucycsXG59KSk7XG5cbi8vIE1vY2sgZmV0Y2hcbmdsb2JhbC5mZXRjaCA9IGplc3QuZm4oKTtcblxuLy8gTW9jayB3aW5kb3cubG9jYXRpb25cbmRlbGV0ZSAod2luZG93IGFzIGFueSkubG9jYXRpb247XG53aW5kb3cubG9jYXRpb24gPSB7IGhyZWY6ICcnIH0gYXMgYW55O1xuXG5jb25zdCBtb2NrVXNlVG9hc3QgPSB1c2VUb2FzdCBhcyBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiB1c2VUb2FzdD47XG5jb25zdCBtb2NrVXNlUm91dGVyID0gdXNlUm91dGVyIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIHVzZVJvdXRlcj47XG5cbmRlc2NyaWJlKCdBY2NvbW1vZGF0aW9uc1BhZ2UgLSBHdWVzdCBWaWV3IE5hdmlnYXRpb24nLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tBZGRUb2FzdCA9IGplc3QuZm4oKTtcbiAgY29uc3QgbW9ja1B1c2ggPSBqZXN0LmZuKCk7XG5cbiAgY29uc3QgbW9ja0FjY29tbW9kYXRpb25zID0gW1xuICAgIHtcbiAgICAgIGlkOiAnYWNjb21tb2RhdGlvbi0xJyxcbiAgICAgIG5hbWU6ICdUYW1hcmluZG8gRGlyaWEgQmVhY2ggUmVzb3J0JyxcbiAgICAgIGFkZHJlc3M6ICcxMjMgQmVhY2ggUm9hZCwgVGFtYXJpbmRvJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQmVhY2hmcm9udCByZXNvcnQnLFxuICAgICAgbG9jYXRpb25JZDogJ2xvYy0xJyxcbiAgICAgIGNoZWNrSW5EYXRlOiAnMjAyNS0wNi0xNCcsXG4gICAgICBjaGVja091dERhdGU6ICcyMDI1LTA2LTE3JyxcbiAgICAgIHN0YXR1czogJ2F2YWlsYWJsZScsXG4gICAgfSxcbiAgICB7XG4gICAgICBpZDogJ2FjY29tbW9kYXRpb24tMicsXG4gICAgICBuYW1lOiAnU3Vuc2V0IFZpbGxhJyxcbiAgICAgIGFkZHJlc3M6ICc0NTYgSGlsbCBTdHJlZXQsIFRhbWFyaW5kbycsXG4gICAgICBkZXNjcmlwdGlvbjogJ0x1eHVyeSB2aWxsYScsXG4gICAgICBsb2NhdGlvbklkOiAnbG9jLTInLFxuICAgICAgY2hlY2tJbkRhdGU6ICcyMDI1LTA2LTE0JyxcbiAgICAgIGNoZWNrT3V0RGF0ZTogJzIwMjUtMDYtMTcnLFxuICAgICAgc3RhdHVzOiAnYm9va2VkJyxcbiAgICB9LFxuICBdO1xuXG4gIGNvbnN0IG1vY2tMb2NhdGlvbnMgPSBbXG4gICAgeyBpZDogJ2xvYy0xJywgbmFtZTogJ1RhbWFyaW5kbyBCZWFjaCcgfSxcbiAgICB7IGlkOiAnbG9jLTInLCBuYW1lOiAnVGFtYXJpbmRvIEhpbGxzJyB9LFxuICBdO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIG1vY2tVc2VUb2FzdC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgYWRkVG9hc3Q6IG1vY2tBZGRUb2FzdCxcbiAgICAgIHRvYXN0czogW10sXG4gICAgICByZW1vdmVUb2FzdDogamVzdC5mbigpLFxuICAgIH0pO1xuXG4gICAgbW9ja1VzZVJvdXRlci5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgcHVzaDogbW9ja1B1c2gsXG4gICAgICByZXBsYWNlOiBqZXN0LmZuKCksXG4gICAgICByZWZyZXNoOiBqZXN0LmZuKCksXG4gICAgICBiYWNrOiBqZXN0LmZuKCksXG4gICAgICBmb3J3YXJkOiBqZXN0LmZuKCksXG4gICAgICBwcmVmZXRjaDogamVzdC5mbigpLFxuICAgIH0gYXMgYW55KTtcblxuICAgIC8vIE1vY2sgZmV0Y2ggcmVzcG9uc2VzXG4gICAgKGdsb2JhbC5mZXRjaCBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbigodXJsOiBzdHJpbmcpID0+IHtcbiAgICAgIGlmICh1cmwuaW5jbHVkZXMoJy9hcGkvYWRtaW4vYWNjb21tb2RhdGlvbnMnKSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGE6IHsgYWNjb21tb2RhdGlvbnM6IG1vY2tBY2NvbW1vZGF0aW9ucyB9LFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICh1cmwuaW5jbHVkZXMoJy9hcGkvYWRtaW4vbG9jYXRpb25zJykpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAganNvbjogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiBtb2NrTG9jYXRpb25zLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ1Vua25vd24gVVJMJykpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVmlldyBCdXR0b24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZW5kZXIgVmlldyBidXR0b24gZm9yIGVhY2ggYWNjb21tb2RhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJlbmRlcig8QWNjb21tb2RhdGlvbnNQYWdlIC8+KTtcblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QWxsQnlUZXh0KCdUYW1hcmluZG8gRGlyaWEgQmVhY2ggUmVzb3J0JykubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgdmlld0J1dHRvbnMgPSBzY3JlZW4uZ2V0QWxsQnlSb2xlKCdidXR0b24nLCB7IG5hbWU6IC9edmlldyQvaSB9KTtcbiAgICAgIGV4cGVjdCh2aWV3QnV0dG9ucy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbmF2aWdhdGUgdG8gZ3Vlc3QtZmFjaW5nIGFjY29tbW9kYXRpb24gcGFnZSB3aGVuIFZpZXcgYnV0dG9uIGlzIGNsaWNrZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEFjY29tbW9kYXRpb25zUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEFsbEJ5VGV4dCgnVGFtYXJpbmRvIERpcmlhIEJlYWNoIFJlc29ydCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZpZXdCdXR0b25zID0gc2NyZWVuLmdldEFsbEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvXnZpZXckL2kgfSk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2sodmlld0J1dHRvbnNbMF0pO1xuXG4gICAgICBleHBlY3Qod2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJy9ndWVzdC9hY2NvbW1vZGF0aW9uL2FjY29tbW9kYXRpb24tMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjb3JyZWN0IFVSTCBmb3IgZWFjaCBhY2NvbW1vZGF0aW9uIElEJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmVuZGVyKDxBY2NvbW1vZGF0aW9uc1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRBbGxCeVRleHQoJ1RhbWFyaW5kbyBEaXJpYSBCZWFjaCBSZXNvcnQnKS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBUZXN0IGZpcnN0IGFjY29tbW9kYXRpb25cbiAgICAgIGNvbnN0IHZpZXdCdXR0b25zID0gc2NyZWVuLmdldEFsbEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvXnZpZXckL2kgfSk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2sodmlld0J1dHRvbnNbMF0pO1xuICAgICAgZXhwZWN0KHdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCcvZ3Vlc3QvYWNjb21tb2RhdGlvbi9hY2NvbW1vZGF0aW9uLTEnKTtcblxuICAgICAgLy8gUmVzZXQgbG9jYXRpb25cbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyc7XG5cbiAgICAgIC8vIFRlc3Qgc2Vjb25kIGFjY29tbW9kYXRpb24gKGFjY291bnRpbmcgZm9yIHBvc3NpYmxlIGR1cGxpY2F0ZXMpXG4gICAgICBjb25zdCBzZWNvbmRCdXR0b25JbmRleCA9IHZpZXdCdXR0b25zLmxlbmd0aCA+IDIgPyAyIDogMTtcbiAgICAgIGlmICh2aWV3QnV0dG9ucy5sZW5ndGggPiBzZWNvbmRCdXR0b25JbmRleCkge1xuICAgICAgICBmaXJlRXZlbnQuY2xpY2sodmlld0J1dHRvbnNbc2Vjb25kQnV0dG9uSW5kZXhdKTtcbiAgICAgICAgZXhwZWN0KHdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCcvZ3Vlc3QvYWNjb21tb2RhdGlvbi9hY2NvbW1vZGF0aW9uLTInKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHByb3BhZ2F0ZSBjbGljayBldmVudCB0byByb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEFjY29tbW9kYXRpb25zUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEFsbEJ5VGV4dCgnVGFtYXJpbmRvIERpcmlhIEJlYWNoIFJlc29ydCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZpZXdCdXR0b25zID0gc2NyZWVuLmdldEFsbEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvXnZpZXckL2kgfSk7XG4gICAgICBjb25zdCBjbGlja0V2ZW50ID0gbmV3IE1vdXNlRXZlbnQoJ2NsaWNrJywgeyBidWJibGVzOiB0cnVlIH0pO1xuICAgICAgY29uc3Qgc3RvcFByb3BhZ2F0aW9uU3B5ID0gamVzdC5zcHlPbihjbGlja0V2ZW50LCAnc3RvcFByb3BhZ2F0aW9uJyk7XG4gICAgICBcbiAgICAgIHZpZXdCdXR0b25zWzBdLmRpc3BhdGNoRXZlbnQoY2xpY2tFdmVudCk7XG5cbiAgICAgIGV4cGVjdChzdG9wUHJvcGFnYXRpb25TcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0xpbmsgR2VuZXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIFVSTCB3aXRoIC9ndWVzdC9hY2NvbW1vZGF0aW9uLyBwcmVmaXgnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEFjY29tbW9kYXRpb25zUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEFsbEJ5VGV4dCgnVGFtYXJpbmRvIERpcmlhIEJlYWNoIFJlc29ydCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZpZXdCdXR0b25zID0gc2NyZWVuLmdldEFsbEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvXnZpZXckL2kgfSk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2sodmlld0J1dHRvbnNbMF0pO1xuXG4gICAgICBleHBlY3Qod2luZG93LmxvY2F0aW9uLmhyZWYpLnRvTWF0Y2goL15cXC9ndWVzdFxcL2FjY29tbW9kYXRpb25cXC8vKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGFjY29tbW9kYXRpb24gSUQgaW4gVVJMJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmVuZGVyKDxBY2NvbW1vZGF0aW9uc1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRBbGxCeVRleHQoJ1RhbWFyaW5kbyBEaXJpYSBCZWFjaCBSZXNvcnQnKS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2aWV3QnV0dG9ucyA9IHNjcmVlbi5nZXRBbGxCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL152aWV3JC9pIH0pO1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKHZpZXdCdXR0b25zWzBdKTtcblxuICAgICAgZXhwZWN0KHdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0NvbnRhaW4oJ2FjY29tbW9kYXRpb24tMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2Ugc2luZ3VsYXIgXCJhY2NvbW1vZGF0aW9uXCIgbm90IHBsdXJhbCBpbiBVUkwnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEFjY29tbW9kYXRpb25zUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnVGFtYXJpbmRvIERpcmlhIEJlYWNoIFJlc29ydCcpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHZpZXdCdXR0b25zID0gc2NyZWVuLmdldEFsbEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvXnZpZXckL2kgfSk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2sodmlld0J1dHRvbnNbMF0pO1xuXG4gICAgICBleHBlY3Qod2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQ29udGFpbignL2FjY29tbW9kYXRpb24vJyk7XG4gICAgICBleHBlY3Qod2luZG93LmxvY2F0aW9uLmhyZWYpLm5vdC50b0NvbnRhaW4oJy9hY2NvbW1vZGF0aW9ucy8nKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsInVzZVJvdXRlciIsImZuIiwidXNlU2VhcmNoUGFyYW1zIiwiZ2V0IiwiZ2V0QWxsIiwiaGFzIiwia2V5cyIsInZhbHVlcyIsImVudHJpZXMiLCJmb3JFYWNoIiwidG9TdHJpbmciLCJ1c2VQYXRobmFtZSIsImdsb2JhbCIsImZldGNoIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwibW9ja1VzZVRvYXN0IiwidXNlVG9hc3QiLCJtb2NrVXNlUm91dGVyIiwiZGVzY3JpYmUiLCJtb2NrQWRkVG9hc3QiLCJtb2NrUHVzaCIsIm1vY2tBY2NvbW1vZGF0aW9ucyIsImlkIiwibmFtZSIsImFkZHJlc3MiLCJkZXNjcmlwdGlvbiIsImxvY2F0aW9uSWQiLCJjaGVja0luRGF0ZSIsImNoZWNrT3V0RGF0ZSIsInN0YXR1cyIsIm1vY2tMb2NhdGlvbnMiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIm1vY2tSZXR1cm5WYWx1ZSIsImFkZFRvYXN0IiwidG9hc3RzIiwicmVtb3ZlVG9hc3QiLCJwdXNoIiwicmVwbGFjZSIsInJlZnJlc2giLCJiYWNrIiwiZm9yd2FyZCIsInByZWZldGNoIiwibW9ja0ltcGxlbWVudGF0aW9uIiwidXJsIiwiaW5jbHVkZXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsIm9rIiwianNvbiIsInN1Y2Nlc3MiLCJkYXRhIiwiYWNjb21tb2RhdGlvbnMiLCJyZWplY3QiLCJFcnJvciIsIml0IiwicmVuZGVyIiwiQWNjb21tb2RhdGlvbnNQYWdlIiwid2FpdEZvciIsImV4cGVjdCIsInNjcmVlbiIsImdldEFsbEJ5VGV4dCIsImxlbmd0aCIsInRvQmVHcmVhdGVyVGhhbiIsInZpZXdCdXR0b25zIiwiZ2V0QWxsQnlSb2xlIiwiZmlyZUV2ZW50IiwiY2xpY2siLCJ0b0JlIiwic2Vjb25kQnV0dG9uSW5kZXgiLCJjbGlja0V2ZW50IiwiTW91c2VFdmVudCIsImJ1YmJsZXMiLCJzdG9wUHJvcGFnYXRpb25TcHkiLCJzcHlPbiIsImRpc3BhdGNoRXZlbnQiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwidG9NYXRjaCIsInRvQ29udGFpbiIsImdldEJ5VGV4dCIsInRvQmVJblRoZURvY3VtZW50Iiwibm90Il0sIm1hcHBp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