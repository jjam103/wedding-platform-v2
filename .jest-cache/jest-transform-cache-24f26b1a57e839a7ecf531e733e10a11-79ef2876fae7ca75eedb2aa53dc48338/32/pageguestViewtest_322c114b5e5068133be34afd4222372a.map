{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/accommodations/page.guestView.test.tsx"],"sourcesContent":["/**\n * Guest View Navigation Tests for Accommodations\n * \n * Tests the \"View as Guest\" functionality for accommodations.\n * Requirements: 32.4\n */\n\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport AccommodationsPage from './page';\nimport { useToast } from '@/components/ui/ToastContext';\nimport { useRouter } from 'next/navigation';\n\n// Mock dependencies\njest.mock('@/components/ui/ToastContext');\njest.mock('next/navigation', () => ({\n  useRouter: jest.fn(),\n  useSearchParams: () => ({\n    get: jest.fn(),\n    getAll: jest.fn(),\n    has: jest.fn(),\n    keys: jest.fn(),\n    values: jest.fn(),\n    entries: jest.fn(),\n    forEach: jest.fn(),\n    toString: jest.fn(),\n  }),\n  usePathname: () => '/admin/accommodations',\n}));\n\n// Mock fetch\nglobal.fetch = jest.fn();\n\n// Mock window.location\ndelete (window as any).location;\nwindow.location = { href: '' } as any;\n\nconst mockUseToast = useToast as jest.MockedFunction<typeof useToast>;\nconst mockUseRouter = useRouter as jest.MockedFunction<typeof useRouter>;\n\ndescribe('AccommodationsPage - Guest View Navigation', () => {\n  const mockAddToast = jest.fn();\n  const mockPush = jest.fn();\n\n  const mockAccommodations = [\n    {\n      id: 'accommodation-1',\n      name: 'Tamarindo Diria Beach Resort',\n      address: '123 Beach Road, Tamarindo',\n      description: 'Beachfront resort',\n      locationId: 'loc-1',\n      checkInDate: '2025-06-14',\n      checkOutDate: '2025-06-17',\n      status: 'available',\n    },\n    {\n      id: 'accommodation-2',\n      name: 'Sunset Villa',\n      address: '456 Hill Street, Tamarindo',\n      description: 'Luxury villa',\n      locationId: 'loc-2',\n      checkInDate: '2025-06-14',\n      checkOutDate: '2025-06-17',\n      status: 'booked',\n    },\n  ];\n\n  const mockLocations = [\n    { id: 'loc-1', name: 'Tamarindo Beach' },\n    { id: 'loc-2', name: 'Tamarindo Hills' },\n  ];\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    mockUseToast.mockReturnValue({\n      addToast: mockAddToast,\n      toasts: [],\n      removeToast: jest.fn(),\n    });\n\n    mockUseRouter.mockReturnValue({\n      push: mockPush,\n      replace: jest.fn(),\n      refresh: jest.fn(),\n      back: jest.fn(),\n      forward: jest.fn(),\n      prefetch: jest.fn(),\n    } as any);\n\n    // Mock fetch responses\n    (global.fetch as jest.Mock).mockImplementation((url: string) => {\n      if (url.includes('/api/admin/accommodations')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({\n            success: true,\n            data: { accommodations: mockAccommodations },\n          }),\n        });\n      }\n      if (url.includes('/api/admin/locations')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({\n            success: true,\n            data: mockLocations,\n          }),\n        });\n      }\n      return Promise.reject(new Error('Unknown URL'));\n    });\n  });\n\n  describe('View Button', () => {\n    it('should render View button for each accommodation', async () => {\n      render(<AccommodationsPage />);\n\n      await waitFor(() => {\n        expect(screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);\n      });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      expect(viewButtons.length).toBeGreaterThan(0);\n    });\n\n    it('should navigate to guest-facing accommodation page when View button is clicked', async () => {\n      render(<AccommodationsPage />);\n\n      await waitFor(() => {\n        expect(screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);\n      });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toBe('/guest/accommodation/accommodation-1');\n    });\n\n    it('should generate correct URL for each accommodation ID', async () => {\n      render(<AccommodationsPage />);\n\n      await waitFor(() => {\n        expect(screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);\n      });\n\n      // Test first accommodation\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n      expect(window.location.href).toBe('/guest/accommodation/accommodation-1');\n\n      // Reset location\n      window.location.href = '';\n\n      // Test second accommodation (accounting for possible duplicates)\n      const secondButtonIndex = viewButtons.length > 2 ? 2 : 1;\n      if (viewButtons.length > secondButtonIndex) {\n        fireEvent.click(viewButtons[secondButtonIndex]);\n        expect(window.location.href).toBe('/guest/accommodation/accommodation-2');\n      }\n    });\n\n    it('should not propagate click event to row', async () => {\n      render(<AccommodationsPage />);\n\n      await waitFor(() => {\n        expect(screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);\n      });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      const clickEvent = new MouseEvent('click', { bubbles: true });\n      const stopPropagationSpy = jest.spyOn(clickEvent, 'stopPropagation');\n      \n      viewButtons[0].dispatchEvent(clickEvent);\n\n      expect(stopPropagationSpy).toHaveBeenCalled();\n    });\n  });\n\n  describe('Link Generation', () => {\n    it('should generate URL with /guest/accommodation/ prefix', async () => {\n      render(<AccommodationsPage />);\n\n      await waitFor(() => {\n        expect(screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);\n      });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toMatch(/^\\/guest\\/accommodation\\//);\n    });\n\n    it('should use accommodation ID in URL', async () => {\n      render(<AccommodationsPage />);\n\n      await waitFor(() => {\n        expect(screen.getAllByText('Tamarindo Diria Beach Resort').length).toBeGreaterThan(0);\n      });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toContain('accommodation-1');\n    });\n\n    it('should use singular \"accommodation\" not plural in URL', async () => {\n      render(<AccommodationsPage />);\n\n      await waitFor(() => {\n        expect(screen.getByText('Tamarindo Diria Beach Resort')).toBeInTheDocument();\n      });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toContain('/accommodation/');\n      expect(window.location.href).not.toContain('/accommodations/');\n    });\n  });\n});\n"],"names":["jest","mock","useRouter","fn","useSearchParams","get","getAll","has","keys","values","entries","forEach","toString","usePathname","global","fetch","window","location","href","mockUseToast","useToast","mockUseRouter","describe","mockAddToast","mockPush","mockAccommodations","id","name","address","description","locationId","checkInDate","checkOutDate","status","mockLocations","beforeEach","clearAllMocks","mockReturnValue","addToast","toasts","removeToast","push","replace","refresh","back","forward","prefetch","mockImplementation","url","includes","Promise","resolve","ok","json","success","data","accommodations","reject","Error","it","render","AccommodationsPage","waitFor","expect","screen","getAllByText","length","toBeGreaterThan","viewButtons","getAllByRole","fireEvent","click","toBe","secondButtonIndex","clickEvent","MouseEvent","bubbles","stopPropagationSpy","spyOn","dispatchEvent","toHaveBeenCalled","toMatch","toContain","getByText","toBeInTheDocument","not"],"mappings":"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"}