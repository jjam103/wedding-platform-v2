{"version":3,"names":["GET","request","cov_nw2y62yfm","f","s","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","_types","ERROR_CODES","UNAUTHORIZED","message","status","guest","guestError","from","select","eq","user","email","single","NOT_FOUND","rsvpsResult","_rsvpService","getByGuest","id","rsvps","summary","total_rsvps","length","events","total","filter","r","event_id","attending","declined","maybe","pending","activities","activity_id","overall","response_rate","Math","round","UNKNOWN_ERROR","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/rsvps/summary/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport * as rsvpService from '@/services/rsvpService';\nimport { ERROR_CODES } from '@/types';\n\n/**\n * GET /api/guest/rsvps/summary\n * \n * Returns RSVP summary for the authenticated guest.\n * Includes event and activity counts, and status breakdown.\n * \n * Requirements: 7.5\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. Auth check\n    const supabase = createRouteHandlerClient({ cookies });\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: ERROR_CODES.UNAUTHORIZED, message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // Get guest ID from session\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id')\n      .eq('email', session.user.email)\n      .single();\n\n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: ERROR_CODES.NOT_FOUND, message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n\n    // 2. Get all RSVPs for this guest\n    const rsvpsResult = await rsvpService.getByGuest(guest.id);\n\n    if (!rsvpsResult.success) {\n      return NextResponse.json(rsvpsResult, { status: 500 });\n    }\n\n    const rsvps = rsvpsResult.data;\n\n    // 3. Calculate summary statistics\n    const summary = {\n      total_rsvps: rsvps.length,\n      events: {\n        total: rsvps.filter(r => r.event_id).length,\n        attending: rsvps.filter(r => r.event_id && r.status === 'attending').length,\n        declined: rsvps.filter(r => r.event_id && r.status === 'declined').length,\n        maybe: rsvps.filter(r => r.event_id && r.status === 'maybe').length,\n        pending: rsvps.filter(r => r.event_id && r.status === 'pending').length,\n      },\n      activities: {\n        total: rsvps.filter(r => r.activity_id).length,\n        attending: rsvps.filter(r => r.activity_id && r.status === 'attending').length,\n        declined: rsvps.filter(r => r.activity_id && r.status === 'declined').length,\n        maybe: rsvps.filter(r => r.activity_id && r.status === 'maybe').length,\n        pending: rsvps.filter(r => r.activity_id && r.status === 'pending').length,\n      },\n      overall: {\n        attending: rsvps.filter(r => r.status === 'attending').length,\n        declined: rsvps.filter(r => r.status === 'declined').length,\n        maybe: rsvps.filter(r => r.status === 'maybe').length,\n        pending: rsvps.filter(r => r.status === 'pending').length,\n      },\n      response_rate: rsvps.length > 0 \n        ? Math.round((rsvps.filter(r => r.status !== 'pending').length / rsvps.length) * 100)\n        : 0,\n    };\n\n    return NextResponse.json({\n      success: true,\n      data: summary,\n    });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: ERROR_CODES.UNKNOWN_ERROR,\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BAcsB;;;;;;WAAAA,GAAA;;;;;iCAdmB;;;iCACjB;;;iCACK;;;wEACA;;;iCACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}