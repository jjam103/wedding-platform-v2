{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/budgetTotalCalculation.property.test.ts"],"sourcesContent":["/**\n * Property-Based Test: Budget Total Calculation\n * Feature: destination-wedding-platform, Property 12: Budget Total Calculation\n * \n * Validates: Requirements 8.2\n * \n * Property: For any set of vendors, activities, and accommodations with associated costs,\n * the total wedding cost should equal the sum of all individual costs\n * (vendor fees + activity costs + accommodation expenses).\n */\n\nimport * as fc from 'fast-check';\n\n// Mock Supabase before importing budgetService\nconst mockFrom = jest.fn();\njest.mock('@/lib/supabase', () => ({\n  supabase: {\n    from: (...args: any[]) => mockFrom(...args),\n  },\n}));\n\n// Import after mocking\nimport { calculateTotal } from './budgetService';\n\ndescribe('Feature: destination-wedding-platform, Property 12: Budget Total Calculation', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should calculate total as sum of all vendor, activity, and accommodation costs', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Generate random vendors\n        fc.array(\n          fc.record({\n            id: fc.uuid(),\n            name: fc.string({ minLength: 1, maxLength: 50 }),\n            category: fc.constantFrom('photography', 'flowers', 'catering', 'music', 'transportation', 'decoration', 'other'),\n            base_cost: fc.float({ min: 0, max: 10000, noNaN: true }).map(n => n.toFixed(2)),\n            amount_paid: fc.float({ min: 0, max: 10000, noNaN: true }).map(n => n.toFixed(2)),\n            payment_status: fc.constantFrom('unpaid', 'partial', 'paid'),\n          }),\n          { minLength: 0, maxLength: 10 }\n        ),\n        // Generate random activities with costs\n        fc.array(\n          fc.record({\n            id: fc.uuid(),\n            name: fc.string({ minLength: 1, maxLength: 50 }),\n            cost_per_person: fc.float({ min: 0, max: 500, noNaN: true }).map(n => n.toFixed(2)),\n            host_subsidy: fc.float({ min: 0, max: 200, noNaN: true }).map(n => n.toFixed(2)),\n            attendee_count: fc.integer({ min: 0, max: 100 }),\n          }),\n          { minLength: 0, maxLength: 10 }\n        ),\n        async (vendors, activities) => {\n          // Mock vendor query - handle both .in() and direct await patterns\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'vendors') {\n              const mockQuery = {\n                select: jest.fn().mockReturnValue({\n                  in: jest.fn().mockResolvedValue({\n                    data: vendors,\n                    error: null,\n                  }),\n                  // Support direct await when .in() is not called\n                  then: (resolve: any) => resolve({ data: vendors, error: null }),\n                }),\n              };\n              return mockQuery;\n            }\n            if (table === 'activities') {\n              return {\n                select: jest.fn().mockReturnValue({\n                  not: jest.fn().mockResolvedValue({\n                    data: activities,\n                    error: null,\n                  }),\n                }),\n              };\n            }\n            return {\n              select: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          // Mock RSVP counts for each activity\n          const rsvpMocks = new Map();\n          activities.forEach((activity) => {\n            rsvpMocks.set(activity.id, activity.attendee_count);\n          });\n\n          // Override from() for RSVP queries\n          const originalFrom = mockFrom.getMockImplementation();\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'rsvps') {\n              return {\n                select: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockImplementation((field: string, value: string) => {\n                    if (field === 'activity_id') {\n                      const count = rsvpMocks.get(value) || 0;\n                      return {\n                        eq: jest.fn().mockResolvedValue({\n                          count,\n                          error: null,\n                        }),\n                      };\n                    }\n                    return {\n                      eq: jest.fn().mockResolvedValue({\n                        count: 0,\n                        error: null,\n                      }),\n                    };\n                  }),\n                }),\n              };\n            }\n            return originalFrom ? originalFrom(table) : {\n              select: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          // Calculate expected totals manually\n          const expectedVendorTotal = vendors.reduce(\n            (sum, v) => sum + parseFloat(v.base_cost),\n            0\n          );\n\n          const expectedVendorPaid = vendors.reduce(\n            (sum, v) => sum + parseFloat(v.amount_paid),\n            0\n          );\n\n          const expectedActivityTotal = activities.reduce(\n            (sum, a) => sum + parseFloat(a.cost_per_person) * a.attendee_count,\n            0\n          );\n\n          const expectedActivitySubsidy = activities.reduce(\n            (sum, a) => sum + parseFloat(a.host_subsidy) * a.attendee_count,\n            0\n          );\n\n          const expectedGrossTotal = expectedVendorTotal + expectedActivityTotal;\n          const expectedNetTotal = expectedGrossTotal - expectedActivitySubsidy;\n          const expectedBalanceDue = expectedNetTotal - expectedVendorPaid;\n\n          // Call the service\n          const result = await calculateTotal({\n            includeVendors: true,\n            includeActivities: true,\n            includeAccommodations: false,\n          });\n\n          // Verify the property\n          expect(result.success).toBe(true);\n          if (result.success) {\n            const breakdown = result.data;\n\n            // Verify gross total equals sum of all costs\n            const actualGrossTotal = breakdown.totals.grossTotal;\n            expect(Math.abs(actualGrossTotal - expectedGrossTotal)).toBeLessThan(0.01);\n\n            // Verify net total equals gross minus subsidies\n            const actualNetTotal = breakdown.totals.netTotal;\n            expect(Math.abs(actualNetTotal - expectedNetTotal)).toBeLessThan(0.01);\n\n            // Verify balance due equals net minus paid\n            const actualBalanceDue = breakdown.totals.balanceDue;\n            expect(Math.abs(actualBalanceDue - expectedBalanceDue)).toBeLessThan(0.01);\n\n            // Verify subsidies are tracked correctly\n            expect(Math.abs(breakdown.totals.totalSubsidies - expectedActivitySubsidy)).toBeLessThan(0.01);\n\n            // Verify paid amount is tracked correctly\n            expect(Math.abs(breakdown.totals.totalPaid - expectedVendorPaid)).toBeLessThan(0.01);\n          }\n        }\n      ),\n      { numRuns: 20, timeout: 5000 } // Reduced runs and increased timeout\n    );\n  });\n\n  it('should handle empty vendor and activity lists', async () => {\n    // Mock empty results with proper chaining support\n    mockFrom.mockImplementation((table: string) => {\n      if (table === 'vendors') {\n        return {\n          select: jest.fn().mockReturnValue({\n            in: jest.fn().mockResolvedValue({\n              data: [],\n              error: null,\n            }),\n            // Support direct await when .in() is not called\n            then: (resolve: any) => resolve({ data: [], error: null }),\n          }),\n        };\n      }\n      if (table === 'activities') {\n        return {\n          select: jest.fn().mockReturnValue({\n            not: jest.fn().mockResolvedValue({\n              data: [],\n              error: null,\n            }),\n          }),\n        };\n      }\n      return {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n      };\n    });\n\n    const result = await calculateTotal();\n\n    expect(result.success).toBe(true);\n    if (result.success) {\n      expect(result.data.totals.grossTotal).toBe(0);\n      expect(result.data.totals.netTotal).toBe(0);\n      expect(result.data.totals.balanceDue).toBe(0);\n      expect(result.data.totals.totalSubsidies).toBe(0);\n      expect(result.data.totals.totalPaid).toBe(0);\n    }\n  });\n\n  it('should correctly aggregate costs by vendor category', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(\n          fc.record({\n            id: fc.uuid(),\n            name: fc.string({ minLength: 1, maxLength: 50 }),\n            category: fc.constantFrom('photography', 'catering', 'music'),\n            base_cost: fc.float({ min: 100, max: 5000, noNaN: true }).map(n => n.toFixed(2)),\n            amount_paid: fc.constant('0.00'),\n            payment_status: fc.constant('unpaid'),\n          }),\n          { minLength: 1, maxLength: 20 }\n        ),\n        async (vendors) => {\n          // Mock vendor query with proper chaining support\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'vendors') {\n              return {\n                select: jest.fn().mockReturnValue({\n                  in: jest.fn().mockResolvedValue({\n                    data: vendors,\n                    error: null,\n                  }),\n                  // Support direct await when .in() is not called\n                  then: (resolve: any) => resolve({ data: vendors, error: null }),\n                }),\n              };\n            }\n            if (table === 'activities') {\n              return {\n                select: jest.fn().mockReturnValue({\n                  not: jest.fn().mockResolvedValue({\n                    data: [],\n                    error: null,\n                  }),\n                }),\n              };\n            }\n            return {\n              select: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          const result = await calculateTotal({\n            includeVendors: true,\n            includeActivities: false,\n            includeAccommodations: false,\n          });\n\n          expect(result.success).toBe(true);\n          if (result.success) {\n            const breakdown = result.data;\n\n            // Calculate expected totals per category\n            const categoryTotals: Record<string, number> = {};\n            vendors.forEach((v) => {\n              if (!categoryTotals[v.category]) {\n                categoryTotals[v.category] = 0;\n              }\n              categoryTotals[v.category] += parseFloat(v.base_cost);\n            });\n\n            // Verify each category total\n            breakdown.vendors.forEach((categoryBreakdown) => {\n              const expectedTotal = categoryTotals[categoryBreakdown.category] || 0;\n              expect(Math.abs(categoryBreakdown.totalCost - expectedTotal)).toBeLessThan(0.01);\n            });\n\n            // Verify sum of category totals equals gross total\n            const sumOfCategories = breakdown.vendors.reduce(\n              (sum, cat) => sum + cat.totalCost,\n              0\n            );\n            expect(Math.abs(sumOfCategories - breakdown.totals.grossTotal)).toBeLessThan(0.01);\n          }\n        }\n      ),\n      { numRuns: 10, timeout: 5000 } // Reduced runs and increased timeout\n    );\n  });\n});\n"],"names":["jest","mock","supabase","from","args","mockFrom","fn","describe","beforeEach","clearAllMocks","it","fc","assert","asyncProperty","array","record","id","uuid","name","string","minLength","maxLength","category","constantFrom","base_cost","float","min","max","noNaN","map","n","toFixed","amount_paid","payment_status","cost_per_person","host_subsidy","attendee_count","integer","vendors","activities","mockImplementation","table","mockQuery","select","mockReturnValue","in","mockResolvedValue","data","error","then","resolve","not","mockReturnThis","eq","rsvpMocks","Map","forEach","activity","set","originalFrom","getMockImplementation","field","value","count","get","expectedVendorTotal","reduce","sum","v","parseFloat","expectedVendorPaid","expectedActivityTotal","a","expectedActivitySubsidy","expectedGrossTotal","expectedNetTotal","expectedBalanceDue","result","calculateTotal","includeVendors","includeActivities","includeAccommodations","expect","success","toBe","breakdown","actualGrossTotal","totals","grossTotal","Math","abs","toBeLessThan","actualNetTotal","netTotal","actualBalanceDue","balanceDue","totalSubsidies","totalPaid","numRuns","timeout","constant","categoryTotals","categoryBreakdown","expectedTotal","totalCost","sumOfCategories","cat"],"mappings":"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"}