bb4d7d95d2b7a0a62ae974dcd1f72ef0
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "PUT", {
    enumerable: true,
    get: function() {
        return PUT;
    }
});
const _ssr = require("@supabase/ssr");
const _headers = require("next/headers");
const _server = require("next/server");
const _rsvpSchemas = require("../../../../../schemas/rsvpSchemas");
async function PUT(request, { params }) {
    try {
        // 1. Auth check
        const cookieStore = await (0, _headers.cookies)();
        const supabase = (0, _ssr.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY, {
            cookies: {
                getAll () {
                    return cookieStore.getAll();
                },
                setAll (cookiesToSet) {
                    cookiesToSet.forEach(({ name, value })=>{
                        cookieStore.set(name, value);
                    });
                }
            }
        });
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // 2. Parse and validate request body
        const body = await request.json();
        const validation = _rsvpSchemas.updateRSVPSchema.safeParse(body);
        if (!validation.success) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid request data',
                    details: validation.error.issues
                }
            }, {
                status: 400
            });
        }
        // Await params
        const resolvedParams = await params;
        // 3. Update RSVP
        const { data, error } = await supabase.from('rsvps').update({
            ...validation.data,
            updated_at: new Date().toISOString(),
            responded_at: validation.data.status !== 'pending' ? new Date().toISOString() : undefined
        }).eq('id', resolvedParams.id).select().single();
        if (error) {
            if (error.code === 'PGRST116') {
                return _server.NextResponse.json({
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'RSVP not found'
                    }
                }, {
                    status: 404
                });
            }
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message
                }
            }, {
                status: 500
            });
        }
        return _server.NextResponse.json({
            success: true,
            data
        });
    } catch (error) {
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'INTERNAL_ERROR',
                message: error instanceof Error ? error.message : 'Internal server error'
            }
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9yc3Zwcy9baWRdL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVNlcnZlckNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zc3InO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB1cGRhdGVSU1ZQU2NoZW1hIH0gZnJvbSAnQC9zY2hlbWFzL3JzdnBTY2hlbWFzJztcblxuLyoqXG4gKiBQVVQgL2FwaS9hZG1pbi9yc3Zwcy9baWRdXG4gKiBVcGRhdGUgYW4gUlNWUFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUFVUKFxuICByZXF1ZXN0OiBSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4gfVxuKSB7XG4gIHRyeSB7XG4gICAgLy8gMS4gQXV0aCBjaGVja1xuICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyQ2xpZW50KFxuICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcbiAgICAgIHtcbiAgICAgICAgY29va2llczoge1xuICAgICAgICAgIGdldEFsbCgpIHtcbiAgICAgICAgICAgIHJldHVybiBjb29raWVTdG9yZS5nZXRBbGwoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldEFsbChjb29raWVzVG9TZXQpIHtcbiAgICAgICAgICAgIGNvb2tpZXNUb1NldC5mb3JFYWNoKCh7IG5hbWUsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICAgICAgY29va2llU3RvcmUuc2V0KG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcbiAgICBcbiAgICBpZiAoYXV0aEVycm9yIHx8ICFzZXNzaW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdVTkFVVEhPUklaRUQnLCBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0gfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDIuIFBhcnNlIGFuZCB2YWxpZGF0ZSByZXF1ZXN0IGJvZHlcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHVwZGF0ZVJTVlBTY2hlbWEuc2FmZVBhcnNlKGJvZHkpO1xuICAgIFxuICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgICAgIGVycm9yOiB7IFxuICAgICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLCBcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHJlcXVlc3QgZGF0YScsIFxuICAgICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMgXG4gICAgICAgICAgfSBcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEF3YWl0IHBhcmFtc1xuICAgIGNvbnN0IHJlc29sdmVkUGFyYW1zID0gYXdhaXQgcGFyYW1zO1xuXG4gICAgLy8gMy4gVXBkYXRlIFJTVlBcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3JzdnBzJylcbiAgICAgIC51cGRhdGUoe1xuICAgICAgICAuLi52YWxpZGF0aW9uLmRhdGEsXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcmVzcG9uZGVkX2F0OiB2YWxpZGF0aW9uLmRhdGEuc3RhdHVzICE9PSAncGVuZGluZycgPyBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgOiB1bmRlZmluZWQsXG4gICAgICB9KVxuICAgICAgLmVxKCdpZCcsIHJlc29sdmVkUGFyYW1zLmlkKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBjb2RlOiAnTk9UX0ZPVU5EJywgbWVzc2FnZTogJ1JTVlAgbm90IGZvdW5kJyB9IH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfSB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YSB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICAgIGVycm9yOiB7IFxuICAgICAgICAgIGNvZGU6ICdJTlRFUk5BTF9FUlJPUicsIFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgXG4gICAgICAgIH0gXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlBVVCIsInJlcXVlc3QiLCJwYXJhbXMiLCJjb29raWVTdG9yZSIsImNvb2tpZXMiLCJzdXBhYmFzZSIsImNyZWF0ZVNlcnZlckNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldEFsbCIsInNldEFsbCIsImNvb2tpZXNUb1NldCIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJzZXQiLCJkYXRhIiwic2Vzc2lvbiIsImVycm9yIiwiYXV0aEVycm9yIiwiYXV0aCIsImdldFNlc3Npb24iLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwic3VjY2VzcyIsImNvZGUiLCJtZXNzYWdlIiwic3RhdHVzIiwiYm9keSIsInZhbGlkYXRpb24iLCJ1cGRhdGVSU1ZQU2NoZW1hIiwic2FmZVBhcnNlIiwiZGV0YWlscyIsImlzc3VlcyIsInJlc29sdmVkUGFyYW1zIiwiZnJvbSIsInVwZGF0ZSIsInVwZGF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJyZXNwb25kZWRfYXQiLCJ1bmRlZmluZWQiLCJlcSIsImlkIiwic2VsZWN0Iiwic2luZ2xlIiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7K0JBU3NCQTs7O2VBQUFBOzs7cUJBVGE7eUJBQ1g7d0JBQ0s7NkJBQ0k7QUFNMUIsZUFBZUEsSUFDcEJDLE9BQWdCLEVBQ2hCLEVBQUVDLE1BQU0sRUFB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