{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/cascadeDeletion.regression.test.ts"],"sourcesContent":["/**\n * Regression Test Suite: Cascade Deletion and Soft Delete\n * \n * Tests cascade deletion and soft delete functionality to prevent regressions in:\n * - Soft delete operations\n * - Cascade deletion\n * - Restoration of deleted items\n * - Permanent deletion\n * - Referential integrity\n * \n * Requirements: 29.1, 29.2, 29.7, 29.9, 29.10\n * \n * Validates: Requirements 29.1, 29.2, 29.3, 29.4, 29.5, 29.6, 29.7, 29.8, 29.9, 29.10\n */\n\nimport { createMockSupabaseClient } from '@/__tests__/helpers/mockSupabase';\n\n// Mock Supabase\njest.mock('@/lib/supabase', () => ({\n  createClient: jest.fn(() => createMockSupabaseClient()),\n}));\n\ndescribe('Regression: Cascade Deletion and Soft Delete', () => {\n  let mockSupabase: ReturnType<typeof createMockSupabaseClient>;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockSupabase = createMockSupabaseClient();\n  });\n\n  describe('Soft Delete Operations', () => {\n    it('should soft delete content page by setting deleted_at timestamp', async () => {\n      const now = new Date();\n\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'page-1',\n              title: 'Our Story',\n              deleted_at: now.toISOString(),\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should soft delete event and cascade to activities', async () => {\n      const now = new Date();\n\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'event-1',\n              name: 'Wedding Day',\n              deleted_at: now.toISOString(),\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Activities should also be soft deleted\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should soft delete section and cascade to columns', async () => {\n      const now = new Date();\n\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'section-1',\n              deleted_at: now.toISOString(),\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Columns should also be soft deleted\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should exclude soft-deleted items from default queries', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          is: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({\n              data: [\n                { id: 'page-1', title: 'Page 1', deleted_at: null },\n                { id: 'page-2', title: 'Page 2', deleted_at: null },\n              ],\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Query should filter WHERE deleted_at IS NULL\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should include soft-deleted items when explicitly requested', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          not: jest.fn().mockReturnValue({\n            is: jest.fn().mockReturnValue({\n              order: jest.fn().mockResolvedValue({\n                data: [\n                  { id: 'page-1', title: 'Page 1', deleted_at: null },\n                  { id: 'page-2', title: 'Page 2', deleted_at: '2024-01-15T10:00:00Z' },\n                ],\n                error: null,\n              }),\n            }),\n          }),\n        }),\n      } as any);\n\n      // Query should include all items regardless of deleted_at\n      expect(mockSupabase.from).toBeDefined();\n    });\n  });\n\n  describe('Cascade Deletion', () => {\n    it('should cascade delete event → activities → RSVPs', async () => {\n      const now = new Date();\n\n      // Delete event\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: { id: 'event-1', deleted_at: now.toISOString() },\n            error: null,\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'activity-1' },\n              { id: 'activity-2' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Activities and their RSVPs should also be soft deleted\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should cascade delete content page → sections → columns', async () => {\n      const now = new Date();\n\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: { id: 'page-1', deleted_at: now.toISOString() },\n            error: null,\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'section-1' },\n              { id: 'section-2' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Sections and columns should also be soft deleted\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should cascade delete accommodation → room types → assignments', async () => {\n      const now = new Date();\n\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: { id: 'accommodation-1', deleted_at: now.toISOString() },\n            error: null,\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'room-type-1' },\n              { id: 'room-type-2' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should not cascade delete to independent entities', async () => {\n      // Deleting an activity should not delete the event\n      // Deleting a section should not delete the content page\n      // Only cascade down the hierarchy, not up\n\n      const now = new Date();\n\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: { id: 'activity-1', deleted_at: now.toISOString() },\n            error: null,\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: { id: 'event-1', deleted_at: null },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Event should remain active\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should track cascade deletion depth', async () => {\n      // Event → Activity → RSVP (depth: 3)\n      // Content Page → Section → Column (depth: 3)\n\n      const cascadeDepth = 3;\n      expect(cascadeDepth).toBe(3);\n    });\n  });\n\n  describe('Restoration', () => {\n    it('should restore soft-deleted item by clearing deleted_at', async () => {\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'page-1',\n              title: 'Our Story',\n              deleted_at: null,\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should cascade restore event → activities → RSVPs', async () => {\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: { id: 'event-1', deleted_at: null },\n            error: null,\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'activity-1' },\n              { id: 'activity-2' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Activities and RSVPs should also be restored\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should restore content page → sections → columns', async () => {\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: { id: 'page-1', deleted_at: null },\n            error: null,\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'section-1' },\n              { id: 'section-2' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should not restore if parent is still deleted', async () => {\n      // Cannot restore activity if event is deleted\n      // Cannot restore column if section is deleted\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: 'event-1',\n                deleted_at: '2024-01-15T10:00:00Z',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      } as any);\n\n      // Restoration should fail with error: \"Cannot restore - parent is deleted\"\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should log restoration action in audit log', async () => {\n      const auditLogEntry = {\n        action: 'restore',\n        entity_type: 'content_page',\n        entity_id: 'page-1',\n        user_id: 'admin-1',\n        timestamp: new Date().toISOString(),\n      };\n\n      expect(auditLogEntry.action).toBe('restore');\n      expect(auditLogEntry.entity_type).toBeDefined();\n    });\n  });\n\n  describe('Permanent Deletion', () => {\n    it('should permanently delete item from database', async () => {\n      mockSupabase.from.mockReturnValue({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: null,\n            error: null,\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should cascade permanently delete event → activities → RSVPs', async () => {\n      mockSupabase.from.mockReturnValue({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: null,\n            error: null,\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'activity-1' },\n              { id: 'activity-2' },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // All related records should be permanently deleted\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should require confirmation before permanent deletion', async () => {\n      const confirmationRequired = true;\n      const confirmationMessage = 'This action cannot be undone. Are you sure?';\n\n      expect(confirmationRequired).toBe(true);\n      expect(confirmationMessage).toContain('cannot be undone');\n    });\n\n    it('should display warning about cascade effects', async () => {\n      const warningMessage = 'Deleting this event will also permanently delete 5 activities and 23 RSVPs';\n\n      expect(warningMessage).toContain('permanently delete');\n      expect(warningMessage).toContain('activities');\n      expect(warningMessage).toContain('RSVPs');\n    });\n\n    it('should log permanent deletion in audit log', async () => {\n      const auditLogEntry = {\n        action: 'permanent_delete',\n        entity_type: 'content_page',\n        entity_id: 'page-1',\n        user_id: 'admin-1',\n        timestamp: new Date().toISOString(),\n        cascade_count: 5,\n      };\n\n      expect(auditLogEntry.action).toBe('permanent_delete');\n      expect(auditLogEntry.cascade_count).toBeDefined();\n    });\n  });\n\n  describe('Referential Integrity', () => {\n    it('should check for references before deletion', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: [\n              { id: 'column-1', content_type: 'references', content_data: { references: [{ type: 'event', id: 'event-1' }] } },\n            ],\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Event is referenced by a column\n      // Should warn: \"This event is referenced by 1 content page\"\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should allow deletion with cascade to references', async () => {\n      // When deleting referenced entity, update or remove references\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'column-1',\n              content_data: { references: [] }, // References removed\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should detect broken references after deletion', async () => {\n      // Reference points to deleted entity\n      const reference = {\n        type: 'event',\n        id: 'event-1',\n      };\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'No rows returned' },\n            }),\n          }),\n        }),\n      } as any);\n\n      // Reference is broken\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should provide broken reference report', async () => {\n      const brokenReferences = [\n        { page: 'Our Story', section: 'Section 1', reference: 'Event: Wedding Ceremony (deleted)' },\n        { page: 'Activities', section: 'Section 2', reference: 'Activity: Volleyball (deleted)' },\n      ];\n\n      expect(brokenReferences.length).toBe(2);\n      expect(brokenReferences[0].reference).toContain('deleted');\n    });\n\n    it('should allow admin to fix broken references', async () => {\n      // Admin can remove or replace broken references\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: {\n              id: 'column-1',\n              content_data: { references: [] }, // Broken reference removed\n            },\n            error: null,\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n  });\n\n  describe('Deleted Items Manager', () => {\n    it('should list all soft-deleted items', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          not: jest.fn().mockReturnValue({\n            is: jest.fn().mockReturnValue({\n              order: jest.fn().mockResolvedValue({\n                data: [\n                  { id: 'page-1', title: 'Page 1', deleted_at: '2024-01-15T10:00:00Z', entity_type: 'content_page' },\n                  { id: 'event-1', name: 'Event 1', deleted_at: '2024-01-14T15:30:00Z', entity_type: 'event' },\n                ],\n                error: null,\n              }),\n            }),\n          }),\n        }),\n      } as any);\n\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should filter deleted items by entity type', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            not: jest.fn().mockReturnValue({\n              is: jest.fn().mockReturnValue({\n                order: jest.fn().mockResolvedValue({\n                  data: [\n                    { id: 'page-1', title: 'Page 1', deleted_at: '2024-01-15T10:00:00Z' },\n                    { id: 'page-2', title: 'Page 2', deleted_at: '2024-01-14T15:30:00Z' },\n                  ],\n                  error: null,\n                }),\n              }),\n            }),\n          }),\n        }),\n      } as any);\n\n      // Filter: entity_type = 'content_page'\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should search deleted items by name', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          ilike: jest.fn().mockReturnValue({\n            not: jest.fn().mockReturnValue({\n              is: jest.fn().mockReturnValue({\n                order: jest.fn().mockResolvedValue({\n                  data: [\n                    { id: 'page-1', title: 'Wedding Story', deleted_at: '2024-01-15T10:00:00Z' },\n                  ],\n                  error: null,\n                }),\n              }),\n            }),\n          }),\n        }),\n      } as any);\n\n      // Search: title ILIKE '%wedding%'\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should display deletion date and time', async () => {\n      const deletedItem = {\n        id: 'page-1',\n        title: 'Our Story',\n        deleted_at: '2024-01-15T10:30:00Z',\n      };\n\n      const deletedDate = new Date(deletedItem.deleted_at);\n      expect(deletedDate.toISOString()).toBe('2024-01-15T10:30:00.000Z');\n    });\n\n    it('should display days until permanent deletion', async () => {\n      const deletedAt = new Date('2024-01-15T10:00:00Z');\n      const now = new Date('2024-01-20T10:00:00Z');\n      const daysElapsed = Math.floor((now.getTime() - deletedAt.getTime()) / (1000 * 60 * 60 * 24));\n      const daysRemaining = 30 - daysElapsed;\n\n      expect(daysRemaining).toBe(25);\n    });\n  });\n\n  describe('Scheduled Cleanup', () => {\n    it('should permanently delete items older than 30 days', async () => {\n      const thirtyOneDaysAgo = new Date(Date.now() - 31 * 24 * 60 * 60 * 1000);\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          not: jest.fn().mockReturnValue({\n            is: jest.fn().mockReturnValue({\n              lt: jest.fn().mockResolvedValue({\n                data: [\n                  { id: 'page-1', deleted_at: thirtyOneDaysAgo.toISOString() },\n                ],\n                error: null,\n              }),\n            }),\n          }),\n        }),\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: null,\n            error: null,\n          }),\n        }),\n      } as any);\n\n      // Items deleted > 30 days ago should be permanently deleted\n      expect(mockSupabase.from).toBeDefined();\n    });\n\n    it('should run cleanup job daily at 2 AM', async () => {\n      const cronSchedule = '0 2 * * *'; // 2 AM daily\n\n      expect(cronSchedule).toBe('0 2 * * *');\n    });\n\n    it('should log cleanup actions', async () => {\n      const cleanupLog = {\n        timestamp: new Date().toISOString(),\n        items_deleted: 5,\n        entity_types: ['content_page', 'event', 'activity'],\n      };\n\n      expect(cleanupLog.items_deleted).toBe(5);\n      expect(cleanupLog.entity_types.length).toBe(3);\n    });\n\n    it('should send notification after cleanup', async () => {\n      const notificationMessage = 'Cleanup completed: 5 items permanently deleted';\n\n      expect(notificationMessage).toContain('Cleanup completed');\n      expect(notificationMessage).toContain('5 items');\n    });\n\n    it('should handle cleanup errors gracefully', async () => {\n      mockSupabase.from.mockReturnValue({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            data: null,\n            error: { message: 'Database error' },\n          }),\n        }),\n      } as any);\n\n      // Error should be logged but not crash the job\n      expect(mockSupabase.from).toBeDefined();\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","createMockSupabaseClient","describe","mockSupabase","beforeEach","clearAllMocks","it","now","Date","from","mockReturnValue","update","eq","mockResolvedValue","data","id","title","deleted_at","toISOString","error","expect","toBeDefined","name","select","is","order","not","single","cascadeDepth","toBe","auditLogEntry","action","entity_type","entity_id","user_id","timestamp","delete","confirmationRequired","confirmationMessage","toContain","warningMessage","cascade_count","content_type","content_data","references","type","reference","message","brokenReferences","page","section","length","ilike","deletedItem","deletedDate","deletedAt","daysElapsed","Math","floor","getTime","daysRemaining","thirtyOneDaysAgo","lt","cronSchedule","cleanupLog","items_deleted","entity_types","notificationMessage"],"mappings":"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"}