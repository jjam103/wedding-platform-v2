{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/EmailComposer.test.tsx"],"sourcesContent":["/**\n * Unit Tests for EmailComposer Component\n * \n * Tests:\n * - Modal display and closing\n * - Data loading (guests, groups, templates)\n * - Form submission\n * - Template selection\n * - Recipient selection\n * - Email preview\n * - Error handling\n * \n * Requirements: Email composer functionality\n */\n\nimport { render, screen, fireEvent, waitFor, cleanup } from '@testing-library/react';\nimport { EmailComposer } from './EmailComposer';\n\n// Mock toast context\nconst mockAddToast = jest.fn();\njest.mock('@/components/ui/ToastContext', () => ({\n  useToast: () => ({ addToast: mockAddToast }),\n}));\n\n// Mock fetch\nglobal.fetch = jest.fn();\n\nconst mockGuests = [\n  { id: '1', first_name: 'John', last_name: 'Doe', email: 'john@example.com' },\n  { id: '2', first_name: 'Jane', last_name: 'Smith', email: 'jane@example.com' },\n  { id: '3', first_name: 'Bob', last_name: 'Wilson', email: null },\n];\n\nconst mockGroups = [\n  { id: '1', name: 'Family' },\n  { id: '2', name: 'Friends' },\n];\n\nconst mockTemplates = [\n  { id: '1', name: 'RSVP Reminder', subject: 'Please RSVP', body_html: '<p>Please respond by...</p>' },\n  { id: '2', name: 'Welcome Email', subject: 'Welcome!', body_html: '<p>Welcome to our wedding...</p>' },\n];\n\ndescribe('EmailComposer', () => {\n  const mockFetch = fetch as jest.MockedFunction<typeof fetch>;\n  let mockOnClose: jest.Mock;\n  let mockOnSuccess: jest.Mock;\n\n  beforeEach(() => {\n    mockOnClose = jest.fn();\n    mockOnSuccess = jest.fn();\n    mockAddToast.mockClear();\n    mockFetch.mockClear();\n    \n    // Default successful responses - match actual API structure\n    mockFetch\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ success: true, data: { guests: mockGuests } }),\n      } as Response)\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ success: true, data: mockGroups }),\n      } as Response)\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ success: true, data: mockTemplates }),\n      } as Response);\n  });\n\n  afterEach(() => {\n    cleanup();\n  });\n\n  describe('Modal Display', () => {\n    it('should not render when isOpen is false', () => {\n      render(\n        <EmailComposer\n          isOpen={false}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      expect(screen.queryByText('Compose Email')).not.toBeInTheDocument();\n    });\n\n    it('should render when isOpen is true', () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      expect(screen.getByText('Compose Email')).toBeInTheDocument();\n    });\n\n    it('should call onClose when close button is clicked', () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      const closeButton = screen.getByLabelText('Close');\n      fireEvent.click(closeButton);\n\n      expect(mockOnClose).toHaveBeenCalled();\n    });\n\n    it('should call onClose when cancel button is clicked', async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n\n      const cancelButton = screen.getByRole('button', { name: /cancel/i });\n      fireEvent.click(cancelButton);\n\n      expect(mockOnClose).toHaveBeenCalled();\n    });\n  });\n\n  describe('Data Loading', () => {\n    it('should show loading state initially', () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      expect(screen.getByText('Loading...')).toBeInTheDocument();\n    });\n\n    it('should fetch guests, groups, and templates on open', async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(mockFetch).toHaveBeenCalledWith('/api/admin/guests');\n        expect(mockFetch).toHaveBeenCalledWith('/api/admin/groups');\n        expect(mockFetch).toHaveBeenCalledWith('/api/admin/emails/templates');\n      });\n    });\n\n    it('should not fetch data when modal is closed', () => {\n      render(\n        <EmailComposer\n          isOpen={false}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      expect(mockFetch).not.toHaveBeenCalled();\n    });\n\n    it('should display loaded data', async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n\n      // Check templates are loaded\n      expect(screen.getByText('RSVP Reminder')).toBeInTheDocument();\n      expect(screen.getByText('Welcome Email')).toBeInTheDocument();\n\n      // Check guests are loaded (only those with emails) - guests are shown by default\n      expect(screen.getByText('John Doe (john@example.com)')).toBeInTheDocument();\n      expect(screen.getByText('Jane Smith (jane@example.com)')).toBeInTheDocument();\n      expect(screen.queryByText('Bob Wilson')).not.toBeInTheDocument(); // No email\n\n      // Switch to groups to check they're loaded\n      const groupRadio = screen.getByLabelText('Guest Groups');\n      fireEvent.click(groupRadio);\n\n      // Check groups are loaded\n      expect(screen.getByText('Family')).toBeInTheDocument();\n      expect(screen.getByText('Friends')).toBeInTheDocument();\n    });\n\n    it('should handle fetch errors gracefully', async () => {\n      // Clear previous mocks and set up error\n      mockFetch.mockClear();\n      mockFetch.mockRejectedValue(new Error('Network error'));\n\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(mockAddToast).toHaveBeenCalledWith({\n          type: 'error',\n          message: 'Failed to load data',\n        });\n      }, { timeout: 2000 });\n    });\n  });\n\n  describe('Template Selection', () => {\n    it('should populate subject and body when template is selected', async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n\n      const templateSelect = screen.getByLabelText(/email template/i);\n      fireEvent.change(templateSelect, { target: { value: '1' } });\n\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      expect(subjectInput).toHaveValue('Please RSVP');\n      expect(bodyTextarea).toHaveValue('<p>Please respond by...</p>');\n    });\n\n    it('should clear subject and body when no template is selected', async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n\n      const templateSelect = screen.getByLabelText(/email template/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      // Select template first\n      fireEvent.change(templateSelect, { target: { value: '1' } });\n      expect(subjectInput).toHaveValue('Please RSVP');\n\n      // Clear template\n      fireEvent.change(templateSelect, { target: { value: '' } });\n      expect(subjectInput).toHaveValue('');\n      expect(bodyTextarea).toHaveValue('');\n    });\n  });\n\n  describe('Recipient Selection', () => {\n    it('should switch between guest and group recipient types', async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n\n      // Initially guests should be selected\n      const guestRadio = screen.getByLabelText('Individual Guests');\n      const groupRadio = screen.getByLabelText('Guest Groups');\n\n      expect(guestRadio).toBeChecked();\n      expect(screen.getByText('John Doe (john@example.com)')).toBeInTheDocument();\n\n      // Switch to groups\n      fireEvent.click(groupRadio);\n\n      expect(groupRadio).toBeChecked();\n      expect(screen.getByText('Family')).toBeInTheDocument();\n      expect(screen.queryByText('John Doe (john@example.com)')).not.toBeInTheDocument();\n    });\n\n    it('should clear selected recipients when switching types', async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const groupRadio = screen.getByLabelText('Guest Groups');\n\n      // Select a guest\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n\n      // Switch to groups\n      fireEvent.click(groupRadio);\n\n      // Recipients should be cleared\n      expect(recipientSelect.selectedOptions.length).toBe(0);\n    });\n  });\n\n  describe('Form Validation', () => {\n    beforeEach(async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n    });\n\n    it('should validate that recipients are selected', async () => {\n      const sendButton = screen.getByRole('button', { name: /send email/i });\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        expect(mockAddToast).toHaveBeenCalledWith({\n          type: 'error',\n          message: 'Please select at least one recipient',\n        });\n      });\n    });\n\n    it('should validate that subject is entered', async () => {\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n\n      const sendButton = screen.getByRole('button', { name: /send email/i });\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        expect(mockAddToast).toHaveBeenCalledWith({\n          type: 'error',\n          message: 'Please enter a subject',\n        });\n      });\n    });\n\n    it('should validate that body is entered', async () => {\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n      fireEvent.change(subjectInput, { target: { value: 'Test Subject' } });\n\n      const sendButton = screen.getByRole('button', { name: /send email/i });\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        expect(mockAddToast).toHaveBeenCalledWith({\n          type: 'error',\n          message: 'Please enter email body',\n        });\n      });\n    });\n\n    it('should validate that selected recipients have email addresses', async () => {\n      // This test is not applicable because the component filters out guests without emails\n      // from the selection list, so it's impossible to select a guest without an email.\n      // Instead, we'll test that guests without emails are not shown in the list.\n      \n      // Mock guests with mixed email status\n      mockFetch.mockClear();\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ \n            success: true, \n            data: { \n              guests: [\n                { id: '1', first_name: 'John', last_name: 'Doe', email: 'john@example.com' },\n                { id: '2', first_name: 'Jane', last_name: 'Smith', email: null }\n              ] \n            } \n          }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockGroups }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockTemplates }),\n        } as Response);\n\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n\n      // John should be in the list (has email)\n      expect(screen.getByText('John Doe (john@example.com)')).toBeInTheDocument();\n      \n      // Jane should NOT be in the list (no email)\n      expect(screen.queryByText(/Jane Smith/)).not.toBeInTheDocument();\n    });\n  });\n\n  describe('Email Sending', () => {\n    beforeEach(async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n    });\n\n    it('should send email successfully', async () => {\n      // Mock the send email API call\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ success: true }),\n      } as Response);\n\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      fireEvent.change(recipientSelect, { target: { value: ['1', '2'] } });\n      fireEvent.change(subjectInput, { target: { value: 'Test Subject' } });\n      fireEvent.change(bodyTextarea, { target: { value: '<p>Test Body</p>' } });\n\n      const sendButtons = screen.getAllByRole('button', { name: /send email/i });\n      const sendButton = sendButtons[sendButtons.length - 1]; // Get the actual send button, not preview\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        // Check the 4th fetch call (after guests, groups, templates)\n        const sendCall = mockFetch.mock.calls.find(call => \n          call[0] === '/api/admin/emails/send'\n        );\n        expect(sendCall).toBeDefined();\n        expect(sendCall![1]).toMatchObject({\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n        });\n        \n        const body = JSON.parse(sendCall![1]!.body as string);\n        expect(body.recipients).toEqual(['john@example.com', 'jane@example.com']);\n        expect(body.subject).toBe('Test Subject');\n        expect(body.html).toBe('<p>Test Body</p>');\n      });\n\n      await waitFor(() => {\n        expect(mockAddToast).toHaveBeenCalledWith({\n          type: 'success',\n          message: 'Email sent to 2 recipient(s)',\n        });\n      });\n\n      expect(mockOnSuccess).toHaveBeenCalled();\n      expect(mockOnClose).toHaveBeenCalled();\n    });\n\n    it('should include template ID when template is selected', async () => {\n      // Mock the send email API call\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ success: true }),\n      } as Response);\n\n      const templateSelect = screen.getByLabelText(/email template/i);\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n\n      fireEvent.change(templateSelect, { target: { value: '1' } });\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n\n      const sendButtons = screen.getAllByRole('button', { name: /send email/i });\n      const sendButton = sendButtons[sendButtons.length - 1];\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        const sendCall = mockFetch.mock.calls.find(call => \n          call[0] === '/api/admin/emails/send'\n        );\n        expect(sendCall).toBeDefined();\n        \n        const body = JSON.parse(sendCall![1]!.body as string);\n        expect(body.recipients).toEqual(['john@example.com']);\n        expect(body.subject).toBe('Please RSVP');\n        expect(body.html).toBe('<p>Please respond by...</p>');\n        expect(body.template_id).toBe('1');\n      });\n    });\n\n    it('should handle send errors', async () => {\n      // Mock the send email API call with error\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ success: false, error: { message: 'Send failed' } }),\n      } as Response);\n\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n      fireEvent.change(subjectInput, { target: { value: 'Test Subject' } });\n      fireEvent.change(bodyTextarea, { target: { value: 'Test Body' } });\n\n      const sendButtons = screen.getAllByRole('button', { name: /send email/i });\n      const sendButton = sendButtons[sendButtons.length - 1];\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        expect(mockAddToast).toHaveBeenCalledWith({\n          type: 'error',\n          message: 'Send failed',\n        });\n      });\n\n      expect(mockOnSuccess).not.toHaveBeenCalled();\n      expect(mockOnClose).not.toHaveBeenCalled();\n    });\n\n    it('should handle network errors', async () => {\n      // Mock network error\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n      fireEvent.change(subjectInput, { target: { value: 'Test Subject' } });\n      fireEvent.change(bodyTextarea, { target: { value: 'Test Body' } });\n\n      const sendButtons = screen.getAllByRole('button', { name: /send email/i });\n      const sendButton = sendButtons[sendButtons.length - 1];\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        expect(mockAddToast).toHaveBeenCalledWith({\n          type: 'error',\n          message: 'Failed to send email',\n        });\n      });\n    });\n  });\n\n  describe('Email Preview', () => {\n    beforeEach(async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n    });\n\n    it('should show preview when preview button is clicked', () => {\n      const previewButton = screen.getByRole('button', { name: /show preview/i });\n      fireEvent.click(previewButton);\n\n      expect(screen.getByText('Preview')).toBeInTheDocument();\n      expect(screen.getByRole('button', { name: /hide preview/i })).toBeInTheDocument();\n    });\n\n    it('should hide preview when hide button is clicked', () => {\n      const previewButton = screen.getByRole('button', { name: /show preview/i });\n      fireEvent.click(previewButton);\n\n      const hideButton = screen.getByRole('button', { name: /hide preview/i });\n      fireEvent.click(hideButton);\n\n      expect(screen.queryByText('Preview')).not.toBeInTheDocument();\n      expect(screen.getByRole('button', { name: /show preview/i })).toBeInTheDocument();\n    });\n\n    it('should display preview content', async () => {\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      fireEvent.change(recipientSelect, { target: { value: ['1', '2'] } });\n      fireEvent.change(subjectInput, { target: { value: 'Test Subject' } });\n      fireEvent.change(bodyTextarea, { target: { value: '<p>Test Body</p>' } });\n\n      const previewButton = screen.getByRole('button', { name: /show preview/i });\n      fireEvent.click(previewButton);\n\n      expect(screen.getByText('Subject:')).toBeInTheDocument();\n      expect(screen.getByText('Test Subject')).toBeInTheDocument();\n      expect(screen.getByText('To:')).toBeInTheDocument();\n      expect(screen.getByText('2 recipient(s)')).toBeInTheDocument();\n    });\n  });\n\n  describe('Loading States', () => {\n    beforeEach(async () => {\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      });\n    });\n\n    it('should disable buttons during submission', async () => {\n      // Mock a slow send operation\n      let resolvePromise: any;\n      const slowSend = new Promise((resolve) => {\n        resolvePromise = resolve;\n      });\n      mockFetch.mockReturnValueOnce(slowSend as any);\n\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n      fireEvent.change(subjectInput, { target: { value: 'Test Subject' } });\n      fireEvent.change(bodyTextarea, { target: { value: 'Test Body' } });\n\n      const sendButtons = screen.getAllByRole('button', { name: /send email/i });\n      const sendButton = sendButtons[sendButtons.length - 1];\n      const cancelButton = screen.getByRole('button', { name: /cancel/i });\n      const previewButton = screen.getByRole('button', { name: /show preview/i });\n\n      fireEvent.click(sendButton);\n\n      // Wait a bit for state to update\n      await waitFor(() => {\n        expect(sendButton).toBeDisabled();\n      });\n      \n      expect(cancelButton).toBeDisabled();\n      expect(previewButton).toBeDisabled();\n\n      // Resolve the promise to clean up\n      resolvePromise({ ok: true, json: async () => ({ success: true }) });\n    });\n\n    it('should show sending text during submission', async () => {\n      // Mock a slow send operation\n      let resolvePromise: any;\n      const slowSend = new Promise((resolve) => {\n        resolvePromise = resolve;\n      });\n      mockFetch.mockReturnValueOnce(slowSend as any);\n\n      const recipientSelect = screen.getByLabelText(/recipients/i);\n      const subjectInput = screen.getByLabelText(/subject/i);\n      const bodyTextarea = screen.getByLabelText(/email body/i);\n\n      fireEvent.change(recipientSelect, { target: { value: ['1'] } });\n      fireEvent.change(subjectInput, { target: { value: 'Test Subject' } });\n      fireEvent.change(bodyTextarea, { target: { value: 'Test Body' } });\n\n      const sendButtons = screen.getAllByRole('button', { name: /send email/i });\n      const sendButton = sendButtons[sendButtons.length - 1];\n      fireEvent.click(sendButton);\n\n      await waitFor(() => {\n        expect(screen.getByText('Sending...')).toBeInTheDocument();\n      });\n\n      // Resolve the promise to clean up\n      resolvePromise({ ok: true, json: async () => ({ success: true }) });\n    });\n  });\n\n  describe('Accessibility', () => {\n    it('should have proper form labels', async () => {\n      // Clear and set up fresh mocks\n      mockFetch.mockClear();\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: { guests: mockGuests } }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockGroups }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockTemplates }),\n        } as Response);\n\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      expect(screen.getByLabelText(/email template/i)).toBeInTheDocument();\n      expect(screen.getByLabelText(/recipients/i)).toBeInTheDocument();\n      expect(screen.getByLabelText(/subject/i)).toBeInTheDocument();\n      expect(screen.getByLabelText(/email body/i)).toBeInTheDocument();\n    });\n\n    it('should have required attributes on required fields', async () => {\n      mockFetch.mockClear();\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: { guests: mockGuests } }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockGroups }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockTemplates }),\n        } as Response);\n\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      expect(screen.getByLabelText(/recipients/i)).toHaveAttribute('required');\n      expect(screen.getByLabelText(/subject/i)).toHaveAttribute('required');\n      expect(screen.getByLabelText(/email body/i)).toHaveAttribute('required');\n    });\n\n    it('should have proper close button accessibility', async () => {\n      mockFetch.mockClear();\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: { guests: mockGuests } }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockGroups }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockTemplates }),\n        } as Response);\n\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      const closeButton = screen.getByLabelText('Close');\n      expect(closeButton).toBeInTheDocument();\n    });\n\n    it('should provide help text for recipients field', async () => {\n      mockFetch.mockClear();\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: { guests: mockGuests } }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockGroups }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockTemplates }),\n        } as Response);\n\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      expect(screen.getByText('Hold Ctrl/Cmd to select multiple recipients')).toBeInTheDocument();\n    });\n\n    it('should provide help text for email body', async () => {\n      mockFetch.mockClear();\n      mockFetch\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: { guests: mockGuests } }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockGroups }),\n        } as Response)\n        .mockResolvedValueOnce({\n          ok: true,\n          json: async () => ({ success: true, data: mockTemplates }),\n        } as Response);\n\n      render(\n        <EmailComposer\n          isOpen={true}\n          onClose={mockOnClose}\n          onSuccess={mockOnSuccess}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      expect(screen.getByText(/HTML tags are supported/)).toBeInTheDocument();\n    });\n  });\n});"],"names":["jest","mock","useToast","addToast","mockAddToast","fn","global","fetch","mockGuests","id","first_name","last_name","email","mockGroups","name","mockTemplates","subject","body_html","describe","mockFetch","mockOnClose","mockOnSuccess","beforeEach","mockClear","mockResolvedValueOnce","ok","json","success","data","guests","afterEach","cleanup","it","render","EmailComposer","isOpen","onClose","onSuccess","expect","screen","queryByText","not","toBeInTheDocument","getByText","closeButton","getByLabelText","fireEvent","click","toHaveBeenCalled","waitFor","cancelButton","getByRole","toHaveBeenCalledWith","groupRadio","mockRejectedValue","Error","type","message","timeout","templateSelect","change","target","value","subjectInput","bodyTextarea","toHaveValue","guestRadio","toBeChecked","recipientSelect","selectedOptions","length","toBe","sendButton","sendButtons","getAllByRole","sendCall","calls","find","call","toBeDefined","toMatchObject","method","headers","body","JSON","parse","recipients","toEqual","html","template_id","error","mockRejectedValueOnce","previewButton","hideButton","resolvePromise","slowSend","Promise","resolve","mockReturnValueOnce","toBeDisabled","toHaveAttribute"],"mappings":"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"}