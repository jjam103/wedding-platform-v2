{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/RichTextEditor.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport dynamic from 'next/dynamic';\nimport { sanitizeRichText } from '@/utils/sanitization';\n\n// Lazy load PhotoPicker\nconst PhotoPicker = dynamic(() => import('./PhotoPicker').then(mod => ({ default: mod.PhotoPicker })), {\n  ssr: false,\n});\n\ninterface RichTextEditorProps {\n  value: string;\n  onChange: (html: string) => void;\n  placeholder?: string;\n  className?: string;\n  disabled?: boolean;\n  pageType?: 'event' | 'activity' | 'accommodation' | 'memory';\n  pageId?: string;\n}\n\ninterface SlashCommand {\n  label: string;\n  command: string;\n  action: () => void;\n  description: string;\n}\n\n/**\n * RichTextEditor component with formatting toolbar and slash commands\n * \n * Features:\n * - Formatting toolbar (bold, italic, underline, links, lists)\n * - Slash commands (/heading, /list, /table, /image, /link, /divider)\n * - Table support with inline editing\n * - Content sanitization for security\n * - Keyboard shortcuts\n * - Debounced onChange for performance\n */\nexport function RichTextEditor({\n  value,\n  onChange,\n  placeholder = 'Start typing or use / for commands...',\n  className = '',\n  disabled = false,\n  pageType,\n  pageId,\n}: RichTextEditorProps) {\n  const editorRef = useRef<HTMLDivElement>(null);\n  const debounceTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const [showSlashMenu, setShowSlashMenu] = useState(false);\n  const [slashMenuPosition, setSlashMenuPosition] = useState({ top: 0, left: 0 });\n  const [slashFilter, setSlashFilter] = useState('');\n  const [selectedCommandIndex, setSelectedCommandIndex] = useState(0);\n  const [showLinkDialog, setShowLinkDialog] = useState(false);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [linkText, setLinkText] = useState('');\n  const [showImagePicker, setShowImagePicker] = useState(false);\n  const [selectedImageIds, setSelectedImageIds] = useState<string[]>([]);\n\n  // Initialize editor content\n  useEffect(() => {\n    if (editorRef.current && editorRef.current.innerHTML !== value) {\n      editorRef.current.innerHTML = value || '';\n    }\n  }, [value]);\n\n  // Cleanup debounce timer on unmount\n  useEffect(() => {\n    return () => {\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n    };\n  }, []);\n\n  // Execute formatting command\n  const execCommand = useCallback((command: string, value?: string) => {\n    document.execCommand(command, false, value);\n    editorRef.current?.focus();\n  }, []);\n\n  // Handle content change with debouncing\n  const handleInput = useCallback(() => {\n    if (!editorRef.current) return;\n    \n    const html = editorRef.current.innerHTML;\n    \n    // Clear existing timer\n    if (debounceTimerRef.current) {\n      clearTimeout(debounceTimerRef.current);\n    }\n    \n    // Debounce the onChange call to reduce re-renders\n    debounceTimerRef.current = setTimeout(() => {\n      const sanitized = sanitizeRichText(html);\n      onChange(sanitized);\n    }, 300); // 300ms debounce\n\n    // Check for slash command (no debounce for UI responsiveness)\n    const selection = window.getSelection();\n    if (selection && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      const textBeforeCursor = range.startContainer.textContent?.slice(0, range.startOffset) || '';\n      \n      // Check if last character is /\n      if (textBeforeCursor.endsWith('/')) {\n        const rect = range.getBoundingClientRect();\n        setSlashMenuPosition({\n          top: rect.bottom + window.scrollY,\n          left: rect.left + window.scrollX,\n        });\n        setSlashFilter('');\n        setShowSlashMenu(true);\n        setSelectedCommandIndex(0);\n      } else if (showSlashMenu) {\n        // Update filter if slash menu is open\n        const lastSlashIndex = textBeforeCursor.lastIndexOf('/');\n        if (lastSlashIndex !== -1) {\n          const filter = textBeforeCursor.slice(lastSlashIndex + 1);\n          setSlashFilter(filter.toLowerCase());\n        } else {\n          setShowSlashMenu(false);\n        }\n      }\n    }\n  }, [onChange, showSlashMenu]);\n\n  // Insert heading\n  const insertHeading = useCallback((level: 1 | 2 | 3) => {\n    execCommand('formatBlock', `h${level}`);\n    setShowSlashMenu(false);\n  }, [execCommand]);\n\n  // Insert list\n  const insertList = useCallback((ordered: boolean) => {\n    execCommand(ordered ? 'insertOrderedList' : 'insertUnorderedList');\n    setShowSlashMenu(false);\n  }, [execCommand]);\n\n  // Insert table\n  const insertTable = useCallback(() => {\n    const table = `\n      <table style=\"border-collapse: collapse; width: 100%; margin: 1em 0;\">\n        <tbody>\n          <tr>\n            <td style=\"border: 1px solid #ddd; padding: 8px;\">Cell 1</td>\n            <td style=\"border: 1px solid #ddd; padding: 8px;\">Cell 2</td>\n          </tr>\n          <tr>\n            <td style=\"border: 1px solid #ddd; padding: 8px;\">Cell 3</td>\n            <td style=\"border: 1px solid #ddd; padding: 8px;\">Cell 4</td>\n          </tr>\n        </tbody>\n      </table>\n    `;\n    execCommand('insertHTML', table);\n    setShowSlashMenu(false);\n  }, [execCommand]);\n\n  // Insert divider\n  const insertDivider = useCallback(() => {\n    execCommand('insertHTML', '<hr style=\"margin: 1em 0; border: none; border-top: 2px solid #ddd;\" />');\n    setShowSlashMenu(false);\n  }, [execCommand]);\n\n  // Show link dialog\n  const showLinkInput = useCallback(() => {\n    const selection = window.getSelection();\n    if (selection && selection.toString()) {\n      setLinkText(selection.toString());\n    }\n    setShowLinkDialog(true);\n    setShowSlashMenu(false);\n  }, []);\n\n  // Insert link\n  const insertLink = useCallback(() => {\n    if (!linkUrl) return;\n    \n    const url = linkUrl.startsWith('http') ? linkUrl : `https://${linkUrl}`;\n    \n    if (linkText) {\n      execCommand('insertHTML', `<a href=\"${url}\" target=\"_blank\" rel=\"noopener noreferrer\">${linkText}</a>`);\n    } else {\n      execCommand('createLink', url);\n    }\n    \n    setShowLinkDialog(false);\n    setLinkUrl('');\n    setLinkText('');\n  }, [linkUrl, linkText, execCommand]);\n\n  // Insert image\n  const insertImage = useCallback(() => {\n    setShowImagePicker(true);\n    setShowSlashMenu(false);\n  }, []);\n  \n  // Insert selected images\n  const handleInsertImages = useCallback(async () => {\n    if (selectedImageIds.length === 0) return;\n    \n    // Fetch photo URLs from API\n    try {\n      const photoPromises = selectedImageIds.map(id =>\n        fetch(`/api/admin/photos/${id}`).then(r => r.json())\n      );\n      const results = await Promise.all(photoPromises);\n      \n      const imagesHtml = results\n        .filter(r => r.success)\n        .map(r => `<img src=\"${r.data.photo_url}\" alt=\"${r.data.alt_text || r.data.caption || 'Image'}\" style=\"max-width: 100%; height: auto; margin: 0.5em 0;\" />`)\n        .join('');\n      \n      if (imagesHtml) {\n        execCommand('insertHTML', imagesHtml);\n      }\n    } catch (error) {\n      console.error('Failed to insert images:', error);\n    }\n    \n    setShowImagePicker(false);\n    setSelectedImageIds([]);\n  }, [selectedImageIds, execCommand]);\n\n  // Slash commands\n  const slashCommands: SlashCommand[] = [\n    {\n      label: 'Heading 1',\n      command: '/heading1',\n      action: () => insertHeading(1),\n      description: 'Large heading',\n    },\n    {\n      label: 'Heading 2',\n      command: '/heading2',\n      action: () => insertHeading(2),\n      description: 'Medium heading',\n    },\n    {\n      label: 'Heading 3',\n      command: '/heading3',\n      action: () => insertHeading(3),\n      description: 'Small heading',\n    },\n    {\n      label: 'Bullet List',\n      command: '/list',\n      action: () => insertList(false),\n      description: 'Create a bullet list',\n    },\n    {\n      label: 'Numbered List',\n      command: '/numbered',\n      action: () => insertList(true),\n      description: 'Create a numbered list',\n    },\n    {\n      label: 'Table',\n      command: '/table',\n      action: insertTable,\n      description: 'Insert a 2x2 table',\n    },\n    {\n      label: 'Link',\n      command: '/link',\n      action: showLinkInput,\n      description: 'Insert a link',\n    },\n    {\n      label: 'Image',\n      command: '/image',\n      action: insertImage,\n      description: 'Insert an image',\n    },\n    {\n      label: 'Divider',\n      command: '/divider',\n      action: insertDivider,\n      description: 'Insert a horizontal divider',\n    },\n  ];\n\n  // Filter slash commands\n  const filteredCommands = slashCommands.filter(cmd =>\n    cmd.label.toLowerCase().includes(slashFilter) ||\n    cmd.command.toLowerCase().includes(slashFilter)\n  );\n\n  // Handle keyboard shortcuts\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      // Slash menu navigation\n      if (showSlashMenu) {\n        if (e.key === 'ArrowDown') {\n          e.preventDefault();\n          setSelectedCommandIndex(prev =>\n            prev < filteredCommands.length - 1 ? prev + 1 : 0\n          );\n        } else if (e.key === 'ArrowUp') {\n          e.preventDefault();\n          setSelectedCommandIndex(prev =>\n            prev > 0 ? prev - 1 : filteredCommands.length - 1\n          );\n        } else if (e.key === 'Enter') {\n          e.preventDefault();\n          if (filteredCommands[selectedCommandIndex]) {\n            // Remove the slash command text\n            const selection = window.getSelection();\n            if (selection && selection.rangeCount > 0) {\n              const range = selection.getRangeAt(0);\n              const textNode = range.startContainer;\n              if (textNode.nodeType === Node.TEXT_NODE && textNode.textContent) {\n                const lastSlashIndex = textNode.textContent.lastIndexOf('/');\n                if (lastSlashIndex !== -1) {\n                  const newRange = document.createRange();\n                  newRange.setStart(textNode, lastSlashIndex);\n                  newRange.setEnd(textNode, range.startOffset);\n                  newRange.deleteContents();\n                }\n              }\n            }\n            filteredCommands[selectedCommandIndex].action();\n          }\n        } else if (e.key === 'Escape') {\n          e.preventDefault();\n          setShowSlashMenu(false);\n        }\n        return;\n      }\n\n      // Keyboard shortcuts\n      if (e.ctrlKey || e.metaKey) {\n        switch (e.key.toLowerCase()) {\n          case 'b':\n            e.preventDefault();\n            execCommand('bold');\n            break;\n          case 'i':\n            e.preventDefault();\n            execCommand('italic');\n            break;\n          case 'u':\n            e.preventDefault();\n            execCommand('underline');\n            break;\n          case 'k':\n            e.preventDefault();\n            showLinkInput();\n            break;\n        }\n      }\n    },\n    [showSlashMenu, filteredCommands, selectedCommandIndex, execCommand, showLinkInput]\n  );\n\n  // Close slash menu on click outside\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (showSlashMenu && editorRef.current && !editorRef.current.contains(e.target as Node)) {\n        setShowSlashMenu(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [showSlashMenu]);\n\n  return (\n    <div className={`relative ${className}`}>\n      {/* Toolbar */}\n      <div className=\"flex items-center gap-1 p-2 border border-gray-300 rounded-t-md bg-gray-50\">\n        <button\n          type=\"button\"\n          onClick={() => execCommand('bold')}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Bold (Ctrl+B)\"\n          aria-label=\"Bold\"\n        >\n          <strong>B</strong>\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => execCommand('italic')}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Italic (Ctrl+I)\"\n          aria-label=\"Italic\"\n        >\n          <em>I</em>\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => execCommand('underline')}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Underline (Ctrl+U)\"\n          aria-label=\"Underline\"\n        >\n          <u>U</u>\n        </button>\n        <div className=\"w-px h-6 bg-gray-300 mx-1\" />\n        <button\n          type=\"button\"\n          onClick={() => insertList(false)}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Bullet List\"\n          aria-label=\"Bullet list\"\n        >\n          ‚Ä¢\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => insertList(true)}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Numbered List\"\n          aria-label=\"Numbered list\"\n        >\n          1.\n        </button>\n        <div className=\"w-px h-6 bg-gray-300 mx-1\" />\n        <button\n          type=\"button\"\n          onClick={insertImage}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Insert Image\"\n          aria-label=\"Insert image\"\n        >\n          üñºÔ∏è\n        </button>\n        <button\n          type=\"button\"\n          onClick={showLinkInput}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Insert Link (Ctrl+K)\"\n          aria-label=\"Insert link\"\n        >\n          üîó\n        </button>\n        <button\n          type=\"button\"\n          onClick={insertTable}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Insert Table\"\n          aria-label=\"Insert table\"\n        >\n          ‚äû\n        </button>\n        <button\n          type=\"button\"\n          onClick={insertDivider}\n          disabled={disabled}\n          className=\"p-2 text-gray-700 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Insert Divider\"\n          aria-label=\"Insert divider\"\n        >\n          ‚Äï\n        </button>\n      </div>\n\n      {/* Editor */}\n      <div\n        ref={editorRef}\n        contentEditable={!disabled}\n        onInput={handleInput}\n        onKeyDown={handleKeyDown}\n        className={`min-h-[200px] p-4 border border-t-0 border-gray-300 rounded-b-md focus:outline-none focus:ring-2 focus:ring-blue-500 prose prose-sm max-w-none ${\n          disabled ? 'bg-gray-100 cursor-not-allowed' : 'bg-white'\n        } ${!value && 'empty-editor'}`}\n        data-placeholder={placeholder}\n        aria-label=\"Rich text editor\"\n        role=\"textbox\"\n        aria-multiline=\"true\"\n      />\n\n      {/* Slash command menu */}\n      {showSlashMenu && filteredCommands.length > 0 && (\n        <div\n          className=\"absolute z-50 w-64 bg-white border border-gray-300 rounded-md shadow-lg max-h-64 overflow-y-auto\"\n          style={{\n            top: slashMenuPosition.top,\n            left: slashMenuPosition.left,\n          }}\n          role=\"menu\"\n          aria-label=\"Slash commands\"\n        >\n          {filteredCommands.map((cmd, index) => (\n            <button\n              key={cmd.command}\n              type=\"button\"\n              onClick={() => {\n                // Remove the slash command text\n                const selection = window.getSelection();\n                if (selection && selection.rangeCount > 0) {\n                  const range = selection.getRangeAt(0);\n                  const textNode = range.startContainer;\n                  if (textNode.nodeType === Node.TEXT_NODE && textNode.textContent) {\n                    const lastSlashIndex = textNode.textContent.lastIndexOf('/');\n                    if (lastSlashIndex !== -1) {\n                      const newRange = document.createRange();\n                      newRange.setStart(textNode, lastSlashIndex);\n                      newRange.setEnd(textNode, range.startOffset);\n                      newRange.deleteContents();\n                    }\n                  }\n                }\n                cmd.action();\n              }}\n              className={`w-full text-left px-4 py-2 hover:bg-gray-100 ${\n                index === selectedCommandIndex ? 'bg-blue-50' : ''\n              }`}\n              role=\"menuitem\"\n            >\n              <div className=\"font-medium text-sm text-gray-900\">{cmd.label}</div>\n              <div className=\"text-xs text-gray-500\">{cmd.description}</div>\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Link dialog */}\n      {showLinkDialog && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\"\n          onClick={() => setShowLinkDialog(false)}\n        >\n          <div\n            className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-md\"\n            onClick={e => e.stopPropagation()}\n          >\n            <h3 className=\"text-lg font-semibold mb-4\">Insert Link</h3>\n            <div className=\"space-y-4\">\n              <div>\n                <label htmlFor=\"link-text\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Link Text\n                </label>\n                <input\n                  id=\"link-text\"\n                  type=\"text\"\n                  value={linkText}\n                  onChange={e => setLinkText(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Enter link text\"\n                />\n              </div>\n              <div>\n                <label htmlFor=\"link-url\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  URL\n                </label>\n                <input\n                  id=\"link-url\"\n                  type=\"url\"\n                  value={linkUrl}\n                  onChange={e => setLinkUrl(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"https://example.com\"\n                  autoFocus\n                />\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowLinkDialog(false);\n                    setLinkUrl('');\n                    setLinkText('');\n                  }}\n                  className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={insertLink}\n                  disabled={!linkUrl}\n                  className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Insert\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Image picker dialog */}\n      {showImagePicker && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\"\n          onClick={() => {\n            setShowImagePicker(false);\n            setSelectedImageIds([]);\n          }}\n        >\n          <div\n            className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\"\n            onClick={e => e.stopPropagation()}\n          >\n            <h3 className=\"text-lg font-semibold mb-4\">Insert Images</h3>\n            <div className=\"flex-1 overflow-auto\">\n              <PhotoPicker\n                selectedPhotoIds={selectedImageIds}\n                onSelectionChange={setSelectedImageIds}\n                pageType={pageType || 'memory'}\n                pageId={pageId}\n                disabled={false}\n              />\n            </div>\n            <div className=\"flex justify-end gap-2 mt-4 pt-4 border-t border-gray-200\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setShowImagePicker(false);\n                  setSelectedImageIds([]);\n                }}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleInsertImages}\n                disabled={selectedImageIds.length === 0}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                Insert {selectedImageIds.length > 0 ? `(${selectedImageIds.length})` : ''}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["RichTextEditor","PhotoPicker","dynamic","then","mod","default","ssr","value","onChange","placeholder","className","disabled","pageType","pageId","editorRef","useRef","debounceTimerRef","showSlashMenu","setShowSlashMenu","useState","slashMenuPosition","setSlashMenuPosition","top","left","slashFilter","setSlashFilter","selectedCommandIndex","setSelectedCommandIndex","showLinkDialog","setShowLinkDialog","linkUrl","setLinkUrl","linkText","setLinkText","showImagePicker","setShowImagePicker","selectedImageIds","setSelectedImageIds","useEffect","current","innerHTML","clearTimeout","execCommand","useCallback","command","document","focus","handleInput","html","setTimeout","sanitized","sanitizeRichText","selection","window","getSelection","rangeCount","range","getRangeAt","textBeforeCursor","startContainer","textContent","slice","startOffset","endsWith","rect","getBoundingClientRect","bottom","scrollY","scrollX","lastSlashIndex","lastIndexOf","filter","toLowerCase","insertHeading","level","insertList","ordered","insertTable","table","insertDivider","showLinkInput","toString","insertLink","url","startsWith","insertImage","handleInsertImages","length","photoPromises","map","id","fetch","r","json","results","Promise","all","imagesHtml","success","data","photo_url","alt_text","caption","join","error","console","slashCommands","label","action","description","filteredCommands","cmd","includes","handleKeyDown","e","key","preventDefault","prev","textNode","nodeType","Node","TEXT_NODE","newRange","createRange","setStart","setEnd","deleteContents","ctrlKey","metaKey","handleClickOutside","contains","target","addEventListener","removeEventListener","div","button","type","onClick","title","aria-label","strong","em","u","ref","contentEditable","onInput","onKeyDown","data-placeholder","role","aria-multiline","style","index","stopPropagation","h3","htmlFor","input","autoFocus","selectedPhotoIds","onSelectionChange"],"mappings":"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"}