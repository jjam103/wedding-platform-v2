{"version":3,"names":["POST","request","params","cov_1279bqq533","f","s","id","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","adminUser","from","select","eq","user","single","result","_adminUserService","resendInvitation","statusCode","insert","user_id","action","entity_type","entity_id","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/admin-users/[id]/invite/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport * as adminUserService from '@/services/adminUserService';\n\n/**\n * POST /api/admin/admin-users/[id]/invite\n * Resend invitation email to admin user\n * \n * Requirements: 3.2\n */\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Await params for Next.js 15+\n    const { id } = await params;\n    \n    // 1. Check authentication\n    const supabase = createRouteHandlerClient({ cookies });\n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n        },\n        { status: 401 }\n      );\n    }\n\n    // 2. Check if user is an admin (any admin can resend invitations)\n    const { data: adminUser } = await supabase\n      .from('admin_users')\n      .select('role, status')\n      .eq('id', session.user.id)\n      .single();\n\n    if (!adminUser || adminUser.status !== 'active') {\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'FORBIDDEN', message: 'Admin access required' },\n        },\n        { status: 403 }\n      );\n    }\n\n    // 3. Resend invitation\n    const result = await adminUserService.resendInvitation(id);\n\n    if (!result.success) {\n      const statusCode = result.error.code === 'NOT_FOUND' ? 404 : 500;\n      return NextResponse.json(result, { status: statusCode });\n    }\n\n    // 4. Log audit entry\n    await supabase.from('audit_logs').insert({\n      user_id: session.user.id,\n      action: 'admin_user_invitation_resent',\n      entity_type: 'admin_user',\n      entity_id: id,\n    });\n\n    return NextResponse.json(result);\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}