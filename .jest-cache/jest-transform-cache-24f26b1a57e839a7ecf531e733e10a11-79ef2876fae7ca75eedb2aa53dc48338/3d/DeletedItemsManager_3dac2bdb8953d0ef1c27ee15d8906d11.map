{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/DeletedItemsManager.tsx"],"sourcesContent":["'use client';\n\n/**\n * Deleted Items Manager Component\n * \n * Displays list of soft-deleted items with restore and permanent delete actions.\n * Supports filtering by entity type and search functionality.\n */\n\nimport { useState, useEffect } from 'react';\nimport { DataTable } from '../ui/DataTable';\n\ninterface DeletedItem {\n  id: string;\n  type: 'content_page' | 'event' | 'activity' | 'section' | 'column' | 'photo';\n  name: string;\n  deleted_at: string;\n  deleted_by?: string;\n  deleted_by_email?: string;\n}\n\ninterface DeletedItemsManagerProps {\n  onRestore: (id: string, type: string) => Promise<void>;\n  onPermanentDelete: (id: string, type: string) => Promise<void>;\n}\n\nexport function DeletedItemsManager({\n  onRestore,\n  onPermanentDelete,\n}: DeletedItemsManagerProps) {\n  const [items, setItems] = useState<DeletedItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [filterType, setFilterType] = useState<string>('all');\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Fetch deleted items\n  useEffect(() => {\n    fetchDeletedItems();\n  }, [filterType]);\n\n  const fetchDeletedItems = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const params = new URLSearchParams();\n      if (filterType !== 'all') {\n        params.append('type', filterType);\n      }\n\n      const response = await fetch(`/api/admin/deleted-items?${params}`);\n      const data = await response.json();\n\n      if (!data.success) {\n        throw new Error(data.error?.message || 'Failed to fetch deleted items');\n      }\n\n      setItems(data.data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Unknown error');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRestore = async (item: DeletedItem) => {\n    if (!confirm(`Are you sure you want to restore \"${item.name}\"?`)) {\n      return;\n    }\n\n    try {\n      await onRestore(item.id, item.type);\n      await fetchDeletedItems();\n    } catch (err) {\n      alert(`Failed to restore: ${err instanceof Error ? err.message : 'Unknown error'}`);\n    }\n  };\n\n  const handlePermanentDelete = async (item: DeletedItem) => {\n    if (\n      !confirm(\n        `Are you sure you want to PERMANENTLY delete \"${item.name}\"? This action cannot be undone.`\n      )\n    ) {\n      return;\n    }\n\n    try {\n      await onPermanentDelete(item.id, item.type);\n      await fetchDeletedItems();\n    } catch (err) {\n      alert(\n        `Failed to permanently delete: ${err instanceof Error ? err.message : 'Unknown error'}`\n      );\n    }\n  };\n\n  // Filter items by search query\n  const filteredItems = items.filter((item) =>\n    item.name.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const columns = [\n    {\n      key: 'type',\n      label: 'Type',\n      render: (item: DeletedItem) => (\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\n          {item.type.replace('_', ' ')}\n        </span>\n      ),\n    },\n    {\n      key: 'name',\n      label: 'Name',\n      render: (item: DeletedItem) => (\n        <div className=\"text-sm font-medium text-gray-900\">{item.name}</div>\n      ),\n    },\n    {\n      key: 'deleted_at',\n      label: 'Deleted At',\n      render: (item: DeletedItem) => (\n        <div className=\"text-sm text-gray-500\">\n          {new Date(item.deleted_at).toLocaleString()}\n        </div>\n      ),\n    },\n    {\n      key: 'deleted_by',\n      label: 'Deleted By',\n      render: (item: DeletedItem) => (\n        <div className=\"text-sm text-gray-500\">\n          {item.deleted_by_email || 'Unknown'}\n        </div>\n      ),\n    },\n    {\n      key: 'actions',\n      label: 'Actions',\n      render: (item: DeletedItem) => (\n        <div className=\"flex space-x-2\">\n          <button\n            onClick={() => handleRestore(item)}\n            className=\"text-sm text-emerald-600 hover:text-emerald-900 font-medium\"\n          >\n            Restore\n          </button>\n          <button\n            onClick={() => handlePermanentDelete(item)}\n            className=\"text-sm text-red-600 hover:text-red-900 font-medium\"\n          >\n            Delete Permanently\n          </button>\n        </div>\n      ),\n    },\n  ];\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">Loading deleted items...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\n        <p className=\"text-red-800\">Error: {error}</p>\n        <button\n          onClick={fetchDeletedItems}\n          className=\"mt-2 text-sm text-red-600 hover:text-red-900 font-medium\"\n        >\n          Try Again\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Deleted Items</h2>\n        <button\n          onClick={fetchDeletedItems}\n          className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50\"\n        >\n          Refresh\n        </button>\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex items-center space-x-4\">\n        {/* Type Filter */}\n        <div>\n          <label htmlFor=\"typeFilter\" className=\"sr-only\">\n            Filter by type\n          </label>\n          <select\n            id=\"typeFilter\"\n            value={filterType}\n            onChange={(e) => setFilterType(e.target.value)}\n            className=\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm rounded-md\"\n          >\n            <option value=\"all\">All Types</option>\n            <option value=\"content_page\">Content Pages</option>\n            <option value=\"event\">Events</option>\n            <option value=\"activity\">Activities</option>\n            <option value=\"section\">Sections</option>\n            <option value=\"column\">Columns</option>\n            <option value=\"photo\">Photos</option>\n          </select>\n        </div>\n\n        {/* Search */}\n        <div className=\"flex-1\">\n          <label htmlFor=\"search\" className=\"sr-only\">\n            Search\n          </label>\n          <input\n            type=\"text\"\n            id=\"search\"\n            placeholder=\"Search by name...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm rounded-md\"\n          />\n        </div>\n      </div>\n\n      {/* Info Banner */}\n      <div className=\"p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n        <p className=\"text-sm text-blue-800\">\n          <strong>Note:</strong> Deleted items are automatically permanently deleted after 30\n          days. Restore items before then to prevent permanent data loss.\n        </p>\n      </div>\n\n      {/* Table */}\n      {filteredItems.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-50 rounded-lg\">\n          <svg\n            className=\"mx-auto h-12 w-12 text-gray-400\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            stroke=\"currentColor\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\"\n            />\n          </svg>\n          <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No deleted items</h3>\n          <p className=\"mt-1 text-sm text-gray-500\">\n            {searchQuery\n              ? 'No items match your search.'\n              : 'All deleted items have been restored or permanently deleted.'}\n          </p>\n        </div>\n      ) : (\n        <DataTable\n          data={filteredItems}\n          columns={columns}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["DeletedItemsManager","onRestore","onPermanentDelete","items","setItems","useState","loading","setLoading","error","setError","filterType","setFilterType","searchQuery","setSearchQuery","useEffect","fetchDeletedItems","params","URLSearchParams","append","response","fetch","data","json","success","Error","message","err","handleRestore","item","confirm","name","id","type","alert","handlePermanentDelete","filteredItems","filter","toLowerCase","includes","columns","key","label","render","span","className","replace","div","Date","deleted_at","toLocaleString","deleted_by_email","button","onClick","p","h2","htmlFor","select","value","onChange","e","target","option","input","placeholder","strong","length","svg","fill","viewBox","stroke","path","strokeLinecap","strokeLinejoin","strokeWidth","d","h3","DataTable"],"mappings":"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"}