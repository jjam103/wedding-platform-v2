6f146cc3521557e19a388988f692f533
/**
 * API Route: POST /api/admin/sections/check-circular
 * 
 * Checks for circular references in section content
 * 
 * Validates: Requirements 15.7
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "POST", {
    enumerable: true,
    get: function() {
        return POST;
    }
});
const _zod = require("zod");
const _apiHelpers = require("../../../../../lib/apiHelpers");
const _sectionsService = require("../../../../../services/sectionsService");
const checkCircularSchema = _zod.z.object({
    pageId: _zod.z.string().uuid(),
    references: _zod.z.array(_zod.z.object({
        id: _zod.z.string().uuid(),
        type: _zod.z.enum([
            'activity',
            'event',
            'accommodation',
            'location'
        ]),
        name: _zod.z.string().optional(),
        slug: _zod.z.string().optional()
    }))
});
async function POST(request) {
    try {
        // 1. Verify authentication
        const authResult = await (0, _apiHelpers.verifyAuth)();
        if (!authResult.success) {
            return (0, _apiHelpers.errorResponse)('UNAUTHORIZED', 'Authentication required', 401);
        }
        // 2. Parse and validate request body
        const body = await request.json();
        const validation = (0, _apiHelpers.validateBody)(body, checkCircularSchema);
        if (!validation.success) {
            return (0, _apiHelpers.errorResponse)(validation.error.code, validation.error.message, 400, validation.error.details);
        }
        // 3. Check for circular references
        const result = await (0, _sectionsService.detectCircularReferences)(validation.data.pageId, validation.data.references);
        // 4. Return response
        if (!result.success) {
            return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, 500, result.error.details);
        }
        return (0, _apiHelpers.successResponse)({
            hasCircularReferences: result.data
        });
    } catch (error) {
        return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', error instanceof Error ? error.message : 'Unknown error', 500);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9zZWN0aW9ucy9jaGVjay1jaXJjdWxhci9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFQSSBSb3V0ZTogUE9TVCAvYXBpL2FkbWluL3NlY3Rpb25zL2NoZWNrLWNpcmN1bGFyXG4gKiBcbiAqIENoZWNrcyBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlcyBpbiBzZWN0aW9uIGNvbnRlbnRcbiAqIFxuICogVmFsaWRhdGVzOiBSZXF1aXJlbWVudHMgMTUuN1xuICovXG5cbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgdmVyaWZ5QXV0aCwgZXJyb3JSZXNwb25zZSwgc3VjY2Vzc1Jlc3BvbnNlLCB2YWxpZGF0ZUJvZHkgfSBmcm9tICdAL2xpYi9hcGlIZWxwZXJzJztcbmltcG9ydCB7IGRldGVjdENpcmN1bGFyUmVmZXJlbmNlcyB9IGZyb20gJ0Avc2VydmljZXMvc2VjdGlvbnNTZXJ2aWNlJztcblxuY29uc3QgY2hlY2tDaXJjdWxhclNjaGVtYSA9IHoub2JqZWN0KHtcbiAgcGFnZUlkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgcmVmZXJlbmNlczogei5hcnJheShcbiAgICB6Lm9iamVjdCh7XG4gICAgICBpZDogei5zdHJpbmcoKS51dWlkKCksXG4gICAgICB0eXBlOiB6LmVudW0oWydhY3Rpdml0eScsICdldmVudCcsICdhY2NvbW1vZGF0aW9uJywgJ2xvY2F0aW9uJ10pLFxuICAgICAgbmFtZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgICAgc2x1Zzogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIH0pXG4gICksXG59KTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIDEuIFZlcmlmeSBhdXRoZW50aWNhdGlvblxuICAgIGNvbnN0IGF1dGhSZXN1bHQgPSBhd2FpdCB2ZXJpZnlBdXRoKCk7XG4gICAgaWYgKCFhdXRoUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKCdVTkFVVEhPUklaRUQnLCAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLCA0MDEpO1xuICAgIH1cblxuICAgIC8vIDIuIFBhcnNlIGFuZCB2YWxpZGF0ZSByZXF1ZXN0IGJvZHlcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlQm9keShib2R5LCBjaGVja0NpcmN1bGFyU2NoZW1hKTtcblxuICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICAgdmFsaWRhdGlvbi5lcnJvci5jb2RlLFxuICAgICAgICB2YWxpZGF0aW9uLmVycm9yLm1lc3NhZ2UsXG4gICAgICAgIDQwMCxcbiAgICAgICAgdmFsaWRhdGlvbi5lcnJvci5kZXRhaWxzXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDMuIENoZWNrIGZvciBjaXJjdWxhciByZWZlcmVuY2VzXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGV0ZWN0Q2lyY3VsYXJSZWZlcmVuY2VzKFxuICAgICAgdmFsaWRhdGlvbi5kYXRhLnBhZ2VJZCxcbiAgICAgIHZhbGlkYXRpb24uZGF0YS5yZWZlcmVuY2VzXG4gICAgKTtcblxuICAgIC8vIDQuIFJldHVybiByZXNwb25zZVxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICByZXN1bHQuZXJyb3IuY29kZSxcbiAgICAgICAgcmVzdWx0LmVycm9yLm1lc3NhZ2UsXG4gICAgICAgIDUwMCxcbiAgICAgICAgcmVzdWx0LmVycm9yLmRldGFpbHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Y2Nlc3NSZXNwb25zZSh7IGhhc0NpcmN1bGFyUmVmZXJlbmNlczogcmVzdWx0LmRhdGEgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAnSU5URVJOQUxfRVJST1InLFxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICA1MDBcbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiUE9TVCIsImNoZWNrQ2lyY3VsYXJTY2hlbWEiLCJ6Iiwib2JqZWN0IiwicGFnZUlkIiwic3RyaW5nIiwidXVpZCIsInJlZmVyZW5jZXMiLCJhcnJheSIsImlkIiwidHlwZSIsImVudW0iLCJuYW1lIiwib3B0aW9uYWwiLCJzbHVnIiwicmVxdWVzdCIsImF1dGhSZXN1bHQiLCJ2ZXJpZnlBdXRoIiwic3VjY2VzcyIsImVycm9yUmVzcG9uc2UiLCJib2R5IiwianNvbiIsInZhbGlkYXRpb24iLCJ2YWxpZGF0ZUJvZHkiLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwiZGV0YWlscyIsInJlc3VsdCIsImRldGVjdENpcmN1bGFyUmVmZXJlbmNlcyIsImRhdGEiLCJzdWNjZXNzUmVzcG9uc2UiLCJoYXNDaXJjdWxhclJlZmVyZW5jZXMiLCJFcnJvciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztDQU1DOzs7OytCQW1CcUJBOzs7ZUFBQUE7OztxQkFoQko7NEJBQ3VEO2lDQUNoQztBQUV6QyxNQUFNQyxzQkFBc0JDLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO0lBQ25DQyxRQUFRRixNQUFDLENBQUNHLE1BQU0sR0FBR0MsSUFBSTtJQUN2QkMsWUFBWUwsTUFBQyxDQUFDTSxLQUFLLENBQ2pCTixNQUFDLENBQUNDLE1BQU0sQ0FBQztRQUNQTSxJQUFJUCxNQUFDLENBQUNHLE1BQU0sR0FBR0MsSUFBSTtRQUNuQkksTUFBTVIsTUFBQyxDQUFDUyxJQUFJLENBQUM7WUFBQztZQUFZO1lBQVM7WUFBaUI7U0FBVztRQUMvREMsTUFBTVYsTUFBQyxDQUFDRyxNQUFNLEdBQUdRLFFBQVE7UUFDekJDLE1BQU1aLE1BQUMsQ0FBQ0csTUFBTSxHQUFHUSxRQUFRO0lBQzNCO0FBRUo7QUFFTyxlQUFlYixLQUFLZSxPQUFnQjtJQUN6QyxJQUFJO1FBQ0YsMkJBQTJCO1FBQzNCLE1BQU1DLGFBQWEsTUFBTUMsSUFBQUEsc0JBQVU7UUFDbkMsSUFBSSxDQUFDRCxXQUFXRSxPQUFPLEVBQUU7WUFDdkIsT0FBT0MsSUFBQUEseUJBQWEsRUFBQyxnQkFBZ0IsMkJBQTJCO1FBQ2xFO1FBRUEscUNBQXFDO1FBQ3JDLE1BQU1DLE9BQU8sTUFBTUwsUUFBUU0sSUFBSTtRQUMvQixNQUFNQyxhQUFhQyxJQUFBQSx3QkFBWSxFQUFDSCxNQUFNbkI7UUFFdEMsSUFBSSxDQUFDcUIsV0FBV0osT0FBTyxFQUFFO1lBQ3ZCLE9BQU9DLElBQUFBLHlCQUFhLEVBQ2xCRyxXQUFXRSxLQUFLLENBQUNDLElBQUksRUFDckJILFdBQVdFLEtBQUssQ0FBQ0UsT0FBTyxFQUN4QixLQUNBSixXQUFXRSxLQUFLLENBQUNHLE9BQU87UUFFNUI7UUFFQSxtQ0FBbUM7UUFDbkMsTUFBTUMsU0FBUyxNQUFNQyxJQUFBQSx5Q0FBd0IsRUFDM0NQLFdBQVdRLElBQUksQ0FBQzFCLE1BQU0sRUFDdEJrQixXQUFXUSxJQUFJLENBQUN2QixVQUFVO1FBRzVCLHFCQUFxQjtRQUNyQixJQUFJLENBQUNxQixPQUFPVixPQUFPLEVBQUU7WUFDbkIsT0FBT0MsSUFBQUEseUJBQWEsRUFDbEJTLE9BQU9KLEtBQUssQ0FBQ0MsSUFBSSxFQUNqQkcsT0FBT0osS0FBSyxDQUFDRSxPQUFPLEVBQ3BCLEtBQ0FFLE9BQU9KLEtBQUssQ0FBQ0csT0FBTztRQUV4QjtRQUVBLE9BQU9JLElBQUFBLDJCQUFlLEVBQUM7WUFBRUMsdUJBQXVCSixPQUFPRSxJQUFJO1FBQUM7SUFDOUQsRUFBRSxPQUFPTixPQUFPO1FBQ2QsT0FBT0wsSUFBQUEseUJBQWEsRUFDbEIsa0JBQ0FLLGlCQUFpQlMsUUFBUVQsTUFBTUUsT0FBTyxHQUFHLGlCQUN6QztJQUVKO0FBQ0YifQ==