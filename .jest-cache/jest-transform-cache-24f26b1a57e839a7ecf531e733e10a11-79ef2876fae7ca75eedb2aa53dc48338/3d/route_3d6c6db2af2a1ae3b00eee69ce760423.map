{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/sections/check-circular/route.ts"],"sourcesContent":["/**\n * API Route: POST /api/admin/sections/check-circular\n * \n * Checks for circular references in section content\n * \n * Validates: Requirements 15.7\n */\n\nimport { NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { verifyAuth, errorResponse, successResponse, validateBody } from '@/lib/apiHelpers';\nimport { detectCircularReferences } from '@/services/sectionsService';\n\nconst checkCircularSchema = z.object({\n  pageId: z.string().uuid(),\n  references: z.array(\n    z.object({\n      id: z.string().uuid(),\n      type: z.enum(['activity', 'event', 'accommodation', 'location']),\n      name: z.string().optional(),\n      slug: z.string().optional(),\n    })\n  ),\n});\n\nexport async function POST(request: Request) {\n  try {\n    // 1. Verify authentication\n    const authResult = await verifyAuth();\n    if (!authResult.success) {\n      return errorResponse('UNAUTHORIZED', 'Authentication required', 401);\n    }\n\n    // 2. Parse and validate request body\n    const body = await request.json();\n    const validation = validateBody(body, checkCircularSchema);\n\n    if (!validation.success) {\n      return errorResponse(\n        validation.error.code,\n        validation.error.message,\n        400,\n        validation.error.details\n      );\n    }\n\n    // 3. Check for circular references\n    const result = await detectCircularReferences(\n      validation.data.pageId,\n      validation.data.references\n    );\n\n    // 4. Return response\n    if (!result.success) {\n      return errorResponse(\n        result.error.code,\n        result.error.message,\n        500,\n        result.error.details\n      );\n    }\n\n    return successResponse({ hasCircularReferences: result.data });\n  } catch (error) {\n    return errorResponse(\n      'INTERNAL_ERROR',\n      error instanceof Error ? error.message : 'Unknown error',\n      500\n    );\n  }\n}\n"],"names":["POST","checkCircularSchema","z","object","pageId","string","uuid","references","array","id","type","enum","name","optional","slug","request","authResult","verifyAuth","success","errorResponse","body","json","validation","validateBody","error","code","message","details","result","detectCircularReferences","data","successResponse","hasCircularReferences","Error"],"mappings":"AAAA;;;;;;CAMC;;;;+BAmBqBA;;;eAAAA;;;qBAhBJ;4BACuD;iCAChC;AAEzC,MAAMC,sBAAsBC,MAAC,CAACC,MAAM,CAAC;IACnCC,QAAQF,MAAC,CAACG,MAAM,GAAGC,IAAI;IACvBC,YAAYL,MAAC,CAACM,KAAK,CACjBN,MAAC,CAACC,MAAM,CAAC;QACPM,IAAIP,MAAC,CAACG,MAAM,GAAGC,IAAI;QACnBI,MAAMR,MAAC,CAACS,IAAI,CAAC;YAAC;YAAY;YAAS;YAAiB;SAAW;QAC/DC,MAAMV,MAAC,CAACG,MAAM,GAAGQ,QAAQ;QACzBC,MAAMZ,MAAC,CAACG,MAAM,GAAGQ,QAAQ;IAC3B;AAEJ;AAEO,eAAeb,KAAKe,OAAgB;IACzC,IAAI;QACF,2BAA2B;QAC3B,MAAMC,aAAa,MAAMC,IAAAA,sBAAU;QACnC,IAAI,CAACD,WAAWE,OAAO,EAAE;YACvB,OAAOC,IAAAA,yBAAa,EAAC,gBAAgB,2BAA2B;QAClE;QAEA,qCAAqC;QACrC,MAAMC,OAAO,MAAML,QAAQM,IAAI;QAC/B,MAAMC,aAAaC,IAAAA,wBAAY,EAACH,MAAMnB;QAEtC,IAAI,CAACqB,WAAWJ,OAAO,EAAE;YACvB,OAAOC,IAAAA,yBAAa,EAClBG,WAAWE,KAAK,CAACC,IAAI,EACrBH,WAAWE,KAAK,CAACE,OAAO,EACxB,KACAJ,WAAWE,KAAK,CAACG,OAAO;QAE5B;QAEA,mCAAmC;QACnC,MAAMC,SAAS,MAAMC,IAAAA,yCAAwB,EAC3CP,WAAWQ,IAAI,CAAC1B,MAAM,EACtBkB,WAAWQ,IAAI,CAACvB,UAAU;QAG5B,qBAAqB;QACrB,IAAI,CAACqB,OAAOV,OAAO,EAAE;YACnB,OAAOC,IAAAA,yBAAa,EAClBS,OAAOJ,KAAK,CAACC,IAAI,EACjBG,OAAOJ,KAAK,CAACE,OAAO,EACpB,KACAE,OAAOJ,KAAK,CAACG,OAAO;QAExB;QAEA,OAAOI,IAAAA,2BAAe,EAAC;YAAEC,uBAAuBJ,OAAOE,IAAI;QAAC;IAC9D,EAAE,OAAON,OAAO;QACd,OAAOL,IAAAA,yBAAa,EAClB,kBACAK,iBAAiBS,QAAQT,MAAME,OAAO,GAAG,iBACzC;IAEJ;AACF"}