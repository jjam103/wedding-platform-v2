83985f7c527d24020135d56ab57be938
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "POST", {
    enumerable: true,
    get: function() {
        return POST;
    }
});
const _supabaseServer = require("../../../../../lib/supabaseServer");
const _server = require("next/server");
const _emailService = require("../../../../../services/emailService");
const _emailSchemas = require("../../../../../schemas/emailSchemas");
async function POST(request) {
    try {
        // 1. Auth check
        const supabase = await (0, _supabaseServer.createAuthenticatedClient)();
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // 2. Parse and validate
        const body = await request.json();
        const validation = _emailSchemas.sendBulkEmailSchema.safeParse(body);
        if (!validation.success) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid request',
                    details: validation.error.issues
                }
            }, {
                status: 400
            });
        }
        // 3. Send emails
        const result = await (0, _emailService.sendBulkEmail)(validation.data);
        if (!result.success) {
            return _server.NextResponse.json(result, {
                status: 500
            });
        }
        return _server.NextResponse.json(result, {
            status: 200
        });
    } catch (error) {
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9lbWFpbHMvc2VuZC9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2VTZXJ2ZXInO1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgc2VuZEJ1bGtFbWFpbCB9IGZyb20gJ0Avc2VydmljZXMvZW1haWxTZXJ2aWNlJztcbmltcG9ydCB7IHNlbmRCdWxrRW1haWxTY2hlbWEgfSBmcm9tICdAL3NjaGVtYXMvZW1haWxTY2hlbWFzJztcblxuLyoqXG4gKiBQT1NUIC9hcGkvYWRtaW4vZW1haWxzL3NlbmRcbiAqIFNlbmRzIGJ1bGsgZW1haWxzIHRvIG11bHRpcGxlIHJlY2lwaWVudHMuXG4gKiBSZXF1aXJlbWVudHM6IDguMywgOC43XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBBdXRoIGNoZWNrXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50KCk7XG4gICAgY29uc3Qge1xuICAgICAgZGF0YTogeyBzZXNzaW9uIH0sXG4gICAgICBlcnJvcjogYXV0aEVycm9yLFxuICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7IGNvZGU6ICdVTkFVVEhPUklaRUQnLCBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyAyLiBQYXJzZSBhbmQgdmFsaWRhdGVcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHNlbmRCdWxrRW1haWxTY2hlbWEuc2FmZVBhcnNlKGJvZHkpO1xuXG4gICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCByZXF1ZXN0JyxcbiAgICAgICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyAzLiBTZW5kIGVtYWlsc1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlbmRCdWxrRW1haWwodmFsaWRhdGlvbi5kYXRhKTtcblxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXN1bHQsIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3VsdCwgeyBzdGF0dXM6IDIwMCB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiUE9TVCIsInJlcXVlc3QiLCJzdXBhYmFzZSIsImNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQiLCJkYXRhIiwic2Vzc2lvbiIsImVycm9yIiwiYXV0aEVycm9yIiwiYXV0aCIsImdldFNlc3Npb24iLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwic3VjY2VzcyIsImNvZGUiLCJtZXNzYWdlIiwic3RhdHVzIiwiYm9keSIsInZhbGlkYXRpb24iLCJzZW5kQnVsa0VtYWlsU2NoZW1hIiwic2FmZVBhcnNlIiwiZGV0YWlscyIsImlzc3VlcyIsInJlc3VsdCIsInNlbmRCdWxrRW1haWwiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFVc0JBOzs7ZUFBQUE7OztnQ0FWb0I7d0JBQ2I7OEJBQ0M7OEJBQ007QUFPN0IsZUFBZUEsS0FBS0MsT0FBZ0I7SUFDekMsSUFBSTtRQUNGLGdCQUFnQjtRQUNoQixNQUFNQyxXQUFXLE1BQU1DLElBQUFBLHlDQUF5QjtRQUNoRCxNQUFNLEVBQ0pDLE1BQU0sRUFBRUMsT0FBTyxFQUFFLEVBQ2pCQyxPQUFPQyxTQUFTLEVBQ2pCLEdBQUcsTUFBTUwsU0FBU00sSUFBSSxDQUFDQyxVQUFVO1FBRWxDLElBQUlGLGFBQWEsQ0FBQ0YsU0FBUztZQUN6QixPQUFPSyxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNUTixPQUFPO29CQUFFTyxNQUFNO29CQUFnQkMsU0FBUztnQkFBMEI7WUFDcEUsR0FDQTtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsd0JBQXdCO1FBQ3hCLE1BQU1DLE9BQU8sTUFBTWYsUUFBUVUsSUFBSTtRQUMvQixNQUFNTSxhQUFhQyxpQ0FBbUIsQ0FBQ0MsU0FBUyxDQUFDSDtRQUVqRCxJQUFJLENBQUNDLFdBQVdMLE9BQU8sRUFBRTtZQUN2QixPQUFPRixvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNUTixPQUFPO29CQUNMTyxNQUFNO29CQUNOQyxTQUFTO29CQUNUTSxTQUFTSCxXQUFXWCxLQUFLLENBQUNlLE1BQU07Z0JBQ2xDO1lBQ0YsR0FDQTtnQkFBRU4sUUFBUTtZQUFJO1FBRWxCO1FBRUEsaUJBQWlCO1FBQ2pCLE1BQU1PLFNBQVMsTUFBTUMsSUFBQUEsMkJBQWEsRUFBQ04sV0FBV2IsSUFBSTtRQUVsRCxJQUFJLENBQUNrQixPQUFPVixPQUFPLEVBQUU7WUFDbkIsT0FBT0Ysb0JBQVksQ0FBQ0MsSUFBSSxDQUFDVyxRQUFRO2dCQUFFUCxRQUFRO1lBQUk7UUFDakQ7UUFFQSxPQUFPTCxvQkFBWSxDQUFDQyxJQUFJLENBQUNXLFFBQVE7WUFBRVAsUUFBUTtRQUFJO0lBQ2pELEVBQUUsT0FBT1QsT0FBTztRQUNkLE9BQU9JLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7WUFDRUMsU0FBUztZQUNUTixPQUFPO2dCQUNMTyxNQUFNO2dCQUNOQyxTQUFTUixpQkFBaUJrQixRQUFRbEIsTUFBTVEsT0FBTyxHQUFHO1lBQ3BEO1FBQ0YsR0FDQTtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiJ9