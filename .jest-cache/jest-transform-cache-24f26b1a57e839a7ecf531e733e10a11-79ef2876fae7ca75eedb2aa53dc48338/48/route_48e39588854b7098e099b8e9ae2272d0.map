{"version":3,"names":["cov_5gou7htdm","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","version","sources","sourcesContent","names","mappings","_coverageSchema","coverage","actualCoverage","POST","checkCircularSchema","_zod","z","object","pageId","string","uuid","references","array","id","enum","optional","slug","request","authResult","_apiHelpers","verifyAuth","success","errorResponse","body","json","validation","validateBody","error","code","message","details","result","_sectionsService","detectCircularReferences","data","successResponse","hasCircularReferences","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/sections/check-circular/route.ts"],"sourcesContent":["/**\n * API Route: POST /api/admin/sections/check-circular\n * \n * Checks for circular references in section content\n * \n * Validates: Requirements 15.7\n */\n\nimport { NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { verifyAuth, errorResponse, successResponse, validateBody } from '@/lib/apiHelpers';\nimport { detectCircularReferences } from '@/services/sectionsService';\n\nconst checkCircularSchema = z.object({\n  pageId: z.string().uuid(),\n  references: z.array(\n    z.object({\n      id: z.string().uuid(),\n      type: z.enum(['activity', 'event', 'accommodation', 'location']),\n      name: z.string().optional(),\n      slug: z.string().optional(),\n    })\n  ),\n});\n\nexport async function POST(request: Request) {\n  try {\n    // 1. Verify authentication\n    const authResult = await verifyAuth();\n    if (!authResult.success) {\n      return errorResponse('UNAUTHORIZED', 'Authentication required', 401);\n    }\n\n    // 2. Parse and validate request body\n    const body = await request.json();\n    const validation = validateBody(body, checkCircularSchema);\n\n    if (!validation.success) {\n      return errorResponse(\n        validation.error.code,\n        validation.error.message,\n        400,\n        validation.error.details\n      );\n    }\n\n    // 3. Check for circular references\n    const result = await detectCircularReferences(\n      validation.data.pageId,\n      validation.data.references\n    );\n\n    // 4. Return response\n    if (!result.success) {\n      return errorResponse(\n        result.error.code,\n        result.error.message,\n        500,\n        result.error.details\n      );\n    }\n\n    return successResponse({ hasCircularReferences: result.data });\n  } catch (error) {\n    return errorResponse(\n      'INTERNAL_ERROR',\n      error instanceof Error ? error.message : 'Unknown error',\n      500\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}