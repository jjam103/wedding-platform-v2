{"version":3,"names":["cov_ofvc6snv9","actualCoverage","s","PATCH","updateTransportationSchema","_zod","z","object","airport_code","enum","flight_number","string","max","optional","arrival_date","departure_date","request","f","auth","_apiAuth","getAuthenticatedUser","b","_server","NextResponse","json","success","error","code","message","status","user","supabase","data","currentGuest","currentGuestError","from","select","eq","email","single","body","validation","safeParse","details","issues","sanitized","updated_at","Date","toISOString","_sanitization","sanitizeInput","updated","updateError","update","id","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/transportation/route.ts"],"sourcesContent":["import { getAuthenticatedUser } from '@/lib/apiAuth';\nimport { NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { sanitizeInput } from '@/utils/sanitization';\n\nconst updateTransportationSchema = z.object({\n  airport_code: z.enum(['SJO', 'LIR', 'Other']),\n  flight_number: z.string().max(20).optional(),\n  arrival_date: z.string().optional(),\n  departure_date: z.string().optional(),\n});\n\n/**\n * PATCH /api/guest/transportation\n * \n * Updates guest transportation information.\n * \n * Requirements: 13.7, 10.1\n */\nexport async function PATCH(request: Request) {\n  try {\n    const auth = await getAuthenticatedUser();\n    \n    if (!auth) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    const { user, supabase } = auth;\n    \n    // Get current guest\n    const { data: currentGuest, error: currentGuestError } = await supabase\n      .from('guests')\n      .select('id')\n      .eq('email', user.email)\n      .single();\n    \n    if (currentGuestError || !currentGuest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'GUEST_NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // Parse and validate request body\n    const body = await request.json();\n    const validation = updateTransportationSchema.safeParse(body);\n    \n    if (!validation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid request data',\n            details: validation.error.issues,\n          },\n        },\n        { status: 400 }\n      );\n    }\n    \n    // Sanitize input\n    const sanitized: any = {\n      airport_code: validation.data.airport_code,\n      updated_at: new Date().toISOString(),\n    };\n    \n    if (validation.data.flight_number) {\n      sanitized.flight_number = sanitizeInput(validation.data.flight_number);\n    }\n    if (validation.data.arrival_date) {\n      sanitized.arrival_date = validation.data.arrival_date;\n    }\n    if (validation.data.departure_date) {\n      sanitized.departure_date = validation.data.departure_date;\n    }\n    \n    // Update guest transportation information\n    const { data: updated, error: updateError } = await supabase\n      .from('guests')\n      .update(sanitized)\n      .eq('id', currentGuest.id)\n      .select()\n      .single();\n    \n    if (updateError) {\n      return NextResponse.json(\n        { success: false, error: { code: 'DATABASE_ERROR', message: updateError.message } },\n        { status: 500 }\n      );\n    }\n    \n    return NextResponse.json({ success: true, data: updated });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}