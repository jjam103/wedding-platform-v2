{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/rsvps/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { withAuth, errorResponse, successResponse } from '@/lib/apiHelpers';\nimport * as rsvpManagementService from '@/services/rsvpManagementService';\n\n/**\n * GET /api/admin/rsvps\n * \n * List all RSVPs with filtering, pagination, and statistics\n * \n * Query Parameters:\n * - page: number (default: 1)\n * - limit: number (default: 50, max: 100)\n * - eventId: string (UUID)\n * - activityId: string (UUID)\n * - status: 'pending' | 'attending' | 'declined' | 'maybe'\n * - guestId: string (UUID)\n * - searchQuery: string (searches guest name and email)\n * \n * Returns:\n * - data: Array of RSVP view models\n * - pagination: { page, limit, total, totalPages }\n * - statistics: { totalRSVPs, byStatus, totalGuestCount }\n * \n * **Validates: Requirements 6.2, 6.5**\n */\n\n// Query parameter validation schema\nconst queryParamsSchema = z.object({\n  page: z.coerce.number().int().positive().default(1),\n  limit: z.coerce.number().int().positive().max(100).default(50),\n  eventId: z.string().uuid().optional(),\n  activityId: z.string().uuid().optional(),\n  status: z.enum(['pending', 'attending', 'declined', 'maybe']).optional(),\n  guestId: z.string().uuid().optional(),\n  searchQuery: z.string().max(100).optional(),\n});\n\n/**\n * Map error codes to HTTP status codes\n */\nfunction getStatusCode(errorCode: string): number {\n  const statusMap: Record<string, number> = {\n    'VALIDATION_ERROR': 400,\n    'INVALID_INPUT': 400,\n    'UNAUTHORIZED': 401,\n    'AUTHENTICATION_REQUIRED': 401,\n    'FORBIDDEN': 403,\n    'NOT_FOUND': 404,\n    'DATABASE_ERROR': 500,\n    'INTERNAL_ERROR': 500,\n    'UNKNOWN_ERROR': 500,\n  };\n  \n  return statusMap[errorCode] || 500;\n}\n\nexport async function GET(request: Request) {\n  return withAuth(async (userId) => {\n    try {\n      // 1. Parse and validate query parameters\n      const { searchParams } = new URL(request.url);\n      \n      // Build query object, filtering out null values\n      const queryParams: Record<string, string | number> = {};\n      \n      const pageParam = searchParams.get('page');\n      const limitParam = searchParams.get('limit');\n      const eventIdParam = searchParams.get('eventId');\n      const activityIdParam = searchParams.get('activityId');\n      const statusParam = searchParams.get('status');\n      const guestIdParam = searchParams.get('guestId');\n      const searchQueryParam = searchParams.get('searchQuery');\n      \n      if (pageParam !== null) queryParams.page = pageParam;\n      if (limitParam !== null) queryParams.limit = limitParam;\n      if (eventIdParam !== null) queryParams.eventId = eventIdParam;\n      if (activityIdParam !== null) queryParams.activityId = activityIdParam;\n      if (statusParam !== null) queryParams.status = statusParam;\n      if (guestIdParam !== null) queryParams.guestId = guestIdParam;\n      if (searchQueryParam !== null) queryParams.searchQuery = searchQueryParam;\n      \n      const queryValidation = queryParamsSchema.safeParse(queryParams);\n\n      if (!queryValidation.success) {\n        return errorResponse(\n          'VALIDATION_ERROR',\n          'Invalid query parameters',\n          400,\n          { fields: queryValidation.error.issues }\n        );\n      }\n\n      const { page, limit, ...filters } = queryValidation.data;\n\n      // 2. Call service layer\n      const result = await rsvpManagementService.listRSVPs(\n        filters,\n        { page, limit }\n      );\n\n      // 3. Handle service errors\n      if (!result.success) {\n        return errorResponse(\n          result.error.code,\n          result.error.message,\n          getStatusCode(result.error.code),\n          result.error.details\n        );\n      }\n\n      // 4. Return success response\n      return successResponse(result.data, 200);\n\n    } catch (error) {\n      console.error('GET /api/admin/rsvps error:', {\n        error: error instanceof Error ? error.message : 'Unknown error',\n        stack: error instanceof Error ? error.stack : undefined,\n      });\n      \n      return errorResponse(\n        'INTERNAL_ERROR',\n        'Failed to fetch RSVPs',\n        500\n      );\n    }\n  });\n}\n"],"names":["GET","queryParamsSchema","z","object","page","coerce","number","int","positive","default","limit","max","eventId","string","uuid","optional","activityId","status","enum","guestId","searchQuery","getStatusCode","errorCode","statusMap","request","withAuth","userId","searchParams","URL","url","queryParams","pageParam","get","limitParam","eventIdParam","activityIdParam","statusParam","guestIdParam","searchQueryParam","queryValidation","safeParse","success","errorResponse","fields","error","issues","filters","data","result","rsvpManagementService","listRSVPs","code","message","details","successResponse","console","Error","stack","undefined"],"mappings":";;;;+BAyDsBA;;;eAAAA;;;qBAxDJ;4BACuC;+EAClB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEvC;;;;;;;;;;;;;;;;;;;;CAoBC,GAED,oCAAoC;AACpC,MAAMC,oBAAoBC,MAAC,CAACC,MAAM,CAAC;IACjCC,MAAMF,MAAC,CAACG,MAAM,CAACC,MAAM,GAAGC,GAAG,GAAGC,QAAQ,GAAGC,OAAO,CAAC;IACjDC,OAAOR,MAAC,CAACG,MAAM,CAACC,MAAM,GAAGC,GAAG,GAAGC,QAAQ,GAAGG,GAAG,CAAC,KAAKF,OAAO,CAAC;IAC3DG,SAASV,MAAC,CAACW,MAAM,GAAGC,IAAI,GAAGC,QAAQ;IACnCC,YAAYd,MAAC,CAACW,MAAM,GAAGC,IAAI,GAAGC,QAAQ;IACtCE,QAAQf,MAAC,CAACgB,IAAI,CAAC;QAAC;QAAW;QAAa;QAAY;KAAQ,EAAEH,QAAQ;IACtEI,SAASjB,MAAC,CAACW,MAAM,GAAGC,IAAI,GAAGC,QAAQ;IACnCK,aAAalB,MAAC,CAACW,MAAM,GAAGF,GAAG,CAAC,KAAKI,QAAQ;AAC3C;AAEA;;CAEC,GACD,SAASM,cAAcC,SAAiB;IACtC,MAAMC,YAAoC;QACxC,oBAAoB;QACpB,iBAAiB;QACjB,gBAAgB;QAChB,2BAA2B;QAC3B,aAAa;QACb,aAAa;QACb,kBAAkB;QAClB,kBAAkB;QAClB,iBAAiB;IACnB;IAEA,OAAOA,SAAS,CAACD,UAAU,IAAI;AACjC;AAEO,eAAetB,IAAIwB,OAAgB;IACxC,OAAOC,IAAAA,oBAAQ,EAAC,OAAOC;QACrB,IAAI;YACF,yCAAyC;YACzC,MAAM,EAAEC,YAAY,EAAE,GAAG,IAAIC,IAAIJ,QAAQK,GAAG;YAE5C,gDAAgD;YAChD,MAAMC,cAA+C,CAAC;YAEtD,MAAMC,YAAYJ,aAAaK,GAAG,CAAC;YACnC,MAAMC,aAAaN,aAAaK,GAAG,CAAC;YACpC,MAAME,eAAeP,aAAaK,GAAG,CAAC;YACtC,MAAMG,kBAAkBR,aAAaK,GAAG,CAAC;YACzC,MAAMI,cAAcT,aAAaK,GAAG,CAAC;YACrC,MAAMK,eAAeV,aAAaK,GAAG,CAAC;YACtC,MAAMM,mBAAmBX,aAAaK,GAAG,CAAC;YAE1C,IAAID,cAAc,MAAMD,YAAY1B,IAAI,GAAG2B;YAC3C,IAAIE,eAAe,MAAMH,YAAYpB,KAAK,GAAGuB;YAC7C,IAAIC,iBAAiB,MAAMJ,YAAYlB,OAAO,GAAGsB;YACjD,IAAIC,oBAAoB,MAAML,YAAYd,UAAU,GAAGmB;YACvD,IAAIC,gBAAgB,MAAMN,YAAYb,MAAM,GAAGmB;YAC/C,IAAIC,iBAAiB,MAAMP,YAAYX,OAAO,GAAGkB;YACjD,IAAIC,qBAAqB,MAAMR,YAAYV,WAAW,GAAGkB;YAEzD,MAAMC,kBAAkBtC,kBAAkBuC,SAAS,CAACV;YAEpD,IAAI,CAACS,gBAAgBE,OAAO,EAAE;gBAC5B,OAAOC,IAAAA,yBAAa,EAClB,oBACA,4BACA,KACA;oBAAEC,QAAQJ,gBAAgBK,KAAK,CAACC,MAAM;gBAAC;YAE3C;YAEA,MAAM,EAAEzC,IAAI,EAAEM,KAAK,EAAE,GAAGoC,SAAS,GAAGP,gBAAgBQ,IAAI;YAExD,wBAAwB;YACxB,MAAMC,SAAS,MAAMC,uBAAsBC,SAAS,CAClDJ,SACA;gBAAE1C;gBAAMM;YAAM;YAGhB,2BAA2B;YAC3B,IAAI,CAACsC,OAAOP,OAAO,EAAE;gBACnB,OAAOC,IAAAA,yBAAa,EAClBM,OAAOJ,KAAK,CAACO,IAAI,EACjBH,OAAOJ,KAAK,CAACQ,OAAO,EACpB/B,cAAc2B,OAAOJ,KAAK,CAACO,IAAI,GAC/BH,OAAOJ,KAAK,CAACS,OAAO;YAExB;YAEA,6BAA6B;YAC7B,OAAOC,IAAAA,2BAAe,EAACN,OAAOD,IAAI,EAAE;QAEtC,EAAE,OAAOH,OAAO;YACdW,QAAQX,KAAK,CAAC,+BAA+B;gBAC3CA,OAAOA,iBAAiBY,QAAQZ,MAAMQ,OAAO,GAAG;gBAChDK,OAAOb,iBAAiBY,QAAQZ,MAAMa,KAAK,GAAGC;YAChD;YAEA,OAAOhB,IAAAA,yBAAa,EAClB,kBACA,yBACA;QAEJ;IACF;AACF"}