{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/accommodationService.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\nimport { sanitizeInput, sanitizeRichText } from \"../utils/sanitization\";\nimport {\n  createAccommodationSchema,\n  updateAccommodationSchema,\n  accommodationFilterSchema,\n  accommodationSearchSchema,\n  createRoomTypeSchema,\n  updateRoomTypeSchema,\n  createRoomAssignmentSchema,\n  updateRoomAssignmentSchema,\n  calculateCostSchema,\n  type CreateAccommodationDTO,\n  type UpdateAccommodationDTO,\n  type AccommodationFilterDTO,\n  type AccommodationSearchDTO,\n  type CreateRoomTypeDTO,\n  type UpdateRoomTypeDTO,\n  type CreateRoomAssignmentDTO,\n  type UpdateRoomAssignmentDTO,\n  type CalculateCostDTO,\n  type Accommodation,\n  type RoomType,\n  type RoomAssignment,\n  type PaginatedAccommodations,\n  type RoomCost,\n  type AccommodationWithRoomTypes,\n  type RoomTypeWithAvailability,\n} from '../schemas/accommodationSchemas';\n\n/**\n * Result type for consistent error handling.\n */\ntype Result<T> =\n  | { success: true; data: T }\n  | { success: false; error: { code: string; message: string; details?: any } };\n\n// Initialize Supabase client - Pattern A (testable)\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\n/**\n * Converts camelCase to snake_case for database columns.\n */\nfunction toSnakeCase(obj: any): any {\n  const snakeObj: any = {};\n  for (const key in obj) {\n    const snakeKey = key.replace(/[A-Z]/g, (letter) => `_${letter.toLowerCase()}`);\n    snakeObj[snakeKey] = obj[key];\n  }\n  return snakeObj;\n}\n\n/**\n * Converts snake_case to camelCase for TypeScript objects.\n */\nfunction toCamelCase(obj: any): any {\n  const camelObj: any = {};\n  for (const key in obj) {\n    const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\n    camelObj[camelKey] = obj[key];\n  }\n  return camelObj;\n}\n\n// ============================================================================\n// ACCOMMODATION CRUD OPERATIONS\n// ============================================================================\n\n/**\n * Creates a new accommodation in the system.\n */\nexport async function createAccommodation(data: CreateAccommodationDTO): Promise<Result<Accommodation>> {\n  try {\n    const validation = createAccommodationSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const sanitized = {\n      ...validation.data,\n      name: sanitizeInput(validation.data.name),\n      address: validation.data.address ? sanitizeInput(validation.data.address) : null,\n      description: validation.data.description ? sanitizeRichText(validation.data.description) : null,\n    };\n\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('accommodations')\n      .insert(dbData)\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as Accommodation };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Retrieves a single accommodation by ID.\n */\nexport async function getAccommodation(id: string): Promise<Result<Accommodation>> {\n  try {\n\n    const { data, error } = await supabase\n      .from('accommodations')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Accommodation not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(data) as Accommodation };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Updates an existing accommodation.\n */\nexport async function updateAccommodation(id: string, data: UpdateAccommodationDTO): Promise<Result<Accommodation>> {\n  try {\n    const validation = updateAccommodationSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const sanitized: any = { ...validation.data };\n    if (sanitized.name) {\n      sanitized.name = sanitizeInput(sanitized.name);\n    }\n    if (sanitized.address) {\n      sanitized.address = sanitizeInput(sanitized.address);\n    }\n    if (sanitized.description) {\n      sanitized.description = sanitizeRichText(sanitized.description);\n    }\n\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('accommodations')\n      .update(dbData)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Accommodation not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as Accommodation };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Deletes an accommodation by ID.\n */\nexport async function deleteAccommodation(id: string): Promise<Result<void>> {\n  try {\n\n    const { error } = await supabase.from('accommodations').delete().eq('id', id);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Lists accommodations with optional filtering and pagination.\n */\nexport async function listAccommodations(filters: Partial<AccommodationFilterDTO> = { page: 1, pageSize: 50 }): Promise<Result<PaginatedAccommodations>> {\n  try {\n    const filtersWithDefaults = { page: 1, pageSize: 50, ...filters };\n    const validation = accommodationFilterSchema.safeParse(filtersWithDefaults);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { page = 1, pageSize = 50, ...filterParams } = validation.data;\n    const from = (page - 1) * pageSize;\n    const to = from + pageSize - 1;\n\n\n    let query = supabase.from('accommodations').select('*', { count: 'exact' });\n\n    if (filterParams.locationId !== undefined) {\n      if (filterParams.locationId === null) {\n        query = query.is('location_id', null);\n      } else {\n        query = query.eq('location_id', filterParams.locationId);\n      }\n    }\n    if (filterParams.status) {\n      query = query.eq('status', filterParams.status);\n    }\n\n    query = query.order('name', { ascending: true }).range(from, to);\n\n    const { data, error, count } = await query;\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const accommodations = data.map((accommodation) => toCamelCase(accommodation) as Accommodation);\n    const total = count || 0;\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      success: true,\n      data: {\n        accommodations,\n        total,\n        page,\n        pageSize,\n        totalPages,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Searches accommodations by name, address, or description.\n */\nexport async function searchAccommodations(searchParams: AccommodationSearchDTO): Promise<Result<PaginatedAccommodations>> {\n  try {\n    const validation = accommodationSearchSchema.safeParse(searchParams);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { query, page = 1, pageSize = 50 } = validation.data;\n    const from = (page - 1) * pageSize;\n    const to = from + pageSize - 1;\n\n    const sanitizedQuery = sanitizeInput(query);\n\n\n    const { data, error, count } = await supabase\n      .from('accommodations')\n      .select('*', { count: 'exact' })\n      .or(`name.ilike.%${sanitizedQuery}%,address.ilike.%${sanitizedQuery}%,description.ilike.%${sanitizedQuery}%`)\n      .order('name', { ascending: true })\n      .range(from, to);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const accommodations = data.map((accommodation) => toCamelCase(accommodation) as Accommodation);\n    const total = count || 0;\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      success: true,\n      data: {\n        accommodations,\n        total,\n        page,\n        pageSize,\n        totalPages,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n// ============================================================================\n// ROOM TYPE CRUD OPERATIONS\n// ============================================================================\n\n/**\n * Creates a new room type for an accommodation.\n */\nexport async function createRoomType(data: CreateRoomTypeDTO): Promise<Result<RoomType>> {\n  try {\n    const validation = createRoomTypeSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const sanitized = {\n      ...validation.data,\n      name: sanitizeInput(validation.data.name),\n      description: validation.data.description ? sanitizeRichText(validation.data.description) : null,\n    };\n\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('room_types')\n      .insert(dbData)\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as RoomType };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Retrieves a single room type by ID.\n */\nexport async function getRoomType(id: string): Promise<Result<RoomType>> {\n  try {\n\n    const { data, error } = await supabase\n      .from('room_types')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Room type not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(data) as RoomType };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Updates an existing room type.\n */\nexport async function updateRoomType(id: string, data: UpdateRoomTypeDTO): Promise<Result<RoomType>> {\n  try {\n    const validation = updateRoomTypeSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const sanitized: any = { ...validation.data };\n    if (sanitized.name) {\n      sanitized.name = sanitizeInput(sanitized.name);\n    }\n    if (sanitized.description) {\n      sanitized.description = sanitizeRichText(sanitized.description);\n    }\n\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('room_types')\n      .update(dbData)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Room type not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as RoomType };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Deletes a room type by ID.\n */\nexport async function deleteRoomType(id: string): Promise<Result<void>> {\n  try {\n\n    const { error } = await supabase.from('room_types').delete().eq('id', id);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Lists room types for a specific accommodation.\n */\nexport async function listRoomTypes(accommodationId: string): Promise<Result<RoomType[]>> {\n  try {\n\n    const { data, error } = await supabase\n      .from('room_types')\n      .select('*')\n      .eq('accommodation_id', accommodationId)\n      .order('name', { ascending: true });\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const roomTypes = data.map((roomType) => toCamelCase(roomType) as RoomType);\n    return { success: true, data: roomTypes };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Gets an accommodation with all its room types.\n */\nexport async function getAccommodationWithRoomTypes(id: string): Promise<Result<AccommodationWithRoomTypes>> {\n  try {\n    const accommodationResult = await getAccommodation(id);\n    if (!accommodationResult.success) {\n      return accommodationResult as Result<AccommodationWithRoomTypes>;\n    }\n\n    const roomTypesResult = await listRoomTypes(id);\n    if (!roomTypesResult.success) {\n      return roomTypesResult as Result<AccommodationWithRoomTypes>;\n    }\n\n    return {\n      success: true,\n      data: {\n        ...accommodationResult.data,\n        roomTypes: roomTypesResult.data,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n// ============================================================================\n// ROOM ASSIGNMENT OPERATIONS\n// ============================================================================\n\n/**\n * Creates a new room assignment for a guest.\n */\nexport async function createRoomAssignment(data: CreateRoomAssignmentDTO): Promise<Result<RoomAssignment>> {\n  try {\n    const validation = createRoomAssignmentSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const sanitized = {\n      ...validation.data,\n      notes: validation.data.notes ? sanitizeInput(validation.data.notes) : null,\n    };\n\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('room_assignments')\n      .insert(dbData)\n      .select()\n      .single();\n\n    if (error) {\n      if (error.code === '23505') {\n        return {\n          success: false,\n          error: {\n            code: 'CONFLICT',\n            message: 'Guest already has a room assignment for these dates',\n          },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as RoomAssignment };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Retrieves a single room assignment by ID.\n */\nexport async function getRoomAssignment(id: string): Promise<Result<RoomAssignment>> {\n  try {\n\n    const { data, error } = await supabase\n      .from('room_assignments')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Room assignment not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(data) as RoomAssignment };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Updates an existing room assignment.\n */\nexport async function updateRoomAssignment(id: string, data: UpdateRoomAssignmentDTO): Promise<Result<RoomAssignment>> {\n  try {\n    const validation = updateRoomAssignmentSchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const sanitized: any = { ...validation.data };\n    if (sanitized.notes) {\n      sanitized.notes = sanitizeInput(sanitized.notes);\n    }\n\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('room_assignments')\n      .update(dbData)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Room assignment not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as RoomAssignment };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Deletes a room assignment by ID.\n */\nexport async function deleteRoomAssignment(id: string): Promise<Result<void>> {\n  try {\n\n    const { error } = await supabase.from('room_assignments').delete().eq('id', id);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Lists room assignments for a specific guest.\n */\nexport async function listGuestRoomAssignments(guestId: string): Promise<Result<RoomAssignment[]>> {\n  try {\n\n    const { data, error } = await supabase\n      .from('room_assignments')\n      .select('*')\n      .eq('guest_id', guestId)\n      .order('check_in', { ascending: true });\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const assignments = data.map((assignment) => toCamelCase(assignment) as RoomAssignment);\n    return { success: true, data: assignments };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Lists room assignments for a specific room type.\n */\nexport async function listRoomTypeAssignments(roomTypeId: string): Promise<Result<RoomAssignment[]>> {\n  try {\n\n    const { data, error } = await supabase\n      .from('room_assignments')\n      .select('*')\n      .eq('room_type_id', roomTypeId)\n      .order('check_in', { ascending: true });\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const assignments = data.map((assignment) => toCamelCase(assignment) as RoomAssignment);\n    return { success: true, data: assignments };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n// ============================================================================\n// COST CALCULATION OPERATIONS\n// ============================================================================\n\n/**\n * Calculates the cost for a room assignment including subsidies.\n */\nexport async function calculateRoomCost(params: CalculateCostDTO): Promise<Result<RoomCost>> {\n  try {\n    const validation = calculateCostSchema.safeParse(params);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { roomTypeId, checkIn, checkOut } = validation.data;\n\n    // Get room type details\n    const roomTypeResult = await getRoomType(roomTypeId);\n    if (!roomTypeResult.success) {\n      return roomTypeResult as Result<RoomCost>;\n    }\n\n    const roomType = roomTypeResult.data;\n\n    // Calculate number of nights\n    const checkInDate = new Date(checkIn);\n    const checkOutDate = new Date(checkOut);\n    const numberOfNights = Math.ceil((checkOutDate.getTime() - checkInDate.getTime()) / (1000 * 60 * 60 * 24));\n\n    // Calculate costs\n    const pricePerNight = roomType.pricePerNight;\n    const subsidyPerNight = roomType.hostSubsidyPerNight || 0;\n    const totalCost = pricePerNight * numberOfNights;\n    const totalSubsidy = subsidyPerNight * numberOfNights;\n    const guestCost = totalCost - totalSubsidy;\n\n    return {\n      success: true,\n      data: {\n        totalCost,\n        totalSubsidy,\n        guestCost,\n        numberOfNights,\n        pricePerNight,\n        subsidyPerNight,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Gets room type with availability information.\n */\nexport async function getRoomTypeWithAvailability(\n  roomTypeId: string,\n  checkIn: string,\n  checkOut: string\n): Promise<Result<RoomTypeWithAvailability>> {\n  try {\n    const roomTypeResult = await getRoomType(roomTypeId);\n    if (!roomTypeResult.success) {\n      return roomTypeResult as Result<RoomTypeWithAvailability>;\n    }\n\n    const roomType = roomTypeResult.data;\n\n\n    // Count overlapping assignments\n    const { data, error } = await supabase\n      .from('room_assignments')\n      .select('id')\n      .eq('room_type_id', roomTypeId)\n      .or(`check_in.lte.${checkOut},check_out.gte.${checkIn}`);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const assignedRooms = data.length;\n    const availableRooms = Math.max(0, roomType.totalRooms - assignedRooms);\n\n    return {\n      success: true,\n      data: {\n        ...roomType,\n        assignedRooms,\n        availableRooms,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n"],"names":["calculateRoomCost","createAccommodation","createRoomAssignment","createRoomType","deleteAccommodation","deleteRoomAssignment","deleteRoomType","getAccommodation","getAccommodationWithRoomTypes","getRoomAssignment","getRoomType","getRoomTypeWithAvailability","listAccommodations","listGuestRoomAssignments","listRoomTypeAssignments","listRoomTypes","searchAccommodations","updateAccommodation","updateRoomAssignment","updateRoomType","supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","toSnakeCase","obj","snakeObj","key","snakeKey","replace","letter","toLowerCase","toCamelCase","camelObj","camelKey","_","toUpperCase","data","validation","createAccommodationSchema","safeParse","success","error","code","message","details","issues","sanitized","name","sanitizeInput","address","description","sanitizeRichText","dbData","result","from","insert","select","single","Error","id","eq","updateAccommodationSchema","update","delete","undefined","filters","page","pageSize","filtersWithDefaults","accommodationFilterSchema","filterParams","to","query","count","locationId","is","status","order","ascending","range","accommodations","map","accommodation","total","totalPages","Math","ceil","searchParams","accommodationSearchSchema","sanitizedQuery","or","createRoomTypeSchema","updateRoomTypeSchema","accommodationId","roomTypes","roomType","accommodationResult","roomTypesResult","createRoomAssignmentSchema","notes","updateRoomAssignmentSchema","guestId","assignments","assignment","roomTypeId","params","calculateCostSchema","checkIn","checkOut","roomTypeResult","checkInDate","Date","checkOutDate","numberOfNights","getTime","pricePerNight","subsidyPerNight","hostSubsidyPerNight","totalCost","totalSubsidy","guestCost","assignedRooms","length","availableRooms","max","totalRooms"],"mappings":"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"}