8aea48a1e3a94f0a866924b0fe1bed7c
/**
 * Database Query Optimization Utilities
 * 
 * Provides utilities for:
 * - Selecting only needed fields
 * - Implementing pagination (50 items per page default)
 * - Query performance monitoring
 * 
 * Requirements: 20.1, 20.4
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get DEFAULT_PAGE_SIZE () {
        return DEFAULT_PAGE_SIZE;
    },
    get FIELD_SELECTIONS () {
        return FIELD_SELECTIONS;
    },
    get MAX_PAGE_SIZE () {
        return MAX_PAGE_SIZE;
    },
    get buildPaginatedResult () {
        return buildPaginatedResult;
    },
    get calculatePaginationRange () {
        return calculatePaginationRange;
    },
    get clearQueryMetrics () {
        return clearQueryMetrics;
    },
    get endQueryMonitoring () {
        return endQueryMonitoring;
    },
    get executePaginatedQuery () {
        return executePaginatedQuery;
    },
    get getAverageQueryDuration () {
        return getAverageQueryDuration;
    },
    get getQueryMetrics () {
        return getQueryMetrics;
    },
    get startQueryMonitoring () {
        return startQueryMonitoring;
    }
});
const DEFAULT_PAGE_SIZE = 50;
const MAX_PAGE_SIZE = 100;
function calculatePaginationRange(page = 1, pageSize = DEFAULT_PAGE_SIZE) {
    // Validate and constrain inputs
    const validPage = Math.max(1, page);
    const validPageSize = Math.min(Math.max(1, pageSize), MAX_PAGE_SIZE);
    const from = (validPage - 1) * validPageSize;
    const to = from + validPageSize - 1;
    return {
        from,
        to
    };
}
function buildPaginatedResult(data, totalCount, page = 1, pageSize = DEFAULT_PAGE_SIZE) {
    const validPage = Math.max(1, page);
    const validPageSize = Math.min(Math.max(1, pageSize), MAX_PAGE_SIZE);
    const totalPages = Math.ceil(totalCount / validPageSize);
    return {
        data,
        pagination: {
            page: validPage,
            pageSize: validPageSize,
            totalCount,
            totalPages,
            hasNextPage: validPage < totalPages,
            hasPreviousPage: validPage > 1
        }
    };
}
async function executePaginatedQuery(query, params = {}) {
    const { page = 1, pageSize = DEFAULT_PAGE_SIZE } = params;
    const { from, to } = calculatePaginationRange(page, pageSize);
    const { data, error, count } = await query.range(from, to);
    if (error) {
        throw new Error(`Query failed: ${error.message}`);
    }
    return buildPaginatedResult(data || [], count || 0, page, pageSize);
}
const FIELD_SELECTIONS = {
    // Guest list view - minimal fields
    guestList: 'id, first_name, last_name, email, age_type, guest_type, group_id',
    // Guest detail view - all fields
    guestDetail: '*',
    // Event list view
    eventList: 'id, slug, title, event_type, event_date, event_time, is_active, location_id',
    // Event detail view
    eventDetail: '*',
    // Activity list view
    activityList: 'id, slug, title, activity_type, activity_date, activity_time, capacity, cost_per_person',
    // Activity detail view
    activityDetail: '*',
    // Content page list view
    contentPageList: 'id, slug, title, status, created_at, updated_at',
    // Content page detail view
    contentPageDetail: '*',
    // Location list view
    locationList: 'id, name, address, parent_location_id',
    // Location detail view
    locationDetail: '*',
    // Vendor list view
    vendorList: 'id, name, category, cost, payment_status',
    // Vendor detail view
    vendorDetail: '*',
    // Photo list view
    photoList: 'id, photo_url, caption, moderation_status, page_type, page_id, created_at',
    // Photo detail view
    photoDetail: '*',
    // Audit log list view
    auditLogList: 'id, timestamp, user_id, action, entity_type, entity_id, description',
    // Audit log detail view
    auditLogDetail: '*'
};
const queryMetrics = [];
function startQueryMonitoring(queryName) {
    return performance.now();
}
function endQueryMonitoring(queryName, startTime, recordCount) {
    const endTime = performance.now();
    const duration = endTime - startTime;
    const metrics = {
        queryName,
        startTime,
        endTime,
        duration,
        recordCount
    };
    queryMetrics.push(metrics);
    // Log slow queries (> 500ms)
    if (duration > 500) {
        console.warn(`Slow query detected: ${queryName} took ${duration.toFixed(2)}ms`);
    }
    // Keep only last 100 metrics
    if (queryMetrics.length > 100) {
        queryMetrics.shift();
    }
}
function getQueryMetrics() {
    return [
        ...queryMetrics
    ];
}
function getAverageQueryDuration(queryName) {
    const relevantMetrics = queryMetrics.filter((m)=>m.queryName === queryName);
    if (relevantMetrics.length === 0) {
        return 0;
    }
    const totalDuration = relevantMetrics.reduce((sum, m)=>sum + m.duration, 0);
    return totalDuration / relevantMetrics.length;
}
function clearQueryMetrics() {
    queryMetrics.length = 0;
} /**
 * Index recommendations for frequently queried fields
 * 
 * These indexes should be created in the database for optimal performance:
 * 
 * Guests table:
 * - CREATE INDEX idx_guests_group_id ON guests(group_id);
 * - CREATE INDEX idx_guests_email ON guests(email);
 * - CREATE INDEX idx_guests_last_name ON guests(last_name);
 * 
 * Events table:
 * - CREATE INDEX idx_events_slug ON events(slug);
 * - CREATE INDEX idx_events_event_date ON events(event_date);
 * - CREATE INDEX idx_events_location_id ON events(location_id);
 * - CREATE INDEX idx_events_is_active ON events(is_active);
 * 
 * Activities table:
 * - CREATE INDEX idx_activities_slug ON activities(slug);
 * - CREATE INDEX idx_activities_activity_date ON activities(activity_date);
 * - CREATE INDEX idx_activities_event_id ON activities(event_id);
 * 
 * Content Pages table:
 * - CREATE INDEX idx_content_pages_slug ON content_pages(slug);
 * - CREATE INDEX idx_content_pages_status ON content_pages(status);
 * 
 * Sections table:
 * - CREATE INDEX idx_sections_page_type_page_id ON sections(page_type, page_id);
 * - CREATE INDEX idx_sections_display_order ON sections(display_order);
 * 
 * Locations table:
 * - CREATE INDEX idx_locations_parent_location_id ON locations(parent_location_id);
 * 
 * Photos table:
 * - CREATE INDEX idx_photos_moderation_status ON photos(moderation_status);
 * - CREATE INDEX idx_photos_page_type_page_id ON photos(page_type, page_id);
 * 
 * Audit Logs table:
 * - CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
 * - CREATE INDEX idx_audit_logs_entity_type ON audit_logs(entity_type);
 * - CREATE INDEX idx_audit_logs_timestamp ON audit_logs(timestamp DESC);
 * 
 * RSVPs table:
 * - CREATE INDEX idx_rsvps_guest_id ON rsvps(guest_id);
 * - CREATE INDEX idx_rsvps_activity_id ON rsvps(activity_id);
 * - CREATE INDEX idx_rsvps_event_id ON rsvps(event_id);
 */ 

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvbGliL3F1ZXJ5T3B0aW1pemF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGF0YWJhc2UgUXVlcnkgT3B0aW1pemF0aW9uIFV0aWxpdGllc1xuICogXG4gKiBQcm92aWRlcyB1dGlsaXRpZXMgZm9yOlxuICogLSBTZWxlY3Rpbmcgb25seSBuZWVkZWQgZmllbGRzXG4gKiAtIEltcGxlbWVudGluZyBwYWdpbmF0aW9uICg1MCBpdGVtcyBwZXIgcGFnZSBkZWZhdWx0KVxuICogLSBRdWVyeSBwZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMjAuMSwgMjAuNFxuICovXG5cbmltcG9ydCB0eXBlIHsgU3VwYWJhc2VDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vKipcbiAqIERlZmF1bHQgcGFnZSBzaXplIGZvciBwYWdpbmF0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBERUZBVUxUX1BBR0VfU0laRSA9IDUwO1xuXG4vKipcbiAqIE1heGltdW0gcGFnZSBzaXplIHRvIHByZXZlbnQgcGVyZm9ybWFuY2UgaXNzdWVzXG4gKi9cbmV4cG9ydCBjb25zdCBNQVhfUEFHRV9TSVpFID0gMTAwO1xuXG4vKipcbiAqIFBhZ2luYXRpb24gcGFyYW1ldGVyc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhZ2luYXRpb25QYXJhbXMge1xuICBwYWdlPzogbnVtYmVyO1xuICBwYWdlU2l6ZT86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBQYWdpbmF0aW9uIHJlc3VsdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhZ2luYXRlZFJlc3VsdDxUPiB7XG4gIGRhdGE6IFRbXTtcbiAgcGFnaW5hdGlvbjoge1xuICAgIHBhZ2U6IG51bWJlcjtcbiAgICBwYWdlU2l6ZTogbnVtYmVyO1xuICAgIHRvdGFsQ291bnQ6IG51bWJlcjtcbiAgICB0b3RhbFBhZ2VzOiBudW1iZXI7XG4gICAgaGFzTmV4dFBhZ2U6IGJvb2xlYW47XG4gICAgaGFzUHJldmlvdXNQYWdlOiBib29sZWFuO1xuICB9O1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBwYWdpbmF0aW9uIHJhbmdlIGZvciBTdXBhYmFzZSBxdWVyaWVzXG4gKiBcbiAqIEBwYXJhbSBwYWdlIC0gUGFnZSBudW1iZXIgKDEtaW5kZXhlZClcbiAqIEBwYXJhbSBwYWdlU2l6ZSAtIE51bWJlciBvZiBpdGVtcyBwZXIgcGFnZVxuICogQHJldHVybnMgT2JqZWN0IHdpdGggZnJvbSBhbmQgdG8gaW5kaWNlcyBmb3IgU3VwYWJhc2UgcmFuZ2UoKVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUGFnaW5hdGlvblJhbmdlKFxuICBwYWdlOiBudW1iZXIgPSAxLFxuICBwYWdlU2l6ZTogbnVtYmVyID0gREVGQVVMVF9QQUdFX1NJWkVcbik6IHsgZnJvbTogbnVtYmVyOyB0bzogbnVtYmVyIH0ge1xuICAvLyBWYWxpZGF0ZSBhbmQgY29uc3RyYWluIGlucHV0c1xuICBjb25zdCB2YWxpZFBhZ2UgPSBNYXRoLm1heCgxLCBwYWdlKTtcbiAgY29uc3QgdmFsaWRQYWdlU2l6ZSA9IE1hdGgubWluKE1hdGgubWF4KDEsIHBhZ2VTaXplKSwgTUFYX1BBR0VfU0laRSk7XG5cbiAgY29uc3QgZnJvbSA9ICh2YWxpZFBhZ2UgLSAxKSAqIHZhbGlkUGFnZVNpemU7XG4gIGNvbnN0IHRvID0gZnJvbSArIHZhbGlkUGFnZVNpemUgLSAxO1xuXG4gIHJldHVybiB7IGZyb20sIHRvIH07XG59XG5cbi8qKlxuICogQnVpbGQgcGFnaW5hdGVkIHJlc3VsdCBvYmplY3RcbiAqIFxuICogQHBhcmFtIGRhdGEgLSBRdWVyeSByZXN1bHQgZGF0YVxuICogQHBhcmFtIHRvdGFsQ291bnQgLSBUb3RhbCBjb3VudCBmcm9tIHF1ZXJ5XG4gKiBAcGFyYW0gcGFnZSAtIEN1cnJlbnQgcGFnZSBudW1iZXJcbiAqIEBwYXJhbSBwYWdlU2l6ZSAtIEl0ZW1zIHBlciBwYWdlXG4gKiBAcmV0dXJucyBQYWdpbmF0ZWQgcmVzdWx0IHdpdGggbWV0YWRhdGFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkUGFnaW5hdGVkUmVzdWx0PFQ+KFxuICBkYXRhOiBUW10sXG4gIHRvdGFsQ291bnQ6IG51bWJlcixcbiAgcGFnZTogbnVtYmVyID0gMSxcbiAgcGFnZVNpemU6IG51bWJlciA9IERFRkFVTFRfUEFHRV9TSVpFXG4pOiBQYWdpbmF0ZWRSZXN1bHQ8VD4ge1xuICBjb25zdCB2YWxpZFBhZ2UgPSBNYXRoLm1heCgxLCBwYWdlKTtcbiAgY29uc3QgdmFsaWRQYWdlU2l6ZSA9IE1hdGgubWluKE1hdGgubWF4KDEsIHBhZ2VTaXplKSwgTUFYX1BBR0VfU0laRSk7XG4gIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWxDb3VudCAvIHZhbGlkUGFnZVNpemUpO1xuXG4gIHJldHVybiB7XG4gICAgZGF0YSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBwYWdlOiB2YWxpZFBhZ2UsXG4gICAgICBwYWdlU2l6ZTogdmFsaWRQYWdlU2l6ZSxcbiAgICAgIHRvdGFsQ291bnQsXG4gICAgICB0b3RhbFBhZ2VzLFxuICAgICAgaGFzTmV4dFBhZ2U6IHZhbGlkUGFnZSA8IHRvdGFsUGFnZXMsXG4gICAgICBoYXNQcmV2aW91c1BhZ2U6IHZhbGlkUGFnZSA+IDEsXG4gICAgfSxcbiAgfTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlIHBhZ2luYXRlZCBxdWVyeSB3aXRoIGF1dG9tYXRpYyByYW5nZSBjYWxjdWxhdGlvblxuICogXG4gKiBAcGFyYW0gcXVlcnkgLSBTdXBhYmFzZSBxdWVyeSBidWlsZGVyXG4gKiBAcGFyYW0gcGFyYW1zIC0gUGFnaW5hdGlvbiBwYXJhbWV0ZXJzXG4gKiBAcmV0dXJucyBQYWdpbmF0ZWQgcmVzdWx0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlUGFnaW5hdGVkUXVlcnk8VD4oXG4gIHF1ZXJ5OiBhbnksXG4gIHBhcmFtczogUGFnaW5hdGlvblBhcmFtcyA9IHt9XG4pOiBQcm9taXNlPFBhZ2luYXRlZFJlc3VsdDxUPj4ge1xuICBjb25zdCB7IHBhZ2UgPSAxLCBwYWdlU2l6ZSA9IERFRkFVTFRfUEFHRV9TSVpFIH0gPSBwYXJhbXM7XG4gIGNvbnN0IHsgZnJvbSwgdG8gfSA9IGNhbGN1bGF0ZVBhZ2luYXRpb25SYW5nZShwYWdlLCBwYWdlU2l6ZSk7XG5cbiAgY29uc3QgeyBkYXRhLCBlcnJvciwgY291bnQgfSA9IGF3YWl0IHF1ZXJ5XG4gICAgLnJhbmdlKGZyb20sIHRvKTtcblxuICBpZiAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFF1ZXJ5IGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICB9XG5cbiAgcmV0dXJuIGJ1aWxkUGFnaW5hdGVkUmVzdWx0KGRhdGEgfHwgW10sIGNvdW50IHx8IDAsIHBhZ2UsIHBhZ2VTaXplKTtcbn1cblxuLyoqXG4gKiBGaWVsZCBzZWxlY3Rpb24gdXRpbGl0aWVzXG4gKi9cblxuLyoqXG4gKiBDb21tb24gZmllbGQgc2VsZWN0aW9ucyBmb3IgZGlmZmVyZW50IGVudGl0aWVzXG4gKiBTZWxlY3Rpbmcgb25seSBuZWVkZWQgZmllbGRzIGltcHJvdmVzIHF1ZXJ5IHBlcmZvcm1hbmNlXG4gKi9cbmV4cG9ydCBjb25zdCBGSUVMRF9TRUxFQ1RJT05TID0ge1xuICAvLyBHdWVzdCBsaXN0IHZpZXcgLSBtaW5pbWFsIGZpZWxkc1xuICBndWVzdExpc3Q6ICdpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBlbWFpbCwgYWdlX3R5cGUsIGd1ZXN0X3R5cGUsIGdyb3VwX2lkJyxcbiAgXG4gIC8vIEd1ZXN0IGRldGFpbCB2aWV3IC0gYWxsIGZpZWxkc1xuICBndWVzdERldGFpbDogJyonLFxuICBcbiAgLy8gRXZlbnQgbGlzdCB2aWV3XG4gIGV2ZW50TGlzdDogJ2lkLCBzbHVnLCB0aXRsZSwgZXZlbnRfdHlwZSwgZXZlbnRfZGF0ZSwgZXZlbnRfdGltZSwgaXNfYWN0aXZlLCBsb2NhdGlvbl9pZCcsXG4gIFxuICAvLyBFdmVudCBkZXRhaWwgdmlld1xuICBldmVudERldGFpbDogJyonLFxuICBcbiAgLy8gQWN0aXZpdHkgbGlzdCB2aWV3XG4gIGFjdGl2aXR5TGlzdDogJ2lkLCBzbHVnLCB0aXRsZSwgYWN0aXZpdHlfdHlwZSwgYWN0aXZpdHlfZGF0ZSwgYWN0aXZpdHlfdGltZSwgY2FwYWNpdHksIGNvc3RfcGVyX3BlcnNvbicsXG4gIFxuICAvLyBBY3Rpdml0eSBkZXRhaWwgdmlld1xuICBhY3Rpdml0eURldGFpbDogJyonLFxuICBcbiAgLy8gQ29udGVudCBwYWdlIGxpc3Qgdmlld1xuICBjb250ZW50UGFnZUxpc3Q6ICdpZCwgc2x1ZywgdGl0bGUsIHN0YXR1cywgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCcsXG4gIFxuICAvLyBDb250ZW50IHBhZ2UgZGV0YWlsIHZpZXdcbiAgY29udGVudFBhZ2VEZXRhaWw6ICcqJyxcbiAgXG4gIC8vIExvY2F0aW9uIGxpc3Qgdmlld1xuICBsb2NhdGlvbkxpc3Q6ICdpZCwgbmFtZSwgYWRkcmVzcywgcGFyZW50X2xvY2F0aW9uX2lkJyxcbiAgXG4gIC8vIExvY2F0aW9uIGRldGFpbCB2aWV3XG4gIGxvY2F0aW9uRGV0YWlsOiAnKicsXG4gIFxuICAvLyBWZW5kb3IgbGlzdCB2aWV3XG4gIHZlbmRvckxpc3Q6ICdpZCwgbmFtZSwgY2F0ZWdvcnksIGNvc3QsIHBheW1lbnRfc3RhdHVzJyxcbiAgXG4gIC8vIFZlbmRvciBkZXRhaWwgdmlld1xuICB2ZW5kb3JEZXRhaWw6ICcqJyxcbiAgXG4gIC8vIFBob3RvIGxpc3Qgdmlld1xuICBwaG90b0xpc3Q6ICdpZCwgcGhvdG9fdXJsLCBjYXB0aW9uLCBtb2RlcmF0aW9uX3N0YXR1cywgcGFnZV90eXBlLCBwYWdlX2lkLCBjcmVhdGVkX2F0JyxcbiAgXG4gIC8vIFBob3RvIGRldGFpbCB2aWV3XG4gIHBob3RvRGV0YWlsOiAnKicsXG4gIFxuICAvLyBBdWRpdCBsb2cgbGlzdCB2aWV3XG4gIGF1ZGl0TG9nTGlzdDogJ2lkLCB0aW1lc3RhbXAsIHVzZXJfaWQsIGFjdGlvbiwgZW50aXR5X3R5cGUsIGVudGl0eV9pZCwgZGVzY3JpcHRpb24nLFxuICBcbiAgLy8gQXVkaXQgbG9nIGRldGFpbCB2aWV3XG4gIGF1ZGl0TG9nRGV0YWlsOiAnKicsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIFF1ZXJ5IHBlcmZvcm1hbmNlIG1vbml0b3JpbmdcbiAqL1xuXG5pbnRlcmZhY2UgUXVlcnlNZXRyaWNzIHtcbiAgcXVlcnlOYW1lOiBzdHJpbmc7XG4gIHN0YXJ0VGltZTogbnVtYmVyO1xuICBlbmRUaW1lOiBudW1iZXI7XG4gIGR1cmF0aW9uOiBudW1iZXI7XG4gIHJlY29yZENvdW50OiBudW1iZXI7XG59XG5cbmNvbnN0IHF1ZXJ5TWV0cmljczogUXVlcnlNZXRyaWNzW10gPSBbXTtcblxuLyoqXG4gKiBTdGFydCBtb25pdG9yaW5nIGEgcXVlcnlcbiAqIFxuICogQHBhcmFtIHF1ZXJ5TmFtZSAtIE5hbWUgb2YgdGhlIHF1ZXJ5IGZvciBpZGVudGlmaWNhdGlvblxuICogQHJldHVybnMgU3RhcnQgdGltZVxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RhcnRRdWVyeU1vbml0b3JpbmcocXVlcnlOYW1lOiBzdHJpbmcpOiBudW1iZXIge1xuICByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCk7XG59XG5cbi8qKlxuICogRW5kIG1vbml0b3JpbmcgYSBxdWVyeSBhbmQgbG9nIG1ldHJpY3NcbiAqIFxuICogQHBhcmFtIHF1ZXJ5TmFtZSAtIE5hbWUgb2YgdGhlIHF1ZXJ5XG4gKiBAcGFyYW0gc3RhcnRUaW1lIC0gU3RhcnQgdGltZSBmcm9tIHN0YXJ0UXVlcnlNb25pdG9yaW5nXG4gKiBAcGFyYW0gcmVjb3JkQ291bnQgLSBOdW1iZXIgb2YgcmVjb3JkcyByZXR1cm5lZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZW5kUXVlcnlNb25pdG9yaW5nKFxuICBxdWVyeU5hbWU6IHN0cmluZyxcbiAgc3RhcnRUaW1lOiBudW1iZXIsXG4gIHJlY29yZENvdW50OiBudW1iZXJcbik6IHZvaWQge1xuICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcblxuICBjb25zdCBtZXRyaWNzOiBRdWVyeU1ldHJpY3MgPSB7XG4gICAgcXVlcnlOYW1lLFxuICAgIHN0YXJ0VGltZSxcbiAgICBlbmRUaW1lLFxuICAgIGR1cmF0aW9uLFxuICAgIHJlY29yZENvdW50LFxuICB9O1xuXG4gIHF1ZXJ5TWV0cmljcy5wdXNoKG1ldHJpY3MpO1xuXG4gIC8vIExvZyBzbG93IHF1ZXJpZXMgKD4gNTAwbXMpXG4gIGlmIChkdXJhdGlvbiA+IDUwMCkge1xuICAgIGNvbnNvbGUud2FybihgU2xvdyBxdWVyeSBkZXRlY3RlZDogJHtxdWVyeU5hbWV9IHRvb2sgJHtkdXJhdGlvbi50b0ZpeGVkKDIpfW1zYCk7XG4gIH1cblxuICAvLyBLZWVwIG9ubHkgbGFzdCAxMDAgbWV0cmljc1xuICBpZiAocXVlcnlNZXRyaWNzLmxlbmd0aCA+IDEwMCkge1xuICAgIHF1ZXJ5TWV0cmljcy5zaGlmdCgpO1xuICB9XG59XG5cbi8qKlxuICogR2V0IHF1ZXJ5IHBlcmZvcm1hbmNlIG1ldHJpY3NcbiAqIFxuICogQHJldHVybnMgQXJyYXkgb2YgcXVlcnkgbWV0cmljc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UXVlcnlNZXRyaWNzKCk6IFF1ZXJ5TWV0cmljc1tdIHtcbiAgcmV0dXJuIFsuLi5xdWVyeU1ldHJpY3NdO1xufVxuXG4vKipcbiAqIEdldCBhdmVyYWdlIHF1ZXJ5IGR1cmF0aW9uIGJ5IG5hbWVcbiAqIFxuICogQHBhcmFtIHF1ZXJ5TmFtZSAtIE5hbWUgb2YgdGhlIHF1ZXJ5XG4gKiBAcmV0dXJucyBBdmVyYWdlIGR1cmF0aW9uIGluIG1pbGxpc2Vjb25kc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXZlcmFnZVF1ZXJ5RHVyYXRpb24ocXVlcnlOYW1lOiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCByZWxldmFudE1ldHJpY3MgPSBxdWVyeU1ldHJpY3MuZmlsdGVyKG0gPT4gbS5xdWVyeU5hbWUgPT09IHF1ZXJ5TmFtZSk7XG4gIFxuICBpZiAocmVsZXZhbnRNZXRyaWNzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgY29uc3QgdG90YWxEdXJhdGlvbiA9IHJlbGV2YW50TWV0cmljcy5yZWR1Y2UoKHN1bSwgbSkgPT4gc3VtICsgbS5kdXJhdGlvbiwgMCk7XG4gIHJldHVybiB0b3RhbER1cmF0aW9uIC8gcmVsZXZhbnRNZXRyaWNzLmxlbmd0aDtcbn1cblxuLyoqXG4gKiBDbGVhciBxdWVyeSBtZXRyaWNzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclF1ZXJ5TWV0cmljcygpOiB2b2lkIHtcbiAgcXVlcnlNZXRyaWNzLmxlbmd0aCA9IDA7XG59XG5cbi8qKlxuICogSW5kZXggcmVjb21tZW5kYXRpb25zIGZvciBmcmVxdWVudGx5IHF1ZXJpZWQgZmllbGRzXG4gKiBcbiAqIFRoZXNlIGluZGV4ZXMgc2hvdWxkIGJlIGNyZWF0ZWQgaW4gdGhlIGRhdGFiYXNlIGZvciBvcHRpbWFsIHBlcmZvcm1hbmNlOlxuICogXG4gKiBHdWVzdHMgdGFibGU6XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfZ3Vlc3RzX2dyb3VwX2lkIE9OIGd1ZXN0cyhncm91cF9pZCk7XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfZ3Vlc3RzX2VtYWlsIE9OIGd1ZXN0cyhlbWFpbCk7XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfZ3Vlc3RzX2xhc3RfbmFtZSBPTiBndWVzdHMobGFzdF9uYW1lKTtcbiAqIFxuICogRXZlbnRzIHRhYmxlOlxuICogLSBDUkVBVEUgSU5ERVggaWR4X2V2ZW50c19zbHVnIE9OIGV2ZW50cyhzbHVnKTtcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9ldmVudHNfZXZlbnRfZGF0ZSBPTiBldmVudHMoZXZlbnRfZGF0ZSk7XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfZXZlbnRzX2xvY2F0aW9uX2lkIE9OIGV2ZW50cyhsb2NhdGlvbl9pZCk7XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfZXZlbnRzX2lzX2FjdGl2ZSBPTiBldmVudHMoaXNfYWN0aXZlKTtcbiAqIFxuICogQWN0aXZpdGllcyB0YWJsZTpcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9hY3Rpdml0aWVzX3NsdWcgT04gYWN0aXZpdGllcyhzbHVnKTtcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9hY3Rpdml0aWVzX2FjdGl2aXR5X2RhdGUgT04gYWN0aXZpdGllcyhhY3Rpdml0eV9kYXRlKTtcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9hY3Rpdml0aWVzX2V2ZW50X2lkIE9OIGFjdGl2aXRpZXMoZXZlbnRfaWQpO1xuICogXG4gKiBDb250ZW50IFBhZ2VzIHRhYmxlOlxuICogLSBDUkVBVEUgSU5ERVggaWR4X2NvbnRlbnRfcGFnZXNfc2x1ZyBPTiBjb250ZW50X3BhZ2VzKHNsdWcpO1xuICogLSBDUkVBVEUgSU5ERVggaWR4X2NvbnRlbnRfcGFnZXNfc3RhdHVzIE9OIGNvbnRlbnRfcGFnZXMoc3RhdHVzKTtcbiAqIFxuICogU2VjdGlvbnMgdGFibGU6XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfc2VjdGlvbnNfcGFnZV90eXBlX3BhZ2VfaWQgT04gc2VjdGlvbnMocGFnZV90eXBlLCBwYWdlX2lkKTtcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9zZWN0aW9uc19kaXNwbGF5X29yZGVyIE9OIHNlY3Rpb25zKGRpc3BsYXlfb3JkZXIpO1xuICogXG4gKiBMb2NhdGlvbnMgdGFibGU6XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfbG9jYXRpb25zX3BhcmVudF9sb2NhdGlvbl9pZCBPTiBsb2NhdGlvbnMocGFyZW50X2xvY2F0aW9uX2lkKTtcbiAqIFxuICogUGhvdG9zIHRhYmxlOlxuICogLSBDUkVBVEUgSU5ERVggaWR4X3Bob3Rvc19tb2RlcmF0aW9uX3N0YXR1cyBPTiBwaG90b3MobW9kZXJhdGlvbl9zdGF0dXMpO1xuICogLSBDUkVBVEUgSU5ERVggaWR4X3Bob3Rvc19wYWdlX3R5cGVfcGFnZV9pZCBPTiBwaG90b3MocGFnZV90eXBlLCBwYWdlX2lkKTtcbiAqIFxuICogQXVkaXQgTG9ncyB0YWJsZTpcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9hdWRpdF9sb2dzX3VzZXJfaWQgT04gYXVkaXRfbG9ncyh1c2VyX2lkKTtcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9hdWRpdF9sb2dzX2VudGl0eV90eXBlIE9OIGF1ZGl0X2xvZ3MoZW50aXR5X3R5cGUpO1xuICogLSBDUkVBVEUgSU5ERVggaWR4X2F1ZGl0X2xvZ3NfdGltZXN0YW1wIE9OIGF1ZGl0X2xvZ3ModGltZXN0YW1wIERFU0MpO1xuICogXG4gKiBSU1ZQcyB0YWJsZTpcbiAqIC0gQ1JFQVRFIElOREVYIGlkeF9yc3Zwc19ndWVzdF9pZCBPTiByc3ZwcyhndWVzdF9pZCk7XG4gKiAtIENSRUFURSBJTkRFWCBpZHhfcnN2cHNfYWN0aXZpdHlfaWQgT04gcnN2cHMoYWN0aXZpdHlfaWQpO1xuICogLSBDUkVBVEUgSU5ERVggaWR4X3JzdnBzX2V2ZW50X2lkIE9OIHJzdnBzKGV2ZW50X2lkKTtcbiAqL1xuIl0sIm5hbWVzIjpbIkRFRkFVTFRfUEFHRV9TSVpFIiwiRklFTERfU0VMRUNUSU9OUyIsIk1BWF9QQUdFX1NJWkUiLCJidWlsZFBhZ2luYXRlZFJlc3VsdCIsImNhbGN1bGF0ZVBhZ2luYXRpb25SYW5nZSIsImNsZWFyUXVlcnlNZXRyaWNzIiwiZW5kUXVlcnlNb25pdG9yaW5nIiwiZXhlY3V0ZVBhZ2luYXRlZFF1ZXJ5IiwiZ2V0QXZlcmFnZVF1ZXJ5RHVyYXRpb24iLCJnZXRRdWVyeU1ldHJpY3MiLCJzdGFydFF1ZXJ5TW9uaXRvcmluZyIsInBhZ2UiLCJwYWdlU2l6ZSIsInZhbGlkUGFnZSIsIk1hdGgiLCJtYXgiLCJ2YWxpZFBhZ2VTaXplIiwibWluIiwiZnJvbSIsInRvIiwiZGF0YSIsInRvdGFsQ291bnQiLCJ0b3RhbFBhZ2VzIiwiY2VpbCIsInBhZ2luYXRpb24iLCJoYXNOZXh0UGFnZSIsImhhc1ByZXZpb3VzUGFnZSIsInF1ZXJ5IiwicGFyYW1zIiwiZXJyb3IiLCJjb3VudCIsInJhbmdlIiwiRXJyb3IiLCJtZXNzYWdlIiwiZ3Vlc3RMaXN0IiwiZ3Vlc3REZXRhaWwiLCJldmVudExpc3QiLCJldmVudERldGFpbCIsImFjdGl2aXR5TGlzdCIsImFjdGl2aXR5RGV0YWlsIiwiY29udGVudFBhZ2VMaXN0IiwiY29udGVudFBhZ2VEZXRhaWwiLCJsb2NhdGlvbkxpc3QiLCJsb2NhdGlvbkRldGFpbCIsInZlbmRvckxpc3QiLCJ2ZW5kb3JEZXRhaWwiLCJwaG90b0xpc3QiLCJwaG90b0RldGFpbCIsImF1ZGl0TG9nTGlzdCIsImF1ZGl0TG9nRGV0YWlsIiwicXVlcnlNZXRyaWNzIiwicXVlcnlOYW1lIiwicGVyZm9ybWFuY2UiLCJub3ciLCJzdGFydFRpbWUiLCJyZWNvcmRDb3VudCIsImVuZFRpbWUiLCJkdXJhdGlvbiIsIm1ldHJpY3MiLCJwdXNoIiwiY29uc29sZSIsIndhcm4iLCJ0b0ZpeGVkIiwibGVuZ3RoIiwic2hpZnQiLCJyZWxldmFudE1ldHJpY3MiLCJmaWx0ZXIiLCJtIiwidG90YWxEdXJhdGlvbiIsInJlZHVjZSIsInN1bSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7OztDQVNDOzs7Ozs7Ozs7OztRQU9ZQTtlQUFBQTs7UUFtSEFDO2VBQUFBOztRQTlHQUM7ZUFBQUE7O1FBdURHQztlQUFBQTs7UUF2QkFDO2VBQUFBOztRQXlOQUM7ZUFBQUE7O1FBMURBQztlQUFBQTs7UUExR01DO2VBQUFBOztRQXNKTkM7ZUFBQUE7O1FBVkFDO2VBQUFBOztRQTdDQUM7ZUFBQUE7OztBQXpMVCxNQUFNVixvQkFBb0I7QUFLMUIsTUFBTUUsZ0JBQWdCO0FBZ0N0QixTQUFTRSx5QkFDZE8sT0FBZSxDQUFDLEVBQ2hCQyxXQUFtQlosaUJBQWlCO0lBRXBDLGdDQUFnQztJQUNoQyxNQUFNYSxZQUFZQyxL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