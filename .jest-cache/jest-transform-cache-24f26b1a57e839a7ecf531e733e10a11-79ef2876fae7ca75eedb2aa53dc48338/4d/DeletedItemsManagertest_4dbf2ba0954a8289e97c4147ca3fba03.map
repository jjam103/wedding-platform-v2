{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/DeletedItemsManager.test.tsx"],"sourcesContent":["/**\n * Unit Tests: DeletedItemsManager Component\n * \n * Tests deleted items display, filtering, and actions.\n */\n\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { DeletedItemsManager } from './DeletedItemsManager';\n\n// Mock fetch\nglobal.fetch = jest.fn();\n\ndescribe('DeletedItemsManager', () => {\n  const mockOnRestore = jest.fn();\n  const mockOnPermanentDelete = jest.fn();\n\n  const mockDeletedItems = [\n    {\n      id: '1',\n      type: 'content_page' as const,\n      name: 'Test Page',\n      deleted_at: '2024-01-15T10:00:00Z',\n      deleted_by_email: 'admin@example.com',\n    },\n    {\n      id: '2',\n      type: 'event' as const,\n      name: 'Test Event',\n      deleted_at: '2024-01-16T10:00:00Z',\n      deleted_by_email: 'admin@example.com',\n    },\n    {\n      id: '3',\n      type: 'activity' as const,\n      name: 'Test Activity',\n      deleted_at: '2024-01-17T10:00:00Z',\n      deleted_by_email: 'admin@example.com',\n    },\n  ];\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (global.fetch as jest.Mock).mockResolvedValue({\n      json: async () => ({ success: true, data: mockDeletedItems }),\n    });\n  });\n\n  it('should render deleted items list', async () => {\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Test Page')).toBeInTheDocument();\n      expect(screen.getByText('Test Event')).toBeInTheDocument();\n      expect(screen.getByText('Test Activity')).toBeInTheDocument();\n    });\n  });\n\n  it('should display loading state', () => {\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    expect(screen.getByText('Loading deleted items...')).toBeInTheDocument();\n  });\n\n  it('should display error state', async () => {\n    (global.fetch as jest.Mock).mockResolvedValue({\n      json: async () => ({ success: false, error: { message: 'Test error' } }),\n    });\n\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText(/Test error/)).toBeInTheDocument();\n    });\n  });\n\n  it('should filter items by type', async () => {\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Test Page')).toBeInTheDocument();\n    });\n\n    // Change filter to events\n    const typeFilter = screen.getByLabelText('Filter by type');\n    fireEvent.change(typeFilter, { target: { value: 'event' } });\n\n    await waitFor(() => {\n      expect(global.fetch).toHaveBeenCalledWith(\n        expect.stringContaining('type=event')\n      );\n    });\n  });\n\n  it('should filter items by search query', async () => {\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Test Page')).toBeInTheDocument();\n    });\n\n    // Search for \"Event\"\n    const searchInput = screen.getByPlaceholderText('Search by name...');\n    fireEvent.change(searchInput, { target: { value: 'Event' } });\n\n    // Should show only Event\n    expect(screen.getByText('Test Event')).toBeInTheDocument();\n    expect(screen.queryByText('Test Page')).not.toBeInTheDocument();\n  });\n\n  it('should call onRestore when restore button clicked', async () => {\n    // Mock window.confirm\n    global.confirm = jest.fn(() => true);\n\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Test Page')).toBeInTheDocument();\n    });\n\n    // Click restore button\n    const restoreButtons = screen.getAllByText('Restore');\n    fireEvent.click(restoreButtons[0]);\n\n    await waitFor(() => {\n      expect(mockOnRestore).toHaveBeenCalledWith('1', 'content_page');\n    });\n  });\n\n  it('should call onPermanentDelete when delete permanently button clicked', async () => {\n    // Mock window.confirm\n    global.confirm = jest.fn(() => true);\n\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Test Page')).toBeInTheDocument();\n    });\n\n    // Click delete permanently button\n    const deleteButtons = screen.getAllByText('Delete Permanently');\n    fireEvent.click(deleteButtons[0]);\n\n    await waitFor(() => {\n      expect(mockOnPermanentDelete).toHaveBeenCalledWith('1', 'content_page');\n    });\n  });\n\n  it('should not call onRestore if user cancels confirmation', async () => {\n    // Mock window.confirm to return false\n    global.confirm = jest.fn(() => false);\n\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Test Page')).toBeInTheDocument();\n    });\n\n    // Click restore button\n    const restoreButtons = screen.getAllByText('Restore');\n    fireEvent.click(restoreButtons[0]);\n\n    // Should not call onRestore\n    expect(mockOnRestore).not.toHaveBeenCalled();\n  });\n\n  it('should display empty state when no items', async () => {\n    (global.fetch as jest.Mock).mockResolvedValue({\n      json: async () => ({ success: true, data: [] }),\n    });\n\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('No deleted items')).toBeInTheDocument();\n    });\n  });\n\n  it('should refresh items when refresh button clicked', async () => {\n    render(\n      <DeletedItemsManager\n        onRestore={mockOnRestore}\n        onPermanentDelete={mockOnPermanentDelete}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Test Page')).toBeInTheDocument();\n    });\n\n    // Click refresh button\n    const refreshButton = screen.getByText('Refresh');\n    fireEvent.click(refreshButton);\n\n    await waitFor(() => {\n      expect(global.fetch).toHaveBeenCalledTimes(2);\n    });\n  });\n});\n"],"names":["global","fetch","jest","fn","describe","mockOnRestore","mockOnPermanentDelete","mockDeletedItems","id","type","name","deleted_at","deleted_by_email","beforeEach","clearAllMocks","mockResolvedValue","json","success","data","it","render","DeletedItemsManager","onRestore","onPermanentDelete","waitFor","expect","screen","getByText","toBeInTheDocument","error","message","typeFilter","getByLabelText","fireEvent","change","target","value","toHaveBeenCalledWith","stringContaining","searchInput","getByPlaceholderText","queryByText","not","confirm","restoreButtons","getAllByText","click","deleteButtons","toHaveBeenCalled","refreshButton","toHaveBeenCalledTimes"],"mappings":"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"}