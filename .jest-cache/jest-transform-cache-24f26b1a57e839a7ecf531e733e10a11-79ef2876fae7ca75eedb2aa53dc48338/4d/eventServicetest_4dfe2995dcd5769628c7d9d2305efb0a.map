{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/eventService.test.ts"],"sourcesContent":["import { describe, it, expect, jest, beforeEach } from '@jest/globals';\nimport type { CreateEventDTO, UpdateEventDTO, EventFilterDTO, EventSearchDTO, ConflictCheckDTO } from '@/schemas/eventSchemas';\n\n// Set environment variables FIRST\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\nprocess.env.SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n\n// Mock sanitization utilities\njest.mock('../utils/sanitization', () => ({\n  sanitizeInput: jest.fn((input: string) => input.trim()),\n  sanitizeRichText: jest.fn((input: string) => input.trim()),\n}));\n\n// Mock Supabase with shared client instance (Pattern A)\njest.mock('@supabase/supabase-js', () => {\n  const mockFrom = jest.fn();\n  const mockSupabaseClient = {\n    from: mockFrom,\n  };\n  \n  return {\n    createClient: jest.fn(() => mockSupabaseClient),\n    __mockFrom: mockFrom,\n  };\n});\n\n// Import service using require() AFTER mocking (Pattern A requirement)\nconst eventServiceModule = require('./eventService');\nconst eventService = eventServiceModule;\n\n// Get the mocked from function\nconst { __mockFrom: mockFrom } = require('@supabase/supabase-js');\n\ndescribe('eventService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Set up environment variables\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n  });\n\n  describe('create', () => {\n    const validData: CreateEventDTO = {\n      name: 'Wedding Ceremony',\n      eventType: 'ceremony',\n      startDate: '2025-06-15T14:00:00Z',\n      endDate: '2025-06-15T15:00:00Z',\n      locationId: '123e4567-e89b-12d3-a456-426614174000',\n      description: 'Beautiful ceremony by the beach',\n    };\n\n    it('should return success with event data when valid input provided', async () => {\n      const mockEvent = {\n        id: 'event-1',\n        name: 'Wedding Ceremony',\n        event_type: 'ceremony',\n        start_date: '2025-06-15T14:00:00Z',\n        end_date: '2025-06-15T15:00:00Z',\n        location_id: validData.locationId,\n        description: 'Beautiful ceremony by the beach',\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      // Mock conflict check (no conflicts) - first call to from()\n      // Mock event creation - second call to from()\n      let callCount = 0;\n      mockFrom.mockImplementation(() => {\n        callCount++;\n        if (callCount === 1) {\n          // Conflict check query\n          const mockEq = jest.fn().mockResolvedValue({\n            data: [],\n            error: null,\n          });\n          const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n          return { select: mockSelect };\n        } else {\n          // Insert query\n          const mockSingle = jest.fn().mockResolvedValue({\n            data: mockEvent,\n            error: null,\n          });\n          const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n          const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n          return { insert: mockInsert };\n        }\n      });\n\n      const result = await eventService.create(validData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('event-1');\n        expect(result.data.name).toBe('Wedding Ceremony');\n        expect(result.data.eventType).toBe('ceremony');\n        expect(result.data.locationId).toBe(validData.locationId);\n      }\n    });\n\n    it('should return VALIDATION_ERROR when name is missing', async () => {\n      const invalidData = { ...validData, name: '' };\n      const result = await eventService.create(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return VALIDATION_ERROR when eventType is invalid', async () => {\n      const invalidData = { ...validData, eventType: 'invalid-type' as any };\n      const result = await eventService.create(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return SCHEDULING_CONFLICT when event conflicts with existing events', async () => {\n      const conflictingEvent = {\n        id: 'existing-event',\n        name: 'Existing Event',\n        start_date: '2025-06-15T13:30:00Z',\n        end_date: '2025-06-15T14:30:00Z',\n      };\n\n      // Mock conflict check (conflict found)\n      const mockEq = jest.fn().mockResolvedValue({\n        data: [conflictingEvent],\n        error: null,\n      });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.create(validData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('SCHEDULING_CONFLICT');\n        expect(result.error.details).toHaveLength(1);\n      }\n    });\n\n    it('should return DATABASE_ERROR when insert fails', async () => {\n      // Mock conflict check (no conflicts) - first call\n      // Mock database error - second call\n      let callCount = 0;\n      mockFrom.mockImplementation(() => {\n        callCount++;\n        if (callCount === 1) {\n          // Conflict check query\n          const mockEq = jest.fn().mockResolvedValue({\n            data: [],\n            error: null,\n          });\n          const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n          return { select: mockSelect };\n        } else {\n          // Insert query with error\n          const mockSingle = jest.fn().mockResolvedValue({\n            data: null,\n            error: { message: 'Connection failed' },\n          });\n          const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n          const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n          return { insert: mockInsert };\n        }\n      });\n\n      const result = await eventService.create(validData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n\n    it('should sanitize input to prevent XSS attacks', async () => {\n      const maliciousData = {\n        ...validData,\n        name: '<script>alert(\"xss\")</script>Wedding',\n        description: '<img src=x onerror=alert(1)>Description',\n      };\n\n      // Mock conflict check (no conflicts) - first call\n      // Mock successful creation - second call\n      let callCount = 0;\n      mockFrom.mockImplementation(() => {\n        callCount++;\n        if (callCount === 1) {\n          // Conflict check query\n          const mockEq = jest.fn().mockResolvedValue({\n            data: [],\n            error: null,\n          });\n          const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n          return { select: mockSelect };\n        } else {\n          // Insert query\n          const mockSingle = jest.fn().mockResolvedValue({\n            data: {\n              id: 'event-1',\n              name: 'Wedding',\n              description: 'Description',\n            },\n            error: null,\n          });\n          const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n          const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n          return { insert: mockInsert };\n        }\n      });\n\n      const result = await eventService.create(maliciousData);\n\n      expect(result.success).toBe(true);\n      \n      // Verify sanitization was called\n      const { sanitizeInput, sanitizeRichText } = require('../utils/sanitization');\n      expect(sanitizeInput).toHaveBeenCalledWith(maliciousData.name);\n      expect(sanitizeRichText).toHaveBeenCalledWith(maliciousData.description);\n    });\n  });\n\n  describe('get', () => {\n    it('should return success with event data when event exists', async () => {\n      const mockEvent = {\n        id: 'event-1',\n        name: 'Wedding Ceremony',\n        event_type: 'ceremony',\n        start_date: '2025-06-15T14:00:00Z',\n        end_date: '2025-06-15T15:00:00Z',\n        location_id: '123e4567-e89b-12d3-a456-426614174000',\n        description: 'Beautiful ceremony',\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-01T00:00:00Z',\n      };\n\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: mockEvent,\n        error: null,\n      });\n      const mockEq = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.get('event-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('event-1');\n        expect(result.data.name).toBe('Wedding Ceremony');\n        expect(result.data.eventType).toBe('ceremony');\n      }\n    });\n\n    it('should return NOT_FOUND when event does not exist', async () => {\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: null,\n        error: { code: 'PGRST116' },\n      });\n      const mockEq = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.get('nonexistent-id');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('NOT_FOUND');\n      }\n    });\n\n    it('should return DATABASE_ERROR when database query fails', async () => {\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Connection failed' },\n      });\n      const mockEq = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.get('event-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('update', () => {\n    const updateData: UpdateEventDTO = {\n      name: 'Updated Ceremony',\n      description: 'Updated description',\n    };\n\n    it('should return success with updated event data when valid input provided', async () => {\n      const mockUpdatedEvent = {\n        id: 'event-1',\n        name: 'Updated Ceremony',\n        event_type: 'ceremony',\n        start_date: '2025-06-15T14:00:00Z',\n        end_date: '2025-06-15T15:00:00Z',\n        location_id: '123e4567-e89b-12d3-a456-426614174000',\n        description: 'Updated description',\n        created_at: '2024-01-01T00:00:00Z',\n        updated_at: '2024-01-02T00:00:00Z',\n      };\n\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: mockUpdatedEvent,\n        error: null,\n      });\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockEq = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ update: mockUpdate });\n\n      const result = await eventService.update('event-1', updateData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.name).toBe('Updated Ceremony');\n        expect(result.data.description).toBe('Updated description');\n      }\n    });\n\n    it('should check for scheduling conflicts when location or dates are updated', async () => {\n      const eventId = '123e4567-e89b-12d3-a456-426614174001'; // Valid UUID\n      const updateWithLocation = {\n        locationId: '223e4567-e89b-12d3-a456-426614174000', // Valid UUID\n        startDate: '2025-06-15T16:00:00Z',\n      };\n\n      // Three separate calls to from():\n      // 1. get() - fetch current event\n      // 2. checkSchedulingConflicts() - check for conflicts\n      // 3. update() - perform the update\n      let callCount = 0;\n      mockFrom.mockImplementation(() => {\n        callCount++;\n        if (callCount === 1) {\n          // Get current event: .from('events').select('*').eq('id', id).single()\n          const mockSingle = jest.fn().mockResolvedValue({\n            data: {\n              id: eventId,\n              name: 'Wedding Ceremony',\n              event_type: 'ceremony',\n              start_date: '2025-06-15T14:00:00Z',\n              end_date: '2025-06-15T15:00:00Z',\n              location_id: '123e4567-e89b-12d3-a456-426614174000',\n              description: 'Beautiful ceremony',\n              created_at: '2024-01-01T00:00:00Z',\n              updated_at: '2024-01-01T00:00:00Z',\n            },\n            error: null,\n          });\n          const mockEq = jest.fn().mockReturnValue({ single: mockSingle });\n          const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n          return { select: mockSelect };\n        } else if (callCount === 2) {\n          // Conflict check: .from('events').select(...).eq('location_id', ...).neq('id', ...)\n          const mockNeq = jest.fn().mockResolvedValue({\n            data: [],\n            error: null,\n          });\n          const mockEq = jest.fn().mockReturnValue({ neq: mockNeq });\n          const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n          return { select: mockSelect };\n        } else {\n          // Update operation: .from('events').update(...).eq('id', ...).select().single()\n          const mockSingle = jest.fn().mockResolvedValue({\n            data: {\n              id: eventId,\n              name: 'Wedding Ceremony',\n              location_id: '223e4567-e89b-12d3-a456-426614174000',\n              start_date: '2025-06-15T16:00:00Z',\n            },\n            error: null,\n          });\n          const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n          const mockEq = jest.fn().mockReturnValue({ select: mockSelect });\n          const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\n          return { update: mockUpdate };\n        }\n      });\n\n      const result = await eventService.update(eventId, updateWithLocation);\n\n      expect(result.success).toBe(true);\n    });\n\n    it('should return NOT_FOUND when event to update does not exist', async () => {\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: null,\n        error: { code: 'PGRST116' },\n      });\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockEq = jest.fn().mockReturnValue({ select: mockSelect });\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ update: mockUpdate });\n\n      const result = await eventService.update('nonexistent-id', updateData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('NOT_FOUND');\n      }\n    });\n  });\n\n  describe('deleteEvent', () => {\n    it('should return success when event is deleted successfully', async () => {\n      const mockEq = jest.fn().mockResolvedValue({\n        error: null,\n      });\n      const mockDelete = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await eventService.deleteEvent('event-1');\n\n      expect(result.success).toBe(true);\n    });\n\n    it('should return DATABASE_ERROR when delete fails', async () => {\n      const mockEq = jest.fn().mockResolvedValue({\n        error: { message: 'Foreign key constraint violation' },\n      });\n      const mockDelete = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ delete: mockDelete });\n\n      const result = await eventService.deleteEvent('event-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('list', () => {\n    it('should return success with paginated events when valid filters provided', async () => {\n      const mockEvents = [\n        {\n          id: 'event-1',\n          name: 'Ceremony',\n          event_type: 'ceremony',\n          start_date: '2025-06-15T14:00:00Z',\n          end_date: '2025-06-15T15:00:00Z',\n          location_id: null,\n          description: null,\n          created_at: '2024-01-01T00:00:00Z',\n          updated_at: '2024-01-01T00:00:00Z',\n        },\n        {\n          id: 'event-2',\n          name: 'Reception',\n          event_type: 'reception',\n          start_date: '2025-06-15T18:00:00Z',\n          end_date: '2025-06-15T23:00:00Z',\n          location_id: null,\n          description: null,\n          created_at: '2024-01-01T00:00:00Z',\n          updated_at: '2024-01-01T00:00:00Z',\n        },\n      ];\n\n      const mockRange = jest.fn().mockResolvedValue({\n        data: mockEvents,\n        error: null,\n        count: 2,\n      });\n      const mockOrder = jest.fn().mockReturnValue({ range: mockRange });\n      const mockSelect = jest.fn().mockReturnValue({ order: mockOrder });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const filters: EventFilterDTO = { page: 1, pageSize: 10 };\n      const result = await eventService.list(filters);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.events).toHaveLength(2);\n        expect(result.data.total).toBe(2);\n        expect(result.data.page).toBe(1);\n        expect(result.data.pageSize).toBe(10);\n      }\n    });\n\n    it('should filter by event type when provided', async () => {\n      const filters: EventFilterDTO = {\n        eventType: 'ceremony',\n        page: 1,\n        pageSize: 10,\n      };\n\n      const mockRange = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n        count: 0,\n      });\n      const mockOrder = jest.fn().mockReturnValue({ range: mockRange });\n      const mockEq = jest.fn().mockReturnValue({ order: mockOrder });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.list(filters);\n\n      expect(result.success).toBe(true);\n    });\n\n    it('should filter by date range when provided', async () => {\n      const filters: EventFilterDTO = {\n        startDateFrom: '2025-06-01T00:00:00Z',\n        startDateTo: '2025-06-30T23:59:59Z',\n        page: 1,\n        pageSize: 10,\n      };\n\n      const mockRange = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n        count: 0,\n      });\n      const mockOrder = jest.fn().mockReturnValue({ range: mockRange });\n      const mockLte = jest.fn().mockReturnValue({ order: mockOrder });\n      const mockGte = jest.fn().mockReturnValue({ lte: mockLte });\n      const mockSelect = jest.fn().mockReturnValue({ gte: mockGte });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.list(filters);\n\n      expect(result.success).toBe(true);\n    });\n\n    it('should return DATABASE_ERROR when query fails', async () => {\n      const mockRange = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Connection failed' },\n      });\n      const mockOrder = jest.fn().mockReturnValue({ range: mockRange });\n      const mockSelect = jest.fn().mockReturnValue({ order: mockOrder });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.list();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('search', () => {\n    const searchParams: EventSearchDTO = {\n      query: 'ceremony',\n      page: 1,\n      pageSize: 10,\n    };\n\n    it('should return success with search results when valid query provided', async () => {\n      const mockResults = [\n        {\n          id: 'event-1',\n          name: 'Wedding Ceremony',\n          event_type: 'ceremony',\n          start_date: '2025-06-15T14:00:00Z',\n          end_date: '2025-06-15T15:00:00Z',\n          location_id: null,\n          description: 'Beautiful ceremony by the beach',\n          created_at: '2024-01-01T00:00:00Z',\n          updated_at: '2024-01-01T00:00:00Z',\n        },\n      ];\n\n      const mockRange = jest.fn().mockResolvedValue({\n        data: mockResults,\n        error: null,\n        count: 1,\n      });\n      const mockOrder = jest.fn().mockReturnValue({ range: mockRange });\n      const mockOr = jest.fn().mockReturnValue({ order: mockOrder });\n      const mockSelect = jest.fn().mockReturnValue({ or: mockOr });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.search(searchParams);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.events).toHaveLength(1);\n        expect(result.data.events[0].name).toBe('Wedding Ceremony');\n      }\n    });\n\n    it('should sanitize search query to prevent injection attacks', async () => {\n      const maliciousSearch = {\n        query: '<script>alert(\"xss\")</script>ceremony',\n        page: 1,\n        pageSize: 10,\n      };\n\n      const mockRange = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n        count: 0,\n      });\n      const mockOrder = jest.fn().mockReturnValue({ range: mockRange });\n      const mockOr = jest.fn().mockReturnValue({ order: mockOrder });\n      const mockSelect = jest.fn().mockReturnValue({ or: mockOr });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.search(maliciousSearch);\n\n      // Verify sanitization was called\n      const { sanitizeInput } = require('../utils/sanitization');\n      expect(sanitizeInput).toHaveBeenCalledWith(maliciousSearch.query);\n      expect(result.success).toBe(true);\n    });\n\n    it('should return VALIDATION_ERROR when query is empty', async () => {\n      const invalidSearch = { ...searchParams, query: '' };\n      const result = await eventService.search(invalidSearch);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n  });\n\n  describe('checkSchedulingConflicts', () => {\n    const conflictParams: ConflictCheckDTO = {\n      locationId: '123e4567-e89b-12d3-a456-426614174000',\n      startDate: '2025-06-15T14:00:00Z',\n      endDate: '2025-06-15T15:00:00Z',\n    };\n\n    it('should return success with no conflicts when no overlapping events exist', async () => {\n      const mockEq = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n      });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.checkSchedulingConflicts(conflictParams);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasConflict).toBe(false);\n        expect(result.data.conflictingEvents).toHaveLength(0);\n      }\n    });\n\n    it('should return success with conflicts when overlapping events exist', async () => {\n      const overlappingEvent = {\n        id: 'existing-event',\n        name: 'Existing Event',\n        start_date: '2025-06-15T13:30:00Z',\n        end_date: '2025-06-15T14:30:00Z',\n      };\n\n      const mockEq = jest.fn().mockResolvedValue({\n        data: [overlappingEvent],\n        error: null,\n      });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.checkSchedulingConflicts(conflictParams);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasConflict).toBe(true);\n        expect(result.data.conflictingEvents).toHaveLength(1);\n        expect(result.data.conflictingEvents[0].id).toBe('existing-event');\n        expect(result.data.conflictingEvents[0].name).toBe('Existing Event');\n      }\n    });\n\n    it('should exclude specified event ID from conflict check', async () => {\n      const paramsWithExclusion = {\n        ...conflictParams,\n        excludeEventId: '223e4567-e89b-12d3-a456-426614174001', // Valid UUID\n      };\n\n      const mockNeq = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n      });\n      const mockEq = jest.fn().mockReturnValue({ neq: mockNeq });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.checkSchedulingConflicts(paramsWithExclusion);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasConflict).toBe(false);\n      }\n    });\n\n    it('should handle events without end dates correctly', async () => {\n      const eventWithoutEndDate = {\n        id: 'point-event',\n        name: 'Point Event',\n        start_date: '2025-06-15T14:30:00Z',\n        end_date: null,\n      };\n\n      const mockEq = jest.fn().mockResolvedValue({\n        data: [eventWithoutEndDate],\n        error: null,\n      });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.checkSchedulingConflicts(conflictParams);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.hasConflict).toBe(true); // Should still detect overlap\n      }\n    });\n\n    it('should return DATABASE_ERROR when query fails', async () => {\n      const mockEq = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Connection failed' },\n      });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await eventService.checkSchedulingConflicts(conflictParams);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n\n    it('should return VALIDATION_ERROR when locationId is invalid', async () => {\n      const invalidParams = { ...conflictParams, locationId: 'invalid-uuid' };\n      \n      const result = await eventService.checkSchedulingConflicts(invalidParams);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n  });\n});"],"names":["process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","jest","mock","sanitizeInput","fn","input","trim","sanitizeRichText","mockFrom","mockSupabaseClient","from","createClient","__mockFrom","eventServiceModule","require","eventService","describe","beforeEach","clearAllMocks","validData","name","eventType","startDate","endDate","locationId","description","it","mockEvent","id","event_type","start_date","end_date","location_id","created_at","updated_at","callCount","mockImplementation","mockEq","mockResolvedValue","data","error","mockSelect","mockReturnValue","eq","select","mockSingle","single","mockInsert","insert","result","create","expect","success","toBe","invalidData","code","conflictingEvent","details","toHaveLength","message","maliciousData","toHaveBeenCalledWith","get","updateData","mockUpdatedEvent","mockUpdate","update","eventId","updateWithLocation","mockNeq","neq","mockDelete","delete","deleteEvent","mockEvents","mockRange","count","mockOrder","range","order","filters","page","pageSize","list","events","total","startDateFrom","startDateTo","mockLte","mockGte","lte","gte","searchParams","query","mockResults","mockOr","or","search","maliciousSearch","invalidSearch","conflictParams","checkSchedulingConflicts","hasConflict","conflictingEvents","overlappingEvent","paramsWithExclusion","excludeEventId","eventWithoutEndDate","invalidParams"],"mappings":";;;;yBAAuD;AAGvD,kCAAkC;AAClCA,QAAQC,GAAG,CAACC,wBAAwB,GAAG;AACvCF,QAAQC,GAAG,CAACE,yBAAyB,GAAG;AAExC,8BAA8B;AAC9BC,aAAI,CAACC,IAAI,CAAC,yBAAyB,IAAO,CAAA;QACxCC,eAAeF,aAAI,CAACG,EAAE,CAAC,CAACC,QAAkBA,MAAMC,IAAI;QACpDC,kBAAkBN,aAAI,CAACG,EAAE,CAAC,CAACC,QAAkBA,MAAMC,IAAI;IACzD,CAAA;AAEA,wDAAwD;AACxDL,aAAI,CAACC,IAAI,CAAC,yBAAyB;IACjC,MAAMM,WAAWP,aAAI,CAACG,EAAE;IACxB,MAAMK,qBAAqB;QACzBC,MAAMF;IACR;IAEA,OAAO;QACLG,cAAcV,aAAI,CAACG,EAAE,CAAC,IAAMK;QAC5BG,YAAYJ;IACd;AACF;AAEA,uEAAuE;AACvE,MAAMK,qBAAqBC,QAAQ;AACnC,MAAMC,eAAeF;AAErB,+BAA+B;AAC/B,MAAM,EAAED,YAAYJ,QAAQ,EAAE,GAAGM,QAAQ;AAEzCE,IAAAA,iBAAQ,EAAC,gBAAgB;IACvBC,IAAAA,mBAAU,EAAC;QACThB,aAAI,CAACiB,aAAa;QAElB,+BAA+B;QAC/BrB,QAAQC,GAAG,CAACC,wBAAwB,GAAG;QACvCF,QAAQC,GAAG,CAACE,yBAAyB,GAAG;IAC1C;IAEAgB,IAAAA,iBAAQ,EAAC,UAAU;QACjB,MAAMG,YAA4B;YAChCC,MAAM;YACNC,WAAW;YACXC,WAAW;YACXC,SAAS;YACTC,YAAY;YACZC,aAAa;QACf;QAEAC,IAAAA,WAAE,EAAC,mEAAmE;YACpE,MAAMC,YAAY;gBAChBC,IAAI;gBACJR,MAAM;gBACNS,YAAY;gBACZC,YAAY;gBACZC,UAAU;gBACVC,aAAab,UAAUK,UAAU;gBACjCC,aAAa;gBACbQ,YAAY;gBACZC,YAAY;YACd;YAEA,4DAA4D;YAC5D,8CAA8C;YAC9C,IAAIC,YAAY;YAChB3B,SAAS4B,kBAAkB,CAAC;gBAC1BD;gBACA,IAAIA,cAAc,GAAG;oBACnB,uBAAuB;oBACvB,MAAME,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBACzCC,MAAM,EAAE;wBACRC,OAAO;oBACT;oBACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEC,IAAIN;oBAAO;oBAC1D,OAAO;wBAAEO,QAAQH;oBAAW;gBAC9B,OAAO;oBACL,eAAe;oBACf,MAAMI,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBAC7CC,MAAMZ;wBACNa,OAAO;oBACT;oBACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEI,QAAQD;oBAAW;oBAClE,MAAME,aAAa9C,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEE,QAAQH;oBAAW;oBAClE,OAAO;wBAAEO,QAAQD;oBAAW;gBAC9B;YACF;YAEA,MAAME,SAAS,MAAMlC,aAAamC,MAAM,CAAC/B;YAEzCgC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACX,EAAE,EAAEyB,IAAI,CAAC;gBAC5BF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACnB,IAAI,EAAEiC,IAAI,CAAC;gBAC9BF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAClB,SAAS,EAAEgC,IAAI,CAAC;gBACnCF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACf,UAAU,EAAE6B,IAAI,CAAClC,UAAUK,UAAU;YAC1D;QACF;QAEAE,IAAAA,WAAE,EAAC,uDAAuD;YACxD,MAAM4B,cAAc;gBAAE,GAAGnC,SAAS;gBAAEC,MAAM;YAAG;YAC7C,MAAM6B,SAAS,MAAMlC,aAAamC,MAAM,CAACI;YAEzCH,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;QAEA3B,IAAAA,WAAE,EAAC,4DAA4D;YAC7D,MAAM4B,cAAc;gBAAE,GAAGnC,SAAS;gBAAEE,WAAW;YAAsB;YACrE,MAAM4B,SAAS,MAAMlC,aAAamC,MAAM,CAACI;YAEzCH,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;QAEA3B,IAAAA,WAAE,EAAC,+EAA+E;YAChF,MAAM8B,mBAAmB;gBACvB5B,IAAI;gBACJR,MAAM;gBACNU,YAAY;gBACZC,UAAU;YACZ;YAEA,uCAAuC;YACvC,MAAMM,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBACzCC,MAAM;oBAACiB;iBAAiB;gBACxBhB,OAAO;YACT;YACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAamC,MAAM,CAAC/B;YAEzCgC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;gBAC/BF,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACiB,OAAO,EAAEC,YAAY,CAAC;YAC5C;QACF;QAEAhC,IAAAA,WAAE,EAAC,kDAAkD;YACnD,kDAAkD;YAClD,oCAAoC;YACpC,IAAIS,YAAY;YAChB3B,SAAS4B,kBAAkB,CAAC;gBAC1BD;gBACA,IAAIA,cAAc,GAAG;oBACnB,uBAAuB;oBACvB,MAAME,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBACzCC,MAAM,EAAE;wBACRC,OAAO;oBACT;oBACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEC,IAAIN;oBAAO;oBAC1D,OAAO;wBAAEO,QAAQH;oBAAW;gBAC9B,OAAO;oBACL,0BAA0B;oBAC1B,MAAMI,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBAC7CC,MAAM;wBACNC,OAAO;4BAAEmB,SAAS;wBAAoB;oBACxC;oBACA,MAAMlB,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEI,QAAQD;oBAAW;oBAClE,MAAME,aAAa9C,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEE,QAAQH;oBAAW;oBAClE,OAAO;wBAAEO,QAAQD;oBAAW;gBAC9B;YACF;YAEA,MAAME,SAAS,MAAMlC,aAAamC,MAAM,CAAC/B;YAEzCgC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;QAEA3B,IAAAA,WAAE,EAAC,gDAAgD;YACjD,MAAMkC,gBAAgB;gBACpB,GAAGzC,SAAS;gBACZC,MAAM;gBACNK,aAAa;YACf;YAEA,kDAAkD;YAClD,yCAAyC;YACzC,IAAIU,YAAY;YAChB3B,SAAS4B,kBAAkB,CAAC;gBAC1BD;gBACA,IAAIA,cAAc,GAAG;oBACnB,uBAAuB;oBACvB,MAAME,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBACzCC,MAAM,EAAE;wBACRC,OAAO;oBACT;oBACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEC,IAAIN;oBAAO;oBAC1D,OAAO;wBAAEO,QAAQH;oBAAW;gBAC9B,OAAO;oBACL,eAAe;oBACf,MAAMI,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBAC7CC,MAAM;4BACJX,IAAI;4BACJR,MAAM;4BACNK,aAAa;wBACf;wBACAe,OAAO;oBACT;oBACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEI,QAAQD;oBAAW;oBAClE,MAAME,aAAa9C,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEE,QAAQH;oBAAW;oBAClE,OAAO;wBAAEO,QAAQD;oBAAW;gBAC9B;YACF;YAEA,MAAME,SAAS,MAAMlC,aAAamC,MAAM,CAACU;YAEzCT,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAE5B,iCAAiC;YACjC,MAAM,EAAElD,aAAa,EAAEI,gBAAgB,EAAE,GAAGO,QAAQ;YACpDqC,IAAAA,eAAM,EAAChD,eAAe0D,oBAAoB,CAACD,cAAcxC,IAAI;YAC7D+B,IAAAA,eAAM,EAAC5C,kBAAkBsD,oBAAoB,CAACD,cAAcnC,WAAW;QACzE;IACF;IAEAT,IAAAA,iBAAQ,EAAC,OAAO;QACdU,IAAAA,WAAE,EAAC,2DAA2D;YAC5D,MAAMC,YAAY;gBAChBC,IAAI;gBACJR,MAAM;gBACNS,YAAY;gBACZC,YAAY;gBACZC,UAAU;gBACVC,aAAa;gBACbP,aAAa;gBACbQ,YAAY;gBACZC,YAAY;YACd;YAEA,MAAMW,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC7CC,MAAMZ;gBACNa,OAAO;YACT;YACA,MAAMH,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEI,QAAQD;YAAW;YAC9D,MAAMJ,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAa+C,GAAG,CAAC;YAEtCX,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACX,EAAE,EAAEyB,IAAI,CAAC;gBAC5BF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACnB,IAAI,EAAEiC,IAAI,CAAC;gBAC9BF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAClB,SAAS,EAAEgC,IAAI,CAAC;YACrC;QACF;QAEA3B,IAAAA,WAAE,EAAC,qDAAqD;YACtD,MAAMmB,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC7CC,MAAM;gBACNC,OAAO;oBAAEe,MAAM;gBAAW;YAC5B;YACA,MAAMlB,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEI,QAAQD;YAAW;YAC9D,MAAMJ,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAa+C,GAAG,CAAC;YAEtCX,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;QAEA3B,IAAAA,WAAE,EAAC,0DAA0D;YAC3D,MAAMmB,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC7CC,MAAM;gBACNC,OAAO;oBAAEmB,SAAS;gBAAoB;YACxC;YACA,MAAMtB,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEI,QAAQD;YAAW;YAC9D,MAAMJ,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAa+C,GAAG,CAAC;YAEtCX,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;IACF;IAEArC,IAAAA,iBAAQ,EAAC,UAAU;QACjB,MAAM+C,aAA6B;YACjC3C,MAAM;YACNK,aAAa;QACf;QAEAC,IAAAA,WAAE,EAAC,2EAA2E;YAC5E,MAAMsC,mBAAmB;gBACvBpC,IAAI;gBACJR,MAAM;gBACNS,YAAY;gBACZC,YAAY;gBACZC,UAAU;gBACVC,aAAa;gBACbP,aAAa;gBACbQ,YAAY;gBACZC,YAAY;YACd;YAEA,MAAMW,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC7CC,MAAMyB;gBACNxB,OAAO;YACT;YACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEI,QAAQD;YAAW;YAClE,MAAMR,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAC9D,MAAMwB,aAAahE,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEwB,QAAQD;YAAW;YAE9C,MAAMhB,SAAS,MAAMlC,aAAamD,MAAM,CAAC,WAAWH;YAEpDZ,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACnB,IAAI,EAAEiC,IAAI,CAAC;gBAC9BF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACd,WAAW,EAAE4B,IAAI,CAAC;YACvC;QACF;QAEA3B,IAAAA,WAAE,EAAC,4EAA4E;YAC7E,MAAMyC,UAAU,wCAAwC,aAAa;YACrE,MAAMC,qBAAqB;gBACzB5C,YAAY;gBACZF,WAAW;YACb;YAEA,kCAAkC;YAClC,iCAAiC;YACjC,sDAAsD;YACtD,mCAAmC;YACnC,IAAIa,YAAY;YAChB3B,SAAS4B,kBAAkB,CAAC;gBAC1BD;gBACA,IAAIA,cAAc,GAAG;oBACnB,uEAAuE;oBACvE,MAAMU,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBAC7CC,MAAM;4BACJX,IAAIuC;4BACJ/C,MAAM;4BACNS,YAAY;4BACZC,YAAY;4BACZC,UAAU;4BACVC,aAAa;4BACbP,aAAa;4BACbQ,YAAY;4BACZC,YAAY;wBACd;wBACAM,OAAO;oBACT;oBACA,MAAMH,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEI,QAAQD;oBAAW;oBAC9D,MAAMJ,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEC,IAAIN;oBAAO;oBAC1D,OAAO;wBAAEO,QAAQH;oBAAW;gBAC9B,OAAO,IAAIN,cAAc,GAAG;oBAC1B,oFAAoF;oBACpF,MAAMkC,UAAUpE,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBAC1CC,MAAM,EAAE;wBACRC,OAAO;oBACT;oBACA,MAAMH,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAE4B,KAAKD;oBAAQ;oBACxD,MAAM5B,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEC,IAAIN;oBAAO;oBAC1D,OAAO;wBAAEO,QAAQH;oBAAW;gBAC9B,OAAO;oBACL,gFAAgF;oBAChF,MAAMI,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;wBAC7CC,MAAM;4BACJX,IAAIuC;4BACJ/C,MAAM;4BACNY,aAAa;4BACbF,YAAY;wBACd;wBACAU,OAAO;oBACT;oBACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEI,QAAQD;oBAAW;oBAClE,MAAMR,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEE,QAAQH;oBAAW;oBAC9D,MAAMwB,aAAahE,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;wBAAEC,IAAIN;oBAAO;oBAC1D,OAAO;wBAAE6B,QAAQD;oBAAW;gBAC9B;YACF;YAEA,MAAMhB,SAAS,MAAMlC,aAAamD,MAAM,CAACC,SAASC;YAElDjB,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;QAC9B;QAEA3B,IAAAA,WAAE,EAAC,+DAA+D;YAChE,MAAMmB,aAAa5C,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC7CC,MAAM;gBACNC,OAAO;oBAAEe,MAAM;gBAAW;YAC5B;YACA,MAAMd,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEI,QAAQD;YAAW;YAClE,MAAMR,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAC9D,MAAMwB,aAAahE,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEwB,QAAQD;YAAW;YAE9C,MAAMhB,SAAS,MAAMlC,aAAamD,MAAM,CAAC,kBAAkBH;YAE3DZ,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;IACF;IAEArC,IAAAA,iBAAQ,EAAC,eAAe;QACtBU,IAAAA,WAAE,EAAC,4DAA4D;YAC7D,MAAMW,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBACzCE,OAAO;YACT;YACA,MAAM+B,aAAatE,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAE8B,QAAQD;YAAW;YAE9C,MAAMtB,SAAS,MAAMlC,aAAa0D,WAAW,CAAC;YAE9CtB,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;QAC9B;QAEA3B,IAAAA,WAAE,EAAC,kDAAkD;YACnD,MAAMW,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBACzCE,OAAO;oBAAEmB,SAAS;gBAAmC;YACvD;YACA,MAAMY,aAAatE,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAE8B,QAAQD;YAAW;YAE9C,MAAMtB,SAAS,MAAMlC,aAAa0D,WAAW,CAAC;YAE9CtB,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;IACF;IAEArC,IAAAA,iBAAQ,EAAC,QAAQ;QACfU,IAAAA,WAAE,EAAC,2EAA2E;YAC5E,MAAMgD,aAAa;gBACjB;oBACE9C,IAAI;oBACJR,MAAM;oBACNS,YAAY;oBACZC,YAAY;oBACZC,UAAU;oBACVC,aAAa;oBACbP,aAAa;oBACbQ,YAAY;oBACZC,YAAY;gBACd;gBACA;oBACEN,IAAI;oBACJR,MAAM;oBACNS,YAAY;oBACZC,YAAY;oBACZC,UAAU;oBACVC,aAAa;oBACbP,aAAa;oBACbQ,YAAY;oBACZC,YAAY;gBACd;aACD;YAED,MAAMyC,YAAY1E,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC5CC,MAAMmC;gBACNlC,OAAO;gBACPoC,OAAO;YACT;YACA,MAAMC,YAAY5E,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEoC,OAAOH;YAAU;YAC/D,MAAMlC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEqC,OAAOF;YAAU;YAChErE,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMuC,UAA0B;gBAAEC,MAAM;gBAAGC,UAAU;YAAG;YACxD,MAAMjC,SAAS,MAAMlC,aAAaoE,IAAI,CAACH;YAEvC7B,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC6C,MAAM,EAAE1B,YAAY,CAAC;gBACxCP,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC8C,KAAK,EAAEhC,IAAI,CAAC;gBAC/BF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC0C,IAAI,EAAE5B,IAAI,CAAC;gBAC9BF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC2C,QAAQ,EAAE7B,IAAI,CAAC;YACpC;QACF;QAEA3B,IAAAA,WAAE,EAAC,6CAA6C;YAC9C,MAAMsD,UAA0B;gBAC9B3D,WAAW;gBACX4D,MAAM;gBACNC,UAAU;YACZ;YAEA,MAAMP,YAAY1E,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC5CC,MAAM,EAAE;gBACRC,OAAO;gBACPoC,OAAO;YACT;YACA,MAAMC,YAAY5E,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEoC,OAAOH;YAAU;YAC/D,MAAMtC,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEqC,OAAOF;YAAU;YAC5D,MAAMpC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAaoE,IAAI,CAACH;YAEvC7B,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;QAC9B;QAEA3B,IAAAA,WAAE,EAAC,6CAA6C;YAC9C,MAAMsD,UAA0B;gBAC9BM,eAAe;gBACfC,aAAa;gBACbN,MAAM;gBACNC,UAAU;YACZ;YAEA,MAAMP,YAAY1E,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC5CC,MAAM,EAAE;gBACRC,OAAO;gBACPoC,OAAO;YACT;YACA,MAAMC,YAAY5E,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEoC,OAAOH;YAAU;YAC/D,MAAMa,UAAUvF,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEqC,OAAOF;YAAU;YAC7D,MAAMY,UAAUxF,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEgD,KAAKF;YAAQ;YACzD,MAAM/C,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEiD,KAAKF;YAAQ;YAC5DjF,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAaoE,IAAI,CAACH;YAEvC7B,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;QAC9B;QAEA3B,IAAAA,WAAE,EAAC,iDAAiD;YAClD,MAAMiD,YAAY1E,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC5CC,MAAM;gBACNC,OAAO;oBAAEmB,SAAS;gBAAoB;YACxC;YACA,MAAMkB,YAAY5E,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEoC,OAAOH;YAAU;YAC/D,MAAMlC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEqC,OAAOF;YAAU;YAChErE,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAaoE,IAAI;YAEtChC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;IACF;IAEArC,IAAAA,iBAAQ,EAAC,UAAU;QACjB,MAAM4E,eAA+B;YACnCC,OAAO;YACPZ,MAAM;YACNC,UAAU;QACZ;QAEAxD,IAAAA,WAAE,EAAC,uEAAuE;YACxE,MAAMoE,cAAc;gBAClB;oBACElE,IAAI;oBACJR,MAAM;oBACNS,YAAY;oBACZC,YAAY;oBACZC,UAAU;oBACVC,aAAa;oBACbP,aAAa;oBACbQ,YAAY;oBACZC,YAAY;gBACd;aACD;YAED,MAAMyC,YAAY1E,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC5CC,MAAMuD;gBACNtD,OAAO;gBACPoC,OAAO;YACT;YACA,MAAMC,YAAY5E,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEoC,OAAOH;YAAU;YAC/D,MAAMoB,SAAS9F,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEqC,OAAOF;YAAU;YAC5D,MAAMpC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEsD,IAAID;YAAO;YAC1DvF,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAakF,MAAM,CAACL;YAEzCzC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC6C,MAAM,EAAE1B,YAAY,CAAC;gBACxCP,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC6C,MAAM,CAAC,EAAE,CAAChE,IAAI,EAAEiC,IAAI,CAAC;YAC1C;QACF;QAEA3B,IAAAA,WAAE,EAAC,6DAA6D;YAC9D,MAAMwE,kBAAkB;gBACtBL,OAAO;gBACPZ,MAAM;gBACNC,UAAU;YACZ;YAEA,MAAMP,YAAY1E,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC5CC,MAAM,EAAE;gBACRC,OAAO;gBACPoC,OAAO;YACT;YACA,MAAMC,YAAY5E,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEoC,OAAOH;YAAU;YAC/D,MAAMoB,SAAS9F,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEqC,OAAOF;YAAU;YAC5D,MAAMpC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEsD,IAAID;YAAO;YAC1DvF,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAakF,MAAM,CAACC;YAEzC,iCAAiC;YACjC,MAAM,EAAE/F,aAAa,EAAE,GAAGW,QAAQ;YAClCqC,IAAAA,eAAM,EAAChD,eAAe0D,oBAAoB,CAACqC,gBAAgBL,KAAK;YAChE1C,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;QAC9B;QAEA3B,IAAAA,WAAE,EAAC,sDAAsD;YACvD,MAAMyE,gBAAgB;gBAAE,GAAGP,YAAY;gBAAEC,OAAO;YAAG;YACnD,MAAM5C,SAAS,MAAMlC,aAAakF,MAAM,CAACE;YAEzChD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;IACF;IAEArC,IAAAA,iBAAQ,EAAC,4BAA4B;QACnC,MAAMoF,iBAAmC;YACvC5E,YAAY;YACZF,WAAW;YACXC,SAAS;QACX;QAEAG,IAAAA,WAAE,EAAC,4EAA4E;YAC7E,MAAMW,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBACzCC,MAAM,EAAE;gBACRC,OAAO;YACT;YACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAasF,wBAAwB,CAACD;YAE3DjD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC+D,WAAW,EAAEjD,IAAI,CAAC;gBACrCF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACgE,iBAAiB,EAAE7C,YAAY,CAAC;YACrD;QACF;QAEAhC,IAAAA,WAAE,EAAC,sEAAsE;YACvE,MAAM8E,mBAAmB;gBACvB5E,IAAI;gBACJR,MAAM;gBACNU,YAAY;gBACZC,UAAU;YACZ;YAEA,MAAMM,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBACzCC,MAAM;oBAACiE;iBAAiB;gBACxBhE,OAAO;YACT;YACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAasF,wBAAwB,CAACD;YAE3DjD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC+D,WAAW,EAAEjD,IAAI,CAAC;gBACrCF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACgE,iBAAiB,EAAE7C,YAAY,CAAC;gBACnDP,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACgE,iBAAiB,CAAC,EAAE,CAAC3E,EAAE,EAAEyB,IAAI,CAAC;gBACjDF,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAACgE,iBAAiB,CAAC,EAAE,CAACnF,IAAI,EAAEiC,IAAI,CAAC;YACrD;QACF;QAEA3B,IAAAA,WAAE,EAAC,yDAAyD;YAC1D,MAAM+E,sBAAsB;gBAC1B,GAAGL,cAAc;gBACjBM,gBAAgB;YAClB;YAEA,MAAMrC,UAAUpE,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBAC1CC,MAAM,EAAE;gBACRC,OAAO;YACT;YACA,MAAMH,SAASpC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAE4B,KAAKD;YAAQ;YACxD,MAAM5B,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAasF,wBAAwB,CAACI;YAE3DtD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC+D,WAAW,EAAEjD,IAAI,CAAC;YACvC;QACF;QAEA3B,IAAAA,WAAE,EAAC,oDAAoD;YACrD,MAAMiF,sBAAsB;gBAC1B/E,IAAI;gBACJR,MAAM;gBACNU,YAAY;gBACZC,UAAU;YACZ;YAEA,MAAMM,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBACzCC,MAAM;oBAACoE;iBAAoB;gBAC3BnE,OAAO;YACT;YACA,MAAMC,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAasF,wBAAwB,CAACD;YAE3DjD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOV,IAAI,CAAC+D,WAAW,EAAEjD,IAAI,CAAC,OAAO,8BAA8B;YAC5E;QACF;QAEA3B,IAAAA,WAAE,EAAC,iDAAiD;YAClD,MAAMW,SAASpC,aAAI,CAACG,EAAE,GAAGkC,iBAAiB,CAAC;gBACzCC,MAAM;gBACNC,OAAO;oBAAEmB,SAAS;gBAAoB;YACxC;YACA,MAAMlB,aAAaxC,aAAI,CAACG,EAAE,GAAGsC,eAAe,CAAC;gBAAEC,IAAIN;YAAO;YAC1D7B,SAASkC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMQ,SAAS,MAAMlC,aAAasF,wBAAwB,CAACD;YAE3DjD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;QAEA3B,IAAAA,WAAE,EAAC,6DAA6D;YAC9D,MAAMkF,gBAAgB;gBAAE,GAAGR,cAAc;gBAAE5E,YAAY;YAAe;YAEtE,MAAMyB,SAAS,MAAMlC,aAAasF,wBAAwB,CAACO;YAE3DzD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOT,KAAK,CAACe,IAAI,EAAEF,IAAI,CAAC;YACjC;QACF;IACF;AACF"}