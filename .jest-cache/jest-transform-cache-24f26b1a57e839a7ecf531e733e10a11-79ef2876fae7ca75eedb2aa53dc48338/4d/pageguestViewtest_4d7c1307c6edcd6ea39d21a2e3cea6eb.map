{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/content-pages/page.guestView.test.tsx"],"sourcesContent":["/**\n * Guest View Navigation Tests for Content Pages\n * \n * Tests the \"View as Guest\" functionality for content pages.\n * Requirements: 32.1-32.5\n */\n\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport ContentPagesPage from './page';\nimport { useContentPages } from '@/hooks/useContentPages';\nimport { useToast } from '@/components/ui/ToastContext';\n\n// Mock hooks\njest.mock('@/hooks/useContentPages');\njest.mock('@/components/ui/ToastContext');\n\n// Mock Next.js router\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    refresh: jest.fn(),\n    back: jest.fn(),\n    forward: jest.fn(),\n    prefetch: jest.fn(),\n  }),\n  useSearchParams: () => ({\n    get: jest.fn(),\n    getAll: jest.fn(),\n    has: jest.fn(),\n    keys: jest.fn(),\n    values: jest.fn(),\n    entries: jest.fn(),\n    forEach: jest.fn(),\n    toString: jest.fn(),\n  }),\n  usePathname: () => '/admin/content-pages',\n}));\n\n// Mock window.location\ndelete (window as any).location;\nwindow.location = { href: '' } as any;\n\nconst mockUseContentPages = useContentPages as jest.MockedFunction<typeof useContentPages>;\nconst mockUseToast = useToast as jest.MockedFunction<typeof useToast>;\n\ndescribe('ContentPagesPage - Guest View Navigation', () => {\n  const mockShowToast = jest.fn();\n  const mockRefetch = jest.fn();\n  const mockCreate = jest.fn();\n  const mockUpdate = jest.fn();\n  const mockRemove = jest.fn();\n\n  const mockPages = [\n    {\n      id: 'page-1',\n      title: 'Our Story',\n      slug: 'our-story',\n      status: 'published' as const,\n      createdAt: '2025-01-01T00:00:00Z',\n      updatedAt: '2025-01-01T00:00:00Z',\n    },\n    {\n      id: 'page-2',\n      title: 'Travel Info',\n      slug: 'travel-info',\n      status: 'draft' as const,\n      createdAt: '2025-01-02T00:00:00Z',\n      updatedAt: '2025-01-02T00:00:00Z',\n    },\n  ];\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    mockUseToast.mockReturnValue({\n      showToast: mockShowToast,\n      toasts: [],\n      removeToast: jest.fn(),\n    });\n\n    mockUseContentPages.mockReturnValue({\n      data: mockPages,\n      loading: false,\n      error: null,\n      refetch: mockRefetch,\n      create: mockCreate,\n      update: mockUpdate,\n      remove: mockRemove,\n    });\n  });\n\n  describe('View Button', () => {\n    it('should render View button for each content page', () => {\n      render(<ContentPagesPage />);\n\n      // Get all View buttons - DataTable renders them in both header and body\n      const viewButtons = screen.getAllByRole('button', { name: /view.*as guest/i });\n      // Should have 2 buttons per page (header + body)\n      expect(viewButtons.length).toBeGreaterThanOrEqual(mockPages.length);\n    });\n\n    it('should navigate to guest-facing page when View button is clicked', () => {\n      render(<ContentPagesPage />);\n\n      const viewButtons = screen.getAllByRole('button', { name: /view our story as guest/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toBe('/our-story');\n    });\n\n    it('should generate correct URL for each page slug', () => {\n      render(<ContentPagesPage />);\n\n      // Test first page\n      const viewButton1 = screen.getAllByRole('button', { name: /view our story as guest/i })[0];\n      fireEvent.click(viewButton1);\n      expect(window.location.href).toBe('/our-story');\n\n      // Reset location\n      window.location.href = '';\n\n      // Test second page\n      const viewButton2 = screen.getAllByRole('button', { name: /view travel info as guest/i })[0];\n      fireEvent.click(viewButton2);\n      expect(window.location.href).toBe('/travel-info');\n    });\n\n    it('should have accessible aria-label for View button', () => {\n      render(<ContentPagesPage />);\n\n      const viewButton = screen.getAllByRole('button', { name: /view our story as guest/i })[0];\n      expect(viewButton).toHaveAttribute('aria-label', 'View Our Story as guest');\n    });\n  });\n\n  describe('Link Generation', () => {\n    it('should generate URL with leading slash', () => {\n      render(<ContentPagesPage />);\n\n      const viewButton = screen.getAllByRole('button', { name: /view our story as guest/i })[0];\n      fireEvent.click(viewButton);\n\n      expect(window.location.href).toMatch(/^\\//);\n    });\n\n    it('should use slug directly without additional path segments', () => {\n      render(<ContentPagesPage />);\n\n      const viewButton = screen.getAllByRole('button', { name: /view our story as guest/i })[0];\n      fireEvent.click(viewButton);\n\n      expect(window.location.href).toBe('/our-story');\n      expect(window.location.href).not.toContain('/content-pages/');\n      expect(window.location.href).not.toContain('/guest/');\n    });\n\n    it('should handle slugs with hyphens correctly', () => {\n      render(<ContentPagesPage />);\n\n      const viewButton = screen.getAllByRole('button', { name: /view travel info as guest/i })[0];\n      fireEvent.click(viewButton);\n\n      expect(window.location.href).toBe('/travel-info');\n    });\n  });\n});\n"],"names":["jest","mock","useRouter","push","fn","replace","refresh","back","forward","prefetch","useSearchParams","get","getAll","has","keys","values","entries","forEach","toString","usePathname","window","location","href","mockUseContentPages","useContentPages","mockUseToast","useToast","describe","mockShowToast","mockRefetch","mockCreate","mockUpdate","mockRemove","mockPages","id","title","slug","status","createdAt","updatedAt","beforeEach","clearAllMocks","mockReturnValue","showToast","toasts","removeToast","data","loading","error","refetch","create","update","remove","it","render","ContentPagesPage","viewButtons","screen","getAllByRole","name","expect","length","toBeGreaterThanOrEqual","fireEvent","click","toBe","viewButton1","viewButton2","viewButton","toHaveAttribute","toMatch","not","toContain"],"mappings":"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"}