{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/adminUserSchema.integration.test.ts"],"sourcesContent":["/**\n * Integration tests for admin user database schema\n * Tests migrations 038, 039, 040\n * Requirements: 3.1, 3.3, 4.6, 4.7, 17.1, 17.2\n */\n\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\n\ndescribe('Admin User Schema Integration Tests', () => {\n  let supabase: ReturnType<typeof createClient>;\n\n  beforeAll(() => {\n    supabase = createClient(supabaseUrl, supabaseServiceKey);\n  });\n\n  describe('admin_users table', () => {\n    it('should have correct schema structure', async () => {\n      const { data, error } = await supabase\n        .from('admin_users')\n        .select('*')\n        .limit(0);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should enforce role enum constraint', async () => {\n      const { error } = await supabase\n        .from('admin_users')\n        .insert({\n          email: 'test@example.com',\n          role: 'invalid_role', // Should fail\n        });\n\n      expect(error).toBeTruthy();\n      expect(error?.message).toContain('role');\n    });\n\n    it('should enforce status enum constraint', async () => {\n      const { error } = await supabase\n        .from('admin_users')\n        .insert({\n          email: 'test@example.com',\n          role: 'admin',\n          status: 'invalid_status', // Should fail\n        });\n\n      expect(error).toBeTruthy();\n      expect(error?.message).toContain('status');\n    });\n\n    it('should enforce email uniqueness', async () => {\n      const email = `unique-test-${Date.now()}@example.com`;\n\n      // Insert first user\n      const { error: error1 } = await supabase\n        .from('admin_users')\n        .insert({\n          email,\n          role: 'admin',\n        });\n\n      expect(error1).toBeNull();\n\n      // Try to insert duplicate email\n      const { error: error2 } = await supabase\n        .from('admin_users')\n        .insert({\n          email,\n          role: 'admin',\n        });\n\n      expect(error2).toBeTruthy();\n      expect(error2?.message).toContain('unique');\n\n      // Cleanup\n      await supabase.from('admin_users').delete().eq('email', email);\n    });\n\n    it('should have default values for status and timestamps', async () => {\n      const email = `default-test-${Date.now()}@example.com`;\n\n      const { data, error } = await supabase\n        .from('admin_users')\n        .insert({\n          email,\n          role: 'admin',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data?.status).toBe('active');\n      expect(data?.created_at).toBeDefined();\n      expect(data?.updated_at).toBeDefined();\n      expect(data?.invited_at).toBeDefined();\n\n      // Cleanup\n      await supabase.from('admin_users').delete().eq('email', email);\n    });\n\n    it('should support self-referential invited_by foreign key', async () => {\n      const ownerEmail = `owner-${Date.now()}@example.com`;\n      const adminEmail = `admin-${Date.now()}@example.com`;\n\n      // Create owner\n      const { data: owner, error: ownerError } = await supabase\n        .from('admin_users')\n        .insert({\n          email: ownerEmail,\n          role: 'owner',\n        })\n        .select()\n        .single();\n\n      expect(ownerError).toBeNull();\n      expect(owner).toBeDefined();\n\n      // Create admin invited by owner\n      const { data: admin, error: adminError } = await supabase\n        .from('admin_users')\n        .insert({\n          email: adminEmail,\n          role: 'admin',\n          invited_by: owner!.id,\n        })\n        .select()\n        .single();\n\n      expect(adminError).toBeNull();\n      expect(admin).toBeDefined();\n      expect(admin?.invited_by).toBe(owner!.id);\n\n      // Cleanup\n      await supabase.from('admin_users').delete().eq('email', adminEmail);\n      await supabase.from('admin_users').delete().eq('email', ownerEmail);\n    });\n\n    it('should have indexes on email and status', async () => {\n      // Query using indexed columns should be fast\n      const { data, error } = await supabase\n        .from('admin_users')\n        .select('*')\n        .eq('status', 'active')\n        .limit(10);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n  });\n\n  describe('email_templates table', () => {\n    it('should have correct schema structure', async () => {\n      const { data, error } = await supabase\n        .from('email_templates')\n        .select('*')\n        .limit(0);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should enforce category enum constraint', async () => {\n      const { error } = await supabase\n        .from('email_templates')\n        .insert({\n          name: 'Test Template',\n          subject: 'Test Subject',\n          body_html: '<p>Test</p>',\n          category: 'invalid_category', // Should fail\n        });\n\n      expect(error).toBeTruthy();\n      expect(error?.message).toContain('category');\n    });\n\n    it('should have default values', async () => {\n      const name = `Test Template ${Date.now()}`;\n\n      const { data, error } = await supabase\n        .from('email_templates')\n        .insert({\n          name,\n          subject: 'Test Subject',\n          body_html: '<p>Test</p>',\n          category: 'custom',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data?.variables).toEqual([]);\n      expect(data?.usage_count).toBe(0);\n      expect(data?.created_at).toBeDefined();\n      expect(data?.updated_at).toBeDefined();\n\n      // Cleanup\n      await supabase.from('email_templates').delete().eq('name', name);\n    });\n\n    it('should store variables as JSONB array', async () => {\n      const name = `Test Template ${Date.now()}`;\n      const variables = ['guest_name', 'event_name', 'rsvp_link'];\n\n      const { data, error } = await supabase\n        .from('email_templates')\n        .insert({\n          name,\n          subject: 'Test Subject',\n          body_html: '<p>Test</p>',\n          variables,\n          category: 'custom',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data?.variables).toEqual(variables);\n\n      // Cleanup\n      await supabase.from('email_templates').delete().eq('name', name);\n    });\n\n    it('should have default templates inserted', async () => {\n      const { data, error } = await supabase\n        .from('email_templates')\n        .select('*')\n        .eq('is_default', true);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data!.length).toBeGreaterThan(0);\n\n      // Check for specific default templates\n      const templateNames = data!.map((t) => t.name);\n      expect(templateNames).toContain('RSVP Confirmation');\n      expect(templateNames).toContain('RSVP Reminder');\n      expect(templateNames).toContain('Activity Reminder');\n      expect(templateNames).toContain('General Announcement');\n    });\n\n    it('should have index on category', async () => {\n      const { data, error } = await supabase\n        .from('email_templates')\n        .select('*')\n        .eq('category', 'rsvp')\n        .limit(10);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n  });\n\n  describe('email_history table', () => {\n    it('should have correct schema structure', async () => {\n      const { data, error } = await supabase\n        .from('email_history')\n        .select('*')\n        .limit(0);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should enforce delivery_status enum constraint', async () => {\n      const { error } = await supabase\n        .from('email_history')\n        .insert({\n          recipient_ids: ['00000000-0000-0000-0000-000000000000'],\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n          delivery_status: 'invalid_status', // Should fail\n        });\n\n      expect(error).toBeTruthy();\n      expect(error?.message).toContain('delivery_status');\n    });\n\n    it('should have default values', async () => {\n      const { data, error } = await supabase\n        .from('email_history')\n        .insert({\n          recipient_ids: ['00000000-0000-0000-0000-000000000000'],\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data?.delivery_status).toBe('pending');\n      expect(data?.created_at).toBeDefined();\n      expect(data?.updated_at).toBeDefined();\n\n      // Cleanup\n      await supabase.from('email_history').delete().eq('id', data!.id);\n    });\n\n    it('should support UUID array for recipient_ids', async () => {\n      const recipientIds = [\n        '00000000-0000-0000-0000-000000000001',\n        '00000000-0000-0000-0000-000000000002',\n        '00000000-0000-0000-0000-000000000003',\n      ];\n\n      const { data, error } = await supabase\n        .from('email_history')\n        .insert({\n          recipient_ids: recipientIds,\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data?.recipient_ids).toEqual(recipientIds);\n\n      // Cleanup\n      await supabase.from('email_history').delete().eq('id', data!.id);\n    });\n\n    it('should support foreign key to email_templates', async () => {\n      // Create template\n      const templateName = `Test Template ${Date.now()}`;\n      const { data: template, error: templateError } = await supabase\n        .from('email_templates')\n        .insert({\n          name: templateName,\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n        })\n        .select()\n        .single();\n\n      expect(templateError).toBeNull();\n\n      // Create email history with template reference\n      const { data: history, error: historyError } = await supabase\n        .from('email_history')\n        .insert({\n          template_id: template!.id,\n          recipient_ids: ['00000000-0000-0000-0000-000000000000'],\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n        })\n        .select()\n        .single();\n\n      expect(historyError).toBeNull();\n      expect(history?.template_id).toBe(template!.id);\n\n      // Cleanup\n      await supabase.from('email_history').delete().eq('id', history!.id);\n      await supabase.from('email_templates').delete().eq('name', templateName);\n    });\n\n    it('should support foreign key to admin_users for sent_by', async () => {\n      // Create admin user\n      const email = `test-${Date.now()}@example.com`;\n      const { data: admin, error: adminError } = await supabase\n        .from('admin_users')\n        .insert({\n          email,\n          role: 'admin',\n        })\n        .select()\n        .single();\n\n      expect(adminError).toBeNull();\n\n      // Create email history with sent_by reference\n      const { data: history, error: historyError } = await supabase\n        .from('email_history')\n        .insert({\n          recipient_ids: ['00000000-0000-0000-0000-000000000000'],\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n          sent_by: admin!.id,\n        })\n        .select()\n        .single();\n\n      expect(historyError).toBeNull();\n      expect(history?.sent_by).toBe(admin!.id);\n\n      // Cleanup\n      await supabase.from('email_history').delete().eq('id', history!.id);\n      await supabase.from('admin_users').delete().eq('email', email);\n    });\n\n    it('should have indexes on sent_at, scheduled_for, and delivery_status', async () => {\n      const { data, error } = await supabase\n        .from('email_history')\n        .select('*')\n        .eq('delivery_status', 'pending')\n        .order('sent_at', { ascending: false })\n        .limit(10);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should support webhook_data as JSONB', async () => {\n      const webhookData = {\n        event: 'delivered',\n        timestamp: new Date().toISOString(),\n        messageId: 'msg-123',\n      };\n\n      const { data, error } = await supabase\n        .from('email_history')\n        .insert({\n          recipient_ids: ['00000000-0000-0000-0000-000000000000'],\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n          webhook_data: webhookData,\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data?.webhook_data).toEqual(webhookData);\n\n      // Cleanup\n      await supabase.from('email_history').delete().eq('id', data!.id);\n    });\n  });\n\n  describe('Foreign key cascades', () => {\n    it('should set template_id to NULL when template is deleted', async () => {\n      // Create template\n      const templateName = `Test Template ${Date.now()}`;\n      const { data: template } = await supabase\n        .from('email_templates')\n        .insert({\n          name: templateName,\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n        })\n        .select()\n        .single();\n\n      // Create email history\n      const { data: history } = await supabase\n        .from('email_history')\n        .insert({\n          template_id: template!.id,\n          recipient_ids: ['00000000-0000-0000-0000-000000000000'],\n          subject: 'Test',\n          body_html: '<p>Test</p>',\n        })\n        .select()\n        .single();\n\n      // Delete template\n      await supabase.from('email_templates').delete().eq('id', template!.id);\n\n      // Check that template_id is NULL\n      const { data: updatedHistory } = await supabase\n        .from('email_history')\n        .select('*')\n        .eq('id', history!.id)\n        .single();\n\n      expect(updatedHistory?.template_id).toBeNull();\n\n      // Cleanup\n      await supabase.from('email_history').delete().eq('id', history!.id);\n    });\n\n    it('should set invited_by to NULL when inviter is deleted', async () => {\n      const ownerEmail = `owner-${Date.now()}@example.com`;\n      const adminEmail = `admin-${Date.now()}@example.com`;\n\n      // Create owner\n      const { data: owner } = await supabase\n        .from('admin_users')\n        .insert({\n          email: ownerEmail,\n          role: 'owner',\n        })\n        .select()\n        .single();\n\n      // Create admin invited by owner\n      const { data: admin } = await supabase\n        .from('admin_users')\n        .insert({\n          email: adminEmail,\n          role: 'admin',\n          invited_by: owner!.id,\n        })\n        .select()\n        .single();\n\n      // Delete owner\n      await supabase.from('admin_users').delete().eq('id', owner!.id);\n\n      // Check that invited_by is NULL\n      const { data: updatedAdmin } = await supabase\n        .from('admin_users')\n        .select('*')\n        .eq('id', admin!.id)\n        .single();\n\n      expect(updatedAdmin?.invited_by).toBeNull();\n\n      // Cleanup\n      await supabase.from('admin_users').delete().eq('id', admin!.id);\n    });\n  });\n});\n"],"names":["supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceKey","SUPABASE_SERVICE_ROLE_KEY","describe","supabase","beforeAll","createClient","it","data","error","from","select","limit","expect","toBeNull","toBeDefined","insert","email","role","toBeTruthy","message","toContain","status","Date","now","error1","error2","delete","eq","single","toBe","created_at","updated_at","invited_at","ownerEmail","adminEmail","owner","ownerError","admin","adminError","invited_by","id","name","subject","body_html","category","variables","toEqual","usage_count","length","toBeGreaterThan","templateNames","map","t","recipient_ids","delivery_status","recipientIds","templateName","template","templateError","history","historyError","template_id","sent_by","order","ascending","webhookData","event","timestamp","toISOString","messageId","webhook_data","updatedHistory","updatedAdmin"],"mappings":"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"}