0567f5b1ad057e277ff8a466253dbd50
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "POST", {
    enumerable: true,
    get: function() {
        return POST;
    }
});
const _server = require("next/server");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
async function POST(request) {
    try {
        const { userId, email, role } = await request.json();
        if (!userId || !email || !role) {
            return _server.NextResponse.json({
                error: 'Missing required fields'
            }, {
                status: 400
            });
        }
        // Create Supabase client with secret key to bypass RLS
        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
        const supabaseSecretKey = process.env.SUPABASE_SECRET_KEY;
        if (!supabaseUrl || !supabaseSecretKey) {
            console.error('Missing Supabase environment variables');
            return _server.NextResponse.json({
                error: 'Server configuration error'
            }, {
                status: 500
            });
        }
        // Use secret key client to bypass RLS
        const { createClient } = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("@supabase/supabase-js")));
        const supabaseAdmin = createClient(supabaseUrl, supabaseSecretKey, {
            auth: {
                autoRefreshToken: false,
                persistSession: false
            }
        });
        // Wait a moment for auth.users to be created
        await new Promise((resolve)=>setTimeout(resolve, 1000));
        // Verify user exists in auth.users first
        const { data: authUser, error: authError } = await supabaseAdmin.auth.admin.getUserById(userId);
        if (authError || !authUser) {
            console.error('User not found in auth.users:', authError);
            // Try again after another delay
            await new Promise((resolve)=>setTimeout(resolve, 2000));
            const { data: retryAuthUser, error: retryAuthError } = await supabaseAdmin.auth.admin.getUserById(userId);
            if (retryAuthError || !retryAuthUser) {
                return _server.NextResponse.json({
                    error: 'User not found in authentication system'
                }, {
                    status: 404
                });
            }
        }
        // Insert user record
        const { error: insertError } = await supabaseAdmin.from('users').insert({
            id: userId,
            email: email,
            role: role
        });
        if (insertError) {
            console.error('Error inserting user:', insertError);
            return _server.NextResponse.json({
                error: 'Failed to create user record',
                details: insertError.message
            }, {
                status: 500
            });
        }
        return _server.NextResponse.json({
            success: true
        });
    } catch (error) {
        console.error('Unexpected error:', error);
        return _server.NextResponse.json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hdXRoL2NyZWF0ZS11c2VyL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZVNlcnZlcic7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHVzZXJJZCwgZW1haWwsIHJvbGUgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgaWYgKCF1c2VySWQgfHwgIWVtYWlsIHx8ICFyb2xlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBTdXBhYmFzZSBjbGllbnQgd2l0aCBzZWNyZXQga2V5IHRvIGJ5cGFzcyBSTFNcbiAgICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgICBjb25zdCBzdXBhYmFzZVNlY3JldEtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFQ1JFVF9LRVk7XG5cbiAgICBpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZVNlY3JldEtleSkge1xuICAgICAgY29uc29sZS5lcnJvcignTWlzc2luZyBTdXBhYmFzZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMnKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1NlcnZlciBjb25maWd1cmF0aW9uIGVycm9yJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gVXNlIHNlY3JldCBrZXkgY2xpZW50IHRvIGJ5cGFzcyBSTFNcbiAgICBjb25zdCB7IGNyZWF0ZUNsaWVudCB9ID0gYXdhaXQgaW1wb3J0KCdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnKTtcbiAgICBjb25zdCBzdXBhYmFzZUFkbWluID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlY3JldEtleSwge1xuICAgICAgYXV0aDoge1xuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFdhaXQgYSBtb21lbnQgZm9yIGF1dGgudXNlcnMgdG8gYmUgY3JlYXRlZFxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG5cbiAgICAvLyBWZXJpZnkgdXNlciBleGlzdHMgaW4gYXV0aC51c2VycyBmaXJzdFxuICAgIGNvbnN0IHsgZGF0YTogYXV0aFVzZXIsIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uYXV0aC5hZG1pbi5nZXRVc2VyQnlJZCh1c2VySWQpO1xuICAgIFxuICAgIGlmIChhdXRoRXJyb3IgfHwgIWF1dGhVc2VyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdVc2VyIG5vdCBmb3VuZCBpbiBhdXRoLnVzZXJzOicsIGF1dGhFcnJvcik7XG4gICAgICAvLyBUcnkgYWdhaW4gYWZ0ZXIgYW5vdGhlciBkZWxheVxuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDIwMDApKTtcbiAgICAgIGNvbnN0IHsgZGF0YTogcmV0cnlBdXRoVXNlciwgZXJyb3I6IHJldHJ5QXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmF1dGguYWRtaW4uZ2V0VXNlckJ5SWQodXNlcklkKTtcbiAgICAgIFxuICAgICAgaWYgKHJldHJ5QXV0aEVycm9yIHx8ICFyZXRyeUF1dGhVc2VyKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnVXNlciBub3QgZm91bmQgaW4gYXV0aGVudGljYXRpb24gc3lzdGVtJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEluc2VydCB1c2VyIHJlY29yZFxuICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIGlkOiB1c2VySWQsXG4gICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgcm9sZTogcm9sZSxcbiAgICAgIH0pO1xuXG4gICAgaWYgKGluc2VydEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbnNlcnRpbmcgdXNlcjonLCBpbnNlcnRFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHVzZXIgcmVjb3JkJywgZGV0YWlsczogaW5zZXJ0RXJyb3IubWVzc2FnZSB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogdHJ1ZSB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlBPU1QiLCJyZXF1ZXN0IiwidXNlcklkIiwiZW1haWwiLCJyb2xlIiwianNvbiIsIk5leHRSZXNwb25zZSIsImVycm9yIiwic3RhdHVzIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VTZWNyZXRLZXkiLCJTVVBBQkFTRV9TRUNSRVRfS0VZIiwiY29uc29sZSIsImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlQWRtaW4iLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZGF0YSIsImF1dGhVc2VyIiwiYXV0aEVycm9yIiwiYWRtaW4iLCJnZXRVc2VyQnlJZCIsInJldHJ5QXV0aFVzZXIiLCJyZXRyeUF1dGhFcnJvciIsImluc2VydEVycm9yIiwiZnJvbSIsImluc2VydCIsImlkIiwiZGV0YWlscyIsIm1lc3NhZ2UiLCJzdWNjZXNzIl0sIm1hcHBpbmdzIjoiOzs7OytCQUdzQkE7OztlQUFBQTs7O3dCQUZPOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFdEIsZUFBZUEsS0FBS0MsT0FBZ0I7SUFDekMsSUFBSTtRQUNGLE1BQU0sRUFBRUMsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLElBQUksRUFBRSxHQUFHLE1BQU1ILFFBQVFJLElBQUk7UUFFbEQsSUFBSSxDQUFDSCxVQUFVLENBQUNDLFNBQVMsQ0FBQ0MsTUFBTTtZQUM5QixPQUFPRSxvQkFBWSxDQUFDRCxJQUFJLENBQ3RCO2dCQUFFRSxPQUFPO1lBQTBCLEdBQ25DO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSx1REFBdUQ7UUFDdkQsTUFBTUMsY0FBY0MsUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0I7UUFDeEQsTUFBTUMsb0JBQW9CSCxRQUFRQyxHQUFHLENBQUNHLG1CQUFtQjtRQUV6RCxJQUFJLENBQUNMLGVBQWUsQ0FBQ0ksbUJBQW1CO1lBQ3RDRSxRQUFRUixLQUFLLENBQUM7WUFDZCxPQUFPRCxvQkFBWSxDQUFDRCxJQUFJLENBQ3RCO2dCQUFFRSxPQUFPO1lBQTZCLEdBQ3RDO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxzQ0FBc0M7UUFDdEMsTUFBTSxFQUFFUSxZQUFZLEVBQUUsR0FBRyxNQUFNLG1FQUFBLFFBQU87UUFDdEMsTUFBTUMsZ0JBQWdCRCxhQUFhUCxhQUFhSSxtQkFBbUI7WUFDakVLLE1BQU07Z0JBQ0pDLGtCQUFrQjtnQkFDbEJDLGdCQUFnQjtZQUNsQjtRQUNGO1FBRUEsNkNBQTZDO1FBQzdDLE1BQU0sSUFBSUMsUUFBUUMsQ0FBQUEsVUFBV0MsV0FBV0QsU0FBUztRQUVqRCx5Q0FBeUM7UUFDekMsTUFBTSxFQUFFRSxNQUFNQyxRQUFRLEVBQUVsQixPQUFPbUIsU0FBUyxFQUFFLEdBQUcsTUFBTVQsY0FBY0MsSUFBSSxDQUFDUyxLQUFLLENBQUNDLFdBQVcsQ0FBQzFCO1FBRXhGLElBQUl3QixhQUFhLENBQUNELFVBQVU7WUFDMUJWLFFBQVFSLEtBQUssQ0FBQyxpQ0FBaUNtQjtZQUMvQyxnQ0FBZ0M7WUFDaEMsTUFBTSxJQUFJTCxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTO1lBQ2pELE1BQU0sRUFBRUUsTUFBTUssYUFBYSxFQUFFdEIsT0FBT3VCLGNBQWMsRUFBRSxHQUFHLE1BQU1iLGNBQWNDLElBQUksQ0FBQ1MsS0FBSyxDQUFDQyxXQUFXLENBQUMxQjtZQUVsRyxJQUFJNEIsa0JBQWtCLENBQUNELGVBQWU7Z0JBQ3BDLE9BQU92QixvQkFBWSxDQUFDRCxJQUFJLENBQ3RCO29CQUFFRSxPQUFPO2dCQUEwQyxHQUNuRDtvQkFBRUMsUUFBUTtnQkFBSTtZQUVsQjtRQUNGO1FBRUEscUJBQXFCO1FBQ3JCLE1BQU0sRUFBRUQsT0FBT3dCLFdBQVcsRUFBRSxHQUFHLE1BQU1kLGNBQ2xDZSxJQUFJLENBQUMsU0FDTEMsTUFBTSxDQUFDO1lBQ05DLElBQUloQztZQUNKQyxPQUFPQTtZQUNQQyxNQUFNQTtRQUNSO1FBRUYsSUFBSTJCLGFBQWE7WUFDZmhCLFFBQVFSLEtBQUssQ0FBQyx5QkFBeUJ3QjtZQUN2QyxPQUFPekIsb0JBQVksQ0FBQ0QsSUFBSSxDQUN0QjtnQkFBRUUsT0FBTztnQkFBZ0M0QixTQUFTSixZQUFZSyxPQUFPO1lBQUMsR0FDdEU7Z0JBQUU1QixRQUFRO1lBQUk7UUFFbEI7UUFFQSxPQUFPRixvQkFBWSxDQUFDRCxJQUFJLENBQUM7WUFBRWdDLFNBQVM7UUFBSztJQUMzQyxFQUFFLE9BQU85QixPQUFPO1FBQ2RRLFFBQVFSLEtBQUssQ0FBQyxxQkFBcUJBO1FBQ25DLE9BQU9ELG9CQUFZLENBQUNELElBQUksQ0FDdEI7WUFBRUUsT0FBTztRQUF3QixHQUNqQztZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiJ9