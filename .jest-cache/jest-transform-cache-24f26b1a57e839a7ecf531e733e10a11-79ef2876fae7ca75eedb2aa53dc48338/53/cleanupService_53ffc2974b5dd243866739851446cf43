113345ff2256cf3fc3d9946ec44a5ffe
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get cleanupExpiredSessions () {
        return cleanupExpiredSessions;
    },
    get cleanupOldAuditLogs () {
        return cleanupOldAuditLogs;
    },
    get cleanupOldCronLogs () {
        return cleanupOldCronLogs;
    },
    get cleanupOldEmailLogs () {
        return cleanupOldEmailLogs;
    },
    get cleanupOldWebhookLogs () {
        return cleanupOldWebhookLogs;
    },
    get cleanupTempFiles () {
        return cleanupTempFiles;
    },
    get runAllCleanupTasks () {
        return runAllCleanupTasks;
    }
});
const _supabasejs = require("@supabase/supabase-js");
const _fs = require("fs");
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
const _types = require("../types");
const _cronService = require("./cronService");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
// Initialize Supabase client for database operations
const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
async function cleanupTempFiles(maxAgeHours = 24) {
    try {
        const tempDir = _path.default.join(process.cwd(), 'tmp');
        const maxAgeMs = maxAgeHours * 60 * 60 * 1000;
        const now = Date.now();
        let filesDeleted = 0;
        let bytesFreed = 0;
        // Check if temp directory exists
        try {
            await _fs.promises.access(tempDir);
        } catch  {
            // Directory doesn't exist, nothing to clean
            return {
                success: true,
                data: {
                    filesDeleted: 0,
                    bytesFreed: 0
                }
            };
        }
        // Read all files in temp directory
        const files = await _fs.promises.readdir(tempDir);
        for (const file of files){
            const filePath = _path.default.join(tempDir, file);
            try {
                const stats = await _fs.promises.stat(filePath);
                // Check if file is older than max age
                const fileAge = now - stats.mtimeMs;
                if (fileAge > maxAgeMs) {
                    // Delete the file
                    await _fs.promises.unlink(filePath);
                    filesDeleted++;
                    bytesFreed += stats.size;
                }
            } catch (error) {
                // Skip files that can't be accessed or deleted
                console.error(`Failed to process file ${filePath}:`, error);
            }
        }
        return {
            success: true,
            data: {
                filesDeleted,
                bytesFreed
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: _types.ERROR_CODES.UNKNOWN_ERROR,
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function cleanupExpiredSessions() {
    try {
        // Note: Supabase Auth handles session cleanup automatically
        // This function is a placeholder for any custom session cleanup logic
        // Clean up any custom session-related data if needed
        // For example, cleaning up old session logs or temporary session data
        // Get expired sessions from auth.sessions (if accessible)
        // Since we're using Supabase Auth, expired sessions are handled automatically
        // We can clean up related data like old audit logs or temporary data
        return {
            success: true,
            data: {
                sessionsDeleted: 0
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: _types.ERROR_CODES.UNKNOWN_ERROR,
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function cleanupOldAuditLogs(retentionDays = 90) {
    try {
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
        const { data, error } = await supabase.from('audit_logs').delete().lt('created_at', cutoffDate.toISOString()).select('id');
        if (error) {
            return {
                success: false,
                error: {
                    code: _types.ERROR_CODES.DATABASE_ERROR,
                    message: 'Failed to delete old audit logs',
                    details: error
                }
            };
        }
        return {
            success: true,
            data: {
                logsDeleted: data?.length || 0
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: _types.ERROR_CODES.UNKNOWN_ERROR,
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function cleanupOldCronLogs(retentionDays = 30) {
    try {
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
        const { data, error } = await supabase.from('cron_job_logs').delete().lt('started_at', cutoffDate.toISOString()).select('id');
        if (error) {
            return {
                success: false,
                error: {
                    code: _types.ERROR_CODES.DATABASE_ERROR,
                    message: 'Failed to delete old cron job logs',
                    details: error
                }
            };
        }
        return {
            success: true,
            data: {
                logsDeleted: data?.length || 0
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: _types.ERROR_CODES.UNKNOWN_ERROR,
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function cleanupOldEmailLogs(retentionDays = 180) {
    try {
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
        const { data, error } = await supabase.from('email_logs').delete().lt('created_at', cutoffDate.toISOString()).select('id');
        if (error) {
            return {
                success: false,
                error: {
                    code: _types.ERROR_CODES.DATABASE_ERROR,
                    message: 'Failed to delete old email logs',
                    details: error
                }
            };
        }
        return {
            success: true,
            data: {
                logsDeleted: data?.length || 0
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: _types.ERROR_CODES.UNKNOWN_ERROR,
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function cleanupOldWebhookLogs(retentionDays = 30) {
    try {
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
        const { data, error } = await supabase.from('webhook_delivery_logs').delete().lt('created_at', cutoffDate.toISOString()).select('id');
        if (error) {
            return {
                success: false,
                error: {
                    code: _types.ERROR_CODES.DATABASE_ERROR,
                    message: 'Failed to delete old webhook logs',
                    details: error
                }
            };
        }
        return {
            success: true,
            data: {
                logsDeleted: data?.length || 0
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: _types.ERROR_CODES.UNKNOWN_ERROR,
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function runAllCleanupTasks() {
    return (0, _cronService.executeCronJob)('temp_file_cleanup', async ()=>{
        const results = {
            tempFiles: {
                filesDeleted: 0,
                bytesFreed: 0
            },
            expiredSessions: {
                sessionsDeleted: 0
            },
            auditLogs: {
                logsDeleted: 0
            },
            cronLogs: {
                logsDeleted: 0
            },
            emailLogs: {
                logsDeleted: 0
            },
            webhookLogs: {
                logsDeleted: 0
            }
        };
        let totalProcessed = 0;
        let totalFailed = 0;
        // Clean up temp files
        const tempFilesResult = await cleanupTempFiles(24);
        if (tempFilesResult.success) {
            results.tempFiles = tempFilesResult.data;
            totalProcessed += tempFilesResult.data.filesDeleted;
        } else {
            totalFailed++;
            console.error('Failed to clean up temp files:', tempFilesResult.error);
        }
        // Clean up expired sessions
        const sessionsResult = await cleanupExpiredSessions();
        if (sessionsResult.success) {
            results.expiredSessions = sessionsResult.data;
            totalProcessed += sessionsResult.data.sessionsDeleted;
        } else {
            totalFailed++;
            console.error('Failed to clean up expired sessions:', sessionsResult.error);
        }
        // Clean up old audit logs (90 days)
        const auditLogsResult = await cleanupOldAuditLogs(90);
        if (auditLogsResult.success) {
            results.auditLogs = auditLogsResult.data;
            totalProcessed += auditLogsResult.data.logsDeleted;
        } else {
            totalFailed++;
            console.error('Failed to clean up audit logs:', auditLogsResult.error);
        }
        // Clean up old cron logs (30 days)
        const cronLogsResult = await cleanupOldCronLogs(30);
        if (cronLogsResult.success) {
            results.cronLogs = cronLogsResult.data;
            totalProcessed += cronLogsResult.data.logsDeleted;
        } else {
            totalFailed++;
            console.error('Failed to clean up cron logs:', cronLogsResult.error);
        }
        // Clean up old email logs (180 days)
        const emailLogsResult = await cleanupOldEmailLogs(180);
        if (emailLogsResult.success) {
            results.emailLogs = emailLogsResult.data;
            totalProcessed += emailLogsResult.data.logsDeleted;
        } else {
            totalFailed++;
            console.error('Failed to clean up email logs:', emailLogsResult.error);
        }
        // Clean up old webhook logs (30 days)
        const webhookLogsResult = await cleanupOldWebhookLogs(30);
        if (webhookLogsResult.success) {
            results.webhookLogs = webhookLogsResult.data;
            totalProcessed += webhookLogsResult.data.logsDeleted;
        } else {
            totalFailed++;
            console.error('Failed to clean up webhook logs:', webhookLogsResult.error);
        }
        return {
            itemsProcessed: totalProcessed,
            itemsFailed: totalFailed
        };
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvY2xlYW51cFNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbmltcG9ydCB7IHByb21pc2VzIGFzIGZzIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgdHlwZSB7IFJlc3VsdCB9IGZyb20gJ0AvdHlwZXMnO1xuaW1wb3J0IHsgRVJST1JfQ09ERVMgfSBmcm9tICdAL3R5cGVzJztcbmltcG9ydCB7IGV4ZWN1dGVDcm9uSm9iLCB0eXBlIENyb25Kb2JSZXN1bHQgfSBmcm9tICcuL2Nyb25TZXJ2aWNlJztcblxuLy8gSW5pdGlhbGl6ZSBTdXBhYmFzZSBjbGllbnQgZm9yIGRhdGFiYXNlIG9wZXJhdGlvbnNcbmNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuKTtcblxuLyoqXG4gKiBDbGVhbnMgdXAgdGVtcG9yYXJ5IGZpbGVzIG9sZGVyIHRoYW4gdGhlIHNwZWNpZmllZCBhZ2UuXG4gKiBcbiAqIEBwYXJhbSBtYXhBZ2VIb3VycyAtIE1heGltdW0gYWdlIG9mIGZpbGVzIHRvIGtlZXAgaW4gaG91cnMgKGRlZmF1bHQ6IDI0KVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgY2xlYW51cCBzdGF0aXN0aWNzXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMjIuNSwgMjIuNywgMTkuNFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW51cFRlbXBGaWxlcyhcbiAgbWF4QWdlSG91cnM6IG51bWJlciA9IDI0XG4pOiBQcm9taXNlPFJlc3VsdDx7IGZpbGVzRGVsZXRlZDogbnVtYmVyOyBieXRlc0ZyZWVkOiBudW1iZXIgfT4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB0ZW1wRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd0bXAnKTtcbiAgICBjb25zdCBtYXhBZ2VNcyA9IG1heEFnZUhvdXJzICogNjAgKiA2MCAqIDEwMDA7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcblxuICAgIGxldCBmaWxlc0RlbGV0ZWQgPSAwO1xuICAgIGxldCBieXRlc0ZyZWVkID0gMDtcblxuICAgIC8vIENoZWNrIGlmIHRlbXAgZGlyZWN0b3J5IGV4aXN0c1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy5hY2Nlc3ModGVtcERpcik7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBEaXJlY3RvcnkgZG9lc24ndCBleGlzdCwgbm90aGluZyB0byBjbGVhblxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogeyBmaWxlc0RlbGV0ZWQ6IDAsIGJ5dGVzRnJlZWQ6IDAgfSB9O1xuICAgIH1cblxuICAgIC8vIFJlYWQgYWxsIGZpbGVzIGluIHRlbXAgZGlyZWN0b3J5XG4gICAgY29uc3QgZmlsZXMgPSBhd2FpdCBmcy5yZWFkZGlyKHRlbXBEaXIpO1xuXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbih0ZW1wRGlyLCBmaWxlKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBmcy5zdGF0KGZpbGVQYXRoKTtcblxuICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGlzIG9sZGVyIHRoYW4gbWF4IGFnZVxuICAgICAgICBjb25zdCBmaWxlQWdlID0gbm93IC0gc3RhdHMubXRpbWVNcztcblxuICAgICAgICBpZiAoZmlsZUFnZSA+IG1heEFnZU1zKSB7XG4gICAgICAgICAgLy8gRGVsZXRlIHRoZSBmaWxlXG4gICAgICAgICAgYXdhaXQgZnMudW5saW5rKGZpbGVQYXRoKTtcbiAgICAgICAgICBmaWxlc0RlbGV0ZWQrKztcbiAgICAgICAgICBieXRlc0ZyZWVkICs9IHN0YXRzLnNpemU7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIFNraXAgZmlsZXMgdGhhdCBjYW4ndCBiZSBhY2Nlc3NlZCBvciBkZWxldGVkXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBwcm9jZXNzIGZpbGUgJHtmaWxlUGF0aH06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgZmlsZXNEZWxldGVkLCBieXRlc0ZyZWVkIH0gfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiBFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFucyB1cCBleHBpcmVkIHNlc3Npb25zIGZyb20gdGhlIGRhdGFiYXNlLlxuICogXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyBjbGVhbnVwIHN0YXRpc3RpY3NcbiAqIFxuICogUmVxdWlyZW1lbnRzOiAyMi41LCAyMi44LCAxOS40XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwRXhwaXJlZFNlc3Npb25zKCk6IFByb21pc2U8XG4gIFJlc3VsdDx7IHNlc3Npb25zRGVsZXRlZDogbnVtYmVyIH0+XG4+IHtcbiAgdHJ5IHtcbiAgICAvLyBOb3RlOiBTdXBhYmFzZSBBdXRoIGhhbmRsZXMgc2Vzc2lvbiBjbGVhbnVwIGF1dG9tYXRpY2FsbHlcbiAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGEgcGxhY2Vob2xkZXIgZm9yIGFueSBjdXN0b20gc2Vzc2lvbiBjbGVhbnVwIGxvZ2ljXG5cbiAgICAvLyBDbGVhbiB1cCBhbnkgY3VzdG9tIHNlc3Npb24tcmVsYXRlZCBkYXRhIGlmIG5lZWRlZFxuICAgIC8vIEZvciBleGFtcGxlLCBjbGVhbmluZyB1cCBvbGQgc2Vzc2lvbiBsb2dzIG9yIHRlbXBvcmFyeSBzZXNzaW9uIGRhdGFcblxuICAgIC8vIEdldCBleHBpcmVkIHNlc3Npb25zIGZyb20gYXV0aC5zZXNzaW9ucyAoaWYgYWNjZXNzaWJsZSlcbiAgICAvLyBTaW5jZSB3ZSdyZSB1c2luZyBTdXBhYmFzZSBBdXRoLCBleHBpcmVkIHNlc3Npb25zIGFyZSBoYW5kbGVkIGF1dG9tYXRpY2FsbHlcbiAgICAvLyBXZSBjYW4gY2xlYW4gdXAgcmVsYXRlZCBkYXRhIGxpa2Ugb2xkIGF1ZGl0IGxvZ3Mgb3IgdGVtcG9yYXJ5IGRhdGFcblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgc2Vzc2lvbnNEZWxldGVkOiAwIH0gfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiBFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFucyB1cCBvbGQgYXVkaXQgbG9ncyB0byBwcmV2ZW50IGRhdGFiYXNlIGJsb2F0LlxuICogXG4gKiBAcGFyYW0gcmV0ZW50aW9uRGF5cyAtIE51bWJlciBvZiBkYXlzIHRvIHJldGFpbiBhdWRpdCBsb2dzIChkZWZhdWx0OiA5MClcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIGNsZWFudXAgc3RhdGlzdGljc1xuICogXG4gKiBSZXF1aXJlbWVudHM6IDIyLjUsIDE5LjRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBPbGRBdWRpdExvZ3MoXG4gIHJldGVudGlvbkRheXM6IG51bWJlciA9IDkwXG4pOiBQcm9taXNlPFJlc3VsdDx7IGxvZ3NEZWxldGVkOiBudW1iZXIgfT4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoKTtcbiAgICBjdXRvZmZEYXRlLnNldERhdGUoY3V0b2ZmRGF0ZS5nZXREYXRlKCkgLSByZXRlbnRpb25EYXlzKTtcblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYXVkaXRfbG9ncycpXG4gICAgICAuZGVsZXRlKClcbiAgICAgIC5sdCgnY3JlYXRlZF9hdCcsIGN1dG9mZkRhdGUudG9JU09TdHJpbmcoKSlcbiAgICAgIC5zZWxlY3QoJ2lkJyk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6IEVSUk9SX0NPREVTLkRBVEFCQVNFX0VSUk9SLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIG9sZCBhdWRpdCBsb2dzJyxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogeyBsb2dzRGVsZXRlZDogZGF0YT8ubGVuZ3RoIHx8IDAgfSB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6IEVSUk9SX0NPREVTLlVOS05PV05fRVJST1IsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogQ2xlYW5zIHVwIG9sZCBjcm9uIGpvYiBsb2dzIHRvIHByZXZlbnQgZGF0YWJhc2UgYmxvYXQuXG4gKiBcbiAqIEBwYXJhbSByZXRlbnRpb25EYXlzIC0gTnVtYmVyIG9mIGRheXMgdG8gcmV0YWluIGNyb24gam9iIGxvZ3MgKGRlZmF1bHQ6IDMwKVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgY2xlYW51cCBzdGF0aXN0aWNzXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMjIuNSwgMjIuNiwgMTkuNFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW51cE9sZENyb25Mb2dzKFxuICByZXRlbnRpb25EYXlzOiBudW1iZXIgPSAzMFxuKTogUHJvbWlzZTxSZXN1bHQ8eyBsb2dzRGVsZXRlZDogbnVtYmVyIH0+PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY3V0b2ZmRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY3V0b2ZmRGF0ZS5zZXREYXRlKGN1dG9mZkRhdGUuZ2V0RGF0ZSgpIC0gcmV0ZW50aW9uRGF5cyk7XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2Nyb25fam9iX2xvZ3MnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAubHQoJ3N0YXJ0ZWRfYXQnLCBjdXRvZmZEYXRlLnRvSVNPU3RyaW5nKCkpXG4gICAgICAuc2VsZWN0KCdpZCcpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiBFUlJPUl9DT0RFUy5EQVRBQkFTRV9FUlJPUixcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGRlbGV0ZSBvbGQgY3JvbiBqb2IgbG9ncycsXG4gICAgICAgICAgZGV0YWlsczogZXJyb3IsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgbG9nc0RlbGV0ZWQ6IGRhdGE/Lmxlbmd0aCB8fCAwIH0gfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiBFUlJPUl9DT0RFUy5VTktOT1dOX0VSUk9SLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFucyB1cCBvbGQgZW1haWwgbG9ncyB0byBwcmV2ZW50IGRhdGFiYXNlIGJsb2F0LlxuICogXG4gKiBAcGFyYW0gcmV0ZW50aW9uRGF5cyAtIE51bWJlciBvZiBkYXlzIHRvIHJldGFpbiBlbWFpbCBsb2dzIChkZWZhdWx0OiAxODApXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyBjbGVhbnVwIHN0YXRpc3RpY3NcbiAqIFxuICogUmVxdWlyZW1lbnRzOiAyMi41LCAxOS40XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwT2xkRW1haWxMb2dzKFxuICByZXRlbnRpb25EYXlzOiBudW1iZXIgPSAxODBcbik6IFByb21pc2U8UmVzdWx0PHsgbG9nc0RlbGV0ZWQ6IG51bWJlciB9Pj4ge1xuICB0cnkge1xuICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGN1dG9mZkRhdGUuc2V0RGF0ZShjdXRvZmZEYXRlLmdldERhdGUoKSAtIHJldGVudGlvbkRheXMpO1xuXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdlbWFpbF9sb2dzJylcbiAgICAgIC5kZWxldGUoKVxuICAgICAgLmx0KCdjcmVhdGVkX2F0JywgY3V0b2ZmRGF0ZS50b0lTT1N0cmluZygpKVxuICAgICAgLnNlbGVjdCgnaWQnKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogRVJST1JfQ09ERVMuREFUQUJBU0VfRVJST1IsXG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgb2xkIGVtYWlsIGxvZ3MnLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB7IGxvZ3NEZWxldGVkOiBkYXRhPy5sZW5ndGggfHwgMCB9IH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUixcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhbnMgdXAgb2xkIHdlYmhvb2sgZGVsaXZlcnkgbG9ncyB0byBwcmV2ZW50IGRhdGFiYXNlIGJsb2F0LlxuICogXG4gKiBAcGFyYW0gcmV0ZW50aW9uRGF5cyAtIE51bWJlciBvZiBkYXlzIHRvIHJldGFpbiB3ZWJob29rIGxvZ3MgKGRlZmF1bHQ6IDMwKVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgY2xlYW51cCBzdGF0aXN0aWNzXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMjIuNSwgMTkuNFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW51cE9sZFdlYmhvb2tMb2dzKFxuICByZXRlbnRpb25EYXlzOiBudW1iZXIgPSAzMFxuKTogUHJvbWlzZTxSZXN1bHQ8eyBsb2dzRGVsZXRlZDogbnVtYmVyIH0+PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY3V0b2ZmRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY3V0b2ZmRGF0ZS5zZXREYXRlKGN1dG9mZkRhdGUuZ2V0RGF0ZSgpIC0gcmV0ZW50aW9uRGF5cyk7XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3dlYmhvb2tfZGVsaXZlcnlfbG9ncycpXG4gICAgICAuZGVsZXRlKClcbiAgICAgIC5sdCgnY3JlYXRlZF9hdCcsIGN1dG9mZkRhdGUudG9JU09TdHJpbmcoKSlcbiAgICAgIC5zZWxlY3QoJ2lkJyk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6IEVSUk9SX0NPREVTLkRBVEFCQVNFX0VSUk9SLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIG9sZCB3ZWJob29rIGxvZ3MnLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB7IGxvZ3NEZWxldGVkOiBkYXRhPy5sZW5ndGggfHwgMCB9IH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogRVJST1JfQ09ERVMuVU5LTk9XTl9FUlJPUixcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBSdW5zIGFsbCBjbGVhbnVwIHRhc2tzLlxuICogVGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgY2FsbGVkIGJ5IGEgc2NoZWR1bGVkIGNyb24gam9iLlxuICogXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyBjb21iaW5lZCBjbGVhbnVwIHN0YXRpc3RpY3NcbiAqIFxuICogUmVxdWlyZW1lbnRzOiAyMi41LCAyMi43LCAyMi44LCAxOS40XG4gKiBcbiAqIEBleGFtcGxlXG4gKiAvLyBSdW4gZGFpbHkgdG8gY2xlYW4gdXAgb2xkIGRhdGFcbiAqIGF3YWl0IHJ1bkFsbENsZWFudXBUYXNrcygpO1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcnVuQWxsQ2xlYW51cFRhc2tzKCk6IFByb21pc2U8UmVzdWx0PENyb25Kb2JSZXN1bHQ+PiB7XG4gIHJldHVybiBleGVjdXRlQ3JvbkpvYigndGVtcF9maWxlX2NsZWFudXAnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0cyA9IHtcbiAgICAgIHRlbXBGaWxlczogeyBmaWxlc0RlbGV0ZWQ6IDAsIGJ5dGVzRnJlZWQ6IDAgfSxcbiAgICAgIGV4cGlyZWRTZXNzaW9uczogeyBzZXNzaW9uc0RlbGV0ZWQ6IDAgfSxcbiAgICAgIGF1ZGl0TG9nczogeyBsb2dzRGVsZXRlZDogMCB9LFxuICAgICAgY3JvbkxvZ3M6IHsgbG9nc0RlbGV0ZWQ6IDAgfSxcbiAgICAgIGVtYWlsTG9nczogeyBsb2dzRGVsZXRlZDogMCB9LFxuICAgICAgd2ViaG9va0xvZ3M6IHsgbG9nc0RlbGV0ZWQ6IDAgfSxcbiAgICB9O1xuXG4gICAgbGV0IHRvdGFsUHJvY2Vzc2VkID0gMDtcbiAgICBsZXQgdG90YWxGYWlsZWQgPSAwO1xuXG4gICAgLy8gQ2xlYW4gdXAgdGVtcCBmaWxlc1xuICAgIGNvbnN0IHRlbXBGaWxlc1Jlc3VsdCA9IGF3YWl0IGNsZWFudXBUZW1wRmlsZXMoMjQpO1xuICAgIGlmICh0ZW1wRmlsZXNSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmVzdWx0cy50ZW1wRmlsZXMgPSB0ZW1wRmlsZXNSZXN1bHQuZGF0YTtcbiAgICAgIHRvdGFsUHJvY2Vzc2VkICs9IHRlbXBGaWxlc1Jlc3VsdC5kYXRhLmZpbGVzRGVsZXRlZDtcbiAgICB9IGVsc2Uge1xuICAgICAgdG90YWxGYWlsZWQrKztcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjbGVhbiB1cCB0ZW1wIGZpbGVzOicsIHRlbXBGaWxlc1Jlc3VsdC5lcnJvcik7XG4gICAgfVxuXG4gICAgLy8gQ2xlYW4gdXAgZXhwaXJlZCBzZXNzaW9uc1xuICAgIGNvbnN0IHNlc3Npb25zUmVzdWx0ID0gYXdhaXQgY2xlYW51cEV4cGlyZWRTZXNzaW9ucygpO1xuICAgIGlmIChzZXNzaW9uc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXN1bHRzLmV4cGlyZWRTZXNzaW9ucyA9IHNlc3Npb25zUmVzdWx0LmRhdGE7XG4gICAgICB0b3RhbFByb2Nlc3NlZCArPSBzZXNzaW9uc1Jlc3VsdC5kYXRhLnNlc3Npb25zRGVsZXRlZDtcbiAgICB9IGVsc2Uge1xuICAgICAgdG90YWxGYWlsZWQrKztcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjbGVhbiB1cCBleHBpcmVkIHNlc3Npb25zOicsIHNlc3Npb25zUmVzdWx0LmVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBDbGVhbiB1cCBvbGQgYXVkaXQgbG9ncyAoOTAgZGF5cylcbiAgICBjb25zdCBhdWRpdExvZ3NSZXN1bHQgPSBhd2FpdCBjbGVhbnVwT2xkQXVkaXRMb2dzKDkwKTtcbiAgICBpZiAoYXVkaXRMb2dzUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJlc3VsdHMuYXVkaXRMb2dzID0gYXVkaXRMb2dzUmVzdWx0LmRhdGE7XG4gICAgICB0b3RhbFByb2Nlc3NlZCArPSBhdWRpdExvZ3NSZXN1bHQuZGF0YS5sb2dzRGVsZXRlZDtcbiAgICB9IGVsc2Uge1xuICAgICAgdG90YWxGYWlsZWQrKztcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjbGVhbiB1cCBhdWRpdCBsb2dzOicsIGF1ZGl0TG9nc1Jlc3VsdC5lcnJvcik7XG4gICAgfVxuXG4gICAgLy8gQ2xlYW4gdXAgb2xkIGNyb24gbG9ncyAoMzAgZGF5cylcbiAgICBjb25zdCBjcm9uTG9nc1Jlc3VsdCA9IGF3YWl0IGNsZWFudXBPbGRDcm9uTG9ncygzMCk7XG4gICAgaWYgKGNyb25Mb2dzUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJlc3VsdHMuY3JvbkxvZ3MgPSBjcm9uTG9nc1Jlc3VsdC5kYXRhO1xuICAgICAgdG90YWxQcm9jZXNzZWQgKz0gY3JvbkxvZ3NSZXN1bHQuZGF0YS5sb2dzRGVsZXRlZDtcbiAgICB9IGVsc2Uge1xuICAgICAgdG90YWxGYWlsZWQrKztcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjbGVhbiB1cCBjcm9uIGxvZ3M6JywgY3JvbkxvZ3NSZXN1bHQuZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIENsZWFuIHVwIG9sZCBlbWFpbCBsb2dzICgxODAgZGF5cylcbiAgICBjb25zdCBlbWFpbExvZ3NSZXN1bHQgPSBhd2FpdCBjbGVhbnVwT2xkRW1haWxMb2dzKDE4MCk7XG4gICAgaWYgKGVtYWlsTG9nc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXN1bHRzLmVtYWlsTG9ncyA9IGVtYWlsTG9nc1Jlc3VsdC5kYXRhO1xuICAgICAgdG90YWxQcm9jZXNzZWQgKz0gZW1haWxMb2dzUmVzdWx0LmRhdGEubG9nc0RlbGV0ZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvdGFsRmFpbGVkKys7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW4gdXAgZW1haWwgbG9nczonLCBlbWFpbExvZ3NSZXN1bHQuZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIENsZWFuIHVwIG9sZCB3ZWJob29rIGxvZ3MgKDMwIGRheXMpXG4gICAgY29uc3Qgd2ViaG9va0xvZ3NSZXN1bHQgPSBhd2FpdCBjbGVhbnVwT2xkV2ViaG9va0xvZ3MoMzApO1xuICAgIGlmICh3ZWJob29rTG9nc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXN1bHRzLndlYmhvb2tMb2dzID0gd2ViaG9va0xvZ3NSZXN1bHQuZGF0YTtcbiAgICAgIHRvdGFsUHJvY2Vzc2VkICs9IHdlYmhvb2tMb2dzUmVzdWx0LmRhdGEubG9nc0RlbGV0ZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvdGFsRmFpbGVkKys7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW4gdXAgd2ViaG9vayBsb2dzOicsIHdlYmhvb2tMb2dzUmVzdWx0LmVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXRlbXNQcm9jZXNzZWQ6IHRvdGFsUHJvY2Vzc2VkLFxuICAgICAgaXRlbXNGYWlsZWQ6IHRvdGFsRmFpbGVkLFxuICAgIH07XG4gIH0pO1xufVxuXG4iXSwibmFtZXMiOlsiY2xlYW51cEV4cGlyZWRTZXNzaW9ucyIsImNsZWFudXBPbGRBdWRpdExvZ3MiLCJjbGVhbnVwT2xkQ3JvbkxvZ3MiLCJjbGVhbnVwT2xkRW1haWxMb2dzIiwiY2xlYW51cE9sZFdlYmhvb2tMb2dzIiwiY2xlYW51cFRlbXBGaWxlcyIsInJ1bkFsbENsZWFudXBUYXNrcyIsInN1cGFiYXNlIiwiY3JlYXRlQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJtYXhBZ2VIb3VycyIsInRlbXBEaXIiLCJwYXRoIiwiam9pbiIsImN3ZCIsIm1heEFnZU1zIiwibm93IiwiRGF0ZSIsImZpbGVzRGVsZXRlZCIsImJ5dGVzRnJlZWQiLCJmcyIsImFjY2VzcyIsInN1Y2Nlc3MiLCJkYXRhIiwiZmlsZXMiLCJyZWFkZGlyIiwiZmlsZSIsImZpbGVQYXRoIiwic3RhdHMiLCJzdGF0IiwiZmlsZUFnZSIsIm10aW1lTXMiLCJ1bmxpbmsiLCJzaXplIiwiZXJyb3IiLCJjb25zb2xlIiwiY29kZSIsIkVSUk9SX0NPREVTIiwiVU5LTk9XTl9FUlJPUiIsIm1lc3NhZ2UiLCJFcnJvciIsInNlc3Npb25zRGVsZXRlZCIsInJldGVudGlvbkRheXMiLCJjdXRvZmZEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJmcm9tIiwiZGVsZXRlIiwibHQiLCJ0b0lTT1N0cmluZyIsInNlbGVjdCIsIkRBVEFCQVNFX0VSUk9SIiwiZGV0YWlscyIsImxvZ3NEZWxldGVkIiwibGVuZ3RoIiwiZXhlY3V0ZUNyb25Kb2IiLCJyZXN1bHRzIiwidGVtcEZpbGVzIiwiZXhwaXJlZFNlc3Npb25zIiwiYXVkaXRMb2dzIiwiY3JvbkxvZ3MiLCJlbWFpbExvZ3MiLCJ3ZWJob29rTG9ncyIsInRvdGFsUHJvY2Vzc2VkIiwidG90YWxGYWlsZWQiLCJ0ZW1wRmlsZXNSZXN1bHQiLCJzZXNzaW9uc1Jlc3VsdCIsImF1ZGl0TG9nc1Jlc3VsdCIsImNyb25Mb2dzUmVzdWx0IiwiZW1haWxMb2dzUmVzdWx0Iiwid2ViaG9va0xvZ3NSZXN1bHQiLCJpdGVtc1Byb2Nlc3NlZCIsIml0ZW1zRmFpbGVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztRQW1Gc0JBO2VBQUFBOztRQWtDQUM7ZUFBQUE7O1FBNENBQztlQUFBQTs7UUE0Q0FDO2VBQUFBOztRQTRDQUM7ZUFBQUE7O1FBcE9BQztlQUFBQTs7UUFvUkFDO2VBQUFBOzs7NEJBelNPO29CQUNFOzZEQUNkO3VCQUVXOzZCQUN1Qjs7Ozs7O0FBRW5ELHFEQUFxRDtBQUNyRCxNQUFNQyxXQUFXQyxJQUFBQSx3QkFBWSxFQUMzQkMsUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0IsRUFDcENGLFFBQVFDLEdBQUcsQ0FBQ0UseUJBQXlCO0FBV2hDLGVBQWVQLGlCQUNwQlEsY0FBc0IsRUFBRTtJQUV4QixJQUFJO1FBQ0YsTUFBTUMsVUFBVUMsYUFBSSxDQUFDQyxJQUFJLENBQUNQLFFBQVFRLEdBQUcsSUFBSTtRQUN6QyxNQUFNQyxXQUFXTCxjQUFjLEtBQUssS0FBSztRQUN6QyxNQUFNTSxNQUFNQyxLQUFLRCxHQUFHO1FBRXBCLElBQUlFLGVBQWU7UUFDbkIsSUFB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