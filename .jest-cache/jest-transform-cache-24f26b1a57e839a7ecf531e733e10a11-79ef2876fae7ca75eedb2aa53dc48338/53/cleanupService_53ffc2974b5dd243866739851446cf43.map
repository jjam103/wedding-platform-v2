{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/cleanupService.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport type { Result } from '@/types';\nimport { ERROR_CODES } from '@/types';\nimport { executeCronJob, type CronJobResult } from './cronService';\n\n// Initialize Supabase client for database operations\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\n/**\n * Cleans up temporary files older than the specified age.\n * \n * @param maxAgeHours - Maximum age of files to keep in hours (default: 24)\n * @returns Result containing cleanup statistics\n * \n * Requirements: 22.5, 22.7, 19.4\n */\nexport async function cleanupTempFiles(\n  maxAgeHours: number = 24\n): Promise<Result<{ filesDeleted: number; bytesFreed: number }>> {\n  try {\n    const tempDir = path.join(process.cwd(), 'tmp');\n    const maxAgeMs = maxAgeHours * 60 * 60 * 1000;\n    const now = Date.now();\n\n    let filesDeleted = 0;\n    let bytesFreed = 0;\n\n    // Check if temp directory exists\n    try {\n      await fs.access(tempDir);\n    } catch {\n      // Directory doesn't exist, nothing to clean\n      return { success: true, data: { filesDeleted: 0, bytesFreed: 0 } };\n    }\n\n    // Read all files in temp directory\n    const files = await fs.readdir(tempDir);\n\n    for (const file of files) {\n      const filePath = path.join(tempDir, file);\n\n      try {\n        const stats = await fs.stat(filePath);\n\n        // Check if file is older than max age\n        const fileAge = now - stats.mtimeMs;\n\n        if (fileAge > maxAgeMs) {\n          // Delete the file\n          await fs.unlink(filePath);\n          filesDeleted++;\n          bytesFreed += stats.size;\n        }\n      } catch (error) {\n        // Skip files that can't be accessed or deleted\n        console.error(`Failed to process file ${filePath}:`, error);\n      }\n    }\n\n    return { success: true, data: { filesDeleted, bytesFreed } };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Cleans up expired sessions from the database.\n * \n * @returns Result containing cleanup statistics\n * \n * Requirements: 22.5, 22.8, 19.4\n */\nexport async function cleanupExpiredSessions(): Promise<\n  Result<{ sessionsDeleted: number }>\n> {\n  try {\n    // Note: Supabase Auth handles session cleanup automatically\n    // This function is a placeholder for any custom session cleanup logic\n\n    // Clean up any custom session-related data if needed\n    // For example, cleaning up old session logs or temporary session data\n\n    // Get expired sessions from auth.sessions (if accessible)\n    // Since we're using Supabase Auth, expired sessions are handled automatically\n    // We can clean up related data like old audit logs or temporary data\n\n    return { success: true, data: { sessionsDeleted: 0 } };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Cleans up old audit logs to prevent database bloat.\n * \n * @param retentionDays - Number of days to retain audit logs (default: 90)\n * @returns Result containing cleanup statistics\n * \n * Requirements: 22.5, 19.4\n */\nexport async function cleanupOldAuditLogs(\n  retentionDays: number = 90\n): Promise<Result<{ logsDeleted: number }>> {\n  try {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n\n    const { data, error } = await supabase\n      .from('audit_logs')\n      .delete()\n      .lt('created_at', cutoffDate.toISOString())\n      .select('id');\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: 'Failed to delete old audit logs',\n          details: error,\n        },\n      };\n    }\n\n    return { success: true, data: { logsDeleted: data?.length || 0 } };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Cleans up old cron job logs to prevent database bloat.\n * \n * @param retentionDays - Number of days to retain cron job logs (default: 30)\n * @returns Result containing cleanup statistics\n * \n * Requirements: 22.5, 22.6, 19.4\n */\nexport async function cleanupOldCronLogs(\n  retentionDays: number = 30\n): Promise<Result<{ logsDeleted: number }>> {\n  try {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n\n    const { data, error } = await supabase\n      .from('cron_job_logs')\n      .delete()\n      .lt('started_at', cutoffDate.toISOString())\n      .select('id');\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: 'Failed to delete old cron job logs',\n          details: error,\n        },\n      };\n    }\n\n    return { success: true, data: { logsDeleted: data?.length || 0 } };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Cleans up old email logs to prevent database bloat.\n * \n * @param retentionDays - Number of days to retain email logs (default: 180)\n * @returns Result containing cleanup statistics\n * \n * Requirements: 22.5, 19.4\n */\nexport async function cleanupOldEmailLogs(\n  retentionDays: number = 180\n): Promise<Result<{ logsDeleted: number }>> {\n  try {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n\n    const { data, error } = await supabase\n      .from('email_logs')\n      .delete()\n      .lt('created_at', cutoffDate.toISOString())\n      .select('id');\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: 'Failed to delete old email logs',\n          details: error,\n        },\n      };\n    }\n\n    return { success: true, data: { logsDeleted: data?.length || 0 } };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Cleans up old webhook delivery logs to prevent database bloat.\n * \n * @param retentionDays - Number of days to retain webhook logs (default: 30)\n * @returns Result containing cleanup statistics\n * \n * Requirements: 22.5, 19.4\n */\nexport async function cleanupOldWebhookLogs(\n  retentionDays: number = 30\n): Promise<Result<{ logsDeleted: number }>> {\n  try {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n\n    const { data, error } = await supabase\n      .from('webhook_delivery_logs')\n      .delete()\n      .lt('created_at', cutoffDate.toISOString())\n      .select('id');\n\n    if (error) {\n      return {\n        success: false,\n        error: {\n          code: ERROR_CODES.DATABASE_ERROR,\n          message: 'Failed to delete old webhook logs',\n          details: error,\n        },\n      };\n    }\n\n    return { success: true, data: { logsDeleted: data?.length || 0 } };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: ERROR_CODES.UNKNOWN_ERROR,\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Runs all cleanup tasks.\n * This function should be called by a scheduled cron job.\n * \n * @returns Result containing combined cleanup statistics\n * \n * Requirements: 22.5, 22.7, 22.8, 19.4\n * \n * @example\n * // Run daily to clean up old data\n * await runAllCleanupTasks();\n */\nexport async function runAllCleanupTasks(): Promise<Result<CronJobResult>> {\n  return executeCronJob('temp_file_cleanup', async () => {\n    const results = {\n      tempFiles: { filesDeleted: 0, bytesFreed: 0 },\n      expiredSessions: { sessionsDeleted: 0 },\n      auditLogs: { logsDeleted: 0 },\n      cronLogs: { logsDeleted: 0 },\n      emailLogs: { logsDeleted: 0 },\n      webhookLogs: { logsDeleted: 0 },\n    };\n\n    let totalProcessed = 0;\n    let totalFailed = 0;\n\n    // Clean up temp files\n    const tempFilesResult = await cleanupTempFiles(24);\n    if (tempFilesResult.success) {\n      results.tempFiles = tempFilesResult.data;\n      totalProcessed += tempFilesResult.data.filesDeleted;\n    } else {\n      totalFailed++;\n      console.error('Failed to clean up temp files:', tempFilesResult.error);\n    }\n\n    // Clean up expired sessions\n    const sessionsResult = await cleanupExpiredSessions();\n    if (sessionsResult.success) {\n      results.expiredSessions = sessionsResult.data;\n      totalProcessed += sessionsResult.data.sessionsDeleted;\n    } else {\n      totalFailed++;\n      console.error('Failed to clean up expired sessions:', sessionsResult.error);\n    }\n\n    // Clean up old audit logs (90 days)\n    const auditLogsResult = await cleanupOldAuditLogs(90);\n    if (auditLogsResult.success) {\n      results.auditLogs = auditLogsResult.data;\n      totalProcessed += auditLogsResult.data.logsDeleted;\n    } else {\n      totalFailed++;\n      console.error('Failed to clean up audit logs:', auditLogsResult.error);\n    }\n\n    // Clean up old cron logs (30 days)\n    const cronLogsResult = await cleanupOldCronLogs(30);\n    if (cronLogsResult.success) {\n      results.cronLogs = cronLogsResult.data;\n      totalProcessed += cronLogsResult.data.logsDeleted;\n    } else {\n      totalFailed++;\n      console.error('Failed to clean up cron logs:', cronLogsResult.error);\n    }\n\n    // Clean up old email logs (180 days)\n    const emailLogsResult = await cleanupOldEmailLogs(180);\n    if (emailLogsResult.success) {\n      results.emailLogs = emailLogsResult.data;\n      totalProcessed += emailLogsResult.data.logsDeleted;\n    } else {\n      totalFailed++;\n      console.error('Failed to clean up email logs:', emailLogsResult.error);\n    }\n\n    // Clean up old webhook logs (30 days)\n    const webhookLogsResult = await cleanupOldWebhookLogs(30);\n    if (webhookLogsResult.success) {\n      results.webhookLogs = webhookLogsResult.data;\n      totalProcessed += webhookLogsResult.data.logsDeleted;\n    } else {\n      totalFailed++;\n      console.error('Failed to clean up webhook logs:', webhookLogsResult.error);\n    }\n\n    return {\n      itemsProcessed: totalProcessed,\n      itemsFailed: totalFailed,\n    };\n  });\n}\n\n"],"names":["cleanupExpiredSessions","cleanupOldAuditLogs","cleanupOldCronLogs","cleanupOldEmailLogs","cleanupOldWebhookLogs","cleanupTempFiles","runAllCleanupTasks","supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","maxAgeHours","tempDir","path","join","cwd","maxAgeMs","now","Date","filesDeleted","bytesFreed","fs","access","success","data","files","readdir","file","filePath","stats","stat","fileAge","mtimeMs","unlink","size","error","console","code","ERROR_CODES","UNKNOWN_ERROR","message","Error","sessionsDeleted","retentionDays","cutoffDate","setDate","getDate","from","delete","lt","toISOString","select","DATABASE_ERROR","details","logsDeleted","length","executeCronJob","results","tempFiles","expiredSessions","auditLogs","cronLogs","emailLogs","webhookLogs","totalProcessed","totalFailed","tempFilesResult","sessionsResult","auditLogsResult","cronLogsResult","emailLogsResult","webhookLogsResult","itemsProcessed","itemsFailed"],"mappings":"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"}