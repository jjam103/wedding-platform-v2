{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/activityCapacityAlert.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\n\n/**\n * Property 10: Activity Capacity Alert Threshold\n * \n * Validates: Requirements 7.8\n * \n * Property: For any activity with capacity and current RSVPs,\n * IF utilization >= 100%,\n * THEN the system SHALL display an at-capacity alert indicator.\n * \n * This property ensures that activities at full capacity\n * trigger appropriate alerts to prevent overbooking.\n */\n\ndescribe('Feature: admin-backend-integration-cms, Property 10: Activity Capacity Alert Threshold', () => {\n  /**\n   * Calculate utilization percentage\n   */\n  function calculateUtilization(currentRsvps: number, capacity: number): number {\n    if (capacity === 0) return 0;\n    return (currentRsvps / capacity) * 100;\n  }\n\n  /**\n   * Determine if alert should be displayed\n   */\n  function shouldDisplayAlert(currentRsvps: number, capacity: number): boolean {\n    const utilization = calculateUtilization(currentRsvps, capacity);\n    return utilization >= 100;\n  }\n\n  it('should display alert for activities at exactly 100% capacity', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 1 and 1000\n        fc.integer({ min: 1, max: 1000 }),\n        (capacity) => {\n          const currentRsvps = capacity; // Exactly at capacity\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const alert = shouldDisplayAlert(currentRsvps, capacity);\n          \n          // Property: At exactly 100%, alert should be true\n          expect(utilization).toBe(100);\n          expect(alert).toBe(true);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should display alert for activities over 100% capacity (overbooking)', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 1 and 1000\n        fc.integer({ min: 1, max: 1000 }),\n        (capacity) => {\n          // Generate RSVPs that exceed capacity\n          fc.assert(\n            fc.property(\n              fc.integer({ min: 1, max: 100 }),\n              (excess) => {\n                const currentRsvps = capacity + excess;\n                const utilization = calculateUtilization(currentRsvps, capacity);\n                const alert = shouldDisplayAlert(currentRsvps, capacity);\n                \n                // Property: Over 100%, alert should be true\n                expect(utilization).toBeGreaterThan(100);\n                expect(alert).toBe(true);\n              }\n            ),\n            { numRuns: 50 }\n          );\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should NOT display alert for activities below 100% capacity', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 10 and 1000\n        fc.integer({ min: 10, max: 1000 }),\n        (capacity) => {\n          // Generate current RSVPs that result in <100% utilization\n          const maxRsvps = capacity - 1;\n          \n          fc.assert(\n            fc.property(\n              fc.integer({ min: 0, max: maxRsvps }),\n              (currentRsvps) => {\n                const utilization = calculateUtilization(currentRsvps, capacity);\n                const alert = shouldDisplayAlert(currentRsvps, capacity);\n                \n                // Property: Below 100%, alert should be false\n                expect(utilization).toBeLessThan(100);\n                expect(alert).toBe(false);\n              }\n            ),\n            { numRuns: 50 }\n          );\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should handle edge case: 99% capacity (just below threshold)', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 100 and 1000\n        fc.integer({ min: 100, max: 1000 }),\n        (capacity) => {\n          const currentRsvps = Math.floor(capacity * 0.99);\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const alert = shouldDisplayAlert(currentRsvps, capacity);\n          \n          // Property: At 99%, alert should be false\n          expect(utilization).toBeLessThan(100);\n          expect(alert).toBe(false);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle edge case: 101% capacity (just over threshold)', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 100 and 1000\n        fc.integer({ min: 100, max: 1000 }),\n        (capacity) => {\n          const currentRsvps = Math.ceil(capacity * 1.01);\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const alert = shouldDisplayAlert(currentRsvps, capacity);\n          \n          // Property: At 101%, alert should be true\n          expect(utilization).toBeGreaterThan(100);\n          expect(alert).toBe(true);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle zero capacity (unlimited)', () => {\n    fc.assert(\n      fc.property(\n        fc.integer({ min: 0, max: 1000 }),\n        (currentRsvps) => {\n          const capacity = 0; // Unlimited capacity\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const alert = shouldDisplayAlert(currentRsvps, capacity);\n          \n          // Property: With unlimited capacity, no alert should be shown\n          expect(utilization).toBe(0);\n          expect(alert).toBe(false);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain alert threshold consistency across all valid inputs', () => {\n    fc.assert(\n      fc.property(\n        fc.integer({ min: 1, max: 1000 }), // capacity\n        fc.integer({ min: 0, max: 1500 }), // currentRsvps (can exceed capacity)\n        (capacity, currentRsvps) => {\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const alert = shouldDisplayAlert(currentRsvps, capacity);\n          \n          // Property: Alert state must be consistent with utilization calculation\n          if (utilization >= 100) {\n            expect(alert).toBe(true);\n          } else {\n            expect(alert).toBe(false);\n          }\n        }\n      ),\n      { numRuns: 200 }\n    );\n  });\n\n  it('should distinguish between warning (90-99%) and alert (100%+)', () => {\n    fc.assert(\n      fc.property(\n        fc.integer({ min: 10, max: 1000 }),\n        (capacity) => {\n          // Test warning range (90-99%)\n          const warningRsvps = Math.floor(capacity * 0.95);\n          const warningUtilization = calculateUtilization(warningRsvps, capacity);\n          const warningAlert = shouldDisplayAlert(warningRsvps, capacity);\n          \n          // Test alert range (100%+)\n          const alertRsvps = capacity;\n          const alertUtilization = calculateUtilization(alertRsvps, capacity);\n          const alertAlert = shouldDisplayAlert(alertRsvps, capacity);\n          \n          // Property: Warning range should not trigger alert\n          if (warningUtilization >= 90 && warningUtilization < 100) {\n            expect(warningAlert).toBe(false);\n          }\n          \n          // Property: Alert range should trigger alert\n          if (alertUtilization >= 100) {\n            expect(alertAlert).toBe(true);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle capacity of 1 (minimum valid capacity)', () => {\n    const capacity = 1;\n    \n    // 0 RSVPs - no alert\n    expect(shouldDisplayAlert(0, capacity)).toBe(false);\n    expect(calculateUtilization(0, capacity)).toBe(0);\n    \n    // 1 RSVP - alert\n    expect(shouldDisplayAlert(1, capacity)).toBe(true);\n    expect(calculateUtilization(1, capacity)).toBe(100);\n    \n    // 2 RSVPs - alert (overbooking)\n    expect(shouldDisplayAlert(2, capacity)).toBe(true);\n    expect(calculateUtilization(2, capacity)).toBe(200);\n  });\n\n  it('should handle large capacity values', () => {\n    fc.assert(\n      fc.property(\n        fc.integer({ min: 10000, max: 100000 }),\n        (capacity) => {\n          // At capacity\n          const atCapacity = shouldDisplayAlert(capacity, capacity);\n          expect(atCapacity).toBe(true);\n          \n          // Below capacity\n          const belowCapacity = shouldDisplayAlert(capacity - 1, capacity);\n          expect(belowCapacity).toBe(false);\n          \n          // Over capacity\n          const overCapacity = shouldDisplayAlert(capacity + 1, capacity);\n          expect(overCapacity).toBe(true);\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n});\n"],"names":["describe","calculateUtilization","currentRsvps","capacity","shouldDisplayAlert","utilization","it","fc","assert","property","integer","min","max","alert","expect","toBe","numRuns","excess","toBeGreaterThan","maxRsvps","toBeLessThan","Math","floor","ceil","warningRsvps","warningUtilization","warningAlert","alertRsvps","alertUtilization","alertAlert","atCapacity","belowCapacity","overCapacity"],"mappings":"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"}