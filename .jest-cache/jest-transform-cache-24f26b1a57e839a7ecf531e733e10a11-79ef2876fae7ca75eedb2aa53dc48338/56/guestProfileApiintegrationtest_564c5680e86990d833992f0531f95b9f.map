{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/guestProfileApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: Guest Profile API\n * \n * Tests all guest profile API routes with proper service mocking\n * to avoid worker crashes.\n * \n * Requirements: 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.12\n */\n\nimport { GET as getProfile, PUT as updateProfile } from '@/app/api/guest/profile/route';\nimport { GET as getFamilyMembers } from '@/app/api/guest/family/route';\n\n// Mock services at module level to avoid worker crashes\njest.mock('@/services/emailService', () => ({\n  sendEmail: jest.fn(),\n}));\n\njest.mock('@supabase/auth-helpers-nextjs', () => ({\n  createRouteHandlerClient: jest.fn(),\n}));\n\njest.mock('next/headers', () => ({\n  cookies: jest.fn(),\n}));\n\ndescribe('Guest Profile API Integration Tests', () => {\n  let mockSupabase: any;\n  \n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Setup mock Supabase client\n    mockSupabase = {\n      auth: {\n        getSession: jest.fn(),\n      },\n      from: jest.fn().mockReturnThis(),\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn(),\n      update: jest.fn().mockReturnThis(),\n      order: jest.fn().mockReturnThis(),\n    };\n    \n    const { createRouteHandlerClient } = require('@supabase/auth-helpers-nextjs');\n    createRouteHandlerClient.mockReturnValue(mockSupabase);\n  });\n  \n  describe('GET /api/guest/profile', () => {\n    it('should return guest profile when authenticated', async () => {\n      // Mock authenticated session\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      // Mock guest profile data\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          first_name: 'John',\n          last_name: 'Doe',\n          email: 'john@example.com',\n          phone: '555-0100',\n          dietary_restrictions: 'Vegetarian',\n          group_id: 'group-1',\n          groups: {\n            id: 'group-1',\n            name: 'Smith Family',\n            group_type: 'family'\n          }\n        },\n        error: null\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'GET',\n      });\n      \n      const response = await getProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.id).toBe('guest-1');\n      expect(data.data.first_name).toBe('John');\n      expect(data.data.groups.name).toBe('Smith Family');\n    });\n    \n    it('should return 401 when not authenticated', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: { message: 'No session' }\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'GET',\n      });\n      \n      const response = await getProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n    \n    it('should return 404 when guest profile not found', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'unknown@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single.mockResolvedValue({\n        data: null,\n        error: { message: 'Not found' }\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'GET',\n      });\n      \n      const response = await getProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n  });\n  \n  describe('PUT /api/guest/profile', () => {\n    it('should update profile when authenticated with valid data', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      // Mock getting current guest\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: {\n            id: 'guest-1',\n            first_name: 'John',\n            last_name: 'Doe',\n            email: 'john@example.com',\n            group_id: 'group-1'\n          },\n          error: null\n        })\n        // Mock updated guest\n        .mockResolvedValueOnce({\n          data: {\n            id: 'guest-1',\n            first_name: 'John',\n            last_name: 'Smith',\n            email: 'john@example.com',\n            phone: '555-0200',\n            dietary_restrictions: 'Vegan',\n            group_id: 'group-1'\n          },\n          error: null\n        });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          last_name: 'Smith',\n          phone: '555-0200',\n          dietary_restrictions: 'Vegan'\n        })\n      });\n      \n      const response = await updateProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.last_name).toBe('Smith');\n      expect(data.data.phone).toBe('555-0200');\n      expect(data.data.dietary_restrictions).toBe('Vegan');\n    });\n    \n    it('should return 401 when not authenticated', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: { message: 'No session' }\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ first_name: 'Jane' })\n      });\n      \n      const response = await updateProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n    \n    it('should return 400 when validation fails', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          first_name: 'John',\n          email: 'john@example.com'\n        },\n        error: null\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          email: 'invalid-email',\n          first_name: 'A'.repeat(100) // Too long\n        })\n      });\n      \n      const response = await updateProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(data.error.details).toBeDefined();\n    });\n    \n    it('should send admin notification for critical updates', async () => {\n      const mockSendEmail = require('@/services/emailService').sendEmail;\n      \n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: {\n            id: 'guest-1',\n            first_name: 'John',\n            last_name: 'Doe',\n            email: 'john@example.com'\n          },\n          error: null\n        })\n        .mockResolvedValueOnce({\n          data: {\n            id: 'guest-1',\n            first_name: 'John',\n            last_name: 'Doe',\n            email: 'newemail@example.com',\n            dietary_restrictions: 'Gluten-free'\n          },\n          error: null\n        });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          email: 'newemail@example.com',\n          dietary_restrictions: 'Gluten-free'\n        })\n      });\n      \n      const response = await updateProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(mockSendEmail).toHaveBeenCalledWith(\n        expect.objectContaining({\n          subject: 'Guest Profile Update',\n          html: expect.stringContaining('Guest Profile Updated')\n        })\n      );\n    });\n    \n    it('should sanitize input to prevent XSS', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: {\n            id: 'guest-1',\n            first_name: 'John',\n            email: 'john@example.com'\n          },\n          error: null\n        })\n        .mockResolvedValueOnce({\n          data: {\n            id: 'guest-1',\n            first_name: 'John',\n            last_name: 'Doe',\n            dietary_restrictions: 'No shellfish'\n          },\n          error: null\n        });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          dietary_restrictions: '<script>alert(\"xss\")</script>No shellfish'\n        })\n      });\n      \n      const response = await updateProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      \n      // Verify update was called with sanitized data\n      expect(mockSupabase.update).toHaveBeenCalledWith(\n        expect.objectContaining({\n          dietary_restrictions: expect.not.stringContaining('<script>')\n        })\n      );\n    });\n    \n    it('should return 404 when guest profile not found', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'unknown@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single.mockResolvedValue({\n        data: null,\n        error: { message: 'Not found' }\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/profile', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ first_name: 'Jane' })\n      });\n      \n      const response = await updateProfile(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n  });\n  \n  describe('GET /api/guest/family', () => {\n    it('should return all family members for adult guest', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      // Mock current guest (adult)\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          group_id: 'group-1',\n          age_type: 'adult',\n          email: 'john@example.com'\n        },\n        error: null\n      });\n      \n      // Mock family members - need to chain order() twice\n      mockSupabase.order\n        .mockReturnValueOnce(mockSupabase) // First order() returns this\n        .mockResolvedValueOnce({ // Second order() returns data\n          data: [\n            {\n              id: 'guest-1',\n              first_name: 'John',\n              last_name: 'Doe',\n              age_type: 'adult',\n              group_id: 'group-1'\n            },\n            {\n              id: 'guest-2',\n              first_name: 'Jane',\n              last_name: 'Doe',\n              age_type: 'adult',\n              group_id: 'group-1'\n            },\n            {\n              id: 'guest-3',\n              first_name: 'Jimmy',\n              last_name: 'Doe',\n              age_type: 'child',\n              group_id: 'group-1'\n            }\n          ],\n          error: null\n        });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      const response = await getFamilyMembers(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toHaveLength(3);\n      expect(data.data[0].first_name).toBe('John');\n      expect(data.data[2].age_type).toBe('child');\n    });\n    \n    it('should return only self for child guest', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-3', email: 'jimmy@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      // Mock current guest (child)\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-3',\n          first_name: 'Jimmy',\n          last_name: 'Doe',\n          group_id: 'group-1',\n          age_type: 'child',\n          email: 'jimmy@example.com'\n        },\n        error: null\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      const response = await getFamilyMembers(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toHaveLength(1);\n      expect(data.data[0].id).toBe('guest-3');\n      expect(data.data[0].first_name).toBe('Jimmy');\n    });\n    \n    it('should return 401 when not authenticated', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: { message: 'No session' }\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      const response = await getFamilyMembers(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n    \n    it('should return 404 when guest profile not found', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'unknown@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single.mockResolvedValue({\n        data: null,\n        error: { message: 'Not found' }\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      const response = await getFamilyMembers(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n    \n    it('should enforce RLS by querying based on group_id', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          group_id: 'group-1',\n          age_type: 'adult',\n          email: 'john@example.com'\n        },\n        error: null\n      });\n      \n      mockSupabase.order.mockResolvedValue({\n        data: [],\n        error: null\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      await getFamilyMembers(request);\n      \n      // Verify that query filters by group_id\n      expect(mockSupabase.eq).toHaveBeenCalledWith('group_id', 'group-1');\n    });\n  });\n  \n  describe('RLS Enforcement', () => {\n    it('should prevent access to other groups data', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      // Guest belongs to group-1\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          group_id: 'group-1',\n          age_type: 'adult',\n          email: 'john@example.com'\n        },\n        error: null\n      });\n      \n      // Should only return members from group-1 - chain order() twice\n      mockSupabase.order\n        .mockReturnValueOnce(mockSupabase)\n        .mockResolvedValueOnce({\n          data: [\n            { id: 'guest-1', group_id: 'group-1', first_name: 'John' }\n          ],\n          error: null\n        });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      const response = await getFamilyMembers(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.data.every((member: any) => member.group_id === 'group-1')).toBe(true);\n    });\n  });\n  \n  describe('Group Owner Permissions', () => {\n    it('should allow adult to view all family members', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-1', email: 'john@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          group_id: 'group-1',\n          age_type: 'adult',\n          email: 'john@example.com'\n        },\n        error: null\n      });\n      \n      // Chain order() twice for the query\n      mockSupabase.order\n        .mockReturnValueOnce(mockSupabase)\n        .mockResolvedValueOnce({\n          data: [\n            { id: 'guest-1', age_type: 'adult' },\n            { id: 'guest-2', age_type: 'adult' },\n            { id: 'guest-3', age_type: 'child' }\n          ],\n          error: null\n        });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      const response = await getFamilyMembers(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.data).toHaveLength(3);\n    });\n    \n    it('should restrict child to viewing only themselves', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: {\n          session: {\n            user: { id: 'user-3', email: 'child@example.com' }\n          }\n        },\n        error: null\n      });\n      \n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-3',\n          group_id: 'group-1',\n          age_type: 'child',\n          email: 'child@example.com'\n        },\n        error: null\n      });\n      \n      const request = new Request('http://localhost:3000/api/guest/family', {\n        method: 'GET',\n      });\n      \n      const response = await getFamilyMembers(request);\n      const data = await response.json();\n      \n      expect(response.status).toBe(200);\n      expect(data.data).toHaveLength(1);\n      expect(data.data[0].id).toBe('guest-3');\n    });\n  });\n});\n"],"names":["jest","mock","sendEmail","fn","createRouteHandlerClient","cookies","describe","mockSupabase","beforeEach","clearAllMocks","auth","getSession","from","mockReturnThis","select","eq","single","update","order","require","mockReturnValue","it","mockResolvedValue","data","session","user","id","email","error","first_name","last_name","phone","dietary_restrictions","group_id","groups","name","group_type","request","Request","method","response","getProfile","json","expect","status","toBe","success","message","code","mockResolvedValueOnce","headers","body","JSON","stringify","updateProfile","repeat","details","toBeDefined","mockSendEmail","toHaveBeenCalledWith","objectContaining","subject","html","stringContaining","not","age_type","mockReturnValueOnce","getFamilyMembers","toHaveLength","every","member"],"mappings":"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"}