768ee69b6774ef06659572084bd5a8fc
/**
 * Vendor Service
 * 
 * Handles vendor management including CRUD operations, pricing models,
 * and payment tracking for wedding service providers.
 * 
 * Requirements: 7.1, 7.3, 7.6, 8.1, 8.3
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get create () {
        return create;
    },
    get deleteVendor () {
        return deleteVendor;
    },
    get get () {
        return get;
    },
    get getPaymentInfo () {
        return getPaymentInfo;
    },
    get list () {
        return list;
    },
    get recordPayment () {
        return recordPayment;
    },
    get search () {
        return search;
    },
    get update () {
        return update;
    }
});
const _supabasejs = require("@supabase/supabase-js");
const _vendorSchemas = require("../schemas/vendorSchemas");
const _sanitization = require("../utils/sanitization");
// Initialize Supabase client
const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);
async function create(data) {
    try {
        // 1. Validate
        const validation = _vendorSchemas.createVendorSchema.safeParse(data);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        // 2. Sanitize user input
        const sanitized = {
            ...validation.data,
            name: (0, _sanitization.sanitizeInput)(validation.data.name),
            contactName: validation.data.contactName ? (0, _sanitization.sanitizeInput)(validation.data.contactName) : null,
            notes: validation.data.notes ? (0, _sanitization.sanitizeInput)(validation.data.notes) : null
        };
        // 3. Database operation
        const { data: vendor, error } = await supabase.from('vendors').insert({
            name: sanitized.name,
            category: sanitized.category,
            contact_name: sanitized.contactName,
            email: sanitized.email,
            phone: sanitized.phone,
            pricing_model: sanitized.pricingModel,
            base_cost: sanitized.baseCost,
            payment_status: sanitized.paymentStatus || 'unpaid',
            amount_paid: sanitized.amountPaid || 0,
            notes: sanitized.notes
        }).select().single();
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: mapVendorFromDb(vendor)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function get(id) {
    try {
        const { data: vendor, error } = await supabase.from('vendors').select('*').eq('id', id).single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Vendor not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: mapVendorFromDb(vendor)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function update(id, data) {
    try {
        // 1. Validate
        const validation = _vendorSchemas.updateVendorSchema.safeParse(data);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        // 2. Sanitize user input
        const sanitized = {};
        if (validation.data.name !== undefined) {
            sanitized.name = (0, _sanitization.sanitizeInput)(validation.data.name);
        }
        if (validation.data.contactName !== undefined) {
            sanitized.contact_name = validation.data.contactName ? (0, _sanitization.sanitizeInput)(validation.data.contactName) : null;
        }
        if (validation.data.notes !== undefined) {
            sanitized.notes = validation.data.notes ? (0, _sanitization.sanitizeInput)(validation.data.notes) : null;
        }
        if (validation.data.category !== undefined) {
            sanitized.category = validation.data.category;
        }
        if (validation.data.email !== undefined) {
            sanitized.email = validation.data.email;
        }
        if (validation.data.phone !== undefined) {
            sanitized.phone = validation.data.phone;
        }
        if (validation.data.pricingModel !== undefined) {
            sanitized.pricing_model = validation.data.pricingModel;
        }
        if (validation.data.baseCost !== undefined) {
            sanitized.base_cost = validation.data.baseCost;
        }
        if (validation.data.paymentStatus !== undefined) {
            sanitized.payment_status = validation.data.paymentStatus;
        }
        if (validation.data.amountPaid !== undefined) {
            sanitized.amount_paid = validation.data.amountPaid;
        }
        // 3. Database operation
        const { data: vendor, error } = await supabase.from('vendors').update(sanitized).eq('id', id).select().single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: 'Vendor not found'
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: mapVendorFromDb(vendor)
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function deleteVendor(id) {
    try {
        const { error } = await supabase.from('vendors').delete().eq('id', id);
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: undefined
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function list(filters = {}) {
    try {
        // Validate filters
        const validation = _vendorSchemas.vendorFilterSchema.safeParse(filters);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid filters',
                    details: validation.error.issues
                }
            };
        }
        const { category, pricingModel, paymentStatus, page = 1, pageSize = 50 } = validation.data;
        // Build query
        let query = supabase.from('vendors').select('*', {
            count: 'exact'
        });
        if (category) {
            query = query.eq('category', category);
        }
        if (pricingModel) {
            query = query.eq('pricing_model', pricingModel);
        }
        if (paymentStatus) {
            query = query.eq('payment_status', paymentStatus);
        }
        // Apply pagination
        const from = (page - 1) * pageSize;
        const to = from + pageSize - 1;
        query = query.range(from, to).order('name', {
            ascending: true
        });
        const { data: vendors, error, count } = await query;
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        const total = count || 0;
        const totalPages = Math.ceil(total / pageSize);
        return {
            success: true,
            data: {
                vendors: vendors.map(mapVendorFromDb),
                total,
                page,
                pageSize,
                totalPages
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function search(searchParams) {
    try {
        // Validate search parameters
        const validation = _vendorSchemas.vendorSearchSchema.safeParse(searchParams);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid search parameters',
                    details: validation.error.issues
                }
            };
        }
        const { query, page = 1, pageSize = 50 } = validation.data;
        // Search in name and contact_name fields
        const { data: vendors, error, count } = await supabase.from('vendors').select('*', {
            count: 'exact'
        }).or(`name.ilike.%${query}%,contact_name.ilike.%${query}%`).range((page - 1) * pageSize, page * pageSize - 1).order('name', {
            ascending: true
        });
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        const total = count || 0;
        const totalPages = Math.ceil(total / pageSize);
        return {
            success: true,
            data: {
                vendors: vendors.map(mapVendorFromDb),
                total,
                page,
                pageSize,
                totalPages
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function recordPayment(paymentData) {
    try {
        // 1. Validate
        const validation = _vendorSchemas.recordPaymentSchema.safeParse(paymentData);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Validation failed',
                    details: validation.error.issues
                }
            };
        }
        const { vendorId, amount } = validation.data;
        // 2. Get current vendor
        const vendorResult = await get(vendorId);
        if (!vendorResult.success) {
            return vendorResult;
        }
        const vendor = vendorResult.data;
        const newAmountPaid = vendor.amountPaid + amount;
        // Check if payment exceeds base cost (with floating point tolerance)
        if (newAmountPaid - vendor.baseCost > 0.01) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Payment amount exceeds vendor base cost',
                    details: {
                        baseCost: vendor.baseCost,
                        currentPaid: vendor.amountPaid,
                        attemptedPayment: amount,
                        wouldTotal: newAmountPaid
                    }
                }
            };
        }
        // 3. Calculate new payment status
        let newPaymentStatus;
        if (newAmountPaid === 0) {
            newPaymentStatus = 'unpaid';
        } else if (newAmountPaid >= vendor.baseCost) {
            newPaymentStatus = 'paid';
        } else {
            newPaymentStatus = 'partial';
        }
        // 4. Update vendor
        const updateResult = await update(vendorId, {
            amountPaid: newAmountPaid,
            paymentStatus: newPaymentStatus
        });
        if (!updateResult.success) {
            return updateResult;
        }
        const updatedVendor = updateResult.data;
        return {
            success: true,
            data: {
                vendorId: updatedVendor.id,
                vendorName: updatedVendor.name,
                baseCost: updatedVendor.baseCost,
                amountPaid: updatedVendor.amountPaid,
                balanceDue: updatedVendor.baseCost - updatedVendor.amountPaid,
                paymentStatus: updatedVendor.paymentStatus
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
async function getPaymentInfo(vendorId) {
    try {
        const vendorResult = await get(vendorId);
        if (!vendorResult.success) {
            return vendorResult;
        }
        const vendor = vendorResult.data;
        return {
            success: true,
            data: {
                vendorId: vendor.id,
                vendorName: vendor.name,
                baseCost: vendor.baseCost,
                amountPaid: vendor.amountPaid,
                balanceDue: vendor.baseCost - vendor.amountPaid,
                paymentStatus: vendor.paymentStatus
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        };
    }
}
/**
 * Maps database vendor record to Vendor type.
 */ function mapVendorFromDb(dbVendor) {
    return {
        id: dbVendor.id,
        name: dbVendor.name,
        category: dbVendor.category,
        contactName: dbVendor.contact_name,
        email: dbVendor.email,
        phone: dbVendor.phone,
        pricingModel: dbVendor.pricing_model,
        baseCost: parseFloat(dbVendor.base_cost),
        paymentStatus: dbVendor.payment_status,
        amountPaid: parseFloat(dbVendor.amount_paid),
        notes: dbVendor.notes,
        createdAt: dbVendor.created_at,
        updatedAt: dbVendor.updated_at
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvdmVuZG9yU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFZlbmRvciBTZXJ2aWNlXG4gKiBcbiAqIEhhbmRsZXMgdmVuZG9yIG1hbmFnZW1lbnQgaW5jbHVkaW5nIENSVUQgb3BlcmF0aW9ucywgcHJpY2luZyBtb2RlbHMsXG4gKiBhbmQgcGF5bWVudCB0cmFja2luZyBmb3Igd2VkZGluZyBzZXJ2aWNlIHByb3ZpZGVycy5cbiAqIFxuICogUmVxdWlyZW1lbnRzOiA3LjEsIDcuMywgNy42LCA4LjEsIDguM1xuICovXG5cbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQge1xuICBjcmVhdGVWZW5kb3JTY2hlbWEsXG4gIHVwZGF0ZVZlbmRvclNjaGVtYSxcbiAgdmVuZG9yRmlsdGVyU2NoZW1hLFxuICB2ZW5kb3JTZWFyY2hTY2hlbWEsXG4gIHJlY29yZFBheW1lbnRTY2hlbWEsXG4gIHR5cGUgQ3JlYXRlVmVuZG9yRFRPLFxuICB0eXBlIFVwZGF0ZVZlbmRvckRUTyxcbiAgdHlwZSBWZW5kb3JGaWx0ZXJEVE8sXG4gIHR5cGUgVmVuZG9yU2VhcmNoRFRPLFxuICB0eXBlIFJlY29yZFBheW1lbnREVE8sXG4gIHR5cGUgVmVuZG9yLFxuICB0eXBlIFBhZ2luYXRlZFZlbmRvcnMsXG4gIHR5cGUgVmVuZG9yUGF5bWVudEluZm8sXG59IGZyb20gJy4uL3NjaGVtYXMvdmVuZG9yU2NoZW1hcyc7XG5pbXBvcnQgeyBzYW5pdGl6ZUlucHV0IH0gZnJvbSAnLi4vdXRpbHMvc2FuaXRpemF0aW9uJztcblxuLy8gUmVzdWx0IHR5cGUgZm9yIGNvbnNpc3RlbnQgZXJyb3IgaGFuZGxpbmdcbnR5cGUgUmVzdWx0PFQ+ID1cbiAgfCB7IHN1Y2Nlc3M6IHRydWU7IGRhdGE6IFQgfVxuICB8IHsgc3VjY2VzczogZmFsc2U7IGVycm9yOiB7IGNvZGU6IHN0cmluZzsgbWVzc2FnZTogc3RyaW5nOyBkZXRhaWxzPzogdW5rbm93biB9IH07XG5cbi8vIEluaXRpYWxpemUgU3VwYWJhc2UgY2xpZW50XG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhXG4pO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgdmVuZG9yIGluIHRoZSBzeXN0ZW0uXG4gKiBcbiAqIEBwYXJhbSBkYXRhIC0gVmVuZG9yIGRhdGEgaW5jbHVkaW5nIG5hbWUsIGNhdGVnb3J5LCBwcmljaW5nIG1vZGVsLCBhbmQgY29udGFjdCBpbmZvXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB0aGUgY3JlYXRlZCB2ZW5kb3Igb3IgZXJyb3IgZGV0YWlsc1xuICogXG4gKiBAZXhhbXBsZVxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgdmVuZG9yU2VydmljZS5jcmVhdGUoe1xuICogICBuYW1lOiAnQ29zdGEgUmljYSBQaG90b2dyYXBoeScsXG4gKiAgIGNhdGVnb3J5OiAncGhvdG9ncmFwaHknLFxuICogICBwcmljaW5nTW9kZWw6ICdmbGF0X3JhdGUnLFxuICogICBiYXNlQ29zdDogMjUwMCxcbiAqICAgZW1haWw6ICdjb250YWN0QGNycGhvdG8uY29tJyxcbiAqIH0pO1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlKGRhdGE6IENyZWF0ZVZlbmRvckRUTyk6IFByb21pc2U8UmVzdWx0PFZlbmRvcj4+IHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWYWxpZGF0ZVxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBjcmVhdGVWZW5kb3JTY2hlbWEuc2FmZVBhcnNlKGRhdGEpO1xuICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gMi4gU2FuaXRpemUgdXNlciBpbnB1dFxuICAgIGNvbnN0IHNhbml0aXplZCA9IHtcbiAgICAgIC4uLnZhbGlkYXRpb24uZGF0YSxcbiAgICAgIG5hbWU6IHNhbml0aXplSW5wdXQodmFsaWRhdGlvbi5kYXRhLm5hbWUpLFxuICAgICAgY29udGFjdE5hbWU6IHZhbGlkYXRpb24uZGF0YS5jb250YWN0TmFtZSA/IHNhbml0aXplSW5wdXQodmFsaWRhdGlvbi5kYXRhLmNvbnRhY3ROYW1lKSA6IG51bGwsXG4gICAgICBub3RlczogdmFsaWRhdGlvbi5kYXRhLm5vdGVzID8gc2FuaXRpemVJbnB1dCh2YWxpZGF0aW9uLmRhdGEubm90ZXMpIDogbnVsbCxcbiAgICB9O1xuXG4gICAgLy8gMy4gRGF0YWJhc2Ugb3BlcmF0aW9uXG4gICAgY29uc3QgeyBkYXRhOiB2ZW5kb3IsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3ZlbmRvcnMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIG5hbWU6IHNhbml0aXplZC5uYW1lLFxuICAgICAgICBjYXRlZ29yeTogc2FuaXRpemVkLmNhdGVnb3J5LFxuICAgICAgICBjb250YWN0X25hbWU6IHNhbml0aXplZC5jb250YWN0TmFtZSxcbiAgICAgICAgZW1haWw6IHNhbml0aXplZC5lbWFpbCxcbiAgICAgICAgcGhvbmU6IHNhbml0aXplZC5waG9uZSxcbiAgICAgICAgcHJpY2luZ19tb2RlbDogc2FuaXRpemVkLnByaWNpbmdNb2RlbCxcbiAgICAgICAgYmFzZV9jb3N0OiBzYW5pdGl6ZWQuYmFzZUNvc3QsXG4gICAgICAgIHBheW1lbnRfc3RhdHVzOiBzYW5pdGl6ZWQucGF5bWVudFN0YXR1cyB8fCAndW5wYWlkJyxcbiAgICAgICAgYW1vdW50X3BhaWQ6IHNhbml0aXplZC5hbW91bnRQYWlkIHx8IDAsXG4gICAgICAgIG5vdGVzOiBzYW5pdGl6ZWQubm90ZXMsXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBtYXBWZW5kb3JGcm9tRGIodmVuZG9yKSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvciBvY2N1cnJlZCcsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBSZXRyaWV2ZXMgYSB2ZW5kb3IgYnkgSUQuXG4gKiBcbiAqIEBwYXJhbSBpZCAtIFZlbmRvciBVVUlEXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB0aGUgdmVuZG9yIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldChpZDogc3RyaW5nKTogUHJvbWlzZTxSZXN1bHQ8VmVuZG9yPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZGF0YTogdmVuZG9yLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd2ZW5kb3JzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdpZCcsIGlkKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWZW5kb3Igbm90IGZvdW5kJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IG1hcFZlbmRvckZyb21EYih2ZW5kb3IpLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFVwZGF0ZXMgYW4gZXhpc3RpbmcgdmVuZG9yLlxuICogXG4gKiBAcGFyYW0gaWQgLSBWZW5kb3IgVVVJRFxuICogQHBhcmFtIGRhdGEgLSBQYXJ0aWFsIHZlbmRvciBkYXRhIHRvIHVwZGF0ZVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgdGhlIHVwZGF0ZWQgdmVuZG9yIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZShpZDogc3RyaW5nLCBkYXRhOiBVcGRhdGVWZW5kb3JEVE8pOiBQcm9taXNlPFJlc3VsdDxWZW5kb3I+PiB7XG4gIHRyeSB7XG4gICAgLy8gMS4gVmFsaWRhdGVcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdXBkYXRlVmVuZG9yU2NoZW1hLnNhZmVQYXJzZShkYXRhKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIDIuIFNhbml0aXplIHVzZXIgaW5wdXRcbiAgICBjb25zdCBzYW5pdGl6ZWQ6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge307XG4gICAgaWYgKHZhbGlkYXRpb24uZGF0YS5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNhbml0aXplZC5uYW1lID0gc2FuaXRpemVJbnB1dCh2YWxpZGF0aW9uLmRhdGEubmFtZSk7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0aW9uLmRhdGEuY29udGFjdE5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLmNvbnRhY3RfbmFtZSA9IHZhbGlkYXRpb24uZGF0YS5jb250YWN0TmFtZSA/IHNhbml0aXplSW5wdXQodmFsaWRhdGlvbi5kYXRhLmNvbnRhY3ROYW1lKSA6IG51bGw7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0aW9uLmRhdGEubm90ZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLm5vdGVzID0gdmFsaWRhdGlvbi5kYXRhLm5vdGVzID8gc2FuaXRpemVJbnB1dCh2YWxpZGF0aW9uLmRhdGEubm90ZXMpIDogbnVsbDtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRpb24uZGF0YS5jYXRlZ29yeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzYW5pdGl6ZWQuY2F0ZWdvcnkgPSB2YWxpZGF0aW9uLmRhdGEuY2F0ZWdvcnk7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0aW9uLmRhdGEuZW1haWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLmVtYWlsID0gdmFsaWRhdGlvbi5kYXRhLmVtYWlsO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGlvbi5kYXRhLnBob25lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNhbml0aXplZC5waG9uZSA9IHZhbGlkYXRpb24uZGF0YS5waG9uZTtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRpb24uZGF0YS5wcmljaW5nTW9kZWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkLnByaWNpbmdfbW9kZWwgPSB2YWxpZGF0aW9uLmRhdGEucHJpY2luZ01vZGVsO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGlvbi5kYXRhLmJhc2VDb3N0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNhbml0aXplZC5iYXNlX2Nvc3QgPSB2YWxpZGF0aW9uLmRhdGEuYmFzZUNvc3Q7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0aW9uLmRhdGEucGF5bWVudFN0YXR1cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBzYW5pdGl6ZWQucGF5bWVudF9zdGF0dXMgPSB2YWxpZGF0aW9uLmRhdGEucGF5bWVudFN0YXR1cztcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRpb24uZGF0YS5hbW91bnRQYWlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNhbml0aXplZC5hbW91bnRfcGFpZCA9IHZhbGlkYXRpb24uZGF0YS5hbW91bnRQYWlkO1xuICAgIH1cblxuICAgIC8vIDMuIERhdGFiYXNlIG9wZXJhdGlvblxuICAgIGNvbnN0IHsgZGF0YTogdmVuZG9yLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd2ZW5kb3JzJylcbiAgICAgIC51cGRhdGUoc2FuaXRpemVkKVxuICAgICAgLmVxKCdpZCcsIGlkKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZlbmRvciBub3QgZm91bmQnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnREFUQUJBU0VfRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZGV0YWlsczogZXJyb3IsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogbWFwVmVuZG9yRnJvbURiKHZlbmRvciksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogRGVsZXRlcyBhIHZlbmRvciBmcm9tIHRoZSBzeXN0ZW0uXG4gKiBcbiAqIEBwYXJhbSBpZCAtIFZlbmRvciBVVUlEXG4gKiBAcmV0dXJucyBSZXN1bHQgaW5kaWNhdGluZyBzdWNjZXNzIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVZlbmRvcihpZDogc3RyaW5nKTogUHJvbWlzZTxSZXN1bHQ8dm9pZD4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3ZlbmRvcnMnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ2lkJywgaWQpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnREFUQUJBU0VfRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZGV0YWlsczogZXJyb3IsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHVuZGVmaW5lZCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvciBvY2N1cnJlZCcsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBMaXN0cyB2ZW5kb3JzIHdpdGggb3B0aW9uYWwgZmlsdGVyaW5nIGFuZCBwYWdpbmF0aW9uLlxuICogXG4gKiBAcGFyYW0gZmlsdGVycyAtIE9wdGlvbmFsIGZpbHRlcnMgZm9yIGNhdGVnb3J5LCBwcmljaW5nIG1vZGVsLCBwYXltZW50IHN0YXR1cywgYW5kIHBhZ2luYXRpb25cbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIHBhZ2luYXRlZCB2ZW5kb3IgbGlzdCBvciBlcnJvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsaXN0KGZpbHRlcnM6IFZlbmRvckZpbHRlckRUTyA9IHt9KTogUHJvbWlzZTxSZXN1bHQ8UGFnaW5hdGVkVmVuZG9ycz4+IHtcbiAgdHJ5IHtcbiAgICAvLyBWYWxpZGF0ZSBmaWx0ZXJzXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZlbmRvckZpbHRlclNjaGVtYS5zYWZlUGFyc2UoZmlsdGVycyk7XG4gICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBmaWx0ZXJzJyxcbiAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgeyBjYXRlZ29yeSwgcHJpY2luZ01vZGVsLCBwYXltZW50U3RhdHVzLCBwYWdlID0gMSwgcGFnZVNpemUgPSA1MCB9ID0gdmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgLy8gQnVpbGQgcXVlcnlcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCd2ZW5kb3JzJykuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JyB9KTtcblxuICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY2F0ZWdvcnknLCBjYXRlZ29yeSk7XG4gICAgfVxuICAgIGlmIChwcmljaW5nTW9kZWwpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3ByaWNpbmdfbW9kZWwnLCBwcmljaW5nTW9kZWwpO1xuICAgIH1cbiAgICBpZiAocGF5bWVudFN0YXR1cykge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncGF5bWVudF9zdGF0dXMnLCBwYXltZW50U3RhdHVzKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBwYWdpbmF0aW9uXG4gICAgY29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZTtcbiAgICBjb25zdCB0byA9IGZyb20gKyBwYWdlU2l6ZSAtIDE7XG4gICAgcXVlcnkgPSBxdWVyeS5yYW5nZShmcm9tLCB0bykub3JkZXIoJ25hbWUnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcblxuICAgIGNvbnN0IHsgZGF0YTogdmVuZG9ycywgZXJyb3IsIGNvdW50IH0gPSBhd2FpdCBxdWVyeTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB0b3RhbCA9IGNvdW50IHx8IDA7XG4gICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICB2ZW5kb3JzOiB2ZW5kb3JzLm1hcChtYXBWZW5kb3JGcm9tRGIpLFxuICAgICAgICB0b3RhbCxcbiAgICAgICAgcGFnZSxcbiAgICAgICAgcGFnZVNpemUsXG4gICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICB9LFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFNlYXJjaGVzIHZlbmRvcnMgYnkgbmFtZSBvciBjb250YWN0IG5hbWUuXG4gKiBcbiAqIEBwYXJhbSBzZWFyY2hQYXJhbXMgLSBTZWFyY2ggcXVlcnkgYW5kIHBhZ2luYXRpb24gcGFyYW1ldGVyc1xuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgcGFnaW5hdGVkIHNlYXJjaCByZXN1bHRzIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaChzZWFyY2hQYXJhbXM6IFZlbmRvclNlYXJjaERUTyk6IFByb21pc2U8UmVzdWx0PFBhZ2luYXRlZFZlbmRvcnM+PiB7XG4gIHRyeSB7XG4gICAgLy8gVmFsaWRhdGUgc2VhcmNoIHBhcmFtZXRlcnNcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdmVuZG9yU2VhcmNoU2NoZW1hLnNhZmVQYXJzZShzZWFyY2hQYXJhbXMpO1xuICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc2VhcmNoIHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHF1ZXJ5LCBwYWdlID0gMSwgcGFnZVNpemUgPSA1MCB9ID0gdmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgLy8gU2VhcmNoIGluIG5hbWUgYW5kIGNvbnRhY3RfbmFtZSBmaWVsZHNcbiAgICBjb25zdCB7IGRhdGE6IHZlbmRvcnMsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd2ZW5kb3JzJylcbiAgICAgIC5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnIH0pXG4gICAgICAub3IoYG5hbWUuaWxpa2UuJSR7cXVlcnl9JSxjb250YWN0X25hbWUuaWxpa2UuJSR7cXVlcnl9JWApXG4gICAgICAucmFuZ2UoKHBhZ2UgLSAxKSAqIHBhZ2VTaXplLCBwYWdlICogcGFnZVNpemUgLSAxKVxuICAgICAgLm9yZGVyKCduYW1lJywgeyBhc2NlbmRpbmc6IHRydWUgfSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgdG90YWwgPSBjb3VudCB8fCAwO1xuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWwgLyBwYWdlU2l6ZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdmVuZG9yczogdmVuZG9ycy5tYXAobWFwVmVuZG9yRnJvbURiKSxcbiAgICAgICAgdG90YWwsXG4gICAgICAgIHBhZ2UsXG4gICAgICAgIHBhZ2VTaXplLFxuICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgfSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvciBvY2N1cnJlZCcsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBSZWNvcmRzIGEgcGF5bWVudCBmb3IgYSB2ZW5kb3IgYW5kIHVwZGF0ZXMgcGF5bWVudCBzdGF0dXMuXG4gKiBcbiAqIEBwYXJhbSBwYXltZW50RGF0YSAtIFZlbmRvciBJRCwgcGF5bWVudCBhbW91bnQsIGFuZCBvcHRpb25hbCBub3Rlc1xuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgdXBkYXRlZCB2ZW5kb3IgcGF5bWVudCBpbmZvIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlY29yZFBheW1lbnQocGF5bWVudERhdGE6IFJlY29yZFBheW1lbnREVE8pOiBQcm9taXNlPFJlc3VsdDxWZW5kb3JQYXltZW50SW5mbz4+IHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWYWxpZGF0ZVxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSByZWNvcmRQYXltZW50U2NoZW1hLnNhZmVQYXJzZShwYXltZW50RGF0YSk7XG4gICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHZlbmRvcklkLCBhbW91bnQgfSA9IHZhbGlkYXRpb24uZGF0YTtcblxuICAgIC8vIDIuIEdldCBjdXJyZW50IHZlbmRvclxuICAgIGNvbnN0IHZlbmRvclJlc3VsdCA9IGF3YWl0IGdldCh2ZW5kb3JJZCk7XG4gICAgaWYgKCF2ZW5kb3JSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHZlbmRvclJlc3VsdCBhcyBSZXN1bHQ8VmVuZG9yUGF5bWVudEluZm8+O1xuICAgIH1cblxuICAgIGNvbnN0IHZlbmRvciA9IHZlbmRvclJlc3VsdC5kYXRhO1xuICAgIGNvbnN0IG5ld0Ftb3VudFBhaWQgPSB2ZW5kb3IuYW1vdW50UGFpZCArIGFtb3VudDtcblxuICAgIC8vIENoZWNrIGlmIHBheW1lbnQgZXhjZWVkcyBiYXNlIGNvc3QgKHdpdGggZmxvYXRpbmcgcG9pbnQgdG9sZXJhbmNlKVxuICAgIGlmIChuZXdBbW91bnRQYWlkIC0gdmVuZG9yLmJhc2VDb3N0ID4gMC4wMSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdQYXltZW50IGFtb3VudCBleGNlZWRzIHZlbmRvciBiYXNlIGNvc3QnLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGJhc2VDb3N0OiB2ZW5kb3IuYmFzZUNvc3QsXG4gICAgICAgICAgICBjdXJyZW50UGFpZDogdmVuZG9yLmFtb3VudFBhaWQsXG4gICAgICAgICAgICBhdHRlbXB0ZWRQYXltZW50OiBhbW91bnQsXG4gICAgICAgICAgICB3b3VsZFRvdGFsOiBuZXdBbW91bnRQYWlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIDMuIENhbGN1bGF0ZSBuZXcgcGF5bWVudCBzdGF0dXNcbiAgICBsZXQgbmV3UGF5bWVudFN0YXR1czogJ3VucGFpZCcgfCAncGFydGlhbCcgfCAncGFpZCc7XG4gICAgaWYgKG5ld0Ftb3VudFBhaWQgPT09IDApIHtcbiAgICAgIG5ld1BheW1lbnRTdGF0dXMgPSAndW5wYWlkJztcbiAgICB9IGVsc2UgaWYgKG5ld0Ftb3VudFBhaWQgPj0gdmVuZG9yLmJhc2VDb3N0KSB7XG4gICAgICBuZXdQYXltZW50U3RhdHVzID0gJ3BhaWQnO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdQYXltZW50U3RhdHVzID0gJ3BhcnRpYWwnO1xuICAgIH1cblxuICAgIC8vIDQuIFVwZGF0ZSB2ZW5kb3JcbiAgICBjb25zdCB1cGRhdGVSZXN1bHQgPSBhd2FpdCB1cGRhdGUodmVuZG9ySWQsIHtcbiAgICAgIGFtb3VudFBhaWQ6IG5ld0Ftb3VudFBhaWQsXG4gICAgICBwYXltZW50U3RhdHVzOiBuZXdQYXltZW50U3RhdHVzLFxuICAgIH0pO1xuXG4gICAgaWYgKCF1cGRhdGVSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHVwZGF0ZVJlc3VsdCBhcyBSZXN1bHQ8VmVuZG9yUGF5bWVudEluZm8+O1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZWRWZW5kb3IgPSB1cGRhdGVSZXN1bHQuZGF0YTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICB2ZW5kb3JJZDogdXBkYXRlZFZlbmRvci5pZCxcbiAgICAgICAgdmVuZG9yTmFtZTogdXBkYXRlZFZlbmRvci5uYW1lLFxuICAgICAgICBiYXNlQ29zdDogdXBkYXRlZFZlbmRvci5iYXNlQ29zdCxcbiAgICAgICAgYW1vdW50UGFpZDogdXBkYXRlZFZlbmRvci5hbW91bnRQYWlkLFxuICAgICAgICBiYWxhbmNlRHVlOiB1cGRhdGVkVmVuZG9yLmJhc2VDb3N0IC0gdXBkYXRlZFZlbmRvci5hbW91bnRQYWlkLFxuICAgICAgICBwYXltZW50U3RhdHVzOiB1cGRhdGVkVmVuZG9yLnBheW1lbnRTdGF0dXMsXG4gICAgICB9LFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldHMgcGF5bWVudCBpbmZvcm1hdGlvbiBmb3IgYSB2ZW5kb3IuXG4gKiBcbiAqIEBwYXJhbSB2ZW5kb3JJZCAtIFZlbmRvciBVVUlEXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB2ZW5kb3IgcGF5bWVudCBpbmZvIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBheW1lbnRJbmZvKHZlbmRvcklkOiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDxWZW5kb3JQYXltZW50SW5mbz4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB2ZW5kb3JSZXN1bHQgPSBhd2FpdCBnZXQodmVuZG9ySWQpO1xuICAgIGlmICghdmVuZG9yUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB2ZW5kb3JSZXN1bHQgYXMgUmVzdWx0PFZlbmRvclBheW1lbnRJbmZvPjtcbiAgICB9XG5cbiAgICBjb25zdCB2ZW5kb3IgPSB2ZW5kb3JSZXN1bHQuZGF0YTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICB2ZW5kb3JJZDogdmVuZG9yLmlkLFxuICAgICAgICB2ZW5kb3JOYW1lOiB2ZW5kb3IubmFtZSxcbiAgICAgICAgYmFzZUNvc3Q6IHZlbmRvci5iYXNlQ29zdCxcbiAgICAgICAgYW1vdW50UGFpZDogdmVuZG9yLmFtb3VudFBhaWQsXG4gICAgICAgIGJhbGFuY2VEdWU6IHZlbmRvci5iYXNlQ29zdCAtIHZlbmRvci5hbW91bnRQYWlkLFxuICAgICAgICBwYXltZW50U3RhdHVzOiB2ZW5kb3IucGF5bWVudFN0YXR1cyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTWFwcyBkYXRhYmFzZSB2ZW5kb3IgcmVjb3JkIHRvIFZlbmRvciB0eXBlLlxuICovXG5mdW5jdGlvbiBtYXBWZW5kb3JGcm9tRGIoZGJWZW5kb3I6IGFueSk6IFZlbmRvciB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGRiVmVuZG9yLmlkLFxuICAgIG5hbWU6IGRiVmVuZG9yLm5hbWUsXG4gICAgY2F0ZWdvcnk6IGRiVmVuZG9yLmNhdGVnb3J5LFxuICAgIGNvbnRhY3ROYW1lOiBkYlZlbmRvci5jb250YWN0X25hbWUsXG4gICAgZW1haWw6IGRiVmVuZG9yLmVtYWlsLFxuICAgIHBob25lOiBkYlZlbmRvci5waG9uZSxcbiAgICBwcmljaW5nTW9kZWw6IGRiVmVuZG9yLnByaWNpbmdfbW9kZWwsXG4gICAgYmFzZUNvc3Q6IHBhcnNlRmxvYXQoZGJWZW5kb3IuYmFzZV9jb3N0KSxcbiAgICBwYXltZW50U3RhdHVzOiBkYlZlbmRvci5wYXltZW50X3N0YXR1cyxcbiAgICBhbW91bnRQYWlkOiBwYXJzZUZsb2F0KGRiVmVuZG9yLmFtb3VudF9wYWlkKSxcbiAgICBub3RlczogZGJWZW5kb3Iubm90ZXMsXG4gICAgY3JlYXRlZEF0OiBkYlZlbmRvci5jcmVhdGVkX2F0LFxuICAgIHVwZGF0ZWRBdDogZGJWZW5kb3IudXBkYXRlZF9hdCxcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGUiLCJkZWxldGVWZW5kb3IiLCJnZXQiLCJnZXRQYXltZW50SW5mbyIsImxpc3QiLCJyZWNvcmRQYXltZW50Iiwic2VhcmNoIiwidXBkYXRlIiwic3VwYWJhc2UiLCJjcmVhdGVDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJkYXRhIiwidmFsaWRhdGlvbiIsImNyZWF0ZVZlbmRvclNjaGVtYSIsInNhZmVQYXJzZSIsInN1Y2Nlc3MiLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwiZGV0YWlscyIsImlzc3VlcyIsInNhbml0aXplZCIsIm5hbWUiLCJzYW5pdGl6ZUlucHV0IiwiY29udGFjdE5hbWUiLCJub3RlcyIsInZlbmRvciIsImZyb20iLCJpbnNlcnQiLCJjYXRlZ29yeSIsImNvbnRhY3RfbmFtZSIsImVtYWlsIiwicGhvbmUiLCJwcmljaW5nX21vZGVsIiwicHJpY2luZ01vZGVsIiwiYmFzZV9jb3N0IiwiYmFzZUNvc3QiLCJwYXltZW50X3N0YXR1cyIsInBheW1lbnRTdGF0dXMiLCJhbW91bnRfcGFpZCIsImFtb3VudFBhaWQiLCJzZWxlY3QiLCJzaW5nbGUiLCJtYXBWZW5kb3JGcm9tRGIiLCJFcnJvciIsImlkIiwiZXEiLCJ1cGRhdGVWZW5kb3JTY2hlbWEiLCJ1bmRlZmluZWQiLCJkZWxldGUiLCJmaWx0ZXJzIiwidmVuZG9yRmlsdGVyU2NoZW1hIiwicGFnZSIsInBhZ2VTaXplIiwicXVlcnkiLCJjb3VudCIsInRvIiwicmFuZ2UiLCJvcmRlciIsImFzY2VuZGluZyIsInZlbmRvcnMiLCJ0b3RhbCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsIm1hcCIsInNlYXJjaFBhcmFtcyIsInZlbmRvclNlYXJjaFNjaGVtYSIsIm9yIiwicGF5bWVudERhdGEiLCJyZWNvcmRQYXltZW50U2NoZW1hIiwidmVuZG9ySWQiLCJhbW91bnQiLCJ2ZW5kb3JSZXN1bHQiLCJuZXdBbW91bnRQYWlkIiwiY3VycmVudFBhaWQiLCJhdHRlbXB0ZWRQYXltZW50Iiwid291bGRUb3RhbCIsIm5ld1BheW1lbnRTdGF0dXMiLCJ1cGRhdGVSZXN1bHQiLCJ1cGRhdGVkVmVuZG9yIiwidmVuZG9yTmFtZSIsImJhbGFuY2VEdWUiLCJkYlZlbmRvciIsInBhcnNlRmxvYXQiLCJjcmVhdGVkQXQiLCJjcmVhdGVkX2F0IiwidXBkYXRlZEF0IiwidXBkYXRlZF9hdCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Q0FPQzs7Ozs7Ozs7Ozs7UUE4Q3FCQTtlQUFBQTs7UUE0TkFDO2VBQUFBOztRQW5KQUM7ZUFBQUE7O1FBb2FBQztlQUFBQTs7UUE3T0FDO2VBQUFBOztRQWdKQUM7ZUFBQUE7O1FBbEVBQztlQUFBQTs7UUFuTkFDO2VBQUFBOzs7NEJBdktPOytCQWV0Qjs4QkFDdUI7QUFPOUIsNkJBQTZCO0FBQzdCLE1BQU1DLFdBQVdDLElBQUFBLHdCQUFZLEVBQzNCQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QixFQUNwQ0YsUUFBUUMsR0FBRyxDQUFDRSw2QkFBNkI7QUFrQnBDLGVBQWViLE9BQU9jLElBQXFCO0lBQ2hELElBQUk7UUFDRixjQUFjO1FBQ2QsTUFBTUMsYUFBYUMsaUNBQWtCLENBQUNDLFNBQVMsQ0FBQ0g7UUFDaEQsSUFBSSxDQUFDQyxXQUFXRyxPQUFPLEVBQUU7WUFDdkIsT0FBTztnQkFDTEEsU0FBUztnQkFDVEMsT0FBTztvQkFDTEMsTUFBTTtvQkFDTkMsU0FBUztvQkFDVEMsU0FBU1AsV0FBV0ksS0FBSyxDQUFDSSxNQUFNO2dCQUNsQztZQUNGO1FBQ0Y7UUFFQSx5QkFBeUI7UUFDekIsTUFBTUMsWUFBWTtZQUNoQixHQUFHVCxXQUFXRCxJQUFJO1lBQ2xCVyxNQUFNQyxJQUFBQSwyQkFBYSxFQUFDWCxXQUFXRCxJQUFJLENBQUNXLElBQUk7WUFDeENFLGFBQWFaLFdBQVdELElB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