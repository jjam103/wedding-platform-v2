{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/bulkOperationValidation.property.test.ts"],"sourcesContent":["import { describe, it, expect, jest, beforeEach } from '@jest/globals';\nimport * as fc from 'fast-check';\nimport type { UpdateGuestDTO } from '@/schemas/guestSchemas';\n\n// Mock Supabase before importing guestService\nconst mockFrom = jest.fn();\njest.mock('@/lib/supabase', () => ({\n  supabase: {\n    from: mockFrom,\n  },\n}));\n\n// Import after mocking\nimport * as guestService from './guestService';\n\n/**\n * Feature: destination-wedding-platform, Property 7: Bulk Operation Validation Consistency\n * \n * For any set of guest updates, performing them as a bulk operation should apply \n * the same validation and sanitization rules as performing them individually, \n * resulting in the same validation outcomes.\n * \n * Validates: Requirements 4.22\n */\ndescribe('Feature: destination-wedding-platform, Property 7: Bulk Operation Validation Consistency', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  /**\n   * Generator for valid guest update data\n   */\n  const validUpdateArbitrary = fc.record({\n    firstName: fc.option(fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0)),\n    lastName: fc.option(fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0)),\n    email: fc.option(fc.emailAddress()),\n    phone: fc.option(fc.string({ minLength: 10, maxLength: 20 }).filter(s => s.trim().length > 0)),\n    ageType: fc.option(fc.constantFrom('adult', 'child', 'senior') as fc.Arbitrary<'adult' | 'child' | 'senior'>),\n    guestType: fc.option(fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0)),\n    dietaryRestrictions: fc.option(fc.string({ maxLength: 500 }).filter(s => s.trim().length > 0)),\n    notes: fc.option(fc.string({ maxLength: 1000 }).filter(s => s.trim().length > 0)),\n  });\n\n  /**\n   * Generator for invalid guest update data (validation should fail)\n   */\n  const invalidUpdateArbitrary = fc.oneof(\n    // Empty required fields\n    fc.record({ firstName: fc.constant('') }),\n    fc.record({ firstName: fc.constant('   ') }),\n    fc.record({ lastName: fc.constant('') }),\n    fc.record({ lastName: fc.constant('   ') }),\n    \n    // Invalid email formats\n    fc.record({ email: fc.constant('not-an-email') }),\n    fc.record({ email: fc.constant('missing@domain') }),\n    fc.record({ email: fc.constant('@nodomain.com') }),\n    fc.record({ email: fc.constant('no-at-sign.com') }),\n    \n    // Invalid UUID for groupId\n    fc.record({ groupId: fc.constant('not-a-uuid') }),\n    fc.record({ groupId: fc.constant('12345') }),\n    \n    // Invalid ageType\n    fc.record({ ageType: fc.constant('invalid-age-type' as any) }),\n  );\n\n  /**\n   * Generator for malicious input (should be sanitized)\n   */\n  const maliciousUpdateArbitrary = fc.record({\n    firstName: fc.oneof(\n      fc.constant('<script>alert(\"xss\")</script>John'),\n      fc.constant('John<img src=x onerror=alert(1)>'),\n      fc.constant('John\"; DROP TABLE guests; --'),\n    ),\n    lastName: fc.oneof(\n      fc.constant('<script>alert(\"xss\")</script>Doe'),\n      fc.constant('Doe<img src=x onerror=alert(1)>'),\n      fc.constant(\"Doe' OR '1'='1\"),\n    ),\n    notes: fc.oneof(\n      fc.constant('<script>document.cookie</script>'),\n      fc.constant('<iframe src=\"http://evil.com\"></iframe>'),\n      fc.constant(\"'; DELETE FROM guests WHERE '1'='1\"),\n    ),\n  });\n\n  /**\n   * Generator for valid UUIDs\n   */\n  const uuidArrayArbitrary = fc.array(fc.uuid(), { minLength: 1, maxLength: 10 });\n\n  it('should apply the same validation rules in bulk update as in individual update', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        uuidArrayArbitrary,\n        invalidUpdateArbitrary,\n        async (ids, invalidUpdate) => {\n          // Test individual update validation\n          const individualResult = await guestService.update(ids[0], invalidUpdate);\n          \n          // Test bulk update validation\n          const bulkResult = await guestService.bulkUpdate(ids, invalidUpdate);\n          \n          // Both should fail validation\n          expect(individualResult.success).toBe(false);\n          expect(bulkResult.success).toBe(false);\n          \n          // Both should return VALIDATION_ERROR\n          if (!individualResult.success && !bulkResult.success) {\n            expect(individualResult.error.code).toBe('VALIDATION_ERROR');\n            expect(bulkResult.error.code).toBe('VALIDATION_ERROR');\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should apply the same sanitization rules in bulk update as in individual update', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        uuidArrayArbitrary,\n        maliciousUpdateArbitrary,\n        async (singleId, bulkIds, maliciousUpdate) => {\n          // Mock successful database response for individual update\n          mockFrom.mockReturnValueOnce({\n            update: jest.fn().mockReturnThis(),\n            eq: jest.fn().mockReturnThis(),\n            select: jest.fn().mockReturnThis(),\n            single: jest.fn().mockResolvedValue({\n              data: { \n                id: singleId, \n                first_name: 'Sanitized', \n                last_name: 'Name',\n                group_id: 'test-group-id',\n                age_type: 'adult',\n                guest_type: 'wedding_guest',\n                invitation_sent: false,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n              },\n              error: null,\n            }),\n          });\n\n          // Mock successful database response for bulk update\n          mockFrom.mockReturnValueOnce({\n            update: jest.fn().mockReturnThis(),\n            in: jest.fn().mockReturnThis(),\n            select: jest.fn().mockResolvedValue({\n              data: bulkIds.map(id => ({\n                id,\n                first_name: 'Sanitized',\n                last_name: 'Name',\n                group_id: 'test-group-id',\n                age_type: 'adult',\n                guest_type: 'wedding_guest',\n                invitation_sent: false,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n              })),\n              error: null,\n            }),\n          });\n          \n          // Test individual update sanitization\n          const individualResult = await guestService.update(singleId, maliciousUpdate);\n          \n          // Test bulk update sanitization\n          const bulkResult = await guestService.bulkUpdate(bulkIds, maliciousUpdate);\n          \n          // Both should succeed (after sanitization)\n          expect(individualResult.success).toBe(true);\n          expect(bulkResult.success).toBe(true);\n          \n          // Verify that the update was called with sanitized data\n          const calls = mockFrom.mock.calls;\n          \n          // Both calls should have been made to 'guests' table\n          expect(calls.length).toBeGreaterThanOrEqual(2);\n          expect(calls[0][0]).toBe('guests');\n          expect(calls[1][0]).toBe('guests');\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should reject bulk update with empty ID array', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        validUpdateArbitrary,\n        async (validUpdate) => {\n          const result = await guestService.bulkUpdate([], validUpdate);\n          \n          expect(result.success).toBe(false);\n          if (!result.success) {\n            expect(result.error.code).toBe('VALIDATION_ERROR');\n            expect(result.error.message).toBe('Guest IDs array is required and must not be empty');\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should reject bulk update with invalid UUID in array', async () => {\n    const invalidIdArrayArbitrary = fc.array(\n      fc.oneof(\n        fc.constant('not-a-uuid'),\n        fc.constant('12345'),\n        fc.constant(''),\n        fc.string().filter(s => !isValidUUID(s))\n      ),\n      { minLength: 1, maxLength: 5 }\n    );\n\n    await fc.assert(\n      fc.asyncProperty(\n        invalidIdArrayArbitrary,\n        validUpdateArbitrary,\n        async (invalidIds, validUpdate) => {\n          const result = await guestService.bulkUpdate(invalidIds, validUpdate);\n          \n          expect(result.success).toBe(false);\n          if (!result.success) {\n            expect(result.error.code).toBe('VALIDATION_ERROR');\n            expect(result.error.message).toContain('Invalid guest ID format');\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should reject bulk delete with empty ID array', async () => {\n    const result = await guestService.bulkDelete([]);\n    \n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error.code).toBe('VALIDATION_ERROR');\n      expect(result.error.message).toBe('Guest IDs array is required and must not be empty');\n    }\n  });\n\n  it('should reject bulk delete with invalid UUID in array', async () => {\n    const invalidIdArrayArbitrary = fc.array(\n      fc.oneof(\n        fc.constant('not-a-uuid'),\n        fc.constant('12345'),\n        fc.constant(''),\n        fc.string().filter(s => !isValidUUID(s))\n      ),\n      { minLength: 1, maxLength: 5 }\n    );\n\n    await fc.assert(\n      fc.asyncProperty(\n        invalidIdArrayArbitrary,\n        async (invalidIds) => {\n          const result = await guestService.bulkDelete(invalidIds);\n          \n          expect(result.success).toBe(false);\n          if (!result.success) {\n            expect(result.error.code).toBe('VALIDATION_ERROR');\n            expect(result.error.message).toContain('Invalid guest ID format');\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle validation errors consistently for mixed valid/invalid data', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        uuidArrayArbitrary,\n        fc.tuple(validUpdateArbitrary, invalidUpdateArbitrary),\n        async (ids, [validUpdate, invalidUpdate]) => {\n          // Both individual and bulk should reject invalid data\n          const individualInvalidResult = await guestService.update(ids[0], invalidUpdate);\n          const bulkInvalidResult = await guestService.bulkUpdate(ids, invalidUpdate);\n          \n          expect(individualInvalidResult.success).toBe(false);\n          expect(bulkInvalidResult.success).toBe(false);\n          \n          if (!individualInvalidResult.success && !bulkInvalidResult.success) {\n            // Both should have the same error code\n            expect(individualInvalidResult.error.code).toBe(bulkInvalidResult.error.code);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should apply field-level validation consistently in bulk operations', async () => {\n    // Test specific field validation rules\n    const fieldValidationTests = [\n      { field: 'firstName', value: '', errorExpected: true },\n      { field: 'firstName', value: '   ', errorExpected: true },\n      { field: 'lastName', value: '', errorExpected: true },\n      { field: 'lastName', value: '   ', errorExpected: true },\n      { field: 'email', value: 'invalid-email', errorExpected: true },\n    ];\n\n    for (const test of fieldValidationTests) {\n      const updateData = { [test.field]: test.value } as UpdateGuestDTO;\n      const ids = [fc.sample(fc.uuid(), 1)[0]];\n      \n      const individualResult = await guestService.update(ids[0], updateData);\n      const bulkResult = await guestService.bulkUpdate(ids, updateData);\n      \n      if (test.errorExpected) {\n        // Both should fail validation\n        expect(individualResult.success).toBe(false);\n        expect(bulkResult.success).toBe(false);\n        \n        if (!individualResult.success && !bulkResult.success) {\n          // Both should have VALIDATION_ERROR\n          expect(individualResult.error.code).toBe('VALIDATION_ERROR');\n          expect(bulkResult.error.code).toBe('VALIDATION_ERROR');\n        }\n      }\n    }\n  });\n\n  it('should preserve validation consistency when applying to multiple IDs', async () => {\n    // This test verifies that bulk operations apply the same validation rules\n    // We don't need to test successful database operations here, just validation consistency\n    \n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(fc.uuid(), { minLength: 2, maxLength: 5 }),\n        invalidUpdateArbitrary,\n        async (ids, invalidUpdate) => {\n          // Both individual and bulk should fail validation with invalid data\n          const individualResult = await guestService.update(ids[0], invalidUpdate);\n          const bulkResult = await guestService.bulkUpdate(ids, invalidUpdate);\n          \n          // Both should fail\n          expect(individualResult.success).toBe(false);\n          expect(bulkResult.success).toBe(false);\n          \n          // Both should have VALIDATION_ERROR\n          if (!individualResult.success && !bulkResult.success) {\n            expect(individualResult.error.code).toBe('VALIDATION_ERROR');\n            expect(bulkResult.error.code).toBe('VALIDATION_ERROR');\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n});\n\n/**\n * Helper function to validate UUID format.\n */\nfunction isValidUUID(uuid: string): boolean {\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n  return uuidRegex.test(uuid);\n}\n"],"names":["mockFrom","jest","fn","mock","supabase","from","describe","beforeEach","clearAllMocks","validUpdateArbitrary","fc","record","firstName","option","string","minLength","maxLength","filter","s","trim","length","lastName","email","emailAddress","phone","ageType","constantFrom","guestType","dietaryRestrictions","notes","invalidUpdateArbitrary","oneof","constant","groupId","maliciousUpdateArbitrary","uuidArrayArbitrary","array","uuid","it","assert","asyncProperty","ids","invalidUpdate","individualResult","guestService","update","bulkResult","bulkUpdate","expect","success","toBe","error","code","numRuns","singleId","bulkIds","maliciousUpdate","mockReturnValueOnce","mockReturnThis","eq","select","single","mockResolvedValue","data","id","first_name","last_name","group_id","age_type","guest_type","invitation_sent","created_at","Date","toISOString","updated_at","in","map","calls","toBeGreaterThanOrEqual","validUpdate","result","message","invalidIdArrayArbitrary","isValidUUID","invalidIds","toContain","bulkDelete","tuple","individualInvalidResult","bulkInvalidResult","fieldValidationTests","field","value","errorExpected","test","updateData","sample","uuidRegex"],"mappings":"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"}