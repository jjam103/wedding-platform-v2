b49fb6db6508dca4d22243641458d40b
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    }
});
const _supabaseServer = require("../../../../../lib/supabaseServer");
const _server = require("next/server");
const _emailService = require("../../../../../services/emailService");
const _emailSchemas = require("../../../../../schemas/emailSchemas");
async function GET(request) {
    try {
        // 1. Auth check
        const supabase = await (0, _supabaseServer.createAuthenticatedClient)();
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // 2. Fetch templates
        const result = await (0, _emailService.listTemplates)();
        if (!result.success) {
            return _server.NextResponse.json(result, {
                status: 500
            });
        }
        return _server.NextResponse.json(result, {
            status: 200
        });
    } catch (error) {
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // 1. Auth check
        const supabase = await (0, _supabaseServer.createAuthenticatedClient)();
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // 2. Parse and validate
        const body = await request.json();
        const validation = _emailSchemas.createEmailTemplateSchema.safeParse(body);
        if (!validation.success) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid request',
                    details: validation.error.issues
                }
            }, {
                status: 400
            });
        }
        // 3. Create template
        const result = await (0, _emailService.createTemplate)(validation.data);
        if (!result.success) {
            return _server.NextResponse.json(result, {
                status: 500
            });
        }
        return _server.NextResponse.json(result, {
            status: 201
        });
    } catch (error) {
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9lbWFpbHMvdGVtcGxhdGVzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZVNlcnZlcic7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBsaXN0VGVtcGxhdGVzLCBjcmVhdGVUZW1wbGF0ZSB9IGZyb20gJ0Avc2VydmljZXMvZW1haWxTZXJ2aWNlJztcbmltcG9ydCB7IGNyZWF0ZUVtYWlsVGVtcGxhdGVTY2hlbWEgfSBmcm9tICdAL3NjaGVtYXMvZW1haWxTY2hlbWFzJztcblxuLyoqXG4gKiBHRVQgL2FwaS9hZG1pbi9lbWFpbHMvdGVtcGxhdGVzXG4gKiBGZXRjaGVzIGFsbCBlbWFpbCB0ZW1wbGF0ZXMuXG4gKiBSZXF1aXJlbWVudHM6IDguNFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBBdXRoIGNoZWNrXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50KCk7XG4gICAgY29uc3Qge1xuICAgICAgZGF0YTogeyBzZXNzaW9uIH0sXG4gICAgICBlcnJvcjogYXV0aEVycm9yLFxuICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7IGNvZGU6ICdVTkFVVEhPUklaRUQnLCBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyAyLiBGZXRjaCB0ZW1wbGF0ZXNcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsaXN0VGVtcGxhdGVzKCk7XG5cbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXN1bHQsIHsgc3RhdHVzOiAyMDAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIFBPU1QgL2FwaS9hZG1pbi9lbWFpbHMvdGVtcGxhdGVzXG4gKiBDcmVhdGVzIGEgbmV3IGVtYWlsIHRlbXBsYXRlLlxuICogUmVxdWlyZW1lbnRzOiA4LjRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIDEuIEF1dGggY2hlY2tcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQoKTtcbiAgICBjb25zdCB7XG4gICAgICBkYXRhOiB7IHNlc3Npb24gfSxcbiAgICAgIGVycm9yOiBhdXRoRXJyb3IsXG4gICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpO1xuXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhc2Vzc2lvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHsgY29kZTogJ1VOQVVUSE9SSVpFRCcsIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDIuIFBhcnNlIGFuZCB2YWxpZGF0ZVxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gY3JlYXRlRW1haWxUZW1wbGF0ZVNjaGVtYS5zYWZlUGFyc2UoYm9keSk7XG5cbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHJlcXVlc3QnLFxuICAgICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDMuIENyZWF0ZSB0ZW1wbGF0ZVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNyZWF0ZVRlbXBsYXRlKHZhbGlkYXRpb24uZGF0YSk7XG5cbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXN1bHQsIHsgc3RhdHVzOiAyMDEgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkdFVCIsIlBPU1QiLCJyZXF1ZXN0Iiwic3VwYWJhc2UiLCJjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50IiwiZGF0YSIsInNlc3Npb24iLCJlcnJvciIsImF1dGhFcnJvciIsImF1dGgiLCJnZXRTZXNzaW9uIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsInN1Y2Nlc3MiLCJjb2RlIiwibWVzc2FnZSIsInN0YXR1cyIsInJlc3VsdCIsImxpc3RUZW1wbGF0ZXMiLCJFcnJvciIsImJvZHkiLCJ2YWxpZGF0aW9uIiwiY3JlYXRlRW1haWxUZW1wbGF0ZVNjaGVtYSIsInNhZmVQYXJzZSIsImRldGFpbHMiLCJpc3N1ZXMiLCJjcmVhdGVUZW1wbGF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7UUFVc0JBO2VBQUFBOztRQThDQUM7ZUFBQUE7OztnQ0F4RG9CO3dCQUNiOzhCQUNpQjs4QkFDSjtBQU9uQyxlQUFlRCxJQUFJRSxPQUFnQjtJQUN4QyxJQUFJO1FBQ0YsZ0JBQWdCO1FBQ2hCLE1BQU1DLFdBQVcsTUFBTUMsSUFBQUEseUNBQXlCO1FBQ2hELE1BQU0sRUFDSkMsTUFBTSxFQUFFQyxPQUFPLEVBQUUsRUFDakJDLE9BQU9DLFNBQVMsRUFDakIsR0FBRyxNQUFNTCxTQUFTTSxJQUFJLENBQUNDLFVBQVU7UUFFbEMsSUFBSUYsYUFBYSxDQUFDRixTQUFTO1lBQ3pCLE9BQU9LLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1ROLE9BQU87b0JBQUVPLE1BQU07b0JBQWdCQyxTQUFTO2dCQUEwQjtZQUNwRSxHQUNBO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxxQkFBcUI7UUFDckIsTUFBTUMsU0FBUyxNQUFNQyxJQUFBQSwyQkFBYTtRQUVsQyxJQUFJLENBQUNELE9BQU9KLE9BQU8sRUFBRTtZQUNuQixPQUFPRixvQkFBWSxDQUFDQyxJQUFJLENBQUNLLFFBQVE7Z0JBQUVELFFBQVE7WUFBSTtRQUNqRDtRQUVBLE9BQU9MLG9CQUFZLENBQUNDLElBQUksQ0FBQ0ssUUFBUTtZQUFFRCxRQUFRO1FBQUk7SUFDakQsRUFBRSxPQUFPVCxPQUFPO1FBQ2QsT0FBT0ksb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtZQUNFQyxTQUFTO1lBQ1ROLE9BQU87Z0JBQ0xPLE1BQU07Z0JBQ05DLFNBQVNSLGlCQUFpQlksUUFBUVosTUFBTVEsT0FBTyxHQUFHO1lBQ3BEO1FBQ0YsR0FDQTtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQU9PLGVBQWVmLEtBQUtDLE9BQWdCO0lBQ3pDLElBQUk7UUFDRixnQkFBZ0I7UUFDaEIsTUFBTUMsV0FBVyxNQUFNQyxJQUFBQSx5Q0FBeUI7UUFDaEQsTUFBTSxFQUNKQyxNQUFNLEVBQUVDLE9BQU8sRUFBRSxFQUNqQkMsT0FBT0MsU0FBUyxFQUNqQixHQUFHLE1BQU1MLFNBQVNNLElBQUksQ0FBQ0MsVUFBVTtRQUVsQyxJQUFJRixhQUFhLENBQUNGLFNBQVM7WUFDekIsT0FBT0ssb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtnQkFDRUMsU0FBUztnQkFDVE4sT0FBTztvQkFBRU8sTUFBTTtvQkFBZ0JDLFNBQVM7Z0JBQTBCO1lBQ3BFLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLHdCQUF3QjtRQUN4QixNQUFNSSxPQUFPLE1BQU1sQixRQUFRVSxJQUFJO1FBQy9CLE1BQU1TLGFBQWFDLHVDQUF5QixDQUFDQyxTQUFTLENBQUNIO1FBRXZELElBQUksQ0FBQ0MsV0FBV1IsT0FBTyxFQUFFO1lBQ3ZCLE9BQU9GLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1ROLE9BQU87b0JBQ0xPLE1BQU07b0JBQ05DLFNBQVM7b0JBQ1RTLFNBQVNILFdBQVdkLEtBQUssQ0FBQ2tCLE1BQU07Z0JBQ2xDO1lBQ0YsR0FDQTtnQkFBRVQsUUFBUTtZQUFJO1FBRWxCO1FBRUEscUJBQXFCO1FBQ3JCLE1BQU1DLFNBQVMsTUFBTVMsSUFBQUEsNEJBQWMsRUFBQ0wsV0FBV2hCLElBQUk7UUFFbkQsSUFBSSxDQUFDWSxPQUFPSixPQUFPLEVBQUU7WUFDbkIsT0FBT0Ysb0JBQVksQ0FBQ0MsSUFBSSxDQUFDSyxRQUFRO2dCQUFFRCxRQUFRO1lBQUk7UUFDakQ7UUFFQSxPQUFPTCxvQkFBWSxDQUFDQyxJQUFJLENBQUNLLFFBQVE7WUFBRUQsUUFBUTtRQUFJO0lBQ2pELEVBQUUsT0FBT1QsT0FBTztRQUNkLE9BQU9JLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7WUFDRUMsU0FBUztZQUNUTixPQUFPO2dCQUNMTyxNQUFNO2dCQUNOQyxTQUFTUixpQkFBaUJZLFFBQVFaLE1BQU1RLE9BQU8sR0FBRztZQUNwRDtRQUNGLEdBQ0E7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YifQ==