{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/sectionsService.test.ts"],"sourcesContent":["import {\n  createSection,\n  getSection,\n  updateSection,\n  deleteSection,\n  listSections,\n  reorderSections,\n  validateReferences,\n  detectCircularReferences,\n} from './sectionsService';\nimport type { CreateSectionDTO, UpdateSectionDTO, Reference } from '../schemas/cmsSchemas';\n\n// Mock Supabase\njest.mock('../lib/supabase', () => ({\n  supabase: {\n    from: jest.fn(),\n  },\n}));\n\n// Mock sanitization utilities\njest.mock('../utils/sanitization', () => ({\n  sanitizeInput: jest.fn((input: string) => input.replace(/<[^>]*>/g, '')),\n  sanitizeRichText: jest.fn((html: string) => html.replace(/<script[^>]*>.*?<\\/script>/gi, '')),\n}));\n\nconst { supabase } = require('../lib/supabase');\nconst { sanitizeInput, sanitizeRichText } = require('../utils/sanitization');\n\ndescribe('sectionsService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('createSection', () => {\n    const validSectionData: CreateSectionDTO = {\n      page_type: 'activity',\n      page_id: 'activity-1',\n      display_order: 0,\n      columns: [\n        {\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '<p>Test content</p>' },\n        },\n      ],\n    };\n\n    it('should return success with section data when valid input provided', async () => {\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 0,\n        created_at: '2025-01-29T12:00:00Z',\n        updated_at: '2025-01-29T12:00:00Z',\n      };\n\n      const mockColumns = [\n        {\n          id: 'col-1',\n          section_id: 'section-1',\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '<p>Test content</p>' },\n          created_at: '2025-01-29T12:00:00Z',\n          updated_at: '2025-01-29T12:00:00Z',\n        },\n      ];\n\n      // Mock section insert\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockSection,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns insert\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockResolvedValue({\n            data: mockColumns,\n            error: null,\n          }),\n        }),\n      });\n\n      const result = await createSection(validSectionData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('section-1');\n        expect(result.data.columns).toHaveLength(1);\n        expect(result.data.columns[0].content_data).toEqual({ html: '<p>Test content</p>' });\n      }\n    });\n\n    it('should return VALIDATION_ERROR when invalid input provided', async () => {\n      const invalidData = {\n        page_type: 'invalid_type',\n        page_id: '',\n        display_order: -1,\n        columns: [],\n      } as any;\n\n      const result = await createSection(invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n        expect(result.error.details).toBeDefined();\n      }\n    });\n\n    it('should return DATABASE_ERROR when section insert fails', async () => {\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Insert failed' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await createSection(validSectionData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Insert failed');\n      }\n    });\n\n    it('should return DATABASE_ERROR when columns insert fails and rollback section', async () => {\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 0,\n      };\n\n      // Mock section insert success\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockSection,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns insert failure\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockResolvedValue({\n            data: null,\n            error: { message: 'Columns insert failed' },\n          }),\n        }),\n      });\n\n      // Mock rollback delete\n      supabase.from.mockReturnValueOnce({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: null,\n          }),\n        }),\n      });\n\n      const result = await createSection(validSectionData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Columns insert failed');\n      }\n    });\n\n    it('should sanitize rich text content to prevent XSS attacks', async () => {\n      const maliciousData: CreateSectionDTO = {\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 0,\n        columns: [\n          {\n            column_number: 1,\n            content_type: 'rich_text',\n            content_data: { html: '<p>Safe content</p><script>alert(\"xss\")</script>' },\n          },\n        ],\n      };\n\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 0,\n      };\n\n      const mockColumns = [\n        {\n          id: 'col-1',\n          section_id: 'section-1',\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '<p>Safe content</p>' },\n        },\n      ];\n\n      // Mock section insert\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockSection,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns insert\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockResolvedValue({\n            data: mockColumns,\n            error: null,\n          }),\n        }),\n      });\n\n      const result = await createSection(maliciousData);\n\n      expect(result.success).toBe(true);\n      expect(sanitizeRichText).toHaveBeenCalledWith('<p>Safe content</p><script>alert(\"xss\")</script>');\n      if (result.success) {\n        expect(result.data.columns[0].content_data).toEqual({ html: '<p>Safe content</p>' });\n      }\n    });\n  });\n\n  describe('getSection', () => {\n    it('should return success with section data when section exists', async () => {\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 0,\n        created_at: '2025-01-29T12:00:00Z',\n        updated_at: '2025-01-29T12:00:00Z',\n      };\n\n      const mockColumns = [\n        {\n          id: 'col-1',\n          section_id: 'section-1',\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '<p>Test content</p>' },\n        },\n      ];\n\n      // Mock section select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockSection,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({\n              data: mockColumns,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await getSection('section-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('section-1');\n        expect(result.data.columns).toHaveLength(1);\n        expect(result.data.columns[0].content_data).toEqual({ html: '<p>Test content</p>' });\n      }\n    });\n\n    it('should return NOT_FOUND when section does not exist', async () => {\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { code: 'PGRST116', message: 'Section not found' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await getSection('non-existent');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('NOT_FOUND');\n      }\n    });\n\n    it('should return DATABASE_ERROR when section query fails', async () => {\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Database connection failed' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await getSection('section-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Database connection failed');\n      }\n    });\n\n    it('should return DATABASE_ERROR when columns query fails', async () => {\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 0,\n      };\n\n      // Mock section select success\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockSection,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns select failure\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Columns query failed' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await getSection('section-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Columns query failed');\n      }\n    });\n  });\n\n  describe('updateSection', () => {\n    const updateData: UpdateSectionDTO = {\n      display_order: 1,\n      columns: [\n        {\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '<p>Updated content</p>' },\n        },\n      ],\n    };\n\n    it('should return success with updated section when valid input provided', async () => {\n      // Mock section update\n      supabase.from.mockReturnValueOnce({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: null,\n          }),\n        }),\n      });\n\n      // Mock columns delete\n      supabase.from.mockReturnValueOnce({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: null,\n          }),\n        }),\n      });\n\n      // Mock columns insert\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockResolvedValue({\n          error: null,\n        }),\n      });\n\n      // Mock getSection call (for return value)\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 1,\n        columns: [\n          {\n            id: 'col-1',\n            section_id: 'section-1',\n            column_number: 1,\n            content_type: 'rich_text',\n            content_data: { html: '<p>Updated content</p>' },\n          },\n        ],\n      };\n\n      // Mock getSection - section select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockSection,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock getSection - columns select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({\n              data: mockSection.columns,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await updateSection('section-1', updateData);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.display_order).toBe(1);\n        expect(result.data.columns[0].content_data).toEqual({ html: '<p>Updated content</p>' });\n      }\n    });\n\n    it('should return VALIDATION_ERROR when invalid input provided', async () => {\n      const invalidData = {\n        display_order: -1,\n        columns: [],\n      } as any;\n\n      const result = await updateSection('section-1', invalidData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n\n    it('should return DATABASE_ERROR when section update fails', async () => {\n      supabase.from.mockReturnValueOnce({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: { message: 'Update failed' },\n          }),\n        }),\n      });\n\n      const result = await updateSection('section-1', updateData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Update failed');\n      }\n    });\n\n    it('should return DATABASE_ERROR when columns delete fails', async () => {\n      // Mock section update success\n      supabase.from.mockReturnValueOnce({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: null,\n          }),\n        }),\n      });\n\n      // Mock columns delete failure\n      supabase.from.mockReturnValueOnce({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: { message: 'Delete failed' },\n          }),\n        }),\n      });\n\n      const result = await updateSection('section-1', updateData);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Delete failed');\n      }\n    });\n\n    it('should sanitize rich text content when updating columns', async () => {\n      const maliciousUpdateData: UpdateSectionDTO = {\n        columns: [\n          {\n            column_number: 1,\n            content_type: 'rich_text',\n            content_data: { html: '<p>Safe content</p><script>alert(\"xss\")</script>' },\n          },\n        ],\n      };\n\n      // Mock section update (no section-level changes)\n      // Mock columns delete\n      supabase.from.mockReturnValueOnce({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: null,\n          }),\n        }),\n      });\n\n      // Mock columns insert\n      supabase.from.mockReturnValueOnce({\n        insert: jest.fn().mockResolvedValue({\n          error: null,\n        }),\n      });\n\n      // Mock getSection call\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 0,\n        columns: [\n          {\n            id: 'col-1',\n            section_id: 'section-1',\n            column_number: 1,\n            content_type: 'rich_text',\n            content_data: { html: '<p>Safe content</p>' },\n          },\n        ],\n      };\n\n      // Mock getSection - section select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockSection,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock getSection - columns select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({\n              data: mockSection.columns,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await updateSection('section-1', maliciousUpdateData);\n\n      expect(result.success).toBe(true);\n      expect(sanitizeRichText).toHaveBeenCalledWith('<p>Safe content</p><script>alert(\"xss\")</script>');\n    });\n  });\n\n  describe('deleteSection', () => {\n    it('should return success when section is deleted', async () => {\n      supabase.from.mockReturnValue({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: null,\n          }),\n        }),\n      });\n\n      const result = await deleteSection('section-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBeUndefined();\n      }\n    });\n\n    it('should return DATABASE_ERROR when delete fails', async () => {\n      supabase.from.mockReturnValue({\n        delete: jest.fn().mockReturnValue({\n          eq: jest.fn().mockResolvedValue({\n            error: { message: 'Delete failed' },\n          }),\n        }),\n      });\n\n      const result = await deleteSection('section-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Delete failed');\n      }\n    });\n  });\n\n  describe('listSections', () => {\n    it('should return success with sections and columns when sections exist', async () => {\n      const mockSections = [\n        {\n          id: 'section-1',\n          page_type: 'activity',\n          page_id: 'activity-1',\n          display_order: 0,\n        },\n        {\n          id: 'section-2',\n          page_type: 'activity',\n          page_id: 'activity-1',\n          display_order: 1,\n        },\n      ];\n\n      const mockColumns = [\n        {\n          id: 'col-1',\n          section_id: 'section-1',\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '<p>Section 1 content</p>' },\n        },\n        {\n          id: 'col-2',\n          section_id: 'section-2',\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '<p>Section 2 content</p>' },\n        },\n      ];\n\n      // Mock sections select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              order: jest.fn().mockResolvedValue({\n                data: mockSections,\n                error: null,\n              }),\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns select\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          in: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({\n              data: mockColumns,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await listSections('activity', 'activity-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toHaveLength(2);\n        expect(result.data[0].columns).toHaveLength(1);\n        expect(result.data[1].columns).toHaveLength(1);\n        expect(result.data[0].display_order).toBe(0);\n        expect(result.data[1].display_order).toBe(1);\n      }\n    });\n\n    it('should return success with empty array when no sections exist', async () => {\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              order: jest.fn().mockResolvedValue({\n                data: [],\n                error: null,\n              }),\n            }),\n          }),\n        }),\n      });\n\n      const result = await listSections('activity', 'activity-1');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toEqual([]);\n      }\n    });\n\n    it('should return DATABASE_ERROR when sections query fails', async () => {\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              order: jest.fn().mockResolvedValue({\n                data: null,\n                error: { message: 'Sections query failed' },\n              }),\n            }),\n          }),\n        }),\n      });\n\n      const result = await listSections('activity', 'activity-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Sections query failed');\n      }\n    });\n\n    it('should return DATABASE_ERROR when columns query fails', async () => {\n      const mockSections = [\n        {\n          id: 'section-1',\n          page_type: 'activity',\n          page_id: 'activity-1',\n          display_order: 0,\n        },\n      ];\n\n      // Mock sections select success\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              order: jest.fn().mockResolvedValue({\n                data: mockSections,\n                error: null,\n              }),\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns select failure\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          in: jest.fn().mockReturnValue({\n            order: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Columns query failed' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await listSections('activity', 'activity-1');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Columns query failed');\n      }\n    });\n  });\n\n  describe('reorderSections', () => {\n    it('should return success when sections are reordered', async () => {\n      const sectionIds = ['section-2', 'section-1', 'section-3'];\n\n      // Mock each update call\n      supabase.from.mockReturnValue({\n        update: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await reorderSections('page-1', sectionIds);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBeUndefined();\n      }\n    });\n\n    it('should return DATABASE_ERROR when any update fails', async () => {\n      const sectionIds = ['section-1', 'section-2'];\n\n      // Mock first update success, second update failure\n      supabase.from\n        .mockReturnValueOnce({\n          update: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              eq: jest.fn().mockResolvedValue({\n                error: null,\n              }),\n            }),\n          }),\n        })\n        .mockReturnValueOnce({\n          update: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              eq: jest.fn().mockResolvedValue({\n                error: { message: 'Update failed' },\n              }),\n            }),\n          }),\n        });\n\n      const result = await reorderSections('page-1', sectionIds);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Failed to reorder sections');\n      }\n    });\n\n    it('should update display_order correctly for each section', async () => {\n      const sectionIds = ['section-3', 'section-1', 'section-2'];\n      const updateMocks: any[] = [];\n\n      // Create mock for each section update\n      sectionIds.forEach((_, index) => {\n        const updateMock = jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              error: null,\n            }),\n          }),\n        });\n        updateMocks.push(updateMock);\n\n        supabase.from.mockReturnValueOnce({\n          update: updateMock,\n        });\n      });\n\n      await reorderSections('page-1', sectionIds);\n\n      // Verify each section was updated with correct display_order\n      expect(updateMocks[0]).toHaveBeenCalledWith({ display_order: 0 });\n      expect(updateMocks[1]).toHaveBeenCalledWith({ display_order: 1 });\n      expect(updateMocks[2]).toHaveBeenCalledWith({ display_order: 2 });\n    });\n  });\n\n  describe('validateReferences', () => {\n    it('should return success with valid result when all references exist', async () => {\n      const references: Reference[] = [\n        { type: 'activity', id: 'activity-1' },\n        { type: 'event', id: 'event-1' },\n      ];\n\n      // Mock activity exists\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: { id: 'activity-1' },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock event exists\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: { id: 'event-1' },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await validateReferences(references);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.valid).toBe(true);\n        expect(result.data.brokenReferences).toHaveLength(0);\n        expect(result.data.circularReferences).toHaveLength(0);\n      }\n    });\n\n    it('should return success with broken references when some references do not exist', async () => {\n      const references: Reference[] = [\n        { type: 'activity', id: 'activity-1' },\n        { type: 'event', id: 'non-existent' },\n      ];\n\n      // Mock activity exists\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: { id: 'activity-1' },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock event does not exist\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await validateReferences(references);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.valid).toBe(false);\n        expect(result.data.brokenReferences).toHaveLength(1);\n        expect(result.data.brokenReferences[0]).toEqual({ type: 'event', id: 'non-existent' });\n      }\n    });\n\n    it('should validate all reference types (activity, event, accommodation, location)', async () => {\n      const references: Reference[] = [\n        { type: 'activity', id: 'activity-1' },\n        { type: 'event', id: 'event-1' },\n        { type: 'accommodation', id: 'accommodation-1' },\n        { type: 'location', id: 'location-1' },\n      ];\n\n      // Mock all references exist\n      references.forEach(() => {\n        supabase.from.mockReturnValueOnce({\n          select: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({\n                data: { id: 'exists' },\n                error: null,\n              }),\n            }),\n          }),\n        });\n      });\n\n      const result = await validateReferences(references);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.valid).toBe(true);\n        expect(result.data.brokenReferences).toHaveLength(0);\n      }\n    });\n  });\n\n  describe('detectCircularReferences', () => {\n    it('should return success with false when no circular references exist', async () => {\n      const references: Reference[] = [\n        { type: 'activity', id: 'activity-2' },\n      ];\n\n      // Mock no sections found for referenced activity\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              data: [],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await detectCircularReferences('activity-1', references);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe(false);\n      }\n    });\n\n    it('should return success with true when direct self-reference detected', async () => {\n      const references: Reference[] = [\n        { type: 'activity', id: 'activity-1' },\n      ];\n\n      const result = await detectCircularReferences('activity-1', references);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe(true);\n      }\n    });\n\n    it('should return success with true when circular reference chain detected', async () => {\n      const references: Reference[] = [\n        { type: 'activity', id: 'activity-2' },\n      ];\n\n      // Mock sections for activity-2\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              data: [{ id: 'section-1' }],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns for activity-2 that reference back to activity-1\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          in: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              data: [\n                {\n                  content_data: {\n                    references: [{ type: 'activity', id: 'activity-1' }],\n                  },\n                },\n              ],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await detectCircularReferences('activity-1', references);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe(true);\n      }\n    });\n\n    it('should handle complex reference chains without false positives', async () => {\n      const references: Reference[] = [\n        { type: 'activity', id: 'activity-2' },\n      ];\n\n      // Mock sections for activity-2\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              data: [{ id: 'section-1' }],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock columns for activity-2 that reference activity-3 (not circular)\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          in: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              data: [\n                {\n                  content_data: {\n                    references: [{ type: 'activity', id: 'activity-3' }],\n                  },\n                },\n              ],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Mock sections for activity-3 (no references)\n      supabase.from.mockReturnValueOnce({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            eq: jest.fn().mockResolvedValue({\n              data: [],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await detectCircularReferences('activity-1', references);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe(false);\n      }\n    });\n  });\n});"],"names":["jest","mock","supabase","from","fn","sanitizeInput","input","replace","sanitizeRichText","html","require","describe","beforeEach","clearAllMocks","validSectionData","page_type","page_id","display_order","columns","column_number","content_type","content_data","it","mockSection","id","created_at","updated_at","mockColumns","section_id","mockReturnValueOnce","insert","mockReturnValue","select","single","mockResolvedValue","data","error","result","createSection","expect","success","toBe","toHaveLength","toEqual","invalidData","code","details","toBeDefined","message","delete","eq","maliciousData","toHaveBeenCalledWith","order","getSection","updateData","update","updateSection","maliciousUpdateData","deleteSection","toBeUndefined","mockSections","in","listSections","sectionIds","reorderSections","updateMocks","forEach","_","index","updateMock","push","references","type","validateReferences","valid","brokenReferences","circularReferences","detectCircularReferences"],"mappings":"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"}