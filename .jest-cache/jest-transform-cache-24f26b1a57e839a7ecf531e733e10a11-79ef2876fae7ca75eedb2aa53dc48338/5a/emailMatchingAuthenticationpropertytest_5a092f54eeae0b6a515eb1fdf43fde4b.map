{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/property/emailMatchingAuthentication.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { POST } from '@/app/api/auth/guest/email-match/route';\nimport { createSupabaseClient } from '@/lib/supabase';\n\n/**\n * Property-Based Tests for Email Matching Authentication\n * \n * Feature: destination-wedding-platform\n * Property 14: Email Matching Authentication\n * Validates: Requirements 5.2, 22.4\n * Task: 5.2\n */\n\n// Mock dependencies\njest.mock('@/lib/supabase');\njest.mock('next/headers', () => ({\n  cookies: jest.fn().mockResolvedValue({\n    set: jest.fn(),\n  }),\n}));\n\nconst mockSupabase = {\n  from: jest.fn().mockReturnThis(),\n  select: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  single: jest.fn(),\n  insert: jest.fn().mockReturnThis(),\n};\n\ndescribe('Feature: destination-wedding-platform, Property 14: Email Matching Authentication', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (createSupabaseClient as jest.Mock).mockReturnValue(mockSupabase);\n  });\n\n  it('should authenticate any valid email that exists in guest database with email_matching auth method', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.emailAddress(),\n        fc.uuid(),\n        fc.uuid(),\n        fc.string({ minLength: 1, maxLength: 50 }),\n        fc.string({ minLength: 1, maxLength: 50 }),\n        async (email, guestId, groupId, firstName, lastName) => {\n          // Arrange\n          const mockGuest = {\n            id: guestId,\n            email: email.toLowerCase(),\n            group_id: groupId,\n            first_name: firstName,\n            last_name: lastName,\n            auth_method: 'email_matching',\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: mockGuest, error: null })\n            .mockResolvedValueOnce({ data: { id: 'session-id', token: 'token' }, error: null });\n          mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n          const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ email }),\n          });\n\n          // Act\n          const response = await POST(request);\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(200);\n          expect(data.success).toBe(true);\n          expect(data.data.guestId).toBe(guestId);\n          expect(data.data.groupId).toBe(groupId);\n        }\n      ),\n      { numRuns: 20 } // Fewer runs for async tests\n    );\n  });\n\n  it('should reject any email that does not exist in guest database', async () => {\n    await fc.assert(\n      fc.asyncProperty(fc.emailAddress(), async (email) => {\n        // Arrange\n        mockSupabase.single.mockResolvedValueOnce({ data: null, error: { message: 'Not found' } });\n\n        const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ email }),\n        });\n\n        // Act\n        const response = await POST(request);\n        const data = await response.json();\n\n        // Assert\n        expect(response.status).toBe(404);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('NOT_FOUND');\n      }),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should normalize email case before lookup', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.emailAddress(),\n        fc.uuid(),\n        async (email, guestId) => {\n          // Arrange\n          const mockGuest = {\n            id: guestId,\n            email: email.toLowerCase(),\n            group_id: 'group-id',\n            first_name: 'Test',\n            last_name: 'User',\n            auth_method: 'email_matching',\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: mockGuest, error: null })\n            .mockResolvedValueOnce({ data: { id: 'session-id', token: 'token' }, error: null });\n          mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n          // Test with various case combinations\n          const emailVariations = [\n            email.toLowerCase(),\n            email.toUpperCase(),\n            email.charAt(0).toUpperCase() + email.slice(1).toLowerCase(),\n          ];\n\n          for (const emailVariation of emailVariations) {\n            const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ email: emailVariation }),\n            });\n\n            // Act\n            const response = await POST(request);\n            const data = await response.json();\n\n            // Assert - All variations should work\n            expect(response.status).toBe(200);\n            expect(data.success).toBe(true);\n          }\n        }\n      ),\n      { numRuns: 10 }\n    );\n  });\n\n  it('should reject invalid email formats', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.oneof(\n          fc.constant('not-an-email'),\n          fc.constant('missing@domain'),\n          fc.constant('@nodomain.com'),\n          fc.constant('spaces in@email.com'),\n          fc.constant(''),\n          fc.string({ minLength: 1, maxLength: 20 }).filter(s => !s.includes('@'))\n        ),\n        async (invalidEmail) => {\n          // Arrange\n          const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ email: invalidEmail }),\n          });\n\n          // Act\n          const response = await POST(request);\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(400);\n          expect(data.success).toBe(false);\n          expect(data.error.code).toBe('VALIDATION_ERROR');\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should create unique session tokens for each authentication', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.emailAddress(),\n        fc.uuid(),\n        async (email, guestId) => {\n          // Arrange\n          const mockGuest = {\n            id: guestId,\n            email: email.toLowerCase(),\n            group_id: 'group-id',\n            first_name: 'Test',\n            last_name: 'User',\n            auth_method: 'email_matching',\n          };\n\n          const sessionTokens = new Set<string>();\n\n          // Authenticate multiple times\n          for (let i = 0; i < 5; i++) {\n            mockSupabase.single\n              .mockResolvedValueOnce({ data: mockGuest, error: null })\n              .mockResolvedValueOnce({ data: { id: `session-${i}`, token: `token-${i}` }, error: null });\n            mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n            const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ email }),\n            });\n\n            await POST(request);\n\n            // Extract token from insert call\n            const insertCall = mockSupabase.insert.mock.calls.find(\n              call => mockSupabase.from.mock.calls.some(fromCall => fromCall[0] === 'guest_sessions')\n            );\n            if (insertCall && insertCall[0]?.token) {\n              sessionTokens.add(insertCall[0].token);\n            }\n          }\n\n          // Assert - All tokens should be unique\n          expect(sessionTokens.size).toBe(5);\n        }\n      ),\n      { numRuns: 5 } // Fewer runs since we do 5 authentications per run\n    );\n  });\n\n  it('should only authenticate guests with email_matching auth method', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.emailAddress(),\n        fc.uuid(),\n        fc.constantFrom('email_matching', 'magic_link'),\n        async (email, guestId, authMethod) => {\n          // Arrange\n          if (authMethod === 'email_matching') {\n            const mockGuest = {\n              id: guestId,\n              email: email.toLowerCase(),\n              group_id: 'group-id',\n              first_name: 'Test',\n              last_name: 'User',\n              auth_method: 'email_matching',\n            };\n\n            mockSupabase.single\n              .mockResolvedValueOnce({ data: mockGuest, error: null })\n              .mockResolvedValueOnce({ data: { id: 'session-id', token: 'token' }, error: null });\n            mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n          } else {\n            // Guest with magic_link auth method should not be found\n            mockSupabase.single.mockResolvedValueOnce({ data: null, error: { message: 'Not found' } });\n          }\n\n          const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ email }),\n          });\n\n          // Act\n          const response = await POST(request);\n          const data = await response.json();\n\n          // Assert\n          if (authMethod === 'email_matching') {\n            expect(response.status).toBe(200);\n            expect(data.success).toBe(true);\n          } else {\n            expect(response.status).toBe(404);\n            expect(data.success).toBe(false);\n            expect(data.error.code).toBe('NOT_FOUND');\n          }\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should sanitize malicious email input', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.oneof(\n          fc.constant('<script>alert(\"xss\")</script>test@example.com'),\n          fc.constant('test@example.com<img src=x onerror=alert(1)>'),\n          fc.constant('javascript:alert(1)@example.com'),\n          fc.constant('test@example.com\"; DROP TABLE guests; --')\n        ),\n        async (maliciousEmail) => {\n          // Arrange\n          mockSupabase.single.mockResolvedValueOnce({ data: null, error: { message: 'Not found' } });\n\n          const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ email: maliciousEmail }),\n          });\n\n          // Act\n          await POST(request);\n\n          // Assert - Email should be sanitized before database query\n          const emailArg = mockSupabase.eq.mock.calls.find(call => call[0] === 'email')?.[1];\n          if (emailArg) {\n            expect(emailArg).not.toContain('<script>');\n            expect(emailArg).not.toContain('javascript:');\n            expect(emailArg).not.toContain('DROP TABLE');\n            expect(emailArg).not.toContain('onerror=');\n          }\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should set session expiration to 24 hours from creation', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.emailAddress(),\n        fc.uuid(),\n        async (email, guestId) => {\n          // Arrange\n          const mockGuest = {\n            id: guestId,\n            email: email.toLowerCase(),\n            group_id: 'group-id',\n            first_name: 'Test',\n            last_name: 'User',\n            auth_method: 'email_matching',\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: mockGuest, error: null })\n            .mockResolvedValueOnce({ data: { id: 'session-id', token: 'token' }, error: null });\n          mockSupabase.insert.mockResolvedValueOnce({ data: null, error: null });\n\n          const beforeRequest = Date.now();\n\n          const request = new Request('http://localhost:3000/api/auth/guest/email-match', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ email }),\n          });\n\n          // Act\n          await POST(request);\n\n          const afterRequest = Date.now();\n\n          // Assert - Session should expire 24 hours from now\n          const insertCall = mockSupabase.insert.mock.calls.find(\n            call => mockSupabase.from.mock.calls.some(fromCall => fromCall[0] === 'guest_sessions')\n          );\n\n          if (insertCall && insertCall[0]?.expires_at) {\n            const expiresAt = new Date(insertCall[0].expires_at).getTime();\n            const expectedMin = beforeRequest + 24 * 60 * 60 * 1000;\n            const expectedMax = afterRequest + 24 * 60 * 60 * 1000;\n\n            expect(expiresAt).toBeGreaterThanOrEqual(expectedMin);\n            expect(expiresAt).toBeLessThanOrEqual(expectedMax);\n          }\n        }\n      ),\n      { numRuns: 10 }\n    );\n  });\n});\n"],"names":["jest","mock","cookies","fn","mockResolvedValue","set","mockSupabase","from","mockReturnThis","select","eq","single","insert","describe","beforeEach","clearAllMocks","createSupabaseClient","mockReturnValue","it","fc","assert","asyncProperty","emailAddress","uuid","string","minLength","maxLength","email","guestId","groupId","firstName","lastName","mockGuest","id","toLowerCase","group_id","first_name","last_name","auth_method","mockResolvedValueOnce","data","error","token","request","Request","method","headers","body","JSON","stringify","response","POST","json","expect","status","toBe","success","numRuns","message","code","emailVariations","toUpperCase","charAt","slice","emailVariation","oneof","constant","filter","s","includes","invalidEmail","sessionTokens","Set","i","insertCall","calls","find","call","some","fromCall","add","size","constantFrom","authMethod","maliciousEmail","emailArg","not","toContain","beforeRequest","Date","now","afterRequest","expires_at","expiresAt","getTime","expectedMin","expectedMax","toBeGreaterThanOrEqual","toBeLessThanOrEqual"],"mappings":"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"}