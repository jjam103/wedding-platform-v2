{"version":3,"names":["cov_7j6yvr3uw","actualCoverage","s","GET","request","f","auth","_apiAuth","getAuthenticatedUser","b","_server","NextResponse","json","success","error","code","message","status","user","supabase","data","guest","guestError","from","select","eq","email","single","activities","activitiesError","or","guest_type","order","ascending","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/activities/list/route.ts"],"sourcesContent":["import { getAuthenticatedUser } from '@/lib/apiAuth';\nimport { NextResponse } from 'next/server';\n\n/**\n * GET /api/guest/activities/list\n * \n * Retrieves all published activities visible to the authenticated guest.\n * \n * Requirements: 13.6, 6.1-6.8\n */\nexport async function GET(request: Request) {\n  try {\n    const auth = await getAuthenticatedUser();\n    \n    if (!auth) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    const { user, supabase } = auth;\n    \n    // Get guest information\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, guest_type')\n      .eq('email', user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'GUEST_NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // Fetch published activities visible to this guest type\n    const { data: activities, error: activitiesError } = await supabase\n      .from('activities')\n      .select('*')\n      .eq('status', 'published')\n      .or(`visibility.cs.{${guest.guest_type}},visibility.eq.{}`)\n      .order('start_time', { ascending: true });\n    \n    if (activitiesError) {\n      return NextResponse.json(\n        { success: false, error: { code: 'DATABASE_ERROR', message: activitiesError.message } },\n        { status: 500 }\n      );\n    }\n    \n    return NextResponse.json({ success: true, data: activities || [] });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}