{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/entityCreation.integration.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { guestService } from '../../services/guestService';\nimport { eventService } from '../../services/eventService';\nimport { activityService } from '../../services/activityService';\nimport { vendorService } from '../../services/vendorService';\nimport { accommodationService } from '../../services/accommodationService';\nimport { locationService } from '../../services/locationService';\nimport {\n  createGuestDTOArbitrary,\n  createEventDTOArbitrary,\n  createActivityDTOArbitrary,\n  createVendorDTOArbitrary,\n  createAccommodationDTOArbitrary,\n  createLocationDTOArbitrary,\n} from '../helpers/arbitraries';\n\n/**\n * Integration Test: Entity Creation Capability\n * Feature: destination-wedding-platform, Property 4: Entity Creation Capability\n * \n * Property: For any wedding entity type (guest, event, activity, vendor, accommodation, \n * room type, location, custom page), the admin portal should provide a creation function \n * that successfully creates that entity with valid data.\n * \n * Validates: Requirements 3.9\n * \n * NOTE: This is an integration test that requires database access.\n * Ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.\n * \n * To run integration tests:\n * 1. Copy .env.test.example to .env.test\n * 2. Fill in your test Supabase credentials\n * 3. Run: npm run test:integration\n */\n\n// Check if we have real Supabase credentials (not mock values)\nconst hasRealDatabase = () => {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n  \n  // Check if credentials exist and are not mock values\n  return url && \n         key && \n         url !== 'https://mock-supabase-url.supabase.co' && \n         key !== 'mock-anon-key-for-testing' &&\n         url.includes('.supabase.co');\n};\n\ndescribe.skip('Integration Test: Entity Creation Capability', () => {\n  // SKIPPED: This test suite causes Jest worker crashes (SIGTERM) due to:\n  // 1. Property-based tests with 20 iterations creating many entities\n  // 2. Insufficient cleanup between iterations\n  // 3. Worker memory exhaustion\n  // TODO: Fix by reducing iterations, improving cleanup, or increasing worker memory\n  // Skip all tests if real database is not configured\n  beforeAll(() => {\n    if (!hasRealDatabase()) {\n      console.warn('\\nâš ï¸  Skipping integration tests: Real Supabase credentials not configured');\n      console.log('ðŸ“‹ To run integration tests:');\n      console.log('   1. Copy .env.test.example to .env.test');\n      console.log('   2. Fill in your test Supabase credentials');\n      console.log('   3. Run: npm run test:integration\\n');\n    }\n  });\n\n  describe('Guest Creation', () => {\n    it('should successfully create any valid guest', () => {\n      if (!hasRealDatabase()) {\n        console.log('Skipped: No database configured');\n        return;\n      }\n\n      fc.assert(\n        fc.asyncProperty(createGuestDTOArbitrary, async (guestData) => {\n          const result = await guestService.create(guestData);\n          \n          // Property: Valid guest data should always result in successful creation\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            expect(result.data).toHaveProperty('id');\n            expect(result.data.firstName).toBe(guestData.firstName);\n            expect(result.data.lastName).toBe(guestData.lastName);\n            expect(result.data.email).toBe(guestData.email);\n            expect(result.data.groupId).toBe(guestData.groupId);\n            expect(result.data.ageType).toBe(guestData.ageType);\n            expect(result.data.guestType).toBe(guestData.guestType);\n          }\n        }),\n        { numRuns: 20 } // Reduced runs for integration tests\n      );\n    });\n  });\n\n  describe('Event Creation', () => {\n    it('should successfully create any valid event', () => {\n      if (!hasRealDatabase()) {\n        console.log('Skipped: No database configured');\n        return;\n      }\n\n      fc.assert(\n        fc.asyncProperty(createEventDTOArbitrary, async (eventData) => {\n          const result = await eventService.create(eventData);\n          \n          // Property: Valid event data should always result in successful creation\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            expect(result.data).toHaveProperty('id');\n            expect(result.data.name).toBe(eventData.name);\n            expect(result.data.eventType).toBe(eventData.eventType);\n            expect(result.data.rsvpRequired).toBe(eventData.rsvpRequired);\n            expect(result.data.status).toBe('draft');\n          }\n        }),\n        { numRuns: 20 }\n      );\n    });\n  });\n\n  describe('Activity Creation', () => {\n    it('should successfully create any valid activity', () => {\n      if (!hasRealDatabase()) {\n        console.log('Skipped: No database configured');\n        return;\n      }\n\n      fc.assert(\n        fc.asyncProperty(createActivityDTOArbitrary, async (activityData) => {\n          const result = await activityService.create(activityData);\n          \n          // Property: Valid activity data should always result in successful creation\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            expect(result.data).toHaveProperty('id');\n            expect(result.data.name).toBe(activityData.name);\n            expect(result.data.activityType).toBe(activityData.activityType);\n            expect(result.data.adultsOnly).toBe(activityData.adultsOnly);\n            expect(result.data.plusOneAllowed).toBe(activityData.plusOneAllowed);\n            expect(result.data.status).toBe('draft');\n          }\n        }),\n        { numRuns: 20 }\n      );\n    });\n  });\n\n  describe('Vendor Creation', () => {\n    it('should successfully create any valid vendor', () => {\n      if (!hasRealDatabase()) {\n        console.log('Skipped: No database configured');\n        return;\n      }\n\n      fc.assert(\n        fc.asyncProperty(createVendorDTOArbitrary, async (vendorData) => {\n          const result = await vendorService.create(vendorData);\n          \n          // Property: Valid vendor data should always result in successful creation\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            expect(result.data).toHaveProperty('id');\n            expect(result.data.name).toBe(vendorData.name);\n            expect(result.data.category).toBe(vendorData.category);\n            expect(result.data.pricingModel).toBe(vendorData.pricingModel);\n            expect(result.data.baseCost).toBe(vendorData.baseCost);\n            expect(result.data.paymentStatus).toBe('unpaid');\n          }\n        }),\n        { numRuns: 20 }\n      );\n    });\n  });\n\n  describe('Accommodation Creation', () => {\n    it('should successfully create any valid accommodation', () => {\n      if (!hasRealDatabase()) {\n        console.log('Skipped: No database configured');\n        return;\n      }\n\n      fc.assert(\n        fc.asyncProperty(createAccommodationDTOArbitrary, async (accommodationData) => {\n          const result = await accommodationService.create(accommodationData);\n          \n          // Property: Valid accommodation data should always result in successful creation\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            expect(result.data).toHaveProperty('id');\n            expect(result.data.name).toBe(accommodationData.name);\n            expect(result.data.status).toBe('draft');\n          }\n        }),\n        { numRuns: 20 }\n      );\n    });\n  });\n\n  describe('Location Creation', () => {\n    it('should successfully create any valid location', () => {\n      if (!hasRealDatabase()) {\n        console.log('Skipped: No database configured');\n        return;\n      }\n\n      fc.assert(\n        fc.asyncProperty(createLocationDTOArbitrary, async (locationData) => {\n          const result = await locationService.create(locationData);\n          \n          // Property: Valid location data should always result in successful creation\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            expect(result.data).toHaveProperty('id');\n            expect(result.data.name).toBe(locationData.name);\n          }\n        }),\n        { numRuns: 20 }\n      );\n    });\n  });\n\n  describe('Cross-Entity Creation Consistency', () => {\n    it('should maintain consistent creation behavior across all entity types', () => {\n      if (!hasRealDatabase()) {\n        console.log('Skipped: No database configured');\n        return;\n      }\n\n      fc.assert(\n        fc.asyncProperty(\n          fc.oneof(\n            createGuestDTOArbitrary.map(data => ({ type: 'guest' as const, data })),\n            createEventDTOArbitrary.map(data => ({ type: 'event' as const, data })),\n            createActivityDTOArbitrary.map(data => ({ type: 'activity' as const, data })),\n            createVendorDTOArbitrary.map(data => ({ type: 'vendor' as const, data })),\n            createAccommodationDTOArbitrary.map(data => ({ type: 'accommodation' as const, data })),\n            createLocationDTOArbitrary.map(data => ({ type: 'location' as const, data }))\n          ),\n          async (entitySpec) => {\n            let result;\n            \n            switch (entitySpec.type) {\n              case 'guest':\n                result = await guestService.create(entitySpec.data);\n                break;\n              case 'event':\n                result = await eventService.create(entitySpec.data);\n                break;\n              case 'activity':\n                result = await activityService.create(entitySpec.data);\n                break;\n              case 'vendor':\n                result = await vendorService.create(entitySpec.data);\n                break;\n              case 'accommodation':\n                result = await accommodationService.create(entitySpec.data);\n                break;\n              case 'location':\n                result = await locationService.create(entitySpec.data);\n                break;\n            }\n            \n            // Property: All entity types should have consistent creation behavior\n            expect(result.success).toBe(true);\n            if (result.success) {\n              expect(result.data).toHaveProperty('id');\n              expect(result.data).toHaveProperty('createdAt');\n            }\n          }\n        ),\n        { numRuns: 20 }\n      );\n    });\n  });\n});\n"],"names":["hasRealDatabase","url","process","env","NEXT_PUBLIC_SUPABASE_URL","key","NEXT_PUBLIC_SUPABASE_ANON_KEY","includes","describe","skip","beforeAll","console","warn","log","it","fc","assert","asyncProperty","createGuestDTOArbitrary","guestData","result","guestService","create","expect","success","toBe","data","toHaveProperty","firstName","lastName","email","groupId","ageType","guestType","numRuns","createEventDTOArbitrary","eventData","eventService","name","eventType","rsvpRequired","status","createActivityDTOArbitrary","activityData","activityService","activityType","adultsOnly","plusOneAllowed","createVendorDTOArbitrary","vendorData","vendorService","category","pricingModel","baseCost","paymentStatus","createAccommodationDTOArbitrary","accommodationData","accommodationService","createLocationDTOArbitrary","locationData","locationService","oneof","map","type","entitySpec"],"mappings":"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"}