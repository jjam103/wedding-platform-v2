{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/EmailComposer.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { Button } from '@/components/ui/Button';\nimport { useToast } from '@/components/ui/ToastContext';\nimport type { EmailTemplate } from '@/schemas/emailSchemas';\n\ninterface Guest {\n  id: string;\n  first_name: string;\n  last_name: string;\n  email: string | null;\n  group_id?: string;\n}\n\ninterface Group {\n  id: string;\n  name: string;\n  guest_count?: number;\n}\n\ninterface EmailComposerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\ntype RecipientType = 'guests' | 'groups' | 'all' | 'custom';\n\nexport function EmailComposer({ isOpen, onClose, onSuccess }: EmailComposerProps) {\n  const [guests, setGuests] = useState<Guest[]>([]);\n  const [groups, setGroups] = useState<Group[]>([]);\n  const [templates, setTemplates] = useState<EmailTemplate[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const { addToast } = useToast();\n\n  // Form state\n  const [recipientType, setRecipientType] = useState<RecipientType>('guests');\n  const [selectedRecipients, setSelectedRecipients] = useState<string[]>([]);\n  const [customEmails, setCustomEmails] = useState<string>('');\n  const [selectedTemplate, setSelectedTemplate] = useState<string>('');\n  const [subject, setSubject] = useState('');\n  const [body, setBody] = useState('');\n  const [showPreview, setShowPreview] = useState(false);\n  const [scheduleEnabled, setScheduleEnabled] = useState(false);\n  const [scheduledDate, setScheduledDate] = useState('');\n  const [scheduledTime, setScheduledTime] = useState('');\n\n  // Fetch data\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const fetchData = async () => {\n      setLoading(true);\n      try {\n        const [guestsRes, groupsRes, templatesRes] = await Promise.all([\n          fetch('/api/admin/guests'),\n          fetch('/api/admin/groups'),\n          fetch('/api/admin/emails/templates'),\n        ]);\n\n        const [guestsData, groupsData, templatesData] = await Promise.all([\n          guestsRes.json(),\n          groupsRes.json(),\n          templatesRes.json(),\n        ]);\n\n        if (guestsData.success) {\n          setGuests(guestsData.data.guests || []);\n        }\n        if (groupsData.success) {\n          setGroups(groupsData.data || []);\n        }\n        if (templatesData.success) {\n          setTemplates(templatesData.data || []);\n        }\n      } catch (error) {\n        addToast({\n          type: 'error',\n          message: 'Failed to load data',\n        });\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [isOpen, addToast]);\n\n  // Handle template selection\n  const handleTemplateChange = useCallback((templateId: string) => {\n    setSelectedTemplate(templateId);\n    if (templateId) {\n      const template = templates.find((t) => t.id === templateId);\n      if (template) {\n        setSubject(template.subject);\n        setBody(template.body_html);\n      }\n    } else {\n      setSubject('');\n      setBody('');\n    }\n  }, [templates]);\n\n  // Get recipient emails based on selection\n  const getRecipientEmails = useCallback(async (): Promise<string[]> => {\n    if (recipientType === 'all') {\n      return guests\n        .filter((g) => g.email)\n        .map((g) => g.email!);\n    }\n\n    if (recipientType === 'custom') {\n      return customEmails\n        .split(',')\n        .map((email) => email.trim())\n        .filter((email) => email.length > 0);\n    }\n\n    if (recipientType === 'guests') {\n      return guests\n        .filter((g) => selectedRecipients.includes(g.id) && g.email)\n        .map((g) => g.email!);\n    }\n\n    if (recipientType === 'groups') {\n      // Fetch guests in selected groups\n      const groupGuestPromises = selectedRecipients.map(async (groupId) => {\n        const response = await fetch(`/api/admin/groups/${groupId}/guests`);\n        const data = await response.json();\n        return data.success ? data.data : [];\n      });\n\n      const groupGuestsArrays = await Promise.all(groupGuestPromises);\n      const allGroupGuests = groupGuestsArrays.flat();\n      \n      return allGroupGuests\n        .filter((g: Guest) => g.email)\n        .map((g: Guest) => g.email!);\n    }\n\n    return [];\n  }, [recipientType, selectedRecipients, customEmails, guests]);\n\n  // Preview with variable substitution\n  const getPreviewContent = useCallback(() => {\n    // Sample variable substitution for preview\n    const sampleVariables: Record<string, string> = {\n      guest_name: 'John Doe',\n      event_name: 'Wedding Ceremony',\n      rsvp_link: 'https://example.com/rsvp',\n      deadline_date: '2024-06-01',\n      activity_name: 'Beach Volleyball',\n      activity_date: '2024-06-15',\n      activity_time: '14:00',\n      location: 'Sunset Beach',\n    };\n\n    let previewSubject = subject;\n    let previewBody = body;\n\n    Object.entries(sampleVariables).forEach(([key, value]) => {\n      const pattern = new RegExp(`\\\\{\\\\{${key}\\\\}\\\\}`, 'g');\n      previewSubject = previewSubject.replace(pattern, value);\n      previewBody = previewBody.replace(pattern, value);\n    });\n\n    return { subject: previewSubject, body: previewBody };\n  }, [subject, body]);\n\n  // Handle form submission\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validation\n    if (recipientType !== 'all' && recipientType !== 'custom' && selectedRecipients.length === 0) {\n      addToast({\n        type: 'error',\n        message: 'Please select at least one recipient',\n      });\n      return;\n    }\n\n    if (recipientType === 'custom' && !customEmails.trim()) {\n      addToast({\n        type: 'error',\n        message: 'Please enter at least one email address',\n      });\n      return;\n    }\n\n    if (!subject.trim()) {\n      addToast({\n        type: 'error',\n        message: 'Please enter a subject',\n      });\n      return;\n    }\n\n    if (!body.trim()) {\n      addToast({\n        type: 'error',\n        message: 'Please enter email body',\n      });\n      return;\n    }\n\n    if (scheduleEnabled && (!scheduledDate || !scheduledTime)) {\n      addToast({\n        type: 'error',\n        message: 'Please select a date and time for scheduling',\n      });\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      // Get recipient emails\n      const recipientEmails = await getRecipientEmails();\n\n      if (recipientEmails.length === 0) {\n        addToast({\n          type: 'error',\n          message: 'No valid email addresses found for selected recipients',\n        });\n        setSubmitting(false);\n        return;\n      }\n\n      // Prepare request data\n      const requestData: any = {\n        recipients: recipientEmails,\n        subject,\n        html: body,\n        text: body.replace(/<[^>]*>/g, ''), // Strip HTML for text version\n        template_id: selectedTemplate || undefined,\n      };\n\n      // Handle scheduling\n      let endpoint = '/api/admin/emails/send';\n      if (scheduleEnabled) {\n        const scheduledDateTime = new Date(`${scheduledDate}T${scheduledTime}`);\n        requestData.scheduled_at = scheduledDateTime.toISOString();\n        endpoint = '/api/admin/emails/schedule';\n      }\n\n      // Send email\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(requestData),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast({\n          type: 'success',\n          message: scheduleEnabled\n            ? `Email scheduled for ${recipientEmails.length} recipient(s)`\n            : `Email sent to ${recipientEmails.length} recipient(s)`,\n        });\n        onSuccess();\n        onClose();\n      } else {\n        addToast({\n          type: 'error',\n          message: result.error?.message || 'Failed to send email',\n        });\n      }\n    } catch (error) {\n      addToast({\n        type: 'error',\n        message: 'Failed to send email',\n      });\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"px-6 py-4 border-b border-sage-200 flex items-center justify-between sticky top-0 bg-white\">\n          <h2 className=\"text-2xl font-bold text-sage-900\">Compose Email</h2>\n          <button\n            onClick={onClose}\n            className=\"text-sage-400 hover:text-sage-600 transition-colors\"\n            aria-label=\"Close\"\n          >\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"px-6 py-4\">\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-jungle-500\"></div>\n              <p className=\"mt-2 text-sage-600\">Loading...</p>\n            </div>\n          ) : (\n            <>\n              {/* Template Selection */}\n              <div className=\"mb-4\">\n                <label htmlFor=\"template\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                  Email Template (Optional)\n                </label>\n                <select\n                  id=\"template\"\n                  value={selectedTemplate}\n                  onChange={(e) => handleTemplateChange(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500\"\n                >\n                  <option value=\"\">-- No Template --</option>\n                  {templates.map((template) => (\n                    <option key={template.id} value={template.id}>\n                      {template.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Recipient Type */}\n              <div className=\"mb-4\">\n                <label className=\"block text-sm font-medium text-sage-700 mb-1\">\n                  Recipient Type\n                </label>\n                <div className=\"flex flex-wrap gap-4\">\n                  <label className=\"flex items-center\">\n                    <input\n                      type=\"radio\"\n                      value=\"guests\"\n                      checked={recipientType === 'guests'}\n                      onChange={(e) => {\n                        setRecipientType(e.target.value as RecipientType);\n                        setSelectedRecipients([]);\n                        setCustomEmails('');\n                      }}\n                      className=\"mr-2\"\n                    />\n                    Individual Guests\n                  </label>\n                  <label className=\"flex items-center\">\n                    <input\n                      type=\"radio\"\n                      value=\"groups\"\n                      checked={recipientType === 'groups'}\n                      onChange={(e) => {\n                        setRecipientType(e.target.value as RecipientType);\n                        setSelectedRecipients([]);\n                        setCustomEmails('');\n                      }}\n                      className=\"mr-2\"\n                    />\n                    Guest Groups\n                  </label>\n                  <label className=\"flex items-center\">\n                    <input\n                      type=\"radio\"\n                      value=\"all\"\n                      checked={recipientType === 'all'}\n                      onChange={(e) => {\n                        setRecipientType(e.target.value as RecipientType);\n                        setSelectedRecipients([]);\n                        setCustomEmails('');\n                      }}\n                      className=\"mr-2\"\n                    />\n                    All Guests\n                  </label>\n                  <label className=\"flex items-center\">\n                    <input\n                      type=\"radio\"\n                      value=\"custom\"\n                      checked={recipientType === 'custom'}\n                      onChange={(e) => {\n                        setRecipientType(e.target.value as RecipientType);\n                        setSelectedRecipients([]);\n                        setCustomEmails('');\n                      }}\n                      className=\"mr-2\"\n                    />\n                    Custom List\n                  </label>\n                </div>\n              </div>\n\n              {/* Recipients Selection */}\n              {recipientType === 'guests' && (\n                <div className=\"mb-4\">\n                  <label htmlFor=\"recipients\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                    Select Guests *\n                  </label>\n                  <select\n                    id=\"recipients\"\n                    multiple\n                    value={selectedRecipients}\n                    onChange={(e) => {\n                      const selected = Array.from(e.target.selectedOptions, (option) => option.value);\n                      setSelectedRecipients(selected);\n                    }}\n                    className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500 min-h-[120px]\"\n                    required\n                  >\n                    {guests\n                      .filter((g) => g.email)\n                      .map((guest) => (\n                        <option key={guest.id} value={guest.id}>\n                          {guest.first_name} {guest.last_name} ({guest.email})\n                        </option>\n                      ))}\n                  </select>\n                  <p className=\"mt-1 text-sm text-sage-500\">\n                    Hold Ctrl/Cmd to select multiple guests\n                  </p>\n                </div>\n              )}\n\n              {recipientType === 'groups' && (\n                <div className=\"mb-4\">\n                  <label htmlFor=\"groups\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                    Select Groups *\n                  </label>\n                  <select\n                    id=\"groups\"\n                    multiple\n                    value={selectedRecipients}\n                    onChange={(e) => {\n                      const selected = Array.from(e.target.selectedOptions, (option) => option.value);\n                      setSelectedRecipients(selected);\n                    }}\n                    className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500 min-h-[120px]\"\n                    required\n                  >\n                    {groups.map((group) => (\n                      <option key={group.id} value={group.id}>\n                        {group.name} {group.guest_count ? `(${group.guest_count} guests)` : ''}\n                      </option>\n                    ))}\n                  </select>\n                  <p className=\"mt-1 text-sm text-sage-500\">\n                    Hold Ctrl/Cmd to select multiple groups\n                  </p>\n                </div>\n              )}\n\n              {recipientType === 'all' && (\n                <div className=\"mb-4 p-4 bg-jungle-50 border border-jungle-200 rounded-lg\">\n                  <p className=\"text-sm text-jungle-800\">\n                    <strong>All Guests:</strong> Email will be sent to all {guests.filter((g) => g.email).length} guests with email addresses.\n                  </p>\n                </div>\n              )}\n\n              {recipientType === 'custom' && (\n                <div className=\"mb-4\">\n                  <label htmlFor=\"customEmails\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                    Email Addresses *\n                  </label>\n                  <textarea\n                    id=\"customEmails\"\n                    value={customEmails}\n                    onChange={(e) => setCustomEmails(e.target.value)}\n                    rows={4}\n                    className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500\"\n                    placeholder=\"Enter email addresses separated by commas\"\n                    required\n                  />\n                  <p className=\"mt-1 text-sm text-sage-500\">\n                    Separate multiple email addresses with commas\n                  </p>\n                </div>\n              )}\n\n              {/* Subject */}\n              <div className=\"mb-4\">\n                <label htmlFor=\"subject\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                  Subject *\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"subject\"\n                  value={subject}\n                  onChange={(e) => setSubject(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500\"\n                  required\n                />\n              </div>\n\n              {/* Email Body */}\n              <div className=\"mb-4\">\n                <label htmlFor=\"body\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                  Email Body *\n                </label>\n                <textarea\n                  id=\"body\"\n                  value={body}\n                  onChange={(e) => setBody(e.target.value)}\n                  rows={12}\n                  className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500 font-mono text-sm\"\n                  placeholder=\"Enter email body (HTML supported)\"\n                  required\n                />\n                <p className=\"mt-1 text-sm text-sage-500\">\n                  HTML tags are supported. Use {'{{'}variable{'}'} for variable substitution.\n                  Available variables: guest_name, event_name, rsvp_link, deadline_date, activity_name, activity_date, activity_time, location\n                </p>\n              </div>\n\n              {/* Schedule Option */}\n              <div className=\"mb-4\">\n                <label className=\"flex items-center\">\n                  <input\n                    type=\"checkbox\"\n                    checked={scheduleEnabled}\n                    onChange={(e) => setScheduleEnabled(e.target.checked)}\n                    className=\"mr-2\"\n                  />\n                  <span className=\"text-sm font-medium text-sage-700\">\n                    Schedule for later\n                  </span>\n                </label>\n              </div>\n\n              {scheduleEnabled && (\n                <div className=\"mb-4 grid grid-cols-2 gap-4\">\n                  <div>\n                    <label htmlFor=\"scheduledDate\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                      Date *\n                    </label>\n                    <input\n                      type=\"date\"\n                      id=\"scheduledDate\"\n                      value={scheduledDate}\n                      onChange={(e) => setScheduledDate(e.target.value)}\n                      min={new Date().toISOString().split('T')[0]}\n                      className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500\"\n                      required\n                    />\n                  </div>\n                  <div>\n                    <label htmlFor=\"scheduledTime\" className=\"block text-sm font-medium text-sage-700 mb-1\">\n                      Time *\n                    </label>\n                    <input\n                      type=\"time\"\n                      id=\"scheduledTime\"\n                      value={scheduledTime}\n                      onChange={(e) => setScheduledTime(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-jungle-500\"\n                      required\n                    />\n                  </div>\n                </div>\n              )}\n\n              {/* Preview Section */}\n              {showPreview && (\n                <div className=\"mb-4 p-4 border border-sage-300 rounded-lg bg-sage-50\">\n                  <h3 className=\"text-lg font-semibold text-sage-900 mb-2\">Preview</h3>\n                  <div className=\"bg-white p-4 rounded border border-sage-200\">\n                    <div className=\"mb-2\">\n                      <strong>Subject:</strong> {getPreviewContent().subject}\n                    </div>\n                    <div className=\"mb-2\">\n                      <strong>To:</strong>{' '}\n                      {recipientType === 'all'\n                        ? `All guests (${guests.filter((g) => g.email).length})`\n                        : recipientType === 'custom'\n                        ? customEmails.split(',').filter((e) => e.trim()).length + ' recipient(s)'\n                        : selectedRecipients.length + ' recipient(s)'}\n                    </div>\n                    {scheduleEnabled && scheduledDate && scheduledTime && (\n                      <div className=\"mb-2\">\n                        <strong>Scheduled for:</strong> {scheduledDate} at {scheduledTime}\n                      </div>\n                    )}\n                    <div className=\"border-t border-sage-200 pt-2 mt-2\">\n                      <div dangerouslySetInnerHTML={{ __html: getPreviewContent().body }} />\n                    </div>\n                  </div>\n                  <p className=\"mt-2 text-sm text-sage-600 italic\">\n                    Note: Variables shown with sample data for preview purposes\n                  </p>\n                </div>\n              )}\n            </>\n          )}\n        </form>\n\n        <div className=\"px-6 py-4 border-t border-sage-200 flex items-center justify-between sticky bottom-0 bg-white\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            onClick={() => setShowPreview(!showPreview)}\n            disabled={loading || submitting}\n          >\n            {showPreview ? 'Hide Preview' : 'Show Preview'}\n          </Button>\n          <div className=\"flex gap-3\">\n            <Button\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={onClose}\n              disabled={submitting}\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              variant=\"primary\"\n              onClick={handleSubmit}\n              disabled={loading || submitting}\n            >\n              {submitting ? (\n                <>\n                  <span className=\"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></span>\n                  {scheduleEnabled ? 'Scheduling...' : 'Sending...'}\n                </>\n              ) : (\n                scheduleEnabled ? 'Schedule Email' : 'Send Email'\n              )}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["EmailComposer","isOpen","onClose","onSuccess","guests","setGuests","useState","groups","setGroups","templates","setTemplates","loading","setLoading","submitting","setSubmitting","addToast","useToast","recipientType","setRecipientType","selectedRecipients","setSelectedRecipients","customEmails","setCustomEmails","selectedTemplate","setSelectedTemplate","subject","setSubject","body","setBody","showPreview","setShowPreview","scheduleEnabled","setScheduleEnabled","scheduledDate","setScheduledDate","scheduledTime","setScheduledTime","useEffect","fetchData","guestsRes","groupsRes","templatesRes","Promise","all","fetch","guestsData","groupsData","templatesData","json","success","data","error","type","message","handleTemplateChange","useCallback","templateId","template","find","t","id","body_html","getRecipientEmails","filter","g","email","map","split","trim","length","includes","groupGuestPromises","groupId","response","groupGuestsArrays","allGroupGuests","flat","getPreviewContent","sampleVariables","guest_name","event_name","rsvp_link","deadline_date","activity_name","activity_date","activity_time","location","previewSubject","previewBody","Object","entries","forEach","key","value","pattern","RegExp","replace","handleSubmit","e","preventDefault","recipientEmails","requestData","recipients","html","text","template_id","undefined","endpoint","scheduledDateTime","Date","scheduled_at","toISOString","method","headers","JSON","stringify","result","div","className","h2","button","onClick","aria-label","svg","fill","stroke","viewBox","path","strokeLinecap","strokeLinejoin","strokeWidth","d","form","onSubmit","p","label","htmlFor","select","onChange","target","option","name","input","checked","multiple","selected","Array","from","selectedOptions","required","guest","first_name","last_name","group","guest_count","strong","textarea","rows","placeholder","span","min","h3","dangerouslySetInnerHTML","__html","Button","variant","disabled"],"mappings":"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"}