{"version":3,"names":["GET","request","params","cov_292iy3ggrj","f","s","slug","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","guest","guestError","from","select","eq","user","email","single","slugValidation","_zod","z","string","min","safeParse","eventResult","_eventService","getBySlug","rsvpResult","_rsvpService","list","guest_id","id","event_id","page","page_size","eventRsvpStatus","rsvps","length","activitiesResult","_activityService","eventId","activitiesWithRsvp","Promise","all","activities","map","activity","activityRsvpResult","activity_id","activityRsvpStatus","rsvpStatus","console","path","url"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/events/[slug]/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport * as eventService from '@/services/eventService';\nimport * as activityService from '@/services/activityService';\nimport * as rsvpService from '@/services/rsvpService';\nimport { z } from 'zod';\n\n/**\n * GET /api/guest/events/[slug]\n * \n * Gets a single event by slug with RSVP status and activities list.\n * \n * Requirements: 9.1, 9.2\n */\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ slug: string }> }\n) {\n  try {\n    // Await params for Next.js 15+\n    const { slug } = await params;\n    \n    // 1. AUTHENTICATION\n    const supabase = createRouteHandlerClient({ cookies });\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // Get guest ID from session\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, group_id')\n      .eq('email', session.user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // 2. VALIDATION\n    const slugValidation = z.string().min(1).safeParse(slug);\n    \n    if (!slugValidation.success) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid slug' } },\n        { status: 400 }\n      );\n    }\n    \n    // 3. SERVICE CALL - Get event by slug\n    const eventResult = await eventService.getBySlug(slugValidation.data);\n    \n    if (!eventResult.success) {\n      return NextResponse.json(eventResult, { status: 404 });\n    }\n    \n    // Get RSVP status for this event\n    const rsvpResult = await rsvpService.list({\n      guest_id: guest.id,\n      event_id: eventResult.data.id,\n      page: 1,\n      page_size: 1\n    });\n    \n    const eventRsvpStatus = rsvpResult.success && rsvpResult.data.rsvps.length > 0\n      ? rsvpResult.data.rsvps[0].status\n      : 'pending';\n    \n    // Get activities for this event\n    const activitiesResult = await activityService.list({\n      eventId: eventResult.data.id,\n    });\n    \n    // Get RSVP status for each activity\n    const activitiesWithRsvp = activitiesResult.success\n      ? await Promise.all(\n          activitiesResult.data.activities.map(async (activity) => {\n            const activityRsvpResult = await rsvpService.list({\n              guest_id: guest.id,\n              activity_id: activity.id,\n              page: 1,\n              page_size: 1\n            });\n            \n            const activityRsvpStatus = activityRsvpResult.success && activityRsvpResult.data.rsvps.length > 0\n              ? activityRsvpResult.data.rsvps[0].status\n              : 'pending';\n            \n            return {\n              ...activity,\n              rsvpStatus: activityRsvpStatus,\n            };\n          })\n        )\n      : [];\n    \n    // 4. RESPONSE\n    return NextResponse.json({\n      success: true,\n      data: {\n        ...eventResult.data,\n        rsvpStatus: eventRsvpStatus,\n        activities: activitiesWithRsvp,\n      },\n    });\n    \n  } catch (error) {\n    console.error('API Error:', { path: request.url, error });\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}