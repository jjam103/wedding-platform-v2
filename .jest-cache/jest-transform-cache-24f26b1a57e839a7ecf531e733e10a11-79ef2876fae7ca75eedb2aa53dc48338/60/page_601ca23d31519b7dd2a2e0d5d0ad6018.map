{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/photos/page.tsx"],"sourcesContent":["'use client';\n\nexport const dynamic = 'force-dynamic';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { createClient } from '@supabase/supabase-js';\nimport { AdminLayout } from '@/components/admin/AdminLayout';\nimport { Toast } from '@/components/ui/Toast';\nimport { GridSkeleton } from '@/components/ui/SkeletonLoaders';\n\ninterface Photo {\n  id: string;\n  uploader_id: string;\n  photo_url: string;\n  storage_type: 'b2' | 'supabase';\n  page_type: 'event' | 'activity' | 'accommodation' | 'memory';\n  page_id?: string;\n  caption?: string;\n  alt_text?: string;\n  moderation_status: 'pending' | 'approved' | 'rejected';\n  moderation_reason?: string;\n  display_order?: number;\n  created_at: string;\n  moderated_at?: string;\n  updated_at: string;\n}\n\ninterface ToastState {\n  id: string;\n  message: string;\n  type: 'success' | 'error' | 'warning' | 'info';\n}\n\ninterface PhotoEditModalProps {\n  photo: Photo;\n  onClose: () => void;\n  onSave: (id: string, data: { caption?: string; alt_text?: string }) => Promise<void>;\n}\n\nfunction PhotoEditModal({ photo, onClose, onSave }: PhotoEditModalProps) {\n  const [caption, setCaption] = useState(photo.caption || '');\n  const [altText, setAltText] = useState(photo.alt_text || '');\n  const [saving, setSaving] = useState(false);\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      await onSave(photo.id, { caption, alt_text: altText });\n      onClose();\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Close on Escape key\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && !saving) {\n        onClose();\n      }\n    };\n    window.addEventListener('keydown', handleEscape);\n    return () => window.removeEventListener('keydown', handleEscape);\n  }, [onClose, saving]);\n\n  // Prevent body scroll\n  useEffect(() => {\n    document.body.style.overflow = 'hidden';\n    return () => {\n      document.body.style.overflow = 'unset';\n    };\n  }, []);\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\"\n      onClick={!saving ? onClose : undefined}\n    >\n      <div\n        className=\"bg-white rounded-xl shadow-2xl max-w-2xl w-full p-6\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <h2 className=\"text-xl font-semibold text-sage-900 mb-4\">Edit Photo Details</h2>\n        \n        {/* Photo preview */}\n        <div className=\"mb-4\">\n          <img\n            src={photo.photo_url}\n            alt={photo.alt_text || 'Photo preview'}\n            className=\"w-full h-48 object-cover rounded-lg\"\n            crossOrigin=\"anonymous\"\n            referrerPolicy=\"no-referrer\"\n          />\n        </div>\n\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-sage-700 mb-1\">\n              Caption\n            </label>\n            <textarea\n              value={caption}\n              onChange={(e) => setCaption(e.target.value)}\n              className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:ring-2 focus:ring-jungle-500 focus:border-jungle-500\"\n              placeholder=\"Enter photo caption...\"\n              rows={3}\n              maxLength={500}\n              disabled={saving}\n            />\n            <p className=\"text-xs text-sage-500 mt-1\">\n              {caption.length}/500 characters\n            </p>\n          </div>\n          \n          <div>\n            <label className=\"block text-sm font-medium text-sage-700 mb-1\">\n              Alt Text (for accessibility)\n            </label>\n            <input\n              type=\"text\"\n              value={altText}\n              onChange={(e) => setAltText(e.target.value)}\n              className=\"w-full px-3 py-2 border border-sage-300 rounded-lg focus:ring-2 focus:ring-jungle-500 focus:border-jungle-500\"\n              placeholder=\"Describe the image...\"\n              maxLength={200}\n              disabled={saving}\n            />\n            <p className=\"text-xs text-sage-500 mt-1\">\n              {altText.length}/200 characters\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"flex justify-end gap-3 mt-6\">\n          <button\n            onClick={onClose}\n            disabled={saving}\n            className=\"px-4 py-2 border border-sage-300 rounded-lg hover:bg-sage-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleSave}\n            disabled={saving}\n            className=\"px-4 py-2 bg-jungle-500 text-white rounded-lg hover:bg-jungle-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {saving ? 'Saving...' : 'Save Changes'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface PhotoPreviewModalProps {\n  photo: Photo;\n  onClose: () => void;\n  onEdit: (photo: Photo) => void;\n  onApprove: (id: string) => Promise<void>;\n  onReject: (id: string) => Promise<void>;\n  onDelete: (id: string) => Promise<void>;\n}\n\nfunction PhotoPreviewModal({ photo, onClose, onEdit, onApprove, onReject, onDelete }: PhotoPreviewModalProps) {\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleApprove = async () => {\n    setIsProcessing(true);\n    try {\n      await onApprove(photo.id);\n      onClose();\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleReject = async () => {\n    setIsProcessing(true);\n    try {\n      await onReject(photo.id);\n      onClose();\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!confirm('Are you sure you want to delete this photo? This action cannot be undone.')) {\n      return;\n    }\n    setIsProcessing(true);\n    try {\n      await onDelete(photo.id);\n      onClose();\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleEdit = () => {\n    onClose();\n    onEdit(photo);\n  };\n\n  // Close on Escape key\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && !isProcessing) {\n        onClose();\n      }\n    };\n    window.addEventListener('keydown', handleEscape);\n    return () => window.removeEventListener('keydown', handleEscape);\n  }, [onClose, isProcessing]);\n\n  // Prevent body scroll\n  useEffect(() => {\n    document.body.style.overflow = 'hidden';\n    return () => {\n      document.body.style.overflow = 'unset';\n    };\n  }, []);\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\"\n      onClick={!isProcessing ? onClose : undefined}\n    >\n      <div\n        className=\"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b border-sage-200 flex items-center justify-between\">\n          <h2 className=\"text-xl font-semibold text-sage-900\">Photo Preview</h2>\n          <button\n            onClick={onClose}\n            disabled={isProcessing}\n            className=\"p-2 hover:bg-sage-100 rounded-lg transition-colors disabled:opacity-50\"\n            aria-label=\"Close modal\"\n          >\n            ✕\n          </button>\n        </div>\n\n        {/* Body */}\n        <div className=\"px-6 py-4\">\n          {/* Photo */}\n          <div className=\"mb-4\">\n            <img\n              src={photo.photo_url}\n              alt={photo.alt_text || 'Photo preview'}\n              className=\"w-full h-auto rounded-lg\"\n              crossOrigin=\"anonymous\"\n              referrerPolicy=\"no-referrer\"\n            />\n          </div>\n\n          {/* Metadata */}\n          <div className=\"space-y-2 text-sm\">\n            <div>\n              <span className=\"font-medium text-sage-700\">Status:</span>{' '}\n              <span\n                className={`px-2 py-1 rounded-full text-xs font-medium ${\n                  photo.moderation_status === 'approved'\n                    ? 'bg-jungle-100 text-jungle-700'\n                    : photo.moderation_status === 'rejected'\n                    ? 'bg-volcano-100 text-volcano-700'\n                    : 'bg-sunset-100 text-sunset-700'\n                }`}\n              >\n                {photo.moderation_status}\n              </span>\n            </div>\n            {photo.caption && (\n              <div>\n                <span className=\"font-medium text-sage-700\">Caption:</span>{' '}\n                <span className=\"text-sage-600\">{photo.caption}</span>\n              </div>\n            )}\n            {photo.alt_text && (\n              <div>\n                <span className=\"font-medium text-sage-700\">Alt Text:</span>{' '}\n                <span className=\"text-sage-600\">{photo.alt_text}</span>\n              </div>\n            )}\n            <div>\n              <span className=\"font-medium text-sage-700\">Uploaded:</span>{' '}\n              <span className=\"text-sage-600\">\n                {new Date(photo.created_at).toLocaleDateString()} at{' '}\n                {new Date(photo.created_at).toLocaleTimeString()}\n              </span>\n            </div>\n            {photo.moderated_at && (\n              <div>\n                <span className=\"font-medium text-sage-700\">Moderated:</span>{' '}\n                <span className=\"text-sage-600\">\n                  {new Date(photo.moderated_at).toLocaleDateString()} at{' '}\n                  {new Date(photo.moderated_at).toLocaleTimeString()}\n                </span>\n              </div>\n            )}\n            {photo.moderation_reason && (\n              <div>\n                <span className=\"font-medium text-sage-700\">Reason:</span>{' '}\n                <span className=\"text-sage-600\">{photo.moderation_reason}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"px-6 py-4 border-t border-sage-200 flex items-center justify-between\">\n          <button\n            onClick={handleEdit}\n            disabled={isProcessing}\n            className=\"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            Edit Details\n          </button>\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={handleDelete}\n              disabled={isProcessing}\n              className=\"px-4 py-2 bg-volcano-500 hover:bg-volcano-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isProcessing ? 'Processing...' : 'Delete'}\n            </button>\n            {photo.moderation_status !== 'rejected' && (\n              <button\n                onClick={handleReject}\n                disabled={isProcessing}\n                className=\"px-4 py-2 bg-sage-200 hover:bg-sage-300 text-sage-900 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isProcessing ? 'Processing...' : 'Reject'}\n              </button>\n            )}\n            {photo.moderation_status !== 'approved' && (\n              <button\n                onClick={handleApprove}\n                disabled={isProcessing}\n                className=\"px-4 py-2 bg-jungle-500 hover:bg-jungle-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isProcessing ? 'Processing...' : 'Approve'}\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function PhotosPage() {\n  const [photos, setPhotos] = useState<Photo[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [filter, setFilter] = useState<'pending' | 'approved' | 'rejected'>('approved');\n  const [selectedPhoto, setSelectedPhoto] = useState<Photo | null>(null);\n  const [editingPhoto, setEditingPhoto] = useState<Photo | null>(null);\n  const [toasts, setToasts] = useState<ToastState[]>([]);\n  const [showStorageHealth, setShowStorageHealth] = useState(false);\n  const [storageHealth, setStorageHealth] = useState<any>(null);\n  const [checkingHealth, setCheckingHealth] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [showUploadSection, setShowUploadSection] = useState(false);\n\n  const addToast = useCallback((message: string, type: ToastState['type']) => {\n    const id = Date.now().toString();\n    setToasts((prev) => [...prev, { id, message, type }]);\n  }, []);\n\n  const removeToast = useCallback((id: string) => {\n    setToasts((prev) => prev.filter((toast) => toast.id !== id));\n  }, []);\n\n  const checkStorageHealth = useCallback(async () => {\n    setCheckingHealth(true);\n    try {\n      const response = await fetch('/api/admin/storage/health');\n      const result = await response.json();\n      \n      if (result.success) {\n        setStorageHealth(result.data);\n        setShowStorageHealth(true);\n      } else {\n        addToast('Failed to check storage health', 'error');\n      }\n    } catch (error) {\n      console.error('Storage health check error:', error);\n      addToast('Failed to check storage health', 'error');\n    } finally {\n      setCheckingHealth(false);\n    }\n  }, [addToast]);\n\n  const fetchPhotos = useCallback(async () => {\n    setLoading(true);\n    try {\n      // Don't send page_type filter - fetch all photos and filter by moderation_status only\n      const response = await fetch(\n        `/api/admin/photos?moderation_status=${filter}&limit=100&offset=0`\n      );\n      const result = await response.json();\n\n      console.log('Fetched photos:', result);\n\n      if (result.success) {\n        setPhotos(result.data.photos);\n        console.log('Photos loaded:', result.data.photos.length, 'photos');\n        if (result.data.photos.length > 0) {\n          console.log('First photo details:', {\n            url: result.data.photos[0].photo_url,\n            storage_type: result.data.photos[0].storage_type,\n            isB2: result.data.photos[0].photo_url.includes('backblazeb2.com') || result.data.photos[0].photo_url.includes('cdn.jamara.us'),\n            isSupabase: result.data.photos[0].photo_url.includes('supabase.co'),\n          });\n          \n          // Check all photos storage type\n          const b2Count = result.data.photos.filter((p: Photo) => p.storage_type === 'b2').length;\n          const supabaseCount = result.data.photos.filter((p: Photo) => p.storage_type === 'supabase').length;\n          console.log('Storage distribution:', { b2: b2Count, supabase: supabaseCount });\n        }\n      } else {\n        addToast(result.error.message || 'Failed to load photos', 'error');\n      }\n    } catch (error) {\n      console.error('Error fetching photos:', error);\n      addToast('Failed to load photos', 'error');\n    } finally {\n      setLoading(false);\n    }\n  }, [filter, addToast]);\n\n  useEffect(() => {\n    fetchPhotos();\n  }, [fetchPhotos]);\n\n  /**\n   * Set up real-time subscription for photo changes\n   */\n  useEffect(() => {\n    // Create Supabase client for real-time subscriptions\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n    if (!supabaseUrl || !supabaseAnonKey) {\n      console.error('Missing Supabase environment variables for real-time subscriptions');\n      return;\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n    // Subscribe to photo table changes\n    const channel = supabase\n      .channel('photos-changes')\n      .on(\n        'postgres_changes',\n        {\n          event: '*', // Listen to all events (INSERT, UPDATE, DELETE)\n          schema: 'public',\n          table: 'photos',\n        },\n        (payload) => {\n          console.log('Photo change detected:', payload);\n\n          // Update photo grid when photos are uploaded or moderated\n          if (payload.eventType === 'INSERT') {\n            addToast('New photo uploaded', 'info');\n          } else if (payload.eventType === 'UPDATE') {\n            addToast('Photo updated', 'info');\n          } else if (payload.eventType === 'DELETE') {\n            addToast('Photo deleted', 'info');\n          }\n\n          // Refresh the photo list\n          fetchPhotos();\n\n          // Trigger event to update pending count badge in sidebar\n          window.dispatchEvent(new CustomEvent('photoModerated'));\n        }\n      )\n      .subscribe();\n\n    // Cleanup subscription on unmount\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [fetchPhotos, addToast]);\n\n  const handleSaveEdit = async (id: string, data: { caption?: string; alt_text?: string }) => {\n    try {\n      const response = await fetch(`/api/admin/photos/${id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast('Photo updated successfully', 'success');\n        await fetchPhotos();\n      } else {\n        addToast(result.error.message || 'Failed to update photo', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to update photo', 'error');\n    }\n  };\n\n  const handleApprove = async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/photos/${id}/moderate`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ moderation_status: 'approved' }),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast('Photo approved successfully', 'success');\n        await fetchPhotos();\n        // Trigger event to update pending count in sidebar\n        window.dispatchEvent(new CustomEvent('photoModerated'));\n      } else {\n        addToast(result.error.message || 'Failed to approve photo', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to approve photo', 'error');\n    }\n  };\n\n  const handleReject = async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/photos/${id}/moderate`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ moderation_status: 'rejected' }),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast('Photo rejected successfully', 'success');\n        await fetchPhotos();\n        // Trigger event to update pending count in sidebar\n        window.dispatchEvent(new CustomEvent('photoModerated'));\n      } else {\n        addToast(result.error.message || 'Failed to reject photo', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to reject photo', 'error');\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/photos/${id}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast('Photo deleted successfully', 'success');\n        await fetchPhotos();\n        // Trigger event to update pending count in sidebar\n        window.dispatchEvent(new CustomEvent('photoModerated'));\n      } else {\n        addToast(result.error.message || 'Failed to delete photo', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to delete photo', 'error');\n    }\n  };\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files || files.length === 0) return;\n\n    setUploading(true);\n    let successCount = 0;\n    let errorCount = 0;\n\n    try {\n      for (const file of Array.from(files)) {\n        // Validate file type\n        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];\n        if (!allowedTypes.includes(file.type)) {\n          addToast(`Skipped ${file.name}: Invalid file type`, 'warning');\n          errorCount++;\n          continue;\n        }\n\n        // Validate file size (10MB max)\n        const maxSize = 10 * 1024 * 1024;\n        if (file.size > maxSize) {\n          addToast(`Skipped ${file.name}: File too large (max 10MB)`, 'warning');\n          errorCount++;\n          continue;\n        }\n\n        // Create form data\n        const formData = new FormData();\n        formData.append('file', file);\n        formData.append('metadata', JSON.stringify({\n          page_type: 'memory',\n          caption: '',\n          alt_text: '',\n        }));\n\n        // Upload\n        const response = await fetch('/api/admin/photos', {\n          method: 'POST',\n          body: formData,\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          successCount++;\n        } else {\n          addToast(`Failed to upload ${file.name}: ${result.error.message}`, 'error');\n          errorCount++;\n        }\n      }\n\n      // Show summary\n      if (successCount > 0) {\n        addToast(`Successfully uploaded ${successCount} photo${successCount > 1 ? 's' : ''}`, 'success');\n        await fetchPhotos();\n        // Trigger event to update pending count in sidebar\n        window.dispatchEvent(new CustomEvent('photoModerated'));\n      }\n\n      if (errorCount > 0) {\n        addToast(`${errorCount} photo${errorCount > 1 ? 's' : ''} failed to upload`, 'error');\n      }\n\n      // Reset file input\n      event.target.value = '';\n      setShowUploadSection(false);\n    } catch (error) {\n      addToast('Upload failed', 'error');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <AdminLayout currentSection=\"photos\">\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-sage-900\">Photo Gallery</h1>\n            <p className=\"text-sage-600 mt-1\">Manage and moderate wedding photos</p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={() => setShowUploadSection(!showUploadSection)}\n              disabled={uploading}\n              className=\"px-4 py-2 bg-jungle-500 hover:bg-jungle-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n              </svg>\n              Upload Photos\n            </button>\n            <button\n              onClick={checkStorageHealth}\n              disabled={checkingHealth}\n              className=\"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n              {checkingHealth ? 'Checking...' : 'Check Storage'}\n            </button>\n          </div>\n        </div>\n\n        {/* Upload Section */}\n        {showUploadSection && (\n          <div className=\"bg-white border border-sage-200 rounded-lg p-6\">\n            <div className=\"flex items-start justify-between mb-4\">\n              <div>\n                <h2 className=\"text-lg font-semibold text-sage-900\">Upload Photos</h2>\n                <p className=\"text-sm text-sage-600 mt-1\">\n                  Select one or more photos to upload. Supported formats: JPEG, PNG, WebP, GIF (max 10MB each)\n                </p>\n              </div>\n              <button\n                onClick={() => setShowUploadSection(false)}\n                className=\"text-sage-400 hover:text-sage-600\"\n              >\n                ✕\n              </button>\n            </div>\n            \n            <div className=\"border-2 border-dashed border-sage-300 rounded-lg p-8 text-center hover:border-jungle-500 transition-colors\">\n              <input\n                type=\"file\"\n                id=\"photo-upload\"\n                multiple\n                accept=\"image/jpeg,image/jpg,image/png,image/webp,image/gif\"\n                onChange={handleFileUpload}\n                disabled={uploading}\n                className=\"hidden\"\n              />\n              <label\n                htmlFor=\"photo-upload\"\n                className={`cursor-pointer ${uploading ? 'opacity-50 cursor-not-allowed' : ''}`}\n              >\n                <svg\n                  className=\"w-12 h-12 mx-auto text-sage-400 mb-3\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"\n                  />\n                </svg>\n                <p className=\"text-sage-700 font-medium mb-1\">\n                  {uploading ? 'Uploading...' : 'Click to select photos or drag and drop'}\n                </p>\n                <p className=\"text-sm text-sage-500\">\n                  JPEG, PNG, WebP, GIF up to 10MB each\n                </p>\n              </label>\n            </div>\n          </div>\n        )}\n\n        {/* Storage Health Info */}\n        {showStorageHealth && storageHealth && (\n          <div className={`p-4 rounded-lg border ${\n            storageHealth.healthy \n              ? 'bg-jungle-50 border-jungle-200' \n              : storageHealth.configured \n                ? 'bg-sunset-50 border-sunset-200'\n                : 'bg-sage-50 border-sage-200'\n          }`}>\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  {storageHealth.healthy ? (\n                    <svg className=\"w-5 h-5 text-jungle-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                    </svg>\n                  ) : (\n                    <svg className=\"w-5 h-5 text-sunset-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                    </svg>\n                  )}\n                  <h3 className=\"font-semibold text-sage-900\">Storage Status</h3>\n                </div>\n                <p className=\"text-sm text-sage-700 mb-2\">{storageHealth.message}</p>\n                {storageHealth.config && (\n                  <div className=\"text-xs text-sage-600 space-y-1\">\n                    <div>B2 Configured: {storageHealth.configured ? '✓ Yes' : '✗ No'}</div>\n                    {storageHealth.configured && (\n                      <>\n                        <div>Bucket: {storageHealth.config.bucketName}</div>\n                        <div>CDN: {storageHealth.config.hasCdn ? `✓ ${storageHealth.config.cdnUrl}` : '✗ Not configured'}</div>\n                      </>\n                    )}\n                  </div>\n                )}\n              </div>\n              <button\n                onClick={() => setShowStorageHealth(false)}\n                className=\"text-sage-400 hover:text-sage-600\"\n              >\n                ✕\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Filter tabs */}\n        <div className=\"flex gap-2 border-b border-sage-200\">\n          <button\n            onClick={() => setFilter('approved')}\n            className={`px-4 py-2 font-medium transition-colors ${\n              filter === 'approved'\n                ? 'text-jungle-600 border-b-2 border-jungle-600'\n                : 'text-sage-600 hover:text-sage-900'\n            }`}\n          >\n            Approved\n          </button>\n          <button\n            onClick={() => setFilter('pending')}\n            className={`px-4 py-2 font-medium transition-colors ${\n              filter === 'pending'\n                ? 'text-jungle-600 border-b-2 border-jungle-600'\n                : 'text-sage-600 hover:text-sage-900'\n            }`}\n          >\n            Pending\n          </button>\n          <button\n            onClick={() => setFilter('rejected')}\n            className={`px-4 py-2 font-medium transition-colors ${\n              filter === 'rejected'\n                ? 'text-jungle-600 border-b-2 border-jungle-600'\n                : 'text-sage-600 hover:text-sage-900'\n            }`}\n          >\n            Rejected\n          </button>\n        </div>\n\n        {/* Photo grid with inline editing */}\n        {loading ? (\n          <GridSkeleton items={8} columns={4} />\n        ) : photos.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-sage-600\">No {filter} photos found</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {photos.map((photo) => (\n              <div\n                key={photo.id}\n                className=\"group relative bg-white rounded-lg overflow-hidden border border-sage-200 hover:border-jungle-500 transition-all\"\n              >\n                {/* Photo preview */}\n                <div \n                  className=\"aspect-square bg-sage-100 cursor-pointer relative overflow-hidden\"\n                  onClick={() => setSelectedPhoto(photo)}\n                >\n                  <img\n                    src={photo.photo_url}\n                    alt={photo.alt_text || 'Photo thumbnail'}\n                    className=\"w-full h-full object-cover block relative z-10\"\n                    crossOrigin=\"anonymous\"\n                    referrerPolicy=\"no-referrer\"\n                    style={{ display: 'block', opacity: 1, visibility: 'visible' }}\n                    onLoad={(e) => {\n                      const target = e.target as HTMLImageElement;\n                      console.log('✅ Image loaded successfully:', photo.photo_url, {\n                        naturalWidth: target.naturalWidth,\n                        naturalHeight: target.naturalHeight,\n                        complete: target.complete\n                      });\n                    }}\n                    onError={(e) => {\n                      const target = e.target as HTMLImageElement;\n                      console.error('❌ Image failed to load:', photo.photo_url, {\n                        complete: target.complete,\n                        naturalWidth: target.naturalWidth,\n                        naturalHeight: target.naturalHeight,\n                        src: target.src,\n                        currentSrc: target.currentSrc\n                      });\n                      \n                      // Only show placeholder if image truly failed (naturalWidth is 0)\n                      if (target.naturalWidth === 0) {\n                        target.style.display = 'none';\n                        const parent = target.parentElement;\n                        if (parent && !parent.querySelector('.image-placeholder')) {\n                          const placeholder = document.createElement('div');\n                          placeholder.className = 'image-placeholder w-full h-full flex items-center justify-center bg-sage-200';\n                          placeholder.innerHTML = `\n                            <div class=\"text-center p-4\">\n                              <svg class=\"w-12 h-12 mx-auto text-sage-400 mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                              </svg>\n                              <p class=\"text-xs text-sage-600\">Image unavailable</p>\n                              <p class=\"text-xs text-sage-500 mt-1\">Check console for details</p>\n                            </div>\n                          `;\n                          parent.insertBefore(placeholder, target);\n                        }\n                      } else {\n                        console.warn('⚠️ onError fired but image has dimensions:', target.naturalWidth, 'x', target.naturalHeight);\n                      }\n                    }}\n                  />\n                  <div className=\"absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity pointer-events-none z-20\" />\n                  \n                  {/* Storage type badge */}\n                  <div className=\"absolute top-2 right-2 px-2 py-1 rounded text-xs font-medium bg-white bg-opacity-90 z-30\">\n                    {photo.storage_type === 'b2' ? (\n                      <span className=\"text-blue-700\">B2</span>\n                    ) : (\n                      <span className=\"text-purple-700\">Supabase</span>\n                    )}\n                  </div>\n                </div>\n\n                {/* Inline editing section */}\n                <div className=\"p-3 space-y-2\">\n                  {/* Caption input */}\n                  <div>\n                    <label className=\"block text-xs font-medium text-sage-700 mb-1\">\n                      Caption\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={photo.caption || ''}\n                      onChange={(e) => {\n                        const newCaption = e.target.value;\n                        setPhotos(prev => prev.map(p => \n                          p.id === photo.id ? { ...p, caption: newCaption } : p\n                        ));\n                      }}\n                      onBlur={async () => {\n                        await handleSaveEdit(photo.id, { \n                          caption: photo.caption, \n                          alt_text: photo.alt_text \n                        });\n                      }}\n                      placeholder=\"Add caption...\"\n                      className=\"w-full px-2 py-1 text-sm border border-sage-300 rounded focus:ring-1 focus:ring-jungle-500 focus:border-jungle-500\"\n                      maxLength={500}\n                    />\n                  </div>\n\n                  {/* Alt text input */}\n                  <div>\n                    <label className=\"block text-xs font-medium text-sage-700 mb-1\">\n                      Alt Text\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={photo.alt_text || ''}\n                      onChange={(e) => {\n                        const newAltText = e.target.value;\n                        setPhotos(prev => prev.map(p => \n                          p.id === photo.id ? { ...p, alt_text: newAltText } : p\n                        ));\n                      }}\n                      onBlur={async () => {\n                        await handleSaveEdit(photo.id, { \n                          caption: photo.caption, \n                          alt_text: photo.alt_text \n                        });\n                      }}\n                      placeholder=\"Describe image...\"\n                      className=\"w-full px-2 py-1 text-sm border border-sage-300 rounded focus:ring-1 focus:ring-jungle-500 focus:border-jungle-500\"\n                      maxLength={200}\n                    />\n                  </div>\n\n                  {/* Action buttons */}\n                  <div className=\"flex items-center justify-between pt-2 border-t border-sage-200\">\n                    <div className=\"flex items-center gap-1\">\n                      {photo.moderation_status !== 'approved' && (\n                        <button\n                          onClick={() => handleApprove(photo.id)}\n                          className=\"p-1.5 text-jungle-600 hover:bg-jungle-50 rounded transition-colors\"\n                          title=\"Approve\"\n                        >\n                          <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </button>\n                      )}\n                      {photo.moderation_status !== 'rejected' && (\n                        <button\n                          onClick={() => handleReject(photo.id)}\n                          className=\"p-1.5 text-sage-600 hover:bg-sage-100 rounded transition-colors\"\n                          title=\"Reject\"\n                        >\n                          <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </button>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <button\n                        onClick={() => setSelectedPhoto(photo)}\n                        className=\"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors\"\n                        title=\"View full size\"\n                      >\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\n                        </svg>\n                      </button>\n                      <button\n                        onClick={() => handleDelete(photo.id)}\n                        className=\"p-1.5 text-volcano-600 hover:bg-volcano-50 rounded transition-colors\"\n                        title=\"Delete\"\n                      >\n                        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                          <path fillRule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                        </svg>\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Metadata */}\n                  <div className=\"text-xs text-sage-500 pt-1\">\n                    <div className=\"flex items-center justify-between\">\n                      <span>{new Date(photo.created_at).toLocaleDateString()}</span>\n                      <span\n                        className={`px-2 py-0.5 rounded-full text-xs font-medium ${\n                          photo.moderation_status === 'approved'\n                            ? 'bg-jungle-100 text-jungle-700'\n                            : photo.moderation_status === 'rejected'\n                            ? 'bg-volcano-100 text-volcano-700'\n                            : 'bg-sunset-100 text-sunset-700'\n                        }`}\n                      >\n                        {photo.moderation_status}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Photo preview modal */}\n      {selectedPhoto && (\n        <PhotoPreviewModal\n          photo={selectedPhoto}\n          onClose={() => setSelectedPhoto(null)}\n          onEdit={setEditingPhoto}\n          onApprove={handleApprove}\n          onReject={handleReject}\n          onDelete={handleDelete}\n        />\n      )}\n\n      {/* Photo edit modal */}\n      {editingPhoto && (\n        <PhotoEditModal\n          photo={editingPhoto}\n          onClose={() => setEditingPhoto(null)}\n          onSave={handleSaveEdit}\n        />\n      )}\n\n      {/* Toast notifications */}\n      <div className=\"fixed top-4 right-4 z-50 space-y-2\">\n        {toasts.map((toast) => (\n          <Toast\n            key={toast.id}\n            id={toast.id}\n            message={toast.message}\n            type={toast.type}\n            onClose={() => removeToast(toast.id)}\n            duration={5000}\n          />\n        ))}\n      </div>\n    </AdminLayout>\n  );\n}\n"],"names":["PhotosPage","dynamic","PhotoEditModal","photo","onClose","onSave","caption","setCaption","useState","altText","setAltText","alt_text","saving","setSaving","handleSave","id","useEffect","handleEscape","e","key","window","addEventListener","removeEventListener","document","body","style","overflow","div","className","onClick","undefined","stopPropagation","h2","img","src","photo_url","alt","crossOrigin","referrerPolicy","label","textarea","value","onChange","target","placeholder","rows","maxLength","disabled","p","length","input","type","button","PhotoPreviewModal","onEdit","onApprove","onReject","onDelete","isProcessing","setIsProcessing","handleApprove","handleReject","handleDelete","confirm","handleEdit","aria-label","span","moderation_status","Date","created_at","toLocaleDateString","toLocaleTimeString","moderated_at","moderation_reason","photos","setPhotos","loading","setLoading","filter","setFilter","selectedPhoto","setSelectedPhoto","editingPhoto","setEditingPhoto","toasts","setToasts","showStorageHealth","setShowStorageHealth","storageHealth","setStorageHealth","checkingHealth","setCheckingHealth","uploading","setUploading","showUploadSection","setShowUploadSection","addToast","useCallback","message","now","toString","prev","removeToast","toast","checkStorageHealth","response","fetch","result","json","success","data","error","console","fetchPhotos","log","url","storage_type","isB2","includes","isSupabase","b2Count","supabaseCount","b2","supabase","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","createClient","channel","on","event","schema","table","payload","eventType","dispatchEvent","CustomEvent","subscribe","removeChannel","handleSaveEdit","method","headers","JSON","stringify","handleFileUpload","files","successCount","errorCount","file","Array","from","allowedTypes","name","maxSize","size","formData","FormData","append","page_type","AdminLayout","currentSection","h1","svg","fill","stroke","viewBox","path","strokeLinecap","strokeLinejoin","strokeWidth","d","multiple","accept","htmlFor","healthy","configured","fillRule","clipRule","h3","config","bucketName","hasCdn","cdnUrl","GridSkeleton","items","columns","map","display","opacity","visibility","onLoad","naturalWidth","naturalHeight","complete","onError","currentSrc","parent","parentElement","querySelector","createElement","innerHTML","insertBefore","warn","newCaption","onBlur","newAltText","title","Toast","duration"],"mappings":"AAAA;;;;;;;;;;;;QAiWA;eAAwBA;;QA/VXC;eAAAA;;;;uBAEoC;4BACpB;6BACD;uBACN;iCACO;AANtB,MAAMA,UAAU;AAqCvB,SAASC,eAAe,EAAEC,KAAK,EAAEC,OAAO,EAAEC,MAAM,EAAuB;IACrE,MAAM,CAACC,SAASC,WAAW,GAAGC,IAAAA,eAAQ,EAACL,MAAMG,OAAO,IAAI;IACxD,MAAM,CAACG,SAASC,WAAW,GAAGF,IAAAA,eAAQ,EAACL,MAAMQ,QAAQ,IAAI;IACzD,MAAM,CAACC,QAAQC,UAAU,GAAGL,IAAAA,eAAQ,EAAC;IAErC,MAAMM,aAAa;QACjBD,UAAU;QACV,IAAI;YACF,MAAMR,OAAOF,MAAMY,EAAE,EAAE;gBAAET;gBAASK,UAAUF;YAAQ;YACpDL;QACF,SAAU;YACRS,UAAU;QACZ;IACF;IAEA,sBAAsB;IACtBG,IAAAA,gBAAS,EAAC;QACR,MAAMC,eAAe,CAACC;YACpB,IAAIA,EAAEC,GAAG,KAAK,YAAY,CAACP,QAAQ;gBACjCR;YACF;QACF;QACAgB,OAAOC,gBAAgB,CAAC,WAAWJ;QACnC,OAAO,IAAMG,OAAOE,mBAAmB,CAAC,WAAWL;IACrD,GAAG;QAACb;QAASQ;KAAO;IAEpB,sBAAsB;IACtBI,IAAAA,gBAAS,EAAC;QACRO,SAASC,IAAI,CAACC,KAAK,CAACC,QAAQ,GAAG;QAC/B,OAAO;YACLH,SAASC,IAAI,CAACC,KAAK,CAACC,QAAQ,GAAG;QACjC;IACF,GAAG,EAAE;IAEL,qBACE,qBAACC;QACCC,WAAU;QACVC,SAAS,CAACjB,SAASR,UAAU0B;kBAE7B,cAAA,sBAACH;YACCC,WAAU;YACVC,SAAS,CAACX,IAAMA,EAAEa,eAAe;;8BAEjC,qBAACC;oBAAGJ,WAAU;8BAA2C;;8BAGzD,qBAACD;oBAAIC,WAAU;8BACb,cAAA,qBAACK;wBACCC,KAAK/B,MAAMgC,SAAS;wBACpBC,KAAKjC,MAAMQ,QAAQ,IAAI;wBACvBiB,WAAU;wBACVS,aAAY;wBACZC,gBAAe;;;8BAInB,sBAACX;oBAAIC,WAAU;;sCACb,sBAACD;;8CACC,qBAACY;oCAAMX,WAAU;8CAA+C;;8CAGhE,qBAACY;oCACCC,OAAOnC;oCACPoC,UAAU,CAACxB,IAAMX,WAAWW,EAAEyB,MAAM,CAACF,KAAK;oCAC1Cb,WAAU;oCACVgB,aAAY;oCACZC,MAAM;oCACNC,WAAW;oCACXC,UAAUnC;;8CAEZ,sBAACoC;oCAAEpB,WAAU;;wCACVtB,QAAQ2C,MAAM;wCAAC;;;;;sCAIpB,sBAACtB;;8CACC,qBAACY;oCAAMX,WAAU;8CAA+C;;8CAGhE,qBAACsB;oCACCC,MAAK;oCACLV,OAAOhC;oCACPiC,UAAU,CAACxB,IAAMR,WAAWQ,EAAEyB,MAAM,CAACF,KAAK;oCAC1Cb,WAAU;oCACVgB,aAAY;oCACZE,WAAW;oCACXC,UAAUnC;;8CAEZ,sBAACoC;oCAAEpB,WAAU;;wCACVnB,QAAQwC,MAAM;wCAAC;;;;;;;8BAKtB,sBAACtB;oBAAIC,WAAU;;sCACb,qBAACwB;4BACCvB,SAASzB;4BACT2C,UAAUnC;4BACVgB,WAAU;sCACX;;sCAGD,qBAACwB;4BACCvB,SAASf;4BACTiC,UAAUnC;4BACVgB,WAAU;sCAEThB,SAAS,cAAc;;;;;;;AAMpC;AAWA,SAASyC,kBAAkB,EAAElD,KAAK,EAAEC,OAAO,EAAEkD,MAAM,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,QAAQ,EAA0B;IAC1G,MAAM,CAACC,cAAcC,gBAAgB,GAAGnD,IAAAA,eAAQ,EAAC;IAEjD,MAAMoD,gBAAgB;QACpBD,gBAAgB;QAChB,IAAI;YACF,MAAMJ,UAAUpD,MAAMY,EAAE;YACxBX;QACF,SAAU;YACRuD,gBAAgB;QAClB;IACF;IAEA,MAAME,eAAe;QACnBF,gBAAgB;QAChB,IAAI;YACF,MAAMH,SAASrD,MAAMY,EAAE;YACvBX;QACF,SAAU;YACRuD,gBAAgB;QAClB;IACF;IAEA,MAAMG,eAAe;QACnB,IAAI,CAACC,QAAQ,8EAA8E;YACzF;QACF;QACAJ,gBAAgB;QAChB,IAAI;YACF,MAAMF,SAAStD,MAAMY,EAAE;YACvBX;QACF,SAAU;YACRuD,gBAAgB;QAClB;IACF;IAEA,MAAMK,aAAa;QACjB5D;QACAkD,OAAOnD;IACT;IAEA,sBAAsB;IACtBa,IAAAA,gBAAS,EAAC;QACR,MAAMC,eAAe,CAACC;YACpB,IAAIA,EAAEC,GAAG,KAAK,YAAY,CAACuC,cAAc;gBACvCtD;YACF;QACF;QACAgB,OAAOC,gBAAgB,CAAC,WAAWJ;QACnC,OAAO,IAAMG,OAAOE,mBAAmB,CAAC,WAAWL;IACrD,GAAG;QAACb;QAASsD;KAAa;IAE1B,sBAAsB;IACtB1C,IAAAA,gBAAS,EAAC;QACRO,SAASC,IAAI,CAACC,KAAK,CAACC,QAAQ,GAAG;QAC/B,OAAO;YACLH,SAASC,IAAI,CAACC,KAAK,CAACC,QAAQ,GAAG;QACjC;IACF,GAAG,EAAE;IAEL,qBACE,qBAACC;QACCC,WAAU;QACVC,SAAS,CAAC6B,eAAetD,UAAU0B;kBAEnC,cAAA,sBAACH;YACCC,WAAU;YACVC,SAAS,CAACX,IAAMA,EAAEa,eAAe;;8BAGjC,sBAACJ;oBAAIC,WAAU;;sCACb,qBAACI;4BAAGJ,WAAU;sCAAsC;;sCACpD,qBAACwB;4BACCvB,SAASzB;4BACT2C,UAAUW;4BACV9B,WAAU;4BACVqC,cAAW;sCACZ;;;;8BAMH,sBAACtC;oBAAIC,WAAU;;sCAEb,qBAACD;4BAAIC,WAAU;sCACb,cAAA,qBAACK;gCACCC,KAAK/B,MAAMgC,SAAS;gCACpBC,KAAKjC,MAAMQ,QAAQ,IAAI;gCACvBiB,WAAU;gCACVS,aAAY;gCACZC,gBAAe;;;sCAKnB,sBAACX;4BAAIC,WAAU;;8CACb,sBAACD;;sDACC,qBAACuC;4CAAKtC,WAAU;sDAA4B;;wCAAe;sDAC3D,qBAACsC;4CACCtC,WAAW,CAAC,2CAA2C,EACrDzB,MAAMgE,iBAAiB,KAAK,aACxB,kCACAhE,MAAMgE,iBAAiB,KAAK,aAC5B,oCACA,iCACJ;sDAEDhE,MAAMgE,iBAAiB;;;;gCAG3BhE,MAAMG,OAAO,kBACZ,sBAACqB;;sDACC,qBAACuC;4CAAKtC,WAAU;sDAA4B;;wCAAgB;sDAC5D,qBAACsC;4CAAKtC,WAAU;sDAAiBzB,MAAMG,OAAO;;;;gCAGjDH,MAAMQ,QAAQ,kBACb,sBAACgB;;sDACC,qBAACuC;4CAAKtC,WAAU;sDAA4B;;wCAAiB;sDAC7D,qBAACsC;4CAAKtC,WAAU;sDAAiBzB,MAAMQ,QAAQ;;;;8CAGnD,sBAACgB;;sDACC,qBAACuC;4CAAKtC,WAAU;sDAA4B;;wCAAiB;sDAC7D,sBAACsC;4CAAKtC,WAAU;;gDACb,IAAIwC,KAAKjE,MAAMkE,UAAU,EAAEC,kBAAkB;gDAAG;gDAAI;gDACpD,IAAIF,KAAKjE,MAAMkE,UAAU,EAAEE,kBAAkB;;;;;gCAGjDpE,MAAMqE,YAAY,kBACjB,sBAAC7C;;sDACC,qBAACuC;4CAAKtC,WAAU;sDAA4B;;wCAAkB;sDAC9D,sBAACsC;4CAAKtC,WAAU;;gDACb,IAAIwC,KAAKjE,MAAMqE,YAAY,EAAEF,kBAAkB;gDAAG;gDAAI;gDACtD,IAAIF,KAAKjE,MAAMqE,YAAY,EAAED,kBAAkB;;;;;gCAIrDpE,MAAMsE,iBAAiB,kBACtB,sBAAC9C;;sDACC,qBAACuC;4CAAKtC,WAAU;sDAA4B;;wCAAe;sDAC3D,qBAACsC;4CAAKtC,WAAU;sDAAiBzB,MAAMsE,iBAAiB;;;;;;;;8BAOhE,sBAAC9C;oBAAIC,WAAU;;sCACb,qBAACwB;4BACCvB,SAASmC;4BACTjB,UAAUW;4BACV9B,WAAU;sCACX;;sCAGD,sBAACD;4BAAIC,WAAU;;8CACb,qBAACwB;oCACCvB,SAASiC;oCACTf,UAAUW;oCACV9B,WAAU;8CAET8B,eAAe,kBAAkB;;gCAEnCvD,MAAMgE,iBAAiB,KAAK,4BAC3B,qBAACf;oCACCvB,SAASgC;oCACTd,UAAUW;oCACV9B,WAAU;8CAET8B,eAAe,kBAAkB;;gCAGrCvD,MAAMgE,iBAAiB,KAAK,4BAC3B,qBAACf;oCACCvB,SAAS+B;oCACTb,UAAUW;oCACV9B,WAAU;8CAET8B,eAAe,kBAAkB;;;;;;;;;AAQlD;AAEe,SAAS1D;IACtB,MAAM,CAAC0E,QAAQC,UAAU,GAAGnE,IAAAA,eAAQ,EAAU,EAAE;IAChD,MAAM,CAACoE,SAASC,WAAW,GAAGrE,IAAAA,eAAQ,EAAC;IACvC,MAAM,CAACsE,QAAQC,UAAU,GAAGvE,IAAAA,eAAQ,EAAsC;IAC1E,MAAM,CAACwE,eAAeC,iBAAiB,GAAGzE,IAAAA,eAAQ,EAAe;IACjE,MAAM,CAAC0E,cAAcC,gBAAgB,GAAG3E,IAAAA,eAAQ,EAAe;IAC/D,MAAM,CAAC4E,QAAQC,UAAU,GAAG7E,IAAAA,eAAQ,EAAe,EAAE;IACrD,MAAM,CAAC8E,mBAAmBC,qBAAqB,GAAG/E,IAAAA,eAAQ,EAAC;IAC3D,MAAM,CAACgF,eAAeC,iBAAiB,GAAGjF,IAAAA,eAAQ,EAAM;IACxD,MAAM,CAACkF,gBAAgBC,kBAAkB,GAAGnF,IAAAA,eAAQ,EAAC;IACrD,MAAM,CAACoF,WAAWC,aAAa,GAAGrF,IAAAA,eAAQ,EAAC;IAC3C,MAAM,CAACsF,mBAAmBC,qBAAqB,GAAGvF,IAAAA,eAAQ,EAAC;IAE3D,MAAMwF,WAAWC,IAAAA,kBAAW,EAAC,CAACC,SAAiB/C;QAC7C,MAAMpC,KAAKqD,KAAK+B,GAAG,GAAGC,QAAQ;QAC9Bf,UAAU,CAACgB,OAAS;mBAAIA;gBAAM;oBAAEtF;oBAAImF;oBAAS/C;gBAAK;aAAE;IACtD,GAAG,EAAE;IAEL,MAAMmD,cAAcL,IAAAA,kBAAW,EAAC,CAAClF;QAC/BsE,UAAU,CAACgB,OAASA,KAAKvB,MAAM,CAAC,CAACyB,QAAUA,MAAMxF,EAAE,KAAKA;IAC1D,GAAG,EAAE;IAEL,MAAMyF,qBAAqBP,IAAAA,kBAAW,EAAC;QACrCN,kBAAkB;QAClB,IAAI;YACF,MAAMc,WAAW,MAAMC,MAAM;YAC7B,MAAMC,SAAS,MAAMF,SAASG,IAAI;YAElC,IAAID,OAAOE,OAAO,EAAE;gBAClBpB,iBAAiBkB,OAAOG,IAAI;gBAC5BvB,qBAAqB;YACvB,OAAO;gBACLS,SAAS,kCAAkC;YAC7C;QACF,EAAE,OAAOe,OAAO;YACdC,QAAQD,KAAK,CAAC,+BAA+BA;YAC7Cf,SAAS,kCAAkC;QAC7C,SAAU;YACRL,kBAAkB;QACpB;IACF,GAAG;QAACK;KAAS;IAEb,MAAMiB,cAAchB,IAAAA,kBAAW,EAAC;QAC9BpB,WAAW;QACX,IAAI;YACF,sFAAsF;YACtF,MAAM4B,WAAW,MAAMC,MACrB,CAAC,oCAAoC,EAAE5B,OAAO,mBAAmB,CAAC;YAEpE,MAAM6B,SAAS,MAAMF,SAASG,IAAI;YAElCI,QAAQE,GAAG,CAAC,mBAAmBP;YAE/B,IAAIA,OAAOE,OAAO,EAAE;gBAClBlC,UAAUgC,OAAOG,IAAI,CAACpC,MAAM;gBAC5BsC,QAAQE,GAAG,CAAC,kBAAkBP,OAAOG,IAAI,CAACpC,MAAM,CAACzB,MAAM,EAAE;gBACzD,IAAI0D,OAAOG,IAAI,CAACpC,MAAM,CAACzB,MAAM,GAAG,GAAG;oBACjC+D,QAAQE,GAAG,CAAC,wBAAwB;wBAClCC,KAAKR,OAAOG,IAAI,CAACpC,MAAM,CAAC,EAAE,CAACvC,SAAS;wBACpCiF,cAAcT,OAAOG,IAAI,CAACpC,MAAM,CAAC,EAAE,CAAC0C,YAAY;wBAChDC,MAAMV,OAAOG,IAAI,CAACpC,MAAM,CAAC,EAAE,CAACvC,SAAS,CAACmF,QAAQ,CAAC,sBAAsBX,OAAOG,IAAI,CAACpC,MAAM,CAAC,EAAE,CAACvC,SAAS,CAACmF,QAAQ,CAAC;wBAC9GC,YAAYZ,OAAOG,IAAI,CAACpC,MAAM,CAAC,EAAE,CAACvC,SAAS,CAACmF,QAAQ,CAAC;oBACvD;oBAEA,gCAAgC;oBAChC,MAAME,UAAUb,OAAOG,IAAI,CAACpC,MAAM,CAACI,MAAM,CAAC,CAAC9B,IAAaA,EAAEoE,YAAY,KAAK,MAAMnE,MAAM;oBACvF,MAAMwE,gBAAgBd,OAAOG,IAAI,CAACpC,MAAM,CAACI,MAAM,CAAC,CAAC9B,IAAaA,EAAEoE,YAAY,KAAK,YAAYnE,MAAM;oBACnG+D,QAAQE,GAAG,CAAC,yBAAyB;wBAAEQ,IAAIF;wBAASG,UAAUF;oBAAc;gBAC9E;YACF,OAAO;gBACLzB,SAASW,OAAOI,KAAK,CAACb,OAAO,IAAI,yBAAyB;YAC5D;QACF,EAAE,OAAOa,OAAO;YACdC,QAAQD,KAAK,CAAC,0BAA0BA;YACxCf,SAAS,yBAAyB;QACpC,SAAU;YACRnB,WAAW;QACb;IACF,GAAG;QAACC;QAAQkB;KAAS;IAErBhF,IAAAA,gBAAS,EAAC;QACRiG;IACF,GAAG;QAACA;KAAY;IAEhB;;GAEC,GACDjG,IAAAA,gBAAS,EAAC;QACR,qDAAqD;QACrD,MAAM4G,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;QACxD,MAAMC,kBAAkBH,QAAQC,GAAG,CAACG,6BAA6B;QAEjE,IAAI,CAACL,eAAe,CAACI,iBAAiB;YACpChB,QAAQD,KAAK,CAAC;YACd;QACF;QAEA,MAAMY,WAAWO,IAAAA,wBAAY,EAACN,aAAaI;QAE3C,mCAAmC;QACnC,MAAMG,UAAUR,SACbQ,OAAO,CAAC,kBACRC,EAAE,CACD,oBACA;YACEC,OAAO;YACPC,QAAQ;YACRC,OAAO;QACT,GACA,CAACC;YACCxB,QAAQE,GAAG,CAAC,0BAA0BsB;YAEtC,0DAA0D;YAC1D,IAAIA,QAAQC,SAAS,KAAK,UAAU;gBAClCzC,SAAS,sBAAsB;YACjC,OAAO,IAAIwC,QAAQC,SAAS,KAAK,UAAU;gBACzCzC,SAAS,iBAAiB;YAC5B,OAAO,IAAIwC,QAAQC,SAAS,KAAK,UAAU;gBACzCzC,SAAS,iBAAiB;YAC5B;YAEA,yBAAyB;YACzBiB;YAEA,yDAAyD;YACzD7F,OAAOsH,aAAa,CAAC,IAAIC,YAAY;QACvC,GAEDC,SAAS;QAEZ,kCAAkC;QAClC,OAAO;YACLjB,SAASkB,aAAa,CAACV;QACzB;IACF,GAAG;QAAClB;QAAajB;KAAS;IAE1B,MAAM8C,iBAAiB,OAAO/H,IAAY+F;QACxC,IAAI;YACF,MAAML,WAAW,MAAMC,MAAM,CAAC,kBAAkB,EAAE3F,IAAI,EAAE;gBACtDgI,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CxH,MAAMyH,KAAKC,SAAS,CAACpC;YACvB;YAEA,MAAMH,SAAS,MAAMF,SAASG,IAAI;YAElC,IAAID,OAAOE,OAAO,EAAE;gBAClBb,SAAS,8BAA8B;gBACvC,MAAMiB;YACR,OAAO;gBACLjB,SAASW,OAAOI,KAAK,CAACb,OAAO,IAAI,0BAA0B;YAC7D;QACF,EAAE,OAAOa,OAAO;YACdf,SAAS,0BAA0B;QACrC;IACF;IAEA,MAAMpC,gBAAgB,OAAO7C;QAC3B,IAAI;YACF,MAAM0F,WAAW,MAAMC,MAAM,CAAC,kBAAkB,EAAE3F,GAAG,SAAS,CAAC,EAAE;gBAC/DgI,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CxH,MAAMyH,KAAKC,SAAS,CAAC;oBAAE/E,mBAAmB;gBAAW;YACvD;YAEA,MAAMwC,SAAS,MAAMF,SAASG,IAAI;YAElC,IAAID,OAAOE,OAAO,EAAE;gBAClBb,SAAS,+BAA+B;gBACxC,MAAMiB;gBACN,mDAAmD;gBACnD7F,OAAOsH,aAAa,CAAC,IAAIC,YAAY;YACvC,OAAO;gBACL3C,SAASW,OAAOI,KAAK,CAACb,OAAO,IAAI,2BAA2B;YAC9D;QACF,EAAE,OAAOa,OAAO;YACdf,SAAS,2BAA2B;QACtC;IACF;IAEA,MAAMnC,eAAe,OAAO9C;QAC1B,IAAI;YACF,MAAM0F,WAAW,MAAMC,MAAM,CAAC,kBAAkB,EAAE3F,GAAG,SAAS,CAAC,EAAE;gBAC/DgI,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CxH,MAAMyH,KAAKC,SAAS,CAAC;oBAAE/E,mBAAmB;gBAAW;YACvD;YAEA,MAAMwC,SAAS,MAAMF,SAASG,IAAI;YAElC,IAAID,OAAOE,OAAO,EAAE;gBAClBb,SAAS,+BAA+B;gBACxC,MAAMiB;gBACN,mDAAmD;gBACnD7F,OAAOsH,aAAa,CAAC,IAAIC,YAAY;YACvC,OAAO;gBACL3C,SAASW,OAAOI,KAAK,CAACb,OAAO,IAAI,0BAA0B;YAC7D;QACF,EAAE,OAAOa,OAAO;YACdf,SAAS,0BAA0B;QACrC;IACF;IAEA,MAAMlC,eAAe,OAAO/C;QAC1B,IAAI;YACF,MAAM0F,WAAW,MAAMC,MAAM,CAAC,kBAAkB,EAAE3F,IAAI,EAAE;gBACtDgI,QAAQ;YACV;YAEA,MAAMpC,SAAS,MAAMF,SAASG,IAAI;YAElC,IAAID,OAAOE,OAAO,EAAE;gBAClBb,SAAS,8BAA8B;gBACvC,MAAMiB;gBACN,mDAAmD;gBACnD7F,OAAOsH,aAAa,CAAC,IAAIC,YAAY;YACvC,OAAO;gBACL3C,SAASW,OAAOI,KAAK,CAACb,OAAO,IAAI,0BAA0B;YAC7D;QACF,EAAE,OAAOa,OAAO;YACdf,SAAS,0BAA0B;QACrC;IACF;IAEA,MAAMmD,mBAAmB,OAAOd;QAC9B,MAAMe,QAAQf,MAAM1F,MAAM,CAACyG,KAAK;QAChC,IAAI,CAACA,SAASA,MAAMnG,MAAM,KAAK,GAAG;QAElC4C,aAAa;QACb,IAAIwD,eAAe;QACnB,IAAIC,aAAa;QAEjB,IAAI;YACF,KAAK,MAAMC,QAAQC,MAAMC,IAAI,CAACL,OAAQ;gBACpC,qBAAqB;gBACrB,MAAMM,eAAe;oBAAC;oBAAc;oBAAa;oBAAa;oBAAc;iBAAY;gBACxF,IAAI,CAACA,aAAapC,QAAQ,CAACiC,KAAKpG,IAAI,GAAG;oBACrC6C,SAAS,CAAC,QAAQ,EAAEuD,KAAKI,IAAI,CAAC,mBAAmB,CAAC,EAAE;oBACpDL;oBACA;gBACF;gBAEA,gCAAgC;gBAChC,MAAMM,UAAU,KAAK,OAAO;gBAC5B,IAAIL,KAAKM,IAAI,GAAGD,SAAS;oBACvB5D,SAAS,CAAC,QAAQ,EAAEuD,KAAKI,IAAI,CAAC,2BAA2B,CAAC,EAAE;oBAC5DL;oBACA;gBACF;gBAEA,mBAAmB;gBACnB,MAAMQ,WAAW,IAAIC;gBACrBD,SAASE,MAAM,CAAC,QAAQT;gBACxBO,SAASE,MAAM,CAAC,YAAYf,KAAKC,SAAS,CAAC;oBACzCe,WAAW;oBACX3J,SAAS;oBACTK,UAAU;gBACZ;gBAEA,SAAS;gBACT,MAAM8F,WAAW,MAAMC,MAAM,qBAAqB;oBAChDqC,QAAQ;oBACRvH,MAAMsI;gBACR;gBAEA,MAAMnD,SAAS,MAAMF,SAASG,IAAI;gBAElC,IAAID,OAAOE,OAAO,EAAE;oBAClBwC;gBACF,OAAO;oBACLrD,SAAS,CAAC,iBAAiB,EAAEuD,KAAKI,IAAI,CAAC,EAAE,EAAEhD,OAAOI,KAAK,CAACb,OAAO,EAAE,EAAE;oBACnEoD;gBACF;YACF;YAEA,eAAe;YACf,IAAID,eAAe,GAAG;gBACpBrD,SAAS,CAAC,sBAAsB,EAAEqD,aAAa,MAAM,EAAEA,eAAe,IAAI,MAAM,IAAI,EAAE;gBACtF,MAAMpC;gBACN,mDAAmD;gBACnD7F,OAAOsH,aAAa,CAAC,IAAIC,YAAY;YACvC;YAEA,IAAIW,aAAa,GAAG;gBAClBtD,SAAS,GAAGsD,WAAW,MAAM,EAAEA,aAAa,IAAI,MAAM,GAAG,iBAAiB,CAAC,EAAE;YAC/E;YAEA,mBAAmB;YACnBjB,MAAM1F,MAAM,CAACF,KAAK,GAAG;YACrBsD,qBAAqB;QACvB,EAAE,OAAOgB,OAAO;YACdf,SAAS,iBAAiB;QAC5B,SAAU;YACRH,aAAa;QACf;IACF;IAEA,qBACE,sBAACqE,wBAAW;QAACC,gBAAe;;0BAC1B,sBAACxI;gBAAIC,WAAU;;kCAEb,sBAACD;wBAAIC,WAAU;;0CACb,sBAACD;;kDACC,qBAACyI;wCAAGxI,WAAU;kDAAmC;;kDACjD,qBAACoB;wCAAEpB,WAAU;kDAAqB;;;;0CAEpC,sBAACD;gCAAIC,WAAU;;kDACb,sBAACwB;wCACCvB,SAAS,IAAMkE,qBAAqB,CAACD;wCACrC/C,UAAU6C;wCACVhE,WAAU;;0DAEV,qBAACyI;gDAAIzI,WAAU;gDAAU0I,MAAK;gDAAOC,QAAO;gDAAeC,SAAQ;0DACjE,cAAA,qBAACC;oDAAKC,eAAc;oDAAQC,gBAAe;oDAAQC,aAAa;oDAAGC,GAAE;;;4CACjE;;;kDAGR,sBAACzH;wCACCvB,SAAS2E;wCACTzD,UAAU2C;wCACV9D,WAAU;;0DAEV,qBAACyI;gDAAIzI,WAAU;gDAAU0I,MAAK;gDAAOC,QAAO;gDAAeC,SAAQ;0DACjE,cAAA,qBAACC;oDAAKC,eAAc;oDAAQC,gBAAe;oDAAQC,aAAa;oDAAGC,GAAE;;;4CAEtEnF,iBAAiB,gBAAgB;;;;;;;oBAMvCI,mCACC,sBAACnE;wBAAIC,WAAU;;0CACb,sBAACD;gCAAIC,WAAU;;kDACb,sBAACD;;0DACC,qBAACK;gDAAGJ,WAAU;0DAAsC;;0DACpD,qBAACoB;gDAAEpB,WAAU;0DAA6B;;;;kDAI5C,qBAACwB;wCACCvB,SAAS,IAAMkE,qBAAqB;wCACpCnE,WAAU;kDACX;;;;0CAKH,sBAACD;gCAAIC,WAAU;;kDACb,qBAACsB;wCACCC,MAAK;wCACLpC,IAAG;wCACH+J,QAAQ;wCACRC,QAAO;wCACPrI,UAAUyG;wCACVpG,UAAU6C;wCACVhE,WAAU;;kDAEZ,sBAACW;wCACCyI,SAAQ;wCACRpJ,WAAW,CAAC,eAAe,EAAEgE,YAAY,kCAAkC,IAAI;;0DAE/E,qBAACyE;gDACCzI,WAAU;gDACV0I,MAAK;gDACLC,QAAO;gDACPC,SAAQ;0DAER,cAAA,qBAACC;oDACCC,eAAc;oDACdC,gBAAe;oDACfC,aAAa;oDACbC,GAAE;;;0DAGN,qBAAC7H;gDAAEpB,WAAU;0DACVgE,YAAY,iBAAiB;;0DAEhC,qBAAC5C;gDAAEpB,WAAU;0DAAwB;;;;;;;;oBAS5C0D,qBAAqBE,+BACpB,qBAAC7D;wBAAIC,WAAW,CAAC,sBAAsB,EACrC4D,cAAcyF,OAAO,GACjB,mCACAzF,cAAc0F,UAAU,GACtB,mCACA,8BACN;kCACA,cAAA,sBAACvJ;4BAAIC,WAAU;;8CACb,sBAACD;oCAAIC,WAAU;;sDACb,sBAACD;4CAAIC,WAAU;;gDACZ4D,cAAcyF,OAAO,iBACpB,qBAACZ;oDAAIzI,WAAU;oDAA0B0I,MAAK;oDAAeE,SAAQ;8DACnE,cAAA,qBAACC;wDAAKU,UAAS;wDAAUN,GAAE;wDAAwIO,UAAS;;mEAG9K,qBAACf;oDAAIzI,WAAU;oDAA0B0I,MAAK;oDAAeE,SAAQ;8DACnE,cAAA,qBAACC;wDAAKU,UAAS;wDAAUN,GAAE;wDAAoNO,UAAS;;;8DAG5P,qBAACC;oDAAGzJ,WAAU;8DAA8B;;;;sDAE9C,qBAACoB;4CAAEpB,WAAU;sDAA8B4D,cAAcU,OAAO;;wCAC/DV,cAAc8F,MAAM,kBACnB,sBAAC3J;4CAAIC,WAAU;;8DACb,sBAACD;;wDAAI;wDAAgB6D,cAAc0F,UAAU,GAAG,UAAU;;;gDACzD1F,cAAc0F,UAAU,kBACvB;;sEACE,sBAACvJ;;gEAAI;gEAAS6D,cAAc8F,MAAM,CAACC,UAAU;;;sEAC7C,sBAAC5J;;gEAAI;gEAAM6D,cAAc8F,MAAM,CAACE,MAAM,GAAG,CAAC,EAAE,EAAEhG,cAAc8F,MAAM,CAACG,MAAM,EAAE,GAAG;;;;;;;;;8CAMxF,qBAACrI;oCACCvB,SAAS,IAAM0D,qBAAqB;oCACpC3D,WAAU;8CACX;;;;;kCAQP,sBAACD;wBAAIC,WAAU;;0CACb,qBAACwB;gCACCvB,SAAS,IAAMkD,UAAU;gCACzBnD,WAAW,CAAC,wCAAwC,EAClDkD,WAAW,aACP,iDACA,qCACJ;0CACH;;0CAGD,qBAAC1B;gCACCvB,SAAS,IAAMkD,UAAU;gCACzBnD,WAAW,CAAC,wCAAwC,EAClDkD,WAAW,YACP,iDACA,qCACJ;0CACH;;0CAGD,qBAAC1B;gCACCvB,SAAS,IAAMkD,UAAU;gCACzBnD,WAAW,CAAC,wCAAwC,EAClDkD,WAAW,aACP,iDACA,qCACJ;0CACH;;;;oBAMFF,wBACC,qBAAC8G,6BAAY;wBAACC,OAAO;wBAAGC,SAAS;yBAC/BlH,OAAOzB,MAAM,KAAK,kBACpB,qBAACtB;wBAAIC,WAAU;kCACb,cAAA,sBAACoB;4BAAEpB,WAAU;;gCAAgB;gCAAIkD;gCAAO;;;uCAG1C,qBAACnD;wBAAIC,WAAU;kCACZ8C,OAAOmH,GAAG,CAAC,CAAC1L,sBACX,sBAACwB;gCAECC,WAAU;;kDAGV,sBAACD;wCACCC,WAAU;wCACVC,SAAS,IAAMoD,iBAAiB9E;;0DAEhC,qBAAC8B;gDACCC,KAAK/B,MAAMgC,SAAS;gDACpBC,KAAKjC,MAAMQ,QAAQ,IAAI;gDACvBiB,WAAU;gDACVS,aAAY;gDACZC,gBAAe;gDACfb,OAAO;oDAAEqK,SAAS;oDAASC,SAAS;oDAAGC,YAAY;gDAAU;gDAC7DC,QAAQ,CAAC/K;oDACP,MAAMyB,SAASzB,EAAEyB,MAAM;oDACvBqE,QAAQE,GAAG,CAAC,gCAAgC/G,MAAMgC,SAAS,EAAE;wDAC3D+J,cAAcvJ,OAAOuJ,YAAY;wDACjCC,eAAexJ,OAAOwJ,aAAa;wDACnCC,UAAUzJ,OAAOyJ,QAAQ;oDAC3B;gDACF;gDACAC,SAAS,CAACnL;oDACR,MAAMyB,SAASzB,EAAEyB,MAAM;oDACvBqE,QAAQD,KAAK,CAAC,2BAA2B5G,MAAMgC,SAAS,EAAE;wDACxDiK,UAAUzJ,OAAOyJ,QAAQ;wDACzBF,cAAcvJ,OAAOuJ,YAAY;wDACjCC,eAAexJ,OAAOwJ,aAAa;wDACnCjK,KAAKS,OAAOT,GAAG;wDACfoK,YAAY3J,OAAO2J,UAAU;oDAC/B;oDAEA,kEAAkE;oDAClE,IAAI3J,OAAOuJ,YAAY,KAAK,GAAG;wDAC7BvJ,OAAOlB,KAAK,CAACqK,OAAO,GAAG;wDACvB,MAAMS,SAAS5J,OAAO6J,aAAa;wDACnC,IAAID,UAAU,CAACA,OAAOE,aAAa,CAAC,uBAAuB;4DACzD,MAAM7J,cAAcrB,SAASmL,aAAa,CAAC;4DAC3C9J,YAAYhB,SAAS,GAAG;4DACxBgB,YAAY+J,SAAS,GAAG,CAAC;;;;;;;;0BAQzB,CAAC;4DACDJ,OAAOK,YAAY,CAAChK,aAAaD;wDACnC;oDACF,OAAO;wDACLqE,QAAQ6F,IAAI,CAAC,8CAA8ClK,OAAOuJ,YAAY,EAAE,KAAKvJ,OAAOwJ,aAAa;oDAC3G;gDACF;;0DAEF,qBAACxK;gDAAIC,WAAU;;0DAGf,qBAACD;gDAAIC,WAAU;0DACZzB,MAAMiH,YAAY,KAAK,qBACtB,qBAAClD;oDAAKtC,WAAU;8DAAgB;mEAEhC,qBAACsC;oDAAKtC,WAAU;8DAAkB;;;;;kDAMxC,sBAACD;wCAAIC,WAAU;;0DAEb,sBAACD;;kEACC,qBAACY;wDAAMX,WAAU;kEAA+C;;kEAGhE,qBAACsB;wDACCC,MAAK;wDACLV,OAAOtC,MAAMG,OAAO,IAAI;wDACxBoC,UAAU,CAACxB;4DACT,MAAM4L,aAAa5L,EAAEyB,MAAM,CAACF,KAAK;4DACjCkC,UAAU0B,CAAAA,OAAQA,KAAKwF,GAAG,CAAC7I,CAAAA,IACzBA,EAAEjC,EAAE,KAAKZ,MAAMY,EAAE,GAAG;wEAAE,GAAGiC,CAAC;wEAAE1C,SAASwM;oEAAW,IAAI9J;wDAExD;wDACA+J,QAAQ;4DACN,MAAMjE,eAAe3I,MAAMY,EAAE,EAAE;gEAC7BT,SAASH,MAAMG,OAAO;gEACtBK,UAAUR,MAAMQ,QAAQ;4DAC1B;wDACF;wDACAiC,aAAY;wDACZhB,WAAU;wDACVkB,WAAW;;;;0DAKf,sBAACnB;;kEACC,qBAACY;wDAAMX,WAAU;kEAA+C;;kEAGhE,qBAACsB;wDACCC,MAAK;wDACLV,OAAOtC,MAAMQ,QAAQ,IAAI;wDACzB+B,UAAU,CAACxB;4DACT,MAAM8L,aAAa9L,EAAEyB,MAAM,CAACF,KAAK;4DACjCkC,UAAU0B,CAAAA,OAAQA,KAAKwF,GAAG,CAAC7I,CAAAA,IACzBA,EAAEjC,EAAE,KAAKZ,MAAMY,EAAE,GAAG;wEAAE,GAAGiC,CAAC;wEAAErC,UAAUqM;oEAAW,IAAIhK;wDAEzD;wDACA+J,QAAQ;4DACN,MAAMjE,eAAe3I,MAAMY,EAAE,EAAE;gEAC7BT,SAASH,MAAMG,OAAO;gEACtBK,UAAUR,MAAMQ,QAAQ;4DAC1B;wDACF;wDACAiC,aAAY;wDACZhB,WAAU;wDACVkB,WAAW;;;;0DAKf,sBAACnB;gDAAIC,WAAU;;kEACb,sBAACD;wDAAIC,WAAU;;4DACZzB,MAAMgE,iBAAiB,KAAK,4BAC3B,qBAACf;gEACCvB,SAAS,IAAM+B,cAAczD,MAAMY,EAAE;gEACrCa,WAAU;gEACVqL,OAAM;0EAEN,cAAA,qBAAC5C;oEAAIzI,WAAU;oEAAU0I,MAAK;oEAAeE,SAAQ;8EACnD,cAAA,qBAACC;wEAAKU,UAAS;wEAAUN,GAAE;wEAAqHO,UAAS;;;;4DAI9JjL,MAAMgE,iBAAiB,KAAK,4BAC3B,qBAACf;gEACCvB,SAAS,IAAMgC,aAAa1D,MAAMY,EAAE;gEACpCa,WAAU;gEACVqL,OAAM;0EAEN,cAAA,qBAAC5C;oEAAIzI,WAAU;oEAAU0I,MAAK;oEAAeE,SAAQ;8EACnD,cAAA,qBAACC;wEAAKU,UAAS;wEAAUN,GAAE;wEAAqMO,UAAS;;;;;;kEAKjP,sBAACzJ;wDAAIC,WAAU;;0EACb,qBAACwB;gEACCvB,SAAS,IAAMoD,iBAAiB9E;gEAChCyB,WAAU;gEACVqL,OAAM;0EAEN,cAAA,sBAAC5C;oEAAIzI,WAAU;oEAAU0I,MAAK;oEAAOC,QAAO;oEAAeC,SAAQ;;sFACjE,qBAACC;4EAAKC,eAAc;4EAAQC,gBAAe;4EAAQC,aAAa;4EAAGC,GAAE;;sFACrE,qBAACJ;4EAAKC,eAAc;4EAAQC,gBAAe;4EAAQC,aAAa;4EAAGC,GAAE;;;;;0EAGzE,qBAACzH;gEACCvB,SAAS,IAAMiC,aAAa3D,MAAMY,EAAE;gEACpCa,WAAU;gEACVqL,OAAM;0EAEN,cAAA,qBAAC5C;oEAAIzI,WAAU;oEAAU0I,MAAK;oEAAeE,SAAQ;8EACnD,cAAA,qBAACC;wEAAKU,UAAS;wEAAUN,GAAE;wEAA8MO,UAAS;;;;;;;;0DAO1P,qBAACzJ;gDAAIC,WAAU;0DACb,cAAA,sBAACD;oDAAIC,WAAU;;sEACb,qBAACsC;sEAAM,IAAIE,KAAKjE,MAAMkE,UAAU,EAAEC,kBAAkB;;sEACpD,qBAACJ;4DACCtC,WAAW,CAAC,6CAA6C,EACvDzB,MAAMgE,iBAAiB,KAAK,aACxB,kCACAhE,MAAMgE,iBAAiB,KAAK,aAC5B,oCACA,iCACJ;sEAEDhE,MAAMgE,iBAAiB;;;;;;;;+BAxL3BhE,MAAMY,EAAE;;;;YAoMtBiE,+BACC,qBAAC3B;gBACClD,OAAO6E;gBACP5E,SAAS,IAAM6E,iBAAiB;gBAChC3B,QAAQ6B;gBACR5B,WAAWK;gBACXJ,UAAUK;gBACVJ,UAAUK;;YAKboB,8BACC,qBAAChF;gBACCC,OAAO+E;gBACP9E,SAAS,IAAM+E,gBAAgB;gBAC/B9E,QAAQyI;;0BAKZ,qBAACnH;gBAAIC,WAAU;0BACZwD,OAAOyG,GAAG,CAAC,CAACtF,sBACX,qBAAC2G,YAAK;wBAEJnM,IAAIwF,MAAMxF,EAAE;wBACZmF,SAASK,MAAML,OAAO;wBACtB/C,MAAMoD,MAAMpD,IAAI;wBAChB/C,SAAS,IAAMkG,YAAYC,MAAMxF,EAAE;wBACnCoM,UAAU;uBALL5G,MAAMxF,EAAE;;;;AAWzB"}