201d435461e86c781164e1fe067255b2
/**
 * Security Test: CSRF Protection
 * 
 * Tests that Cross-Site Request Forgery (CSRF) attacks are prevented
 * through proper authentication and origin validation.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
describe('Security: CSRF Protection', ()=>{
    describe('Authentication-based CSRF protection', ()=>{
        it('should require authentication for state-changing operations', ()=>{
            // Next.js API routes with Supabase Auth require valid session tokens
            // This prevents CSRF as attackers cannot forge valid session tokens
            // Example: POST /api/guests requires Authorization header
            // Without valid session, request is rejected with 401
            expect(true).toBe(true); // Documentation test
        });
        it('should validate session tokens on every request', ()=>{
            // Supabase Auth validates session tokens server-side
            // Tokens are stored in HTTP-only cookies (not accessible to JavaScript)
            // This prevents XSS-based token theft
            expect(true).toBe(true); // Documentation test
        });
        it('should use HTTP-only cookies for session storage', ()=>{
            // Session tokens stored in HTTP-only cookies cannot be accessed by JavaScript
            // This prevents XSS attacks from stealing session tokens
            // Cookies are automatically sent with requests (SameSite protection)
            expect(true).toBe(true); // Documentation test
        });
    });
    describe('Origin validation', ()=>{
        it('should validate request origin for API calls', ()=>{
            // Next.js middleware can validate Origin and Referer headers
            // Reject requests from unexpected origins
            const validOrigins = [
                'http://localhost:3000',
                'https://wedding.example.com'
            ];
            const testOrigin = (origin)=>{
                return validOrigins.some((valid)=>origin.startsWith(valid));
            };
            expect(testOrigin('http://localhost:3000')).toBe(true);
            expect(testOrigin('https://wedding.example.com')).toBe(true);
            expect(testOrigin('https://evil.com')).toBe(false);
        });
        it('should reject requests without proper origin', ()=>{
            // Requests without Origin or Referer headers should be rejected
            // for state-changing operations (POST, PUT, DELETE)
            const hasValidOrigin = (request)=>{
                return !!(request.origin || request.referer);
            };
            expect(hasValidOrigin({
                origin: 'http://localhost:3000'
            })).toBe(true);
            expect(hasValidOrigin({
                referer: 'http://localhost:3000'
            })).toBe(true);
            expect(hasValidOrigin({})).toBe(false);
        });
    });
    describe('SameSite cookie protection', ()=>{
        it('should use SameSite=Lax for session cookies', ()=>{
            // Supabase Auth cookies should have SameSite=Lax or SameSite=Strict
            // This prevents cookies from being sent in cross-site requests
            // SameSite=Lax: Cookies sent with top-level navigation (GET)
            // SameSite=Strict: Cookies never sent in cross-site requests
            expect(true).toBe(true); // Documentation test
        });
        it('should not send cookies in cross-origin POST requests', ()=>{
            // With SameSite=Lax, cookies are not sent with cross-origin POST
            // This prevents CSRF attacks that rely on automatic cookie sending
            expect(true).toBe(true); // Documentation test
        });
    });
    describe('State-changing operation protection', ()=>{
        const stateChangingEndpoints = [
            {
                method: 'POST',
                path: '/api/guests'
            },
            {
                method: 'PUT',
                path: '/api/guests/[id]'
            },
            {
                method: 'DELETE',
                path: '/api/guests/[id]'
            },
            {
                method: 'POST',
                path: '/api/rsvp'
            },
            {
                method: 'POST',
                path: '/api/photos/upload'
            },
            {
                method: 'POST',
                path: '/api/email/send'
            },
            {
                method: 'PUT',
                path: '/api/activities/[id]'
            },
            {
                method: 'DELETE',
                path: '/api/activities/[id]'
            }
        ];
        stateChangingEndpoints.forEach(({ method, path })=>{
            it(`should require authentication for ${method} ${path}`, ()=>{
                // All state-changing operations require valid authentication
                // Unauthenticated requests return 401 Unauthorized
                expect(true).toBe(true); // Documentation test
            });
        });
        it('should allow GET requests without CSRF protection', ()=>{
            // GET requests should be idempotent and not change state
            // CSRF protection not required for read-only operations
            const readOnlyMethods = [
                'GET',
                'HEAD',
                'OPTIONS'
            ];
            readOnlyMethods.forEach((method)=>{
                expect([
                    'GET',
                    'HEAD',
                    'OPTIONS'
                ]).toContain(method);
            });
        });
    });
    describe('Double-submit cookie pattern (if implemented)', ()=>{
        it('should validate CSRF token matches cookie value', ()=>{
            // If using double-submit cookie pattern:
            // 1. Server sets CSRF token in cookie
            // 2. Client includes token in request header or body
            // 3. Server validates token matches cookie
            const validateCSRFToken = (cookieToken, requestToken)=>{
                return cookieToken === requestToken && cookieToken.length > 0;
            };
            expect(validateCSRFToken('abc123', 'abc123')).toBe(true);
            expect(validateCSRFToken('abc123', 'xyz789')).toBe(false);
            expect(validateCSRFToken('', '')).toBe(false);
        });
        it('should generate cryptographically secure CSRF tokens', ()=>{
            // CSRF tokens should be:
            // - Cryptographically random
            // - Unique per session
            // - Sufficiently long (at least 128 bits)
            const isValidTokenLength = (token)=>{
                return token.length >= 32; // 128 bits in hex = 32 characters
            };
            expect(isValidTokenLength('a'.repeat(32))).toBe(true);
            expect(isValidTokenLength('a'.repeat(16))).toBe(false);
        });
    });
    describe('Content-Type validation', ()=>{
        it('should validate Content-Type for JSON endpoints', ()=>{
            // Endpoints expecting JSON should validate Content-Type header
            // This prevents simple form-based CSRF attacks
            const isValidContentType = (contentType)=>{
                return contentType.includes('application/json');
            };
            expect(isValidContentType('application/json')).toBe(true);
            expect(isValidContentType('application/json; charset=utf-8')).toBe(true);
            expect(isValidContentType('application/x-www-form-urlencoded')).toBe(false);
            expect(isValidContentType('multipart/form-data')).toBe(false);
        });
        it('should reject requests with unexpected Content-Type', ()=>{
            // Simple forms can only send:
            // - application/x-www-form-urlencoded
            // - multipart/form-data
            // - text/plain
            // 
            // Requiring application/json prevents simple form-based CSRF
            const simpleFormContentTypes = [
                'application/x-www-form-urlencoded',
                'multipart/form-data',
                'text/plain'
            ];
            simpleFormContentTypes.forEach((contentType)=>{
                expect(contentType).not.toBe('application/json');
            });
        });
    });
    describe('Custom request headers', ()=>{
        it('should require custom headers for API requests', ()=>{
            // Custom headers (e.g., X-Requested-With: XMLHttpRequest)
            // cannot be set by simple forms, providing CSRF protection
            const hasCustomHeader = (headers)=>{
                return !!(headers['X-Requested-With'] || headers['X-CSRF-Token']);
            };
            expect(hasCustomHeader({
                'X-Requested-With': 'XMLHttpRequest'
            })).toBe(true);
            expect(hasCustomHeader({
                'X-CSRF-Token': 'abc123'
            })).toBe(true);
            expect(hasCustomHeader({
                'Content-Type': 'application/json'
            })).toBe(false);
        });
    });
    describe('CORS configuration', ()=>{
        it('should restrict CORS to trusted origins', ()=>{
            // CORS headers should only allow requests from trusted origins
            // This prevents cross-origin API access from malicious sites
            const allowedOrigins = [
                'http://localhost:3000',
                'https://wedding.example.com'
            ];
            const isAllowedOrigin = (origin)=>{
                return allowedOrigins.includes(origin);
            };
            expect(isAllowedOrigin('http://localhost:3000')).toBe(true);
            expect(isAllowedOrigin('https://evil.com')).toBe(false);
        });
        it('should not use Access-Control-Allow-Origin: *', ()=>{
            // Wildcard CORS allows any origin to make requests
            // This defeats CSRF protection
            const isWildcardCORS = (origin)=>{
                return origin === '*';
            };
            expect(isWildcardCORS('*')).toBe(true);
            expect(isWildcardCORS('http://localhost:3000')).toBe(false);
        // We should NEVER use wildcard CORS for authenticated endpoints
        });
        it('should include credentials in CORS when needed', ()=>{
            // Access-Control-Allow-Credentials: true
            // Required for cookies to be sent with cross-origin requests
            expect(true).toBe(true); // Documentation test
        });
    });
    describe('Referer validation', ()=>{
        it('should validate Referer header for sensitive operations', ()=>{
            // Referer header indicates the page that initiated the request
            // Should match expected origin for sensitive operations
            const isValidReferer = (referer, expectedOrigin)=>{
                return referer.startsWith(expectedOrigin);
            };
            expect(isValidReferer('http://localhost:3000/admin', 'http://localhost:3000')).toBe(true);
            expect(isValidReferer('https://evil.com/attack', 'http://localhost:3000')).toBe(false);
        });
        it('should handle missing Referer header appropriately', ()=>{
            // Some browsers/privacy tools strip Referer header
            // Should fall back to other CSRF protections (auth token, origin)
            const hasCSRFProtection = (request)=>{
                return !!(request.referer || request.origin || request.auth);
            };
            expect(hasCSRFProtection({
                referer: 'http://localhost:3000'
            })).toBe(true);
            expect(hasCSRFProtection({
                origin: 'http://localhost:3000'
            })).toBe(true);
            expect(hasCSRFProtection({
                auth: 'Bearer token'
            })).toBe(true);
            expect(hasCSRFProtection({})).toBe(false);
        });
    });
    describe('Integration with Supabase Auth', ()=>{
        it('should leverage Supabase session-based authentication', ()=>{
            // Supabase Auth provides built-in CSRF protection through:
            // 1. Session tokens in HTTP-only cookies
            // 2. Token validation on every request
            // 3. Short-lived tokens with refresh mechanism
            expect(true).toBe(true); // Documentation test
        });
        it('should validate session on server-side for all protected routes', ()=>{
            // Every protected API route calls:
            // const { data: { session } } = await supabase.auth.getSession()
            // 
            // This validates the session token and prevents CSRF
            expect(true).toBe(true); // Documentation test
        });
        it('should use secure session token storage', ()=>{
            // Session tokens stored in:
            // - HTTP-only cookies (not accessible to JavaScript)
            // - Secure flag (only sent over HTTPS in production)
            // - SameSite flag (not sent in cross-site requests)
            expect(true).toBe(true); // Documentation test
        });
    });
    describe('CSRF attack scenarios', ()=>{
        it('should prevent malicious form submission from external site', ()=>{
            // Scenario: Attacker creates form on evil.com that POSTs to our API
            // Protection: 
            // - Requires authentication (session token in HTTP-only cookie)
            // - SameSite cookie prevents cookie from being sent
            // - Origin validation rejects cross-origin requests
            expect(true).toBe(true); // Documentation test
        });
        it('should prevent malicious AJAX request from external site', ()=>{
            // Scenario: Attacker uses AJAX from evil.com to call our API
            // Protection:
            // - CORS policy rejects cross-origin requests
            // - Even if CORS allowed, authentication required
            // - Session token not accessible to attacker's JavaScript
            expect(true).toBe(true); // Documentation test
        });
        it('should prevent image tag CSRF attack', ()=>{
            // Scenario: <img src="https://wedding.example.com/api/guests/delete/123">
            // Protection:
            // - GET requests should not change state (idempotent)
            // - State-changing operations use POST/PUT/DELETE
            // - Authentication required for all state changes
            expect(true).toBe(true); // Documentation test
        });
        it('should prevent iframe-based CSRF attack', ()=>{
            // Scenario: Attacker embeds our site in iframe and submits forms
            // Protection:
            // - X-Frame-Options or CSP frame-ancestors prevents embedding
            // - Authentication still required
            // - SameSite cookies prevent cookie sending in iframe context
            expect(true).toBe(true); // Documentation test
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvX190ZXN0c19fL3NlY3VyaXR5L2NzcmYuc2VjdXJpdHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNlY3VyaXR5IFRlc3Q6IENTUkYgUHJvdGVjdGlvblxuICogXG4gKiBUZXN0cyB0aGF0IENyb3NzLVNpdGUgUmVxdWVzdCBGb3JnZXJ5IChDU1JGKSBhdHRhY2tzIGFyZSBwcmV2ZW50ZWRcbiAqIHRocm91Z2ggcHJvcGVyIGF1dGhlbnRpY2F0aW9uIGFuZCBvcmlnaW4gdmFsaWRhdGlvbi5cbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcblxuZGVzY3JpYmUoJ1NlY3VyaXR5OiBDU1JGIFByb3RlY3Rpb24nLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdBdXRoZW50aWNhdGlvbi1iYXNlZCBDU1JGIHByb3RlY3Rpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uIGZvciBzdGF0ZS1jaGFuZ2luZyBvcGVyYXRpb25zJywgKCkgPT4ge1xuICAgICAgLy8gTmV4dC5qcyBBUEkgcm91dGVzIHdpdGggU3VwYWJhc2UgQXV0aCByZXF1aXJlIHZhbGlkIHNlc3Npb24gdG9rZW5zXG4gICAgICAvLyBUaGlzIHByZXZlbnRzIENTUkYgYXMgYXR0YWNrZXJzIGNhbm5vdCBmb3JnZSB2YWxpZCBzZXNzaW9uIHRva2Vuc1xuICAgICAgXG4gICAgICAvLyBFeGFtcGxlOiBQT1NUIC9hcGkvZ3Vlc3RzIHJlcXVpcmVzIEF1dGhvcml6YXRpb24gaGVhZGVyXG4gICAgICAvLyBXaXRob3V0IHZhbGlkIHNlc3Npb24sIHJlcXVlc3QgaXMgcmVqZWN0ZWQgd2l0aCA0MDFcbiAgICAgIFxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIERvY3VtZW50YXRpb24gdGVzdFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBzZXNzaW9uIHRva2VucyBvbiBldmVyeSByZXF1ZXN0JywgKCkgPT4ge1xuICAgICAgLy8gU3VwYWJhc2UgQXV0aCB2YWxpZGF0ZXMgc2Vzc2lvbiB0b2tlbnMgc2VydmVyLXNpZGVcbiAgICAgIC8vIFRva2VucyBhcmUgc3RvcmVkIGluIEhUVFAtb25seSBjb29raWVzIChub3QgYWNjZXNzaWJsZSB0byBKYXZhU2NyaXB0KVxuICAgICAgLy8gVGhpcyBwcmV2ZW50cyBYU1MtYmFzZWQgdG9rZW4gdGhlZnRcbiAgICAgIFxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIERvY3VtZW50YXRpb24gdGVzdFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgSFRUUC1vbmx5IGNvb2tpZXMgZm9yIHNlc3Npb24gc3RvcmFnZScsICgpID0+IHtcbiAgICAgIC8vIFNlc3Npb24gdG9rZW5zIHN0b3JlZCBpbiBIVFRQLW9ubHkgY29va2llcyBjYW5ub3QgYmUgYWNjZXNzZWQgYnkgSmF2YVNjcmlwdFxuICAgICAgLy8gVGhpcyBwcmV2ZW50cyBYU1MgYXR0YWNrcyBmcm9tIHN0ZWFsaW5nIHNlc3Npb24gdG9rZW5zXG4gICAgICAvLyBDb29raWVzIGFyZSBhdXRvbWF0aWNhbGx5IHNlbnQgd2l0aCByZXF1ZXN0cyAoU2FtZVNpdGUgcHJvdGVjdGlvbilcbiAgICAgIFxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIERvY3VtZW50YXRpb24gdGVzdFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnT3JpZ2luIHZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSByZXF1ZXN0IG9yaWdpbiBmb3IgQVBJIGNhbGxzJywgKCkgPT4ge1xuICAgICAgLy8gTmV4dC5qcyBtaWRkbGV3YXJlIGNhbiB2YWxpZGF0ZSBPcmlnaW4gYW5kIFJlZmVyZXIgaGVhZGVyc1xuICAgICAgLy8gUmVqZWN0IHJlcXVlc3RzIGZyb20gdW5leHBlY3RlZCBvcmlnaW5zXG4gICAgICBcbiAgICAgIGNvbnN0IHZhbGlkT3JpZ2lucyA9IFtcbiAgICAgICAgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcsXG4gICAgICAgICdodHRwczovL3dlZGRpbmcuZXhhbXBsZS5jb20nLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgdGVzdE9yaWdpbiA9IChvcmlnaW46IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gdmFsaWRPcmlnaW5zLnNvbWUodmFsaWQgPT4gb3JpZ2luLnN0YXJ0c1dpdGgodmFsaWQpKTtcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdCh0ZXN0T3JpZ2luKCdodHRwOi8vbG9jYWxob3N0OjMwMDAnKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdCh0ZXN0T3JpZ2luKCdodHRwczovL3dlZGRpbmcuZXhhbXBsZS5jb20nKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdCh0ZXN0T3JpZ2luKCdodHRwczovL2V2aWwuY29tJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVxdWVzdHMgd2l0aG91dCBwcm9wZXIgb3JpZ2luJywgKCkgPT4ge1xuICAgICAgLy8gUmVxdWVzdHMgd2l0aG91dCBPcmlnaW4gb3IgUmVmZXJlciBoZWFkZXJzIHNob3VsZCBiZSByZWplY3RlZFxuICAgICAgLy8gZm9yIHN0YXRlLWNoYW5naW5nIG9wZXJhdGlvbnMgKFBPU1QsIFBVVCwgREVMRVRFKVxuICAgICAgXG4gICAgICBjb25zdCBoYXNWYWxpZE9yaWdpbiA9IChyZXF1ZXN0OiB7IG9yaWdpbj86IHN0cmluZzsgcmVmZXJlcj86IHN0cmluZyB9KSA9PiB7XG4gICAgICAgIHJldHVybiAhIShyZXF1ZXN0Lm9yaWdpbiB8fCByZXF1ZXN0LnJlZmVyZXIpO1xuICAgICAgfTtcblxuICAgICAgZXhwZWN0KGhhc1ZhbGlkT3JpZ2luKHsgb3JpZ2luOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyB9KSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChoYXNWYWxpZE9yaWdpbih7IHJlZmVyZXI6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnIH0pKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGhhc1ZhbGlkT3JpZ2luKHt9KSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTYW1lU2l0ZSBjb29raWUgcHJvdGVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVzZSBTYW1lU2l0ZT1MYXggZm9yIHNlc3Npb24gY29va2llcycsICgpID0+IHtcbiAgICAgIC8vIFN1cGFiYXNlIEF1dGggY29va2llcyBzaG91bGQgaGF2ZSBTYW1lU2l0ZT1MYXggb3IgU2FtZVNpdGU9U3RyaWN0XG4gICAgICAvLyBUaGlzIHByZXZlbnRzIGNvb2tpZXMgZnJvbSBiZWluZyBzZW50IGluIGNyb3NzLXNpdGUgcmVxdWVzdHNcbiAgICAgIFxuICAgICAgLy8gU2FtZVNpdGU9TGF4OiBDb29raWVzIHNlbnQgd2l0aCB0b3AtbGV2ZWwgbmF2aWdhdGlvbiAoR0VUKVxuICAgICAgLy8gU2FtZVNpdGU9U3RyaWN0OiBDb29raWVzIG5ldmVyIHNlbnQgaW4gY3Jvc3Mtc2l0ZSByZXF1ZXN0c1xuICAgICAgXG4gICAgICBleHBlY3QodHJ1ZSkudG9CZSh0cnVlKTsgLy8gRG9jdW1lbnRhdGlvbiB0ZXN0XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBzZW5kIGNvb2tpZXMgaW4gY3Jvc3Mtb3JpZ2luIFBPU1QgcmVxdWVzdHMnLCAoKSA9PiB7XG4gICAgICAvLyBXaXRoIFNhbWVTaXRlPUxheCwgY29va2llcyBhcmUgbm90IHNlbnQgd2l0aCBjcm9zcy1vcmlnaW4gUE9TVFxuICAgICAgLy8gVGhpcyBwcmV2ZW50cyBDU1JGIGF0dGFja3MgdGhhdCByZWx5IG9uIGF1dG9tYXRpYyBjb29raWUgc2VuZGluZ1xuICAgICAgXG4gICAgICBleHBlY3QodHJ1ZSkudG9CZSh0cnVlKTsgLy8gRG9jdW1lbnRhdGlvbiB0ZXN0XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdGF0ZS1jaGFuZ2luZyBvcGVyYXRpb24gcHJvdGVjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBzdGF0ZUNoYW5naW5nRW5kcG9pbnRzID0gW1xuICAgICAgeyBtZXRob2Q6ICdQT1NUJywgcGF0aDogJy9hcGkvZ3Vlc3RzJyB9LFxuICAgICAgeyBtZXRob2Q6ICdQVVQnLCBwYXRoOiAnL2FwaS9ndWVzdHMvW2lkXScgfSxcbiAgICAgIHsgbWV0aG9kOiAnREVMRVRFJywgcGF0aDogJy9hcGkvZ3Vlc3RzL1tpZF0nIH0sXG4gICAgICB7IG1ldGhvZDogJ1BPU1QnLCBwYXRoOiAnL2FwaS9yc3ZwJyB9LFxuICAgICAgeyBtZXRob2Q6ICdQT1NUJywgcGF0aDogJy9hcGkvcGhvdG9zL3VwbG9hZCcgfSxcbiAgICAgIHsgbWV0aG9kOiAnUE9TVCcsIHBhdGg6ICcvYXBpL2VtYWlsL3NlbmQnIH0sXG4gICAgICB7IG1ldGhvZDogJ1BVVCcsIHBhdGg6ICcvYXBpL2FjdGl2aXRpZXMvW2lkXScgfSxcbiAgICAgIHsgbWV0aG9kOiAnREVMRVRFJywgcGF0aDogJy9hcGkvYWN0aXZpdGllcy9baWRdJyB9LFxuICAgIF07XG5cbiAgICBzdGF0ZUNoYW5naW5nRW5kcG9pbnRzLmZvckVhY2goKHsgbWV0aG9kLCBwYXRoIH0pID0+IHtcbiAgICAgIGl0KGBzaG91bGQgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiBmb3IgJHttZXRob2R9ICR7cGF0aH1gLCAoKSA9PiB7XG4gICAgICAgIC8vIEFsbCBzdGF0ZS1jaGFuZ2luZyBvcGVyYXRpb25zIHJlcXVpcmUgdmFsaWQgYXV0aGVudGljYXRpb25cbiAgICAgICAgLy8gVW5hdXRoZW50aWNhdGVkIHJlcXVlc3RzIHJldHVybiA0MDEgVW5hdXRob3JpemVkXG4gICAgICAgIFxuICAgICAgICBleHBlY3QodHJ1ZSkudG9CZSh0cnVlKTsgLy8gRG9jdW1lbnRhdGlvbiB0ZXN0XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgR0VUIHJlcXVlc3RzIHdpdGhvdXQgQ1NSRiBwcm90ZWN0aW9uJywgKCkgPT4ge1xuICAgICAgLy8gR0VUIHJlcXVlc3RzIHNob3VsZCBiZSBpZGVtcG90ZW50IGFuZCBub3QgY2hhbmdlIHN0YXRlXG4gICAgICAvLyBDU1JGIHByb3RlY3Rpb24gbm90IHJlcXVpcmVkIGZvciByZWFkLW9ubHkgb3BlcmF0aW9uc1xuICAgICAgXG4gICAgICBjb25zdCByZWFkT25seU1ldGhvZHMgPSBbJ0dFVCcsICdIRUFEJywgJ09QVElPTlMnXTtcbiAgICAgIFxuICAgICAgcmVhZE9ubHlNZXRob2RzLmZvckVhY2gobWV0aG9kID0+IHtcbiAgICAgICAgZXhwZWN0KFsnR0VUJywgJ0hFQUQnLCAnT1BUSU9OUyddKS50b0NvbnRhaW4obWV0aG9kKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRG91YmxlLXN1Ym1pdCBjb29raWUgcGF0dGVybiAoaWYgaW1wbGVtZW50ZWQpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgQ1NSRiB0b2tlbiBtYXRjaGVzIGNvb2tpZSB2YWx1ZScsICgpID0+IHtcbiAgICAgIC8vIElmIHVzaW5nIGRvdWJsZS1zdWJtaXQgY29va2llIHBhdHRlcm46XG4gICAgICAvLyAxLiBTZXJ2ZXIgc2V0cyBDU1JGIHRva2VuIGluIGNvb2tpZVxuICAgICAgLy8gMi4gQ2xpZW50IGluY2x1ZGVzIHRva2VuIGluIHJlcXVlc3QgaGVhZGVyIG9yIGJvZHlcbiAgICAgIC8vIDMuIFNlcnZlciB2YWxpZGF0ZXMgdG9rZW4gbWF0Y2hlcyBjb29raWVcbiAgICAgIFxuICAgICAgY29uc3QgdmFsaWRhdGVDU1JGVG9rZW4gPSAoY29va2llVG9rZW46IHN0cmluZywgcmVxdWVzdFRva2VuOiBzdHJpbmcpID0+IHtcbiAgICAgICAgcmV0dXJuIGNvb2tpZVRva2VuID09PSByZXF1ZXN0VG9rZW4gJiYgY29va2llVG9rZW4ubGVuZ3RoID4gMDtcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdCh2YWxpZGF0ZUNTUkZUb2tlbignYWJjMTIzJywgJ2FiYzEyMycpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlQ1NSRlRva2VuKCdhYmMxMjMnLCAneHl6Nzg5JykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlQ1NSRlRva2VuKCcnLCAnJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjcnlwdG9ncmFwaGljYWxseSBzZWN1cmUgQ1NSRiB0b2tlbnMnLCAoKSA9PiB7XG4gICAgICAvLyBDU1JGIHRva2VucyBzaG91bGQgYmU6XG4gICAgICAvLyAtIENyeXB0b2dyYXBoaWNhbGx5IHJhbmRvbVxuICAgICAgLy8gLSBVbmlxdWUgcGVyIHNlc3Npb25cbiAgICAgIC8vIC0gU3VmZmljaWVudGx5IGxvbmcgKGF0IGxlYXN0IDEyOCBiaXRzKVxuICAgICAgXG4gICAgICBjb25zdCBpc1ZhbGlkVG9rZW5MZW5ndGggPSAodG9rZW46IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gdG9rZW4ubGVuZ3RoID49IDMyOyAvLyAxMjggYml0cyBpbiBoZXggPSAzMiBjaGFyYWN0ZXJzXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoaXNWYWxpZFRva2VuTGVuZ3RoKCdhJy5yZXBlYXQoMzIpKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkVG9rZW5MZW5ndGgoJ2EnLnJlcGVhdCgxNikpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbnRlbnQtVHlwZSB2YWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgQ29udGVudC1UeXBlIGZvciBKU09OIGVuZHBvaW50cycsICgpID0+IHtcbiAgICAgIC8vIEVuZHBvaW50cyBleHBlY3RpbmcgSlNPTiBzaG91bGQgdmFsaWRhdGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgLy8gVGhpcyBwcmV2ZW50cyBzaW1wbGUgZm9ybS1iYXNlZCBDU1JGIGF0dGFja3NcbiAgICAgIFxuICAgICAgY29uc3QgaXNWYWxpZENvbnRlbnRUeXBlID0gKGNvbnRlbnRUeXBlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnRUeXBlLmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoaXNWYWxpZENvbnRlbnRUeXBlKCdhcHBsaWNhdGlvbi9qc29uJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoaXNWYWxpZENvbnRlbnRUeXBlKCdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoaXNWYWxpZENvbnRlbnRUeXBlKCdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKSkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QoaXNWYWxpZENvbnRlbnRUeXBlKCdtdWx0aXBhcnQvZm9ybS1kYXRhJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVxdWVzdHMgd2l0aCB1bmV4cGVjdGVkIENvbnRlbnQtVHlwZScsICgpID0+IHtcbiAgICAgIC8vIFNpbXBsZSBmb3JtcyBjYW4gb25seSBzZW5kOlxuICAgICAgLy8gLSBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcbiAgICAgIC8vIC0gbXVsdGlwYXJ0L2Zvcm0tZGF0YVxuICAgICAgLy8gLSB0ZXh0L3BsYWluXG4gICAgICAvLyBcbiAgICAgIC8vIFJlcXVpcmluZyBhcHBsaWNhdGlvbi9qc29uIHByZXZlbnRzIHNpbXBsZSBmb3JtLWJhc2VkIENTUkZcbiAgICAgIFxuICAgICAgY29uc3Qgc2ltcGxlRm9ybUNvbnRlbnRUeXBlcyA9IFtcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICAgICdtdWx0aXBhcnQvZm9ybS1kYXRhJyxcbiAgICAgICAgJ3RleHQvcGxhaW4nLFxuICAgICAgXTtcblxuICAgICAgc2ltcGxlRm9ybUNvbnRlbnRUeXBlcy5mb3JFYWNoKGNvbnRlbnRUeXBlID0+IHtcbiAgICAgICAgZXhwZWN0KGNvbnRlbnRUeXBlKS5ub3QudG9CZSgnYXBwbGljYXRpb24vanNvbicpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDdXN0b20gcmVxdWVzdCBoZWFkZXJzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBjdXN0b20gaGVhZGVycyBmb3IgQVBJIHJlcXVlc3RzJywgKCkgPT4ge1xuICAgICAgLy8gQ3VzdG9tIGhlYWRlcnMgKGUuZy4sIFgtUmVxdWVzdGVkLVdpdGg6IFhNTEh0dHBSZXF1ZXN0KVxuICAgICAgLy8gY2Fubm90IGJlIHNldCBieSBzaW1wbGUgZm9ybXMsIHByb3ZpZGluZyBDU1JGIHByb3RlY3Rpb25cbiAgICAgIFxuICAgICAgY29uc3QgaGFzQ3VzdG9tSGVhZGVyID0gKGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pID0+IHtcbiAgICAgICAgcmV0dXJuICEhKGhlYWRlcnNbJ1gtUmVxdWVzdGVkLVdpdGgnXSB8fCBoZWFkZXJzWydYLUNTUkYtVG9rZW4nXSk7XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoaGFzQ3VzdG9tSGVhZGVyKHsgJ1gtUmVxdWVzdGVkLVdpdGgnOiAnWE1MSHR0cFJlcXVlc3QnIH0pKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGhhc0N1c3RvbUhlYWRlcih7ICdYLUNTUkYtVG9rZW4nOiAnYWJjMTIzJyB9KSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChoYXNDdXN0b21IZWFkZXIoeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NPUlMgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc3RyaWN0IENPUlMgdG8gdHJ1c3RlZCBvcmlnaW5zJywgKCkgPT4ge1xuICAgICAgLy8gQ09SUyBoZWFkZXJzIHNob3VsZCBvbmx5IGFsbG93IHJlcXVlc3RzIGZyb20gdHJ1c3RlZCBvcmlnaW5zXG4gICAgICAvLyBUaGlzIHByZXZlbnRzIGNyb3NzLW9yaWdpbiBBUEkgYWNjZXNzIGZyb20gbWFsaWNpb3VzIHNpdGVzXG4gICAgICBcbiAgICAgIGNvbnN0IGFsbG93ZWRPcmlnaW5zID0gW1xuICAgICAgICAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyxcbiAgICAgICAgJ2h0dHBzOi8vd2VkZGluZy5leGFtcGxlLmNvbScsXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBpc0FsbG93ZWRPcmlnaW4gPSAob3JpZ2luOiBzdHJpbmcpID0+IHtcbiAgICAgICAgcmV0dXJuIGFsbG93ZWRPcmlnaW5zLmluY2x1ZGVzKG9yaWdpbik7XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoaXNBbGxvd2VkT3JpZ2luKCdodHRwOi8vbG9jYWxob3N0OjMwMDAnKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc0FsbG93ZWRPcmlnaW4oJ2h0dHBzOi8vZXZpbC5jb20nKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCB1c2UgQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luOiAqJywgKCkgPT4ge1xuICAgICAgLy8gV2lsZGNhcmQgQ09SUyBhbGxvd3MgYW55IG9yaWdpbiB0byBtYWtlIHJlcXVlc3RzXG4gICAgICAvLyBUaGlzIGRlZmVhdHMgQ1NSRiBwcm90ZWN0aW9uXG4gICAgICBcbiAgICAgIGNvbnN0IGlzV2lsZGNhcmRDT1JTID0gKG9yaWdpbjogc3RyaW5nKSA9PiB7XG4gICAgICAgIHJldHVybiBvcmlnaW4gPT09ICcqJztcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChpc1dpbGRjYXJkQ09SUygnKicpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzV2lsZGNhcmRDT1JTKCdodHRwOi8vbG9jYWxob3N0OjMwMDAnKSkudG9CZShmYWxzZSk7XG4gICAgICBcbiAgICAgIC8vIFdlIHNob3VsZCBORVZFUiB1c2Ugd2lsZGNhcmQgQ09SUyBmb3IgYXV0aGVudGljYXRlZCBlbmRwb2ludHNcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBjcmVkZW50aWFscyBpbiBDT1JTIHdoZW4gbmVlZGVkJywgKCkgPT4ge1xuICAgICAgLy8gQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHM6IHRydWVcbiAgICAgIC8vIFJlcXVpcmVkIGZvciBjb29raWVzIHRvIGJlIHNlbnQgd2l0aCBjcm9zcy1vcmlnaW4gcmVxdWVzdHNcbiAgICAgIFxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIERvY3VtZW50YXRpb24gdGVzdFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVmZXJlciB2YWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgUmVmZXJlciBoZWFkZXIgZm9yIHNlbnNpdGl2ZSBvcGVyYXRpb25zJywgKCkgPT4ge1xuICAgICAgLy8gUmVmZXJlciBoZWFkZXIgaW5kaWNhdGVzIHRoZSBwYWdlIHRoYXQgaW5pdGlhdGVkIHRoZSByZXF1ZXN0XG4gICAgICAvLyBTaG91bGQgbWF0Y2ggZXhwZWN0ZWQgb3JpZ2luIGZvciBzZW5zaXRpdmUgb3BlcmF0aW9uc1xuICAgICAgXG4gICAgICBjb25zdCBpc1ZhbGlkUmVmZXJlciA9IChyZWZlcmVyOiBzdHJpbmcsIGV4cGVjdGVkT3JpZ2luOiBzdHJpbmcpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlZmVyZXIuc3RhcnRzV2l0aChleHBlY3RlZE9yaWdpbik7XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoaXNWYWxpZFJlZmVyZXIoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hZG1pbicsICdodHRwOi8vbG9jYWxob3N0OjMwMDAnKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkUmVmZXJlcignaHR0cHM6Ly9ldmlsLmNvbS9hdHRhY2snLCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBSZWZlcmVyIGhlYWRlciBhcHByb3ByaWF0ZWx5JywgKCkgPT4ge1xuICAgICAgLy8gU29tZSBicm93c2Vycy9wcml2YWN5IHRvb2xzIHN0cmlwIFJlZmVyZXIgaGVhZGVyXG4gICAgICAvLyBTaG91bGQgZmFsbCBiYWNrIHRvIG90aGVyIENTUkYgcHJvdGVjdGlvbnMgKGF1dGggdG9rZW4sIG9yaWdpbilcbiAgICAgIFxuICAgICAgY29uc3QgaGFzQ1NSRlByb3RlY3Rpb24gPSAocmVxdWVzdDogeyByZWZlcmVyPzogc3RyaW5nOyBvcmlnaW4/OiBzdHJpbmc7IGF1dGg/OiBzdHJpbmcgfSkgPT4ge1xuICAgICAgICByZXR1cm4gISEocmVxdWVzdC5yZWZlcmVyIHx8IHJlcXVlc3Qub3JpZ2luIHx8IHJlcXVlc3QuYXV0aCk7XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoaGFzQ1NSRlByb3RlY3Rpb24oeyByZWZlcmVyOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyB9KSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChoYXNDU1JGUHJvdGVjdGlvbih7IG9yaWdpbjogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcgfSkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoaGFzQ1NSRlByb3RlY3Rpb24oeyBhdXRoOiAnQmVhcmVyIHRva2VuJyB9KSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChoYXNDU1JGUHJvdGVjdGlvbih7fSkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gd2l0aCBTdXBhYmFzZSBBdXRoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbGV2ZXJhZ2UgU3VwYWJhc2Ugc2Vzc2lvbi1iYXNlZCBhdXRoZW50aWNhdGlvbicsICgpID0+IHtcbiAgICAgIC8vIFN1cGFiYXNlIEF1dGggcHJvdmlkZXMgYnVpbHQtaW4gQ1NSRiBwcm90ZWN0aW9uIHRocm91Z2g6XG4gICAgICAvLyAxLiBTZXNzaW9uIHRva2VucyBpbiBIVFRQLW9ubHkgY29va2llc1xuICAgICAgLy8gMi4gVG9rZW4gdmFsaWRhdGlvbiBvbiBldmVyeSByZXF1ZXN0XG4gICAgICAvLyAzLiBTaG9ydC1saXZlZCB0b2tlbnMgd2l0aCByZWZyZXNoIG1lY2hhbmlzbVxuICAgICAgXG4gICAgICBleHBlY3QodHJ1ZSkudG9CZSh0cnVlKTsgLy8gRG9jdW1lbnRhdGlvbiB0ZXN0XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHNlc3Npb24gb24gc2VydmVyLXNpZGUgZm9yIGFsbCBwcm90ZWN0ZWQgcm91dGVzJywgKCkgPT4ge1xuICAgICAgLy8gRXZlcnkgcHJvdGVjdGVkIEFQSSByb3V0ZSBjYWxsczpcbiAgICAgIC8vIGNvbnN0IHsgZGF0YTogeyBzZXNzaW9uIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpXG4gICAgICAvLyBcbiAgICAgIC8vIFRoaXMgdmFsaWRhdGVzIHRoZSBzZXNzaW9uIHRva2VuIGFuZCBwcmV2ZW50cyBDU1JGXG4gICAgICBcbiAgICAgIGV4cGVjdCh0cnVlKS50b0JlKHRydWUpOyAvLyBEb2N1bWVudGF0aW9uIHRlc3RcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIHNlY3VyZSBzZXNzaW9uIHRva2VuIHN0b3JhZ2UnLCAoKSA9PiB7XG4gICAgICAvLyBTZXNzaW9uIHRva2VucyBzdG9yZWQgaW46XG4gICAgICAvLyAtIEhUVFAtb25seSBjb29raWVzIChub3QgYWNjZXNzaWJsZSB0byBKYXZhU2NyaXB0KVxuICAgICAgLy8gLSBTZWN1cmUgZmxhZyAob25seSBzZW50IG92ZXIgSFRUUFMgaW4gcHJvZHVjdGlvbilcbiAgICAgIC8vIC0gU2FtZVNpdGUgZmxhZyAobm90IHNlbnQgaW4gY3Jvc3Mtc2l0ZSByZXF1ZXN0cylcbiAgICAgIFxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIERvY3VtZW50YXRpb24gdGVzdFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ1NSRiBhdHRhY2sgc2NlbmFyaW9zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcHJldmVudCBtYWxpY2lvdXMgZm9ybSBzdWJtaXNzaW9uIGZyb20gZXh0ZXJuYWwgc2l0ZScsICgpID0+IHtcbiAgICAgIC8vIFNjZW5hcmlvOiBBdHRhY2tlciBjcmVhdGVzIGZvcm0gb24gZXZpbC5jb20gdGhhdCBQT1NUcyB0byBvdXIgQVBJXG4gICAgICAvLyBQcm90ZWN0aW9uOiBcbiAgICAgIC8vIC0gUmVxdWlyZXMgYXV0aGVudGljYXRpb24gKHNlc3Npb24gdG9rZW4gaW4gSFRUUC1vbmx5IGNvb2tpZSlcbiAgICAgIC8vIC0gU2FtZVNpdGUgY29va2llIHByZXZlbnRzIGNvb2tpZSBmcm9tIGJlaW5nIHNlbnRcbiAgICAgIC8vIC0gT3JpZ2luIHZhbGlkYXRpb24gcmVqZWN0cyBjcm9zcy1vcmlnaW4gcmVxdWVzdHNcbiAgICAgIFxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIERvY3VtZW50YXRpb24gdGVzdFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IG1hbGljaW91cyBBSkFYIHJlcXVlc3QgZnJvbSBleHRlcm5hbCBzaXRlJywgKCkgPT4ge1xuICAgICAgLy8gU2NlbmFyaW86IEF0dGFja2VyIHVzZXMgQUpBWCBmcm9tIGV2aWwuY29tIHRvIGNhbGwgb3VyIEFQSVxuICAgICAgLy8gUHJvdGVjdGlvbjpcbiAgICAgIC8vIC0gQ09SUyBwb2xpY3kgcmVqZWN0cyBjcm9zcy1vcmlnaW4gcmVxdWVzdHNcbiAgICAgIC8vIC0gRXZlbiBpZiBDT1JTIGFsbG93ZWQsIGF1dGhlbnRpY2F0aW9uIHJlcXVpcmVkXG4gICAgICAvLyAtIFNlc3Npb24gdG9rZW4gbm90IGFjY2Vzc2libGUgdG8gYXR0YWNrZXIncyBKYXZhU2NyaXB0XG4gICAgICBcbiAgICAgIGV4cGVjdCh0cnVlKS50b0JlKHRydWUpOyAvLyBEb2N1bWVudGF0aW9uIHRlc3RcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCBpbWFnZSB0YWcgQ1NSRiBhdHRhY2snLCAoKSA9PiB7XG4gICAgICAvLyBTY2VuYXJpbzogPGltZyBzcmM9XCJodHRwczovL3dlZGRpbmcuZXhhbXBsZS5jb20vYXBpL2d1ZXN0cy9kZWxldGUvMTIzXCI+XG4gICAgICAvLyBQcm90ZWN0aW9uOlxuICAgICAgLy8gLSBHRVQgcmVxdWVzdHMgc2hvdWxkIG5vdCBjaGFuZ2Ugc3RhdGUgKGlkZW1wb3RlbnQpXG4gICAgICAvLyAtIFN0YXRlLWNoYW5naW5nIG9wZXJhdGlvbnMgdXNlIFBPU1QvUFVUL0RFTEVURVxuICAgICAgLy8gLSBBdXRoZW50aWNhdGlvbiByZXF1aXJlZCBmb3IgYWxsIHN0YXRlIGNoYW5nZXNcbiAgICAgIFxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIERvY3VtZW50YXRpb24gdGVzdFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGlmcmFtZS1iYXNlZCBDU1JGIGF0dGFjaycsICgpID0+IHtcbiAgICAgIC8vIFNjZW5hcmlvOiBBdHRhY2tlciBlbWJlZHMgb3VyIHNpdGUgaW4gaWZyYW1lIGFuZCBzdWJtaXRzIGZvcm1zXG4gICAgICAvLyBQcm90ZWN0aW9uOlxuICAgICAgLy8gLSBYLUZyYW1lLU9wdGlvbnMgb3IgQ1NQIGZyYW1lLWFuY2VzdG9ycyBwcmV2ZW50cyBlbWJlZGRpbmdcbiAgICAgIC8vIC0gQXV0aGVudGljYXRpb24gc3RpbGwgcmVxdWlyZWRcbiAgICAgIC8vIC0gU2FtZVNpdGUgY29va2llcyBwcmV2ZW50IGNvb2tpZSBzZW5kaW5nIGluIGlmcmFtZSBjb250ZXh0XG4gICAgICBcbiAgICAgIGV4cGVjdCh0cnVlKS50b0JlKHRydWUpOyAvLyBEb2N1bWVudGF0aW9uIHRlc3RcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0IiwiZXhwZWN0IiwidG9CZSIsInZhbGlkT3JpZ2lucyIsInRlc3RPcmlnaW4iLCJvcmlnaW4iLCJzb21lIiwidmFsaWQiLCJzdGFydHNXaXRoIiwiaGFzVmFsaWRPcmlnaW4iLCJyZXF1ZXN0IiwicmVmZXJlciIsInN0YXRlQ2hhbmdpbmdFbmRwb2ludHMiLCJtZXRob2QiLCJwYXRoIiwiZm9yRWFjaCIsInJlYWRPbmx5TWV0aG9kcyIsInRvQ29udGFpbiIsInZhbGlkYXRlQ1NSRlRva2VuIiwiY29va2llVG9rZW4iLCJyZXF1ZXN0VG9rZW4iLCJsZW5ndGgiLCJpc1ZhbGlkVG9rZW5MZW5ndGgiLCJ0b2tlbiIsInJlcGVhdCIsImlzVmFsaWRDb250ZW50VHlwZSIsImNvbnRlbnRUeXBlIiwiaW5jbHVkZXMiLCJzaW1wbGVGb3JtQ29udGVudFR5cGVzIiwibm90IiwiaGFzQ3VzdG9tSGVhZGVyIiwiaGVhZGVycyIsImFsbG93ZWRPcmlnaW5zIiwiaXNBbGxvd2VkT3JpZ2luIiwiaXNXaWxkY2FyZENPUlMiLCJpc1ZhbGlkUmVmZXJlciIsImV4cGVjdGVkT3JpZ2luIiwiaGFzQ1NSRlByb3RlY3Rpb24iLCJhdXRoIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Q0FLQzs7OztBQUlEQSxTQUFTLDZCQUE2QjtJQUNwQ0EsU0FBUyx3Q0FBd0M7UUFDL0NDLEdBQUcsK0RBQStEO1lBQ2hFLHFFQUFxRTtZQUNyRSxvRUFBb0U7WUFFcEUsMERBQTBEO1lBQzFELHNEQUFzRDtZQUV0REMsT0FBTyxNQUFNQyxJQUFJLENBQUMsT0FBTyxxQkFBcUI7UUFDaEQ7UUFFQUYsR0FBRyxtREFBbUQ7WUFDcEQscURBQXFEO1lBQ3JE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