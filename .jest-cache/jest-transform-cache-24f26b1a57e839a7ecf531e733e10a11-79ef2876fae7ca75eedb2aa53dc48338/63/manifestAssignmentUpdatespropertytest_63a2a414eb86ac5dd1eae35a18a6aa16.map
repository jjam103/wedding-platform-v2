{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/manifestAssignmentUpdates.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { assignGuestsToShuttle, updateFlightInfo } from './transportationService';\n\n// Mock the Supabase module with simpler per-call mocking\njest.mock('@/lib/supabase', () => {\n  const mockChain = {\n    select: jest.fn(),\n    update: jest.fn(),\n    eq: jest.fn(),\n    single: jest.fn(),\n  };\n  \n  return {\n    supabase: {\n      from: jest.fn(() => mockChain),\n    },\n    __mockChain: mockChain,\n  };\n});\n\n/**\n * Feature: destination-wedding-platform, Property 30: Manifest Assignment Updates\n * \n * For any guest with flight information changes, when the flight time is updated,\n * the system should automatically reassign the guest to the appropriate manifest\n * based on the new time window.\n * \n * Validates: Requirements 20.8\n */\ndescribe('Feature: destination-wedding-platform, Property 30: Manifest Assignment Updates', () => {\n  let mockChain: any;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // Get mock chain for configuration\n    const { __mockChain } = require('@/lib/supabase');\n    mockChain = __mockChain;\n  });\n\n  it('should successfully update flight information for any valid guest', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Generate guest ID\n        fc.uuid(),\n        // Generate flight info with undefined for optional fields (not null)\n        fc.record({\n          guest_id: fc.uuid(),\n          airport_code: fc.constantFrom('SJO', 'LIR', 'Other'),\n          flight_number: fc.option(fc.string({ minLength: 4, maxLength: 10 }), { nil: undefined }),\n          airline: fc.option(fc.string({ minLength: 2, maxLength: 50 }), { nil: undefined }),\n          arrival_time: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString()), { nil: undefined }),\n          departure_time: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString()), { nil: undefined }),\n        }),\n        async (guestId, flightInfo) => {\n          // Configure mocks for this iteration using mockReturnValueOnce\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.update.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockResolvedValueOnce({ data: null, error: null });\n\n          const result = await updateFlightInfo(guestId, { \n            ...flightInfo, \n            guest_id: guestId,\n            airport_code: flightInfo.airport_code as 'SJO' | 'LIR' | 'Other',\n          });\n\n          // Property: Update should succeed for valid input\n          expect(result.success).toBe(true);\n\n          // Property: Update should be called with sanitized data\n          expect(mockChain.update).toHaveBeenCalled();\n          expect(mockChain.eq).toHaveBeenCalledWith('id', guestId);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should assign guests to shuttle manifests without duplicates', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Generate manifest ID\n        fc.uuid(),\n        // Generate array of guest IDs\n        fc.array(fc.uuid(), { minLength: 1, maxLength: 20 }),\n        async (manifestId, guestIds) => {\n          // Mock current manifest with some existing guests\n          const existingGuestIds = fc.sample(fc.array(fc.uuid(), { minLength: 0, maxLength: 5 }), 1)[0];\n          \n          // Configure mocks for this iteration\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockReturnValueOnce(mockChain);\n          mockChain.single.mockResolvedValueOnce({\n            data: { guest_ids: existingGuestIds },\n            error: null,\n          });\n          \n          mockChain.update.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockResolvedValueOnce({ data: null, error: null });\n\n          const result = await assignGuestsToShuttle(manifestId, guestIds);\n\n          // Property: Assignment should succeed\n          expect(result.success).toBe(true);\n\n          // Property: Update should be called\n          expect(mockChain.update).toHaveBeenCalled();\n\n          // Verify the update was called with merged guest IDs\n          const updateCall = mockChain.update.mock.calls[mockChain.update.mock.calls.length - 1][0];\n          if (updateCall && updateCall.guest_ids) {\n            // Property: No duplicate guest IDs\n            const uniqueIds = new Set(updateCall.guest_ids);\n            expect(updateCall.guest_ids.length).toBe(uniqueIds.size);\n\n            // Property: All new guests should be included\n            for (const guestId of guestIds) {\n              expect(updateCall.guest_ids).toContain(guestId);\n            }\n\n            // Property: All existing guests should be preserved\n            for (const existingId of existingGuestIds) {\n              expect(updateCall.guest_ids).toContain(existingId);\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle empty guest assignment gracefully', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        async (manifestId) => {\n          // Configure mocks for this iteration\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockReturnValueOnce(mockChain);\n          mockChain.single.mockResolvedValueOnce({\n            data: { guest_ids: [] },\n            error: null,\n          });\n          \n          mockChain.update.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockResolvedValueOnce({ data: null, error: null });\n\n          const result = await assignGuestsToShuttle(manifestId, []);\n\n          // Property: Should succeed even with empty array\n          expect(result.success).toBe(true);\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should preserve existing assignments when adding new guests', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        fc.array(fc.uuid(), { minLength: 1, maxLength: 10 }),\n        fc.array(fc.uuid(), { minLength: 1, maxLength: 10 }),\n        async (manifestId, existingGuests, newGuests) => {\n          // Ensure no overlap for this test\n          const uniqueExisting = Array.from(new Set(existingGuests));\n          const uniqueNew = Array.from(new Set(newGuests.filter(id => !uniqueExisting.includes(id))));\n\n          // Skip if no new guests to add (all were filtered out)\n          if (uniqueNew.length === 0) {\n            return; // Property doesn't apply when there are no new guests\n          }\n\n          // Configure mocks for this iteration\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockReturnValueOnce(mockChain);\n          mockChain.single.mockResolvedValueOnce({\n            data: { guest_ids: uniqueExisting },\n            error: null,\n          });\n          \n          mockChain.update.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockResolvedValueOnce({ data: null, error: null });\n\n          const result = await assignGuestsToShuttle(manifestId, uniqueNew);\n\n          expect(result.success).toBe(true);\n\n          if (mockChain.update.mock.calls.length > 0) {\n            const updateCall = mockChain.update.mock.calls[mockChain.update.mock.calls.length - 1][0];\n            if (updateCall && updateCall.guest_ids) {\n              // Property: All existing guests should still be present\n              for (const existingId of uniqueExisting) {\n                expect(updateCall.guest_ids).toContain(existingId);\n              }\n\n              // Property: All new guests should be added\n              for (const newId of uniqueNew) {\n                expect(updateCall.guest_ids).toContain(newId);\n              }\n\n              // Property: Total count should be sum of unique guests\n              const expectedCount = new Set([...uniqueExisting, ...uniqueNew]).size;\n              expect(updateCall.guest_ids.length).toBe(expectedCount);\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle database errors gracefully', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        fc.array(fc.uuid(), { minLength: 1, maxLength: 5 }),\n        async (manifestId, guestIds) => {\n          // Configure mocks for this iteration - simulate database error\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockReturnValueOnce(mockChain);\n          mockChain.single.mockResolvedValueOnce({\n            data: null,\n            error: { message: 'Database connection failed' },\n          });\n\n          const result = await assignGuestsToShuttle(manifestId, guestIds);\n\n          // Property: Should return error result\n          expect(result.success).toBe(false);\n\n          if (!result.success) {\n            expect(result.error.code).toBe('DATABASE_ERROR');\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should sanitize flight information before updating', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        fc.record({\n          guest_id: fc.uuid(),\n          airport_code: fc.constantFrom('SJO', 'LIR', 'Other'),\n          // Generate short alphanumeric strings so total length with payload stays under max(20)\n          flight_number: fc.option(fc.hexaString({ minLength: 4, maxLength: 8 }), { nil: undefined }),\n          airline: fc.option(fc.string({ minLength: 2, maxLength: 20 }).filter(s => /^[A-Za-z ]+$/.test(s)).map(s => `${s}<img src=x onerror=alert(1)>`), { nil: undefined }),\n          arrival_time: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString()), { nil: undefined }),\n          departure_time: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString()), { nil: undefined }),\n        }),\n        async (guestId, flightInfo) => {\n          // Configure mocks for this iteration\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.update.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockResolvedValueOnce({ data: null, error: null });\n          \n          const result = await updateFlightInfo(guestId, { \n            ...flightInfo, \n            guest_id: guestId,\n            airport_code: flightInfo.airport_code as 'SJO' | 'LIR' | 'Other',\n          });\n\n          expect(result.success).toBe(true);\n\n          // Property: Malicious content should be sanitized\n          if (mockChain.update.mock.calls.length > 0) {\n            const updateCall = mockChain.update.mock.calls[mockChain.update.mock.calls.length - 1][0];\n            \n            if (updateCall.airline) {\n              expect(updateCall.airline).not.toContain('<img');\n              expect(updateCall.airline).not.toContain('onerror');\n              expect(updateCall.airline).not.toContain('alert');\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain idempotency when assigning same guests multiple times', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        fc.array(fc.uuid(), { minLength: 1, maxLength: 10 }),\n        async (manifestId, guestIds) => {\n          const uniqueGuestIds = Array.from(new Set(guestIds));\n\n          // First assignment - empty manifest\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockReturnValueOnce(mockChain);\n          mockChain.single.mockResolvedValueOnce({\n            data: { guest_ids: [] },\n            error: null,\n          });\n          mockChain.update.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockResolvedValueOnce({ data: null, error: null });\n\n          const result1 = await assignGuestsToShuttle(manifestId, uniqueGuestIds);\n          expect(result1.success).toBe(true);\n\n          // Second assignment with same guests - manifest now has those guests\n          mockChain.select.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockReturnValueOnce(mockChain);\n          mockChain.single.mockResolvedValueOnce({\n            data: { guest_ids: uniqueGuestIds },\n            error: null,\n          });\n          mockChain.update.mockReturnValueOnce(mockChain);\n          mockChain.eq.mockResolvedValueOnce({ data: null, error: null });\n\n          const result2 = await assignGuestsToShuttle(manifestId, uniqueGuestIds);\n          expect(result2.success).toBe(true);\n\n          // Property: Assigning same guests twice should not duplicate\n          if (mockChain.update.mock.calls.length > 1) {\n            const lastUpdateCall = mockChain.update.mock.calls[mockChain.update.mock.calls.length - 1][0];\n            if (lastUpdateCall && lastUpdateCall.guest_ids) {\n              const uniqueCount = new Set(lastUpdateCall.guest_ids).size;\n              expect(lastUpdateCall.guest_ids.length).toBe(uniqueCount);\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["jest","mock","mockChain","select","fn","update","eq","single","supabase","from","__mockChain","describe","beforeEach","clearAllMocks","require","it","fc","assert","asyncProperty","uuid","record","guest_id","airport_code","constantFrom","flight_number","option","string","minLength","maxLength","nil","undefined","airline","arrival_time","date","min","Date","max","map","d","toISOString","departure_time","guestId","flightInfo","mockReturnValueOnce","mockResolvedValueOnce","data","error","result","updateFlightInfo","expect","success","toBe","toHaveBeenCalled","toHaveBeenCalledWith","numRuns","array","manifestId","guestIds","existingGuestIds","sample","guest_ids","assignGuestsToShuttle","updateCall","calls","length","uniqueIds","Set","size","toContain","existingId","existingGuests","newGuests","uniqueExisting","Array","uniqueNew","filter","id","includes","newId","expectedCount","message","code","hexaString","s","test","not","uniqueGuestIds","result1","result2","lastUpdateCall","uniqueCount"],"mappings":";AAGA,yDAAyD;AACzDA,KAAKC,IAAI,CAAC,kBAAkB;IAC1B,MAAMC,YAAY;QAChBC,QAAQH,KAAKI,EAAE;QACfC,QAAQL,KAAKI,EAAE;QACfE,IAAIN,KAAKI,EAAE;QACXG,QAAQP,KAAKI,EAAE;IACjB;IAEA,OAAO;QACLI,UAAU;YACRC,MAAMT,KAAKI,EAAE,CAAC,IAAMF;QACtB;QACAQ,aAAaR;IACf;AACF;;;;mEAlBoB;uCACoC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmBxD;;;;;;;;CAQC,GACDS,SAAS,mFAAmF;IAC1F,IAAIT;IAEJU,WAAW;QACTZ,KAAKa,aAAa;QAClB,mCAAmC;QACnC,MAAM,EAAEH,WAAW,EAAE,GAAGI,QAAQ;QAChCZ,YAAYQ;IACd;IAEAK,GAAG,qEAAqE;QACtE,MAAMC,WAAGC,MAAM,CACbD,WAAGE,aAAa,CACd,oBAAoB;QACpBF,WAAGG,IAAI,IACP,qEAAqE;QACrEH,WAAGI,MAAM,CAAC;YACRC,UAAUL,WAAGG,IAAI;YACjBG,cAAcN,WAAGO,YAAY,CAAC,OAAO,OAAO;YAC5CC,eAAeR,WAAGS,MAAM,CAACT,WAAGU,MAAM,CAAC;gBAAEC,WAAW;gBAAGC,WAAW;YAAG,IAAI;gBAAEC,KAAKC;YAAU;YACtFC,SAASf,WAAGS,MAAM,CAACT,WAAGU,MAAM,CAAC;gBAAEC,WAAW;gBAAGC,WAAW;YAAG,IAAI;gBAAEC,KAAKC;YAAU;YAChFE,cAAchB,WAAGS,MAAM,CAACT,WAAGiB,IAAI,CAAC;gBAAEC,KAAK,IAAIC,KAAK;gBAAeC,KAAK,IAAID,KAAK;YAAc,GAAGE,GAAG,CAACC,CAAAA,IAAKA,EAAEC,WAAW,KAAK;gBAAEV,KAAKC;YAAU;YAC1IU,gBAAgBxB,WAAGS,MAAM,CAACT,WAAGiB,IAAI,CAAC;gBAAEC,KAAK,IAAIC,KAAK;gBAAeC,KAAK,IAAID,KAAK;YAAc,GAAGE,GAAG,CAACC,CAAAA,IAAKA,EAAEC,WAAW,KAAK;gBAAEV,KAAKC;YAAU;QAC9I,IACA,OAAOW,SAASC;YACd,+DAA+D;YAC/DxC,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUG,MAAM,CAACsC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACsC,qBAAqB,CAAC;gBAAEC,MAAM;gBAAMC,OAAO;YAAK;YAE7D,MAAMC,SAAS,MAAMC,IAAAA,uCAAgB,EAACP,SAAS;gBAC7C,GAAGC,UAAU;gBACbrB,UAAUoB;gBACVnB,cAAcoB,WAAWpB,YAAY;YACvC;YAEA,kDAAkD;YAClD2B,OAAOF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAE5B,wDAAwD;YACxDF,OAAO/C,UAAUG,MAAM,EAAE+C,gBAAgB;YACzCH,OAAO/C,UAAUI,EAAE,EAAE+C,oBAAoB,CAAC,MAAMZ;QAClD,IAEF;YAAEa,SAAS;QAAI;IAEnB;IAEAvC,GAAG,gEAAgE;QACjE,MAAMC,WAAGC,MAAM,CACbD,WAAGE,aAAa,CACd,uBAAuB;QACvBF,WAAGG,IAAI,IACP,8BAA8B;QAC9BH,WAAGuC,KAAK,CAACvC,WAAGG,IAAI,IAAI;YAAEQ,WAAW;YAAGC,WAAW;QAAG,IAClD,OAAO4B,YAAYC;YACjB,kDAAkD;YAClD,MAAMC,mBAAmB1C,WAAG2C,MAAM,CAAC3C,WAAGuC,KAAK,CAACvC,WAAGG,IAAI,IAAI;gBAAEQ,WAAW;gBAAGC,WAAW;YAAE,IAAI,EAAE,CAAC,EAAE;YAE7F,qCAAqC;YACrC1B,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACqC,mBAAmB,CAACzC;YACjCA,UAAUK,MAAM,CAACqC,qBAAqB,CAAC;gBACrCC,MAAM;oBAAEe,WAAWF;gBAAiB;gBACpCZ,OAAO;YACT;YAEA5C,UAAUG,MAAM,CAACsC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACsC,qBAAqB,CAAC;gBAAEC,MAAM;gBAAMC,OAAO;YAAK;YAE7D,MAAMC,SAAS,MAAMc,IAAAA,4CAAqB,EAACL,YAAYC;YAEvD,sCAAsC;YACtCR,OAAOF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAE5B,oCAAoC;YACpCF,OAAO/C,UAAUG,MAAM,EAAE+C,gBAAgB;YAEzC,qDAAqD;YACrD,MAAMU,aAAa5D,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAAC7D,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAACC,MAAM,GAAG,EAAE,CAAC,EAAE;YACzF,IAAIF,cAAcA,WAAWF,SAAS,EAAE;gBACtC,mCAAmC;gBACnC,MAAMK,YAAY,IAAIC,IAAIJ,WAAWF,SAAS;gBAC9CX,OAAOa,WAAWF,SAAS,CAACI,MAAM,EAAEb,IAAI,CAACc,UAAUE,IAAI;gBAEvD,8CAA8C;gBAC9C,KAAK,MAAM1B,WAAWgB,SAAU;oBAC9BR,OAAOa,WAAWF,SAAS,EAAEQ,SAAS,CAAC3B;gBACzC;gBAEA,oDAAoD;gBACpD,KAAK,MAAM4B,cAAcX,iBAAkB;oBACzCT,OAAOa,WAAWF,SAAS,EAAEQ,SAAS,CAACC;gBACzC;YACF;QACF,IAEF;YAAEf,SAAS;QAAI;IAEnB;IAEAvC,GAAG,mDAAmD;QACpD,MAAMC,WAAGC,MAAM,CACbD,WAAGE,aAAa,CACdF,WAAGG,IAAI,IACP,OAAOqC;YACL,qCAAqC;YACrCtD,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACqC,mBAAmB,CAACzC;YACjCA,UAAUK,MAAM,CAACqC,qBAAqB,CAAC;gBACrCC,MAAM;oBAAEe,WAAW,EAAE;gBAAC;gBACtBd,OAAO;YACT;YAEA5C,UAAUG,MAAM,CAACsC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACsC,qBAAqB,CAAC;gBAAEC,MAAM;gBAAMC,OAAO;YAAK;YAE7D,MAAMC,SAAS,MAAMc,IAAAA,4CAAqB,EAACL,YAAY,EAAE;YAEzD,iDAAiD;YACjDP,OAAOF,OAAOG,OAAO,EAAEC,IAAI,CAAC;QAC9B,IAEF;YAAEG,SAAS;QAAG;IAElB;IAEAvC,GAAG,+DAA+D;QAChE,MAAMC,WAAGC,MAAM,CACbD,WAAGE,aAAa,CACdF,WAAGG,IAAI,IACPH,WAAGuC,KAAK,CAACvC,WAAGG,IAAI,IAAI;YAAEQ,WAAW;YAAGC,WAAW;QAAG,IAClDZ,WAAGuC,KAAK,CAACvC,WAAGG,IAAI,IAAI;YAAEQ,WAAW;YAAGC,WAAW;QAAG,IAClD,OAAO4B,YAAYc,gBAAgBC;YACjC,kCAAkC;YAClC,MAAMC,iBAAiBC,MAAMhE,IAAI,CAAC,IAAIyD,IAAII;YAC1C,MAAMI,YAAYD,MAAMhE,IAAI,CAAC,IAAIyD,IAAIK,UAAUI,MAAM,CAACC,CAAAA,KAAM,CAACJ,eAAeK,QAAQ,CAACD;YAErF,uDAAuD;YACvD,IAAIF,UAAUV,MAAM,KAAK,GAAG;gBAC1B,QAAQ,sDAAsD;YAChE;YAEA,qCAAqC;YACrC9D,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACqC,mBAAmB,CAACzC;YACjCA,UAAUK,MAAM,CAACqC,qBAAqB,CAAC;gBACrCC,MAAM;oBAAEe,WAAWY;gBAAe;gBAClC1B,OAAO;YACT;YAEA5C,UAAUG,MAAM,CAACsC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACsC,qBAAqB,CAAC;gBAAEC,MAAM;gBAAMC,OAAO;YAAK;YAE7D,MAAMC,SAAS,MAAMc,IAAAA,4CAAqB,EAACL,YAAYkB;YAEvDzB,OAAOF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAE5B,IAAIjD,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAACC,MAAM,GAAG,GAAG;gBAC1C,MAAMF,aAAa5D,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAAC7D,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAACC,MAAM,GAAG,EAAE,CAAC,EAAE;gBACzF,IAAIF,cAAcA,WAAWF,SAAS,EAAE;oBACtC,wDAAwD;oBACxD,KAAK,MAAMS,cAAcG,eAAgB;wBACvCvB,OAAOa,WAAWF,SAAS,EAAEQ,SAAS,CAACC;oBACzC;oBAEA,2CAA2C;oBAC3C,KAAK,MAAMS,SAASJ,UAAW;wBAC7BzB,OAAOa,WAAWF,SAAS,EAAEQ,SAAS,CAACU;oBACzC;oBAEA,uDAAuD;oBACvD,MAAMC,gBAAgB,IAAIb,IAAI;2BAAIM;2BAAmBE;qBAAU,EAAEP,IAAI;oBACrElB,OAAOa,WAAWF,SAAS,CAACI,MAAM,EAAEb,IAAI,CAAC4B;gBAC3C;YACF;QACF,IAEF;YAAEzB,SAAS;QAAI;IAEnB;IAEAvC,GAAG,4CAA4C;QAC7C,MAAMC,WAAGC,MAAM,CACbD,WAAGE,aAAa,CACdF,WAAGG,IAAI,IACPH,WAAGuC,KAAK,CAACvC,WAAGG,IAAI,IAAI;YAAEQ,WAAW;YAAGC,WAAW;QAAE,IACjD,OAAO4B,YAAYC;YACjB,+DAA+D;YAC/DvD,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACqC,mBAAmB,CAACzC;YACjCA,UAAUK,MAAM,CAACqC,qBAAqB,CAAC;gBACrCC,MAAM;gBACNC,OAAO;oBAAEkC,SAAS;gBAA6B;YACjD;YAEA,MAAMjC,SAAS,MAAMc,IAAAA,4CAAqB,EAACL,YAAYC;YAEvD,uCAAuC;YACvCR,OAAOF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAE5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,OAAOF,OAAOD,KAAK,CAACmC,IAAI,EAAE9B,IAAI,CAAC;YACjC;QACF,IAEF;YAAEG,SAAS;QAAG;IAElB;IAEAvC,GAAG,sDAAsD;QACvD,MAAMC,WAAGC,MAAM,CACbD,WAAGE,aAAa,CACdF,WAAGG,IAAI,IACPH,WAAGI,MAAM,CAAC;YACRC,UAAUL,WAAGG,IAAI;YACjBG,cAAcN,WAAGO,YAAY,CAAC,OAAO,OAAO;YAC5C,uFAAuF;YACvFC,eAAeR,WAAGS,MAAM,CAACT,WAAGkE,UAAU,CAAC;gBAAEvD,WAAW;gBAAGC,WAAW;YAAE,IAAI;gBAAEC,KAAKC;YAAU;YACzFC,SAASf,WAAGS,MAAM,CAACT,WAAGU,MAAM,CAAC;gBAAEC,WAAW;gBAAGC,WAAW;YAAG,GAAG+C,MAAM,CAACQ,CAAAA,IAAK,eAAeC,IAAI,CAACD,IAAI9C,GAAG,CAAC8C,CAAAA,IAAK,GAAGA,EAAE,4BAA4B,CAAC,GAAG;gBAAEtD,KAAKC;YAAU;YACjKE,cAAchB,WAAGS,MAAM,CAACT,WAAGiB,IAAI,CAAC;gBAAEC,KAAK,IAAIC,KAAK;gBAAeC,KAAK,IAAID,KAAK;YAAc,GAAGE,GAAG,CAACC,CAAAA,IAAKA,EAAEC,WAAW,KAAK;gBAAEV,KAAKC;YAAU;YAC1IU,gBAAgBxB,WAAGS,MAAM,CAACT,WAAGiB,IAAI,CAAC;gBAAEC,KAAK,IAAIC,KAAK;gBAAeC,KAAK,IAAID,KAAK;YAAc,GAAGE,GAAG,CAACC,CAAAA,IAAKA,EAAEC,WAAW,KAAK;gBAAEV,KAAKC;YAAU;QAC9I,IACA,OAAOW,SAASC;YACd,qCAAqC;YACrCxC,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUG,MAAM,CAACsC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACsC,qBAAqB,CAAC;gBAAEC,MAAM;gBAAMC,OAAO;YAAK;YAE7D,MAAMC,SAAS,MAAMC,IAAAA,uCAAgB,EAACP,SAAS;gBAC7C,GAAGC,UAAU;gBACbrB,UAAUoB;gBACVnB,cAAcoB,WAAWpB,YAAY;YACvC;YAEA2B,OAAOF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAE5B,kDAAkD;YAClD,IAAIjD,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAACC,MAAM,GAAG,GAAG;gBAC1C,MAAMF,aAAa5D,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAAC7D,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAACC,MAAM,GAAG,EAAE,CAAC,EAAE;gBAEzF,IAAIF,WAAW/B,OAAO,EAAE;oBACtBkB,OAAOa,WAAW/B,OAAO,EAAEsD,GAAG,CAACjB,SAAS,CAAC;oBACzCnB,OAAOa,WAAW/B,OAAO,EAAEsD,GAAG,CAACjB,SAAS,CAAC;oBACzCnB,OAAOa,WAAW/B,OAAO,EAAEsD,GAAG,CAACjB,SAAS,CAAC;gBAC3C;YACF;QACF,IAEF;YAAEd,SAAS;QAAI;IAEnB;IAEAvC,GAAG,yEAAyE;QAC1E,MAAMC,WAAGC,MAAM,CACbD,WAAGE,aAAa,CACdF,WAAGG,IAAI,IACPH,WAAGuC,KAAK,CAACvC,WAAGG,IAAI,IAAI;YAAEQ,WAAW;YAAGC,WAAW;QAAG,IAClD,OAAO4B,YAAYC;YACjB,MAAM6B,iBAAiBb,MAAMhE,IAAI,CAAC,IAAIyD,IAAIT;YAE1C,oCAAoC;YACpCvD,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACqC,mBAAmB,CAACzC;YACjCA,UAAUK,MAAM,CAACqC,qBAAqB,CAAC;gBACrCC,MAAM;oBAAEe,WAAW,EAAE;gBAAC;gBACtBd,OAAO;YACT;YACA5C,UAAUG,MAAM,CAACsC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACsC,qBAAqB,CAAC;gBAAEC,MAAM;gBAAMC,OAAO;YAAK;YAE7D,MAAMyC,UAAU,MAAM1B,IAAAA,4CAAqB,EAACL,YAAY8B;YACxDrC,OAAOsC,QAAQrC,OAAO,EAAEC,IAAI,CAAC;YAE7B,qEAAqE;YACrEjD,UAAUC,MAAM,CAACwC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACqC,mBAAmB,CAACzC;YACjCA,UAAUK,MAAM,CAACqC,qBAAqB,CAAC;gBACrCC,MAAM;oBAAEe,WAAW0B;gBAAe;gBAClCxC,OAAO;YACT;YACA5C,UAAUG,MAAM,CAACsC,mBAAmB,CAACzC;YACrCA,UAAUI,EAAE,CAACsC,qBAAqB,CAAC;gBAAEC,MAAM;gBAAMC,OAAO;YAAK;YAE7D,MAAM0C,UAAU,MAAM3B,IAAAA,4CAAqB,EAACL,YAAY8B;YACxDrC,OAAOuC,QAAQtC,OAAO,EAAEC,IAAI,CAAC;YAE7B,6DAA6D;YAC7D,IAAIjD,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAACC,MAAM,GAAG,GAAG;gBAC1C,MAAMyB,iBAAiBvF,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAAC7D,UAAUG,MAAM,CAACJ,IAAI,CAAC8D,KAAK,CAACC,MAAM,GAAG,EAAE,CAAC,EAAE;gBAC7F,IAAIyB,kBAAkBA,eAAe7B,SAAS,EAAE;oBAC9C,MAAM8B,cAAc,IAAIxB,IAAIuB,eAAe7B,SAAS,EAAEO,IAAI;oBAC1DlB,OAAOwC,eAAe7B,SAAS,CAACI,MAAM,EAAEb,IAAI,CAACuC;gBAC/C;YACF;QACF,IAEF;YAAEpC,SAAS;QAAI;IAEnB;AACF"}