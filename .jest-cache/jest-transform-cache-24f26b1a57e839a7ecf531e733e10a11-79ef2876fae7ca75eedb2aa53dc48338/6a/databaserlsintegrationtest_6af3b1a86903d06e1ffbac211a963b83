33ae91f9de15b7bdb858e973c6b25bb9
/**
 * Database RLS Policy Integration Tests
 * 
 * Tests that RLS policies don't have infinite recursion and work correctly.
 * These tests use the real Supabase instance to verify database-level behavior.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _supabasejs = require("@supabase/supabase-js");
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
describe('Database RLS Policies', ()=>{
    let supabase;
    beforeAll(()=>{
        supabase = (0, _supabasejs.createClient)(supabaseUrl, supabaseAnonKey);
    });
    describe('guests table', ()=>{
        it('should query guests without infinite recursion', async ()=>{
            const { data, error } = await supabase.from('guests').select('count');
            expect(error).toBeNull();
            expect(data).toBeDefined();
        });
        it('should query guests with filters without infinite recursion', async ()=>{
            const { data, error } = await supabase.from('guests').select('*').limit(10);
            // RLS policies should block unauthenticated access
            // This test verifies no infinite recursion occurs (which would cause timeout/crash)
            // Data may be null or empty array depending on RLS policy implementation
            expect(error).toBeNull();
            expect(data !== undefined).toBe(true);
        });
    });
    describe('groups table', ()=>{
        it('should query groups without infinite recursion', async ()=>{
            const { data, error } = await supabase.from('groups').select('count');
            expect(error).toBeNull();
            expect(data).toBeDefined();
        });
        it('should query groups with select without infinite recursion', async ()=>{
            const { data, error } = await supabase.from('groups').select('id, name').limit(10);
            // RLS policies should block unauthenticated access
            // This test verifies no infinite recursion occurs (which would cause timeout/crash)
            // Data may be null or empty array depending on RLS policy implementation
            expect(error).toBeNull();
            expect(data !== undefined).toBe(true);
        });
    });
    describe('group_members table', ()=>{
        it('should query group_members without infinite recursion', async ()=>{
            const { data, error } = await supabase.from('group_members').select('count');
            expect(error).toBeNull();
            expect(data).toBeDefined();
        });
    });
    describe('activities table', ()=>{
        it('should query activities without infinite recursion', async ()=>{
            const { data, error } = await supabase.from('activities').select('count');
            expect(error).toBeNull();
            expect(data).toBeDefined();
        });
    });
    describe('events table', ()=>{
        it('should query events without infinite recursion', async ()=>{
            const { data, error } = await supabase.from('events').select('count');
            expect(error).toBeNull();
            expect(data).toBeDefined();
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvX190ZXN0c19fL2ludGVncmF0aW9uL2RhdGFiYXNlLXJscy5pbnRlZ3JhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGF0YWJhc2UgUkxTIFBvbGljeSBJbnRlZ3JhdGlvbiBUZXN0c1xuICogXG4gKiBUZXN0cyB0aGF0IFJMUyBwb2xpY2llcyBkb24ndCBoYXZlIGluZmluaXRlIHJlY3Vyc2lvbiBhbmQgd29yayBjb3JyZWN0bHkuXG4gKiBUaGVzZSB0ZXN0cyB1c2UgdGhlIHJlYWwgU3VwYWJhc2UgaW5zdGFuY2UgdG8gdmVyaWZ5IGRhdGFiYXNlLWxldmVsIGJlaGF2aW9yLlxuICovXG5cbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMITtcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZITtcblxuZGVzY3JpYmUoJ0RhdGFiYXNlIFJMUyBQb2xpY2llcycsICgpID0+IHtcbiAgbGV0IHN1cGFiYXNlOiBSZXR1cm5UeXBlPHR5cGVvZiBjcmVhdGVDbGllbnQ+O1xuXG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdndWVzdHMgdGFibGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBxdWVyeSBndWVzdHMgd2l0aG91dCBpbmZpbml0ZSByZWN1cnNpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdndWVzdHMnKS5zZWxlY3QoJ2NvdW50Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChlcnJvcikudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBxdWVyeSBndWVzdHMgd2l0aCBmaWx0ZXJzIHdpdGhvdXQgaW5maW5pdGUgcmVjdXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2d1ZXN0cycpXG4gICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAubGltaXQoMTApO1xuICAgICAgXG4gICAgICAvLyBSTFMgcG9saWNpZXMgc2hvdWxkIGJsb2NrIHVuYXV0aGVudGljYXRlZCBhY2Nlc3NcbiAgICAgIC8vIFRoaXMgdGVzdCB2ZXJpZmllcyBubyBpbmZpbml0ZSByZWN1cnNpb24gb2NjdXJzICh3aGljaCB3b3VsZCBjYXVzZSB0aW1lb3V0L2NyYXNoKVxuICAgICAgLy8gRGF0YSBtYXkgYmUgbnVsbCBvciBlbXB0eSBhcnJheSBkZXBlbmRpbmcgb24gUkxTIHBvbGljeSBpbXBsZW1lbnRhdGlvblxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGRhdGEgIT09IHVuZGVmaW5lZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dyb3VwcyB0YWJsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHF1ZXJ5IGdyb3VwcyB3aXRob3V0IGluZmluaXRlIHJlY3Vyc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ2dyb3VwcycpLnNlbGVjdCgnY291bnQnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHF1ZXJ5IGdyb3VwcyB3aXRoIHNlbGVjdCB3aXRob3V0IGluZmluaXRlIHJlY3Vyc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdncm91cHMnKVxuICAgICAgICAuc2VsZWN0KCdpZCwgbmFtZScpXG4gICAgICAgIC5saW1pdCgxMCk7XG4gICAgICBcbiAgICAgIC8vIFJMUyBwb2xpY2llcyBzaG91bGQgYmxvY2sgdW5hdXRoZW50aWNhdGVkIGFjY2Vzc1xuICAgICAgLy8gVGhpcyB0ZXN0IHZlcmlmaWVzIG5vIGluZmluaXRlIHJlY3Vyc2lvbiBvY2N1cnMgKHdoaWNoIHdvdWxkIGNhdXNlIHRpbWVvdXQvY3Jhc2gpXG4gICAgICAvLyBEYXRhIG1heSBiZSBudWxsIG9yIGVtcHR5IGFycmF5IGRlcGVuZGluZyBvbiBSTFMgcG9saWN5IGltcGxlbWVudGF0aW9uXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QoZGF0YSAhPT0gdW5kZWZpbmVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ3JvdXBfbWVtYmVycyB0YWJsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHF1ZXJ5IGdyb3VwX21lbWJlcnMgd2l0aG91dCBpbmZpbml0ZSByZWN1cnNpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdncm91cF9tZW1iZXJzJykuc2VsZWN0KCdjb3VudCcpO1xuICAgICAgXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QoZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FjdGl2aXRpZXMgdGFibGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBxdWVyeSBhY3Rpdml0aWVzIHdpdGhvdXQgaW5maW5pdGUgcmVjdXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnYWN0aXZpdGllcycpLnNlbGVjdCgnY291bnQnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmVudHMgdGFibGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBxdWVyeSBldmVudHMgd2l0aG91dCBpbmZpbml0ZSByZWN1cnNpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdldmVudHMnKS5zZWxlY3QoJ2NvdW50Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChlcnJvcikudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVzY3JpYmUiLCJzdXBhYmFzZSIsImJlZm9yZUFsbCIsImNyZWF0ZUNsaWVudCIsIml0IiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImV4cGVjdCIsInRvQmVOdWxsIiwidG9CZURlZmluZWQiLCJsaW1pdCIsInVuZGVmaW5lZCIsInRvQmUiXSwibWFwcGluZ3MiOiJBQUFBOzs7OztDQUtDOzs7OzRCQUU0QjtBQUU3QixNQUFNQSxjQUFjQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QjtBQUN4RCxNQUFNQyxrQkFBa0JILFFBQVFDLEdBQUcsQ0FBQ0csNkJBQTZCO0FBRWpFQyxTQUFTLHlCQUF5QjtJQUNoQyxJQUFJQztJQUVKQyxVQUFVO1FBQ1JELFdBQVdFLElBQUFBLHdCQUFZLEVBQUNULGFBQWFJO0lBQ3ZDO0lBRUFFLFNBQVMsZ0JBQWdCO1FBQ3ZCSSxHQUFHLGtEQUFrRDtZQUNuRCxNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUwsU0FBU00sSUFBSSxDQUFDLFVBQVVDLE1BQU0sQ0FBQztZQUU3REMsT0FBT0gsT0FBT0ksUUFBUTtZQUN0QkQsT0FBT0osTUFBTU0sV0FBVztRQUMxQjtRQUVBUCxHQUFHLCtEQUErRDtZQUNoRSxNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUwsU0FDM0JNLElBQUksQ0FBQyxVQUNMQyxNQUFNLENBQUMsS0FDUEksS0FBSyxDQUFDO1lBRVQsbURBQW1EO1lBQ25ELG9GQUFvRjtZQUNwRix5RUFBeUU7WUFDekVILE9BQU9ILE9BQU9JLFFBQVE7WUFDdEJELE9BQU9KLFNBQVNRLFdBQVdDLElBQUksQ0FBQztRQUNsQztJQUNGO0lBRUFkLFNBQVMsZ0JBQWdCO1FBQ3ZCSSxHQUFHLGtEQUFrRDtZQUNuRCxNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUwsU0FBU00sSUFBSSxDQUFDLFVBQVVDLE1BQU0sQ0FBQztZQUU3REMsT0FBT0gsT0FBT0ksUUFBUTtZQUN0QkQsT0FBT0osTUFBTU0sV0FBVztRQUMxQjtRQUVBUCxHQUFHLDhEQUE4RDtZQUMvRCxNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUwsU0FDM0JNLElBQUksQ0FBQyxVQUNMQyxNQUFNLENBQUMsWUFDUEksS0FBSyxDQUFDO1lBRVQsbURBQW1EO1lBQ25ELG9GQUFvRjtZQUNwRix5RUFBeUU7WUFDekVILE9BQU9ILE9BQU9JLFFBQVE7WUFDdEJELE9BQU9KLFNBQVNRLFdBQVdDLElBQUksQ0FBQztRQUNsQztJQUNGO0lBRUFkLFNBQVMsdUJBQXVCO1FBQzlCSSxHQUFHLHlEQUF5RDtZQUMxRCxNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUwsU0FBU00sSUFBSSxDQUFDLGlCQUFpQkMsTUFBTSxDQUFDO1lBRXBFQyxPQUFPSCxPQUFPSSxRQUFRO1lBQ3RCRCxPQUFPSixNQUFNTSxXQUFXO1FBQzFCO0lBQ0Y7SUFFQVgsU0FBUyxvQkFBb0I7UUFDM0JJLEdBQUcsc0RBQXNEO1lBQ3ZELE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNTCxTQUFTTSxJQUFJLENBQUMsY0FBY0MsTUFBTSxDQUFDO1lBRWpFQyxPQUFPSCxPQUFPSSxRQUFRO1lBQ3RCRCxPQUFPSixNQUFNTSxXQUFXO1FBQzFCO0lBQ0Y7SUFFQVgsU0FBUyxnQkFBZ0I7UUFDdkJJLEdBQUcsa0RBQWtEO1lBQ25ELE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNTCxTQUFTTSxJQUFJLENBQUMsVUFBVUMsTUFBTSxDQUFDO1lBRTdEQyxPQUFPSCxPQUFPSSxRQUFRO1lBQ3RCRCxPQUFPSixNQUFNTSxXQUFXO1FBQzFCO0lBQ0Y7QUFDRiJ9