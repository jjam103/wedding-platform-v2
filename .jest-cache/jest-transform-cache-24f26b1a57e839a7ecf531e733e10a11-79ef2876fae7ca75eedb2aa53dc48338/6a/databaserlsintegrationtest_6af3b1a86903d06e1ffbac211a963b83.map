{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/database-rls.integration.test.ts"],"sourcesContent":["/**\n * Database RLS Policy Integration Tests\n * \n * Tests that RLS policies don't have infinite recursion and work correctly.\n * These tests use the real Supabase instance to verify database-level behavior.\n */\n\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\ndescribe('Database RLS Policies', () => {\n  let supabase: ReturnType<typeof createClient>;\n\n  beforeAll(() => {\n    supabase = createClient(supabaseUrl, supabaseAnonKey);\n  });\n\n  describe('guests table', () => {\n    it('should query guests without infinite recursion', async () => {\n      const { data, error } = await supabase.from('guests').select('count');\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should query guests with filters without infinite recursion', async () => {\n      const { data, error } = await supabase\n        .from('guests')\n        .select('*')\n        .limit(10);\n      \n      // RLS policies should block unauthenticated access\n      // This test verifies no infinite recursion occurs (which would cause timeout/crash)\n      // Data may be null or empty array depending on RLS policy implementation\n      expect(error).toBeNull();\n      expect(data !== undefined).toBe(true);\n    });\n  });\n\n  describe('groups table', () => {\n    it('should query groups without infinite recursion', async () => {\n      const { data, error } = await supabase.from('groups').select('count');\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should query groups with select without infinite recursion', async () => {\n      const { data, error } = await supabase\n        .from('groups')\n        .select('id, name')\n        .limit(10);\n      \n      // RLS policies should block unauthenticated access\n      // This test verifies no infinite recursion occurs (which would cause timeout/crash)\n      // Data may be null or empty array depending on RLS policy implementation\n      expect(error).toBeNull();\n      expect(data !== undefined).toBe(true);\n    });\n  });\n\n  describe('group_members table', () => {\n    it('should query group_members without infinite recursion', async () => {\n      const { data, error } = await supabase.from('group_members').select('count');\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n  });\n\n  describe('activities table', () => {\n    it('should query activities without infinite recursion', async () => {\n      const { data, error } = await supabase.from('activities').select('count');\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n  });\n\n  describe('events table', () => {\n    it('should query events without infinite recursion', async () => {\n      const { data, error } = await supabase.from('events').select('count');\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n  });\n});\n"],"names":["supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","describe","supabase","beforeAll","createClient","it","data","error","from","select","expect","toBeNull","toBeDefined","limit","undefined","toBe"],"mappings":"AAAA;;;;;CAKC;;;;4BAE4B;AAE7B,MAAMA,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;AACxD,MAAMC,kBAAkBH,QAAQC,GAAG,CAACG,6BAA6B;AAEjEC,SAAS,yBAAyB;IAChC,IAAIC;IAEJC,UAAU;QACRD,WAAWE,IAAAA,wBAAY,EAACT,aAAaI;IACvC;IAEAE,SAAS,gBAAgB;QACvBI,GAAG,kDAAkD;YACnD,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAML,SAASM,IAAI,CAAC,UAAUC,MAAM,CAAC;YAE7DC,OAAOH,OAAOI,QAAQ;YACtBD,OAAOJ,MAAMM,WAAW;QAC1B;QAEAP,GAAG,+DAA+D;YAChE,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAML,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC,KACPI,KAAK,CAAC;YAET,mDAAmD;YACnD,oFAAoF;YACpF,yEAAyE;YACzEH,OAAOH,OAAOI,QAAQ;YACtBD,OAAOJ,SAASQ,WAAWC,IAAI,CAAC;QAClC;IACF;IAEAd,SAAS,gBAAgB;QACvBI,GAAG,kDAAkD;YACnD,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAML,SAASM,IAAI,CAAC,UAAUC,MAAM,CAAC;YAE7DC,OAAOH,OAAOI,QAAQ;YACtBD,OAAOJ,MAAMM,WAAW;QAC1B;QAEAP,GAAG,8DAA8D;YAC/D,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAML,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC,YACPI,KAAK,CAAC;YAET,mDAAmD;YACnD,oFAAoF;YACpF,yEAAyE;YACzEH,OAAOH,OAAOI,QAAQ;YACtBD,OAAOJ,SAASQ,WAAWC,IAAI,CAAC;QAClC;IACF;IAEAd,SAAS,uBAAuB;QAC9BI,GAAG,yDAAyD;YAC1D,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAML,SAASM,IAAI,CAAC,iBAAiBC,MAAM,CAAC;YAEpEC,OAAOH,OAAOI,QAAQ;YACtBD,OAAOJ,MAAMM,WAAW;QAC1B;IACF;IAEAX,SAAS,oBAAoB;QAC3BI,GAAG,sDAAsD;YACvD,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAML,SAASM,IAAI,CAAC,cAAcC,MAAM,CAAC;YAEjEC,OAAOH,OAAOI,QAAQ;YACtBD,OAAOJ,MAAMM,WAAW;QAC1B;IACF;IAEAX,SAAS,gBAAgB;QACvBI,GAAG,kDAAkD;YACnD,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAML,SAASM,IAAI,CAAC,UAAUC,MAAM,CAAC;YAE7DC,OAAOH,OAAOI,QAAQ;YACtBD,OAAOJ,MAAMM,WAAW;QAC1B;IACF;AACF"}