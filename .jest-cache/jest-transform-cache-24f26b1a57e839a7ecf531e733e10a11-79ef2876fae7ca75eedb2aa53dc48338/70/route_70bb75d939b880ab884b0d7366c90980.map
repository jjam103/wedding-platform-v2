{"version":3,"names":["cov_1f6qqso2hu","actualCoverage","s","GET","request","f","auth","_apiAuth","getAuthenticatedUser","b","_server","NextResponse","json","success","error","code","message","status","user","supabase","data","guest","guestError","from","select","eq","email","single","events","eventsError","or","guest_type","order","ascending","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/events/list/route.ts"],"sourcesContent":["import { getAuthenticatedUser } from '@/lib/apiAuth';\nimport { NextResponse } from 'next/server';\n\n/**\n * GET /api/guest/events/list\n * \n * Retrieves all published events visible to the authenticated guest.\n * \n * Requirements: 13.6, 6.1-6.8\n */\nexport async function GET(request: Request) {\n  try {\n    const auth = await getAuthenticatedUser();\n    \n    if (!auth) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    const { user, supabase } = auth;\n    \n    // Get guest information\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, guest_type')\n      .eq('email', user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'GUEST_NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // Fetch published events visible to this guest type\n    const { data: events, error: eventsError } = await supabase\n      .from('events')\n      .select('*')\n      .eq('status', 'published')\n      .or(`visibility.cs.{${guest.guest_type}},visibility.eq.{}`)\n      .order('start_date', { ascending: true });\n    \n    if (eventsError) {\n      return NextResponse.json(\n        { success: false, error: { code: 'DATABASE_ERROR', message: eventsError.message } },\n        { status: 500 }\n      );\n    }\n    \n    return NextResponse.json({ success: true, data: events || [] });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}