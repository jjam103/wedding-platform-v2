{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/csvExportValidity.property.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\nimport * as fc from 'fast-check';\nimport { exportToCSV } from './guestService';\nimport type { Guest } from '@/schemas/guestSchemas';\n\n/**\n * Feature: destination-wedding-platform, Property 23: CSV Export Validity\n * \n * For any set of guest data, exporting to CSV should produce a valid CSV file\n * with proper headers, correct field delimiters, and properly escaped values.\n * \n * Validates: Requirements 20.2\n */\ndescribe('Feature: destination-wedding-platform, Property 23: CSV Export Validity', () => {\n  // Expected CSV headers in correct order\n  const EXPECTED_HEADERS = [\n    'groupId',\n    'firstName',\n    'lastName',\n    'email',\n    'phone',\n    'ageType',\n    'guestType',\n    'dietaryRestrictions',\n    'plusOneName',\n    'plusOneAttending',\n    'arrivalDate',\n    'departureDate',\n    'airportCode',\n    'flightNumber',\n    'invitationSent',\n    'invitationSentDate',\n    'rsvpDeadline',\n    'notes',\n  ];\n\n  // Generator for valid guest data\n  const guestArbitrary: fc.Arbitrary<Guest> = fc.record({\n    id: fc.uuid(),\n    groupId: fc.uuid(),\n    firstName: fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0),\n    lastName: fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0),\n    email: fc.option(fc.emailAddress(), { nil: null }),\n    phone: fc.option(fc.string({ minLength: 10, maxLength: 20 }), { nil: null }),\n    ageType: fc.constantFrom('adult', 'child', 'senior') as fc.Arbitrary<'adult' | 'child' | 'senior'>,\n    guestType: fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0),\n    dietaryRestrictions: fc.option(fc.string({ maxLength: 200 }), { nil: null }),\n    plusOneName: fc.option(fc.string({ minLength: 1, maxLength: 100 }), { nil: null }),\n    plusOneAttending: fc.boolean(),\n    arrivalDate: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    departureDate: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    airportCode: fc.option(fc.constantFrom('SJO', 'LIR', 'Other'), { nil: null }) as fc.Arbitrary<'SJO' | 'LIR' | 'Other' | null>,\n    flightNumber: fc.option(fc.string({ minLength: 4, maxLength: 10 }), { nil: null }),\n    invitationSent: fc.boolean(),\n    invitationSentDate: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    rsvpDeadline: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    notes: fc.option(fc.string({ maxLength: 500 }), { nil: null }),\n    createdAt: fc.date().map(d => d.toISOString()),\n    updatedAt: fc.date().map(d => d.toISOString()),\n  });\n\n  // Generator for guests with special characters that need escaping\n  const guestWithSpecialCharsArbitrary: fc.Arbitrary<Guest> = fc.record({\n    id: fc.uuid(),\n    groupId: fc.uuid(),\n    firstName: fc.oneof(\n      fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0),\n      fc.constant('María'),\n      fc.constant('José'),\n      fc.constant('O\\'Brien')\n    ),\n    lastName: fc.oneof(\n      fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0),\n      fc.constant('García'),\n      fc.constant('Müller'),\n      fc.constant('D\\'Angelo')\n    ),\n    email: fc.option(fc.emailAddress(), { nil: null }),\n    phone: fc.option(fc.string({ minLength: 10, maxLength: 20 }), { nil: null }),\n    ageType: fc.constantFrom('adult', 'child', 'senior') as fc.Arbitrary<'adult' | 'child' | 'senior'>,\n    guestType: fc.string({ minLength: 1, maxLength: 50 }).filter(s => s.trim().length > 0),\n    dietaryRestrictions: fc.option(\n      fc.oneof(\n        fc.string({ maxLength: 200 }),\n        fc.constant('No dairy, no nuts'),\n        fc.constant('Gluten-free, vegan'),\n        fc.constant('Allergic to \"shellfish\"')\n      ),\n      { nil: null }\n    ),\n    plusOneName: fc.option(fc.string({ minLength: 1, maxLength: 100 }), { nil: null }),\n    plusOneAttending: fc.boolean(),\n    arrivalDate: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    departureDate: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    airportCode: fc.option(fc.constantFrom('SJO', 'LIR', 'Other'), { nil: null }) as fc.Arbitrary<'SJO' | 'LIR' | 'Other' | null>,\n    flightNumber: fc.option(fc.string({ minLength: 4, maxLength: 10 }), { nil: null }),\n    invitationSent: fc.boolean(),\n    invitationSentDate: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    rsvpDeadline: fc.option(fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-31') }).map(d => d.toISOString().split('T')[0]), { nil: null }),\n    notes: fc.option(\n      fc.oneof(\n        fc.string({ maxLength: 500 }),\n        fc.constant('Needs wheelchair access, arriving early'),\n        fc.constant('Prefers \"vegetarian\" meals'),\n        fc.constant('Contact via email, not phone')\n      ),\n      { nil: null }\n    ),\n    createdAt: fc.date().map(d => d.toISOString()),\n    updatedAt: fc.date().map(d => d.toISOString()),\n  });\n\n  it('should produce CSV with proper header row for any guest array', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestArbitrary, { minLength: 0, maxLength: 50 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Should have at least header row\n          expect(lines.length).toBeGreaterThanOrEqual(1);\n\n          // First line should be the header\n          const headerLine = lines[0];\n          expect(headerLine).toBe(EXPECTED_HEADERS.join(','));\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should produce correct number of data rows for any guest array', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestArbitrary, { minLength: 0, maxLength: 50 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Should have header + one row per guest\n          expect(lines.length).toBe(guests.length + 1);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should properly escape fields containing commas', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestWithSpecialCharsArbitrary, { minLength: 1, maxLength: 20 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          // Check that fields with commas are properly quoted\n          const csvContent = result.data;\n          \n          guests.forEach(guest => {\n            if (guest.dietaryRestrictions && guest.dietaryRestrictions.includes(',')) {\n              // Field with comma should be wrapped in quotes\n              // If it also contains quotes, those should be doubled\n              const escaped = guest.dietaryRestrictions.replace(/\"/g, '\"\"');\n              expect(csvContent).toContain(`\"${escaped}\"`);\n            }\n            if (guest.notes && guest.notes.includes(',')) {\n              // Field with comma should be wrapped in quotes\n              // If it also contains quotes, those should be doubled\n              const escaped = guest.notes.replace(/\"/g, '\"\"');\n              expect(csvContent).toContain(`\"${escaped}\"`);\n            }\n          });\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should properly escape fields containing quotes', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestWithSpecialCharsArbitrary, { minLength: 1, maxLength: 20 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const csvContent = result.data;\n          \n          guests.forEach(guest => {\n            if (guest.dietaryRestrictions && guest.dietaryRestrictions.includes('\"')) {\n              // Quotes should be doubled and field wrapped in quotes\n              const escaped = guest.dietaryRestrictions.replace(/\"/g, '\"\"');\n              expect(csvContent).toContain(`\"${escaped}\"`);\n            }\n            if (guest.notes && guest.notes.includes('\"')) {\n              // Quotes should be doubled and field wrapped in quotes\n              const escaped = guest.notes.replace(/\"/g, '\"\"');\n              expect(csvContent).toContain(`\"${escaped}\"`);\n            }\n          });\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle null values as empty strings in CSV', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestArbitrary, { minLength: 1, maxLength: 20 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Skip header, check data rows\n          for (let i = 1; i < lines.length; i++) {\n            const line = lines[i];\n            const guest = guests[i - 1];\n\n            // Parse CSV line (simple parsing for validation)\n            const fields = parseCSVLine(line);\n            \n            // Verify field count matches header count\n            expect(fields.length).toBe(EXPECTED_HEADERS.length);\n\n            // Check that null values are represented as empty strings\n            if (guest.email === null) {\n              expect(fields[3]).toBe(''); // email is 4th field (index 3)\n            }\n            if (guest.phone === null) {\n              expect(fields[4]).toBe(''); // phone is 5th field (index 4)\n            }\n            if (guest.dietaryRestrictions === null) {\n              expect(fields[7]).toBe(''); // dietaryRestrictions is 8th field (index 7)\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should produce parseable CSV for any guest array', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestArbitrary, { minLength: 0, maxLength: 50 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Each line should be parseable\n          lines.forEach((line, index) => {\n            const fields = parseCSVLine(line);\n            \n            // Each line should have the correct number of fields\n            expect(fields.length).toBe(EXPECTED_HEADERS.length);\n          });\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle empty guest array', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.constant([]),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Should only have header row\n          expect(lines.length).toBe(1);\n          expect(lines[0]).toBe(EXPECTED_HEADERS.join(','));\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle large guest arrays', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestArbitrary, { minLength: 50, maxLength: 200 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Should have header + all guest rows\n          expect(lines.length).toBe(guests.length + 1);\n\n          // All lines should be parseable\n          lines.forEach(line => {\n            const fields = parseCSVLine(line);\n            expect(fields.length).toBe(EXPECTED_HEADERS.length);\n          });\n        }\n      ),\n      { numRuns: 50 } // Fewer runs for large arrays\n    );\n  });\n\n  it('should preserve boolean values correctly', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestArbitrary, { minLength: 1, maxLength: 20 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Check boolean fields are represented correctly\n          for (let i = 1; i < lines.length; i++) {\n            const fields = parseCSVLine(lines[i]);\n            const guest = guests[i - 1];\n\n            // plusOneAttending (index 9)\n            expect(fields[9]).toBe(guest.plusOneAttending.toString());\n            \n            // invitationSent (index 14)\n            expect(fields[14]).toBe(guest.invitationSent.toString());\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain field order consistency', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(guestArbitrary, { minLength: 1, maxLength: 20 }),\n        async (guests) => {\n          const result = await exportToCSV(guests);\n\n          expect(result.success).toBe(true);\n          if (!result.success) return;\n\n          const lines = result.data.split('\\n').filter(line => line.trim().length > 0);\n          \n          // Verify field order matches expected headers\n          for (let i = 1; i < lines.length; i++) {\n            const fields = parseCSVLine(lines[i]);\n            const guest = guests[i - 1];\n\n            // Check key fields are in correct positions\n            expect(fields[0]).toBe(guest.groupId); // groupId\n            expect(fields[1]).toBe(guest.firstName); // firstName\n            expect(fields[2]).toBe(guest.lastName); // lastName\n            expect(fields[5]).toBe(guest.ageType); // ageType\n            expect(fields[6]).toBe(guest.guestType); // guestType\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n\n/**\n * Helper function to parse a CSV line handling quoted fields.\n * This is a simplified parser for test validation purposes.\n */\nfunction parseCSVLine(line: string): string[] {\n  const fields: string[] = [];\n  let currentField = '';\n  let inQuotes = false;\n\n  for (let i = 0; i < line.length; i++) {\n    const char = line[i];\n    const nextChar = line[i + 1];\n\n    if (char === '\"') {\n      if (inQuotes && nextChar === '\"') {\n        // Escaped quote\n        currentField += '\"';\n        i++; // Skip next quote\n      } else {\n        // Toggle quote state\n        inQuotes = !inQuotes;\n      }\n    } else if (char === ',' && !inQuotes) {\n      // Field delimiter\n      fields.push(currentField);\n      currentField = '';\n    } else {\n      currentField += char;\n    }\n  }\n\n  // Add last field\n  fields.push(currentField);\n\n  return fields;\n}\n"],"names":["describe","EXPECTED_HEADERS","guestArbitrary","fc","record","id","uuid","groupId","firstName","string","minLength","maxLength","filter","s","trim","length","lastName","email","option","emailAddress","nil","phone","ageType","constantFrom","guestType","dietaryRestrictions","plusOneName","plusOneAttending","boolean","arrivalDate","date","min","Date","max","map","d","toISOString","split","departureDate","airportCode","flightNumber","invitationSent","invitationSentDate","rsvpDeadline","notes","createdAt","updatedAt","guestWithSpecialCharsArbitrary","oneof","constant","it","assert","asyncProperty","array","guests","result","exportToCSV","expect","success","toBe","lines","data","line","toBeGreaterThanOrEqual","headerLine","join","numRuns","csvContent","forEach","guest","includes","escaped","replace","toContain","i","fields","parseCSVLine","index","toString","currentField","inQuotes","char","nextChar","push"],"mappings":"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"}