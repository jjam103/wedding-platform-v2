{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/home-page/route.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport { getSetting, upsertHomePageConfig } from '@/services/settingsService';\nimport { homePageConfigSchema } from '@/schemas/settingsSchemas';\nimport { sanitizeRichText } from '@/utils/sanitization';\n\n/**\n * Map error codes to HTTP status codes\n */\nfunction getStatusCode(errorCode: string): number {\n  const statusMap: Record<string, number> = {\n    VALIDATION_ERROR: 400,\n    UNAUTHORIZED: 401,\n    FORBIDDEN: 403,\n    NOT_FOUND: 404,\n    CONFLICT: 409,\n    DATABASE_ERROR: 500,\n    INTERNAL_ERROR: 500,\n    UNKNOWN_ERROR: 500,\n  };\n  return statusMap[errorCode] || 500;\n}\n\n/**\n * GET /api/admin/home-page\n * Get home page configuration\n */\nexport async function GET() {\n  try {\n    // 1. Authenticate\n    const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. Get individual home page settings\n    const [titleResult, subtitleResult, welcomeMessageResult, heroImageResult] = await Promise.all([\n      getSetting('home_page_title'),\n      getSetting('home_page_subtitle'),\n      getSetting('home_page_welcome_message'),\n      getSetting('home_page_hero_image_url'),\n    ]);\n    \n    // 3. Build home page config (handle NOT_FOUND gracefully)\n    const homePageConfig = {\n      title: titleResult.success ? titleResult.data : null,\n      subtitle: subtitleResult.success ? subtitleResult.data : null,\n      welcomeMessage: welcomeMessageResult.success ? welcomeMessageResult.data : null,\n      heroImageUrl: heroImageResult.success ? heroImageResult.data : null,\n    };\n    \n    return NextResponse.json({ success: true, data: homePageConfig });\n  } catch (error) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: { \n          code: 'UNKNOWN_ERROR', \n          message: error instanceof Error ? error.message : 'Unknown error' \n        } \n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PUT /api/admin/home-page\n * Update home page configuration\n */\nexport async function PUT(request: Request) {\n  try {\n    // 1. AUTHENTICATION\n    const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. VALIDATION\n    const body = await request.json();\n    const validation = homePageConfigSchema.safeParse(body);\n    \n    if (!validation.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: { \n            code: 'VALIDATION_ERROR', \n            message: 'Invalid home page configuration', \n            details: validation.error.issues \n          } \n        },\n        { status: 400 }\n      );\n    }\n    \n    // Sanitize rich text content\n    const sanitizedConfig = {\n      ...validation.data,\n      welcomeMessage: validation.data.welcomeMessage \n        ? sanitizeRichText(validation.data.welcomeMessage) \n        : validation.data.welcomeMessage,\n    };\n    \n    // 3. SERVICE CALL - Use upsert pattern\n    const result = await upsertHomePageConfig(sanitizedConfig);\n    \n    // 4. RESPONSE\n    if (!result.success) {\n      return NextResponse.json(result, { status: getStatusCode(result.error.code) });\n    }\n    \n    return NextResponse.json(result, { status: 200 });\n    \n  } catch (error) {\n    console.error('Home page API error:', { path: request.url, method: request.method, error });\n    return NextResponse.json(\n      { \n        success: false, \n        error: { \n          code: 'INTERNAL_ERROR', \n          message: 'An unexpected error occurred' \n        } \n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","PUT","getStatusCode","errorCode","statusMap","VALIDATION_ERROR","UNAUTHORIZED","FORBIDDEN","NOT_FOUND","CONFLICT","DATABASE_ERROR","INTERNAL_ERROR","UNKNOWN_ERROR","cookieStore","cookies","supabase","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","getAll","setAll","cookiesToSet","forEach","name","value","set","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","titleResult","subtitleResult","welcomeMessageResult","heroImageResult","Promise","all","getSetting","homePageConfig","title","subtitle","welcomeMessage","heroImageUrl","Error","request","body","validation","homePageConfigSchema","safeParse","details","issues","sanitizedConfig","sanitizeRichText","result","upsertHomePageConfig","console","path","url","method"],"mappings":"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"}