cff5b4232108b06a26e526f7d3625b5c
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "PATCH", {
    enumerable: true,
    get: function() {
        return PATCH;
    }
});
const _zod = require("zod");
const _apiHelpers = require("../../../../../lib/apiHelpers");
const _rsvpManagementService = /*#__PURE__*/ _interop_require_wildcard(require("../../../../../services/rsvpManagementService"));
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
/**
 * PATCH /api/admin/rsvps/bulk
 * 
 * Bulk update RSVP statuses
 * 
 * Request Body:
 * - rsvpIds: string[] (array of RSVP UUIDs, min 1, max 100)
 * - status: 'pending' | 'attending' | 'declined' | 'maybe'
 * - notes: string (optional, max 1000 characters)
 * 
 * Returns:
 * - updatedCount: number (count of successfully updated RSVPs)
 * 
 * **Validates: Requirements 6.4**
 */ // Request body validation schema
const bulkUpdateSchema = _zod.z.object({
    rsvpIds: _zod.z.array(_zod.z.string().uuid()).min(1, 'At least one RSVP ID is required').max(100, 'Maximum 100 RSVPs can be updated at once'),
    status: _zod.z.enum([
        'pending',
        'attending',
        'declined',
        'maybe'
    ], {
        errorMap: ()=>({
                message: 'Status must be one of: pending, attending, declined, maybe'
            })
    }),
    notes: _zod.z.string().max(1000, 'Notes cannot exceed 1000 characters').optional()
});
/**
 * Map error codes to HTTP status codes
 */ function getStatusCode(errorCode) {
    const statusMap = {
        'VALIDATION_ERROR': 400,
        'INVALID_INPUT': 400,
        'UNAUTHORIZED': 401,
        'AUTHENTICATION_REQUIRED': 401,
        'FORBIDDEN': 403,
        'NOT_FOUND': 404,
        'DATABASE_ERROR': 500,
        'INTERNAL_ERROR': 500,
        'UNKNOWN_ERROR': 500
    };
    return statusMap[errorCode] || 500;
}
async function PATCH(request) {
    return (0, _apiHelpers.withAuth)(async (userId)=>{
        try {
            // 1. Parse request body
            const body = await request.json();
            // 2. Validate request body
            const validation = bulkUpdateSchema.safeParse(body);
            if (!validation.success) {
                return (0, _apiHelpers.errorResponse)('VALIDATION_ERROR', 'Invalid request data', 400, {
                    fields: validation.error.issues
                });
            }
            const { rsvpIds, status, notes } = validation.data;
            // 3. Call service layer
            const result = await _rsvpManagementService.bulkUpdateRSVPs(rsvpIds, status, notes);
            // 4. Handle service errors
            if (!result.success) {
                return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, getStatusCode(result.error.code), result.error.details);
            }
            // 5. Return success response
            // Note: If some RSVPs were not found, the service logs a warning
            // but still returns success with the count of updated RSVPs
            return (0, _apiHelpers.successResponse)(result.data, 200);
        } catch (error) {
            console.error('PATCH /api/admin/rsvps/bulk error:', {
                error: error instanceof Error ? error.message : 'Unknown error',
                stack: error instanceof Error ? error.stack : undefined
            });
            return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', 'Failed to update RSVPs', 500);
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9yc3Zwcy9idWxrL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgd2l0aEF1dGgsIGVycm9yUmVzcG9uc2UsIHN1Y2Nlc3NSZXNwb25zZSB9IGZyb20gJ0AvbGliL2FwaUhlbHBlcnMnO1xuaW1wb3J0ICogYXMgcnN2cE1hbmFnZW1lbnRTZXJ2aWNlIGZyb20gJ0Avc2VydmljZXMvcnN2cE1hbmFnZW1lbnRTZXJ2aWNlJztcblxuLyoqXG4gKiBQQVRDSCAvYXBpL2FkbWluL3JzdnBzL2J1bGtcbiAqIFxuICogQnVsayB1cGRhdGUgUlNWUCBzdGF0dXNlc1xuICogXG4gKiBSZXF1ZXN0IEJvZHk6XG4gKiAtIHJzdnBJZHM6IHN0cmluZ1tdIChhcnJheSBvZiBSU1ZQIFVVSURzLCBtaW4gMSwgbWF4IDEwMClcbiAqIC0gc3RhdHVzOiAncGVuZGluZycgfCAnYXR0ZW5kaW5nJyB8ICdkZWNsaW5lZCcgfCAnbWF5YmUnXG4gKiAtIG5vdGVzOiBzdHJpbmcgKG9wdGlvbmFsLCBtYXggMTAwMCBjaGFyYWN0ZXJzKVxuICogXG4gKiBSZXR1cm5zOlxuICogLSB1cGRhdGVkQ291bnQ6IG51bWJlciAoY291bnQgb2Ygc3VjY2Vzc2Z1bGx5IHVwZGF0ZWQgUlNWUHMpXG4gKiBcbiAqICoqVmFsaWRhdGVzOiBSZXF1aXJlbWVudHMgNi40KipcbiAqL1xuXG4vLyBSZXF1ZXN0IGJvZHkgdmFsaWRhdGlvbiBzY2hlbWFcbmNvbnN0IGJ1bGtVcGRhdGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHJzdnBJZHM6IHouYXJyYXkoei5zdHJpbmcoKS51dWlkKCkpLm1pbigxLCAnQXQgbGVhc3Qgb25lIFJTVlAgSUQgaXMgcmVxdWlyZWQnKS5tYXgoMTAwLCAnTWF4aW11bSAxMDAgUlNWUHMgY2FuIGJlIHVwZGF0ZWQgYXQgb25jZScpLFxuICBzdGF0dXM6IHouZW51bShbJ3BlbmRpbmcnLCAnYXR0ZW5kaW5nJywgJ2RlY2xpbmVkJywgJ21heWJlJ10sIHtcbiAgICBlcnJvck1hcDogKCkgPT4gKHsgbWVzc2FnZTogJ1N0YXR1cyBtdXN0IGJlIG9uZSBvZjogcGVuZGluZywgYXR0ZW5kaW5nLCBkZWNsaW5lZCwgbWF5YmUnIH0pLFxuICB9KSxcbiAgbm90ZXM6IHouc3RyaW5nKCkubWF4KDEwMDAsICdOb3RlcyBjYW5ub3QgZXhjZWVkIDEwMDAgY2hhcmFjdGVycycpLm9wdGlvbmFsKCksXG59KTtcblxuLyoqXG4gKiBNYXAgZXJyb3IgY29kZXMgdG8gSFRUUCBzdGF0dXMgY29kZXNcbiAqL1xuZnVuY3Rpb24gZ2V0U3RhdHVzQ29kZShlcnJvckNvZGU6IHN0cmluZyk6IG51bWJlciB7XG4gIGNvbnN0IHN0YXR1c01hcDogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcbiAgICAnVkFMSURBVElPTl9FUlJPUic6IDQwMCxcbiAgICAnSU5WQUxJRF9JTlBVVCc6IDQwMCxcbiAgICAnVU5BVVRIT1JJWkVEJzogNDAxLFxuICAgICdBVVRIRU5USUNBVElPTl9SRVFVSVJFRCc6IDQwMSxcbiAgICAnRk9SQklEREVOJzogNDAzLFxuICAgICdOT1RfRk9VTkQnOiA0MDQsXG4gICAgJ0RBVEFCQVNFX0VSUk9SJzogNTAwLFxuICAgICdJTlRFUk5BTF9FUlJPUic6IDUwMCxcbiAgICAnVU5LTk9XTl9FUlJPUic6IDUwMCxcbiAgfTtcbiAgXG4gIHJldHVybiBzdGF0dXNNYXBbZXJyb3JDb2RlXSB8fCA1MDA7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQQVRDSChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHJldHVybiB3aXRoQXV0aChhc3luYyAodXNlcklkKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIDEuIFBhcnNlIHJlcXVlc3QgYm9keVxuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgICAvLyAyLiBWYWxpZGF0ZSByZXF1ZXN0IGJvZHlcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBidWxrVXBkYXRlU2NoZW1hLnNhZmVQYXJzZShib2R5KTtcblxuICAgICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgICAgJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgICdJbnZhbGlkIHJlcXVlc3QgZGF0YScsXG4gICAgICAgICAgNDAwLFxuICAgICAgICAgIHsgZmllbGRzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgcnN2cElkcywgc3RhdHVzLCBub3RlcyB9ID0gdmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgICAvLyAzLiBDYWxsIHNlcnZpY2UgbGF5ZXJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJzdnBNYW5hZ2VtZW50U2VydmljZS5idWxrVXBkYXRlUlNWUHMoXG4gICAgICAgIHJzdnBJZHMsXG4gICAgICAgIHN0YXR1cyxcbiAgICAgICAgbm90ZXNcbiAgICAgICk7XG5cbiAgICAgIC8vIDQuIEhhbmRsZSBzZXJ2aWNlIGVycm9yc1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICAgICByZXN1bHQuZXJyb3IuY29kZSxcbiAgICAgICAgICByZXN1bHQuZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBnZXRTdGF0dXNDb2RlKHJlc3VsdC5lcnJvci5jb2RlKSxcbiAgICAgICAgICByZXN1bHQuZXJyb3IuZGV0YWlsc1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyA1LiBSZXR1cm4gc3VjY2VzcyByZXNwb25zZVxuICAgICAgLy8gTm90ZTogSWYgc29tZSBSU1ZQcyB3ZXJlIG5vdCBmb3VuZCwgdGhlIHNlcnZpY2UgbG9ncyBhIHdhcm5pbmdcbiAgICAgIC8vIGJ1dCBzdGlsbCByZXR1cm5zIHN1Y2Nlc3Mgd2l0aCB0aGUgY291bnQgb2YgdXBkYXRlZCBSU1ZQc1xuICAgICAgcmV0dXJuIHN1Y2Nlc3NSZXNwb25zZShyZXN1bHQuZGF0YSwgMjAwKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdQQVRDSCAvYXBpL2FkbWluL3JzdnBzL2J1bGsgZXJyb3I6Jywge1xuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIHN0YWNrOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgICdJTlRFUk5BTF9FUlJPUicsXG4gICAgICAgICdGYWlsZWQgdG8gdXBkYXRlIFJTVlBzJyxcbiAgICAgICAgNTAwXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG59XG4iXSwibmFtZXMiOlsiUEFUQ0giLCJidWxrVXBkYXRlU2NoZW1hIiwieiIsIm9iamVjdCIsInJzdnBJZHMiLCJhcnJheSIsInN0cmluZyIsInV1aWQiLCJtaW4iLCJtYXgiLCJzdGF0dXMiLCJlbnVtIiwiZXJyb3JNYXAiLCJtZXNzYWdlIiwibm90ZXMiLCJvcHRpb25hbCIsImdldFN0YXR1c0NvZGUiLCJlcnJvckNvZGUiLCJzdGF0dXNNYXAiLCJyZXF1ZXN0Iiwid2l0aEF1dGgiLCJ1c2VySWQiLCJib2R5IiwianNvbiIsInZhbGlkYXRpb24iLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwiZXJyb3JSZXNwb25zZSIsImZpZWxkcyIsImVycm9yIiwiaXNzdWVzIiwiZGF0YSIsInJlc3VsdCIsInJzdnBNYW5hZ2VtZW50U2VydmljZSIsImJ1bGtVcGRhdGVSU1ZQcyIsImNvZGUiLCJkZXRhaWxzIiwic3VjY2Vzc1Jlc3BvbnNlIiwiY29uc29sZSIsIkVycm9yIiwic3RhY2siLCJ1bmRlZmluZWQiXSwibWFwcGluZ3MiOiI7Ozs7K0JBaURzQkE7OztlQUFBQTs7O3FCQWhESjs0QkFDdUM7K0VBQ2xCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFdkM7Ozs7Ozs7Ozs7Ozs7O0NBY0MsR0FFRCxpQ0FBaUM7QUFDakMsTUFBTUMsbUJBQW1CQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztJQUNoQ0MsU0FBU0YsTUFBQyxDQUFDRyxLQUFLLENBQUNILE1BQUMsQ0FBQ0ksTUFBTSxHQUFHQyxJQUFJLElBQUlDLEdBQUcsQ0FBQyxHQUFHLG9DQUFvQ0MsR0FBRyxDQUFDLEtBQUs7SUFDeEZDLFFBQVFSLE1BQUMsQ0FBQ1MsSUFBSSxDQUFDO1FBQUM7UUFBVztRQUFhO1FBQVk7S0FBUSxFQUFFO1FBQzVEQyxVQUFVLElBQU8sQ0FBQTtnQkFBRUMsU0FBUztZQUE2RCxDQUFBO0lBQzNGO0lBQ0FDLE9BQU9aLE1BQUMsQ0FBQ0ksTUFBTSxHQUFHRyxHQUFHLENBQUMsTUFBTSx1Q0FBdUNNLFFBQVE7QUFDN0U7QUFFQTs7Q0FFQyxHQUNELFNBQVNDLGNBQWNDLFNBQWlCO0lBQ3RDLE1BQU1DLFlBQW9DO1FBQ3hDLG9CQUFvQjtRQUNwQixpQkFBaUI7UUFDakIsZ0JBQWdCO1FBQ2hCLDJCQUEyQjtRQUMzQixhQUFhO1FBQ2IsYUFBYTtRQUNiLGtCQUFrQjtRQUNsQixrQkFBa0I7UUFDbEIsaUJBQWlCO0lBQ25CO0lBRUEsT0FBT0EsU0FBUyxDQUFDRCxVQUFVLElBQUk7QUFDakM7QUFFTyxlQUFlakIsTUFBTW1CLE9BQWdCO0lBQzFDLE9BQU9DLElBQUFBLG9CQUFRLEVBQUMsT0FBT0M7UUFDckIsSUFBSTtZQUNGLHdCQUF3QjtZQUN4QixNQUFNQyxPQUFPLE1BQU1ILFFBQVFJLElBQUk7WUFFL0IsMkJBQTJCO1lBQzNCLE1BQU1DLGFBQWF2QixpQkFBaUJ3QixTQUFTLENBQUNIO1lBRTlDLElBQUksQ0FBQ0UsV0FBV0UsT0FBTyxFQUFFO2dCQUN2QixPQUFPQyxJQUFBQSx5QkFBYSxFQUNsQixvQkFDQSx3QkFDQSxLQUNBO29CQUFFQyxRQUFRSixXQUFXSyxLQUFLLENBQUNDLE1BQU07Z0JBQUM7WUFFdEM7WUFFQSxNQUFNLEVBQUUxQixPQUFPLEVBQUVNLE1BQU0sRUFBRUksS0FBSyxFQUFFLEdBQUdVLFdBQVdPLElBQUk7WUFFbEQsd0JBQXdCO1lBQ3hCLE1BQU1DLFNBQVMsTUFBTUMsdUJBQXNCQyxlQUFlLENBQ3hEOUIsU0FDQU0sUUFDQUk7WUFHRiwyQkFBMkI7WUFDM0IsSUFBSSxDQUFDa0IsT0FBT04sT0FBTyxFQUFFO2dCQUNuQixPQUFPQyxJQUFBQSx5QkFBYSxFQUNsQkssT0FBT0gsS0FBSyxDQUFDTSxJQUFJLEVBQ2pCSCxPQUFPSCxLQUFLLENBQUNoQixPQUFPLEVBQ3BCRyxjQUFjZ0IsT0FBT0gsS0FBSyxDQUFDTSxJQUFJLEdBQy9CSCxPQUFPSCxLQUFLLENBQUNPLE9BQU87WUFFeEI7WUFFQSw2QkFBNkI7WUFDN0IsaUVBQWlFO1lBQ2pFLDREQUE0RDtZQUM1RCxPQUFPQyxJQUFBQSwyQkFBZSxFQUFDTCxPQUFPRCxJQUFJLEVBQUU7UUFFdEMsRUFBRSxPQUFPRixPQUFPO1lBQ2RTLFFBQVFULEtBQUssQ0FBQyxzQ0FBc0M7Z0JBQ2xEQSxPQUFPQSxpQkFBaUJVLFFBQVFWLE1BQU1oQixPQUFPLEdBQUc7Z0JBQ2hEMkIsT0FBT1gsaUJBQWlCVSxRQUFRVixNQUFNVyxLQUFLLEdBQUdDO1lBQ2hEO1lBRUEsT0FBT2QsSUFBQUEseUJBQWEsRUFDbEIsa0JBQ0EsMEJBQ0E7UUFFSjtJQUNGO0FBQ0YifQ==