{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/rsvps/bulk/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { withAuth, errorResponse, successResponse } from '@/lib/apiHelpers';\nimport * as rsvpManagementService from '@/services/rsvpManagementService';\n\n/**\n * PATCH /api/admin/rsvps/bulk\n * \n * Bulk update RSVP statuses\n * \n * Request Body:\n * - rsvpIds: string[] (array of RSVP UUIDs, min 1, max 100)\n * - status: 'pending' | 'attending' | 'declined' | 'maybe'\n * - notes: string (optional, max 1000 characters)\n * \n * Returns:\n * - updatedCount: number (count of successfully updated RSVPs)\n * \n * **Validates: Requirements 6.4**\n */\n\n// Request body validation schema\nconst bulkUpdateSchema = z.object({\n  rsvpIds: z.array(z.string().uuid()).min(1, 'At least one RSVP ID is required').max(100, 'Maximum 100 RSVPs can be updated at once'),\n  status: z.enum(['pending', 'attending', 'declined', 'maybe'], {\n    errorMap: () => ({ message: 'Status must be one of: pending, attending, declined, maybe' }),\n  }),\n  notes: z.string().max(1000, 'Notes cannot exceed 1000 characters').optional(),\n});\n\n/**\n * Map error codes to HTTP status codes\n */\nfunction getStatusCode(errorCode: string): number {\n  const statusMap: Record<string, number> = {\n    'VALIDATION_ERROR': 400,\n    'INVALID_INPUT': 400,\n    'UNAUTHORIZED': 401,\n    'AUTHENTICATION_REQUIRED': 401,\n    'FORBIDDEN': 403,\n    'NOT_FOUND': 404,\n    'DATABASE_ERROR': 500,\n    'INTERNAL_ERROR': 500,\n    'UNKNOWN_ERROR': 500,\n  };\n  \n  return statusMap[errorCode] || 500;\n}\n\nexport async function PATCH(request: Request) {\n  return withAuth(async (userId) => {\n    try {\n      // 1. Parse request body\n      const body = await request.json();\n\n      // 2. Validate request body\n      const validation = bulkUpdateSchema.safeParse(body);\n\n      if (!validation.success) {\n        return errorResponse(\n          'VALIDATION_ERROR',\n          'Invalid request data',\n          400,\n          { fields: validation.error.issues }\n        );\n      }\n\n      const { rsvpIds, status, notes } = validation.data;\n\n      // 3. Call service layer\n      const result = await rsvpManagementService.bulkUpdateRSVPs(\n        rsvpIds,\n        status,\n        notes\n      );\n\n      // 4. Handle service errors\n      if (!result.success) {\n        return errorResponse(\n          result.error.code,\n          result.error.message,\n          getStatusCode(result.error.code),\n          result.error.details\n        );\n      }\n\n      // 5. Return success response\n      // Note: If some RSVPs were not found, the service logs a warning\n      // but still returns success with the count of updated RSVPs\n      return successResponse(result.data, 200);\n\n    } catch (error) {\n      console.error('PATCH /api/admin/rsvps/bulk error:', {\n        error: error instanceof Error ? error.message : 'Unknown error',\n        stack: error instanceof Error ? error.stack : undefined,\n      });\n      \n      return errorResponse(\n        'INTERNAL_ERROR',\n        'Failed to update RSVPs',\n        500\n      );\n    }\n  });\n}\n"],"names":["PATCH","bulkUpdateSchema","z","object","rsvpIds","array","string","uuid","min","max","status","enum","errorMap","message","notes","optional","getStatusCode","errorCode","statusMap","request","withAuth","userId","body","json","validation","safeParse","success","errorResponse","fields","error","issues","data","result","rsvpManagementService","bulkUpdateRSVPs","code","details","successResponse","console","Error","stack","undefined"],"mappings":";;;;+BAiDsBA;;;eAAAA;;;qBAhDJ;4BACuC;+EAClB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEvC;;;;;;;;;;;;;;CAcC,GAED,iCAAiC;AACjC,MAAMC,mBAAmBC,MAAC,CAACC,MAAM,CAAC;IAChCC,SAASF,MAAC,CAACG,KAAK,CAACH,MAAC,CAACI,MAAM,GAAGC,IAAI,IAAIC,GAAG,CAAC,GAAG,oCAAoCC,GAAG,CAAC,KAAK;IACxFC,QAAQR,MAAC,CAACS,IAAI,CAAC;QAAC;QAAW;QAAa;QAAY;KAAQ,EAAE;QAC5DC,UAAU,IAAO,CAAA;gBAAEC,SAAS;YAA6D,CAAA;IAC3F;IACAC,OAAOZ,MAAC,CAACI,MAAM,GAAGG,GAAG,CAAC,MAAM,uCAAuCM,QAAQ;AAC7E;AAEA;;CAEC,GACD,SAASC,cAAcC,SAAiB;IACtC,MAAMC,YAAoC;QACxC,oBAAoB;QACpB,iBAAiB;QACjB,gBAAgB;QAChB,2BAA2B;QAC3B,aAAa;QACb,aAAa;QACb,kBAAkB;QAClB,kBAAkB;QAClB,iBAAiB;IACnB;IAEA,OAAOA,SAAS,CAACD,UAAU,IAAI;AACjC;AAEO,eAAejB,MAAMmB,OAAgB;IAC1C,OAAOC,IAAAA,oBAAQ,EAAC,OAAOC;QACrB,IAAI;YACF,wBAAwB;YACxB,MAAMC,OAAO,MAAMH,QAAQI,IAAI;YAE/B,2BAA2B;YAC3B,MAAMC,aAAavB,iBAAiBwB,SAAS,CAACH;YAE9C,IAAI,CAACE,WAAWE,OAAO,EAAE;gBACvB,OAAOC,IAAAA,yBAAa,EAClB,oBACA,wBACA,KACA;oBAAEC,QAAQJ,WAAWK,KAAK,CAACC,MAAM;gBAAC;YAEtC;YAEA,MAAM,EAAE1B,OAAO,EAAEM,MAAM,EAAEI,KAAK,EAAE,GAAGU,WAAWO,IAAI;YAElD,wBAAwB;YACxB,MAAMC,SAAS,MAAMC,uBAAsBC,eAAe,CACxD9B,SACAM,QACAI;YAGF,2BAA2B;YAC3B,IAAI,CAACkB,OAAON,OAAO,EAAE;gBACnB,OAAOC,IAAAA,yBAAa,EAClBK,OAAOH,KAAK,CAACM,IAAI,EACjBH,OAAOH,KAAK,CAAChB,OAAO,EACpBG,cAAcgB,OAAOH,KAAK,CAACM,IAAI,GAC/BH,OAAOH,KAAK,CAACO,OAAO;YAExB;YAEA,6BAA6B;YAC7B,iEAAiE;YACjE,4DAA4D;YAC5D,OAAOC,IAAAA,2BAAe,EAACL,OAAOD,IAAI,EAAE;QAEtC,EAAE,OAAOF,OAAO;YACdS,QAAQT,KAAK,CAAC,sCAAsC;gBAClDA,OAAOA,iBAAiBU,QAAQV,MAAMhB,OAAO,GAAG;gBAChD2B,OAAOX,iBAAiBU,QAAQV,MAAMW,KAAK,GAAGC;YAChD;YAEA,OAAOd,IAAAA,yBAAa,EAClB,kBACA,0BACA;QAEJ;IACF;AACF"}