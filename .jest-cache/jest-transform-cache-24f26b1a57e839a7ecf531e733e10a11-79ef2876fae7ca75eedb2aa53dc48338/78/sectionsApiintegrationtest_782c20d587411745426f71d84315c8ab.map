{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/sectionsApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Test: Sections API\n * \n * Tests section CRUD operations, reordering, reference validation,\n * and circular reference detection via API route handlers.\n * \n * Validates: Requirements 15.1-15.7\n * \n * Test Coverage:\n * - POST /api/admin/sections - Create section\n * - GET /api/admin/sections/by-page/:pageType/:pageId - List sections\n * - PUT /api/admin/sections/:id - Update section\n * - DELETE /api/admin/sections/:id - Delete section\n * - POST /api/admin/sections/reorder - Reorder sections\n * - POST /api/admin/sections/validate-refs - Validate references\n * - POST /api/admin/sections/check-circular - Check circular references\n * - Authentication checks (401 responses)\n * - Validation errors (400 responses)\n * - Not found errors (404 responses)\n * - Server errors (500 responses)\n */\n\n// Polyfill Web APIs for Next.js server components\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder as any;\n\n// Mock the sections service BEFORE importing route handlers\njest.mock('@/services/sectionsService', () => ({\n  createSection: jest.fn(),\n  listSections: jest.fn(),\n  updateSection: jest.fn(),\n  deleteSection: jest.fn(),\n  reorderSections: jest.fn(),\n  validateReferences: jest.fn(),\n  detectCircularReferences: jest.fn(),\n}));\n\n// Mock Next.js server module\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n  NextRequest: jest.fn(),\n}));\n\n// Mock Next.js headers and cookies\njest.mock('next/headers', () => ({\n  cookies: jest.fn(() => ({\n    get: jest.fn(),\n    getAll: jest.fn(() => []),\n    set: jest.fn(),\n    delete: jest.fn(),\n  })),\n}));\n\n// Mock Supabase SSR client\nconst mockGetUser = jest.fn();\nconst mockSupabaseClient = {\n  auth: {\n    getUser: mockGetUser,\n    getSession: jest.fn(),\n  },\n  from: jest.fn(),\n};\n\njest.mock('@supabase/ssr', () => ({\n  createServerClient: jest.fn(() => mockSupabaseClient),\n}));\n\nimport { POST as createSectionRoute } from '@/app/api/admin/sections/route';\nimport { GET as listSectionsRoute } from '@/app/api/admin/sections/by-page/[pageType]/[pageId]/route';\nimport { PUT as updateSectionRoute, DELETE as deleteSectionRoute } from '@/app/api/admin/sections/[id]/route';\nimport { POST as reorderSectionsRoute } from '@/app/api/admin/sections/reorder/route';\nimport { POST as validateReferencesRoute } from '@/app/api/admin/sections/validate-refs/route';\nimport { POST as checkCircularRoute } from '@/app/api/admin/sections/check-circular/route';\nimport * as sectionsService from '@/services/sectionsService';\n\ndescribe('Integration Test: Sections API', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Default: authenticated user\n    mockGetUser.mockResolvedValue({\n      data: {\n        user: { id: 'user-123', email: 'test@example.com' },\n      },\n      error: null,\n    } as any);\n  });\n\n  describe('POST /api/admin/sections - Create Section', () => {\n    it('should create section with valid data when authenticated', async () => {\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'page-1',\n        display_order: 0,\n        columns: [\n          {\n            id: 'col-1',\n            section_id: 'section-1',\n            column_number: 1,\n            content_type: 'rich_text',\n            content_data: { html: '<p>Content</p>' },\n          },\n        ],\n      };\n\n      (sectionsService.createSection as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockSection,\n      });\n\n      const request = {\n        json: async () => ({\n          page_type: 'activity',\n          page_id: 'page-1',\n          display_order: 0,\n          columns: [\n            {\n              column_number: 1,\n              content_type: 'rich_text',\n              content_data: { html: '<p>Content</p>' },\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections',\n      } as any;\n\n      const response = await createSectionRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(data.success).toBe(true);\n      expect(data.data.id).toBe('section-1');\n      expect(data.data.page_type).toBe('activity');\n      expect(sectionsService.createSection).toHaveBeenCalled();\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockGetUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Not authenticated' },\n      } as any);\n\n      const request = {\n        json: async () => ({\n          page_type: 'activity',\n          page_id: 'page-1',\n          display_order: 0,\n          columns: [],\n        }),\n        url: 'http://localhost:3000/api/admin/sections',\n      } as any;\n\n      const response = await createSectionRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 400 for invalid page_type', async () => {\n      const request = {\n        json: async () => ({\n          page_type: 'invalid_type',\n          page_id: 'page-1',\n          display_order: 0,\n          columns: [],\n        }),\n        url: 'http://localhost:3000/api/admin/sections',\n      } as any;\n\n      const response = await createSectionRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 500 for database errors', async () => {\n      (sectionsService.createSection as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Database error',\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          page_type: 'activity',\n          page_id: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          display_order: 0,\n          columns: [\n            {\n              column_number: 1,\n              content_type: 'rich_text',\n              content_data: { html: '<p>Test content</p>' },\n            },\n          ], // Must have at least 1 column\n        }),\n        url: 'http://localhost:3000/api/admin/sections',\n      } as any;\n\n      const response = await createSectionRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('GET /api/admin/sections/by-page/:pageType/:pageId - List Sections', () => {\n    it('should list sections for a page when authenticated', async () => {\n      const mockSections = [\n        {\n          id: 'section-1',\n          page_type: 'activity',\n          page_id: 'page-1',\n          display_order: 0,\n          columns: [],\n        },\n        {\n          id: 'section-2',\n          page_type: 'activity',\n          page_id: 'page-1',\n          display_order: 1,\n          columns: [],\n        },\n      ];\n\n      (sectionsService.listSections as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockSections,\n      });\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/sections/by-page/activity/page-1',\n      } as any;\n\n      const response = await listSectionsRoute(\n        request,\n        { params: Promise.resolve({ pageType: 'activity', pageId: 'page-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toHaveLength(2);\n      expect(data.data[0].display_order).toBe(0);\n      expect(data.data[1].display_order).toBe(1);\n      expect(sectionsService.listSections).toHaveBeenCalledWith('activity', 'page-1');\n    });\n\n    it('should return empty array when no sections exist', async () => {\n      (sectionsService.listSections as jest.Mock).mockResolvedValue({\n        success: true,\n        data: [],\n      });\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/sections/by-page/activity/page-1',\n      } as any;\n\n      const response = await listSectionsRoute(\n        request,\n        { params: Promise.resolve({ pageType: 'activity', pageId: 'page-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toHaveLength(0);\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockGetUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Not authenticated' },\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/sections/by-page/activity/page-1',\n      } as any;\n\n      const response = await listSectionsRoute(\n        request,\n        { params: Promise.resolve({ pageType: 'activity', pageId: 'page-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 500 for database errors', async () => {\n      (sectionsService.listSections as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Database error',\n        },\n      });\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/sections/by-page/activity/page-1',\n      } as any;\n\n      const response = await listSectionsRoute(\n        request,\n        { params: Promise.resolve({ pageType: 'activity', pageId: 'page-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('PUT /api/admin/sections/:id - Update Section', () => {\n    it('should update section with valid data when authenticated', async () => {\n      const mockSection = {\n        id: 'section-1',\n        page_type: 'activity',\n        page_id: 'page-1',\n        display_order: 1,\n        columns: [\n          {\n            id: 'col-1',\n            section_id: 'section-1',\n            column_number: 1,\n            content_type: 'rich_text',\n            content_data: { html: '<p>Updated content</p>' },\n          },\n        ],\n      };\n\n      (sectionsService.updateSection as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockSection,\n      });\n\n      const request = {\n        json: async () => ({\n          display_order: 1,\n          columns: [\n            {\n              column_number: 1,\n              content_type: 'rich_text',\n              content_data: { html: '<p>Updated content</p>' },\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/section-1',\n      } as any;\n\n      const response = await updateSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'section-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.display_order).toBe(1);\n      expect(sectionsService.updateSection).toHaveBeenCalledWith('section-1', expect.any(Object));\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockGetUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Not authenticated' },\n      } as any);\n\n      const request = {\n        json: async () => ({\n          display_order: 1,\n        }),\n        url: 'http://localhost:3000/api/admin/sections/section-1',\n      } as any;\n\n      const response = await updateSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'section-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 400 for invalid data', async () => {\n      const request = {\n        json: async () => ({\n          display_order: 'invalid',\n        }),\n        url: 'http://localhost:3000/api/admin/sections/section-1',\n      } as any;\n\n      const response = await updateSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'section-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 404 when section not found', async () => {\n      (sectionsService.updateSection as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'NOT_FOUND',\n          message: 'Section not found',\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          display_order: 1,\n        }),\n        url: 'http://localhost:3000/api/admin/sections/nonexistent',\n      } as any;\n\n      const response = await updateSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'nonexistent' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should return 500 for database errors', async () => {\n      (sectionsService.updateSection as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Database error',\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          display_order: 1,\n        }),\n        url: 'http://localhost:3000/api/admin/sections/section-1',\n      } as any;\n\n      const response = await updateSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'section-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('DELETE /api/admin/sections/:id - Delete Section', () => {\n    it('should delete section when authenticated', async () => {\n      (sectionsService.deleteSection as jest.Mock).mockResolvedValue({\n        success: true,\n        data: { message: 'Section deleted successfully' },\n      });\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/sections/section-1',\n      } as any;\n\n      const response = await deleteSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'section-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(sectionsService.deleteSection).toHaveBeenCalledWith('section-1');\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockGetUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Not authenticated' },\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/sections/section-1',\n      } as any;\n\n      const response = await deleteSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'section-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 500 for database errors', async () => {\n      (sectionsService.deleteSection as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Database error',\n        },\n      });\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/sections/section-1',\n      } as any;\n\n      const response = await deleteSectionRoute(\n        request,\n        { params: Promise.resolve({ id: 'section-1' }) }\n      );\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('POST /api/admin/sections/reorder - Reorder Sections', () => {\n    it('should reorder sections with valid data when authenticated', async () => {\n      (sectionsService.reorderSections as jest.Mock).mockResolvedValue({\n        success: true,\n        data: { message: 'Sections reordered successfully' },\n      });\n\n      const request = {\n        json: async () => ({\n          pageId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          sectionIds: ['123e4567-e89b-12d3-a456-426614174001', '123e4567-e89b-12d3-a456-426614174002', '123e4567-e89b-12d3-a456-426614174003'], // Valid UUIDs\n        }),\n        url: 'http://localhost:3000/api/admin/sections/reorder',\n      } as any;\n\n      const response = await reorderSectionsRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(sectionsService.reorderSections).toHaveBeenCalledWith(\n        '123e4567-e89b-12d3-a456-426614174000',\n        ['123e4567-e89b-12d3-a456-426614174001', '123e4567-e89b-12d3-a456-426614174002', '123e4567-e89b-12d3-a456-426614174003']\n      );\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockGetUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Not authenticated' },\n      } as any);\n\n      const request = {\n        json: async () => ({\n          pageId: 'page-1',\n          sectionIds: ['section-1'],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/reorder',\n      } as any;\n\n      const response = await reorderSectionsRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 400 for empty section list', async () => {\n      const request = {\n        json: async () => ({\n          pageId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          sectionIds: [],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/reorder',\n      } as any;\n\n      const response = await reorderSectionsRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 500 for database errors', async () => {\n      (sectionsService.reorderSections as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Database error',\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          pageId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          sectionIds: ['123e4567-e89b-12d3-a456-426614174001'], // Valid UUID\n        }),\n        url: 'http://localhost:3000/api/admin/sections/reorder',\n      } as any;\n\n      const response = await reorderSectionsRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('POST /api/admin/sections/validate-refs - Validate References', () => {\n    it('should validate references successfully with no broken refs', async () => {\n      (sectionsService.validateReferences as jest.Mock).mockResolvedValue({\n        success: true,\n        data: {\n          valid: true,\n          brokenReferences: [],\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n              type: 'activity',\n              name: 'Beach Day',\n            },\n            {\n              id: '123e4567-e89b-12d3-a456-426614174001', // Valid UUID\n              type: 'event',\n              name: 'Ceremony',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/validate-refs',\n      } as any;\n\n      const response = await validateReferencesRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.valid).toBe(true);\n      expect(data.data.brokenReferences).toHaveLength(0);\n    });\n\n    it('should detect broken references', async () => {\n      (sectionsService.validateReferences as jest.Mock).mockResolvedValue({\n        success: true,\n        data: {\n          valid: false,\n          brokenReferences: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174999', // Valid UUID\n              type: 'activity',\n            },\n          ],\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n              type: 'activity',\n            },\n            {\n              id: '123e4567-e89b-12d3-a456-426614174999', // Valid UUID\n              type: 'activity',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/validate-refs',\n      } as any;\n\n      const response = await validateReferencesRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.valid).toBe(false);\n      expect(data.data.brokenReferences).toHaveLength(1);\n      expect(data.data.brokenReferences[0].id).toBe('123e4567-e89b-12d3-a456-426614174999');\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockGetUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Not authenticated' },\n      } as any);\n\n      const request = {\n        json: async () => ({\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n              type: 'activity',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/validate-refs',\n      } as any;\n\n      const response = await validateReferencesRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 400 for invalid reference type', async () => {\n      const request = {\n        json: async () => ({\n          references: [\n            {\n              id: 'invalid-1',\n              type: 'invalid_type',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/validate-refs',\n      } as any;\n\n      const response = await validateReferencesRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 500 for service errors', async () => {\n      (sectionsService.validateReferences as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: 'Database connection failed',\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n              type: 'activity',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/validate-refs',\n      } as any;\n\n      const response = await validateReferencesRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNKNOWN_ERROR');\n    });\n  });\n\n  describe('POST /api/admin/sections/check-circular - Check Circular References', () => {\n    it('should detect direct self-reference', async () => {\n      (sectionsService.detectCircularReferences as jest.Mock).mockResolvedValue({\n        success: true,\n        data: true,\n      });\n\n      const request = {\n        json: async () => ({\n          pageId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174000', // Same as pageId for self-reference\n              type: 'activity',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/check-circular',\n      } as any;\n\n      const response = await checkCircularRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.hasCircularReferences).toBe(true);\n    });\n\n    it('should return false when no circular references exist', async () => {\n      (sectionsService.detectCircularReferences as jest.Mock).mockResolvedValue({\n        success: true,\n        data: false,\n      });\n\n      const request = {\n        json: async () => ({\n          pageId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174001', // Different from pageId\n              type: 'activity',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/check-circular',\n      } as any;\n\n      const response = await checkCircularRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.hasCircularReferences).toBe(false);\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockGetUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Not authenticated' },\n      } as any);\n\n      const request = {\n        json: async () => ({\n          pageId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174001', // Valid UUID\n              type: 'activity',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/check-circular',\n      } as any;\n\n      const response = await checkCircularRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 400 for missing required fields', async () => {\n      const request = {\n        json: async () => ({\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174001', // Valid UUID\n              type: 'activity',\n            },\n          ],\n          // Missing pageId\n        }),\n        url: 'http://localhost:3000/api/admin/sections/check-circular',\n      } as any;\n\n      const response = await checkCircularRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 500 for service errors', async () => {\n      (sectionsService.detectCircularReferences as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: 'Database connection failed',\n        },\n      });\n\n      const request = {\n        json: async () => ({\n          pageId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n          references: [\n            {\n              id: '123e4567-e89b-12d3-a456-426614174001', // Valid UUID\n              type: 'activity',\n            },\n          ],\n        }),\n        url: 'http://localhost:3000/api/admin/sections/check-circular',\n      } as any;\n\n      const response = await checkCircularRoute(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNKNOWN_ERROR');\n    });\n  });\n});\n"],"names":["jest","mock","createSection","fn","listSections","updateSection","deleteSection","reorderSections","validateReferences","detectCircularReferences","NextResponse","json","data","init","status","NextRequest","cookies","get","getAll","set","delete","createServerClient","mockSupabaseClient","global","TextEncoder","TextDecoder","mockGetUser","auth","getUser","getSession","from","describe","beforeEach","clearAllMocks","mockResolvedValue","user","id","email","error","it","mockSection","page_type","page_id","display_order","columns","section_id","column_number","content_type","content_data","html","sectionsService","success","request","url","response","createSectionRoute","expect","toBe","toHaveBeenCalled","message","code","mockSections","listSectionsRoute","params","Promise","resolve","pageType","pageId","toHaveLength","toHaveBeenCalledWith","updateSectionRoute","any","Object","deleteSectionRoute","sectionIds","reorderSectionsRoute","valid","brokenReferences","references","type","name","validateReferencesRoute","checkCircularRoute","hasCircularReferences"],"mappings":"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"}