{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/photoFieldConsistency.regression.test.ts"],"sourcesContent":["/**\n * Photo Field Name Consistency Regression Tests\n * \n * Purpose: Prevent regression where components use wrong field name for photo URLs\n * \n * Background:\n * - Database schema uses 'photo_url' field (not 'url')\n * - All components must consistently use 'photo_url'\n * - API responses must include 'photo_url'\n * - No components should use deprecated 'url' field\n * \n * This test suite validates:\n * 1. Database schema has photo_url column\n * 2. API responses include photo_url field\n * 3. All photo-related components use photo_url\n * 4. No components use deprecated 'url' field\n */\n\nimport { createClient } from '@supabase/supabase-js';\nimport { readFileSync } from 'fs';\nimport { join } from 'path';\n\n// Test database connection\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\ndescribe('Photo Field Name Consistency Regression Tests', () => {\n  describe('34.9 Database Schema Verification', () => {\n    it('should have photo_url column in photos table', async () => {\n      // Query the information schema to verify column exists\n      const { data, error } = await supabase\n        .from('photos')\n        .select('photo_url')\n        .limit(1);\n\n      // Should not error (column exists)\n      expect(error).toBeNull();\n      \n      // Verify the query structure is correct\n      expect(data).toBeDefined();\n    });\n\n    it('should not have deprecated url column in photos table', async () => {\n      // Query all columns and verify 'url' is not present\n      const { data, error } = await supabase\n        .from('photos')\n        .select('*')\n        .limit(1)\n        .single();\n\n      // If we have data, verify no 'url' field exists\n      if (data && !error) {\n        expect(data).not.toHaveProperty('url');\n        expect(data).toHaveProperty('photo_url');\n      }\n      \n      // If no data exists, that's okay - just verify the query structure\n      if (error && error.code === 'PGRST116') {\n        // No rows returned - this is fine for the test\n        expect(error.code).toBe('PGRST116');\n      }\n    });\n\n    it('should have photo_url as TEXT NOT NULL in schema', async () => {\n      // Read the migration file to verify schema definition\n      const migrationPath = join(process.cwd(), 'supabase/migrations/007_create_photos_table.sql');\n      const migrationContent = readFileSync(migrationPath, 'utf-8');\n\n      // Verify photo_url is defined correctly\n      expect(migrationContent).toContain('photo_url TEXT NOT NULL');\n      \n      // Verify no 'url' column exists\n      expect(migrationContent).not.toMatch(/\\burl\\s+TEXT/i);\n    });\n  });\n\n  describe('34.7 API Response Verification', () => {\n    let testPhotoId: string;\n\n    beforeAll(async () => {\n      // Create a test photo for API testing\n      const { data: photo, error } = await supabase\n        .from('photos')\n        .insert({\n          uploader_id: '00000000-0000-0000-0000-000000000000', // Test user\n          photo_url: 'https://test.example.com/test-photo.jpg',\n          storage_type: 'b2',\n          page_type: 'memory',\n          page_id: '00000000-0000-0000-0000-000000000000',\n          caption: 'Test Photo for Field Consistency',\n          alt_text: 'Test photo',\n          moderation_status: 'approved',\n        })\n        .select('id')\n        .single();\n\n      if (photo) {\n        testPhotoId = photo.id;\n      }\n    });\n\n    afterAll(async () => {\n      // Clean up test photo\n      if (testPhotoId) {\n        await supabase.from('photos').delete().eq('id', testPhotoId);\n      }\n    });\n\n    it('should return photo_url field in API response', async () => {\n      if (!testPhotoId) {\n        console.warn('Test photo not created, skipping API test');\n        return;\n      }\n\n      const { data: photo, error } = await supabase\n        .from('photos')\n        .select('*')\n        .eq('id', testPhotoId)\n        .single();\n\n      expect(error).toBeNull();\n      expect(photo).toBeDefined();\n      expect(photo).toHaveProperty('photo_url');\n      expect(typeof photo.photo_url).toBe('string');\n    });\n\n    it('should not return deprecated url field in API response', async () => {\n      if (!testPhotoId) {\n        console.warn('Test photo not created, skipping API test');\n        return;\n      }\n\n      const { data: photo, error } = await supabase\n        .from('photos')\n        .select('*')\n        .eq('id', testPhotoId)\n        .single();\n\n      expect(error).toBeNull();\n      expect(photo).toBeDefined();\n      expect(photo).not.toHaveProperty('url');\n    });\n\n    it('should include photo_url in list responses', async () => {\n      const { data: photos, error } = await supabase\n        .from('photos')\n        .select('id, photo_url, caption')\n        .eq('moderation_status', 'approved')\n        .limit(5);\n\n      expect(error).toBeNull();\n      expect(photos).toBeDefined();\n      \n      if (photos && photos.length > 0) {\n        photos.forEach(photo => {\n          expect(photo).toHaveProperty('photo_url');\n          expect(typeof photo.photo_url).toBe('string');\n          expect(photo).not.toHaveProperty('url');\n        });\n      }\n    });\n  });\n\n  describe('34.2 PhotoGallery Component Verification', () => {\n    it('should use photo_url field in PhotoGallery component', () => {\n      const componentPath = join(process.cwd(), 'components/guest/PhotoGallery.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify photo_url is used in interface\n      expect(componentContent).toContain('photo_url: string');\n      \n      // Verify photo_url is used in Image src\n      expect(componentContent).toContain('src={photo.photo_url}');\n      expect(componentContent).toContain('src={currentPhoto.photo_url}');\n      \n      // Verify no deprecated 'url' field is used\n      expect(componentContent).not.toMatch(/photo\\.url[^_]/);\n      expect(componentContent).not.toMatch(/currentPhoto\\.url[^_]/);\n    });\n\n    it('should define Photo interface with photo_url', () => {\n      const componentPath = join(process.cwd(), 'components/guest/PhotoGallery.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify interface definition\n      const interfaceMatch = componentContent.match(/interface Photo \\{[^}]+\\}/s);\n      expect(interfaceMatch).toBeTruthy();\n      \n      if (interfaceMatch) {\n        const interfaceContent = interfaceMatch[0];\n        expect(interfaceContent).toContain('photo_url: string');\n        \n        // Check for standalone 'url: string' (not part of photo_url)\n        const hasStandaloneUrl = /\\burl:\\s*string/g.test(interfaceContent) && \n                                 !/photo_url:\\s*string/g.test(interfaceContent);\n        expect(hasStandaloneUrl).toBe(false);\n      }\n    });\n  });\n\n  describe('34.4 PhotoPicker Component Verification', () => {\n    it('should use photo_url field in PhotoPicker component', () => {\n      const componentPath = join(process.cwd(), 'components/admin/PhotoPicker.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify photo_url is used in interface\n      expect(componentContent).toContain('photo_url: string');\n      \n      // Verify photo_url is used in img src\n      expect(componentContent).toContain('src={photo.photo_url}');\n      \n      // Verify no deprecated 'url' field is used\n      expect(componentContent).not.toMatch(/photo\\.url[^_]/);\n    });\n\n    it('should display selected photos using photo_url', () => {\n      const componentPath = join(process.cwd(), 'components/admin/PhotoPicker.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify selected photos section uses photo_url\n      const selectedPhotosSection = componentContent.match(/Selected Photos[\\s\\S]*?<\\/div>/);\n      expect(selectedPhotosSection).toBeTruthy();\n      \n      // Verify photo_url is used in the selected photos display\n      expect(componentContent).toContain('src={photo.photo_url}');\n    });\n  });\n\n  describe('34.3 PhotoGalleryPreview Component Verification', () => {\n    it('should use photo_url field if PhotoGalleryPreview component exists', () => {\n      const componentPath = join(process.cwd(), 'components/admin/PhotoGalleryPreview.tsx');\n      \n      try {\n        const componentContent = readFileSync(componentPath, 'utf-8');\n\n        // Verify photo_url is used\n        expect(componentContent).toContain('photo_url');\n        \n        // Verify no deprecated 'url' field is used\n        expect(componentContent).not.toMatch(/photo\\.url[^_]/);\n      } catch (error) {\n        // Component might not exist yet, which is okay\n        console.warn('PhotoGalleryPreview component not found, skipping test');\n      }\n    });\n  });\n\n  describe('34.6 SectionRenderer Component Verification', () => {\n    it('should use photo_url field in SectionRenderer component', () => {\n      const componentPath = join(process.cwd(), 'components/guest/SectionRenderer.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify PhotoGallery is used (which uses photo_url)\n      expect(componentContent).toContain('PhotoGallery');\n      expect(componentContent).toContain('photoIds={column.content_data?.photo_ids || []}');\n      \n      // SectionRenderer delegates to PhotoGallery, so it indirectly uses photo_url\n      // No direct photo_url usage expected in SectionRenderer\n    });\n  });\n\n  describe('34.5 RichTextEditor Component Verification', () => {\n    it('should use photo_url field if RichTextEditor handles photos', () => {\n      const componentPath = join(process.cwd(), 'components/admin/RichTextEditor.tsx');\n      \n      try {\n        const componentContent = readFileSync(componentPath, 'utf-8');\n\n        // If RichTextEditor handles photos, it should use photo_url\n        if (componentContent.includes('photo') || componentContent.includes('image')) {\n          // Check for photo_url usage\n          const hasPhotoUrl = componentContent.includes('photo_url');\n          const hasDeprecatedUrl = componentContent.match(/photo\\.url[^_]/);\n          \n          if (hasPhotoUrl || hasDeprecatedUrl) {\n            expect(hasPhotoUrl).toBe(true);\n            expect(hasDeprecatedUrl).toBeFalsy();\n          }\n        }\n      } catch (error) {\n        // Component might not exist yet, which is okay\n        console.warn('RichTextEditor component not found, skipping test');\n      }\n    });\n  });\n\n  describe('34.8 No Deprecated url Field Usage', () => {\n    const componentsToCheck = [\n      'components/guest/PhotoGallery.tsx',\n      'components/admin/PhotoPicker.tsx',\n      'components/guest/SectionRenderer.tsx',\n    ];\n\n    componentsToCheck.forEach(componentPath => {\n      it(`should not use deprecated url field in ${componentPath}`, () => {\n        const fullPath = join(process.cwd(), componentPath);\n        \n        try {\n          const componentContent = readFileSync(fullPath, 'utf-8');\n\n          // Check for deprecated patterns\n          const deprecatedPatterns = [\n            /photo\\.url[^_]/g,  // photo.url (not photo.photo_url)\n            /currentPhoto\\.url[^_]/g,  // currentPhoto.url\n            /\\burl:\\s*string/g,  // url: string in interface (should be photo_url)\n          ];\n\n          deprecatedPatterns.forEach(pattern => {\n            const matches = componentContent.match(pattern);\n            if (matches) {\n              console.error(`Found deprecated pattern in ${componentPath}:`, matches);\n            }\n            expect(matches).toBeNull();\n          });\n        } catch (error) {\n          // Component might not exist, skip\n          console.warn(`Component ${componentPath} not found, skipping test`);\n        }\n      });\n    });\n  });\n\n  describe('34.10 Service Layer Verification', () => {\n    it('should use photo_url field in photoService', () => {\n      const servicePath = join(process.cwd(), 'services/photoService.ts');\n      \n      try {\n        const serviceContent = readFileSync(servicePath, 'utf-8');\n\n        // Verify photo_url is used in service\n        expect(serviceContent).toContain('photo_url');\n        \n        // Check for any deprecated 'url' field usage\n        // Allow 'url' in variable names like 'photoUrl' or 'cdnUrl'\n        const deprecatedMatches = serviceContent.match(/\\burl:\\s*string/g);\n        if (deprecatedMatches) {\n          // Filter out valid uses like 'photo_url' or 'cdnUrl'\n          const invalidMatches = deprecatedMatches.filter(match => \n            !match.includes('photo_url') && \n            !match.includes('cdnUrl') &&\n            !match.includes('storageUrl')\n          );\n          expect(invalidMatches.length).toBe(0);\n        }\n      } catch (error) {\n        console.warn('photoService not found, skipping test');\n      }\n    });\n  });\n\n  describe('Integration: End-to-End Field Consistency', () => {\n    it('should maintain photo_url consistency from database to UI', async () => {\n      // This test verifies the complete data flow:\n      // Database (photo_url) → API → Service → Component\n\n      // 1. Verify database has photo_url\n      const { data: dbPhoto, error: dbError } = await supabase\n        .from('photos')\n        .select('photo_url')\n        .eq('moderation_status', 'approved')\n        .limit(1)\n        .single();\n\n      if (dbError && dbError.code !== 'PGRST116') {\n        // PGRST116 is \"no rows returned\", which is okay\n        expect(dbError).toBeNull();\n      }\n\n      if (dbPhoto) {\n        // 2. Verify photo_url is a valid string\n        expect(dbPhoto).toHaveProperty('photo_url');\n        expect(typeof dbPhoto.photo_url).toBe('string');\n        expect(dbPhoto.photo_url.length).toBeGreaterThan(0);\n\n        // 3. Verify no 'url' field exists\n        expect(dbPhoto).not.toHaveProperty('url');\n      }\n    });\n\n    it('should use consistent field naming across all photo-related files', () => {\n      const filesToCheck = [\n        { path: 'components/guest/PhotoGallery.tsx', mustHavePhotoUrl: true },\n        { path: 'components/admin/PhotoPicker.tsx', mustHavePhotoUrl: true },\n        { path: 'components/guest/SectionRenderer.tsx', mustHavePhotoUrl: false }, // Delegates to PhotoGallery\n        { path: 'supabase/migrations/007_create_photos_table.sql', mustHavePhotoUrl: true },\n      ];\n\n      const results = filesToCheck.map(({ path: filePath, mustHavePhotoUrl }) => {\n        const fullPath = join(process.cwd(), filePath);\n        try {\n          const content = readFileSync(fullPath, 'utf-8');\n          return {\n            file: filePath,\n            hasPhotoUrl: content.includes('photo_url'),\n            mustHavePhotoUrl,\n            passed: !mustHavePhotoUrl || content.includes('photo_url'),\n          };\n        } catch (error) {\n          return {\n            file: filePath,\n            hasPhotoUrl: false,\n            mustHavePhotoUrl,\n            passed: !mustHavePhotoUrl,\n            error: 'File not found',\n          };\n        }\n      });\n\n      // Check that required files have photo_url\n      results.forEach(result => {\n        if (result.mustHavePhotoUrl && !result.error) {\n          expect(result.hasPhotoUrl).toBe(true);\n        }\n      });\n\n      // Log results for debugging\n      console.log('Field consistency check results:', results);\n    });\n  });\n});\n"],"names":["supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","describe","it","data","error","from","select","limit","expect","toBeNull","toBeDefined","single","not","toHaveProperty","code","toBe","migrationPath","join","cwd","migrationContent","readFileSync","toContain","toMatch","testPhotoId","beforeAll","photo","insert","uploader_id","photo_url","storage_type","page_type","page_id","caption","alt_text","moderation_status","id","afterAll","delete","eq","console","warn","photos","length","forEach","componentPath","componentContent","interfaceMatch","match","toBeTruthy","interfaceContent","hasStandaloneUrl","test","selectedPhotosSection","includes","hasPhotoUrl","hasDeprecatedUrl","toBeFalsy","componentsToCheck","fullPath","deprecatedPatterns","pattern","matches","servicePath","serviceContent","deprecatedMatches","invalidMatches","filter","dbPhoto","dbError","toBeGreaterThan","filesToCheck","path","mustHavePhotoUrl","results","map","filePath","content","file","passed","result","log"],"mappings":"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"}