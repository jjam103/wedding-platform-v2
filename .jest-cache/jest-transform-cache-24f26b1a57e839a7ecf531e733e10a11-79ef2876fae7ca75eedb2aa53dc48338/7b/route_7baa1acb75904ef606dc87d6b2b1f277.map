{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/guest-groups/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { createGroupSchema } from '@/schemas/groupSchemas';\nimport * as groupService from '@/services/groupService';\nimport { createAuthenticatedClient } from '@/lib/supabaseServer';\n\nfunction getStatusCode(errorCode: string): number {\n  const statusMap: Record<string, number> = {\n    'VALIDATION_ERROR': 400,\n    'NOT_FOUND': 404,\n    'CONFLICT': 409,\n    'DATABASE_ERROR': 500,\n    'UNKNOWN_ERROR': 500,\n  };\n  return statusMap[errorCode] || 500;\n}\n\n/**\n * GET /api/admin/guest-groups\n * List all guest groups\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. Authentication\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. Service call\n    const result = await groupService.list(supabase);\n    \n    // 3. Response\n    return NextResponse.json(result, { status: result.success ? 200 : getStatusCode(result.error.code) });\n    \n  } catch (error) {\n    console.error('GET /api/admin/guest-groups error:', error);\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/admin/guest-groups\n * Create a new guest group\n */\nexport async function POST(request: Request) {\n  try {\n    // 1. Authentication\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. Validation\n    const body = await request.json();\n    const validation = createGroupSchema.safeParse(body);\n    \n    if (!validation.success) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid request data', details: validation.error.issues } },\n        { status: 400 }\n      );\n    }\n    \n    // 3. Service call\n    const result = await groupService.create(supabase, validation.data);\n    \n    // 4. Response\n    return NextResponse.json(result, { status: result.success ? 201 : getStatusCode(result.error.code) });\n    \n  } catch (error) {\n    console.error('POST /api/admin/guest-groups error:', error);\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","getStatusCode","errorCode","statusMap","request","supabase","createAuthenticatedClient","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","result","groupService","list","console","body","validation","createGroupSchema","safeParse","details","issues","create"],"mappings":";;;;;;;;;;;QAoBsBA;eAAAA;;QAgCAC;eAAAA;;;wBApDO;8BACK;sEACJ;gCACY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE1C,SAASC,cAAcC,SAAiB;IACtC,MAAMC,YAAoC;QACxC,oBAAoB;QACpB,aAAa;QACb,YAAY;QACZ,kBAAkB;QAClB,iBAAiB;IACnB;IACA,OAAOA,SAAS,CAACD,UAAU,IAAI;AACjC;AAMO,eAAeH,IAAIK,OAAgB;IACxC,IAAI;QACF,oBAAoB;QACpB,MAAMC,WAAW,MAAMC,IAAAA,yCAAyB;QAChD,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,EAAEC,OAAOC,SAAS,EAAE,GAAG,MAAML,SAASM,IAAI,CAACC,UAAU;QAE9E,IAAIF,aAAa,CAACF,SAAS;YACzB,OAAOK,oBAAY,CAACC,IAAI,CACtB;gBAAEC,SAAS;gBAAON,OAAO;oBAAEO,MAAM;oBAAgBC,SAAS;gBAA0B;YAAE,GACtF;gBAAEC,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAMC,SAAS,MAAMC,cAAaC,IAAI,CAAChB;QAEvC,cAAc;QACd,OAAOQ,oBAAY,CAACC,IAAI,CAACK,QAAQ;YAAED,QAAQC,OAAOJ,OAAO,GAAG,MAAMd,cAAckB,OAAOV,KAAK,CAACO,IAAI;QAAE;IAErG,EAAE,OAAOP,OAAO;QACda,QAAQb,KAAK,CAAC,sCAAsCA;QACpD,OAAOI,oBAAY,CAACC,IAAI,CACtB;YAAEC,SAAS;YAAON,OAAO;gBAAEO,MAAM;gBAAkBC,SAAS;YAA+B;QAAE,GAC7F;YAAEC,QAAQ;QAAI;IAElB;AACF;AAMO,eAAelB,KAAKI,OAAgB;IACzC,IAAI;QACF,oBAAoB;QACpB,MAAMC,WAAW,MAAMC,IAAAA,yCAAyB;QAChD,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,EAAEC,OAAOC,SAAS,EAAE,GAAG,MAAML,SAASM,IAAI,CAACC,UAAU;QAE9E,IAAIF,aAAa,CAACF,SAAS;YACzB,OAAOK,oBAAY,CAACC,IAAI,CACtB;gBAAEC,SAAS;gBAAON,OAAO;oBAAEO,MAAM;oBAAgBC,SAAS;gBAA0B;YAAE,GACtF;gBAAEC,QAAQ;YAAI;QAElB;QAEA,gBAAgB;QAChB,MAAMK,OAAO,MAAMnB,QAAQU,IAAI;QAC/B,MAAMU,aAAaC,+BAAiB,CAACC,SAAS,CAACH;QAE/C,IAAI,CAACC,WAAWT,OAAO,EAAE;YACvB,OAAOF,oBAAY,CAACC,IAAI,CACtB;gBAAEC,SAAS;gBAAON,OAAO;oBAAEO,MAAM;oBAAoBC,SAAS;oBAAwBU,SAASH,WAAWf,KAAK,CAACmB,MAAM;gBAAC;YAAE,GACzH;gBAAEV,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAMC,SAAS,MAAMC,cAAaS,MAAM,CAACxB,UAAUmB,WAAWjB,IAAI;QAElE,cAAc;QACd,OAAOM,oBAAY,CAACC,IAAI,CAACK,QAAQ;YAAED,QAAQC,OAAOJ,OAAO,GAAG,MAAMd,cAAckB,OAAOV,KAAK,CAACO,IAAI;QAAE;IAErG,EAAE,OAAOP,OAAO;QACda,QAAQb,KAAK,CAAC,uCAAuCA;QACrD,OAAOI,oBAAY,CAACC,IAAI,CACtB;YAAEC,SAAS;YAAON,OAAO;gBAAEO,MAAM;gBAAkBC,SAAS;YAA+B;QAAE,GAC7F;YAAEC,QAAQ;QAAI;IAElB;AACF"}