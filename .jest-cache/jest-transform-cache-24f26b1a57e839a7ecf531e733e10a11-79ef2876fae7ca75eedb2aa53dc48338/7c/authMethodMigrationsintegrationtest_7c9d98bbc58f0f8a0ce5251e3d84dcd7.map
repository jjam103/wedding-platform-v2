{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/authMethodMigrations.integration.test.ts"],"sourcesContent":["/**\n * Integration tests for authentication method database migrations\n * Tests migrations 036 and 037\n * \n * Requirements: 5.1, 5.2, 5.3, 5.9, 22.1, 22.2\n * Tasks: 4.1, 4.2\n */\n\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\n\ndescribe('Authentication Method Migrations', () => {\n  let supabase: ReturnType<typeof createClient>;\n  let testGroupId: string;\n  let testGuestId: string;\n\n  beforeAll(async () => {\n    supabase = createClient(supabaseUrl, supabaseServiceKey);\n\n    // Create test group\n    const { data: group, error: groupError } = await supabase\n      .from('groups')\n      .insert({ name: 'Test Auth Group' })\n      .select()\n      .single();\n\n    if (groupError) throw groupError;\n    testGroupId = group.id;\n  });\n\n  afterAll(async () => {\n    // Clean up test data\n    if (testGuestId) {\n      await supabase.from('guests').delete().eq('id', testGuestId);\n    }\n    if (testGroupId) {\n      await supabase.from('groups').delete().eq('id', testGroupId);\n    }\n  });\n\n  describe('Migration 036: auth_method field', () => {\n    it('should have auth_method column on guests table', async () => {\n      const { data, error } = await supabase\n        .from('guests')\n        .select('auth_method')\n        .limit(1);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should default auth_method to email_matching for new guests', async () => {\n      const { data: guest, error } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'Test',\n          last_name: 'Guest',\n          email: 'test.auth@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(guest).toBeDefined();\n      expect(guest.auth_method).toBe('email_matching');\n\n      testGuestId = guest.id;\n    });\n\n    it('should allow setting auth_method to magic_link', async () => {\n      const { data: guest, error } = await supabase\n        .from('guests')\n        .update({ auth_method: 'magic_link' })\n        .eq('id', testGuestId)\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(guest).toBeDefined();\n      expect(guest.auth_method).toBe('magic_link');\n    });\n\n    it('should reject invalid auth_method values', async () => {\n      const { error } = await supabase\n        .from('guests')\n        .update({ auth_method: 'invalid_method' as any })\n        .eq('id', testGuestId);\n\n      expect(error).not.toBeNull();\n      expect(error?.message).toContain('auth_method');\n    });\n\n    it('should have default_auth_method column on system_settings table', async () => {\n      const { data, error } = await supabase\n        .from('system_settings')\n        .select('default_auth_method')\n        .limit(1);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      if (data && data.length > 0) {\n        expect(data[0].default_auth_method).toBe('email_matching');\n      }\n    });\n\n    it('should allow updating default_auth_method in system_settings', async () => {\n      // Get existing settings\n      const { data: settings } = await supabase\n        .from('system_settings')\n        .select('id')\n        .limit(1)\n        .single();\n\n      if (settings) {\n        const { data: updated, error } = await supabase\n          .from('system_settings')\n          .update({ default_auth_method: 'magic_link' })\n          .eq('id', settings.id)\n          .select()\n          .single();\n\n        expect(error).toBeNull();\n        expect(updated?.default_auth_method).toBe('magic_link');\n\n        // Reset to default\n        await supabase\n          .from('system_settings')\n          .update({ default_auth_method: 'email_matching' })\n          .eq('id', settings.id);\n      }\n    });\n\n    it('should have index on auth_method column', async () => {\n      // Query using auth_method to verify index exists\n      const { data, error } = await supabase\n        .from('guests')\n        .select('id, auth_method')\n        .eq('auth_method', 'email_matching')\n        .limit(10);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should have composite index on email and auth_method', async () => {\n      // Query using both email and auth_method to verify composite index\n      const { data, error } = await supabase\n        .from('guests')\n        .select('id, email, auth_method')\n        .eq('email', 'test.auth@example.com')\n        .eq('auth_method', 'email_matching')\n        .limit(1);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n  });\n\n  describe('Migration 037: magic_link_tokens table', () => {\n    let testTokenId: string;\n    const testToken = 'test_token_' + Math.random().toString(36).substring(7);\n\n    afterEach(async () => {\n      // Clean up test tokens\n      if (testTokenId) {\n        await supabase.from('magic_link_tokens').delete().eq('id', testTokenId);\n        testTokenId = '';\n      }\n    });\n\n    it('should create magic_link_tokens table', async () => {\n      const { data, error } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .limit(1);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n    });\n\n    it('should insert magic link token with required fields', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes\n\n      const { data: token, error } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken,\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(token).toBeDefined();\n      expect(token.token).toBe(testToken);\n      expect(token.guest_id).toBe(testGuestId);\n      expect(token.used).toBe(false);\n      expect(token.used_at).toBeNull();\n\n      testTokenId = token.id;\n    });\n\n    it('should enforce unique constraint on token', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n      // Insert first token\n      const { data: token1 } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_unique',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      testTokenId = token1!.id;\n\n      // Try to insert duplicate token\n      const { error } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_unique',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        });\n\n      expect(error).not.toBeNull();\n      expect(error?.message).toContain('duplicate');\n    });\n\n    it('should cascade delete tokens when guest is deleted', async () => {\n      // Create temporary guest\n      const { data: tempGuest } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'Temp',\n          last_name: 'Guest',\n          email: 'temp.guest@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        })\n        .select()\n        .single();\n\n      const tempGuestId = tempGuest!.id;\n\n      // Create token for temp guest\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: 'temp_token_' + Math.random().toString(36).substring(7),\n          guest_id: tempGuestId,\n          expires_at: new Date(Date.now() + 15 * 60 * 1000).toISOString(),\n        })\n        .select()\n        .single();\n\n      const tokenId = token!.id;\n\n      // Delete guest\n      await supabase.from('guests').delete().eq('id', tempGuestId);\n\n      // Verify token was cascade deleted\n      const { data: deletedToken } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('id', tokenId)\n        .single();\n\n      expect(deletedToken).toBeNull();\n    });\n\n    it('should have index on token column', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_index',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      testTokenId = token!.id;\n\n      // Query by token to verify index\n      const { data, error } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('token', testToken + '_index')\n        .single();\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data.token).toBe(testToken + '_index');\n    });\n\n    it('should have index on guest_id column', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_guest',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      testTokenId = token!.id;\n\n      // Query by guest_id to verify index\n      const { data, error } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('guest_id', testGuestId);\n\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data.length).toBeGreaterThan(0);\n    });\n\n    it('should store optional metadata fields', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n      const { data: token, error } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_metadata',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n          ip_address: '192.168.1.1',\n          user_agent: 'Mozilla/5.0 Test Browser',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(token).toBeDefined();\n      expect(token.ip_address).toBe('192.168.1.1');\n      expect(token.user_agent).toBe('Mozilla/5.0 Test Browser');\n\n      testTokenId = token.id;\n    });\n\n    it('should have mark_magic_link_token_used function', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n      // Create token\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_mark_used',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      testTokenId = token!.id;\n\n      // Call function to mark as used\n      const { data: result, error } = await supabase.rpc(\n        'mark_magic_link_token_used',\n        { token_value: testToken + '_mark_used' }\n      );\n\n      expect(error).toBeNull();\n      expect(result).toBe(true);\n\n      // Verify token is marked as used\n      const { data: usedToken } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('id', testTokenId)\n        .single();\n\n      expect(usedToken?.used).toBe(true);\n      expect(usedToken?.used_at).not.toBeNull();\n    });\n\n    it('should not mark expired token as used', async () => {\n      const expiresAt = new Date(Date.now() - 1000); // Expired 1 second ago\n\n      // Create expired token\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_expired',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      testTokenId = token!.id;\n\n      // Try to mark expired token as used\n      const { data: result } = await supabase.rpc(\n        'mark_magic_link_token_used',\n        { token_value: testToken + '_expired' }\n      );\n\n      expect(result).toBe(false);\n\n      // Verify token is still not marked as used\n      const { data: unusedToken } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('id', testTokenId)\n        .single();\n\n      expect(unusedToken?.used).toBe(false);\n    });\n\n    it('should not mark already used token as used again', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n      // Create token\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_already_used',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n          used: true,\n          used_at: new Date().toISOString(),\n        })\n        .select()\n        .single();\n\n      testTokenId = token!.id;\n\n      // Try to mark already used token\n      const { data: result } = await supabase.rpc(\n        'mark_magic_link_token_used',\n        { token_value: testToken + '_already_used' }\n      );\n\n      expect(result).toBe(false);\n    });\n\n    it('should have cleanup_expired_magic_link_tokens function', async () => {\n      // Create old expired token (25 hours ago)\n      const oldExpiresAt = new Date(Date.now() - 25 * 60 * 60 * 1000);\n\n      const { data: oldToken } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_old_expired',\n          guest_id: testGuestId,\n          expires_at: oldExpiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      const oldTokenId = oldToken!.id;\n\n      // Call cleanup function\n      const { error } = await supabase.rpc('cleanup_expired_magic_link_tokens');\n\n      expect(error).toBeNull();\n\n      // Verify old token was deleted\n      const { data: deletedToken } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('id', oldTokenId)\n        .single();\n\n      expect(deletedToken).toBeNull();\n    });\n  });\n\n  describe('Performance and Indexing', () => {\n    it('should efficiently query guests by email and auth_method', async () => {\n      const startTime = Date.now();\n\n      await supabase\n        .from('guests')\n        .select('id, email, auth_method')\n        .eq('email', 'test.auth@example.com')\n        .eq('auth_method', 'email_matching')\n        .single();\n\n      const queryTime = Date.now() - startTime;\n\n      // Query should complete in under 100ms with proper indexing\n      expect(queryTime).toBeLessThan(100);\n    });\n\n    it('should efficiently query magic link tokens by token', async () => {\n      const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: testToken + '_perf',\n          guest_id: testGuestId,\n          expires_at: expiresAt.toISOString(),\n        })\n        .select()\n        .single();\n\n      const testTokenId = token!.id;\n\n      const startTime = Date.now();\n\n      await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('token', testToken + '_perf')\n        .eq('used', false)\n        .gt('expires_at', new Date().toISOString())\n        .single();\n\n      const queryTime = Date.now() - startTime;\n\n      // Clean up\n      await supabase.from('magic_link_tokens').delete().eq('id', testTokenId);\n\n      // Query should complete in under 50ms with proper indexing\n      expect(queryTime).toBeLessThan(50);\n    });\n  });\n});\n"],"names":["supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceKey","SUPABASE_SERVICE_ROLE_KEY","describe","supabase","testGroupId","testGuestId","beforeAll","createClient","data","group","error","groupError","from","insert","name","select","single","id","afterAll","delete","eq","it","limit","expect","toBeNull","toBeDefined","guest","group_id","first_name","last_name","email","age_type","guest_type","auth_method","toBe","update","not","message","toContain","length","default_auth_method","settings","updated","testTokenId","testToken","Math","random","toString","substring","afterEach","expiresAt","Date","now","token","guest_id","expires_at","toISOString","used","used_at","token1","tempGuest","tempGuestId","tokenId","deletedToken","toBeGreaterThan","ip_address","user_agent","result","rpc","token_value","usedToken","unusedToken","oldExpiresAt","oldToken","oldTokenId","startTime","queryTime","toBeLessThan","gt"],"mappings":"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"}