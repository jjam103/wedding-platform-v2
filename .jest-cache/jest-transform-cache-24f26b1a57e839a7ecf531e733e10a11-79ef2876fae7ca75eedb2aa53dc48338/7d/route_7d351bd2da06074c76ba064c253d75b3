1127cbddbdcefe4173c39d9ebabdeeed
"use strict";

/* istanbul ignore next */
function cov_1f5xaxxhhe() {
  var path = "/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/photos/upload/route.ts";
  var hash = "c423204014605cd9afcd49359c293d9bb8857f6d";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/photos/upload/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 20
        }
      },
      "3": {
        start: {
          line: 11,
          column: 17
        },
        end: {
          line: 11,
          column: 54
        }
      },
      "4": {
        start: {
          line: 12,
          column: 16
        },
        end: {
          line: 12,
          column: 38
        }
      },
      "5": {
        start: {
          line: 13,
          column: 22
        },
        end: {
          line: 13,
          column: 66
        }
      },
      "6": {
        start: {
          line: 15,
          column: 4
        },
        end: {
          line: 151,
          column: 5
        }
      },
      "7": {
        start: {
          line: 16,
          column: 21
        },
        end: {
          line: 16,
          column: 63
        }
      },
      "8": {
        start: {
          line: 17,
          column: 8
        },
        end: {
          line: 27,
          column: 9
        }
      },
      "9": {
        start: {
          line: 18,
          column: 12
        },
        end: {
          line: 26,
          column: 15
        }
      },
      "10": {
        start: {
          line: 28,
          column: 35
        },
        end: {
          line: 28,
          column: 39
        }
      },
      "11": {
        start: {
          line: 30,
          column: 65
        },
        end: {
          line: 30,
          column: 140
        }
      },
      "12": {
        start: {
          line: 31,
          column: 8
        },
        end: {
          line: 41,
          column: 9
        }
      },
      "13": {
        start: {
          line: 32,
          column: 12
        },
        end: {
          line: 40,
          column: 15
        }
      },
      "14": {
        start: {
          line: 43,
          column: 25
        },
        end: {
          line: 43,
          column: 49
        }
      },
      "15": {
        start: {
          line: 44,
          column: 21
        },
        end: {
          line: 44,
          column: 41
        }
      },
      "16": {
        start: {
          line: 45,
          column: 24
        },
        end: {
          line: 45,
          column: 47
        }
      },
      "17": {
        start: {
          line: 46,
          column: 24
        },
        end: {
          line: 46,
          column: 48
        }
      },
      "18": {
        start: {
          line: 47,
          column: 25
        },
        end: {
          line: 47,
          column: 62
        }
      },
      "19": {
        start: {
          line: 48,
          column: 23
        },
        end: {
          line: 48,
          column: 46
        }
      },
      "20": {
        start: {
          line: 49,
          column: 8
        },
        end: {
          line: 59,
          column: 9
        }
      },
      "21": {
        start: {
          line: 50,
          column: 12
        },
        end: {
          line: 58,
          column: 15
        }
      },
      "22": {
        start: {
          line: 61,
          column: 8
        },
        end: {
          line: 71,
          column: 9
        }
      },
      "23": {
        start: {
          line: 62,
          column: 12
        },
        end: {
          line: 70,
          column: 15
        }
      },
      "24": {
        start: {
          line: 73,
          column: 8
        },
        end: {
          line: 83,
          column: 9
        }
      },
      "25": {
        start: {
          line: 74,
          column: 12
        },
        end: {
          line: 82,
          column: 15
        }
      },
      "26": {
        start: {
          line: 85,
          column: 26
        },
        end: {
          line: 85,
          column: 36
        }
      },
      "27": {
        start: {
          line: 86,
          column: 29
        },
        end: {
          line: 86,
          column: 68
        }
      },
      "28": {
        start: {
          line: 87,
          column: 24
        },
        end: {
          line: 87,
          column: 50
        }
      },
      "29": {
        start: {
          line: 88,
          column: 25
        },
        end: {
          line: 88,
          column: 66
        }
      },
      "30": {
        start: {
          line: 89,
          column: 25
        },
        end: {
          line: 89,
          column: 45
        }
      },
      "31": {
        start: {
          line: 91,
          column: 57
        },
        end: {
          line: 94,
          column: 10
        }
      },
      "32": {
        start: {
          line: 95,
          column: 8
        },
        end: {
          line: 105,
          column: 9
        }
      },
      "33": {
        start: {
          line: 96,
          column: 12
        },
        end: {
          line: 104,
          column: 15
        }
      },
      "34": {
        start: {
          line: 107,
          column: 34
        },
        end: {
          line: 107,
          column: 96
        }
      },
      "35": {
        start: {
          line: 109,
          column: 51
        },
        end: {
          line: 119,
          column: 28
        }
      },
      "36": {
        start: {
          line: 120,
          column: 8
        },
        end: {
          line: 134,
          column: 9
        }
      },
      "37": {
        start: {
          line: 122,
          column: 12
        },
        end: {
          line: 124,
          column: 15
        }
      },
      "38": {
        start: {
          line: 125,
          column: 12
        },
        end: {
          line: 133,
          column: 15
        }
      },
      "39": {
        start: {
          line: 135,
          column: 8
        },
        end: {
          line: 140,
          column: 11
        }
      },
      "40": {
        start: {
          line: 142,
          column: 8
        },
        end: {
          line: 150,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "POST",
        decl: {
          start: {
            line: 14,
            column: 15
          },
          end: {
            line: 14,
            column: 19
          }
        },
        loc: {
          start: {
            line: 14,
            column: 29
          },
          end: {
            line: 152,
            column: 1
          }
        },
        line: 14
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 17,
            column: 8
          },
          end: {
            line: 27,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 17,
            column: 8
          },
          end: {
            line: 27,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 17
      },
      "1": {
        loc: {
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 31
      },
      "2": {
        loc: {
          start: {
            line: 31,
            column: 12
          },
          end: {
            line: 31,
            column: 46
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 31,
            column: 12
          },
          end: {
            line: 31,
            column: 29
          }
        }, {
          start: {
            line: 31,
            column: 33
          },
          end: {
            line: 31,
            column: 46
          }
        }],
        line: 31
      },
      "3": {
        loc: {
          start: {
            line: 47,
            column: 25
          },
          end: {
            line: 47,
            column: 62
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 47,
            column: 25
          },
          end: {
            line: 47,
            column: 50
          }
        }, {
          start: {
            line: 47,
            column: 54
          },
          end: {
            line: 47,
            column: 62
          }
        }],
        line: 47
      },
      "4": {
        loc: {
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 59,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 59,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 49
      },
      "5": {
        loc: {
          start: {
            line: 61,
            column: 8
          },
          end: {
            line: 71,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 61,
            column: 8
          },
          end: {
            line: 71,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 61
      },
      "6": {
        loc: {
          start: {
            line: 73,
            column: 8
          },
          end: {
            line: 83,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 73,
            column: 8
          },
          end: {
            line: 83,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 73
      },
      "7": {
        loc: {
          start: {
            line: 95,
            column: 8
          },
          end: {
            line: 105,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 95,
            column: 8
          },
          end: {
            line: 105,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 95
      },
      "8": {
        loc: {
          start: {
            line: 115,
            column: 21
          },
          end: {
            line: 115,
            column: 79
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 115,
            column: 31
          },
          end: {
            line: 115,
            column: 72
          }
        }, {
          start: {
            line: 115,
            column: 75
          },
          end: {
            line: 115,
            column: 79
          }
        }],
        line: 115
      },
      "9": {
        loc: {
          start: {
            line: 116,
            column: 22
          },
          end: {
            line: 116,
            column: 80
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 116,
            column: 32
          },
          end: {
            line: 116,
            column: 73
          }
        }, {
          start: {
            line: 116,
            column: 76
          },
          end: {
            line: 116,
            column: 80
          }
        }],
        line: 116
      },
      "10": {
        loc: {
          start: {
            line: 120,
            column: 8
          },
          end: {
            line: 134,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 120,
            column: 8
          },
          end: {
            line: 134,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 120
      },
      "11": {
        loc: {
          start: {
            line: 146,
            column: 25
          },
          end: {
            line: 146,
            column: 81
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 146,
            column: 50
          },
          end: {
            line: 146,
            column: 63
          }
        }, {
          start: {
            line: 146,
            column: 66
          },
          end: {
            line: 146,
            column: 81
          }
        }],
        line: 146
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0
    },
    f: {
      "0": 0,
      "1": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/photos/upload/route.ts"],
      sourcesContent: ["import { getAuthenticatedUser } from '@/lib/apiAuth';\nimport { NextResponse } from 'next/server';\nimport { sanitizeInput } from '@/utils/sanitization';\n\n/**\n * POST /api/guest/photos/upload\n * \n * Uploads a photo from a guest to the wedding gallery.\n * Photos are queued for moderation before appearing publicly.\n * \n * Requirements: 13.9, 11.1, 11.11\n */\nexport async function POST(request: Request) {\n  try {\n    const auth = await getAuthenticatedUser();\n    \n    if (!auth) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    const { user, supabase } = auth;\n    \n    // Get current guest\n    const { data: currentGuest, error: currentGuestError } = await supabase\n      .from('guests')\n      .select('id')\n      .eq('email', user.email)\n      .single();\n    \n    if (currentGuestError || !currentGuest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'GUEST_NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // Parse form data\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n    const caption = formData.get('caption') as string;\n    const altText = formData.get('alt_text') as string;\n    const pageType = formData.get('page_type') as string || 'memory';\n    const pageId = formData.get('page_id') as string | null;\n    \n    if (!file) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'No file provided' } },\n        { status: 400 }\n      );\n    }\n    \n    // Validate file type\n    if (!file.type.startsWith('image/')) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'File must be an image' } },\n        { status: 400 }\n      );\n    }\n    \n    // Validate file size (10MB limit)\n    if (file.size > 10 * 1024 * 1024) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'File size must be less than 10MB' } },\n        { status: 400 }\n      );\n    }\n    \n    // Generate unique filename\n    const timestamp = Date.now();\n    const randomString = Math.random().toString(36).substring(7);\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${timestamp}-${randomString}.${fileExt}`;\n    const filePath = `photos/${fileName}`;\n    \n    // Upload to Supabase Storage\n    const { data: uploadData, error: uploadError } = await supabase.storage\n      .from('wedding-photos')\n      .upload(filePath, file, {\n        contentType: file.type,\n        cacheControl: '3600',\n      });\n    \n    if (uploadError) {\n      return NextResponse.json(\n        { success: false, error: { code: 'STORAGE_ERROR', message: uploadError.message } },\n        { status: 500 }\n      );\n    }\n    \n    // Get public URL\n    const { data: urlData } = supabase.storage\n      .from('wedding-photos')\n      .getPublicUrl(filePath);\n    \n    // Create photo record in database\n    const { data: photo, error: photoError } = await supabase\n      .from('photos')\n      .insert({\n        uploader_id: user.id,\n        photo_url: urlData.publicUrl,\n        storage_type: 'supabase',\n        page_type: pageType,\n        page_id: pageId,\n        caption: caption ? sanitizeInput(caption) : null,\n        alt_text: altText ? sanitizeInput(altText) : null,\n        moderation_status: 'pending',\n        created_at: new Date().toISOString(),\n      })\n      .select()\n      .single();\n    \n    if (photoError) {\n      // Clean up uploaded file if database insert fails\n      await supabase.storage.from('wedding-photos').remove([filePath]);\n      \n      return NextResponse.json(\n        { success: false, error: { code: 'DATABASE_ERROR', message: photoError.message } },\n        { status: 500 }\n      );\n    }\n    \n    return NextResponse.json({ success: true, data: photo }, { status: 201 });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],
      names: ["POST", "request", "auth", "getAuthenticatedUser", "NextResponse", "json", "success", "error", "code", "message", "status", "user", "supabase", "data", "currentGuest", "currentGuestError", "from", "select", "eq", "email", "single", "formData", "file", "get", "caption", "altText", "pageType", "pageId", "type", "startsWith", "size", "timestamp", "Date", "now", "randomString", "Math", "random", "toString", "substring", "fileExt", "name", "split", "pop", "fileName", "filePath", "uploadData", "uploadError", "storage", "upload", "contentType", "cacheControl", "urlData", "getPublicUrl", "photo", "photoError", "insert", "uploader_id", "id", "photo_url", "publicUrl", "storage_type", "page_type", "page_id", "sanitizeInput", "alt_text", "moderation_status", "created_at", "toISOString", "remove", "Error"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "c423204014605cd9afcd49359c293d9bb8857f6d"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1f5xaxxhhe = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1f5xaxxhhe();
cov_1f5xaxxhhe().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_1f5xaxxhhe().s[1]++;
Object.defineProperty(exports, "POST", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_1f5xaxxhhe().f[0]++;
    cov_1f5xaxxhhe().s[2]++;
    return POST;
  }
});
const _apiAuth =
/* istanbul ignore next */
(cov_1f5xaxxhhe().s[3]++, require("../../../../../lib/apiAuth"));
const _server =
/* istanbul ignore next */
(cov_1f5xaxxhhe().s[4]++, require("next/server"));
const _sanitization =
/* istanbul ignore next */
(cov_1f5xaxxhhe().s[5]++, require("../../../../../utils/sanitization"));
async function POST(request) {
  /* istanbul ignore next */
  cov_1f5xaxxhhe().f[1]++;
  cov_1f5xaxxhhe().s[6]++;
  try {
    const auth =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[7]++, await (0, _apiAuth.getAuthenticatedUser)());
    /* istanbul ignore next */
    cov_1f5xaxxhhe().s[8]++;
    if (!auth) {
      /* istanbul ignore next */
      cov_1f5xaxxhhe().b[0][0]++;
      cov_1f5xaxxhhe().s[9]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'UNAUTHORIZED',
          message: 'Authentication required'
        }
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_1f5xaxxhhe().b[0][1]++;
    }
    const {
      user,
      supabase
    } =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[10]++, auth);
    // Get current guest
    const {
      data: currentGuest,
      error: currentGuestError
    } =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[11]++, await supabase.from('guests').select('id').eq('email', user.email).single());
    /* istanbul ignore next */
    cov_1f5xaxxhhe().s[12]++;
    if (
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().b[2][0]++, currentGuestError) ||
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().b[2][1]++, !currentGuest)) {
      /* istanbul ignore next */
      cov_1f5xaxxhhe().b[1][0]++;
      cov_1f5xaxxhhe().s[13]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'GUEST_NOT_FOUND',
          message: 'Guest not found'
        }
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_1f5xaxxhhe().b[1][1]++;
    }
    // Parse form data
    const formData =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[14]++, await request.formData());
    const file =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[15]++, formData.get('file'));
    const caption =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[16]++, formData.get('caption'));
    const altText =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[17]++, formData.get('alt_text'));
    const pageType =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[18]++,
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().b[3][0]++, formData.get('page_type')) ||
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().b[3][1]++, 'memory'));
    const pageId =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[19]++, formData.get('page_id'));
    /* istanbul ignore next */
    cov_1f5xaxxhhe().s[20]++;
    if (!file) {
      /* istanbul ignore next */
      cov_1f5xaxxhhe().b[4][0]++;
      cov_1f5xaxxhhe().s[21]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'No file provided'
        }
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1f5xaxxhhe().b[4][1]++;
    }
    // Validate file type
    cov_1f5xaxxhhe().s[22]++;
    if (!file.type.startsWith('image/')) {
      /* istanbul ignore next */
      cov_1f5xaxxhhe().b[5][0]++;
      cov_1f5xaxxhhe().s[23]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'File must be an image'
        }
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1f5xaxxhhe().b[5][1]++;
    }
    // Validate file size (10MB limit)
    cov_1f5xaxxhhe().s[24]++;
    if (file.size > 10 * 1024 * 1024) {
      /* istanbul ignore next */
      cov_1f5xaxxhhe().b[6][0]++;
      cov_1f5xaxxhhe().s[25]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'File size must be less than 10MB'
        }
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1f5xaxxhhe().b[6][1]++;
    }
    // Generate unique filename
    const timestamp =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[26]++, Date.now());
    const randomString =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[27]++, Math.random().toString(36).substring(7));
    const fileExt =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[28]++, file.name.split('.').pop());
    const fileName =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[29]++, `${timestamp}-${randomString}.${fileExt}`);
    const filePath =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[30]++, `photos/${fileName}`);
    // Upload to Supabase Storage
    const {
      data: uploadData,
      error: uploadError
    } =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[31]++, await supabase.storage.from('wedding-photos').upload(filePath, file, {
      contentType: file.type,
      cacheControl: '3600'
    }));
    /* istanbul ignore next */
    cov_1f5xaxxhhe().s[32]++;
    if (uploadError) {
      /* istanbul ignore next */
      cov_1f5xaxxhhe().b[7][0]++;
      cov_1f5xaxxhhe().s[33]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'STORAGE_ERROR',
          message: uploadError.message
        }
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_1f5xaxxhhe().b[7][1]++;
    }
    // Get public URL
    const {
      data: urlData
    } =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[34]++, supabase.storage.from('wedding-photos').getPublicUrl(filePath));
    // Create photo record in database
    const {
      data: photo,
      error: photoError
    } =
    /* istanbul ignore next */
    (cov_1f5xaxxhhe().s[35]++, await supabase.from('photos').insert({
      uploader_id: user.id,
      photo_url: urlData.publicUrl,
      storage_type: 'supabase',
      page_type: pageType,
      page_id: pageId,
      caption: caption ?
      /* istanbul ignore next */
      (cov_1f5xaxxhhe().b[8][0]++, (0, _sanitization.sanitizeInput)(caption)) :
      /* istanbul ignore next */
      (cov_1f5xaxxhhe().b[8][1]++, null),
      alt_text: altText ?
      /* istanbul ignore next */
      (cov_1f5xaxxhhe().b[9][0]++, (0, _sanitization.sanitizeInput)(altText)) :
      /* istanbul ignore next */
      (cov_1f5xaxxhhe().b[9][1]++, null),
      moderation_status: 'pending',
      created_at: new Date().toISOString()
    }).select().single());
    /* istanbul ignore next */
    cov_1f5xaxxhhe().s[36]++;
    if (photoError) {
      /* istanbul ignore next */
      cov_1f5xaxxhhe().b[10][0]++;
      cov_1f5xaxxhhe().s[37]++;
      // Clean up uploaded file if database insert fails
      await supabase.storage.from('wedding-photos').remove([filePath]);
      /* istanbul ignore next */
      cov_1f5xaxxhhe().s[38]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'DATABASE_ERROR',
          message: photoError.message
        }
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_1f5xaxxhhe().b[10][1]++;
    }
    cov_1f5xaxxhhe().s[39]++;
    return _server.NextResponse.json({
      success: true,
      data: photo
    }, {
      status: 201
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_1f5xaxxhhe().s[40]++;
    return _server.NextResponse.json({
      success: false,
      error: {
        code: 'UNKNOWN_ERROR',
        message: error instanceof Error ?
        /* istanbul ignore next */
        (cov_1f5xaxxhhe().b[11][0]++, error.message) :
        /* istanbul ignore next */
        (cov_1f5xaxxhhe().b[11][1]++, 'Unknown error')
      }
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMWY1eGF4eGhoZSIsImFjdHVhbENvdmVyYWdlIiwicyIsIlBPU1QiLCJyZXF1ZXN0IiwiZiIsImF1dGgiLCJfYXBpQXV0aCIsImdldEF1dGhlbnRpY2F0ZWRVc2VyIiwiYiIsIl9zZXJ2ZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJ1c2VyIiwic3VwYWJhc2UiLCJkYXRhIiwiY3VycmVudEd1ZXN0IiwiY3VycmVudEd1ZXN0RXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJlbWFpbCIsInNpbmdsZSIsImZvcm1EYXRhIiwiZmlsZSIsImdldCIsImNhcHRpb24iLCJhbHRUZXh0IiwicGFnZVR5cGUiLCJwYWdlSWQiLCJ0eXBlIiwic3RhcnRzV2l0aCIsInNpemUiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwicmFuZG9tU3RyaW5nIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiZmlsZUV4dCIsIm5hbWUiLCJzcGxpdCIsInBvcCIsImZpbGVOYW1lIiwiZmlsZVBhdGgiLCJ1cGxvYWREYXRhIiwidXBsb2FkRXJyb3IiLCJzdG9yYWdlIiwidXBsb2FkIiwiY29udGVudFR5cGUiLCJjYWNoZUNvbnRyb2wiLCJ1cmxEYXRhIiwiZ2V0UHVibGljVXJsIiwicGhvdG8iLCJwaG90b0Vycm9yIiwiaW5zZXJ0IiwidXBsb2FkZXJfaWQiLCJpZCIsInBob3RvX3VybCIsInB1YmxpY1VybCIsInN0b3JhZ2VfdHlwZSIsInBhZ2VfdHlwZSIsInBhZ2VfaWQiLCJfc2FuaXRpemF0aW9uIiwic2FuaXRpemVJbnB1dCIsImFsdF90ZXh0IiwibW9kZXJhdGlvbl9zdGF0dXMiLCJjcmVhdGVkX2F0IiwidG9JU09TdHJpbmciLCJyZW1vdmUiLCJFcnJvciJdLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9ndWVzdC9waG90b3MvdXBsb2FkL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEF1dGhlbnRpY2F0ZWRVc2VyIH0gZnJvbSAnQC9saWIvYXBpQXV0aCc7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBzYW5pdGl6ZUlucHV0IH0gZnJvbSAnQC91dGlscy9zYW5pdGl6YXRpb24nO1xuXG4vKipcbiAqIFBPU1QgL2FwaS9ndWVzdC9waG90b3MvdXBsb2FkXG4gKiBcbiAqIFVwbG9hZHMgYSBwaG90byBmcm9tIGEgZ3Vlc3QgdG8gdGhlIHdlZGRpbmcgZ2FsbGVyeS5cbiAqIFBob3RvcyBhcmUgcXVldWVkIGZvciBtb2RlcmF0aW9uIGJlZm9yZSBhcHBlYXJpbmcgcHVibGljbHkuXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMTMuOSwgMTEuMSwgMTEuMTFcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGF1dGggPSBhd2FpdCBnZXRBdXRoZW50aWNhdGVkVXNlcigpO1xuICAgIFxuICAgIGlmICghYXV0aCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBjb2RlOiAnVU5BVVRIT1JJWkVEJywgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyB9IH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHVzZXIsIHN1cGFiYXNlIH0gPSBhdXRoO1xuICAgIFxuICAgIC8vIEdldCBjdXJyZW50IGd1ZXN0XG4gICAgY29uc3QgeyBkYXRhOiBjdXJyZW50R3Vlc3QsIGVycm9yOiBjdXJyZW50R3Vlc3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdndWVzdHMnKVxuICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgLmVxKCdlbWFpbCcsIHVzZXIuZW1haWwpXG4gICAgICAuc2luZ2xlKCk7XG4gICAgXG4gICAgaWYgKGN1cnJlbnRHdWVzdEVycm9yIHx8ICFjdXJyZW50R3Vlc3QpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ0dVRVNUX05PVF9GT1VORCcsIG1lc3NhZ2U6ICdHdWVzdCBub3QgZm91bmQnIH0gfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBQYXJzZSBmb3JtIGRhdGFcbiAgICBjb25zdCBmb3JtRGF0YSA9IGF3YWl0IHJlcXVlc3QuZm9ybURhdGEoKTtcbiAgICBjb25zdCBmaWxlID0gZm9ybURhdGEuZ2V0KCdmaWxlJykgYXMgRmlsZTtcbiAgICBjb25zdCBjYXB0aW9uID0gZm9ybURhdGEuZ2V0KCdjYXB0aW9uJykgYXMgc3RyaW5nO1xuICAgIGNvbnN0IGFsdFRleHQgPSBmb3JtRGF0YS5nZXQoJ2FsdF90ZXh0JykgYXMgc3RyaW5nO1xuICAgIGNvbnN0IHBhZ2VUeXBlID0gZm9ybURhdGEuZ2V0KCdwYWdlX3R5cGUnKSBhcyBzdHJpbmcgfHwgJ21lbW9yeSc7XG4gICAgY29uc3QgcGFnZUlkID0gZm9ybURhdGEuZ2V0KCdwYWdlX2lkJykgYXMgc3RyaW5nIHwgbnVsbDtcbiAgICBcbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLCBtZXNzYWdlOiAnTm8gZmlsZSBwcm92aWRlZCcgfSB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIC8vIFZhbGlkYXRlIGZpbGUgdHlwZVxuICAgIGlmICghZmlsZS50eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJywgbWVzc2FnZTogJ0ZpbGUgbXVzdCBiZSBhbiBpbWFnZScgfSB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIC8vIFZhbGlkYXRlIGZpbGUgc2l6ZSAoMTBNQiBsaW1pdClcbiAgICBpZiAoZmlsZS5zaXplID4gMTAgKiAxMDI0ICogMTAyNCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsIG1lc3NhZ2U6ICdGaWxlIHNpemUgbXVzdCBiZSBsZXNzIHRoYW4gMTBNQicgfSB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZVxuICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG4gICAgY29uc3QgcmFuZG9tU3RyaW5nID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpO1xuICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcbiAgICBjb25zdCBmaWxlTmFtZSA9IGAke3RpbWVzdGFtcH0tJHtyYW5kb21TdHJpbmd9LiR7ZmlsZUV4dH1gO1xuICAgIGNvbnN0IGZpbGVQYXRoID0gYHBob3Rvcy8ke2ZpbGVOYW1lfWA7XG4gICAgXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcbiAgICBjb25zdCB7IGRhdGE6IHVwbG9hZERhdGEsIGVycm9yOiB1cGxvYWRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZVxuICAgICAgLmZyb20oJ3dlZGRpbmctcGhvdG9zJylcbiAgICAgIC51cGxvYWQoZmlsZVBhdGgsIGZpbGUsIHtcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSxcbiAgICAgICAgY2FjaGVDb250cm9sOiAnMzYwMCcsXG4gICAgICB9KTtcbiAgICBcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ1NUT1JBR0VfRVJST1InLCBtZXNzYWdlOiB1cGxvYWRFcnJvci5tZXNzYWdlIH0gfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZXQgcHVibGljIFVSTFxuICAgIGNvbnN0IHsgZGF0YTogdXJsRGF0YSB9ID0gc3VwYWJhc2Uuc3RvcmFnZVxuICAgICAgLmZyb20oJ3dlZGRpbmctcGhvdG9zJylcbiAgICAgIC5nZXRQdWJsaWNVcmwoZmlsZVBhdGgpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBwaG90byByZWNvcmQgaW4gZGF0YWJhc2VcbiAgICBjb25zdCB7IGRhdGE6IHBob3RvLCBlcnJvcjogcGhvdG9FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwaG90b3MnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHVwbG9hZGVyX2lkOiB1c2VyLmlkLFxuICAgICAgICBwaG90b191cmw6IHVybERhdGEucHVibGljVXJsLFxuICAgICAgICBzdG9yYWdlX3R5cGU6ICdzdXBhYmFzZScsXG4gICAgICAgIHBhZ2VfdHlwZTogcGFnZVR5cGUsXG4gICAgICAgIHBhZ2VfaWQ6IHBhZ2VJZCxcbiAgICAgICAgY2FwdGlvbjogY2FwdGlvbiA/IHNhbml0aXplSW5wdXQoY2FwdGlvbikgOiBudWxsLFxuICAgICAgICBhbHRfdGV4dDogYWx0VGV4dCA/IHNhbml0aXplSW5wdXQoYWx0VGV4dCkgOiBudWxsLFxuICAgICAgICBtb2RlcmF0aW9uX3N0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG4gICAgXG4gICAgaWYgKHBob3RvRXJyb3IpIHtcbiAgICAgIC8vIENsZWFuIHVwIHVwbG9hZGVkIGZpbGUgaWYgZGF0YWJhc2UgaW5zZXJ0IGZhaWxzXG4gICAgICBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlLmZyb20oJ3dlZGRpbmctcGhvdG9zJykucmVtb3ZlKFtmaWxlUGF0aF0pO1xuICAgICAgXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsIG1lc3NhZ2U6IHBob3RvRXJyb3IubWVzc2FnZSB9IH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogcGhvdG8gfSwgeyBzdGF0dXM6IDIwMSB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBY0k7SUFB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