08b78634b5aedb4cf6d3b920a3bcdb5b
"use strict";

/* istanbul ignore next */
function cov_1ca5yryfnl() {
  var path = "/Users/jaron/Desktop/wedding-platform-v2/app/api/auth/guest/magic-link/route.ts";
  var hash = "7810931263767ecda682c89adde9a22a4117a246";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/jaron/Desktop/wedding-platform-v2/app/api/auth/guest/magic-link/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 20
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 38
        }
      },
      "4": {
        start: {
          line: 12,
          column: 18
        },
        end: {
          line: 12,
          column: 56
        }
      },
      "5": {
        start: {
          line: 13,
          column: 13
        },
        end: {
          line: 13,
          column: 27
        }
      },
      "6": {
        start: {
          line: 14,
          column: 22
        },
        end: {
          line: 14,
          column: 66
        }
      },
      "7": {
        start: {
          line: 23,
          column: 35
        },
        end: {
          line: 25,
          column: 2
        }
      },
      "8": {
        start: {
          line: 27,
          column: 4
        },
        end: {
          line: 134,
          column: 5
        }
      },
      "9": {
        start: {
          line: 29,
          column: 21
        },
        end: {
          line: 29,
          column: 41
        }
      },
      "10": {
        start: {
          line: 30,
          column: 27
        },
        end: {
          line: 30,
          column: 65
        }
      },
      "11": {
        start: {
          line: 31,
          column: 8
        },
        end: {
          line: 42,
          column: 9
        }
      },
      "12": {
        start: {
          line: 32,
          column: 12
        },
        end: {
          line: 41,
          column: 15
        }
      },
      "13": {
        start: {
          line: 44,
          column: 22
        },
        end: {
          line: 44,
          column: 91
        }
      },
      "14": {
        start: {
          line: 46,
          column: 25
        },
        end: {
          line: 46,
          column: 62
        }
      },
      "15": {
        start: {
          line: 48,
          column: 51
        },
        end: {
          line: 48,
          column: 196
        }
      },
      "16": {
        start: {
          line: 49,
          column: 8
        },
        end: {
          line: 59,
          column: 9
        }
      },
      "17": {
        start: {
          line: 50,
          column: 12
        },
        end: {
          line: 58,
          column: 15
        }
      },
      "18": {
        start: {
          line: 61,
          column: 27
        },
        end: {
          line: 61,
          column: 69
        }
      },
      "19": {
        start: {
          line: 62,
          column: 22
        },
        end: {
          line: 62,
          column: 95
        }
      },
      "20": {
        start: {
          line: 62,
          column: 54
        },
        end: {
          line: 62,
          column: 85
        }
      },
      "21": {
        start: {
          line: 64,
          column: 26
        },
        end: {
          line: 64,
          column: 63
        }
      },
      "22": {
        start: {
          line: 66,
          column: 38
        },
        end: {
          line: 72,
          column: 10
        }
      },
      "23": {
        start: {
          line: 73,
          column: 8
        },
        end: {
          line: 84,
          column: 9
        }
      },
      "24": {
        start: {
          line: 74,
          column: 12
        },
        end: {
          line: 74,
          column: 75
        }
      },
      "25": {
        start: {
          line: 75,
          column: 12
        },
        end: {
          line: 83,
          column: 15
        }
      },
      "26": {
        start: {
          line: 86,
          column: 24
        },
        end: {
          line: 86,
          column: 78
        }
      },
      "27": {
        start: {
          line: 87,
          column: 29
        },
        end: {
          line: 87,
          column: 80
        }
      },
      "28": {
        start: {
          line: 91,
          column: 8
        },
        end: {
          line: 91,
          column: 64
        }
      },
      "29": {
        start: {
          line: 105,
          column: 8
        },
        end: {
          line: 113,
          column: 11
        }
      },
      "30": {
        start: {
          line: 115,
          column: 8
        },
        end: {
          line: 122,
          column: 11
        }
      },
      "31": {
        start: {
          line: 124,
          column: 8
        },
        end: {
          line: 124,
          column: 58
        }
      },
      "32": {
        start: {
          line: 125,
          column: 8
        },
        end: {
          line: 133,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "POST",
        decl: {
          start: {
            line: 26,
            column: 15
          },
          end: {
            line: 26,
            column: 19
          }
        },
        loc: {
          start: {
            line: 26,
            column: 29
          },
          end: {
            line: 135,
            column: 1
          }
        },
        line: 26
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 62,
            column: 49
          },
          end: {
            line: 62,
            column: 50
          }
        },
        loc: {
          start: {
            line: 62,
            column: 54
          },
          end: {
            line: 62,
            column: 85
          }
        },
        line: 62
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 42,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 42,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 31
      },
      "1": {
        loc: {
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 59,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 59,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 49
      },
      "2": {
        loc: {
          start: {
            line: 49,
            column: 12
          },
          end: {
            line: 49,
            column: 32
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 49,
            column: 12
          },
          end: {
            line: 49,
            column: 22
          }
        }, {
          start: {
            line: 49,
            column: 26
          },
          end: {
            line: 49,
            column: 32
          }
        }],
        line: 49
      },
      "3": {
        loc: {
          start: {
            line: 70,
            column: 24
          },
          end: {
            line: 70,
            column: 111
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 70,
            column: 24
          },
          end: {
            line: 70,
            column: 62
          }
        }, {
          start: {
            line: 70,
            column: 66
          },
          end: {
            line: 70,
            column: 98
          }
        }, {
          start: {
            line: 70,
            column: 102
          },
          end: {
            line: 70,
            column: 111
          }
        }],
        line: 70
      },
      "4": {
        loc: {
          start: {
            line: 71,
            column: 24
          },
          end: {
            line: 71,
            column: 70
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 71,
            column: 24
          },
          end: {
            line: 71,
            column: 57
          }
        }, {
          start: {
            line: 71,
            column: 61
          },
          end: {
            line: 71,
            column: 70
          }
        }],
        line: 71
      },
      "5": {
        loc: {
          start: {
            line: 73,
            column: 8
          },
          end: {
            line: 84,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 73,
            column: 8
          },
          end: {
            line: 84,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 73
      },
      "6": {
        loc: {
          start: {
            line: 86,
            column: 24
          },
          end: {
            line: 86,
            column: 78
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 86,
            column: 24
          },
          end: {
            line: 86,
            column: 51
          }
        }, {
          start: {
            line: 86,
            column: 55
          },
          end: {
            line: 86,
            column: 78
          }
        }],
        line: 86
      },
      "7": {
        loc: {
          start: {
            line: 111,
            column: 28
          },
          end: {
            line: 111,
            column: 115
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 111,
            column: 28
          },
          end: {
            line: 111,
            column: 66
          }
        }, {
          start: {
            line: 111,
            column: 70
          },
          end: {
            line: 111,
            column: 102
          }
        }, {
          start: {
            line: 111,
            column: 106
          },
          end: {
            line: 111,
            column: 115
          }
        }],
        line: 111
      },
      "8": {
        loc: {
          start: {
            line: 129,
            column: 25
          },
          end: {
            line: 129,
            column: 90
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 129,
            column: 50
          },
          end: {
            line: 129,
            column: 63
          }
        }, {
          start: {
            line: 129,
            column: 66
          },
          end: {
            line: 129,
            column: 90
          }
        }],
        line: 129
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0, 0],
      "8": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/jaron/Desktop/wedding-platform-v2/app/api/auth/guest/magic-link/route.ts"],
      sourcesContent: ["import { NextResponse } from 'next/server';\nimport { createSupabaseClient } from '@/lib/supabase';\nimport { z } from 'zod';\nimport { sanitizeInput } from '@/utils/sanitization';\n\n/**\n * Magic Link Request API Route\n * \n * Generates a secure one-time token and sends it via email to the guest.\n * The token is valid for 15 minutes and can only be used once.\n * \n * Requirements: 5.3, 5.9\n * Task: 6.1\n */\n\nconst magicLinkRequestSchema = z.object({\n  email: z.string().email('Invalid email format'),\n});\n\n/**\n * POST /api/auth/guest/magic-link\n * \n * Request a magic link for passwordless authentication.\n * \n * @param request - Request containing email in body\n * @returns Success response with message, or error response\n */\nexport async function POST(request: Request) {\n  try {\n    // 1. Parse and validate request body\n    const body = await request.json();\n    const validation = magicLinkRequestSchema.safeParse(body);\n    \n    if (!validation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid email format',\n            details: validation.error.issues,\n          },\n        },\n        { status: 400 }\n      );\n    }\n    \n    // 2. Sanitize email input\n    const email = sanitizeInput(validation.data.email.toLowerCase());\n    \n    // 3. Create Supabase client\n    const supabase = createSupabaseClient();\n    \n    // 4. Find guest by email with magic_link auth method\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, email, first_name, last_name, auth_method')\n      .eq('email', email)\n      .eq('auth_method', 'magic_link')\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'NOT_FOUND',\n            message: 'Email not found or not configured for magic link authentication',\n          },\n        },\n        { status: 404 }\n      );\n    }\n    \n    // 5. Generate secure token (32 bytes = 64 hex characters)\n    const tokenBytes = crypto.getRandomValues(new Uint8Array(32));\n    const token = Array.from(tokenBytes)\n      .map(b => b.toString(16).padStart(2, '0'))\n      .join('');\n    \n    // 6. Calculate expiration (15 minutes from now)\n    const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n    \n    // 7. Store token in database\n    const { error: tokenError } = await supabase\n      .from('magic_link_tokens')\n      .insert({\n        guest_id: guest.id,\n        token,\n        expires_at: expiresAt.toISOString(),\n        ip_address: request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown',\n        user_agent: request.headers.get('user-agent') || 'unknown',\n      });\n    \n    if (tokenError) {\n      console.error('Failed to store magic link token:', tokenError);\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'TOKEN_ERROR',\n            message: 'Failed to generate magic link',\n          },\n        },\n        { status: 500 }\n      );\n    }\n    \n    // 8. Generate magic link URL\n    const baseUrl = process.env.NEXT_PUBLIC_URL || 'http://localhost:3000';\n    const magicLinkUrl = `${baseUrl}/auth/guest-login/verify?token=${token}`;\n    \n    // 9. Send email with magic link\n    // Note: Email sending will be implemented when emailService is integrated\n    // For now, we'll log the link (in production, this would send an actual email)\n    console.log(`Magic link for ${email}: ${magicLinkUrl}`);\n    \n    // TODO: Implement email sending\n    // await emailService.send({\n    //   to: email,\n    //   subject: 'Your Wedding Portal Login Link',\n    //   html: `\n    //     <p>Hi ${guest.first_name},</p>\n    //     <p>Click the link below to log in to the wedding portal:</p>\n    //     <p><a href=\"${magicLinkUrl}\">Log In</a></p>\n    //     <p>This link will expire in 15 minutes and can only be used once.</p>\n    //     <p>If you didn't request this link, you can safely ignore this email.</p>\n    //   `,\n    // });\n    \n    // 10. Log magic link request in audit log\n    await supabase.from('audit_logs').insert({\n      action: 'magic_link_requested',\n      entity_type: 'guest',\n      entity_id: guest.id,\n      details: {\n        email: guest.email,\n        ip_address: request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown',\n      },\n    });\n    \n    // 11. Return success response (don't reveal if email exists for security)\n    return NextResponse.json(\n      {\n        success: true,\n        data: {\n          message: 'If your email is registered, you will receive a login link shortly.',\n        },\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('Magic link request error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error occurred',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],
      names: ["POST", "magicLinkRequestSchema", "z", "object", "email", "string", "request", "body", "json", "validation", "safeParse", "success", "NextResponse", "error", "code", "message", "details", "issues", "status", "sanitizeInput", "data", "toLowerCase", "supabase", "createSupabaseClient", "guest", "guestError", "from", "select", "eq", "single", "tokenBytes", "crypto", "getRandomValues", "Uint8Array", "token", "Array", "map", "b", "toString", "padStart", "join", "expiresAt", "Date", "now", "tokenError", "insert", "guest_id", "id", "expires_at", "toISOString", "ip_address", "headers", "get", "user_agent", "console", "baseUrl", "process", "env", "NEXT_PUBLIC_URL", "magicLinkUrl", "log", "action", "entity_type", "entity_id", "Error"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "7810931263767ecda682c89adde9a22a4117a246"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1ca5yryfnl = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1ca5yryfnl();
cov_1ca5yryfnl().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_1ca5yryfnl().s[1]++;
Object.defineProperty(exports, "POST", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_1ca5yryfnl().f[0]++;
    cov_1ca5yryfnl().s[2]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_1ca5yryfnl().s[3]++, require("next/server"));
const _supabase =
/* istanbul ignore next */
(cov_1ca5yryfnl().s[4]++, require("../../../../../lib/supabase"));
const _zod =
/* istanbul ignore next */
(cov_1ca5yryfnl().s[5]++, require("zod"));
const _sanitization =
/* istanbul ignore next */
(cov_1ca5yryfnl().s[6]++, require("../../../../../utils/sanitization"));
/**
 * Magic Link Request API Route
 * 
 * Generates a secure one-time token and sends it via email to the guest.
 * The token is valid for 15 minutes and can only be used once.
 * 
 * Requirements: 5.3, 5.9
 * Task: 6.1
 */
const magicLinkRequestSchema =
/* istanbul ignore next */
(cov_1ca5yryfnl().s[7]++, _zod.z.object({
  email: _zod.z.string().email('Invalid email format')
}));
async function POST(request) {
  /* istanbul ignore next */
  cov_1ca5yryfnl().f[1]++;
  cov_1ca5yryfnl().s[8]++;
  try {
    // 1. Parse and validate request body
    const body =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[9]++, await request.json());
    const validation =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[10]++, magicLinkRequestSchema.safeParse(body));
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[11]++;
    if (!validation.success) {
      /* istanbul ignore next */
      cov_1ca5yryfnl().b[0][0]++;
      cov_1ca5yryfnl().s[12]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'Invalid email format',
          details: validation.error.issues
        }
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1ca5yryfnl().b[0][1]++;
    }
    // 2. Sanitize email input
    const email =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[13]++, (0, _sanitization.sanitizeInput)(validation.data.email.toLowerCase()));
    // 3. Create Supabase client
    const supabase =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[14]++, (0, _supabase.createSupabaseClient)());
    // 4. Find guest by email with magic_link auth method
    const {
      data: guest,
      error: guestError
    } =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[15]++, await supabase.from('guests').select('id, email, first_name, last_name, auth_method').eq('email', email).eq('auth_method', 'magic_link').single());
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[16]++;
    if (
    /* istanbul ignore next */
    (cov_1ca5yryfnl().b[2][0]++, guestError) ||
    /* istanbul ignore next */
    (cov_1ca5yryfnl().b[2][1]++, !guest)) {
      /* istanbul ignore next */
      cov_1ca5yryfnl().b[1][0]++;
      cov_1ca5yryfnl().s[17]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'NOT_FOUND',
          message: 'Email not found or not configured for magic link authentication'
        }
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_1ca5yryfnl().b[1][1]++;
    }
    // 5. Generate secure token (32 bytes = 64 hex characters)
    const tokenBytes =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[18]++, crypto.getRandomValues(new Uint8Array(32)));
    const token =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[19]++, Array.from(tokenBytes).map(b => {
      /* istanbul ignore next */
      cov_1ca5yryfnl().f[2]++;
      cov_1ca5yryfnl().s[20]++;
      return b.toString(16).padStart(2, '0');
    }).join(''));
    // 6. Calculate expiration (15 minutes from now)
    const expiresAt =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[21]++, new Date(Date.now() + 15 * 60 * 1000));
    // 7. Store token in database
    const {
      error: tokenError
    } =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[22]++, await supabase.from('magic_link_tokens').insert({
      guest_id: guest.id,
      token,
      expires_at: expiresAt.toISOString(),
      ip_address:
      /* istanbul ignore next */
      (cov_1ca5yryfnl().b[3][0]++, request.headers.get('x-forwarded-for')) ||
      /* istanbul ignore next */
      (cov_1ca5yryfnl().b[3][1]++, request.headers.get('x-real-ip')) ||
      /* istanbul ignore next */
      (cov_1ca5yryfnl().b[3][2]++, 'unknown'),
      user_agent:
      /* istanbul ignore next */
      (cov_1ca5yryfnl().b[4][0]++, request.headers.get('user-agent')) ||
      /* istanbul ignore next */
      (cov_1ca5yryfnl().b[4][1]++, 'unknown')
    }));
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[23]++;
    if (tokenError) {
      /* istanbul ignore next */
      cov_1ca5yryfnl().b[5][0]++;
      cov_1ca5yryfnl().s[24]++;
      console.error('Failed to store magic link token:', tokenError);
      /* istanbul ignore next */
      cov_1ca5yryfnl().s[25]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'TOKEN_ERROR',
          message: 'Failed to generate magic link'
        }
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_1ca5yryfnl().b[5][1]++;
    }
    // 8. Generate magic link URL
    const baseUrl =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[26]++,
    /* istanbul ignore next */
    (cov_1ca5yryfnl().b[6][0]++, process.env.NEXT_PUBLIC_URL) ||
    /* istanbul ignore next */
    (cov_1ca5yryfnl().b[6][1]++, 'http://localhost:3000'));
    const magicLinkUrl =
    /* istanbul ignore next */
    (cov_1ca5yryfnl().s[27]++, `${baseUrl}/auth/guest-login/verify?token=${token}`);
    // 9. Send email with magic link
    // Note: Email sending will be implemented when emailService is integrated
    // For now, we'll log the link (in production, this would send an actual email)
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[28]++;
    console.log(`Magic link for ${email}: ${magicLinkUrl}`);
    // TODO: Implement email sending
    // await emailService.send({
    //   to: email,
    //   subject: 'Your Wedding Portal Login Link',
    //   html: `
    //     <p>Hi ${guest.first_name},</p>
    //     <p>Click the link below to log in to the wedding portal:</p>
    //     <p><a href="${magicLinkUrl}">Log In</a></p>
    //     <p>This link will expire in 15 minutes and can only be used once.</p>
    //     <p>If you didn't request this link, you can safely ignore this email.</p>
    //   `,
    // });
    // 10. Log magic link request in audit log
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[29]++;
    await supabase.from('audit_logs').insert({
      action: 'magic_link_requested',
      entity_type: 'guest',
      entity_id: guest.id,
      details: {
        email: guest.email,
        ip_address:
        /* istanbul ignore next */
        (cov_1ca5yryfnl().b[7][0]++, request.headers.get('x-forwarded-for')) ||
        /* istanbul ignore next */
        (cov_1ca5yryfnl().b[7][1]++, request.headers.get('x-real-ip')) ||
        /* istanbul ignore next */
        (cov_1ca5yryfnl().b[7][2]++, 'unknown')
      }
    });
    // 11. Return success response (don't reveal if email exists for security)
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[30]++;
    return _server.NextResponse.json({
      success: true,
      data: {
        message: 'If your email is registered, you will receive a login link shortly.'
      }
    }, {
      status: 200
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[31]++;
    console.error('Magic link request error:', error);
    /* istanbul ignore next */
    cov_1ca5yryfnl().s[32]++;
    return _server.NextResponse.json({
      success: false,
      error: {
        code: 'UNKNOWN_ERROR',
        message: error instanceof Error ?
        /* istanbul ignore next */
        (cov_1ca5yryfnl().b[8][0]++, error.message) :
        /* istanbul ignore next */
        (cov_1ca5yryfnl().b[8][1]++, 'Unknown error occurred')
      }
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQT1NUIiwibWFnaWNMaW5rUmVxdWVzdFNjaGVtYSIsImNvdl8xY2E1eXJ5Zm5sIiwicyIsIl96b2QiLCJ6Iiwib2JqZWN0IiwiZW1haWwiLCJzdHJpbmciLCJyZXF1ZXN0IiwiZiIsImJvZHkiLCJqc29uIiwidmFsaWRhdGlvbiIsInNhZmVQYXJzZSIsInN1Y2Nlc3MiLCJiIiwiX3NlcnZlciIsIk5leHRSZXNwb25zZSIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJkZXRhaWxzIiwiaXNzdWVzIiwic3RhdHVzIiwiX3Nhbml0aXphdGlvbiIsInNhbml0aXplSW5wdXQiLCJkYXRhIiwidG9Mb3dlckNhc2UiLCJzdXBhYmFzZSIsIl9zdXBhYmFzZSIsImNyZWF0ZVN1cGFiYXNlQ2xpZW50IiwiZ3Vlc3QiLCJndWVzdEVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwidG9rZW5CeXRlcyIsImNyeXB0byIsImdldFJhbmRvbVZhbHVlcyIsIlVpbnQ4QXJyYXkiLCJ0b2tlbiIsIkFycmF5IiwibWFwIiwidG9TdHJpbmciLCJwYWRTdGFydCIsImpvaW4iLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwidG9rZW5FcnJvciIsImluc2VydCIsImd1ZXN0X2lkIiwiaWQiLCJleHBpcmVzX2F0IiwidG9JU09TdHJpbmciLCJpcF9hZGRyZXNzIiwiaGVhZGVycyIsImdldCIsInVzZXJfYWdlbnQiLCJjb25zb2xlIiwiYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19VUkwiLCJtYWdpY0xpbmtVcmwiLCJsb2ciLCJhY3Rpb24iLCJlbnRpdHlfdHlwZSIsImVudGl0eV9pZCIsIkVycm9yIl0sInNvdXJjZXMiOlsiL1VzZXJzL2phcm9uL0Rlc2t0b3Avd2VkZGluZy1wbGF0Zm9ybS12Mi9hcHAvYXBpL2F1dGgvZ3Vlc3QvbWFnaWMtbGluay9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjcmVhdGVTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgc2FuaXRpemVJbnB1dCB9IGZyb20gJ0AvdXRpbHMvc2FuaXRpemF0aW9uJztcblxuLyoqXG4gKiBNYWdpYyBMaW5rIFJlcXVlc3QgQVBJIFJvdXRlXG4gKiBcbiAqIEdlbmVyYXRlcyBhIHNlY3VyZSBvbmUtdGltZSB0b2tlbiBhbmQgc2VuZHMgaXQgdmlhIGVtYWlsIHRvIHRoZSBndWVzdC5cbiAqIFRoZSB0b2tlbiBpcyB2YWxpZCBmb3IgMTUgbWludXRlcyBhbmQgY2FuIG9ubHkgYmUgdXNlZCBvbmNlLlxuICogXG4gKiBSZXF1aXJlbWVudHM6IDUuMywgNS45XG4gKiBUYXNrOiA2LjFcbiAqL1xuXG5jb25zdCBtYWdpY0xpbmtSZXF1ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgnSW52YWxpZCBlbWFpbCBmb3JtYXQnKSxcbn0pO1xuXG4vKipcbiAqIFBPU1QgL2FwaS9hdXRoL2d1ZXN0L21hZ2ljLWxpbmtcbiAqIFxuICogUmVxdWVzdCBhIG1hZ2ljIGxpbmsgZm9yIHBhc3N3b3JkbGVzcyBhdXRoZW50aWNhdGlvbi5cbiAqIFxuICogQHBhcmFtIHJlcXVlc3QgLSBSZXF1ZXN0IGNvbnRhaW5pbmcgZW1haWwgaW4gYm9keVxuICogQHJldHVybnMgU3VjY2VzcyByZXNwb25zZSB3aXRoIG1lc3NhZ2UsIG9yIGVycm9yIHJlc3BvbnNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBQYXJzZSBhbmQgdmFsaWRhdGUgcmVxdWVzdCBib2R5XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBtYWdpY0xpbmtSZXF1ZXN0U2NoZW1hLnNhZmVQYXJzZShib2R5KTtcbiAgICBcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGVtYWlsIGZvcm1hdCcsXG4gICAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIC8vIDIuIFNhbml0aXplIGVtYWlsIGlucHV0XG4gICAgY29uc3QgZW1haWwgPSBzYW5pdGl6ZUlucHV0KHZhbGlkYXRpb24uZGF0YS5lbWFpbC50b0xvd2VyQ2FzZSgpKTtcbiAgICBcbiAgICAvLyAzLiBDcmVhdGUgU3VwYWJhc2UgY2xpZW50XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTdXBhYmFzZUNsaWVudCgpO1xuICAgIFxuICAgIC8vIDQuIEZpbmQgZ3Vlc3QgYnkgZW1haWwgd2l0aCBtYWdpY19saW5rIGF1dGggbWV0aG9kXG4gICAgY29uc3QgeyBkYXRhOiBndWVzdCwgZXJyb3I6IGd1ZXN0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnZ3Vlc3RzJylcbiAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBhdXRoX21ldGhvZCcpXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXG4gICAgICAuZXEoJ2F1dGhfbWV0aG9kJywgJ21hZ2ljX2xpbmsnKVxuICAgICAgLnNpbmdsZSgpO1xuICAgIFxuICAgIGlmIChndWVzdEVycm9yIHx8ICFndWVzdCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0VtYWlsIG5vdCBmb3VuZCBvciBub3QgY29uZmlndXJlZCBmb3IgbWFnaWMgbGluayBhdXRoZW50aWNhdGlvbicsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyA1LiBHZW5lcmF0ZSBzZWN1cmUgdG9rZW4gKDMyIGJ5dGVzID0gNjQgaGV4IGNoYXJhY3RlcnMpXG4gICAgY29uc3QgdG9rZW5CeXRlcyA9IGNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoMzIpKTtcbiAgICBjb25zdCB0b2tlbiA9IEFycmF5LmZyb20odG9rZW5CeXRlcylcbiAgICAgIC5tYXAoYiA9PiBiLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpKVxuICAgICAgLmpvaW4oJycpO1xuICAgIFxuICAgIC8vIDYuIENhbGN1bGF0ZSBleHBpcmF0aW9uICgxNSBtaW51dGVzIGZyb20gbm93KVxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAxNSAqIDYwICogMTAwMCk7XG4gICAgXG4gICAgLy8gNy4gU3RvcmUgdG9rZW4gaW4gZGF0YWJhc2VcbiAgICBjb25zdCB7IGVycm9yOiB0b2tlbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ21hZ2ljX2xpbmtfdG9rZW5zJylcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICBndWVzdF9pZDogZ3Vlc3QuaWQsXG4gICAgICAgIHRva2VuLFxuICAgICAgICBleHBpcmVzX2F0OiBleHBpcmVzQXQudG9JU09TdHJpbmcoKSxcbiAgICAgICAgaXBfYWRkcmVzczogcmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHwgcmVxdWVzdC5oZWFkZXJzLmdldCgneC1yZWFsLWlwJykgfHwgJ3Vua25vd24nLFxuICAgICAgICB1c2VyX2FnZW50OiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nLFxuICAgICAgfSk7XG4gICAgXG4gICAgaWYgKHRva2VuRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzdG9yZSBtYWdpYyBsaW5rIHRva2VuOicsIHRva2VuRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdUT0tFTl9FUlJPUicsXG4gICAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGdlbmVyYXRlIG1hZ2ljIGxpbmsnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgLy8gOC4gR2VuZXJhdGUgbWFnaWMgbGluayBVUkxcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xuICAgIGNvbnN0IG1hZ2ljTGlua1VybCA9IGAke2Jhc2VVcmx9L2F1dGgvZ3Vlc3QtbG9naW4vdmVyaWZ5P3Rva2VuPSR7dG9rZW59YDtcbiAgICBcbiAgICAvLyA5LiBTZW5kIGVtYWlsIHdpdGggbWFnaWMgbGlua1xuICAgIC8vIE5vdGU6IEVtYWlsIHNlbmRpbmcgd2lsbCBiZSBpbXBsZW1lbnRlZCB3aGVuIGVtYWlsU2VydmljZSBpcyBpbnRlZ3JhdGVkXG4gICAgLy8gRm9yIG5vdywgd2UnbGwgbG9nIHRoZSBsaW5rIChpbiBwcm9kdWN0aW9uLCB0aGlzIHdvdWxkIHNlbmQgYW4gYWN0dWFsIGVtYWlsKVxuICAgIGNvbnNvbGUubG9nKGBNYWdpYyBsaW5rIGZvciAke2VtYWlsfTogJHttYWdpY0xpbmtVcmx9YCk7XG4gICAgXG4gICAgLy8gVE9ETzogSW1wbGVtZW50IGVtYWlsIHNlbmRpbmdcbiAgICAvLyBhd2FpdCBlbWFpbFNlcnZpY2Uuc2VuZCh7XG4gICAgLy8gICB0bzogZW1haWwsXG4gICAgLy8gICBzdWJqZWN0OiAnWW91ciBXZWRkaW5nIFBvcnRhbCBMb2dpbiBMaW5rJyxcbiAgICAvLyAgIGh0bWw6IGBcbiAgICAvLyAgICAgPHA+SGkgJHtndWVzdC5maXJzdF9uYW1lfSw8L3A+XG4gICAgLy8gICAgIDxwPkNsaWNrIHRoZSBsaW5rIGJlbG93IHRvIGxvZyBpbiB0byB0aGUgd2VkZGluZyBwb3J0YWw6PC9wPlxuICAgIC8vICAgICA8cD48YSBocmVmPVwiJHttYWdpY0xpbmtVcmx9XCI+TG9nIEluPC9hPjwvcD5cbiAgICAvLyAgICAgPHA+VGhpcyBsaW5rIHdpbGwgZXhwaXJlIGluIDE1IG1pbnV0ZXMgYW5kIGNhbiBvbmx5IGJlIHVzZWQgb25jZS48L3A+XG4gICAgLy8gICAgIDxwPklmIHlvdSBkaWRuJ3QgcmVxdWVzdCB0aGlzIGxpbmssIHlvdSBjYW4gc2FmZWx5IGlnbm9yZSB0aGlzIGVtYWlsLjwvcD5cbiAgICAvLyAgIGAsXG4gICAgLy8gfSk7XG4gICAgXG4gICAgLy8gMTAuIExvZyBtYWdpYyBsaW5rIHJlcXVlc3QgaW4gYXVkaXQgbG9nXG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnYXVkaXRfbG9ncycpLmluc2VydCh7XG4gICAgICBhY3Rpb246ICdtYWdpY19saW5rX3JlcXVlc3RlZCcsXG4gICAgICBlbnRpdHlfdHlwZTogJ2d1ZXN0JyxcbiAgICAgIGVudGl0eV9pZDogZ3Vlc3QuaWQsXG4gICAgICBkZXRhaWxzOiB7XG4gICAgICAgIGVtYWlsOiBndWVzdC5lbWFpbCxcbiAgICAgICAgaXBfYWRkcmVzczogcmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHwgcmVxdWVzdC5oZWFkZXJzLmdldCgneC1yZWFsLWlwJykgfHwgJ3Vua25vd24nLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBcbiAgICAvLyAxMS4gUmV0dXJuIHN1Y2Nlc3MgcmVzcG9uc2UgKGRvbid0IHJldmVhbCBpZiBlbWFpbCBleGlzdHMgZm9yIHNlY3VyaXR5KVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG1lc3NhZ2U6ICdJZiB5b3VyIGVtYWlsIGlzIHJlZ2lzdGVyZWQsIHlvdSB3aWxsIHJlY2VpdmUgYSBsb2dpbiBsaW5rIHNob3J0bHkuJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogMjAwIH1cbiAgICApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ01hZ2ljIGxpbmsgcmVxdWVzdCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvciBvY2N1cnJlZCcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OytCQTJCc0I7Ozs7OztXQUFBQSxJQUFBOzs7OztrQ0EzQk87OztrQ0FDUTs7O2tDQUNuQjs7O2tDQUNZO0FBRTlCOzs7Ozs7Ozs7QUFVQSxNQUFNQyxzQkFBQTtBQUFBO0FBQUEsQ0FBQUMsY0FBQSxHQUFBQyxDQUFBLE9BQXlCQyxJQUFBLENBQUFDLENBQUMsQ0FBQ0MsTUFBTSxDQUFDO0VBQ3RDQyxLQUFBLEVBQU9ILElBQUEsQ0FBQUMsQ0FBQyxDQUFDRyxNQUFNLEdBQUdELEtBQUssQ0FBQztB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