{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/lib/apiAuth.test.ts"],"sourcesContent":["/**\n * Unit tests for API Authentication utilities\n * \n * Tests authentication and authorization helpers for API routes.\n */\n\nimport { describe, it, expect, jest, beforeEach } from '@jest/globals';\n\n// Mock Next.js headers\njest.mock('next/headers', () => ({\n  cookies: jest.fn(),\n}));\n\n// Mock Supabase SSR\njest.mock('@supabase/ssr', () => ({\n  createServerClient: jest.fn(),\n}));\n\ndescribe('apiAuth', () => {\n  let mockCookieStore: any;\n  let mockSupabaseClient: any;\n  let createApiClient: any;\n  let getAuthenticatedUser: any;\n  let getAuthorizedAdmin: any;\n\n  beforeEach(async () => {\n    jest.clearAllMocks();\n\n    // Setup mock cookie store\n    mockCookieStore = {\n      getAll: jest.fn().mockReturnValue([]),\n      set: jest.fn(),\n    };\n\n    // Setup mock Supabase client\n    mockSupabaseClient = {\n      auth: {\n        getUser: jest.fn(),\n      },\n      from: jest.fn(),\n    };\n\n    // Mock cookies() to return our mock store\n    const { cookies } = require('next/headers');\n    (cookies as jest.Mock).mockResolvedValue(mockCookieStore);\n\n    // Mock createServerClient to return our mock client\n    const { createServerClient } = require('@supabase/ssr');\n    (createServerClient as jest.Mock).mockReturnValue(mockSupabaseClient);\n\n    // Import functions after mocks are set up\n    const apiAuth = require('./apiAuth');\n    createApiClient = apiAuth.createApiClient;\n    getAuthenticatedUser = apiAuth.getAuthenticatedUser;\n    getAuthorizedAdmin = apiAuth.getAuthorizedAdmin;\n  });\n\n  describe('createApiClient', () => {\n    it('should create Supabase client with cookie handling', async () => {\n      const { createServerClient } = require('@supabase/ssr');\n      \n      await createApiClient();\n      \n      expect(createServerClient).toHaveBeenCalledWith(\n        process.env.NEXT_PUBLIC_SUPABASE_URL,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n        expect.objectContaining({\n          cookies: expect.objectContaining({\n            getAll: expect.any(Function),\n            setAll: expect.any(Function),\n          }),\n        })\n      );\n    });\n\n    it('should return Supabase client instance', async () => {\n      const client = await createApiClient();\n      \n      expect(client).toBeDefined();\n      expect(client).toBe(mockSupabaseClient);\n    });\n\n    it('should handle cookie getAll correctly', async () => {\n      const mockCookies = [\n        { name: 'session', value: 'abc123' },\n        { name: 'refresh', value: 'xyz789' },\n      ];\n      mockCookieStore.getAll.mockReturnValue(mockCookies);\n      \n      await createApiClient();\n      \n      const { createServerClient } = require('@supabase/ssr');\n      const cookiesConfig = (createServerClient as jest.Mock).mock.calls[0][2].cookies;\n      \n      const result = cookiesConfig.getAll();\n      expect(result).toEqual(mockCookies);\n    });\n\n    it('should handle cookie setAll correctly', async () => {\n      await createApiClient();\n      \n      const { createServerClient } = require('@supabase/ssr');\n      const cookiesConfig = (createServerClient as jest.Mock).mock.calls[0][2].cookies;\n      \n      const cookiesToSet = [\n        { name: 'session', value: 'new123', options: {} },\n        { name: 'refresh', value: 'new789', options: {} },\n      ];\n      \n      cookiesConfig.setAll(cookiesToSet);\n      \n      expect(mockCookieStore.set).toHaveBeenCalledTimes(2);\n      expect(mockCookieStore.set).toHaveBeenCalledWith('session', 'new123', {});\n      expect(mockCookieStore.set).toHaveBeenCalledWith('refresh', 'new789', {});\n    });\n  });\n\n  describe('getAuthenticatedUser', () => {\n    it('should return user and supabase client when authenticated', async () => {\n      const mockUser = { id: 'user-123', email: 'test@example.com' };\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n      \n      const result = await getAuthenticatedUser();\n      \n      expect(result).toBeDefined();\n      expect(result?.user).toEqual(mockUser);\n      expect(result?.supabase).toBeDefined();\n    });\n\n    it('should return null when user is not authenticated', async () => {\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: null },\n        error: null,\n      });\n      \n      const result = await getAuthenticatedUser();\n      \n      expect(result).toBeNull();\n    });\n\n    it('should return null when auth error occurs', async () => {\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Invalid token' },\n      });\n      \n      const result = await getAuthenticatedUser();\n      \n      expect(result).toBeNull();\n    });\n\n    it('should throw error when getUser throws error', async () => {\n      // Mock getUser to reject with an error\n      mockSupabaseClient.auth.getUser = jest.fn().mockImplementation(() => {\n        return Promise.reject(new Error('Network error'));\n      });\n      \n      await expect(getAuthenticatedUser()).rejects.toThrow('Network error');\n    });\n  });\n\n  describe('getAuthorizedAdmin', () => {\n    it('should return user, supabase, and role for super_admin', async () => {\n      const mockUser = { id: 'user-123', email: 'admin@example.com' };\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      const mockFrom = jest.fn().mockReturnThis();\n      const mockSelect = jest.fn().mockReturnThis();\n      const mockEq = jest.fn().mockReturnThis();\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: { role: 'super_admin' },\n        error: null,\n      });\n\n      mockSupabaseClient.from = mockFrom;\n      mockFrom.mockReturnValue({\n        select: mockSelect,\n      });\n      mockSelect.mockReturnValue({\n        eq: mockEq,\n      });\n      mockEq.mockReturnValue({\n        single: mockSingle,\n      });\n      \n      const result = await getAuthorizedAdmin();\n      \n      expect(result).toBeDefined();\n      expect(result?.user).toEqual(mockUser);\n      expect(result?.role).toBe('super_admin');\n      expect(result?.supabase).toBeDefined();\n    });\n\n    it('should return user, supabase, and role for host', async () => {\n      const mockUser = { id: 'user-123', email: 'host@example.com' };\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      const mockFrom = jest.fn().mockReturnThis();\n      const mockSelect = jest.fn().mockReturnThis();\n      const mockEq = jest.fn().mockReturnThis();\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: { role: 'host' },\n        error: null,\n      });\n\n      mockSupabaseClient.from = mockFrom;\n      mockFrom.mockReturnValue({\n        select: mockSelect,\n      });\n      mockSelect.mockReturnValue({\n        eq: mockEq,\n      });\n      mockEq.mockReturnValue({\n        single: mockSingle,\n      });\n      \n      const result = await getAuthorizedAdmin();\n      \n      expect(result).toBeDefined();\n      expect(result?.role).toBe('host');\n    });\n\n    it('should return null when user is not authenticated', async () => {\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: null },\n        error: null,\n      });\n      \n      const result = await getAuthorizedAdmin();\n      \n      expect(result).toBeNull();\n    });\n\n    it('should return null when user role is guest', async () => {\n      const mockUser = { id: 'user-123', email: 'guest@example.com' };\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      const mockFrom = jest.fn().mockReturnThis();\n      const mockSelect = jest.fn().mockReturnThis();\n      const mockEq = jest.fn().mockReturnThis();\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: { role: 'guest' },\n        error: null,\n      });\n\n      mockSupabaseClient.from = mockFrom;\n      mockFrom.mockReturnValue({\n        select: mockSelect,\n      });\n      mockSelect.mockReturnValue({\n        eq: mockEq,\n      });\n      mockEq.mockReturnValue({\n        single: mockSingle,\n      });\n      \n      const result = await getAuthorizedAdmin();\n      \n      expect(result).toBeNull();\n    });\n\n    it('should return null when database query fails', async () => {\n      const mockUser = { id: 'user-123', email: 'admin@example.com' };\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      const mockFrom = jest.fn().mockReturnThis();\n      const mockSelect = jest.fn().mockReturnThis();\n      const mockEq = jest.fn().mockReturnThis();\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database error' },\n      });\n\n      mockSupabaseClient.from = mockFrom;\n      mockFrom.mockReturnValue({\n        select: mockSelect,\n      });\n      mockSelect.mockReturnValue({\n        eq: mockEq,\n      });\n      mockEq.mockReturnValue({\n        single: mockSingle,\n      });\n      \n      const result = await getAuthorizedAdmin();\n      \n      expect(result).toBeNull();\n    });\n\n    it('should return null when user data is not found', async () => {\n      const mockUser = { id: 'user-123', email: 'admin@example.com' };\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      const mockFrom = jest.fn().mockReturnThis();\n      const mockSelect = jest.fn().mockReturnThis();\n      const mockEq = jest.fn().mockReturnThis();\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: null,\n        error: null,\n      });\n\n      mockSupabaseClient.from = mockFrom;\n      mockFrom.mockReturnValue({\n        select: mockSelect,\n      });\n      mockSelect.mockReturnValue({\n        eq: mockEq,\n      });\n      mockEq.mockReturnValue({\n        single: mockSingle,\n      });\n      \n      const result = await getAuthorizedAdmin();\n      \n      expect(result).toBeNull();\n    });\n  });\n});\n"],"names":["jest","mock","cookies","fn","createServerClient","describe","mockCookieStore","mockSupabaseClient","createApiClient","getAuthenticatedUser","getAuthorizedAdmin","beforeEach","clearAllMocks","getAll","mockReturnValue","set","auth","getUser","from","require","mockResolvedValue","apiAuth","it","expect","toHaveBeenCalledWith","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","objectContaining","any","Function","setAll","client","toBeDefined","toBe","mockCookies","name","value","cookiesConfig","calls","result","toEqual","cookiesToSet","options","toHaveBeenCalledTimes","mockUser","id","email","data","user","error","supabase","toBeNull","message","mockImplementation","Promise","reject","Error","rejects","toThrow","mockFrom","mockReturnThis","mockSelect","mockEq","mockSingle","role","select","eq","single"],"mappings":"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"}