{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/PhotoPicker.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useCallback, useEffect } from 'react';\n\ninterface Photo {\n  id: string;\n  photo_url: string;\n  caption?: string;\n  alt_text?: string;\n  moderation_status: 'pending' | 'approved' | 'rejected';\n  created_at: string;\n}\n\ninterface PhotoPickerProps {\n  selectedPhotoIds: string[];\n  onSelectionChange: (photoIds: string[]) => void;\n  pageType?: 'event' | 'activity' | 'accommodation' | 'memory';\n  pageId?: string;\n  disabled?: boolean;\n}\n\n/**\n * PhotoPicker component for selecting photos from the gallery\n * \n * Features:\n * - Browse approved photos\n * - Multi-select with checkboxes\n * - Filter by page type and page ID\n * - Preview selected photos\n * - Drag to reorder selected photos\n */\nexport function PhotoPicker({\n  selectedPhotoIds,\n  onSelectionChange,\n  pageType,\n  pageId,\n  disabled = false,\n}: PhotoPickerProps) {\n  const [photos, setPhotos] = useState<Photo[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [showPicker, setShowPicker] = useState(false);\n\n  // Fetch approved photos\n  useEffect(() => {\n    if (showPicker) {\n      fetchPhotos();\n    }\n  }, [showPicker, pageType, pageId]);\n\n  const fetchPhotos = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const params = new URLSearchParams({\n        moderation_status: 'approved',\n        limit: '100',\n        offset: '0',\n      });\n\n      if (pageType) {\n        params.append('page_type', pageType);\n      }\n      if (pageId) {\n        params.append('page_id', pageId);\n      }\n\n      const response = await fetch(`/api/admin/photos?${params.toString()}`);\n      const result = await response.json();\n\n      if (result.success) {\n        setPhotos(result.data.photos || []);\n      } else {\n        setError(result.error?.message || 'Failed to load photos');\n      }\n    } catch (err) {\n      setError('Failed to load photos');\n    } finally {\n      setLoading(false);\n    }\n  }, [pageType, pageId]);\n\n  const handleTogglePhoto = useCallback(\n    (photoId: string) => {\n      if (selectedPhotoIds.includes(photoId)) {\n        onSelectionChange(selectedPhotoIds.filter(id => id !== photoId));\n      } else {\n        onSelectionChange([...selectedPhotoIds, photoId]);\n      }\n    },\n    [selectedPhotoIds, onSelectionChange]\n  );\n\n  const handleRemovePhoto = useCallback(\n    (photoId: string) => {\n      onSelectionChange(selectedPhotoIds.filter(id => id !== photoId));\n    },\n    [selectedPhotoIds, onSelectionChange]\n  );\n\n  const handleClearAll = useCallback(() => {\n    onSelectionChange([]);\n  }, [onSelectionChange]);\n\n  // Get selected photos in order\n  const selectedPhotos = selectedPhotoIds\n    .map(id => photos.find(p => p.id === id))\n    .filter((p): p is Photo => p !== undefined);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Selected photos preview */}\n      {selectedPhotoIds.length > 0 && (\n        <div className=\"border border-gray-200 rounded-lg p-4 bg-gray-50\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className=\"text-sm font-medium text-gray-900\">\n              Selected Photos ({selectedPhotoIds.length})\n            </h4>\n            <button\n              onClick={handleClearAll}\n              disabled={disabled}\n              className=\"text-xs text-red-600 hover:text-red-800 disabled:opacity-50 disabled:cursor-not-allowed\"\n              aria-label=\"Clear all selected photos\"\n            >\n              Clear All\n            </button>\n          </div>\n          <div className=\"grid grid-cols-4 gap-3\">\n            {selectedPhotos.map(photo => (\n              <div\n                key={photo.id}\n                className=\"relative group aspect-square rounded-lg overflow-hidden bg-gray-200\"\n              >\n                <img\n                  src={photo.photo_url}\n                  alt={photo.alt_text || photo.caption || 'Selected photo'}\n                  className=\"w-full h-full object-cover\"\n                />\n                <button\n                  onClick={() => handleRemovePhoto(photo.id)}\n                  disabled={disabled}\n                  className=\"absolute top-1 right-1 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\n                  aria-label=\"Remove photo\"\n                >\n                  <svg\n                    className=\"w-4 h-4\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M6 18L18 6M6 6l12 12\"\n                    />\n                  </svg>\n                </button>\n                {photo.caption && (\n                  <div className=\"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-1 truncate\">\n                    {photo.caption}\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Add photos button */}\n      <button\n        onClick={() => setShowPicker(true)}\n        disabled={disabled}\n        className=\"w-full px-4 py-3 text-sm font-medium text-blue-600 bg-blue-50 border-2 border-dashed border-blue-300 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n        aria-label=\"Add photos from gallery\"\n      >\n        + Add Photos from Gallery\n      </button>\n\n      {/* Photo picker modal */}\n      {showPicker && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\"\n          onClick={() => setShowPicker(false)}\n        >\n          <div\n            className=\"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col\"\n            onClick={e => e.stopPropagation()}\n          >\n            {/* Header */}\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Select Photos\n              </h3>\n              <button\n                onClick={() => setShowPicker(false)}\n                className=\"text-gray-600 hover:text-gray-900\"\n                aria-label=\"Close photo picker\"\n              >\n                <svg\n                  className=\"w-6 h-6\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M6 18L18 6M6 6l12 12\"\n                  />\n                </svg>\n              </button>\n            </div>\n\n            {/* Content */}\n            <div className=\"flex-1 overflow-auto p-6\">\n              {loading ? (\n                <div className=\"flex items-center justify-center py-12\">\n                  <div className=\"text-gray-600\">Loading photos...</div>\n                </div>\n              ) : error ? (\n                <div className=\"p-4 bg-red-50 border border-red-200 rounded-md\">\n                  <p className=\"text-sm text-red-800\">{error}</p>\n                </div>\n              ) : photos.length === 0 ? (\n                <div className=\"text-center py-12 text-gray-500\">\n                  No approved photos available.\n                  {pageType && (\n                    <div className=\"text-sm mt-2\">\n                      Try uploading photos for this {pageType} first.\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-4 gap-4\">\n                  {photos.map(photo => {\n                    const isSelected = selectedPhotoIds.includes(photo.id);\n                    return (\n                      <div\n                        key={photo.id}\n                        className={`relative group aspect-square rounded-lg overflow-hidden cursor-pointer border-2 transition-all ${\n                          isSelected\n                            ? 'border-blue-500 ring-2 ring-blue-500 ring-offset-2'\n                            : 'border-transparent hover:border-gray-300'\n                        }`}\n                        onClick={() => handleTogglePhoto(photo.id)}\n                      >\n                        <img\n                          src={photo.photo_url}\n                          alt={photo.alt_text || photo.caption || 'Photo'}\n                          className=\"w-full h-full object-cover\"\n                        />\n                        {/* Checkbox overlay */}\n                        <div\n                          className={`absolute top-2 right-2 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${\n                            isSelected\n                              ? 'bg-blue-500 border-blue-500'\n                              : 'bg-white border-gray-300 opacity-0 group-hover:opacity-100'\n                          }`}\n                        >\n                          {isSelected && (\n                            <svg\n                              className=\"w-4 h-4 text-white\"\n                              fill=\"none\"\n                              stroke=\"currentColor\"\n                              viewBox=\"0 0 24 24\"\n                            >\n                              <path\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                strokeWidth={3}\n                                d=\"M5 13l4 4L19 7\"\n                              />\n                            </svg>\n                          )}\n                        </div>\n                        {/* Caption */}\n                        {photo.caption && (\n                          <div className=\"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2 truncate\">\n                            {photo.caption}\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n\n            {/* Footer */}\n            <div className=\"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50\">\n              <div className=\"text-sm text-gray-600\">\n                {selectedPhotoIds.length} photo{selectedPhotoIds.length !== 1 ? 's' : ''} selected\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <button\n                  onClick={() => setShowPicker(false)}\n                  className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={() => setShowPicker(false)}\n                  className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n                >\n                  Done\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["PhotoPicker","selectedPhotoIds","onSelectionChange","pageType","pageId","disabled","photos","setPhotos","useState","loading","setLoading","error","setError","showPicker","setShowPicker","useEffect","fetchPhotos","useCallback","params","URLSearchParams","moderation_status","limit","offset","append","response","fetch","toString","result","json","success","data","message","err","handleTogglePhoto","photoId","includes","filter","id","handleRemovePhoto","handleClearAll","selectedPhotos","map","find","p","undefined","div","className","length","h4","button","onClick","aria-label","photo","img","src","photo_url","alt","alt_text","caption","svg","fill","stroke","viewBox","path","strokeLinecap","strokeLinejoin","strokeWidth","d","e","stopPropagation","h3","isSelected"],"mappings":"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"}