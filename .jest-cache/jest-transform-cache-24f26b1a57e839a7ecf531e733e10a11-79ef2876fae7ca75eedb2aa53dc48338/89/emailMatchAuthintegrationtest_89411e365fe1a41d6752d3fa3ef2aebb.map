{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/emailMatchAuth.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests for Email Matching Authentication API\n * \n * Tests the complete authentication flow with real database operations,\n * real session creation, and real cookie handling.\n * \n * Requirements: 5.2, 22.4\n * Task: 5.3\n */\n\nimport { testDb } from '../helpers/testDb';\nimport { cleanup } from '../helpers/cleanup';\n\ndescribe('Email Matching Authentication API - Integration Tests', () => {\n  beforeEach(async () => {\n    await cleanup();\n  });\n\n  afterAll(async () => {\n    await cleanup();\n  });\n\n  describe('Successful authentication', () => {\n    it('should authenticate guest with valid email and create session', async () => {\n      // Arrange - Create real guest in test database\n      const guest = await testDb.createGuest({\n        email: 'john@example.com',\n        auth_method: 'email_matching',\n        first_name: 'John',\n        last_name: 'Doe',\n      });\n\n      // Act - Make real API request\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'john@example.com' }),\n      });\n\n      // Assert - Check response\n      expect(response.status).toBe(200);\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(data.data.guestId).toBe(guest.id);\n      expect(data.data.groupId).toBe(guest.group_id);\n      expect(data.data.firstName).toBe('John');\n      expect(data.data.lastName).toBe('Doe');\n\n      // Verify session was created in database\n      const sessions = await testDb.getGuestSessions(guest.id);\n      expect(sessions.length).toBe(1);\n      expect(sessions[0].guest_id).toBe(guest.id);\n      expect(new Date(sessions[0].expires_at).getTime()).toBeGreaterThan(Date.now());\n\n      // Verify session cookie was set\n      const cookies = response.headers.get('set-cookie');\n      expect(cookies).toContain('guest_session=');\n      expect(cookies).toContain('HttpOnly');\n      expect(cookies).toContain('SameSite=Lax');\n    });\n\n    it('should normalize email to lowercase before lookup', async () => {\n      // Arrange\n      const guest = await testDb.createGuest({\n        email: 'jane@example.com',\n        auth_method: 'email_matching',\n        first_name: 'Jane',\n        last_name: 'Smith',\n      });\n\n      // Act - Send email with mixed case\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'JANE@EXAMPLE.COM' }),\n      });\n\n      // Assert - Should still authenticate\n      expect(response.status).toBe(200);\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(data.data.guestId).toBe(guest.id);\n    });\n\n    it('should create unique session tokens for multiple authentications', async () => {\n      // Arrange\n      const guest = await testDb.createGuest({\n        email: 'multi@example.com',\n        auth_method: 'email_matching',\n        first_name: 'Multi',\n        last_name: 'Session',\n      });\n\n      // Act - Authenticate multiple times\n      const tokens = new Set<string>();\n      for (let i = 0; i < 3; i++) {\n        const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ email: 'multi@example.com' }),\n        });\n\n        expect(response.status).toBe(200);\n        \n        // Extract token from cookie\n        const cookies = response.headers.get('set-cookie');\n        const tokenMatch = cookies?.match(/guest_session=([^;]+)/);\n        if (tokenMatch) {\n          tokens.add(tokenMatch[1]);\n        }\n      }\n\n      // Assert - All tokens should be unique\n      expect(tokens.size).toBe(3);\n\n      // Verify all sessions in database\n      const sessions = await testDb.getGuestSessions(guest.id);\n      expect(sessions.length).toBe(3);\n    });\n\n    it('should log IP address and user agent in session', async () => {\n      // Arrange\n      const guest = await testDb.createGuest({\n        email: 'tracked@example.com',\n        auth_method: 'email_matching',\n        first_name: 'Tracked',\n        last_name: 'User',\n      });\n\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-forwarded-for': '192.168.1.100',\n          'user-agent': 'Test Browser/1.0',\n        },\n        body: JSON.stringify({ email: 'tracked@example.com' }),\n      });\n\n      // Assert\n      expect(response.status).toBe(200);\n\n      // Verify session has IP and user agent\n      const sessions = await testDb.getGuestSessions(guest.id);\n      expect(sessions.length).toBe(1);\n      expect(sessions[0].ip_address).toBe('192.168.1.100');\n      expect(sessions[0].user_agent).toBe('Test Browser/1.0');\n    });\n\n    it('should create audit log entry for authentication', async () => {\n      // Arrange\n      const guest = await testDb.createGuest({\n        email: 'audit@example.com',\n        auth_method: 'email_matching',\n        first_name: 'Audit',\n        last_name: 'Test',\n      });\n\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'audit@example.com' }),\n      });\n\n      // Assert\n      expect(response.status).toBe(200);\n\n      // Verify audit log entry\n      const auditLogs = await testDb.getAuditLogs({\n        action: 'guest_login',\n        entity_type: 'guest',\n        entity_id: guest.id,\n      });\n      expect(auditLogs.length).toBeGreaterThan(0);\n      expect(auditLogs[0].details.auth_method).toBe('email_matching');\n      expect(auditLogs[0].details.email).toBe('audit@example.com');\n    });\n  });\n\n  describe('Validation errors', () => {\n    it('should return 400 for invalid email format', async () => {\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'not-an-email' }),\n      });\n\n      // Assert\n      expect(response.status).toBe(400);\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(data.error.message).toContain('Invalid email format');\n    });\n\n    it('should return 400 for missing email', async () => {\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({}),\n      });\n\n      // Assert\n      expect(response.status).toBe(400);\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 400 for empty email', async () => {\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: '' }),\n      });\n\n      // Assert\n      expect(response.status).toBe(400);\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n  });\n\n  describe('Authentication errors', () => {\n    it('should return 404 when email not found in database', async () => {\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'notfound@example.com' }),\n      });\n\n      // Assert\n      expect(response.status).toBe(404);\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n      expect(data.error.message).toContain('Email not found');\n    });\n\n    it('should return 404 when guest uses magic_link auth method', async () => {\n      // Arrange - Create guest with magic_link auth method\n      await testDb.createGuest({\n        email: 'magiclink@example.com',\n        auth_method: 'magic_link',\n        first_name: 'Magic',\n        last_name: 'Link',\n      });\n\n      // Act - Try to authenticate with email matching\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'magiclink@example.com' }),\n      });\n\n      // Assert - Should be rejected\n      expect(response.status).toBe(404);\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should not create session when authentication fails', async () => {\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'failed@example.com' }),\n      });\n\n      // Assert\n      expect(response.status).toBe(404);\n\n      // Verify no sessions were created\n      const allSessions = await testDb.getAllGuestSessions();\n      expect(allSessions.length).toBe(0);\n    });\n  });\n\n  describe('Security features', () => {\n    it('should sanitize malicious email input', async () => {\n      // Act - Send email with script tags\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: '<script>alert(\"xss\")</script>test@example.com' }),\n      });\n\n      // Assert - Should be rejected (invalid email format after sanitization)\n      expect(response.status).toBe(404); // Email won't be found after sanitization\n      const data = await response.json();\n      expect(data.success).toBe(false);\n    });\n\n    it('should set secure cookie in production environment', async () => {\n      // Note: This test would need to run in production mode to verify\n      // For now, we verify the cookie is set with HttpOnly and SameSite\n      \n      // Arrange\n      const guest = await testDb.createGuest({\n        email: 'secure@example.com',\n        auth_method: 'email_matching',\n        first_name: 'Secure',\n        last_name: 'User',\n      });\n\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'secure@example.com' }),\n      });\n\n      // Assert\n      expect(response.status).toBe(200);\n      const cookies = response.headers.get('set-cookie');\n      expect(cookies).toContain('HttpOnly');\n      expect(cookies).toContain('SameSite=Lax');\n      expect(cookies).toContain('Path=/');\n    });\n\n    it('should set session expiration to 24 hours from creation', async () => {\n      // Arrange\n      const guest = await testDb.createGuest({\n        email: 'expiry@example.com',\n        auth_method: 'email_matching',\n        first_name: 'Expiry',\n        last_name: 'Test',\n      });\n\n      const beforeAuth = Date.now();\n\n      // Act\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: 'expiry@example.com' }),\n      });\n\n      const afterAuth = Date.now();\n\n      // Assert\n      expect(response.status).toBe(200);\n\n      // Verify session expiration\n      const sessions = await testDb.getGuestSessions(guest.id);\n      expect(sessions.length).toBe(1);\n      \n      const expiresAt = new Date(sessions[0].expires_at).getTime();\n      const expectedMin = beforeAuth + 24 * 60 * 60 * 1000;\n      const expectedMax = afterAuth + 24 * 60 * 60 * 1000;\n\n      expect(expiresAt).toBeGreaterThanOrEqual(expectedMin);\n      expect(expiresAt).toBeLessThanOrEqual(expectedMax);\n    });\n\n    it('should prevent SQL injection in email parameter', async () => {\n      // Act - Try SQL injection\n      const response = await fetch('http://localhost:3000/api/auth/guest/email-match', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: \"'; DROP TABLE guests; --\" }),\n      });\n\n      // Assert - Should be rejected as invalid email\n      expect(response.status).toBe(400);\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n\n      // Verify guests table still exists\n      const guests = await testDb.getAllGuests();\n      expect(guests).toBeDefined(); // Table wasn't dropped\n    });\n  });\n\n  describe('Session management', () => {\n    it('should allow multiple concurrent sessions for same guest', async () => {\n      // Arrange\n      const guest = await testDb.createGuest({\n        email: 'concurrent@example.com',\n        auth_method: 'email_matching',\n        first_name: 'Concurrent',\n        last_name: 'User',\n      });\n\n      // Act - Create multiple sessions\n      const responses = await Promise.all([\n        fetch('http://localhost:3000/api/auth/guest/email-match', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ email: 'concurrent@example.com' }),\n        }),\n        fetch('http://localhost:3000/api/auth/guest/email-match', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ email: 'concurrent@example.com' }),\n        }),\n        fetch('http://localhost:3000/api/auth/guest/email-match', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ email: 'concurrent@example.com' }),\n        }),\n      ]);\n\n      // Assert - All should succeed\n      responses.forEach(response => {\n        expect(response.status).toBe(200);\n      });\n\n      // Verify multiple sessions created\n      const sessions = await testDb.getGuestSessions(guest.id);\n      expect(sessions.length).toBe(3);\n    });\n  });\n});\n"],"names":["describe","beforeEach","cleanup","afterAll","it","guest","testDb","createGuest","email","auth_method","first_name","last_name","response","fetch","method","headers","body","JSON","stringify","expect","status","toBe","data","json","success","guestId","id","groupId","group_id","firstName","lastName","sessions","getGuestSessions","length","guest_id","Date","expires_at","getTime","toBeGreaterThan","now","cookies","get","toContain","tokens","Set","i","tokenMatch","match","add","size","ip_address","user_agent","auditLogs","getAuditLogs","action","entity_type","entity_id","details","error","code","message","allSessions","getAllGuestSessions","beforeAuth","afterAuth","expiresAt","expectedMin","expectedMax","toBeGreaterThanOrEqual","toBeLessThanOrEqual","guests","getAllGuests","toBeDefined","responses","Promise","all","forEach"],"mappings":"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"}