{"version":3,"names":["GET","cov_2qk7gcay12","f","s","PUT","request","supabase","_supabaseServer","createAuthenticatedClient","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","result","_settingsService","getSettings","body","updates","errors","key","value","Object","entries","updateSetting","createResult","createSetting","push","length","details"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/settings/route.ts"],"sourcesContent":["import { createAuthenticatedClient } from '@/lib/supabaseServer';\nimport { NextResponse } from 'next/server';\nimport * as settingsService from '@/services/settingsService';\n\n/**\n * GET /api/admin/settings\n * \n * Retrieves system settings\n * \n * Requirements: 20.1, 20.2, 20.3, 20.4\n */\nexport async function GET(request: Request) {\n  // 1. Auth check\n  const supabase = await createAuthenticatedClient();\n  const {\n    data: { session },\n    error: authError,\n  } = await supabase.auth.getSession();\n\n  if (authError || !session) {\n    return NextResponse.json(\n      { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n      { status: 401 }\n    );\n  }\n\n  // 2. Get settings\n  const result = await settingsService.getSettings();\n\n  // 3. Return response\n  return NextResponse.json(result, { status: result.success ? 200 : 500 });\n}\n\n/**\n * PUT /api/admin/settings\n * \n * Updates system settings\n * \n * Requirements: 20.5\n */\nexport async function PUT(request: Request) {\n  // 1. Auth check\n  const supabase = await createAuthenticatedClient();\n  const {\n    data: { session },\n    error: authError,\n  } = await supabase.auth.getSession();\n\n  if (authError || !session) {\n    return NextResponse.json(\n      { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n      { status: 401 }\n    );\n  }\n\n  // 2. Parse and validate\n  const body = await request.json();\n\n  // 3. Update each setting individually\n  const updates = [];\n  const errors = [];\n  \n  for (const [key, value] of Object.entries(body)) {\n    const result = await settingsService.updateSetting(key, value);\n    \n    if (!result.success) {\n      // If setting doesn't exist, try to create it\n      if (result.error.code === 'NOT_FOUND') {\n        const createResult = await settingsService.createSetting(key, value);\n        if (!createResult.success) {\n          errors.push({ key, error: createResult.error });\n        } else {\n          updates.push({ key, value });\n        }\n      } else {\n        errors.push({ key, error: result.error });\n      }\n    } else {\n      updates.push({ key, value });\n    }\n  }\n\n  // 4. Return response\n  if (errors.length > 0) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: { \n          code: 'PARTIAL_UPDATE_FAILURE', \n          message: `Failed to update ${errors.length} setting(s)`,\n          details: errors\n        } \n      },\n      { status: 500 }\n    );\n  }\n\n  return NextResponse.json({ success: true, data: updates }, { status: 200 });\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}