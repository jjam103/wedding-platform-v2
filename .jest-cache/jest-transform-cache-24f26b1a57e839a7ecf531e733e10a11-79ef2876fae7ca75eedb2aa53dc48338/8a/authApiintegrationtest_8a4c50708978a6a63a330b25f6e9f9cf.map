{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/authApi.integration.test.ts"],"sourcesContent":["/**\n * Integration tests for authentication API routes\n * \n * Tests authentication endpoints including:\n * - User creation flow\n * - Logout functionality\n * - Session management\n * - Error handling\n */\n\n// Polyfill Web APIs for Next.js server components\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder as any;\n\n// Polyfill Request for tests\nif (typeof Request === 'undefined') {\n  global.Request = class Request {\n    method: string;\n    url: string;\n    headers: Map<string, string>;\n    body: string | null;\n\n    constructor(url: string, init?: any) {\n      this.url = url;\n      this.method = init?.method || 'GET';\n      this.headers = new Map();\n      if (init?.headers) {\n        Object.entries(init.headers).forEach(([key, value]) => {\n          this.headers.set(key, value as string);\n        });\n      }\n      this.body = init?.body || null;\n    }\n\n    async json() {\n      return JSON.parse(this.body || '{}');\n    }\n  } as any;\n}\n\n// Mock Next.js server module to avoid Request/Response issues\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n}));\n\nimport { POST as createUserPOST } from '@/app/api/auth/create-user/route';\nimport { POST as logoutPOST } from '@/app/api/auth/logout/route';\n\n// Mock Supabase modules to avoid worker crashes\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(),\n}));\n\njest.mock('@supabase/ssr', () => ({\n  createServerClient: jest.fn(),\n}));\n\njest.mock('next/headers', () => ({\n  cookies: jest.fn(),\n}));\n\ndescribe('Authentication API Routes', () => {\n  let mockSupabaseAdmin: any;\n  let mockSupabaseClient: any;\n  let mockCookies: any;\n\n  beforeEach(() => {\n    // Reset all mocks\n    jest.clearAllMocks();\n\n    // Mock admin client for create-user route\n    mockSupabaseAdmin = {\n      auth: {\n        admin: {\n          getUserById: jest.fn(),\n        },\n      },\n      from: jest.fn().mockReturnThis(),\n      insert: jest.fn().mockReturnThis(),\n    };\n\n    // Mock regular client for logout route\n    mockSupabaseClient = {\n      auth: {\n        signOut: jest.fn(),\n      },\n    };\n\n    // Mock cookies\n    mockCookies = {\n      getAll: jest.fn().mockReturnValue([]),\n      set: jest.fn(),\n    };\n\n    // Setup module mocks\n    const { createClient } = require('@supabase/supabase-js');\n    createClient.mockReturnValue(mockSupabaseAdmin);\n\n    const { createServerClient } = require('@supabase/ssr');\n    createServerClient.mockReturnValue(mockSupabaseClient);\n\n    const { cookies } = require('next/headers');\n    cookies.mockResolvedValue(mockCookies);\n\n    // Mock environment variables\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.SUPABASE_SECRET_KEY = 'test-secret-key';\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';\n  });\n\n  afterEach(() => {\n    // Clean up environment variables\n    delete process.env.NEXT_PUBLIC_SUPABASE_URL;\n    delete process.env.SUPABASE_SECRET_KEY;\n    delete process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n  });\n\n  describe('POST /api/auth/create-user', () => {\n    it('should create user successfully when valid data provided', async () => {\n      // Mock successful user lookup\n      mockSupabaseAdmin.auth.admin.getUserById.mockResolvedValue({\n        data: { id: 'user-123', email: 'test@example.com' },\n        error: null,\n      });\n\n      // Mock successful user insertion\n      mockSupabaseAdmin.insert.mockResolvedValue({\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: 'user-123',\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(mockSupabaseAdmin.auth.admin.getUserById).toHaveBeenCalledWith('user-123');\n      expect(mockSupabaseAdmin.from).toHaveBeenCalledWith('users');\n      expect(mockSupabaseAdmin.insert).toHaveBeenCalledWith({\n        id: 'user-123',\n        email: 'test@example.com',\n        role: 'admin',\n      });\n    });\n\n    it('should return 400 when required fields are missing', async () => {\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: 'user-123',\n          // Missing email and role\n        }),\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.error).toBe('Missing required fields');\n    });\n\n    it('should return 500 when Supabase environment variables are missing', async () => {\n      // Remove environment variables\n      delete process.env.NEXT_PUBLIC_SUPABASE_URL;\n      delete process.env.SUPABASE_SECRET_KEY;\n\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: 'user-123',\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.error).toBe('Server configuration error');\n    });\n\n    it('should return 404 when user not found in auth system', async () => {\n      // Mock user not found\n      mockSupabaseAdmin.auth.admin.getUserById\n        .mockResolvedValueOnce({\n          data: null,\n          error: { message: 'User not found' },\n        })\n        .mockResolvedValueOnce({\n          data: null,\n          error: { message: 'User not found' },\n        });\n\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: 'nonexistent-user',\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(404);\n      expect(data.error).toBe('User not found in authentication system');\n    });\n\n    it('should return 500 when database insertion fails', async () => {\n      // Mock successful user lookup\n      mockSupabaseAdmin.auth.admin.getUserById.mockResolvedValue({\n        data: { id: 'user-123', email: 'test@example.com' },\n        error: null,\n      });\n\n      // Mock database insertion failure\n      mockSupabaseAdmin.insert.mockResolvedValue({\n        error: { message: 'Database connection failed' },\n      });\n\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: 'user-123',\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.error).toBe('Failed to create user record');\n      expect(data.details).toBe('Database connection failed');\n    });\n\n    it('should handle unexpected errors gracefully', async () => {\n      // Mock JSON parsing error\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: 'invalid-json',\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.error).toBe('Internal server error');\n    });\n  });\n\n  describe('POST /api/auth/logout', () => {\n    it('should logout successfully when user is authenticated', async () => {\n      // Mock successful logout\n      mockSupabaseClient.auth.signOut.mockResolvedValue({\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/auth/logout', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const response = await logoutPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.message).toBe('Logged out successfully');\n      expect(mockSupabaseClient.auth.signOut).toHaveBeenCalled();\n    });\n\n    it('should return 500 when logout fails', async () => {\n      // Mock logout failure\n      mockSupabaseClient.auth.signOut.mockResolvedValue({\n        error: { message: 'Session not found' },\n      });\n\n      const request = new Request('http://localhost:3000/api/auth/logout', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const response = await logoutPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('LOGOUT_FAILED');\n      expect(data.error.message).toBe('Failed to logout');\n      expect(data.error.details).toBe('Session not found');\n    });\n\n    it('should handle unexpected errors during logout', async () => {\n      // Mock unexpected error\n      mockSupabaseClient.auth.signOut.mockRejectedValue(new Error('Network error'));\n\n      const request = new Request('http://localhost:3000/api/auth/logout', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const response = await logoutPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('INTERNAL_ERROR');\n      expect(data.error.message).toBe('An unexpected error occurred during logout');\n    });\n\n    it('should handle cookie operations correctly', async () => {\n      // Mock successful logout\n      mockSupabaseClient.auth.signOut.mockResolvedValue({\n        error: null,\n      });\n\n      // Mock cookies with existing session data\n      mockCookies.getAll.mockReturnValue([\n        { name: 'sb-access-token', value: 'token123' },\n        { name: 'sb-refresh-token', value: 'refresh123' },\n      ]);\n\n      const request = new Request('http://localhost:3000/api/auth/logout', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const response = await logoutPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      \n      // Verify Supabase client was created with cookie configuration\n      const { createServerClient } = require('@supabase/ssr');\n      expect(createServerClient).toHaveBeenCalledWith(\n        'https://test.supabase.co',\n        'test-anon-key',\n        expect.objectContaining({\n          cookies: expect.objectContaining({\n            getAll: expect.any(Function),\n            setAll: expect.any(Function),\n          }),\n        })\n      );\n    });\n  });\n\n  describe('Session Management Integration', () => {\n    it('should handle session lifecycle correctly', async () => {\n      // Test user creation followed by logout\n      \n      // 1. Create user\n      mockSupabaseAdmin.auth.admin.getUserById.mockResolvedValue({\n        data: { id: 'user-123', email: 'test@example.com' },\n        error: null,\n      });\n      mockSupabaseAdmin.insert.mockResolvedValue({ error: null });\n\n      const createRequest = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: 'user-123',\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const createResponse = await createUserPOST(createRequest);\n      const createData = await createResponse.json();\n\n      expect(createResponse.status).toBe(200);\n      expect(createData.success).toBe(true);\n\n      // 2. Logout user\n      mockSupabaseClient.auth.signOut.mockResolvedValue({ error: null });\n\n      const logoutRequest = new Request('http://localhost:3000/api/auth/logout', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const logoutResponse = await logoutPOST(logoutRequest);\n      const logoutData = await logoutResponse.json();\n\n      expect(logoutResponse.status).toBe(200);\n      expect(logoutData.success).toBe(true);\n      expect(logoutData.data.message).toBe('Logged out successfully');\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle malformed JSON in create-user request', async () => {\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: '{\"userId\": \"test\", \"email\": \"test@example.com\", \"role\":}', // Invalid JSON\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.error).toBe('Internal server error');\n    });\n\n    it('should handle missing Content-Type header', async () => {\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        body: JSON.stringify({\n          userId: 'user-123',\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const response = await createUserPOST(request);\n      \n      // Should return 500 due to missing environment variables in test\n      expect(response.status).toBe(500);\n    });\n\n    it('should handle empty request body', async () => {\n      const request = new Request('http://localhost:3000/api/auth/create-user', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: '',\n      });\n\n      const response = await createUserPOST(request);\n      const data = await response.json();\n\n      // Empty body results in missing required fields, so returns 400\n      expect(response.status).toBe(400);\n      expect(data.error).toBe('Missing required fields');\n    });\n  });\n});"],"names":["jest","mock","NextResponse","json","data","init","status","createClient","fn","createServerClient","cookies","global","TextEncoder","TextDecoder","Request","url","method","headers","Map","Object","entries","forEach","key","value","set","body","JSON","parse","describe","mockSupabaseAdmin","mockSupabaseClient","mockCookies","beforeEach","clearAllMocks","auth","admin","getUserById","from","mockReturnThis","insert","signOut","getAll","mockReturnValue","require","mockResolvedValue","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SECRET_KEY","NEXT_PUBLIC_SUPABASE_ANON_KEY","afterEach","it","id","email","error","request","stringify","userId","role","response","createUserPOST","expect","toBe","success","toHaveBeenCalledWith","mockResolvedValueOnce","message","details","logoutPOST","toHaveBeenCalled","code","mockRejectedValue","Error","name","objectContaining","any","Function","setAll","createRequest","createResponse","createData","logoutRequest","logoutResponse","logoutData"],"mappings":"AAAA;;;;;;;;CAQC,GAED,kDAAkD;;AA+BlD,8DAA8D;AAC9DA,KAAKC,IAAI,CAAC,eAAe,IAAO,CAAA;QAC9BC,cAAc;YACZC,MAAM,CAACC,MAAWC,OAAgB,CAAA;oBAChCF,MAAM,UAAYC;oBAClBE,QAAQD,MAAMC,UAAU;gBAC1B,CAAA;QACF;IACF,CAAA;AAKA,gDAAgD;AAChDN,KAAKC,IAAI,CAAC,yBAAyB,IAAO,CAAA;QACxCM,cAAcP,KAAKQ,EAAE;IACvB,CAAA;AAEAR,KAAKC,IAAI,CAAC,iBAAiB,IAAO,CAAA;QAChCQ,oBAAoBT,KAAKQ,EAAE;IAC7B,CAAA;AAEAR,KAAKC,IAAI,CAAC,gBAAgB,IAAO,CAAA;QAC/BS,SAASV,KAAKQ,EAAE;IAClB,CAAA;;;;sBAtDyC;uBAwCF;wBACJ;AAxCnCG,OAAOC,WAAW,GAAGA,iBAAW;AAChCD,OAAOE,WAAW,GAAGA,iBAAW;AAEhC,6BAA6B;AAC7B,IAAI,OAAOC,YAAY,aAAa;IAClCH,OAAOG,OAAO,GAAG,MAAMA;QAMrB,YAAYC,GAAW,EAAEV,IAAU,CAAE;YACnC,IAAI,CAACU,GAAG,GAAGA;YACX,IAAI,CAACC,MAAM,GAAGX,MAAMW,UAAU;YAC9B,IAAI,CAACC,OAAO,GAAG,IAAIC;YACnB,IAAIb,MAAMY,SAAS;gBACjBE,OAAOC,OAAO,CAACf,KAAKY,OAAO,EAAEI,OAAO,CAAC,CAAC,CAACC,KAAKC,MAAM;oBAChD,IAAI,CAACN,OAAO,CAACO,GAAG,CAACF,KAAKC;gBACxB;YACF;YACA,IAAI,CAACE,IAAI,GAAGpB,MAAMoB,QAAQ;QAC5B;QAEA,MAAMtB,OAAO;YACX,OAAOuB,KAAKC,KAAK,CAAC,IAAI,CAACF,IAAI,IAAI;QACjC;IACF;AACF;AA4BAG,SAAS,6BAA6B;IACpC,IAAIC;IACJ,IAAIC;IACJ,IAAIC;IAEJC,WAAW;QACT,kBAAkB;QAClBhC,KAAKiC,aAAa;QAElB,0CAA0C;QAC1CJ,oBAAoB;YAClBK,MAAM;gBACJC,OAAO;oBACLC,aAAapC,KAAKQ,EAAE;gBACtB;YACF;YACA6B,MAAMrC,KAAKQ,EAAE,GAAG8B,cAAc;YAC9BC,QAAQvC,KAAKQ,EAAE,GAAG8B,cAAc;QAClC;QAEA,uCAAuC;QACvCR,qBAAqB;YACnBI,MAAM;gBACJM,SAASxC,KAAKQ,EAAE;YAClB;QACF;QAEA,eAAe;QACfuB,cAAc;YACZU,QAAQzC,KAAKQ,EAAE,GAAGkC,eAAe,CAAC,EAAE;YACpClB,KAAKxB,KAAKQ,EAAE;QACd;QAEA,qBAAqB;QACrB,MAAM,EAAED,YAAY,EAAE,GAAGoC,QAAQ;QACjCpC,aAAamC,eAAe,CAACb;QAE7B,MAAM,EAAEpB,kBAAkB,EAAE,GAAGkC,QAAQ;QACvClC,mBAAmBiC,eAAe,CAACZ;QAEnC,MAAM,EAAEpB,OAAO,EAAE,GAAGiC,QAAQ;QAC5BjC,QAAQkC,iBAAiB,CAACb;QAE1B,6BAA6B;QAC7Bc,QAAQC,GAAG,CAACC,wBAAwB,GAAG;QACvCF,QAAQC,GAAG,CAACE,mBAAmB,GAAG;QAClCH,QAAQC,GAAG,CAACG,6BAA6B,GAAG;IAC9C;IAEAC,UAAU;QACR,iCAAiC;QACjC,OAAOL,QAAQC,GAAG,CAACC,wBAAwB;QAC3C,OAAOF,QAAQC,GAAG,CAACE,mBAAmB;QACtC,OAAOH,QAAQC,GAAG,CAACG,6BAA6B;IAClD;IAEArB,SAAS,8BAA8B;QACrCuB,GAAG,4DAA4D;YAC7D,8BAA8B;YAC9BtB,kBAAkBK,IAAI,CAACC,KAAK,CAACC,WAAW,CAACQ,iBAAiB,CAAC;gBACzDxC,MAAM;oBAAEgD,IAAI;oBAAYC,OAAO;gBAAmB;gBAClDC,OAAO;YACT;YAEA,iCAAiC;YACjCzB,kBAAkBU,MAAM,CAACK,iBAAiB,CAAC;gBACzCU,OAAO;YACT;YAEA,MAAMC,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAMC,KAAK8B,SAAS,CAAC;oBACnBC,QAAQ;oBACRJ,OAAO;oBACPK,MAAM;gBACR;YACF;YAEA,MAAMC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAK2D,OAAO,EAAED,IAAI,CAAC;YAC1BD,OAAOhC,kBAAkBK,IAAI,CAACC,KAAK,CAACC,WAAW,EAAE4B,oBAAoB,CAAC;YACtEH,OAAOhC,kBAAkBQ,IAAI,EAAE2B,oBAAoB,CAAC;YACpDH,OAAOhC,kBAAkBU,MAAM,EAAEyB,oBAAoB,CAAC;gBACpDZ,IAAI;gBACJC,OAAO;gBACPK,MAAM;YACR;QACF;QAEAP,GAAG,sDAAsD;YACvD,MAAMI,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAMC,KAAK8B,SAAS,CAAC;oBACnBC,QAAQ;gBAEV;YACF;YAEA,MAAME,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,EAAEQ,IAAI,CAAC;QAC1B;QAEAX,GAAG,qEAAqE;YACtE,+BAA+B;YAC/B,OAAON,QAAQC,GAAG,CAACC,wBAAwB;YAC3C,OAAOF,QAAQC,GAAG,CAACE,mBAAmB;YAEtC,MAAMO,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAMC,KAAK8B,SAAS,CAAC;oBACnBC,QAAQ;oBACRJ,OAAO;oBACPK,MAAM;gBACR;YACF;YAEA,MAAMC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,EAAEQ,IAAI,CAAC;QAC1B;QAEAX,GAAG,wDAAwD;YACzD,sBAAsB;YACtBtB,kBAAkBK,IAAI,CAACC,KAAK,CAACC,WAAW,CACrC6B,qBAAqB,CAAC;gBACrB7D,MAAM;gBACNkD,OAAO;oBAAEY,SAAS;gBAAiB;YACrC,GACCD,qBAAqB,CAAC;gBACrB7D,MAAM;gBACNkD,OAAO;oBAAEY,SAAS;gBAAiB;YACrC;YAEF,MAAMX,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAMC,KAAK8B,SAAS,CAAC;oBACnBC,QAAQ;oBACRJ,OAAO;oBACPK,MAAM;gBACR;YACF;YAEA,MAAMC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,EAAEQ,IAAI,CAAC;QAC1B;QAEAX,GAAG,mDAAmD;YACpD,8BAA8B;YAC9BtB,kBAAkBK,IAAI,CAACC,KAAK,CAACC,WAAW,CAACQ,iBAAiB,CAAC;gBACzDxC,MAAM;oBAAEgD,IAAI;oBAAYC,OAAO;gBAAmB;gBAClDC,OAAO;YACT;YAEA,kCAAkC;YAClCzB,kBAAkBU,MAAM,CAACK,iBAAiB,CAAC;gBACzCU,OAAO;oBAAEY,SAAS;gBAA6B;YACjD;YAEA,MAAMX,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAMC,KAAK8B,SAAS,CAAC;oBACnBC,QAAQ;oBACRJ,OAAO;oBACPK,MAAM;gBACR;YACF;YAEA,MAAMC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,EAAEQ,IAAI,CAAC;YACxBD,OAAOzD,KAAK+D,OAAO,EAAEL,IAAI,CAAC;QAC5B;QAEAX,GAAG,8CAA8C;YAC/C,0BAA0B;YAC1B,MAAMI,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAM;YACR;YAEA,MAAMkC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,EAAEQ,IAAI,CAAC;QAC1B;IACF;IAEAlC,SAAS,yBAAyB;QAChCuB,GAAG,yDAAyD;YAC1D,yBAAyB;YACzBrB,mBAAmBI,IAAI,CAACM,OAAO,CAACI,iBAAiB,CAAC;gBAChDU,OAAO;YACT;YAEA,MAAMC,UAAU,IAAIzC,QAAQ,yCAAyC;gBACnEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;YAEA,MAAM0C,WAAW,MAAMS,IAAAA,YAAU,EAACb;YAClC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAK2D,OAAO,EAAED,IAAI,CAAC;YAC1BD,OAAOzD,KAAKA,IAAI,CAAC8D,OAAO,EAAEJ,IAAI,CAAC;YAC/BD,OAAO/B,mBAAmBI,IAAI,CAACM,OAAO,EAAE6B,gBAAgB;QAC1D;QAEAlB,GAAG,uCAAuC;YACxC,sBAAsB;YACtBrB,mBAAmBI,IAAI,CAACM,OAAO,CAACI,iBAAiB,CAAC;gBAChDU,OAAO;oBAAEY,SAAS;gBAAoB;YACxC;YAEA,MAAMX,UAAU,IAAIzC,QAAQ,yCAAyC;gBACnEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;YAEA,MAAM0C,WAAW,MAAMS,IAAAA,YAAU,EAACb;YAClC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAK2D,OAAO,EAAED,IAAI,CAAC;YAC1BD,OAAOzD,KAAKkD,KAAK,CAACgB,IAAI,EAAER,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,CAACY,OAAO,EAAEJ,IAAI,CAAC;YAChCD,OAAOzD,KAAKkD,KAAK,CAACa,OAAO,EAAEL,IAAI,CAAC;QAClC;QAEAX,GAAG,iDAAiD;YAClD,wBAAwB;YACxBrB,mBAAmBI,IAAI,CAACM,OAAO,CAAC+B,iBAAiB,CAAC,IAAIC,MAAM;YAE5D,MAAMjB,UAAU,IAAIzC,QAAQ,yCAAyC;gBACnEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;YAEA,MAAM0C,WAAW,MAAMS,IAAAA,YAAU,EAACb;YAClC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAK2D,OAAO,EAAED,IAAI,CAAC;YAC1BD,OAAOzD,KAAKkD,KAAK,CAACgB,IAAI,EAAER,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,CAACY,OAAO,EAAEJ,IAAI,CAAC;QAClC;QAEAX,GAAG,6CAA6C;YAC9C,yBAAyB;YACzBrB,mBAAmBI,IAAI,CAACM,OAAO,CAACI,iBAAiB,CAAC;gBAChDU,OAAO;YACT;YAEA,0CAA0C;YAC1CvB,YAAYU,MAAM,CAACC,eAAe,CAAC;gBACjC;oBAAE+B,MAAM;oBAAmBlD,OAAO;gBAAW;gBAC7C;oBAAEkD,MAAM;oBAAoBlD,OAAO;gBAAa;aACjD;YAED,MAAMgC,UAAU,IAAIzC,QAAQ,yCAAyC;gBACnEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;YAEA,MAAM0C,WAAW,MAAMS,IAAAA,YAAU,EAACb;YAClC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAK2D,OAAO,EAAED,IAAI,CAAC;YAE1B,+DAA+D;YAC/D,MAAM,EAAErD,kBAAkB,EAAE,GAAGkC,QAAQ;YACvCkB,OAAOpD,oBAAoBuD,oBAAoB,CAC7C,4BACA,iBACAH,OAAOa,gBAAgB,CAAC;gBACtBhE,SAASmD,OAAOa,gBAAgB,CAAC;oBAC/BjC,QAAQoB,OAAOc,GAAG,CAACC;oBACnBC,QAAQhB,OAAOc,GAAG,CAACC;gBACrB;YACF;QAEJ;IACF;IAEAhD,SAAS,kCAAkC;QACzCuB,GAAG,6CAA6C;YAC9C,wCAAwC;YAExC,iBAAiB;YACjBtB,kBAAkBK,IAAI,CAACC,KAAK,CAACC,WAAW,CAACQ,iBAAiB,CAAC;gBACzDxC,MAAM;oBAAEgD,IAAI;oBAAYC,OAAO;gBAAmB;gBAClDC,OAAO;YACT;YACAzB,kBAAkBU,MAAM,CAACK,iBAAiB,CAAC;gBAAEU,OAAO;YAAK;YAEzD,MAAMwB,gBAAgB,IAAIhE,QAAQ,8CAA8C;gBAC9EE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAMC,KAAK8B,SAAS,CAAC;oBACnBC,QAAQ;oBACRJ,OAAO;oBACPK,MAAM;gBACR;YACF;YAEA,MAAMqB,iBAAiB,MAAMnB,IAAAA,WAAc,EAACkB;YAC5C,MAAME,aAAa,MAAMD,eAAe5E,IAAI;YAE5C0D,OAAOkB,eAAezE,MAAM,EAAEwD,IAAI,CAAC;YACnCD,OAAOmB,WAAWjB,OAAO,EAAED,IAAI,CAAC;YAEhC,iBAAiB;YACjBhC,mBAAmBI,IAAI,CAACM,OAAO,CAACI,iBAAiB,CAAC;gBAAEU,OAAO;YAAK;YAEhE,MAAM2B,gBAAgB,IAAInE,QAAQ,yCAAyC;gBACzEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;YAEA,MAAMiE,iBAAiB,MAAMd,IAAAA,YAAU,EAACa;YACxC,MAAME,aAAa,MAAMD,eAAe/E,IAAI;YAE5C0D,OAAOqB,eAAe5E,MAAM,EAAEwD,IAAI,CAAC;YACnCD,OAAOsB,WAAWpB,OAAO,EAAED,IAAI,CAAC;YAChCD,OAAOsB,WAAW/E,IAAI,CAAC8D,OAAO,EAAEJ,IAAI,CAAC;QACvC;IACF;IAEAlC,SAAS,kBAAkB;QACzBuB,GAAG,uDAAuD;YACxD,MAAMI,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAM;YACR;YAEA,MAAMkC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,EAAEQ,IAAI,CAAC;QAC1B;QAEAX,GAAG,6CAA6C;YAC9C,MAAMI,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRS,MAAMC,KAAK8B,SAAS,CAAC;oBACnBC,QAAQ;oBACRJ,OAAO;oBACPK,MAAM;gBACR;YACF;YAEA,MAAMC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YAEtC,iEAAiE;YACjEM,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;QAC/B;QAEAX,GAAG,oCAAoC;YACrC,MAAMI,UAAU,IAAIzC,QAAQ,8CAA8C;gBACxEE,QAAQ;gBACRC,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9CQ,MAAM;YACR;YAEA,MAAMkC,WAAW,MAAMC,IAAAA,WAAc,EAACL;YACtC,MAAMnD,OAAO,MAAMuD,SAASxD,IAAI;YAEhC,gEAAgE;YAChE0D,OAAOF,SAASrD,MAAM,EAAEwD,IAAI,CAAC;YAC7BD,OAAOzD,KAAKkD,KAAK,EAAEQ,IAAI,CAAC;QAC1B;IACF;AACF"}