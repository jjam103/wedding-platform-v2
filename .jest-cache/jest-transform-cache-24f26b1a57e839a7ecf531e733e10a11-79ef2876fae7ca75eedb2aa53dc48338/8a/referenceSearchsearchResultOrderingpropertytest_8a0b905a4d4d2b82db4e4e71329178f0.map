{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/referenceSearch.searchResultOrdering.property.test.ts"],"sourcesContent":["/**\n * Property-Based Test: Search Result Relevance Ordering\n * \n * Feature: destination-wedding-platform\n * Property 17: Search Result Relevance Ordering\n * \n * **Validates: Requirements 16.7**\n * \n * This property test validates that search results are ordered by relevance:\n * 1. Exact matches appear before partial matches\n * 2. Within the same relevance level, results are sorted alphabetically\n * 3. The ordering is consistent across all entity types\n * \n * The test generates random search queries and entity names to verify\n * that the ordering algorithm works correctly for all possible inputs.\n */\n\nimport * as fc from 'fast-check';\n\ninterface SearchResult {\n  id: string;\n  name: string;\n  type: string;\n  slug?: string;\n  status?: string;\n  preview?: string;\n}\n\n/**\n * Sort search results by relevance\n * This implements the same logic as the API route\n */\nfunction sortSearchResults(results: SearchResult[], query: string): SearchResult[] {\n  // Add index to each result for stable sorting\n  const indexedResults = results.map((result, index) => ({ result, index }));\n  \n  indexedResults.sort((a, b) => {\n    const aExact = a.result.name.toLowerCase() === query.toLowerCase();\n    const bExact = b.result.name.toLowerCase() === query.toLowerCase();\n\n    // Exact matches first\n    if (aExact && !bExact) return -1;\n    if (!aExact && bExact) return 1;\n\n    // Then sort alphabetically with normalization for consistent ordering\n    // Trim whitespace for comparison\n    const aName = a.result.name.trim().toLowerCase();\n    const bName = b.result.name.trim().toLowerCase();\n    \n    // Handle empty strings after trimming - sort them to the end\n    if (aName === '' && bName !== '') return 1;\n    if (aName !== '' && bName === '') return -1;\n    \n    // Use simple string comparison for deterministic ordering\n    // This is more predictable than localeCompare for special characters\n    if (aName < bName) return -1;\n    if (aName > bName) return 1;\n    \n    // If names are equal after normalization, maintain original order (stable sort)\n    return a.index - b.index;\n  });\n  \n  return indexedResults.map(({ result }) => result);\n}\n\n// Arbitraries for generating test data\nconst searchResultArbitrary = fc.record({\n  id: fc.uuid(),\n  name: fc.string({ minLength: 1, maxLength: 50 }),\n  type: fc.constantFrom('event', 'activity', 'accommodation', 'room_type', 'content_page'),\n  slug: fc.option(fc.string({ minLength: 1, maxLength: 50 }), { nil: undefined }),\n  status: fc.option(fc.constantFrom('active', 'inactive', 'published', 'draft'), { nil: undefined }),\n  preview: fc.option(fc.string({ minLength: 1, maxLength: 100 }), { nil: undefined }),\n});\n\ndescribe('Feature: destination-wedding-platform, Property 17: Search Result Relevance Ordering', () => {\n  it('should place exact matches before partial matches', () => {\n    fc.assert(\n      fc.property(\n        fc.string({ minLength: 1, maxLength: 20 }),\n        fc.array(searchResultArbitrary, { minLength: 2, maxLength: 20 }),\n        (query, results) => {\n          // Ensure we have at least one exact match and one partial match\n          if (results.length < 2) return true;\n\n          // Create an exact match\n          const exactMatch = { ...results[0], name: query };\n          // Create a partial match\n          const partialMatch = { ...results[1], name: `${query} extra` };\n\n          const testResults = [partialMatch, exactMatch, ...results.slice(2)];\n          const sorted = sortSearchResults(testResults, query);\n\n          // Find positions\n          const exactIndex = sorted.findIndex((r) => r.name.toLowerCase() === query.toLowerCase());\n          const partialIndex = sorted.findIndex(\n            (r) => r.name.toLowerCase().includes(query.toLowerCase()) && r.name.toLowerCase() !== query.toLowerCase()\n          );\n\n          // Exact match should come before partial match\n          if (exactIndex !== -1 && partialIndex !== -1) {\n            return exactIndex < partialIndex;\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should sort alphabetically within same relevance level', () => {\n    fc.assert(\n      fc.property(\n        fc.string({ minLength: 1, maxLength: 20 }),\n        fc.array(fc.string({ minLength: 1, maxLength: 50 }), { minLength: 3, maxLength: 10 }),\n        (query, names) => {\n          // Create results with names that all partially match\n          const results: SearchResult[] = names.map((name, index) => ({\n            id: `id-${index}`,\n            name: `${query} ${name}`,\n            type: 'event',\n          }));\n\n          const sorted = sortSearchResults(results, query);\n\n          // All results are partial matches (same relevance level)\n          // They should be sorted alphabetically with empty strings at the end\n          for (let i = 0; i < sorted.length - 1; i++) {\n            // Compare using the same normalization as the sorting function\n            const current = sorted[i].name.trim().toLowerCase();\n            const next = sorted[i + 1].name.trim().toLowerCase();\n\n            // Empty strings should be at the end\n            if (current === '' && next !== '') {\n              return false; // Empty string should not come before non-empty\n            }\n            \n            // For non-empty strings, check alphabetical order (allow equal values)\n            if (current !== '' && next !== '' && current > next) {\n              return false;\n            }\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain consistent ordering across multiple sorts', () => {\n    fc.assert(\n      fc.property(\n        fc.string({ minLength: 1, maxLength: 20 }),\n        fc.array(searchResultArbitrary, { minLength: 5, maxLength: 20 }),\n        (query, results) => {\n          const sorted1 = sortSearchResults([...results], query);\n          const sorted2 = sortSearchResults([...results], query);\n\n          // The ordering should be deterministic\n          return JSON.stringify(sorted1) === JSON.stringify(sorted2);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle case-insensitive matching', () => {\n    fc.assert(\n      fc.property(\n        fc.string({ minLength: 1, maxLength: 20 }).filter((s) => s.toLowerCase() !== s.toUpperCase()),\n        fc.array(searchResultArbitrary, { minLength: 2, maxLength: 10 }),\n        (query, results) => {\n          // Create exact matches with different cases\n          const lowerMatch = { ...results[0], name: query.toLowerCase() };\n          const upperMatch = { ...results[1], name: query.toUpperCase() };\n\n          const testResults = [upperMatch, lowerMatch];\n          const sorted = sortSearchResults(testResults, query);\n\n          // Both should be treated as exact matches\n          const firstIsExact = sorted[0].name.toLowerCase() === query.toLowerCase();\n          const secondIsExact = sorted[1].name.toLowerCase() === query.toLowerCase();\n\n          return firstIsExact && secondIsExact;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle empty result sets', () => {\n    fc.assert(\n      fc.property(fc.string({ minLength: 1, maxLength: 20 }), (query) => {\n        const sorted = sortSearchResults([], query);\n        return sorted.length === 0;\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle single result', () => {\n    fc.assert(\n      fc.property(fc.string({ minLength: 1, maxLength: 20 }), searchResultArbitrary, (query, result) => {\n        const sorted = sortSearchResults([result], query);\n        return sorted.length === 1 && sorted[0].id === result.id;\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should preserve all results without loss', () => {\n    fc.assert(\n      fc.property(\n        fc.string({ minLength: 1, maxLength: 20 }),\n        fc.array(searchResultArbitrary, { minLength: 1, maxLength: 50 }),\n        (query, results) => {\n          const sorted = sortSearchResults(results, query);\n\n          // All results should be present\n          if (sorted.length !== results.length) return false;\n\n          // All IDs should be present\n          const originalIds = new Set(results.map((r) => r.id));\n          const sortedIds = new Set(sorted.map((r) => r.id));\n\n          return originalIds.size === sortedIds.size && [...originalIds].every((id) => sortedIds.has(id));\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle special characters in query', () => {\n    fc.assert(\n      fc.property(\n        fc.string({ minLength: 1, maxLength: 20 }),\n        fc.array(searchResultArbitrary, { minLength: 2, maxLength: 10 }),\n        (query, results) => {\n          // Add special characters to query\n          const specialQuery = `${query}!@#$%`;\n\n          // Create an exact match with special characters\n          const exactMatch = { ...results[0], name: specialQuery };\n          const testResults = [exactMatch, ...results.slice(1)];\n\n          const sorted = sortSearchResults(testResults, specialQuery);\n\n          // Exact match should be first\n          return sorted[0].name === specialQuery;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle unicode characters', () => {\n    fc.assert(\n      fc.property(\n        fc.unicodeString({ minLength: 1, maxLength: 20 }),\n        fc.array(searchResultArbitrary, { minLength: 2, maxLength: 10 }),\n        (query, results) => {\n          // Create an exact match with unicode\n          const exactMatch = { ...results[0], name: query };\n          const partialMatch = { ...results[1], name: `${query} extra` };\n\n          const testResults = [partialMatch, exactMatch];\n          const sorted = sortSearchResults(testResults, query);\n\n          // Exact match should be first\n          return sorted[0].name === query;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle whitespace in names and queries', () => {\n    fc.assert(\n      fc.property(\n        fc.string({ minLength: 1, maxLength: 20 }),\n        fc.array(searchResultArbitrary, { minLength: 2, maxLength: 10 }),\n        (query, results) => {\n          // Add whitespace\n          const queryWithSpace = `  ${query}  `;\n          const exactMatch = { ...results[0], name: query };\n\n          const testResults = [exactMatch, ...results.slice(1)];\n          const sorted = sortSearchResults(testResults, query);\n\n          // Should still find exact match (after trimming)\n          const hasExactMatch = sorted.some((r) => r.name.toLowerCase() === query.toLowerCase());\n          return hasExactMatch;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["sortSearchResults","results","query","indexedResults","map","result","index","sort","a","b","aExact","name","toLowerCase","bExact","aName","trim","bName","searchResultArbitrary","fc","record","id","uuid","string","minLength","maxLength","type","constantFrom","slug","option","nil","undefined","status","preview","describe","it","assert","property","array","length","exactMatch","partialMatch","testResults","slice","sorted","exactIndex","findIndex","r","partialIndex","includes","numRuns","names","i","current","next","sorted1","sorted2","JSON","stringify","filter","s","toUpperCase","lowerMatch","upperMatch","firstIsExact","secondIsExact","originalIds","Set","sortedIds","size","every","has","specialQuery","unicodeString","queryWithSpace","hasExactMatch","some"],"mappings":"AAAA;;;;;;;;;;;;;;;CAeC;;;;mEAEmB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWpB;;;CAGC,GACD,SAASA,kBAAkBC,OAAuB,EAAEC,KAAa;IAC/D,8CAA8C;IAC9C,MAAMC,iBAAiBF,QAAQG,GAAG,CAAC,CAACC,QAAQC,QAAW,CAAA;YAAED;YAAQC;QAAM,CAAA;IAEvEH,eAAeI,IAAI,CAAC,CAACC,GAAGC;QACtB,MAAMC,SAASF,EAAEH,MAAM,CAACM,IAAI,CAACC,WAAW,OAAOV,MAAMU,WAAW;QAChE,MAAMC,SAASJ,EAAEJ,MAAM,CAACM,IAAI,CAACC,WAAW,OAAOV,MAAMU,WAAW;QAEhE,sBAAsB;QACtB,IAAIF,UAAU,CAACG,QAAQ,OAAO,CAAC;QAC/B,IAAI,CAACH,UAAUG,QAAQ,OAAO;QAE9B,sEAAsE;QACtE,iCAAiC;QACjC,MAAMC,QAAQN,EAAEH,MAAM,CAACM,IAAI,CAACI,IAAI,GAAGH,WAAW;QAC9C,MAAMI,QAAQP,EAAEJ,MAAM,CAACM,IAAI,CAACI,IAAI,GAAGH,WAAW;QAE9C,6DAA6D;QAC7D,IAAIE,UAAU,MAAME,UAAU,IAAI,OAAO;QACzC,IAAIF,UAAU,MAAME,UAAU,IAAI,OAAO,CAAC;QAE1C,0DAA0D;QAC1D,qEAAqE;QACrE,IAAIF,QAAQE,OAAO,OAAO,CAAC;QAC3B,IAAIF,QAAQE,OAAO,OAAO;QAE1B,gFAAgF;QAChF,OAAOR,EAAEF,KAAK,GAAGG,EAAEH,KAAK;IAC1B;IAEA,OAAOH,eAAeC,GAAG,CAAC,CAAC,EAAEC,MAAM,EAAE,GAAKA;AAC5C;AAEA,uCAAuC;AACvC,MAAMY,wBAAwBC,WAAGC,MAAM,CAAC;IACtCC,IAAIF,WAAGG,IAAI;IACXV,MAAMO,WAAGI,MAAM,CAAC;QAAEC,WAAW;QAAGC,WAAW;IAAG;IAC9CC,MAAMP,WAAGQ,YAAY,CAAC,SAAS,YAAY,iBAAiB,aAAa;IACzEC,MAAMT,WAAGU,MAAM,CAACV,WAAGI,MAAM,CAAC;QAAEC,WAAW;QAAGC,WAAW;IAAG,IAAI;QAAEK,KAAKC;IAAU;IAC7EC,QAAQb,WAAGU,MAAM,CAACV,WAAGQ,YAAY,CAAC,UAAU,YAAY,aAAa,UAAU;QAAEG,KAAKC;IAAU;IAChGE,SAASd,WAAGU,MAAM,CAACV,WAAGI,MAAM,CAAC;QAAEC,WAAW;QAAGC,WAAW;IAAI,IAAI;QAAEK,KAAKC;IAAU;AACnF;AAEAG,SAAS,wFAAwF;IAC/FC,GAAG,qDAAqD;QACtDhB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IACxCN,WAAGmB,KAAK,CAACpB,uBAAuB;YAAEM,WAAW;YAAGC,WAAW;QAAG,IAC9D,CAACtB,OAAOD;YACN,gEAAgE;YAChE,IAAIA,QAAQqC,MAAM,GAAG,GAAG,OAAO;YAE/B,wBAAwB;YACxB,MAAMC,aAAa;gBAAE,GAAGtC,OAAO,CAAC,EAAE;gBAAEU,MAAMT;YAAM;YAChD,yBAAyB;YACzB,MAAMsC,eAAe;gBAAE,GAAGvC,OAAO,CAAC,EAAE;gBAAEU,MAAM,GAAGT,MAAM,MAAM,CAAC;YAAC;YAE7D,MAAMuC,cAAc;gBAACD;gBAAcD;mBAAetC,QAAQyC,KAAK,CAAC;aAAG;YACnE,MAAMC,SAAS3C,kBAAkByC,aAAavC;YAE9C,iBAAiB;YACjB,MAAM0C,aAAaD,OAAOE,SAAS,CAAC,CAACC,IAAMA,EAAEnC,IAAI,CAACC,WAAW,OAAOV,MAAMU,WAAW;YACrF,MAAMmC,eAAeJ,OAAOE,SAAS,CACnC,CAACC,IAAMA,EAAEnC,IAAI,CAACC,WAAW,GAAGoC,QAAQ,CAAC9C,MAAMU,WAAW,OAAOkC,EAAEnC,IAAI,CAACC,WAAW,OAAOV,MAAMU,WAAW;YAGzG,+CAA+C;YAC/C,IAAIgC,eAAe,CAAC,KAAKG,iBAAiB,CAAC,GAAG;gBAC5C,OAAOH,aAAaG;YACtB;YAEA,OAAO;QACT,IAEF;YAAEE,SAAS;QAAI;IAEnB;IAEAf,GAAG,0DAA0D;QAC3DhB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IACxCN,WAAGmB,KAAK,CAACnB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IAAI;YAAED,WAAW;YAAGC,WAAW;QAAG,IACnF,CAACtB,OAAOgD;YACN,qDAAqD;YACrD,MAAMjD,UAA0BiD,MAAM9C,GAAG,CAAC,CAACO,MAAML,QAAW,CAAA;oBAC1Dc,IAAI,CAAC,GAAG,EAAEd,OAAO;oBACjBK,MAAM,GAAGT,MAAM,CAAC,EAAES,MAAM;oBACxBc,MAAM;gBACR,CAAA;YAEA,MAAMkB,SAAS3C,kBAAkBC,SAASC;YAE1C,yDAAyD;YACzD,qEAAqE;YACrE,IAAK,IAAIiD,IAAI,GAAGA,IAAIR,OAAOL,MAAM,GAAG,GAAGa,IAAK;gBAC1C,+DAA+D;gBAC/D,MAAMC,UAAUT,MAAM,CAACQ,EAAE,CAACxC,IAAI,CAACI,IAAI,GAAGH,WAAW;gBACjD,MAAMyC,OAAOV,MAAM,CAACQ,IAAI,EAAE,CAACxC,IAAI,CAACI,IAAI,GAAGH,WAAW;gBAElD,qCAAqC;gBACrC,IAAIwC,YAAY,MAAMC,SAAS,IAAI;oBACjC,OAAO,OAAO,gDAAgD;gBAChE;gBAEA,uEAAuE;gBACvE,IAAID,YAAY,MAAMC,SAAS,MAAMD,UAAUC,MAAM;oBACnD,OAAO;gBACT;YACF;YAEA,OAAO;QACT,IAEF;YAAEJ,SAAS;QAAI;IAEnB;IAEAf,GAAG,6DAA6D;QAC9DhB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IACxCN,WAAGmB,KAAK,CAACpB,uBAAuB;YAAEM,WAAW;YAAGC,WAAW;QAAG,IAC9D,CAACtB,OAAOD;YACN,MAAMqD,UAAUtD,kBAAkB;mBAAIC;aAAQ,EAAEC;YAChD,MAAMqD,UAAUvD,kBAAkB;mBAAIC;aAAQ,EAAEC;YAEhD,uCAAuC;YACvC,OAAOsD,KAAKC,SAAS,CAACH,aAAaE,KAAKC,SAAS,CAACF;QACpD,IAEF;YAAEN,SAAS;QAAI;IAEnB;IAEAf,GAAG,2CAA2C;QAC5ChB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,GAAGkC,MAAM,CAAC,CAACC,IAAMA,EAAE/C,WAAW,OAAO+C,EAAEC,WAAW,KAC1F1C,WAAGmB,KAAK,CAACpB,uBAAuB;YAAEM,WAAW;YAAGC,WAAW;QAAG,IAC9D,CAACtB,OAAOD;YACN,4CAA4C;YAC5C,MAAM4D,aAAa;gBAAE,GAAG5D,OAAO,CAAC,EAAE;gBAAEU,MAAMT,MAAMU,WAAW;YAAG;YAC9D,MAAMkD,aAAa;gBAAE,GAAG7D,OAAO,CAAC,EAAE;gBAAEU,MAAMT,MAAM0D,WAAW;YAAG;YAE9D,MAAMnB,cAAc;gBAACqB;gBAAYD;aAAW;YAC5C,MAAMlB,SAAS3C,kBAAkByC,aAAavC;YAE9C,0CAA0C;YAC1C,MAAM6D,eAAepB,MAAM,CAAC,EAAE,CAAChC,IAAI,CAACC,WAAW,OAAOV,MAAMU,WAAW;YACvE,MAAMoD,gBAAgBrB,MAAM,CAAC,EAAE,CAAChC,IAAI,CAACC,WAAW,OAAOV,MAAMU,WAAW;YAExE,OAAOmD,gBAAgBC;QACzB,IAEF;YAAEf,SAAS;QAAI;IAEnB;IAEAf,GAAG,mCAAmC;QACpChB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CAAClB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IAAI,CAACtB;YACvD,MAAMyC,SAAS3C,kBAAkB,EAAE,EAAEE;YACrC,OAAOyC,OAAOL,MAAM,KAAK;QAC3B,IACA;YAAEW,SAAS;QAAI;IAEnB;IAEAf,GAAG,+BAA+B;QAChChB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CAAClB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IAAIP,uBAAuB,CAACf,OAAOG;YACrF,MAAMsC,SAAS3C,kBAAkB;gBAACK;aAAO,EAAEH;YAC3C,OAAOyC,OAAOL,MAAM,KAAK,KAAKK,MAAM,CAAC,EAAE,CAACvB,EAAE,KAAKf,OAAOe,EAAE;QAC1D,IACA;YAAE6B,SAAS;QAAI;IAEnB;IAEAf,GAAG,4CAA4C;QAC7ChB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IACxCN,WAAGmB,KAAK,CAACpB,uBAAuB;YAAEM,WAAW;YAAGC,WAAW;QAAG,IAC9D,CAACtB,OAAOD;YACN,MAAM0C,SAAS3C,kBAAkBC,SAASC;YAE1C,gCAAgC;YAChC,IAAIyC,OAAOL,MAAM,KAAKrC,QAAQqC,MAAM,EAAE,OAAO;YAE7C,4BAA4B;YAC5B,MAAM2B,cAAc,IAAIC,IAAIjE,QAAQG,GAAG,CAAC,CAAC0C,IAAMA,EAAE1B,EAAE;YACnD,MAAM+C,YAAY,IAAID,IAAIvB,OAAOvC,GAAG,CAAC,CAAC0C,IAAMA,EAAE1B,EAAE;YAEhD,OAAO6C,YAAYG,IAAI,KAAKD,UAAUC,IAAI,IAAI;mBAAIH;aAAY,CAACI,KAAK,CAAC,CAACjD,KAAO+C,UAAUG,GAAG,CAAClD;QAC7F,IAEF;YAAE6B,SAAS;QAAI;IAEnB;IAEAf,GAAG,6CAA6C;QAC9ChB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IACxCN,WAAGmB,KAAK,CAACpB,uBAAuB;YAAEM,WAAW;YAAGC,WAAW;QAAG,IAC9D,CAACtB,OAAOD;YACN,kCAAkC;YAClC,MAAMsE,eAAe,GAAGrE,MAAM,KAAK,CAAC;YAEpC,gDAAgD;YAChD,MAAMqC,aAAa;gBAAE,GAAGtC,OAAO,CAAC,EAAE;gBAAEU,MAAM4D;YAAa;YACvD,MAAM9B,cAAc;gBAACF;mBAAetC,QAAQyC,KAAK,CAAC;aAAG;YAErD,MAAMC,SAAS3C,kBAAkByC,aAAa8B;YAE9C,8BAA8B;YAC9B,OAAO5B,MAAM,CAAC,EAAE,CAAChC,IAAI,KAAK4D;QAC5B,IAEF;YAAEtB,SAAS;QAAI;IAEnB;IAEAf,GAAG,oCAAoC;QACrChB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGsD,aAAa,CAAC;YAAEjD,WAAW;YAAGC,WAAW;QAAG,IAC/CN,WAAGmB,KAAK,CAACpB,uBAAuB;YAAEM,WAAW;YAAGC,WAAW;QAAG,IAC9D,CAACtB,OAAOD;YACN,qCAAqC;YACrC,MAAMsC,aAAa;gBAAE,GAAGtC,OAAO,CAAC,EAAE;gBAAEU,MAAMT;YAAM;YAChD,MAAMsC,eAAe;gBAAE,GAAGvC,OAAO,CAAC,EAAE;gBAAEU,MAAM,GAAGT,MAAM,MAAM,CAAC;YAAC;YAE7D,MAAMuC,cAAc;gBAACD;gBAAcD;aAAW;YAC9C,MAAMI,SAAS3C,kBAAkByC,aAAavC;YAE9C,8BAA8B;YAC9B,OAAOyC,MAAM,CAAC,EAAE,CAAChC,IAAI,KAAKT;QAC5B,IAEF;YAAE+C,SAAS;QAAI;IAEnB;IAEAf,GAAG,iDAAiD;QAClDhB,WAAGiB,MAAM,CACPjB,WAAGkB,QAAQ,CACTlB,WAAGI,MAAM,CAAC;YAAEC,WAAW;YAAGC,WAAW;QAAG,IACxCN,WAAGmB,KAAK,CAACpB,uBAAuB;YAAEM,WAAW;YAAGC,WAAW;QAAG,IAC9D,CAACtB,OAAOD;YACN,iBAAiB;YACjB,MAAMwE,iBAAiB,CAAC,EAAE,EAAEvE,MAAM,EAAE,CAAC;YACrC,MAAMqC,aAAa;gBAAE,GAAGtC,OAAO,CAAC,EAAE;gBAAEU,MAAMT;YAAM;YAEhD,MAAMuC,cAAc;gBAACF;mBAAetC,QAAQyC,KAAK,CAAC;aAAG;YACrD,MAAMC,SAAS3C,kBAAkByC,aAAavC;YAE9C,iDAAiD;YACjD,MAAMwE,gBAAgB/B,OAAOgC,IAAI,CAAC,CAAC7B,IAAMA,EAAEnC,IAAI,CAACC,WAAW,OAAOV,MAAMU,WAAW;YACnF,OAAO8D;QACT,IAEF;YAAEzB,SAAS;QAAI;IAEnB;AACF"}