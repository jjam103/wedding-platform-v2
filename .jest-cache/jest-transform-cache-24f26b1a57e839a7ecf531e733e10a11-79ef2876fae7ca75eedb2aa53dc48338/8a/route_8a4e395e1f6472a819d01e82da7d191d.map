{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/activities/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport * as activityService from '@/services/activityService';\nimport { createAuthenticatedClient } from '@/lib/supabaseServer';\n\n/**\n * GET /api/admin/activities\n * \n * Lists all activities with optional filtering.\n * \n * Requirements: 5.1, 5.2\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. Auth check\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. Parse query parameters\n    const { searchParams } = new URL(request.url);\n    const filters: any = {};\n    \n    if (searchParams.get('eventId')) {\n      filters.eventId = searchParams.get('eventId');\n    }\n    if (searchParams.get('status')) {\n      filters.status = searchParams.get('status');\n    }\n    if (searchParams.get('activityType')) {\n      filters.activityType = searchParams.get('activityType');\n    }\n    if (searchParams.get('locationId')) {\n      filters.locationId = searchParams.get('locationId');\n    }\n    if (searchParams.get('page')) {\n      filters.page = parseInt(searchParams.get('page')!, 10);\n    }\n    if (searchParams.get('pageSize')) {\n      filters.pageSize = parseInt(searchParams.get('pageSize')!, 10);\n    }\n\n    // 3. Call service\n    const result = await activityService.list(filters);\n\n    // 4. Return response\n    return NextResponse.json(result, { status: result.success ? 200 : 500 });\n  } catch (error) {\n    console.error('Activities API Error:', error);\n    console.error('Error details:', {\n      message: error instanceof Error ? error.message : 'Unknown',\n      stack: error instanceof Error ? error.stack : undefined,\n      env: {\n        hasUrl: !!process.env.NEXT_PUBLIC_SUPABASE_URL,\n        hasServiceKey: !!process.env.SUPABASE_SERVICE_ROLE_KEY,\n      }\n    });\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'INTERNAL_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n          stack: error instanceof Error ? error.stack : undefined,\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/admin/activities\n * \n * Creates a new activity.\n * \n * Requirements: 5.5, 5.6\n */\nexport async function POST(request: Request) {\n  try {\n    // 1. Auth check\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. Parse and validate request body\n    const body = await request.json();\n\n    // 3. Call service\n    const result = await activityService.create(body);\n\n    // 4. Return response with proper status\n    if (!result.success) {\n      const statusCode = result.error.code === 'VALIDATION_ERROR' ? 400 : 500;\n      return NextResponse.json(result, { status: statusCode });\n    }\n\n    return NextResponse.json(result, { status: 201 });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'INTERNAL_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","request","supabase","createAuthenticatedClient","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","searchParams","URL","url","filters","get","eventId","activityType","locationId","page","parseInt","pageSize","result","activityService","list","console","Error","stack","undefined","env","hasUrl","process","NEXT_PUBLIC_SUPABASE_URL","hasServiceKey","SUPABASE_SERVICE_ROLE_KEY","body","create","statusCode"],"mappings":"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"}