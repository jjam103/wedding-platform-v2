{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/guest/GuestDashboard.test.tsx"],"sourcesContent":["import { render, screen, waitFor } from '@testing-library/react';\nimport { GuestDashboard } from './GuestDashboard';\nimport type { Guest } from '@/types';\n\n// Mock fetch\nglobal.fetch = jest.fn();\n\nconst mockGuest: Guest = {\n  id: 'guest-1',\n  first_name: 'John',\n  last_name: 'Doe',\n  email: 'john@example.com',\n  age_type: 'adult',\n  guest_type: 'wedding_guest',\n  group_id: 'group-1',\n  created_at: '2024-01-01T00:00:00Z',\n  updated_at: '2024-01-01T00:00:00Z',\n};\n\nconst mockWeddingInfo = {\n  date: '2024-12-25T00:00:00Z',\n  location: 'Manuel Antonio, Costa Rica',\n  venue: 'Arenas del Mar Resort',\n};\n\nconst mockAnnouncements = [\n  {\n    id: 'ann-1',\n    title: 'Important Update',\n    message: 'Please RSVP by December 1st',\n    urgent: true,\n    created_at: '2024-01-15T00:00:00Z',\n  },\n  {\n    id: 'ann-2',\n    title: 'Welcome',\n    message: 'We are excited to celebrate with you!',\n    urgent: false,\n    created_at: '2024-01-10T00:00:00Z',\n  },\n];\n\nconst mockUpcomingEvents = [\n  {\n    id: 'event-1',\n    name: 'Welcome Reception',\n    type: 'event' as const,\n    date: '2024-12-24T18:00:00Z',\n    time: '6:00 PM',\n    location: 'Beach Pavilion',\n    rsvpStatus: 'pending' as const,\n  },\n  {\n    id: 'event-2',\n    name: 'Wedding Ceremony',\n    type: 'event' as const,\n    date: '2024-12-25T16:00:00Z',\n    time: '4:00 PM',\n    location: 'Oceanfront Terrace',\n    rsvpStatus: 'attending' as const,\n  },\n];\n\nconst mockRsvps = [\n  { id: 'rsvp-1', status: 'attending' },\n  { id: 'rsvp-2', status: 'attending' },\n  { id: 'rsvp-3', status: 'pending' },\n  { id: 'rsvp-4', status: 'maybe' },\n  { id: 'rsvp-5', status: 'declined' },\n];\n\ndescribe('GuestDashboard', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (global.fetch as jest.Mock).mockImplementation((url: string) => {\n      if (url.includes('/api/guest/events')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: mockUpcomingEvents }),\n        });\n      }\n      if (url.includes('/api/guest/rsvps')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: mockRsvps }),\n        });\n      }\n      if (url.includes('/api/guest/wedding-info')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: mockWeddingInfo }),\n        });\n      }\n      if (url.includes('/api/guest/announcements')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: mockAnnouncements }),\n        });\n      }\n      return Promise.resolve({\n        ok: false,\n        json: () => Promise.resolve({ success: false }),\n      });\n    });\n  });\n\n  it('should render welcome message with guest name', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/¡Pura Vida, John!/i)).toBeInTheDocument();\n    });\n  });\n\n  it('should display wedding date, location, and venue', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/Costa Rica Wedding/i)).toBeInTheDocument();\n      expect(screen.getByText(/Manuel Antonio, Costa Rica/i)).toBeInTheDocument();\n      expect(screen.getByText(/Arenas del Mar Resort/i)).toBeInTheDocument();\n    });\n  });\n\n  it('should display RSVP summary with correct counts', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Total Events:')).toBeInTheDocument();\n      expect(screen.getByText('5')).toBeInTheDocument(); // total\n      expect(screen.getByText('2')).toBeInTheDocument(); // attending\n      expect(screen.getByText('1')).toBeInTheDocument(); // pending, maybe, declined\n    });\n  });\n\n  it('should display upcoming events', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Welcome Reception')).toBeInTheDocument();\n      expect(screen.getByText('Wedding Ceremony')).toBeInTheDocument();\n      expect(screen.getByText('Beach Pavilion')).toBeInTheDocument();\n      expect(screen.getByText('Oceanfront Terrace')).toBeInTheDocument();\n    });\n  });\n\n  it('should display RSVP status for each event', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Pending Response')).toBeInTheDocument();\n      expect(screen.getByText('Attending')).toBeInTheDocument();\n    });\n  });\n\n  it('should display quick action links', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/Family Information/i)).toBeInTheDocument();\n      expect(screen.getByText(/Transportation Details/i)).toBeInTheDocument();\n      expect(screen.getByText(/Accommodation Info/i)).toBeInTheDocument();\n      expect(screen.getByText(/Upload Photos/i)).toBeInTheDocument();\n      expect(screen.getByText(/View Itinerary/i)).toBeInTheDocument();\n    });\n  });\n\n  it('should display urgent announcements first', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      const announcements = screen.getAllByRole('heading', { level: 3 });\n      const urgentIndex = announcements.findIndex((h) => h.textContent === 'Important Update');\n      const normalIndex = announcements.findIndex((h) => h.textContent === 'Welcome');\n      \n      expect(urgentIndex).toBeLessThan(normalIndex);\n    });\n  });\n\n  it('should display urgent indicator for urgent announcements', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('⚠️')).toBeInTheDocument();\n    });\n  });\n\n  it('should show loading state initially', () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    expect(screen.getByText(/Loading/i)).toBeInTheDocument();\n  });\n\n  it('should handle API errors gracefully', async () => {\n    (global.fetch as jest.Mock).mockImplementation(() =>\n      Promise.resolve({\n        ok: false,\n        json: () => Promise.resolve({ success: false }),\n      })\n    );\n\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/Failed to load dashboard data/i)).toBeInTheDocument();\n    });\n  });\n\n  it('should show \"Respond to RSVP\" button for pending events', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Respond to RSVP')).toBeInTheDocument();\n    });\n  });\n\n  it('should not show \"Respond to RSVP\" button for non-pending events', async () => {\n    const eventsWithoutPending = mockUpcomingEvents.filter(\n      (e) => e.rsvpStatus !== 'pending'\n    );\n\n    (global.fetch as jest.Mock).mockImplementation((url: string) => {\n      if (url.includes('/api/guest/events')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: eventsWithoutPending }),\n        });\n      }\n      if (url.includes('/api/guest/rsvps')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: mockRsvps }),\n        });\n      }\n      return Promise.resolve({\n        ok: true,\n        json: () => Promise.resolve({ success: true, data: [] }),\n      });\n    });\n\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.queryByText('Respond to RSVP')).not.toBeInTheDocument();\n    });\n  });\n\n  it('should display \"Manage RSVPs\" button', async () => {\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Manage RSVPs')).toBeInTheDocument();\n    });\n  });\n\n  it('should show message when no upcoming events', async () => {\n    (global.fetch as jest.Mock).mockImplementation((url: string) => {\n      if (url.includes('/api/guest/events')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: [] }),\n        });\n      }\n      if (url.includes('/api/guest/rsvps')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({ success: true, data: [] }),\n        });\n      }\n      return Promise.resolve({\n        ok: true,\n        json: () => Promise.resolve({ success: true, data: [] }),\n      });\n    });\n\n    render(<GuestDashboard guest={mockGuest} />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/No upcoming events at this time/i)).toBeInTheDocument();\n    });\n  });\n});\n"],"names":["global","fetch","jest","fn","mockGuest","id","first_name","last_name","email","age_type","guest_type","group_id","created_at","updated_at","mockWeddingInfo","date","location","venue","mockAnnouncements","title","message","urgent","mockUpcomingEvents","name","type","time","rsvpStatus","mockRsvps","status","describe","beforeEach","clearAllMocks","mockImplementation","url","includes","Promise","resolve","ok","json","success","data","it","render","GuestDashboard","guest","waitFor","expect","screen","getByText","toBeInTheDocument","announcements","getAllByRole","level","urgentIndex","findIndex","h","textContent","normalIndex","toBeLessThan","eventsWithoutPending","filter","e","queryByText","not"],"mappings":"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"}