{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/LocationSelector.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useMemo } from 'react';\nimport type { LocationWithChildren, Location } from '@/schemas/locationSchemas';\n\ninterface LocationSelectorProps {\n  value?: string | null;\n  onChange?: (locationId: string | null) => void;\n  placeholder?: string;\n  excludeId?: string; // Exclude this location and its descendants (for circular reference prevention)\n  required?: boolean;\n  // Alternative API for passing locations directly (flexible type to accept various location formats)\n  locations?: any[];\n  selectedLocationId?: string;\n  onSelect?: (locationId: string) => void;\n}\n\nexport function LocationSelector({\n  value,\n  onChange,\n  placeholder = 'Select a location',\n  excludeId,\n  required = false,\n  locations: externalLocations,\n  selectedLocationId,\n  onSelect,\n}: LocationSelectorProps) {\n  const [locations, setLocations] = useState<LocationWithChildren[]>([]);\n  const [loading, setLoading] = useState(!externalLocations);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n\n  // Convert external locations to LocationWithChildren format if needed\n  useEffect(() => {\n    if (externalLocations) {\n      // Check if locations have children property (LocationWithChildren)\n      const hasChildren = externalLocations.length > 0 && 'children' in externalLocations[0];\n      \n      if (hasChildren) {\n        setLocations(externalLocations as LocationWithChildren[]);\n      } else {\n        // Convert simple location objects to LocationWithChildren[] format\n        const converted = externalLocations.map((loc: any) => ({\n          id: loc.id,\n          name: loc.name,\n          parentLocationId: loc.parentLocationId || loc.parent_location_id || null,\n          children: [],\n          address: loc.address || null,\n          coordinates: loc.coordinates || null,\n          description: loc.description || null,\n          createdAt: loc.createdAt || loc.created_at || new Date().toISOString(),\n          updatedAt: loc.updatedAt || loc.updated_at || new Date().toISOString(),\n        }));\n        setLocations(converted);\n      }\n      setLoading(false);\n    }\n  }, [externalLocations]);\n\n  // Load locations only if not provided externally\n  useEffect(() => {\n    if (externalLocations) return; // Skip if locations are provided\n    \n    async function loadLocations() {\n      try {\n        const response = await fetch('/api/admin/locations');\n        const result = await response.json();\n        \n        if (result.success) {\n          setLocations(result.data);\n        }\n      } catch (err) {\n        console.error('Failed to load locations:', err);\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    loadLocations();\n  }, []);\n\n  // Flatten locations with hierarchy path\n  const flatLocations = useMemo(() => {\n    const result: Array<{ id: string; name: string; path: string; level: number }> = [];\n\n    function traverse(\n      locs: LocationWithChildren[],\n      parentPath: string = '',\n      level: number = 0\n    ) {\n      for (const loc of locs) {\n        // Skip excluded location and its descendants\n        if (excludeId && loc.id === excludeId) {\n          continue;\n        }\n\n        const path = parentPath ? `${parentPath} ‚Üí ${loc.name}` : loc.name;\n        result.push({\n          id: loc.id,\n          name: loc.name,\n          path,\n          level,\n        });\n\n        if (loc.children && loc.children.length > 0) {\n          traverse(loc.children, path, level + 1);\n        }\n      }\n    }\n\n    traverse(locations);\n    return result;\n  }, [locations, excludeId]);\n\n  // Filter locations by search query\n  const filteredLocations = useMemo(() => {\n    if (!searchQuery) return flatLocations;\n    \n    const lowerQuery = searchQuery.toLowerCase();\n    return flatLocations.filter((loc) =>\n      loc.name.toLowerCase().includes(lowerQuery) ||\n      loc.path.toLowerCase().includes(lowerQuery)\n    );\n  }, [flatLocations, searchQuery]);\n\n  // Get selected location - support both APIs\n  const currentValue = value !== undefined ? value : selectedLocationId;\n  const selectedLocation = flatLocations.find((loc) => loc.id === currentValue);\n\n  // Handle selection - support both APIs\n  const handleSelect = (locationId: string | null) => {\n    if (onChange) {\n      onChange(locationId);\n    }\n    if (onSelect && locationId) {\n      onSelect(locationId);\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      <button\n        type=\"button\"\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"w-full px-4 py-2 text-left border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n      >\n        {loading ? (\n          <span className=\"text-gray-500\">Loading...</span>\n        ) : selectedLocation ? (\n          <span className=\"text-gray-900\">{selectedLocation.path}</span>\n        ) : (\n          <span className=\"text-gray-500\">{placeholder}</span>\n        )}\n      </button>\n\n      {isOpen && (\n        <>\n          <div\n            className=\"fixed inset-0 z-10\"\n            onClick={() => setIsOpen(false)}\n          />\n          <div className=\"absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-80 overflow-auto\">\n            <div className=\"sticky top-0 bg-white border-b border-gray-200 p-2\">\n              <input\n                type=\"text\"\n                placeholder=\"Search locations...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                onClick={(e) => e.stopPropagation()}\n              />\n            </div>\n\n            {!required && (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  handleSelect(null);\n                  setIsOpen(false);\n                  setSearchQuery('');\n                }}\n                className=\"w-full px-4 py-2 text-left hover:bg-gray-50 text-gray-700\"\n              >\n                <span className=\"italic\">None</span>\n              </button>\n            )}\n\n            {filteredLocations.length === 0 ? (\n              <div className=\"px-4 py-3 text-gray-500 text-center\">\n                No locations found\n              </div>\n            ) : (\n              filteredLocations.map((loc) => (\n                <button\n                  key={loc.id}\n                  type=\"button\"\n                  onClick={() => {\n                    handleSelect(loc.id);\n                    setIsOpen(false);\n                    setSearchQuery('');\n                  }}\n                  className={`w-full px-4 py-2 text-left hover:bg-gray-50 ${\n                    currentValue === loc.id ? 'bg-blue-50 text-blue-700' : 'text-gray-900'\n                  }`}\n                  style={{ paddingLeft: `${16 + loc.level * 16}px` }}\n                >\n                  <span className=\"mr-2\">üìç</span>\n                  {loc.path}\n                </button>\n              ))\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n"],"names":["LocationSelector","value","onChange","placeholder","excludeId","required","locations","externalLocations","selectedLocationId","onSelect","setLocations","useState","loading","setLoading","searchQuery","setSearchQuery","isOpen","setIsOpen","useEffect","hasChildren","length","converted","map","loc","id","name","parentLocationId","parent_location_id","children","address","coordinates","description","createdAt","created_at","Date","toISOString","updatedAt","updated_at","loadLocations","response","fetch","result","json","success","data","err","console","error","flatLocations","useMemo","traverse","locs","parentPath","level","path","push","filteredLocations","lowerQuery","toLowerCase","filter","includes","currentValue","undefined","selectedLocation","find","handleSelect","locationId","div","className","button","type","onClick","span","input","e","target","stopPropagation","style","paddingLeft"],"mappings":"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"}