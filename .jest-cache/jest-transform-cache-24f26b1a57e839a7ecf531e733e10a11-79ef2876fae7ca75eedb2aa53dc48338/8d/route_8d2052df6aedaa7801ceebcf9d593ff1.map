{"version":3,"names":["cov_198thcrrsi","actualCoverage","s","GET","request","f","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","guest","guestError","from","select","eq","user","email","single","familyMembers","age_type","group_id","order","ascending","console"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/family/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\n\n/**\n * Family Members API Routes\n * \n * GET: Get all family members in the guest's group\n * \n * Requirements: 6.3\n */\n\n/**\n * GET /api/guest/family\n * Get all family members in the guest's group\n */\nexport async function GET(request: Request) {\n  try {\n    const supabase = createRouteHandlerClient({ cookies });\n    \n    // Check authentication\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // Get current guest\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, group_id, age_type')\n      .eq('email', session.user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'NOT_FOUND', message: 'Guest profile not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // Get family members based on access control\n    let familyMembers = [];\n    \n    if (guest.age_type === 'adult') {\n      // Adults can see all family members in their group\n      const { data, error } = await supabase\n        .from('guests')\n        .select('*')\n        .eq('group_id', guest.group_id)\n        .order('age_type', { ascending: false }) // Adults first\n        .order('first_name', { ascending: true });\n      \n      if (error) {\n        return NextResponse.json(\n          { success: false, error: { code: 'DATABASE_ERROR', message: error.message } },\n          { status: 500 }\n        );\n      }\n      \n      familyMembers = data || [];\n    } else {\n      // Children can only see themselves\n      familyMembers = [guest];\n    }\n    \n    return NextResponse.json({\n      success: true,\n      data: familyMembers\n    });\n  } catch (error) {\n    console.error('Error fetching family members:', error);\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'Failed to fetch family members' } },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}