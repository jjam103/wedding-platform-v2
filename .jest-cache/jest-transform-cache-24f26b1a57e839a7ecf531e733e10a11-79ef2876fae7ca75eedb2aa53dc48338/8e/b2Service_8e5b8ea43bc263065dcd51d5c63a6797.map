{"version":3,"names":["checkB2Health","cov_vvzfumcib","f","s","generateCDNUrl","getB2HealthStatus","initializeB2Client","isB2Healthy","resetB2Client","uploadToB2","validateB2Config","s3Client","healthStatus","healthy","lastChecked","Date","requiredVars","endpoint","process","env","B2_ENDPOINT","region","B2_REGION","accessKeyId","B2_ACCESS_KEY_ID","secretAccessKey","B2_SECRET_ACCESS_KEY","bucket","B2_BUCKET_NAME","cdnDomain","b","B2_CDN_DOMAIN","CLOUDFLARE_CDN_URL","missing","push","length","success","error","code","message","join","details","data","config","_clients3","S3Client","credentials","forcePathStyle","console","log","undefined","Error","file","fileName","contentType","circuitBreaker","_circuitBreaker","getCircuitBreaker","failureThreshold","successThreshold","timeout","execute","hint","sanitizedFileName","_sanitization","sanitizeInput","replace","timestamp","now","key","command","PutObjectCommand","Bucket","Key","Body","ContentType","CacheControl","send","url","HeadBucketCommand","fiveMinutesAgo","getTime","checkResult"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/b2Service.ts"],"sourcesContent":["import { S3Client, PutObjectCommand, HeadBucketCommand } from '@aws-sdk/client-s3';\nimport { sanitizeInput, sanitizeRichText } from \"../utils/sanitization\";\nimport { getCircuitBreaker } from '../utils/circuitBreaker';\nimport { retryWithBackoff, RetryPresets } from '../utils/retry';\n\ntype Result<T> = \n  | { success: true; data: T } \n  | { success: false; error: { code: string; message: string; details?: any } };\n\ninterface B2Config {\n  endpoint: string;\n  region: string;\n  accessKeyId: string;\n  secretAccessKey: string;\n  bucket: string;\n  cdnDomain: string;\n}\n\ninterface UploadResult {\n  url: string;\n  key: string;\n}\n\ninterface HealthCheckResult {\n  healthy: boolean;\n  lastChecked: Date;\n  error?: string;\n}\n\nlet s3Client: S3Client | null = null;\nlet healthStatus: HealthCheckResult = {\n  healthy: false,\n  lastChecked: new Date(0),\n};\n\n/**\n * Validates B2 environment variables are present and properly configured.\n * \n * @returns Result indicating if configuration is valid\n */\nexport function validateB2Config(): Result<B2Config> {\n  const requiredVars = {\n    endpoint: process.env.B2_ENDPOINT,\n    region: process.env.B2_REGION,\n    accessKeyId: process.env.B2_ACCESS_KEY_ID,\n    secretAccessKey: process.env.B2_SECRET_ACCESS_KEY,\n    bucket: process.env.B2_BUCKET_NAME,\n    cdnDomain: process.env.B2_CDN_DOMAIN || process.env.CLOUDFLARE_CDN_URL,\n  };\n\n  const missing: string[] = [];\n  if (!requiredVars.endpoint) missing.push('B2_ENDPOINT');\n  if (!requiredVars.region) missing.push('B2_REGION');\n  if (!requiredVars.accessKeyId) missing.push('B2_ACCESS_KEY_ID');\n  if (!requiredVars.secretAccessKey) missing.push('B2_SECRET_ACCESS_KEY');\n  if (!requiredVars.bucket) missing.push('B2_BUCKET_NAME');\n  if (!requiredVars.cdnDomain) missing.push('B2_CDN_DOMAIN or CLOUDFLARE_CDN_URL');\n\n  if (missing.length > 0) {\n    return {\n      success: false,\n      error: {\n        code: 'CONFIGURATION_ERROR',\n        message: `Missing required B2 environment variables: ${missing.join(', ')}`,\n        details: { missing },\n      },\n    };\n  }\n\n  return {\n    success: true,\n    data: requiredVars as B2Config,\n  };\n}\n\n/**\n * Initializes the B2 S3-compatible client with configuration.\n * \n * @param config - B2 configuration including endpoint, credentials, and CDN domain\n * @returns Result indicating success or configuration error\n */\nexport function initializeB2Client(config: B2Config): Result<void> {\n  try {\n    if (!config.endpoint || !config.accessKeyId || !config.secretAccessKey || !config.bucket) {\n      const missing: string[] = [];\n      if (!config.endpoint) missing.push('endpoint');\n      if (!config.accessKeyId) missing.push('accessKeyId');\n      if (!config.secretAccessKey) missing.push('secretAccessKey');\n      if (!config.bucket) missing.push('bucket');\n\n      return {\n        success: false,\n        error: {\n          code: 'CONFIGURATION_ERROR',\n          message: `Missing required B2 configuration: ${missing.join(', ')}`,\n          details: { missing },\n        },\n      };\n    }\n\n    s3Client = new S3Client({\n      endpoint: config.endpoint,\n      region: config.region,\n      credentials: {\n        accessKeyId: config.accessKeyId,\n        secretAccessKey: config.secretAccessKey,\n      },\n      forcePathStyle: true, // Required for B2 S3-compatible API\n    });\n\n    console.log('✅ B2 client initialized successfully', {\n      endpoint: config.endpoint,\n      region: config.region,\n      bucket: config.bucket,\n      cdnDomain: config.cdnDomain,\n    });\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    console.error('❌ Failed to initialize B2 client:', error);\n    return {\n      success: false,\n      error: {\n        code: 'INITIALIZATION_ERROR',\n        message: error instanceof Error ? error.message : 'Failed to initialize B2 client',\n        details: error,\n      },\n    };\n  }\n}\n\n/**\n * Uploads a file to Backblaze B2 storage using S3-compatible API.\n * Includes circuit breaker protection and automatic retry with exponential backoff.\n * \n * @param file - File buffer to upload\n * @param fileName - Name for the file (will be sanitized)\n * @param contentType - MIME type of the file\n * @returns Result containing the CDN URL and storage key\n * \n * @example\n * const result = await uploadToB2(fileBuffer, 'photo.jpg', 'image/jpeg');\n * if (result.success) {\n *   console.log('Photo URL:', result.data.url);\n * }\n */\nexport async function uploadToB2(\n  file: Buffer,\n  fileName: string,\n  contentType: string\n): Promise<Result<UploadResult>> {\n  // Get circuit breaker for B2 service\n  const circuitBreaker = getCircuitBreaker('b2-storage', {\n    failureThreshold: 3,\n    successThreshold: 2,\n    timeout: 60000, // 1 minute\n  });\n\n  // Execute with circuit breaker protection\n  return await circuitBreaker.execute(async () => {\n    try {\n      if (!s3Client) {\n        console.error('❌ B2 upload failed: Client not initialized');\n        console.error('   Call initializeB2Client() with valid configuration first');\n        console.error('   Required env vars: B2_ENDPOINT, B2_REGION, B2_ACCESS_KEY_ID, B2_SECRET_ACCESS_KEY, B2_BUCKET_NAME, B2_CDN_DOMAIN');\n        \n        return {\n          success: false,\n          error: {\n            code: 'CLIENT_NOT_INITIALIZED',\n            message: 'B2 client not initialized. Call initializeB2Client first.',\n            details: {\n              hint: 'Check that all required B2 environment variables are set',\n            },\n          },\n        };\n      }\n\n      // Sanitize filename to prevent path traversal\n      const sanitizedFileName = sanitizeInput(fileName).replace(/[^a-zA-Z0-9._-]/g, '_');\n\n      // Generate unique key with timestamp\n      const timestamp = Date.now();\n      const key = `photos/${timestamp}-${sanitizedFileName}`;\n\n      const command = new PutObjectCommand({\n        Bucket: process.env.B2_BUCKET_NAME || '',\n        Key: key,\n        Body: file,\n        ContentType: contentType,\n        CacheControl: 'public, max-age=31536000', // 1 year cache\n      });\n\n      await s3Client.send(command);\n\n      // Generate Cloudflare CDN URL\n      // When using virtual-host style CNAME (bucket.s3.region.backblazeb2.com),\n      // the URL format is just: https://cdn.domain.com/{key}\n      const cdnDomain = process.env.B2_CDN_DOMAIN || '';\n      const url = `https://${cdnDomain}/${key}`;\n\n      return {\n        success: true,\n        data: { url, key },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: {\n          code: 'UPLOAD_ERROR',\n          message: error instanceof Error ? error.message : 'Failed to upload to B2',\n          details: error,\n        },\n      };\n    }\n  });\n}\n\n/**\n * Performs a health check on the B2 storage service.\n * Checks if the bucket is accessible and updates the health status.\n * Includes retry logic for transient failures.\n * \n * @returns Result containing the health check status\n * \n * @example\n * const result = await checkB2Health();\n * if (result.success && result.data.healthy) {\n *   console.log('B2 storage is healthy');\n * }\n */\nexport async function checkB2Health(): Promise<Result<HealthCheckResult>> {\n  try {\n    if (!s3Client) {\n      healthStatus = {\n        healthy: false,\n        lastChecked: new Date(),\n        error: 'B2 client not initialized',\n      };\n      return { success: true, data: healthStatus };\n    }\n\n    const command = new HeadBucketCommand({\n      Bucket: process.env.B2_BUCKET_NAME || '',\n    });\n\n    await s3Client.send(command);\n\n    healthStatus = {\n      healthy: true,\n      lastChecked: new Date(),\n    };\n\n    return { success: true, data: healthStatus };\n  } catch (error) {\n    healthStatus = {\n      healthy: false,\n      lastChecked: new Date(),\n      error: error instanceof Error ? error.message : 'Health check failed',\n    };\n\n    return { success: true, data: healthStatus };\n  }\n}\n\n/**\n * Gets the current health status of B2 storage.\n * Returns cached status without performing a new check.\n * \n * @returns Current health status\n */\nexport function getB2HealthStatus(): HealthCheckResult {\n  return healthStatus;\n}\n\n/**\n * Generates a Cloudflare CDN URL for a given B2 storage key.\n * Assumes Cloudflare CNAME points to virtual-host style B2 endpoint.\n * \n * @param key - Storage key (path) of the file\n * @returns CDN URL for the file\n * \n * @example\n * const url = generateCDNUrl('photos/1234567890-photo.jpg');\n * // Returns: https://cdn.example.com/photos/1234567890-photo.jpg\n * \n * @note Requires Cloudflare CNAME to point to:\n *       bucket-name.s3.region.backblazeb2.com (virtual-host style)\n */\nexport function generateCDNUrl(key: string): string {\n  const cdnDomain = process.env.B2_CDN_DOMAIN || '';\n  // Virtual-host style: CNAME points to bucket.s3.region.backblazeb2.com\n  // So URL is just: https://cdn.domain.com/{key}\n  return `https://${cdnDomain}/${key}`;\n}\n\n/**\n * Checks if B2 storage is currently healthy based on the last health check.\n * If the last check was more than 5 minutes ago, performs a new check.\n * \n * @returns Result indicating if B2 is healthy\n */\nexport async function isB2Healthy(): Promise<Result<boolean>> {\n  const now = new Date();\n  const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000);\n\n  // If last check was more than 5 minutes ago, perform new check\n  if (healthStatus.lastChecked < fiveMinutesAgo) {\n    const checkResult = await checkB2Health();\n    if (!checkResult.success) {\n      return checkResult;\n    }\n  }\n\n  return { success: true, data: healthStatus.healthy };\n}\n\n/**\n * Resets the B2 client and health status.\n * Used primarily for testing purposes.\n */\nexport function resetB2Client(): void {\n  s3Client = null;\n  healthStatus = {\n    healthy: false,\n    lastChecked: new Date(0),\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAuOsBA,cAAA;IAAA;IAAAC,aA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","ignoreList":[]}