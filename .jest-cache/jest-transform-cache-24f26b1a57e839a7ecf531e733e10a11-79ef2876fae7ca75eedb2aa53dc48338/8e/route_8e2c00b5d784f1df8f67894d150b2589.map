{"version":3,"names":["cov_2lbrjbgg3m","actualCoverage","s","POST","moderateSchema","_zod","z","object","moderation_status","enum","moderation_reason","string","max","optional","request","params","f","id","cookieStore","_headers","cookies","supabase","_ssr","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","getAll","setAll","cookiesToSet","forEach","name","value","set","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","idValidation","uuid","safeParse","body","validation","details","issues","result","_photoService","moderatePhoto","statusMap","VALIDATION_ERROR","NOT_FOUND","DATABASE_ERROR","UNKNOWN_ERROR","console"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/photos/[id]/moderate/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\nimport { moderatePhoto } from '@/services/photoService';\nimport { z } from 'zod';\n\nconst moderateSchema = z.object({\n  moderation_status: z.enum(['approved', 'rejected']),\n  moderation_reason: z.string().max(500).optional(),\n});\n\n/**\n * POST /api/admin/photos/[id]/moderate\n * \n * Moderate a photo (approve or reject)\n */\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  try {\n    // 1. Authenticate\n    const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'UNAUTHORIZED',\n            message: 'Authentication required',\n          },\n        },\n        { status: 401 }\n      );\n    }\n\n    // 2. Validate ID\n    const idValidation = z.string().uuid().safeParse(id);\n    if (!idValidation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid photo ID',\n          },\n        },\n        { status: 400 }\n      );\n    }\n\n    // 3. Parse and validate body\n    const body = await request.json();\n    const validation = moderateSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid moderation data',\n            details: validation.error.issues,\n          },\n        },\n        { status: 400 }\n      );\n    }\n\n    // 4. Call service\n    const result = await moderatePhoto(id, validation.data);\n\n    // 5. Return response\n    if (!result.success) {\n      const statusMap: Record<string, number> = {\n        VALIDATION_ERROR: 400,\n        NOT_FOUND: 404,\n        DATABASE_ERROR: 500,\n        UNKNOWN_ERROR: 500,\n      };\n      return NextResponse.json(result, {\n        status: statusMap[result.error.code] || 500,\n      });\n    }\n\n    return NextResponse.json(result, { status: 200 });\n  } catch (error) {\n    console.error('Photo moderation error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'INTERNAL_ERROR',\n          message: 'An unexpected error occurred',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}