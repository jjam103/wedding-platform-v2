{"version":3,"names":["GET","request","cov_2mvyeuvml9","f","s","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","guest","guestError","from","select","eq","user","email","single","searchParams","URL","url","get","to","isNaN","Date","parse","eventsResult","_eventService","list","startDateFrom","undefined","startDateTo","eventsWithRsvp","Promise","all","events","map","event","rsvpResult","_rsvpService","guest_id","id","event_id","page","page_size","rsvpStatus","rsvps","length","console","path"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/events/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport * as eventService from '@/services/eventService';\nimport * as rsvpService from '@/services/rsvpService';\n\n/**\n * GET /api/guest/events\n * \n * Lists all events the authenticated guest is invited to with RSVP status.\n * \n * Query Parameters:\n * - from: ISO date string (optional) - Filter events from this date\n * - to: ISO date string (optional) - Filter events to this date\n * \n * Requirements: 9.1, 9.2, 9.5, 9.6\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. AUTHENTICATION\n    const supabase = createRouteHandlerClient({ cookies });\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // Get guest ID from session\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, group_id')\n      .eq('email', session.user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // 2. VALIDATION (query parameters)\n    const { searchParams } = new URL(request.url);\n    const from = searchParams.get('from');\n    const to = searchParams.get('to');\n    \n    // Validate date formats if provided\n    if (from && isNaN(Date.parse(from))) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid from date format' } },\n        { status: 400 }\n      );\n    }\n    \n    if (to && isNaN(Date.parse(to))) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid to date format' } },\n        { status: 400 }\n      );\n    }\n    \n    // 3. SERVICE CALL - Get published events\n    const eventsResult = await eventService.list({\n      status: 'published',\n      startDateFrom: from || undefined,\n      startDateTo: to || undefined,\n    });\n    \n    if (!eventsResult.success) {\n      return NextResponse.json(eventsResult, { status: 500 });\n    }\n    \n    // Get RSVP status for each event\n    const eventsWithRsvp = await Promise.all(\n      eventsResult.data.events.map(async (event) => {\n        const rsvpResult = await rsvpService.list({ \n          guest_id: guest.id, \n          event_id: event.id,\n          page: 1,\n          page_size: 1\n        });\n        \n        const rsvpStatus = rsvpResult.success && rsvpResult.data.rsvps.length > 0\n          ? rsvpResult.data.rsvps[0].status\n          : 'pending';\n        \n        return {\n          ...event,\n          rsvpStatus,\n        };\n      })\n    );\n    \n    // 4. RESPONSE\n    return NextResponse.json({\n      success: true,\n      data: eventsWithRsvp,\n    });\n    \n  } catch (error) {\n    console.error('API Error:', { path: request.url, error });\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}