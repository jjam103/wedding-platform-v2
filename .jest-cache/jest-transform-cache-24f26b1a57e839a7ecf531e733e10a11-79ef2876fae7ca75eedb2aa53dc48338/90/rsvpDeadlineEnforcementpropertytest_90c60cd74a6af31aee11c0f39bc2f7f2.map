{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/property/rsvpDeadlineEnforcement.property.test.tsx"],"sourcesContent":["/**\n * Property-Based Test: RSVP Deadline Enforcement\n * \n * Feature: destination-wedding-platform\n * Property 8: RSVP Deadline Enforcement\n * \n * Validates: Requirements 10.5\n * \n * Property: RSVPs cannot be submitted or updated after the deadline has passed.\n * The system must enforce deadline constraints and display appropriate error messages.\n */\n\nimport * as fc from 'fast-check';\nimport { render, screen, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { RSVPForm } from '@/components/guest/RSVPForm';\n\ndescribe('Feature: destination-wedding-platform, Property 8: RSVP Deadline Enforcement', () => {\n  // Arbitrary for generating dates relative to now\n  const pastDateArbitrary = fc.integer({ min: 1, max: 365 }).map(daysAgo => {\n    const date = new Date();\n    date.setDate(date.getDate() - daysAgo);\n    return date.toISOString();\n  });\n\n  const futureDateArbitrary = fc.integer({ min: 1, max: 365 }).map(daysAhead => {\n    const date = new Date();\n    date.setDate(date.getDate() + daysAhead);\n    return date.toISOString();\n  });\n\n  const rsvpStatusArbitrary = fc.constantFrom('attending', 'declined', 'maybe');\n\n  it('should prevent RSVP submission when deadline has passed', () => {\n    fc.assert(\n      fc.property(\n        pastDateArbitrary,\n        rsvpStatusArbitrary,\n        (deadline, status) => {\n          const mockOnSuccess = jest.fn();\n          const mockOnCancel = jest.fn();\n\n          const { container } = render(\n            <RSVPForm\n              activityId=\"test-activity\"\n              activityDetails={{\n                name: 'Test Activity',\n                capacity: 50,\n                capacityRemaining: 25,\n                rsvpDeadline: deadline,\n                allowsPlusOnes: true,\n                isMeal: false,\n              }}\n              onSuccess={mockOnSuccess}\n              onCancel={mockOnCancel}\n            />\n          );\n\n          // Should display deadline warning\n          const warningText = screen.getByText(/deadline.*passed/i);\n          expect(warningText).toBeInTheDocument();\n\n          // Submit button should be disabled\n          const submitButton = screen.getByRole('button', { name: /submit rsvp/i });\n          expect(submitButton).toBeDisabled();\n\n          // Status buttons should be disabled\n          const statusButtons = container.querySelectorAll('button[type=\"button\"]');\n          statusButtons.forEach(button => {\n            if (button.textContent?.match(/attending|maybe|declined/i)) {\n              expect(button).toBeDisabled();\n            }\n          });\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should allow RSVP submission when deadline is in the future', () => {\n    fc.assert(\n      fc.property(\n        futureDateArbitrary,\n        rsvpStatusArbitrary,\n        (deadline, status) => {\n          const mockOnSuccess = jest.fn();\n          const mockOnCancel = jest.fn();\n\n          const { container } = render(\n            <RSVPForm\n              activityId=\"test-activity\"\n              activityDetails={{\n                name: 'Test Activity',\n                capacity: 50,\n                capacityRemaining: 25,\n                rsvpDeadline: deadline,\n                allowsPlusOnes: true,\n                isMeal: false,\n              }}\n              onSuccess={mockOnSuccess}\n              onCancel={mockOnCancel}\n            />\n          );\n\n          // Should NOT display deadline warning\n          const warningText = screen.queryByText(/deadline.*passed/i);\n          expect(warningText).not.toBeInTheDocument();\n\n          // Submit button should NOT be disabled (unless other validation fails)\n          const submitButton = screen.getByRole('button', { name: /submit rsvp/i });\n          expect(submitButton).not.toBeDisabled();\n\n          // Status buttons should NOT be disabled\n          const statusButtons = container.querySelectorAll('button[type=\"button\"]');\n          statusButtons.forEach(button => {\n            if (button.textContent?.match(/attending|maybe|declined/i)) {\n              expect(button).not.toBeDisabled();\n            }\n          });\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should display error message when attempting to submit after deadline', async () => {\n    fc.assert(\n      fc.asyncProperty(\n        pastDateArbitrary,\n        async (deadline) => {\n          const mockOnSuccess = jest.fn();\n          const mockOnCancel = jest.fn();\n\n          render(\n            <RSVPForm\n              activityId=\"test-activity\"\n              activityDetails={{\n                name: 'Test Activity',\n                capacity: 50,\n                capacityRemaining: 25,\n                rsvpDeadline: deadline,\n                allowsPlusOnes: true,\n                isMeal: false,\n              }}\n              onSuccess={mockOnSuccess}\n              onCancel={mockOnCancel}\n            />\n          );\n\n          // Error message should be visible\n          await waitFor(() => {\n            const errorMessage = screen.getByText(/deadline.*passed.*no longer submit/i);\n            expect(errorMessage).toBeInTheDocument();\n          });\n\n          // onSuccess should never be called\n          expect(mockOnSuccess).not.toHaveBeenCalled();\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle edge case: deadline exactly at current time', () => {\n    const now = new Date().toISOString();\n    const mockOnSuccess = jest.fn();\n    const mockOnCancel = jest.fn();\n\n    render(\n      <RSVPForm\n        activityId=\"test-activity\"\n        activityDetails={{\n          name: 'Test Activity',\n          capacity: 50,\n          capacityRemaining: 25,\n          rsvpDeadline: now,\n          allowsPlusOnes: true,\n          isMeal: false,\n        }}\n        onSuccess={mockOnSuccess}\n        onCancel={mockOnCancel}\n      />\n    );\n\n    // Should treat as passed (deadline is not in the future)\n    const warningText = screen.queryByText(/deadline.*passed/i);\n    expect(warningText).toBeInTheDocument();\n\n    const submitButton = screen.getByRole('button', { name: /submit rsvp/i });\n    expect(submitButton).toBeDisabled();\n  });\n\n  it('should allow RSVP when no deadline is set', () => {\n    fc.assert(\n      fc.property(\n        rsvpStatusArbitrary,\n        (status) => {\n          const mockOnSuccess = jest.fn();\n          const mockOnCancel = jest.fn();\n\n          render(\n            <RSVPForm\n              activityId=\"test-activity\"\n              activityDetails={{\n                name: 'Test Activity',\n                capacity: 50,\n                capacityRemaining: 25,\n                rsvpDeadline: null,\n                allowsPlusOnes: true,\n                isMeal: false,\n              }}\n              onSuccess={mockOnSuccess}\n              onCancel={mockOnCancel}\n            />\n          );\n\n          // Should NOT display deadline warning\n          const warningText = screen.queryByText(/deadline.*passed/i);\n          expect(warningText).not.toBeInTheDocument();\n\n          // Submit button should NOT be disabled\n          const submitButton = screen.getByRole('button', { name: /submit rsvp/i });\n          expect(submitButton).not.toBeDisabled();\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["describe","pastDateArbitrary","fc","integer","min","max","map","daysAgo","date","Date","setDate","getDate","toISOString","futureDateArbitrary","daysAhead","rsvpStatusArbitrary","constantFrom","it","assert","property","deadline","status","mockOnSuccess","jest","fn","mockOnCancel","container","render","RSVPForm","activityId","activityDetails","name","capacity","capacityRemaining","rsvpDeadline","allowsPlusOnes","isMeal","onSuccess","onCancel","warningText","screen","getByText","expect","toBeInTheDocument","submitButton","getByRole","toBeDisabled","statusButtons","querySelectorAll","forEach","button","textContent","match","numRuns","queryByText","not","asyncProperty","waitFor","errorMessage","toHaveBeenCalled","now"],"mappings":"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"}