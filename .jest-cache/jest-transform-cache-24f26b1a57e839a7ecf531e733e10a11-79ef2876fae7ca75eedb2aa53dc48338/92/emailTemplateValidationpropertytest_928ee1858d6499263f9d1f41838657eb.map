{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/emailTemplateValidation.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { createTemplate } from './emailService';\nimport type { CreateEmailTemplateDTO } from '@/schemas/emailSchemas';\n\n/**\n * Property-Based Test for Email Template Validation\n * Feature: destination-wedding-platform, Property 17: Email Template Validation\n * \n * Property: For any email template with invalid syntax (unclosed tags, malformed HTML) \n * or undefined variable references (variables not in the allowed list), the validation \n * function should reject the template and return specific errors.\n * \n * Validates: Requirements 13.8\n */\n\n// Mock Supabase client\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(() => ({\n    from: jest.fn(() => ({\n      insert: jest.fn((data) => ({\n        select: jest.fn(() => ({\n          single: jest.fn(() => Promise.resolve({ \n            data: { \n              id: 'test-id', \n              ...data,\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString()\n            }, \n            error: null \n          })),\n        })),\n      })),\n    })),\n  })),\n}));\n\n// Mock Resend\njest.mock('resend', () => ({\n  Resend: jest.fn(() => ({})),\n}));\n\ndescribe('Feature: destination-wedding-platform, Property 17: Email Template Validation', () => {\n  // Arbitrary for valid template data\n  const validTemplateArbitrary = fc.record({\n    name: fc.string({ minLength: 1, maxLength: 100 }).filter(s => s.trim().length > 0),\n    subject: fc.string({ minLength: 1, maxLength: 200 }).filter(s => s.trim().length > 0),\n    body_html: fc.string({ minLength: 1, maxLength: 500 }).filter(s => s.trim().length > 0),\n    body_text: fc.string({ minLength: 1, maxLength: 500 }).filter(s => s.trim().length > 0),\n    variables: fc.array(\n      fc.string({ minLength: 1, maxLength: 20 })\n        .filter(s => /^[a-zA-Z_][a-zA-Z0-9_]*$/.test(s)), // Valid variable names only\n      { maxLength: 10 }\n    ),\n  });\n\n  // Arbitrary for templates with undefined variables\n  const undefinedVariableArbitrary = fc.record({\n    name: fc.string({ minLength: 1, maxLength: 100 }),\n    subject: fc.string({ minLength: 1, maxLength: 200 }),\n    body_html: fc.constantFrom(\n      'Hello {{undefined_var}}',\n      'Welcome {{missing_var}} to our wedding',\n      'RSVP by {{unknown_date}}',\n      '{{bad_var}} is not defined'\n    ),\n    body_text: fc.string({ minLength: 1, maxLength: 500 }),\n    variables: fc.constant(['guest_name', 'event_name']), // Defined variables\n  });\n\n  // Arbitrary for templates with malformed HTML\n  const malformedHTMLArbitrary = fc.record({\n    name: fc.string({ minLength: 1, maxLength: 100 }).filter(s => s.trim().length > 0),\n    subject: fc.string({ minLength: 1, maxLength: 200 }).filter(s => s.trim().length > 0),\n    body_html: fc.constantFrom(\n      '<p>Unclosed paragraph',\n      '<div><span>Unclosed span</div>',\n      '<strong>Bold <em>italic</strong></em>',\n      '<a href=\"test\">Link without closing',\n      '<script>alert(\"xss\")</script>', // Should be sanitized\n    ),\n    body_text: fc.string({ minLength: 1, maxLength: 500 }).filter(s => s.trim().length > 0),\n    variables: fc.array(\n      fc.string({ minLength: 1, maxLength: 20 })\n        .filter(s => /^[a-zA-Z_][a-zA-Z0-9_]*$/.test(s)),\n      { maxLength: 5 }\n    ),\n  });\n\n  it('should reject templates with undefined variable references', async () => {\n    await fc.assert(\n      fc.asyncProperty(undefinedVariableArbitrary, async (templateData) => {\n        const result = await createTemplate(templateData);\n\n        // Should fail validation\n        expect(result.success).toBe(false);\n        \n        if (!result.success) {\n          // Should return VALIDATION_ERROR\n          expect(result.error.code).toBe('VALIDATION_ERROR');\n          \n          // Should mention undefined variables\n          expect(\n            result.error.message.toLowerCase().includes('undefined') ||\n            result.error.message.toLowerCase().includes('variable')\n          ).toBe(true);\n          \n          // Should provide details about which variables are undefined\n          expect(result.error.details).toBeDefined();\n        }\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should accept templates with all variables properly defined', async () => {\n    await fc.assert(\n      fc.asyncProperty(validTemplateArbitrary, async (templateData) => {\n        // Create template with variables that are all used in the body\n        const variables = templateData.variables;\n        const body_html = `<p>Hello {{${variables[0] || 'guest_name'}}}</p>`;\n        const body_text = `Hello {{${variables[0] || 'guest_name'}}}`;\n\n        const result = await createTemplate({\n          ...templateData,\n          body_html,\n          body_text,\n          variables: variables.length > 0 ? variables : ['guest_name'],\n        });\n\n        // Should succeed\n        expect(result.success).toBe(true);\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should sanitize malformed HTML but still accept template', async () => {\n    await fc.assert(\n      fc.asyncProperty(malformedHTMLArbitrary, async (templateData) => {\n        const result = await createTemplate(templateData);\n\n        // Malformed HTML should be sanitized, not rejected\n        // (DOMPurify will clean it up)\n        expect(result.success).toBe(true);\n        \n        if (result.success) {\n          // Script tags should be removed\n          expect(result.data.body_html).not.toContain('<script>');\n          expect(result.data.body_html).not.toContain('alert');\n        }\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should reject templates with variables in body but not in variables array', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.constant('<p>Hello {{guest_name}}, welcome to {{event_name}}</p>'),\n          body_text: fc.constant('Hello {{guest_name}}, welcome to {{event_name}}'),\n          variables: fc.constant(['guest_name']), // Missing event_name\n        }),\n        async (templateData) => {\n          const result = await createTemplate(templateData);\n\n          // Should fail because event_name is not in variables array\n          expect(result.success).toBe(false);\n          \n          if (!result.success) {\n            expect(result.error.code).toBe('VALIDATION_ERROR');\n            expect(result.error.details).toBeDefined();\n            \n            // Should identify event_name as undefined\n            const details = result.error.details as any;\n            if (details.undefinedVariables) {\n              expect(details.undefinedVariables).toContain('event_name');\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should validate both HTML and text bodies for undefined variables', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.constant('<p>Hello {{guest_name}}</p>'),\n          body_text: fc.constant('Hello {{undefined_var}}'), // Undefined in text\n          variables: fc.constant(['guest_name']),\n        }),\n        async (templateData) => {\n          const result = await createTemplate(templateData);\n\n          // Should fail because text body has undefined variable\n          expect(result.success).toBe(false);\n          \n          if (!result.success) {\n            expect(result.error.code).toBe('VALIDATION_ERROR');\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle templates with no variables', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          subject: fc.string({ minLength: 1, maxLength: 200 }),\n          body_html: fc.string({ minLength: 1, maxLength: 500 }).filter(s => !s.includes('{{')),\n          body_text: fc.string({ minLength: 1, maxLength: 500 }).filter(s => !s.includes('{{')),\n          variables: fc.constant([]),\n        }),\n        async (templateData) => {\n          const result = await createTemplate(templateData);\n\n          // Should succeed - no variables to validate\n          expect(result.success).toBe(true);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should reject templates with missing required fields', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.oneof(\n          fc.record({\n            name: fc.constant(''),\n            subject: fc.string({ minLength: 1, maxLength: 200 }),\n            body_html: fc.string({ minLength: 1, maxLength: 500 }),\n            body_text: fc.string({ minLength: 1, maxLength: 500 }),\n            variables: fc.array(fc.string()),\n          }),\n          fc.record({\n            name: fc.string({ minLength: 1, maxLength: 100 }),\n            subject: fc.constant(''),\n            body_html: fc.string({ minLength: 1, maxLength: 500 }),\n            body_text: fc.string({ minLength: 1, maxLength: 500 }),\n            variables: fc.array(fc.string()),\n          }),\n          fc.record({\n            name: fc.string({ minLength: 1, maxLength: 100 }),\n            subject: fc.string({ minLength: 1, maxLength: 200 }),\n            body_html: fc.constant(''),\n            body_text: fc.string({ minLength: 1, maxLength: 500 }),\n            variables: fc.array(fc.string()),\n          })\n        ),\n        async (templateData) => {\n          const result = await createTemplate(templateData as CreateEmailTemplateDTO);\n\n          // Should fail validation for missing required fields\n          expect(result.success).toBe(false);\n          \n          if (!result.success) {\n            expect(result.error.code).toBe('VALIDATION_ERROR');\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["jest","mock","createClient","fn","from","insert","data","select","single","Promise","resolve","id","created_at","Date","toISOString","updated_at","error","Resend","describe","validTemplateArbitrary","fc","record","name","string","minLength","maxLength","filter","s","trim","length","subject","body_html","body_text","variables","array","test","undefinedVariableArbitrary","constantFrom","constant","malformedHTMLArbitrary","it","assert","asyncProperty","templateData","result","createTemplate","expect","success","toBe","code","message","toLowerCase","includes","details","toBeDefined","numRuns","not","toContain","undefinedVariables","oneof"],"mappings":"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"}