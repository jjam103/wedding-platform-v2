{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/capacityAlertGeneration.property.test.ts"],"sourcesContent":["/**\n * Property-Based Test: Capacity Alert Generation\n * Feature: destination-wedding-platform, Property 11: Capacity Alert Generation\n * Validates: Requirements 7.7\n * \n * Property: For any activity with a defined capacity, when the number of attending RSVPs \n * reaches or exceeds the capacity threshold (e.g., 90%), the system should generate an \n * alert for hosts.\n */\n\nimport * as fc from 'fast-check';\n\n// Create mock Supabase client that will be populated in tests\nlet mockSupabaseFrom: jest.Mock;\n\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(() => ({\n    from: (...args: any[]) => mockSupabaseFrom(...args),\n  })),\n}));\n\n// NOW import the service after mocking\nimport * as rsvpService from './rsvpService';\n\ndescribe('Feature: destination-wedding-platform, Property 11: Capacity Alert Generation', () => {\n  beforeEach(() => {\n    mockSupabaseFrom = jest.fn();\n  });\n\n  /**\n   * Helper to setup mocks for generateCapacityAlerts\n   * This function handles the complex nested query structure\n   */\n  function setupMocksForCapacityAlerts(activities: any[], rsvpsByActivity: Map<string, any[]>) {\n    mockSupabaseFrom.mockImplementation((table: string) => {\n      if (table === 'activities') {\n        return {\n          select: jest.fn().mockImplementation((columns: string) => {\n            // Check if this is the query for all activities with capacity (from generateCapacityAlerts)\n            if (columns === 'id, name, capacity') {\n              return {\n                not: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({\n                    data: activities,\n                    error: null,\n                  }),\n                }),\n              };\n            }\n            \n            // This is the query for a single activity (from calculateActivityCapacity)\n            if (columns === 'capacity, name') {\n              return {\n                eq: jest.fn().mockImplementation((field: string, activityId: string) => {\n                  return {\n                    single: jest.fn().mockImplementation(() => {\n                      // Find the activity with this ID\n                      const activity = activities.find(a => a.id === activityId);\n                      \n                      return Promise.resolve({\n                        data: activity || null,\n                        error: activity ? null : { code: 'PGRST116', message: 'Not found' },\n                      });\n                    }),\n                  };\n                }),\n              };\n            }\n            \n            return {\n              eq: jest.fn().mockResolvedValue({\n                data: [],\n                error: null,\n              }),\n            };\n          }),\n        };\n      }\n      \n      if (table === 'rsvps') {\n        // This handles the RSVP count queries\n        return {\n          select: jest.fn().mockImplementation((columns: string) => {\n            if (columns === 'guest_count') {\n              // Return a chainable object for the RSVP count query\n              return {\n                eq: jest.fn().mockImplementation((field: string, value: string) => {\n                  if (field === 'activity_id') {\n                    const activityId = value;\n                    return {\n                      eq: jest.fn().mockResolvedValue({\n                        data: rsvpsByActivity.get(activityId) || [],\n                        error: null,\n                      }),\n                    };\n                  }\n                  if (field === 'status') {\n                    // This is the second .eq() call for status = 'attending'\n                    // We need to return the data that was set up for this activity\n                    return Promise.resolve({\n                      data: [], // This will be overridden by the proper mock chain\n                      error: null,\n                    });\n                  }\n                  return {\n                    eq: jest.fn().mockResolvedValue({\n                      data: [],\n                      error: null,\n                    }),\n                  };\n                }),\n              };\n            }\n            \n            return {\n              eq: jest.fn().mockResolvedValue({\n                data: [],\n                error: null,\n              }),\n            };\n          }),\n        };\n      }\n      \n      return {\n        select: jest.fn().mockResolvedValue({\n          data: [],\n          error: null,\n        }),\n      };\n    });\n  }\n\n  it('should generate alerts when activity capacity reaches or exceeds threshold', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Generate activity with capacity\n        fc.record({\n          id: fc.uuid(),\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          capacity: fc.integer({ min: 10, max: 100 }),\n        }),\n        // Generate attending count as percentage of capacity\n        fc.double({ min: 0.85, max: 1.2 }), // 85% to 120% of capacity\n        async (activity, utilizationFactor) => {\n          const attendingCount = Math.floor(activity.capacity * utilizationFactor);\n          // Calculate ACTUAL utilization based on the floored attending count\n          const actualUtilization = attendingCount / activity.capacity;\n\n          // Setup mocks for this test case\n          const rsvpsByActivity = new Map();\n          rsvpsByActivity.set(activity.id, Array.from({ length: attendingCount }, () => ({\n            guest_count: 1,\n          })));\n\n          setupMocksForCapacityAlerts([activity], rsvpsByActivity);\n\n          // Test with 90% threshold\n          const result = await rsvpService.generateCapacityAlerts(0.9);\n\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            // If ACTUAL utilization >= 90%, should generate alert\n            if (actualUtilization >= 0.9) {\n              expect(result.data.length).toBeGreaterThan(0);\n              const alert = result.data.find(a => a.activity_id === activity.id);\n              expect(alert).toBeDefined();\n\n              if (alert) {\n                expect(alert.capacity).toBe(activity.capacity);\n                expect(alert.attending_count).toBe(attendingCount);\n                expect(alert.utilization_percentage).toBeGreaterThanOrEqual(90);\n\n                // Check alert level\n                if (attendingCount >= activity.capacity) {\n                  expect(alert.alert_level).toBe('full');\n                } else if (actualUtilization >= 0.95) {\n                  expect(alert.alert_level).toBe('critical');\n                } else {\n                  expect(alert.alert_level).toBe('warning');\n                }\n\n                // Check message contains activity name and counts\n                expect(alert.message).toContain(activity.name);\n                expect(alert.message).toContain(attendingCount.toString());\n                expect(alert.message).toContain(activity.capacity.toString());\n              }\n            } else {\n              // If ACTUAL utilization < 90%, should not generate alert for this activity\n              const alert = result.data.find(a => a.activity_id === activity.id);\n              expect(alert).toBeUndefined();\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should not generate alerts for activities without capacity limits', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          id: fc.uuid(),\n          name: fc.string({ minLength: 1, maxLength: 100 }),\n          capacity: fc.constant(null), // No capacity limit\n        }),\n        fc.integer({ min: 0, max: 1000 }), // Any number of attendees\n        async (activity, attendingCount) => {\n          // Setup mocks - no activities with capacity limits\n          setupMocksForCapacityAlerts([], new Map());\n\n          const result = await rsvpService.generateCapacityAlerts(0.9);\n\n          expect(result.success).toBe(true);\n          if (result.success) {\n            // Should not generate alerts for activities without capacity\n            expect(result.data.length).toBe(0);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should correctly calculate utilization percentage', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.integer({ min: 10, max: 100 }), // capacity\n        fc.double({ min: 0.9, max: 1.0 }), // utilization factor (90-100%)\n        async (capacity, utilizationFactor) => {\n          const attendingCount = Math.floor(capacity * utilizationFactor);\n          const expectedUtilization = Math.round((attendingCount / capacity) * 100);\n\n          const activity = {\n            id: 'test-activity-id',\n            name: 'Test Activity',\n            capacity,\n          };\n\n          // Setup mocks\n          const rsvpsByActivity = new Map();\n          rsvpsByActivity.set(activity.id, Array.from({ length: attendingCount }, () => ({\n            guest_count: 1,\n          })));\n\n          setupMocksForCapacityAlerts([activity], rsvpsByActivity);\n\n          const result = await rsvpService.generateCapacityAlerts(0.9);\n\n          expect(result.success).toBe(true);\n          if (result.success && result.data.length > 0) {\n            const alert = result.data[0];\n            expect(alert.utilization_percentage).toBe(expectedUtilization);\n            expect(alert.utilization_percentage).toBeGreaterThanOrEqual(90);\n            expect(alert.utilization_percentage).toBeLessThanOrEqual(100);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should generate different alert levels based on utilization', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.integer({ min: 50, max: 100 }), // capacity\n        fc.constantFrom(\n          { factor: 0.92, expectedLevel: 'warning' },\n          { factor: 0.96, expectedLevel: 'critical' },\n          { factor: 1.0, expectedLevel: 'full' },\n          { factor: 1.05, expectedLevel: 'full' }\n        ),\n        async (capacity, { factor, expectedLevel }) => {\n          const attendingCount = Math.floor(capacity * factor);\n          const actualUtilization = attendingCount / capacity;\n\n          const activity = {\n            id: 'test-activity-id',\n            name: 'Test Activity',\n            capacity,\n          };\n\n          // Setup mocks\n          const rsvpsByActivity = new Map();\n          rsvpsByActivity.set(activity.id, Array.from({ length: attendingCount }, () => ({\n            guest_count: 1,\n          })));\n\n          setupMocksForCapacityAlerts([activity], rsvpsByActivity);\n\n          const result = await rsvpService.generateCapacityAlerts(0.9);\n\n          expect(result.success).toBe(true);\n          if (result.success && result.data.length > 0) {\n            const alert = result.data[0];\n            \n            // Determine expected level based on ACTUAL utilization after flooring\n            let correctExpectedLevel: 'warning' | 'critical' | 'full';\n            if (attendingCount >= capacity) {\n              correctExpectedLevel = 'full';\n            } else if (actualUtilization >= 0.95) {\n              correctExpectedLevel = 'critical';\n            } else {\n              correctExpectedLevel = 'warning';\n            }\n            \n            expect(alert.alert_level).toBe(correctExpectedLevel);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["jest","mock","createClient","fn","from","args","mockSupabaseFrom","describe","beforeEach","setupMocksForCapacityAlerts","activities","rsvpsByActivity","mockImplementation","table","select","columns","not","mockReturnValue","eq","mockResolvedValue","data","error","field","activityId","single","activity","find","a","id","Promise","resolve","code","message","value","get","it","fc","assert","asyncProperty","record","uuid","name","string","minLength","maxLength","capacity","integer","min","max","double","utilizationFactor","attendingCount","Math","floor","actualUtilization","Map","set","Array","length","guest_count","result","rsvpService","generateCapacityAlerts","expect","success","toBe","toBeGreaterThan","alert","activity_id","toBeDefined","attending_count","utilization_percentage","toBeGreaterThanOrEqual","alert_level","toContain","toString","toBeUndefined","numRuns","constant","expectedUtilization","round","toBeLessThanOrEqual","constantFrom","factor","expectedLevel","correctExpectedLevel"],"mappings":"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"}