{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/adminUsersApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: Admin Users API\n * \n * Tests all CRUD endpoints, permissions, and audit logging\n */\n\nimport { createTestSupabaseClient } from '../helpers/testDb';\nimport type { SupabaseClient } from '@supabase/supabase-js';\n\ndescribe('Admin Users API Integration Tests', () => {\n  let supabase: SupabaseClient;\n  let ownerUserId: string;\n  let ownerSession: string;\n  let adminUserId: string;\n  let adminSession: string;\n\n  beforeAll(async () => {\n    supabase = createTestSupabaseClient();\n\n    // Create owner user\n    const { data: ownerAuth, error: ownerAuthError } = await supabase.auth.admin.createUser({\n      email: 'test-owner@example.com',\n      password: 'test-password-123',\n      email_confirm: true,\n    });\n\n    if (ownerAuthError || !ownerAuth.user) {\n      throw new Error('Failed to create owner user');\n    }\n\n    ownerUserId = ownerAuth.user.id;\n\n    // Create owner admin user record\n    await supabase.from('admin_users').insert({\n      id: ownerUserId,\n      email: 'test-owner@example.com',\n      role: 'owner',\n      status: 'active',\n    });\n\n    // Get owner session\n    const { data: ownerSessionData } = await supabase.auth.signInWithPassword({\n      email: 'test-owner@example.com',\n      password: 'test-password-123',\n    });\n    ownerSession = ownerSessionData.session!.access_token;\n\n    // Create admin user\n    const { data: adminAuth, error: adminAuthError } = await supabase.auth.admin.createUser({\n      email: 'test-admin@example.com',\n      password: 'test-password-123',\n      email_confirm: true,\n    });\n\n    if (adminAuthError || !adminAuth.user) {\n      throw new Error('Failed to create admin user');\n    }\n\n    adminUserId = adminAuth.user.id;\n\n    // Create admin user record\n    await supabase.from('admin_users').insert({\n      id: adminUserId,\n      email: 'test-admin@example.com',\n      role: 'admin',\n      status: 'active',\n      invited_by: ownerUserId,\n    });\n\n    // Get admin session\n    const { data: adminSessionData } = await supabase.auth.signInWithPassword({\n      email: 'test-admin@example.com',\n      password: 'test-password-123',\n    });\n    adminSession = adminSessionData.session!.access_token;\n  });\n\n  afterAll(async () => {\n    // Cleanup\n    await supabase.from('admin_users').delete().in('id', [ownerUserId, adminUserId]);\n    await supabase.auth.admin.deleteUser(ownerUserId);\n    await supabase.auth.admin.deleteUser(adminUserId);\n  });\n\n  afterEach(async () => {\n    // Clean up test admin users (except owner and admin)\n    await supabase\n      .from('admin_users')\n      .delete()\n      .not('id', 'in', `(${ownerUserId},${adminUserId})`);\n  });\n\n  describe('GET /api/admin/admin-users', () => {\n    it('should return list of admin users when authenticated as owner', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        headers: {\n          Authorization: `Bearer ${ownerSession}`,\n        },\n      });\n\n      expect(response.status).toBe(200);\n\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(Array.isArray(data.data)).toBe(true);\n      expect(data.data.length).toBeGreaterThanOrEqual(2);\n      \n      // Verify owner is in list\n      const owner = data.data.find((u: any) => u.id === ownerUserId);\n      expect(owner).toBeDefined();\n      expect(owner.email).toBe('test-owner@example.com');\n      expect(owner.role).toBe('owner');\n    });\n\n    it('should return list of admin users when authenticated as admin', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        headers: {\n          Authorization: `Bearer ${adminSession}`,\n        },\n      });\n\n      expect(response.status).toBe(200);\n\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(Array.isArray(data.data)).toBe(true);\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users');\n\n      expect(response.status).toBe(401);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 403 when authenticated as inactive admin', async () => {\n      // Deactivate admin user\n      await supabase\n        .from('admin_users')\n        .update({ status: 'inactive' })\n        .eq('id', adminUserId);\n\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        headers: {\n          Authorization: `Bearer ${adminSession}`,\n        },\n      });\n\n      expect(response.status).toBe(403);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('FORBIDDEN');\n\n      // Reactivate for other tests\n      await supabase\n        .from('admin_users')\n        .update({ status: 'active' })\n        .eq('id', adminUserId);\n    });\n  });\n\n  describe('POST /api/admin/admin-users', () => {\n    it('should create admin user when authenticated as owner with valid data', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'newadmin@example.com',\n          role: 'admin',\n        }),\n      });\n\n      expect(response.status).toBe(201);\n\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(data.data.email).toBe('newadmin@example.com');\n      expect(data.data.role).toBe('admin');\n      expect(data.data.status).toBe('active');\n      expect(data.data.invited_by).toBe(ownerUserId);\n\n      // Verify audit log created\n      const { data: auditLogs } = await supabase\n        .from('audit_logs')\n        .select('*')\n        .eq('action', 'admin_user_created')\n        .eq('entity_id', data.data.id);\n\n      expect(auditLogs).toHaveLength(1);\n      expect(auditLogs![0].user_id).toBe(ownerUserId);\n    });\n\n    it('should return 400 when email is invalid', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'invalid-email',\n          role: 'admin',\n        }),\n      });\n\n      expect(response.status).toBe(400);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 400 when role is invalid', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          role: 'superadmin',\n        }),\n      });\n\n      expect(response.status).toBe(400);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 409 when email already exists', async () => {\n      // Create first admin\n      await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'duplicate@example.com',\n          role: 'admin',\n        }),\n      });\n\n      // Try to create duplicate\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'duplicate@example.com',\n          role: 'admin',\n        }),\n      });\n\n      expect(response.status).toBe(409);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('CONFLICT');\n    });\n\n    it('should return 403 when authenticated as admin (not owner)', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${adminSession}`,\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      expect(response.status).toBe(403);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('FORBIDDEN');\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          role: 'admin',\n        }),\n      });\n\n      expect(response.status).toBe(401);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n  });\n\n  describe('PUT /api/admin/admin-users/[id]', () => {\n    let testAdminId: string;\n\n    beforeEach(async () => {\n      // Create test admin user\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'testupdate@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const data = await response.json();\n      testAdminId = data.data.id;\n    });\n\n    it('should update admin user role when authenticated as owner', async () => {\n      const response = await fetch(`http://localhost:3000/api/admin/admin-users/${testAdminId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          role: 'owner',\n        }),\n      });\n\n      expect(response.status).toBe(200);\n\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(data.data.role).toBe('owner');\n\n      // Verify audit log created\n      const { data: auditLogs } = await supabase\n        .from('audit_logs')\n        .select('*')\n        .eq('action', 'admin_user_updated')\n        .eq('entity_id', testAdminId);\n\n      expect(auditLogs!.length).toBeGreaterThan(0);\n    });\n\n    it('should return 403 when authenticated as admin (not owner)', async () => {\n      const response = await fetch(`http://localhost:3000/api/admin/admin-users/${testAdminId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${adminSession}`,\n        },\n        body: JSON.stringify({\n          role: 'owner',\n        }),\n      });\n\n      expect(response.status).toBe(403);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('FORBIDDEN');\n    });\n\n    it('should return 404 when admin user not found', async () => {\n      const response = await fetch(\n        'http://localhost:3000/api/admin/admin-users/00000000-0000-0000-0000-000000000000',\n        {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${ownerSession}`,\n          },\n          body: JSON.stringify({\n            role: 'admin',\n          }),\n        }\n      );\n\n      expect(response.status).toBe(404);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n  });\n\n  describe('POST /api/admin/admin-users/[id]/deactivate', () => {\n    let testAdminId: string;\n\n    beforeEach(async () => {\n      // Create test admin user\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'testdeactivate@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const data = await response.json();\n      testAdminId = data.data.id;\n    });\n\n    it('should deactivate admin user when authenticated as owner', async () => {\n      const response = await fetch(\n        `http://localhost:3000/api/admin/admin-users/${testAdminId}/deactivate`,\n        {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${ownerSession}`,\n          },\n        }\n      );\n\n      expect(response.status).toBe(200);\n\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(data.data.status).toBe('inactive');\n\n      // Verify audit log created\n      const { data: auditLogs } = await supabase\n        .from('audit_logs')\n        .select('*')\n        .eq('action', 'admin_user_deactivated')\n        .eq('entity_id', testAdminId);\n\n      expect(auditLogs!.length).toBeGreaterThan(0);\n    });\n\n    it('should return 403 when trying to deactivate last owner', async () => {\n      const response = await fetch(\n        `http://localhost:3000/api/admin/admin-users/${ownerUserId}/deactivate`,\n        {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${ownerSession}`,\n          },\n        }\n      );\n\n      expect(response.status).toBe(403);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('FORBIDDEN');\n      expect(data.error.message).toContain('last owner');\n    });\n\n    it('should return 403 when authenticated as admin (not owner)', async () => {\n      const response = await fetch(\n        `http://localhost:3000/api/admin/admin-users/${testAdminId}/deactivate`,\n        {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${adminSession}`,\n          },\n        }\n      );\n\n      expect(response.status).toBe(403);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('FORBIDDEN');\n    });\n  });\n\n  describe('DELETE /api/admin/admin-users/[id]', () => {\n    let testAdminId: string;\n\n    beforeEach(async () => {\n      // Create test admin user\n      const response = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'testdelete@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const data = await response.json();\n      testAdminId = data.data.id;\n    });\n\n    it('should delete admin user when authenticated as owner', async () => {\n      const response = await fetch(`http://localhost:3000/api/admin/admin-users/${testAdminId}`, {\n        method: 'DELETE',\n        headers: {\n          Authorization: `Bearer ${ownerSession}`,\n        },\n      });\n\n      expect(response.status).toBe(200);\n\n      const data = await response.json();\n      expect(data.success).toBe(true);\n\n      // Verify user deleted\n      const { data: deletedUser } = await supabase\n        .from('admin_users')\n        .select('*')\n        .eq('id', testAdminId)\n        .single();\n\n      expect(deletedUser).toBeNull();\n\n      // Verify audit log created\n      const { data: auditLogs } = await supabase\n        .from('audit_logs')\n        .select('*')\n        .eq('action', 'admin_user_deleted')\n        .eq('entity_id', testAdminId);\n\n      expect(auditLogs!.length).toBeGreaterThan(0);\n    });\n\n    it('should return 403 when trying to delete last owner', async () => {\n      const response = await fetch(`http://localhost:3000/api/admin/admin-users/${ownerUserId}`, {\n        method: 'DELETE',\n        headers: {\n          Authorization: `Bearer ${ownerSession}`,\n        },\n      });\n\n      expect(response.status).toBe(403);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('FORBIDDEN');\n      expect(data.error.message).toContain('last owner');\n    });\n\n    it('should return 403 when authenticated as admin (not owner)', async () => {\n      const response = await fetch(`http://localhost:3000/api/admin/admin-users/${testAdminId}`, {\n        method: 'DELETE',\n        headers: {\n          Authorization: `Bearer ${adminSession}`,\n        },\n      });\n\n      expect(response.status).toBe(403);\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('FORBIDDEN');\n    });\n  });\n\n  describe('Audit Logging', () => {\n    it('should log all admin user management actions', async () => {\n      // Create admin user\n      const createResponse = await fetch('http://localhost:3000/api/admin/admin-users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          email: 'auditlog@example.com',\n          role: 'admin',\n        }),\n      });\n\n      const createData = await createResponse.json();\n      const testAdminId = createData.data.id;\n\n      // Update admin user\n      await fetch(`http://localhost:3000/api/admin/admin-users/${testAdminId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${ownerSession}`,\n        },\n        body: JSON.stringify({\n          role: 'owner',\n        }),\n      });\n\n      // Deactivate admin user\n      await fetch(`http://localhost:3000/api/admin/admin-users/${testAdminId}/deactivate`, {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${ownerSession}`,\n        },\n      });\n\n      // Delete admin user\n      await fetch(`http://localhost:3000/api/admin/admin-users/${testAdminId}`, {\n        method: 'DELETE',\n        headers: {\n          Authorization: `Bearer ${ownerSession}`,\n        },\n      });\n\n      // Verify all audit logs created\n      const { data: auditLogs } = await supabase\n        .from('audit_logs')\n        .select('*')\n        .eq('entity_id', testAdminId)\n        .order('created_at', { ascending: true });\n\n      expect(auditLogs!.length).toBeGreaterThanOrEqual(4);\n\n      const actions = auditLogs!.map((log) => log.action);\n      expect(actions).toContain('admin_user_created');\n      expect(actions).toContain('admin_user_updated');\n      expect(actions).toContain('admin_user_deactivated');\n      expect(actions).toContain('admin_user_deleted');\n\n      // Verify all logs have required fields\n      auditLogs!.forEach((log) => {\n        expect(log.user_id).toBe(ownerUserId);\n        expect(log.entity_type).toBe('admin_user');\n        expect(log.entity_id).toBe(testAdminId);\n        expect(log.created_at).toBeDefined();\n      });\n    });\n  });\n});\n"],"names":["describe","supabase","ownerUserId","ownerSession","adminUserId","adminSession","beforeAll","createTestSupabaseClient","data","ownerAuth","error","ownerAuthError","auth","admin","createUser","email","password","email_confirm","user","Error","id","from","insert","role","status","ownerSessionData","signInWithPassword","session","access_token","adminAuth","adminAuthError","invited_by","adminSessionData","afterAll","delete","in","deleteUser","afterEach","not","it","response","fetch","headers","Authorization","expect","toBe","json","success","Array","isArray","length","toBeGreaterThanOrEqual","owner","find","u","toBeDefined","code","update","eq","method","body","JSON","stringify","auditLogs","select","toHaveLength","user_id","testAdminId","beforeEach","toBeGreaterThan","message","toContain","deletedUser","single","toBeNull","createResponse","createData","order","ascending","actions","map","log","action","forEach","entity_type","entity_id","created_at"],"mappings":"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"}