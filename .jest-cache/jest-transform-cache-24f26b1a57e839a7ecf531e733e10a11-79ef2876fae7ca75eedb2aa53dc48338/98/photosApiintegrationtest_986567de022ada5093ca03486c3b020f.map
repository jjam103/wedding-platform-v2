{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/photosApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Test: Photos API Routes\n * \n * Tests photo upload, moderation workflow, and gallery operations\n * for photo management API routes.\n * \n * Test Coverage:\n * - Photo upload functionality (guest upload)\n * - Photo moderation workflow (approve/reject)\n * - Gallery operations (list, get, update, delete)\n * - Authentication and authorization\n * - File validation and storage\n */\n\n// Polyfill Web APIs for Next.js server components\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder as any;\n\n// Mock Next.js server module to avoid Request/Response issues\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n}));\n\n// Mock the service layer\njest.mock('@/services/photoService', () => ({\n  listPhotos: jest.fn(),\n  getPhoto: jest.fn(),\n  updatePhoto: jest.fn(),\n  deletePhoto: jest.fn(),\n  moderatePhoto: jest.fn(),\n}));\n\n// Mock authentication\njest.mock('@/lib/supabaseServer', () => ({\n  createAuthenticatedClient: jest.fn(),\n}));\n\njest.mock('@/lib/apiAuth', () => ({\n  getAuthenticatedUser: jest.fn(),\n}));\n\n// Mock sanitization\njest.mock('@/utils/sanitization', () => ({\n  sanitizeInput: jest.fn((input) => input),\n}));\n\ndescribe('Photos API Integration Tests', () => {\n  const mockPhotoService = require('@/services/photoService');\n  const mockSupabaseServer = require('@/lib/supabaseServer');\n  const mockApiAuth = require('@/lib/apiAuth');\n\n  const mockPhoto = {\n    id: 'photo-1',\n    uploader_id: 'user-1',\n    photo_url: 'https://example.com/photo.jpg',\n    storage_type: 'supabase',\n    page_type: 'memory',\n    page_id: null,\n    caption: 'Test photo',\n    alt_text: 'A test photo',\n    moderation_status: 'pending',\n    display_order: 1,\n    created_at: '2024-01-01T00:00:00Z',\n    updated_at: '2024-01-01T00:00:00Z',\n  };\n\n  const mockSupabase = {\n    auth: {\n      getSession: jest.fn(),\n    },\n    from: jest.fn().mockReturnThis(),\n    select: jest.fn().mockReturnThis(),\n    eq: jest.fn().mockReturnThis(),\n    single: jest.fn(),\n    storage: {\n      from: jest.fn().mockReturnThis(),\n      upload: jest.fn(),\n      getPublicUrl: jest.fn(),\n      remove: jest.fn(),\n    },\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockSupabaseServer.createAuthenticatedClient.mockResolvedValue(mockSupabase);\n  });\n\n  describe('Photo Service Integration', () => {\n    it('should list photos with filters', async () => {\n      mockPhotoService.listPhotos.mockResolvedValue({\n        success: true,\n        data: {\n          photos: [mockPhoto],\n          total: 1,\n        },\n      });\n\n      const result = await mockPhotoService.listPhotos({\n        page_type: 'memory',\n        moderation_status: 'pending',\n        limit: 10,\n        offset: 0,\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.photos).toHaveLength(1);\n      expect(result.data.total).toBe(1);\n    });\n\n    it('should get single photo by ID', async () => {\n      mockPhotoService.getPhoto.mockResolvedValue({\n        success: true,\n        data: mockPhoto,\n      });\n\n      const result = await mockPhotoService.getPhoto('photo-1');\n\n      expect(result.success).toBe(true);\n      expect(result.data.id).toBe('photo-1');\n    });\n\n    it('should return NOT_FOUND when photo does not exist', async () => {\n      mockPhotoService.getPhoto.mockResolvedValue({\n        success: false,\n        error: { code: 'NOT_FOUND', message: 'Photo not found' },\n      });\n\n      const result = await mockPhotoService.getPhoto('nonexistent');\n\n      expect(result.success).toBe(false);\n      expect(result.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should update photo metadata', async () => {\n      const updatedPhoto = { ...mockPhoto, caption: 'Updated caption' };\n      mockPhotoService.updatePhoto.mockResolvedValue({\n        success: true,\n        data: updatedPhoto,\n      });\n\n      const result = await mockPhotoService.updatePhoto('photo-1', {\n        caption: 'Updated caption',\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.caption).toBe('Updated caption');\n    });\n\n    it('should delete photo', async () => {\n      mockPhotoService.deletePhoto.mockResolvedValue({\n        success: true,\n        data: undefined,\n      });\n\n      const result = await mockPhotoService.deletePhoto('photo-1');\n\n      expect(result.success).toBe(true);\n    });\n\n    it('should moderate photo with approval', async () => {\n      const approvedPhoto = { ...mockPhoto, moderation_status: 'approved' };\n      mockPhotoService.moderatePhoto.mockResolvedValue({\n        success: true,\n        data: approvedPhoto,\n      });\n\n      const result = await mockPhotoService.moderatePhoto('photo-1', {\n        moderation_status: 'approved',\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.moderation_status).toBe('approved');\n    });\n\n    it('should moderate photo with rejection and reason', async () => {\n      const rejectedPhoto = { \n        ...mockPhoto, \n        moderation_status: 'rejected',\n        moderation_reason: 'Inappropriate content'\n      };\n      mockPhotoService.moderatePhoto.mockResolvedValue({\n        success: true,\n        data: rejectedPhoto,\n      });\n\n      const result = await mockPhotoService.moderatePhoto('photo-1', {\n        moderation_status: 'rejected',\n        moderation_reason: 'Inappropriate content',\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.moderation_status).toBe('rejected');\n      expect(result.data.moderation_reason).toBe('Inappropriate content');\n    });\n\n    it('should handle database errors gracefully', async () => {\n      mockPhotoService.listPhotos.mockResolvedValue({\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: 'Connection failed' },\n      });\n\n      const result = await mockPhotoService.listPhotos({\n        limit: 10,\n        offset: 0,\n      });\n\n      expect(result.success).toBe(false);\n      expect(result.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('Photo Upload Integration', () => {\n    const mockUser = { id: 'user-1', email: 'guest@example.com' };\n    const mockGuest = { id: 'guest-1' };\n\n    beforeEach(() => {\n      mockApiAuth.getAuthenticatedUser.mockResolvedValue({\n        user: mockUser,\n        supabase: mockSupabase,\n      });\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockGuest,\n              error: null,\n            }),\n          }),\n        }),\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockPhoto,\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      mockSupabase.storage.from.mockReturnValue({\n        upload: jest.fn().mockResolvedValue({\n          data: { path: 'photos/test-photo.jpg' },\n          error: null,\n        }),\n        getPublicUrl: jest.fn().mockReturnValue({\n          data: { publicUrl: 'https://example.com/photo.jpg' },\n        }),\n        remove: jest.fn(),\n      });\n    });\n\n    it('should validate authentication for guest uploads', async () => {\n      mockApiAuth.getAuthenticatedUser.mockResolvedValue(null);\n\n      const auth = await mockApiAuth.getAuthenticatedUser();\n      expect(auth).toBeNull();\n    });\n\n    it('should validate guest exists for uploads', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Guest not found' },\n            }),\n          }),\n        }),\n      });\n\n      const auth = await mockApiAuth.getAuthenticatedUser();\n      expect(auth).toBeTruthy();\n\n      // Simulate guest lookup\n      const guestQuery = mockSupabase.from('guests').select('id').eq('email', mockUser.email).single();\n      const { data: guest, error } = await guestQuery;\n\n      expect(guest).toBeNull();\n      expect(error).toBeTruthy();\n    });\n\n    it('should handle successful photo upload workflow', async () => {\n      const auth = await mockApiAuth.getAuthenticatedUser();\n      expect(auth).toBeTruthy();\n\n      // Simulate guest lookup\n      const guestQuery = mockSupabase.from('guests').select('id').eq('email', mockUser.email).single();\n      const { data: guest } = await guestQuery;\n      expect(guest).toBeTruthy();\n\n      // Simulate storage upload\n      const storageUpload = mockSupabase.storage.from('wedding-photos').upload('photos/test.jpg', 'file-data');\n      const { data: uploadData, error: uploadError } = await storageUpload;\n      expect(uploadData).toBeTruthy();\n      expect(uploadError).toBeNull();\n\n      // Simulate URL generation\n      const urlData = mockSupabase.storage.from('wedding-photos').getPublicUrl('photos/test.jpg');\n      expect(urlData.data.publicUrl).toBeTruthy();\n\n      // Simulate database insert\n      const dbInsert = mockSupabase.from('photos').insert({}).select().single();\n      const { data: photo, error: photoError } = await dbInsert;\n      expect(photo).toBeTruthy();\n      expect(photoError).toBeNull();\n    });\n\n    it('should handle storage upload failures', async () => {\n      mockSupabase.storage.from.mockReturnValue({\n        upload: jest.fn().mockResolvedValue({\n          data: null,\n          error: { message: 'Storage upload failed' },\n        }),\n      });\n\n      const storageUpload = mockSupabase.storage.from('wedding-photos').upload('photos/test.jpg', 'file-data');\n      const { data, error } = await storageUpload;\n\n      expect(data).toBeNull();\n      expect(error).toBeTruthy();\n      expect(error.message).toBe('Storage upload failed');\n    });\n\n    it('should cleanup storage on database insert failure', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: mockGuest,\n              error: null,\n            }),\n          }),\n        }),\n        insert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Database insert failed' },\n            }),\n          }),\n        }),\n      });\n\n      // Simulate successful upload\n      const storageUpload = mockSupabase.storage.from('wedding-photos').upload('photos/test.jpg', 'file-data');\n      const { data: uploadData } = await storageUpload;\n      expect(uploadData).toBeTruthy();\n\n      // Simulate database failure\n      const dbInsert = mockSupabase.from('photos').insert({}).select().single();\n      const { data: photo, error: photoError } = await dbInsert;\n      expect(photo).toBeNull();\n      expect(photoError).toBeTruthy();\n\n      // Verify cleanup would be called\n      expect(mockSupabase.storage.from().remove).toBeDefined();\n    });\n  });\n\n  describe('Photo Moderation Workflow', () => {\n    it('should support pending to approved workflow', async () => {\n      // Start with pending photo\n      mockPhotoService.getPhoto.mockResolvedValue({\n        success: true,\n        data: { ...mockPhoto, moderation_status: 'pending' },\n      });\n\n      let photo = await mockPhotoService.getPhoto('photo-1');\n      expect(photo.data.moderation_status).toBe('pending');\n\n      // Approve photo\n      mockPhotoService.moderatePhoto.mockResolvedValue({\n        success: true,\n        data: { ...mockPhoto, moderation_status: 'approved' },\n      });\n\n      const moderationResult = await mockPhotoService.moderatePhoto('photo-1', {\n        moderation_status: 'approved',\n      });\n\n      expect(moderationResult.success).toBe(true);\n      expect(moderationResult.data.moderation_status).toBe('approved');\n    });\n\n    it('should support pending to rejected workflow', async () => {\n      // Start with pending photo\n      mockPhotoService.getPhoto.mockResolvedValue({\n        success: true,\n        data: { ...mockPhoto, moderation_status: 'pending' },\n      });\n\n      let photo = await mockPhotoService.getPhoto('photo-1');\n      expect(photo.data.moderation_status).toBe('pending');\n\n      // Reject photo with reason\n      mockPhotoService.moderatePhoto.mockResolvedValue({\n        success: true,\n        data: { \n          ...mockPhoto, \n          moderation_status: 'rejected',\n          moderation_reason: 'Does not meet content guidelines'\n        },\n      });\n\n      const moderationResult = await mockPhotoService.moderatePhoto('photo-1', {\n        moderation_status: 'rejected',\n        moderation_reason: 'Does not meet content guidelines',\n      });\n\n      expect(moderationResult.success).toBe(true);\n      expect(moderationResult.data.moderation_status).toBe('rejected');\n      expect(moderationResult.data.moderation_reason).toBe('Does not meet content guidelines');\n    });\n\n    it('should track pending photo counts', async () => {\n      mockPhotoService.listPhotos.mockResolvedValue({\n        success: true,\n        data: {\n          photos: [\n            { ...mockPhoto, id: 'photo-1', moderation_status: 'pending' },\n            { ...mockPhoto, id: 'photo-2', moderation_status: 'pending' },\n            { ...mockPhoto, id: 'photo-3', moderation_status: 'pending' },\n          ],\n          total: 3,\n        },\n      });\n\n      const result = await mockPhotoService.listPhotos({\n        moderation_status: 'pending',\n        limit: 50,\n        offset: 0,\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.total).toBe(3);\n      expect(result.data.photos.every(p => p.moderation_status === 'pending')).toBe(true);\n    });\n  });\n\n  describe('Gallery Operations', () => {\n    it('should filter photos by page type', async () => {\n      mockPhotoService.listPhotos.mockResolvedValue({\n        success: true,\n        data: {\n          photos: [\n            { ...mockPhoto, page_type: 'memory' },\n          ],\n          total: 1,\n        },\n      });\n\n      const result = await mockPhotoService.listPhotos({\n        page_type: 'memory',\n        limit: 10,\n        offset: 0,\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.photos[0].page_type).toBe('memory');\n    });\n\n    it('should filter photos by moderation status', async () => {\n      mockPhotoService.listPhotos.mockResolvedValue({\n        success: true,\n        data: {\n          photos: [\n            { ...mockPhoto, moderation_status: 'approved' },\n          ],\n          total: 1,\n        },\n      });\n\n      const result = await mockPhotoService.listPhotos({\n        moderation_status: 'approved',\n        limit: 10,\n        offset: 0,\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.photos[0].moderation_status).toBe('approved');\n    });\n\n    it('should support pagination', async () => {\n      mockPhotoService.listPhotos.mockResolvedValue({\n        success: true,\n        data: {\n          photos: [mockPhoto],\n          total: 25,\n        },\n      });\n\n      const result = await mockPhotoService.listPhotos({\n        limit: 10,\n        offset: 10, // Second page\n      });\n\n      expect(result.success).toBe(true);\n      expect(result.data.total).toBe(25);\n    });\n\n    it('should update photo metadata', async () => {\n      const updates = {\n        caption: 'Updated caption',\n        alt_text: 'Updated alt text',\n        display_order: 5,\n      };\n\n      mockPhotoService.updatePhoto.mockResolvedValue({\n        success: true,\n        data: { ...mockPhoto, ...updates },\n      });\n\n      const result = await mockPhotoService.updatePhoto('photo-1', updates);\n\n      expect(result.success).toBe(true);\n      expect(result.data.caption).toBe('Updated caption');\n      expect(result.data.alt_text).toBe('Updated alt text');\n      expect(result.data.display_order).toBe(5);\n    });\n\n    it('should delete photos', async () => {\n      mockPhotoService.deletePhoto.mockResolvedValue({\n        success: true,\n        data: undefined,\n      });\n\n      const result = await mockPhotoService.deletePhoto('photo-1');\n\n      expect(result.success).toBe(true);\n    });\n  });\n});"],"names":["jest","mock","NextResponse","json","data","init","status","listPhotos","fn","getPhoto","updatePhoto","deletePhoto","moderatePhoto","createAuthenticatedClient","getAuthenticatedUser","sanitizeInput","input","global","TextEncoder","TextDecoder","describe","mockPhotoService","require","mockSupabaseServer","mockApiAuth","mockPhoto","id","uploader_id","photo_url","storage_type","page_type","page_id","caption","alt_text","moderation_status","display_order","created_at","updated_at","mockSupabase","auth","getSession","from","mockReturnThis","select","eq","single","storage","upload","getPublicUrl","remove","beforeEach","clearAllMocks","mockResolvedValue","it","success","photos","total","result","limit","offset","expect","toBe","toHaveLength","error","code","message","updatedPhoto","undefined","approvedPhoto","rejectedPhoto","moderation_reason","mockUser","email","mockGuest","user","supabase","mockReturnValue","insert","path","publicUrl","toBeNull","toBeTruthy","guestQuery","guest","storageUpload","uploadData","uploadError","urlData","dbInsert","photo","photoError","toBeDefined","moderationResult","every","p","updates"],"mappings":"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"}