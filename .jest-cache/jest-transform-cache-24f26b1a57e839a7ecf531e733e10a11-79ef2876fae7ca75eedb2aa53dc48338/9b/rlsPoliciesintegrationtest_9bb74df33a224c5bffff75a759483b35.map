{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/rlsPolicies.integration.test.ts"],"sourcesContent":["/**\n * RLS Policies Integration Tests\n * \n * These tests validate that Row-Level Security (RLS) policies are properly enforced\n * for all database tables. Uses real authentication (not service role) to ensure\n * RLS policies work as expected.\n * \n * This catches RLS bugs that unit tests miss because unit tests often use service\n * role which bypasses RLS entirely.\n * \n * Validates: Requirements 1.2, 1.3, 1.4\n */\n\nimport { createAndSignInTestUser, deleteTestUser, createServiceClient, createTestClient, type TestUser } from '../helpers/testDb';\nimport { createTestGuestGroup, createTestGuest, createTestEvent, createTestActivity, createTestAccommodation, createTestSection, createTestContentPage } from '../helpers/factories';\nimport { cleanupByIds } from '../helpers/cleanup';\n\ndescribe('RLS Policies Integration Tests', () => {\n  let testUser: TestUser | null = null;\n  let authSetupFailed = false;\n  const createdIds: Map<string, string[]> = new Map();\n  \n  // Helper to track created entities for cleanup\n  const trackEntity = (table: string, id: string) => {\n    const ids = createdIds.get(table) || [];\n    ids.push(id);\n    createdIds.set(table, ids);\n  };\n  \n  beforeAll(async () => {\n    try {\n      testUser = await createAndSignInTestUser();\n      console.log('✅ Test user created for RLS tests');\n    } catch (error) {\n      console.warn('⚠️  Failed to create test user:', error instanceof Error ? error.message : error);\n      authSetupFailed = true;\n    }\n  }, 30000);\n  \n  afterAll(async () => {\n    // Clean up created entities\n    for (const [table, ids] of createdIds.entries()) {\n      if (ids.length > 0) {\n        await cleanupByIds(table, ids);\n      }\n    }\n    \n    // Clean up test user\n    if (testUser?.id) {\n      try {\n        await deleteTestUser(testUser.id);\n        console.log('✅ Test user cleaned up');\n      } catch (error) {\n        console.warn('⚠️  Failed to clean up test user:', error);\n      }\n    }\n  }, 10000);\n  \n  describe('guest_groups Table RLS', () => {\n    it('should allow authenticated users to read guest groups', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('guest_groups')\n        .select('*')\n        .limit(10);\n      \n      // Should not get RLS error\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n    \n    it('should allow authenticated users to create guest groups', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      const testGroup = createTestGuestGroup();\n      \n      const { data, error } = await client\n        .from('guest_groups')\n        .insert({\n          name: testGroup.name,\n          description: testGroup.description,\n        })\n        .select()\n        .single();\n      \n      // Should not get RLS error\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      \n      if (data) {\n        trackEntity('guest_groups', data.id);\n      }\n    });\n    \n    it('should prevent unauthenticated access to guest groups', async () => {\n      const client = createTestClient(); // No access token\n      \n      const { data, error } = await client\n        .from('guest_groups')\n        .select('*')\n        .limit(10);\n      \n      // Should get auth error or empty result\n      expect(data === null || (Array.isArray(data) && data.length === 0)).toBe(true);\n    });\n  });\n  \n  describe('guests Table RLS', () => {\n    it('should allow authenticated users to read guests', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('guests')\n        .select('*')\n        .limit(10);\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n    \n    it('should allow authenticated users to create guests', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      // First create a group\n      const serviceClient = createServiceClient();\n      const testGroup = createTestGuestGroup();\n      const { data: group } = await serviceClient\n        .from('guest_groups')\n        .insert({ name: testGroup.name, description: testGroup.description })\n        .select()\n        .single();\n      \n      if (!group) {\n        console.log('⏭️  Skipping: Could not create test group');\n        return;\n      }\n      \n      trackEntity('guest_groups', group.id);\n      \n      // Now create guest with authenticated client\n      const client = createTestClient(testUser.accessToken);\n      const testGuest = createTestGuest({ groupId: group.id });\n      \n      const { data, error } = await client\n        .from('guests')\n        .insert({\n          first_name: testGuest.firstName,\n          last_name: testGuest.lastName,\n          email: testGuest.email,\n          group_id: testGuest.groupId,\n          age_type: testGuest.ageType,\n          guest_type: testGuest.guestType,\n        })\n        .select()\n        .single();\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      \n      if (data) {\n        trackEntity('guests', data.id);\n      }\n    });\n  });\n  \n  describe('events Table RLS', () => {\n    it('should allow authenticated users to read events', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('events')\n        .select('*')\n        .limit(10);\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n    \n    it('should allow authenticated users to create events', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      const testEvent = createTestEvent();\n      \n      const { data, error } = await client\n        .from('events')\n        .insert({\n          name: testEvent.name,\n          description: testEvent.description,\n          start_date: testEvent.startDate,\n          end_date: testEvent.endDate,\n        })\n        .select()\n        .single();\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      \n      if (data) {\n        trackEntity('events', data.id);\n      }\n    });\n  });\n  \n  describe('activities Table RLS', () => {\n    it('should allow authenticated users to read activities', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('activities')\n        .select('*')\n        .limit(10);\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n  });\n  \n  describe('accommodations Table RLS', () => {\n    it('should allow authenticated users to read accommodations', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('accommodations')\n        .select('*')\n        .limit(10);\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n  });\n  \n  describe('sections Table RLS', () => {\n    it('should allow authenticated users to read sections', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('sections')\n        .select('*')\n        .limit(10);\n      \n      // Should not get \"permission denied for table users\" error\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n    \n    it('should allow authenticated users to create sections', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      // First create an event to attach section to\n      const serviceClient = createServiceClient();\n      const testEvent = createTestEvent();\n      const { data: event } = await serviceClient\n        .from('events')\n        .insert({\n          name: testEvent.name,\n          description: testEvent.description,\n          start_date: testEvent.startDate,\n          end_date: testEvent.endDate,\n        })\n        .select()\n        .single();\n      \n      if (!event) {\n        console.log('⏭️  Skipping: Could not create test event');\n        return;\n      }\n      \n      trackEntity('events', event.id);\n      \n      // Now create section with authenticated client\n      const client = createTestClient(testUser.accessToken);\n      const testSection = createTestSection({ entityType: 'event', entityId: event.id });\n      \n      const { data, error } = await client\n        .from('sections')\n        .insert({\n          entity_type: testSection.entityType,\n          entity_id: testSection.entityId,\n          position: testSection.position,\n        })\n        .select()\n        .single();\n      \n      // Should not get RLS error\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      \n      if (data) {\n        trackEntity('sections', data.id);\n      }\n    });\n  });\n  \n  describe('columns Table RLS', () => {\n    it('should allow authenticated users to read columns', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('columns')\n        .select('*')\n        .limit(10);\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n  });\n  \n  describe('content_pages Table RLS', () => {\n    it('should allow authenticated users to read content pages', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('content_pages')\n        .select('*')\n        .limit(10);\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n    \n    it('should allow authenticated users to create content pages', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      const testPage = createTestContentPage();\n      \n      const { data, error } = await client\n        .from('content_pages')\n        .insert({\n          title: testPage.title,\n          slug: testPage.slug,\n          type: testPage.type,\n          published: testPage.published,\n        })\n        .select()\n        .single();\n      \n      // Should not get \"violates row-level security policy\" error\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      \n      if (data) {\n        trackEntity('content_pages', data.id);\n      }\n    });\n  });\n  \n  describe('gallery_settings Table RLS', () => {\n    it('should allow authenticated users to read gallery settings', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      const { data, error } = await client\n        .from('gallery_settings')\n        .select('*')\n        .limit(10);\n      \n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(Array.isArray(data)).toBe(true);\n    });\n  });\n  \n  describe('Cross-Table RLS Consistency', () => {\n    it('should enforce consistent RLS across related tables', async () => {\n      if (authSetupFailed || !testUser?.accessToken) {\n        console.log('⏭️  Skipping: Authentication not configured');\n        return;\n      }\n      \n      const client = createTestClient(testUser.accessToken);\n      \n      // Try to read from multiple tables\n      const [groupsResult, guestsResult, eventsResult] = await Promise.all([\n        client.from('guest_groups').select('*').limit(1),\n        client.from('guests').select('*').limit(1),\n        client.from('events').select('*').limit(1),\n      ]);\n      \n      // All should succeed or fail consistently (no RLS errors)\n      expect(groupsResult.error).toBeNull();\n      expect(guestsResult.error).toBeNull();\n      expect(eventsResult.error).toBeNull();\n    });\n  });\n});\n\n/**\n * TEST IMPLEMENTATION NOTES\n * \n * These tests validate RLS policies for all major tables:\n * \n * 1. **guest_groups**: Read, create, and auth enforcement\n * 2. **guests**: Read, create with proper group reference\n * 3. **events**: Read and create\n * 4. **activities**: Read operations\n * 5. **accommodations**: Read operations\n * 6. **sections**: Read, create (catches \"permission denied for table users\" bug)\n * 7. **columns**: Read operations\n * 8. **content_pages**: Read, create (catches RLS violation bug)\n * 9. **gallery_settings**: Read operations\n * \n * Key Testing Patterns:\n * - Uses real authentication (not service role)\n * - Tests both read and write operations\n * - Verifies unauthenticated access is blocked\n * - Checks for specific RLS error messages\n * - Cleans up test data after execution\n * \n * What These Tests Catch:\n * - Missing RLS policies\n * - Incorrect RLS policy logic\n * - Permission denied errors\n * - RLS policy violations\n * - Inconsistent access control\n * \n * Validates: Requirements 1.2, 1.3, 1.4\n */\n"],"names":["describe","testUser","authSetupFailed","createdIds","Map","trackEntity","table","id","ids","get","push","set","beforeAll","createAndSignInTestUser","console","log","error","warn","Error","message","afterAll","entries","length","cleanupByIds","deleteTestUser","it","accessToken","client","createTestClient","data","from","select","limit","expect","toBeNull","toBeDefined","Array","isArray","toBe","testGroup","createTestGuestGroup","insert","name","description","single","serviceClient","createServiceClient","group","testGuest","createTestGuest","groupId","first_name","firstName","last_name","lastName","email","group_id","age_type","ageType","guest_type","guestType","testEvent","createTestEvent","start_date","startDate","end_date","endDate","event","testSection","createTestSection","entityType","entityId","entity_type","entity_id","position","testPage","createTestContentPage","title","slug","type","published","groupsResult","guestsResult","eventsResult","Promise","all"],"mappings":"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"}