56ea7b35a135fd724e774eefbd43202d
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get createApiClient () {
        return createApiClient;
    },
    get getAuthenticatedUser () {
        return getAuthenticatedUser;
    },
    get getAuthorizedAdmin () {
        return getAuthorizedAdmin;
    }
});
const _ssr = require("@supabase/ssr");
const _headers = require("next/headers");
async function createApiClient() {
    const cookieStore = await (0, _headers.cookies)();
    return (0, _ssr.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY, {
        cookies: {
            getAll () {
                return cookieStore.getAll();
            },
            setAll (cookiesToSet) {
                cookiesToSet.forEach(({ name, value, options })=>{
                    cookieStore.set(name, value, options);
                });
            }
        }
    });
}
async function getAuthenticatedUser() {
    const supabase = await createApiClient();
    const { data: { user }, error } = await supabase.auth.getUser();
    if (error || !user) {
        return null;
    }
    return {
        user,
        supabase
    };
}
async function getAuthorizedAdmin() {
    const auth = await getAuthenticatedUser();
    if (!auth) return null;
    const { user, supabase } = auth;
    const { data: userData, error } = await supabase.from('users').select('role').eq('id', user.id).single();
    if (error || !userData || ![
        'super_admin',
        'host'
    ].includes(userData.role)) {
        return null;
    }
    return {
        user,
        supabase,
        role: userData.role
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvbGliL2FwaUF1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3Nzcic7XG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcbmltcG9ydCB0eXBlIHsgU3VwYWJhc2VDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBTdXBhYmFzZSBjbGllbnQgZm9yIEFQSSByb3V0ZXMgd2l0aCBwcm9wZXIgY29va2llIGhhbmRsaW5nXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBcGlDbGllbnQoKTogUHJvbWlzZTxTdXBhYmFzZUNsaWVudD4ge1xuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcbiAgXG4gIHJldHVybiBjcmVhdGVTZXJ2ZXJDbGllbnQoXG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXG4gICAge1xuICAgICAgY29va2llczoge1xuICAgICAgICBnZXRBbGwoKSB7XG4gICAgICAgICAgcmV0dXJuIGNvb2tpZVN0b3JlLmdldEFsbCgpO1xuICAgICAgICB9LFxuICAgICAgICBzZXRBbGwoY29va2llc1RvU2V0KSB7XG4gICAgICAgICAgY29va2llc1RvU2V0LmZvckVhY2goKHsgbmFtZSwgdmFsdWUsIG9wdGlvbnMgfSkgPT4ge1xuICAgICAgICAgICAgY29va2llU3RvcmUuc2V0KG5hbWUsIHZhbHVlLCBvcHRpb25zKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfVxuICApO1xufVxuXG4vKipcbiAqIFZlcmlmaWVzIHVzZXIgYXV0aGVudGljYXRpb24gYW5kIHJldHVybnMgdXNlciBvYmplY3RcbiAqIFJldHVybnMgbnVsbCBpZiBub3QgYXV0aGVudGljYXRlZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXV0aGVudGljYXRlZFVzZXIoKSB7XG4gIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQXBpQ2xpZW50KCk7XG4gIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgXG4gIGlmIChlcnJvciB8fCAhdXNlcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIFxuICByZXR1cm4geyB1c2VyLCBzdXBhYmFzZSB9O1xufVxuXG4vKipcbiAqIFZlcmlmaWVzIHVzZXIgaGFzIGFkbWluL2hvc3Qgcm9sZVxuICogUmV0dXJucyBudWxsIGlmIG5vdCBhdXRob3JpemVkXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRob3JpemVkQWRtaW4oKSB7XG4gIGNvbnN0IGF1dGggPSBhd2FpdCBnZXRBdXRoZW50aWNhdGVkVXNlcigpO1xuICBpZiAoIWF1dGgpIHJldHVybiBudWxsO1xuICBcbiAgY29uc3QgeyB1c2VyLCBzdXBhYmFzZSB9ID0gYXV0aDtcbiAgXG4gIGNvbnN0IHsgZGF0YTogdXNlckRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCd1c2VycycpXG4gICAgLnNlbGVjdCgncm9sZScpXG4gICAgLmVxKCdpZCcsIHVzZXIuaWQpXG4gICAgLnNpbmdsZSgpO1xuICBcbiAgaWYgKGVycm9yIHx8ICF1c2VyRGF0YSB8fCAhWydzdXBlcl9hZG1pbicsICdob3N0J10uaW5jbHVkZXModXNlckRhdGEucm9sZSkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBcbiAgcmV0dXJuIHsgdXNlciwgc3VwYWJhc2UsIHJvbGU6IHVzZXJEYXRhLnJvbGUgfTtcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVBcGlDbGllbnQiLCJnZXRBdXRoZW50aWNhdGVkVXNlciIsImdldEF1dGhvcml6ZWRBZG1pbiIsImNvb2tpZVN0b3JlIiwiY29va2llcyIsImNyZWF0ZVNlcnZlckNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldEFsbCIsInNldEFsbCIsImNvb2tpZXNUb1NldCIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJvcHRpb25zIiwic2V0Iiwic3VwYWJhc2UiLCJkYXRhIiwidXNlciIsImVycm9yIiwiYXV0aCIsImdldFVzZXIiLCJ1c2VyRGF0YSIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlkIiwic2luZ2xlIiwiaW5jbHVkZXMiLCJyb2xlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztRQU9zQkE7ZUFBQUE7O1FBeUJBQztlQUFBQTs7UUFlQUM7ZUFBQUE7OztxQkEvQ2E7eUJBQ1g7QUFNakIsZUFBZUY7SUFDcEIsTUFBTUcsY0FBYyxNQUFNQyxJQUFBQSxnQkFBTztJQUVqQyxPQUFPQyxJQUFBQSx1QkFBa0IsRUFDdkJDLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCLEVBQ3BDRixRQUFRQyxHQUFHLENBQUNFLDZCQUE2QixFQUN6QztRQUNFTCxTQUFTO1lBQ1BNO2dCQUNFLE9BQU9QLFlBQVlPLE1BQU07WUFDM0I7WUFDQUMsUUFBT0MsWUFBWTtnQkFDakJBLGFBQWFDLE9BQU8sQ0FBQyxDQUFDLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxPQUFPLEVBQUU7b0JBQzVDYixZQUFZYyxHQUFHLENBQUNILE1BQU1DLE9BQU9DO2dCQUMvQjtZQUNGO1FBQ0Y7SUFDRjtBQUVKO0FBTU8sZUFBZWY7SUFDcEIsTUFBTWlCLFdBQVcsTUFBTWxCO0lBQ3ZCLE1BQU0sRUFBRW1CLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1ILFNBQVNJLElBQUksQ0FBQ0MsT0FBTztJQUU3RCxJQUFJRixTQUFTLENBQUNELE1BQU07UUFDbEIsT0FBTztJQUNUO0lBRUEsT0FBTztRQUFFQTtRQUFNRjtJQUFTO0FBQzFCO0FBTU8sZUFBZWhCO0lBQ3BCLE1BQU1vQixPQUFPLE1BQU1yQjtJQUNuQixJQUFJLENBQUNxQixNQUFNLE9BQU87SUFFbEIsTUFBTSxFQUFFRixJQUFJLEVBQUVGLFFBQVEsRUFBRSxHQUFHSTtJQUUzQixNQUFNLEVBQUVILE1BQU1LLFFBQVEsRUFBRUgsS0FBSyxFQUFFLEdBQUcsTUFBTUgsU0FDckNPLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsUUFDUEMsRUFBRSxDQUFDLE1BQU1QLEtBQUtRLEVBQUUsRUFDaEJDLE1BQU07SUFFVCxJQUFJUixTQUFTLENBQUNHLFlBQVksQ0FBQztRQUFDO1FBQWU7S0FBTyxDQUFDTSxRQUFRLENBQUNOLFNBQVNPLElBQUksR0FBRztRQUMxRSxPQUFPO0lBQ1Q7SUFFQSxPQUFPO1FBQUVYO1FBQU1GO1FBQVVhLE1BQU1QLFNBQVNPLElBQUk7SUFBQztBQUMvQyJ9