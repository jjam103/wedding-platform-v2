{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/lib/apiAuth.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\nimport type { SupabaseClient } from '@supabase/supabase-js';\n\n/**\n * Creates a Supabase client for API routes with proper cookie handling\n */\nexport async function createApiClient(): Promise<SupabaseClient> {\n  const cookieStore = await cookies();\n  \n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value, options }) => {\n            cookieStore.set(name, value, options);\n          });\n        },\n      },\n    }\n  );\n}\n\n/**\n * Verifies user authentication and returns user object\n * Returns null if not authenticated\n */\nexport async function getAuthenticatedUser() {\n  const supabase = await createApiClient();\n  const { data: { user }, error } = await supabase.auth.getUser();\n  \n  if (error || !user) {\n    return null;\n  }\n  \n  return { user, supabase };\n}\n\n/**\n * Verifies user has admin/host role\n * Returns null if not authorized\n */\nexport async function getAuthorizedAdmin() {\n  const auth = await getAuthenticatedUser();\n  if (!auth) return null;\n  \n  const { user, supabase } = auth;\n  \n  const { data: userData, error } = await supabase\n    .from('users')\n    .select('role')\n    .eq('id', user.id)\n    .single();\n  \n  if (error || !userData || !['super_admin', 'host'].includes(userData.role)) {\n    return null;\n  }\n  \n  return { user, supabase, role: userData.role };\n}\n"],"names":["createApiClient","getAuthenticatedUser","getAuthorizedAdmin","cookieStore","cookies","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","getAll","setAll","cookiesToSet","forEach","name","value","options","set","supabase","data","user","error","auth","getUser","userData","from","select","eq","id","single","includes","role"],"mappings":";;;;;;;;;;;QAOsBA;eAAAA;;QAyBAC;eAAAA;;QAeAC;eAAAA;;;qBA/Ca;yBACX;AAMjB,eAAeF;IACpB,MAAMG,cAAc,MAAMC,IAAAA,gBAAO;IAEjC,OAAOC,IAAAA,uBAAkB,EACvBC,QAAQC,GAAG,CAACC,wBAAwB,EACpCF,QAAQC,GAAG,CAACE,6BAA6B,EACzC;QACEL,SAAS;YACPM;gBACE,OAAOP,YAAYO,MAAM;YAC3B;YACAC,QAAOC,YAAY;gBACjBA,aAAaC,OAAO,CAAC,CAAC,EAAEC,IAAI,EAAEC,KAAK,EAAEC,OAAO,EAAE;oBAC5Cb,YAAYc,GAAG,CAACH,MAAMC,OAAOC;gBAC/B;YACF;QACF;IACF;AAEJ;AAMO,eAAef;IACpB,MAAMiB,WAAW,MAAMlB;IACvB,MAAM,EAAEmB,MAAM,EAAEC,IAAI,EAAE,EAAEC,KAAK,EAAE,GAAG,MAAMH,SAASI,IAAI,CAACC,OAAO;IAE7D,IAAIF,SAAS,CAACD,MAAM;QAClB,OAAO;IACT;IAEA,OAAO;QAAEA;QAAMF;IAAS;AAC1B;AAMO,eAAehB;IACpB,MAAMoB,OAAO,MAAMrB;IACnB,IAAI,CAACqB,MAAM,OAAO;IAElB,MAAM,EAAEF,IAAI,EAAEF,QAAQ,EAAE,GAAGI;IAE3B,MAAM,EAAEH,MAAMK,QAAQ,EAAEH,KAAK,EAAE,GAAG,MAAMH,SACrCO,IAAI,CAAC,SACLC,MAAM,CAAC,QACPC,EAAE,CAAC,MAAMP,KAAKQ,EAAE,EAChBC,MAAM;IAET,IAAIR,SAAS,CAACG,YAAY,CAAC;QAAC;QAAe;KAAO,CAACM,QAAQ,CAACN,SAASO,IAAI,GAAG;QAC1E,OAAO;IACT;IAEA,OAAO;QAAEX;QAAMF;QAAUa,MAAMP,SAASO,IAAI;IAAC;AAC/C"}