{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/activityService.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\nimport { sanitizeInput, sanitizeRichText } from \"../utils/sanitization\";\nimport { generateSlug, isValidSlug, makeUniqueSlug } from \"../utils/slugs\";\nimport {\n  createActivitySchema,\n  updateActivitySchema,\n  activityFilterSchema,\n  activitySearchSchema,\n  type CreateActivityDTO,\n  type UpdateActivityDTO,\n  type ActivityFilterDTO,\n  type ActivitySearchDTO,\n  type Activity,\n  type PaginatedActivities,\n  type ActivityCapacity,\n} from '../schemas/activitySchemas';\n\n/**\n * Result type for consistent error handling.\n */\ntype Result<T> =\n  | { success: true; data: T }\n  | { success: false; error: { code: string; message: string; details?: any } };\n\n/**\n * Converts camelCase to snake_case for database columns.\n */\nfunction toSnakeCase(obj: any): any {\n  const snakeObj: any = {};\n  for (const key in obj) {\n    const snakeKey = key.replace(/[A-Z]/g, (letter) => `_${letter.toLowerCase()}`);\n    snakeObj[snakeKey] = obj[key];\n  }\n  return snakeObj;\n}\n\n/**\n * Converts snake_case to camelCase for TypeScript objects.\n */\nfunction toCamelCase(obj: any): any {\n  const camelObj: any = {};\n  for (const key in obj) {\n    const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\n    camelObj[camelKey] = obj[key];\n  }\n  return camelObj;\n}\n\n/**\n * Ensures slug is unique by checking existing activities and appending a number if necessary.\n * \n * @param slug - Desired slug\n * @param excludeId - ID to exclude from uniqueness check (for updates)\n * @returns Unique slug\n */\nasync function ensureUniqueSlug(slug: string, excludeId?: string): Promise<string> {\n  const supabase = createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n  );\n\n  // Get all existing slugs\n  let query = supabase.from('activities').select('slug');\n  \n  if (excludeId) {\n    query = query.neq('id', excludeId);\n  }\n\n  const { data, error } = await query;\n\n  if (error) {\n    // If we can't check, return the original slug and let database handle uniqueness\n    return slug;\n  }\n\n  const existingSlugs = data.map((activity: any) => activity.slug).filter(Boolean);\n  return makeUniqueSlug(slug, existingSlugs);\n}\n\n/**\n * Creates a new activity in the system.\n *\n * @param data - Activity data including name, type, time, and capacity\n * @returns Result containing the created activity or error details\n *\n * @example\n * const result = await activityService.create({\n *   name: 'Beach Volleyball',\n *   activityType: 'activity',\n *   startTime: '2025-06-15T10:00:00Z',\n *   capacity: 20,\n * });\n */\nexport async function create(data: CreateActivityDTO): Promise<Result<Activity>> {\n  try {\n    // 1. Validate\n    const validation = createActivitySchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 2. Sanitize user input\n    const sanitized = {\n      ...validation.data,\n      name: sanitizeInput(validation.data.name),\n      description: validation.data.description ? sanitizeRichText(validation.data.description) : null,\n      activityType: sanitizeInput(validation.data.activityType),\n    };\n\n    // 2.1. Generate slug if not provided\n    const baseSlug = generateSlug(sanitized.name);\n    if (!isValidSlug(baseSlug)) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Activity name must contain at least one alphanumeric character to generate a valid slug',\n          details: {\n            field: 'name',\n            value: sanitized.name,\n            reason: 'Generated slug is invalid or empty after normalization',\n          },\n        },\n      };\n    }\n\n    // 2.2. Ensure slug is unique\n    const uniqueSlug = await ensureUniqueSlug(baseSlug);\n    const sanitizedWithSlug = {\n      ...sanitized,\n      slug: uniqueSlug,\n    };\n\n    // 3. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const dbData = toSnakeCase(sanitizedWithSlug);\n    const { data: result, error } = await supabase\n      .from('activities')\n      .insert(dbData)\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as Activity };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Retrieves a single activity by ID.\n *\n * @param id - Activity UUID\n * @returns Result containing the activity or error details\n */\nexport async function get(id: string): Promise<Result<Activity>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { data, error } = await supabase\n      .from('activities')\n      .select('*')\n      .eq('id', id)\n      .is('deleted_at', null)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(data) as Activity };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Updates an existing activity.\n *\n * @param id - Activity UUID\n * @param data - Partial activity data to update\n * @returns Result containing the updated activity or error details\n */\nexport async function update(id: string, data: UpdateActivityDTO): Promise<Result<Activity>> {\n  try {\n    // 1. Validate\n    const validation = updateActivitySchema.safeParse(data);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 2. Sanitize user input\n    const sanitized: any = { ...validation.data };\n    if (sanitized.name) {\n      sanitized.name = sanitizeInput(sanitized.name);\n    }\n    if (sanitized.description) {\n      sanitized.description = sanitizeRichText(sanitized.description);\n    }\n    if (sanitized.activityType) {\n      sanitized.activityType = sanitizeInput(sanitized.activityType);\n    }\n\n    // 2.1. Preserve slug - do not regenerate from name on update\n    // Slug should only be set on creation or explicitly updated by admin\n\n    // 3. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const dbData = toSnakeCase(sanitized);\n    const { data: result, error } = await supabase\n      .from('activities')\n      .update(dbData)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(result) as Activity };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Deletes an activity by ID.\n *\n * @param id - Activity UUID\n * @param options - Delete options (soft delete or permanent)\n * @returns Result indicating success or error details\n * \n * @example\n * // Soft delete (default)\n * await deleteActivity('activity-id');\n * \n * // Permanent delete\n * await deleteActivity('activity-id', { permanent: true });\n */\nexport async function deleteActivity(\n  id: string,\n  options: { permanent?: boolean; deletedBy?: string } = {}\n): Promise<Result<void>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { permanent = false, deletedBy } = options;\n\n    if (permanent) {\n      // Permanent deletion - remove from database\n      const { error } = await supabase.from('activities').delete().eq('id', id);\n\n      if (error) {\n        return {\n          success: false,\n          error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n        };\n      }\n    } else {\n      // Soft delete - set deleted_at timestamp\n      const now = new Date().toISOString();\n\n      // Soft delete associated RSVPs\n      await supabase\n        .from('rsvps')\n        .update({ deleted_at: now, deleted_by: deletedBy })\n        .eq('activity_id', id)\n        .is('deleted_at', null);\n\n      // Soft delete activity\n      const { error } = await supabase\n        .from('activities')\n        .update({ deleted_at: now, deleted_by: deletedBy })\n        .eq('id', id)\n        .is('deleted_at', null);\n\n      if (error) {\n        return {\n          success: false,\n          error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n        };\n      }\n    }\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Restores a soft-deleted activity and all associated RSVPs\n * \n * @param id - Activity ID\n * @returns Result containing the restored activity or error details\n * \n * @example\n * const result = await restoreActivity('activity-id');\n */\nexport async function restoreActivity(id: string): Promise<Result<Activity>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    // Restore associated RSVPs\n    await supabase\n      .from('rsvps')\n      .update({ deleted_at: null, deleted_by: null })\n      .eq('activity_id', id);\n\n    // Restore activity\n    const { data, error } = await supabase\n      .from('activities')\n      .update({ deleted_at: null, deleted_by: null })\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Lists activities with optional filtering and pagination.\n *\n * @param filters - Filter criteria and pagination options\n * @returns Result containing paginated activities or error details\n */\nexport async function list(filters: ActivityFilterDTO = {}): Promise<Result<PaginatedActivities>> {\n  try {\n    // 1. Validate\n    const validation = activityFilterSchema.safeParse(filters);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { page = 1, pageSize = 50, ...filterParams } = validation.data;\n    const from = (page - 1) * pageSize;\n    const to = from + pageSize - 1;\n\n    // 2. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    let query = supabase.from('activities').select('*', { count: 'exact' });\n\n    // Filter out soft-deleted activities\n    query = query.is('deleted_at', null);\n\n    // Apply filters\n    if (filterParams.eventId !== undefined) {\n      if (filterParams.eventId === null) {\n        query = query.is('event_id', null);\n      } else {\n        query = query.eq('event_id', filterParams.eventId);\n      }\n    }\n    if (filterParams.activityType) {\n      query = query.eq('activity_type', filterParams.activityType);\n    }\n    if (filterParams.status) {\n      query = query.eq('status', filterParams.status);\n    }\n    if (filterParams.locationId) {\n      query = query.eq('location_id', filterParams.locationId);\n    }\n    if (filterParams.adultsOnly !== undefined) {\n      query = query.eq('adults_only', filterParams.adultsOnly);\n    }\n    if (filterParams.startTimeFrom) {\n      query = query.gte('start_time', filterParams.startTimeFrom);\n    }\n    if (filterParams.startTimeTo) {\n      query = query.lte('start_time', filterParams.startTimeTo);\n    }\n\n    // Apply pagination and ordering\n    query = query.order('start_time', { ascending: true }).range(from, to);\n\n    const { data, error, count } = await query;\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const activities = data.map((activity) => toCamelCase(activity) as Activity);\n    const total = count || 0;\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      success: true,\n      data: {\n        activities,\n        total,\n        page,\n        pageSize,\n        totalPages,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Searches activities by name or description.\n *\n * @param searchParams - Search query and pagination options\n * @returns Result containing paginated search results or error details\n */\nexport async function search(searchParams: ActivitySearchDTO): Promise<Result<PaginatedActivities>> {\n  try {\n    // 1. Validate\n    const validation = activitySearchSchema.safeParse(searchParams);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Validation failed',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    const { query, page = 1, pageSize = 50 } = validation.data;\n    const from = (page - 1) * pageSize;\n    const to = from + pageSize - 1;\n\n    // 2. Sanitize search query\n    const sanitizedQuery = sanitizeInput(query);\n\n    // 3. Database operation\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { data, error, count } = await supabase\n      .from('activities')\n      .select('*', { count: 'exact' })\n      .is('deleted_at', null)\n      .or(`name.ilike.%${sanitizedQuery}%,description.ilike.%${sanitizedQuery}%`)\n      .order('start_time', { ascending: true })\n      .range(from, to);\n\n    if (error) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const activities = data.map((activity) => toCamelCase(activity) as Activity);\n    const total = count || 0;\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      success: true,\n      data: {\n        activities,\n        total,\n        page,\n        pageSize,\n        totalPages,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Calculates capacity information for an activity.\n *\n * @param activityId - Activity UUID\n * @returns Result containing capacity information or error details\n */\nexport async function getCapacityInfo(activityId: string): Promise<Result<ActivityCapacity>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    // Get activity details\n    const { data: activity, error: activityError } = await supabase\n      .from('activities')\n      .select('id, name, capacity')\n      .eq('id', activityId)\n      .single();\n\n    if (activityError) {\n      if (activityError.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: activityError.message, details: activityError },\n      };\n    }\n\n    // Count attending RSVPs\n    const { count, error: countError } = await supabase\n      .from('rsvps')\n      .select('*', { count: 'exact', head: true })\n      .eq('activity_id', activityId)\n      .eq('status', 'attending');\n\n    if (countError) {\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: countError.message, details: countError },\n      };\n    }\n\n    const currentAttendees = count || 0;\n    const capacity = activity.capacity;\n    const availableSpots = capacity !== null ? capacity - currentAttendees : null;\n    const utilizationPercentage = capacity !== null ? (currentAttendees / capacity) * 100 : null;\n    const isNearCapacity = utilizationPercentage !== null && utilizationPercentage >= 90;\n    const isAtCapacity = utilizationPercentage !== null && utilizationPercentage >= 100;\n\n    return {\n      success: true,\n      data: {\n        activityId: activity.id,\n        activityName: activity.name,\n        capacity,\n        currentAttendees,\n        availableSpots,\n        utilizationPercentage,\n        isNearCapacity,\n        isAtCapacity,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Calculates cost for an activity after applying host subsidy.\n *\n * @param activityId - Activity UUID\n * @returns Result containing net cost per person or error details\n */\nexport async function calculateNetCost(activityId: string): Promise<Result<number>> {\n  try {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { data: activity, error } = await supabase\n      .from('activities')\n      .select('cost_per_person, host_subsidy')\n      .eq('id', activityId)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    const costPerPerson = activity.cost_per_person || 0;\n    const hostSubsidy = activity.host_subsidy || 0;\n    const netCost = Math.max(0, costPerPerson - hostSubsidy);\n\n    return { success: true, data: netCost };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n\n/**\n * Retrieves a single activity by slug.\n *\n * @param slug - Activity slug (URL-safe identifier)\n * @returns Result containing the activity or error details\n *\n * @example\n * const result = await activityService.getBySlug('beach-volleyball');\n */\nexport async function getBySlug(slug: string): Promise<Result<Activity>> {\n  try {\n    // Validate slug format\n    if (!slug || typeof slug !== 'string' || slug.trim() === '') {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid slug provided',\n        },\n      };\n    }\n\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    const { data, error } = await supabase\n      .from('activities')\n      .select('*')\n      .eq('slug', slug.toLowerCase())\n      .is('deleted_at', null)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        return {\n          success: false,\n          error: { code: 'NOT_FOUND', message: 'Activity not found' },\n        };\n      }\n      return {\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: error.message, details: error },\n      };\n    }\n\n    return { success: true, data: toCamelCase(data) as Activity };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'UNKNOWN_ERROR',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n    };\n  }\n}\n"],"names":["calculateNetCost","create","deleteActivity","get","getBySlug","getCapacityInfo","list","restoreActivity","search","update","toSnakeCase","obj","snakeObj","key","snakeKey","replace","letter","toLowerCase","toCamelCase","camelObj","camelKey","_","toUpperCase","ensureUniqueSlug","slug","excludeId","supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","query","from","select","neq","data","error","existingSlugs","map","activity","filter","Boolean","makeUniqueSlug","validation","createActivitySchema","safeParse","success","code","message","details","issues","sanitized","name","sanitizeInput","description","sanitizeRichText","activityType","baseSlug","generateSlug","isValidSlug","field","value","reason","uniqueSlug","sanitizedWithSlug","dbData","result","insert","single","Error","id","eq","is","updateActivitySchema","options","permanent","deletedBy","delete","now","Date","toISOString","deleted_at","deleted_by","undefined","filters","activityFilterSchema","page","pageSize","filterParams","to","count","eventId","status","locationId","adultsOnly","startTimeFrom","gte","startTimeTo","lte","order","ascending","range","activities","total","totalPages","Math","ceil","searchParams","activitySearchSchema","sanitizedQuery","or","activityId","activityError","countError","head","currentAttendees","capacity","availableSpots","utilizationPercentage","isNearCapacity","isAtCapacity","activityName","costPerPerson","cost_per_person","hostSubsidy","host_subsidy","netCost","max","trim"],"mappings":"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"}