{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/rsvpApis.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests for RSVP Management APIs\n * \n * Tests the complete API flow for RSVP management endpoints:\n * - GET /api/admin/rsvps (list with filters)\n * - PATCH /api/admin/rsvps/bulk (bulk update)\n * - GET /api/admin/rsvps/export (CSV export)\n * \n * Following testing standards:\n * - Mock services to avoid worker crashes\n * - Test authentication, validation, and error handling\n * - Test complete request/response flow\n */\n\nimport { GET as getRsvps } from '@/app/api/admin/rsvps/route';\nimport { PATCH as bulkUpdateRsvps } from '@/app/api/admin/rsvps/bulk/route';\nimport { GET as exportRsvps } from '@/app/api/admin/rsvps/export/route';\nimport * as rsvpManagementService from '@/services/rsvpManagementService';\nimport * as apiHelpers from '@/lib/apiHelpers';\nimport * as rateLimit from '@/lib/rateLimit';\n\n// Mock services to avoid worker crashes\njest.mock('@/services/rsvpManagementService');\njest.mock('@/lib/apiHelpers', () => ({\n  ...jest.requireActual('@/lib/apiHelpers'),\n  withAuth: jest.fn(),\n}));\njest.mock('@/lib/rateLimit', () => ({\n  ...jest.requireActual('@/lib/rateLimit'),\n  rateLimitMiddleware: jest.fn(),\n  getRateLimitHeaders: jest.fn(),\n}));\n\ndescribe('RSVP Management APIs - Integration Tests', () => {\n  const mockUserId = 'test-user-123';\n  \n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Default: withAuth calls handler with userId\n    (apiHelpers.withAuth as jest.Mock).mockImplementation(\n      async (handler: (userId: string) => Promise<Response>) => {\n        return handler(mockUserId);\n      }\n    );\n    \n    // Default: rate limit allows request\n    (rateLimit.rateLimitMiddleware as jest.Mock).mockReturnValue({\n      success: true,\n      data: {\n        allowed: true,\n        limit: 1,\n        remaining: 0,\n        reset: Math.floor(Date.now() / 1000) + 60,\n      },\n    });\n\n    \n    (rateLimit.getRateLimitHeaders as jest.Mock).mockReturnValue({\n      'X-RateLimit-Limit': '1',\n      'X-RateLimit-Remaining': '0',\n      'X-RateLimit-Reset': String(Math.floor(Date.now() / 1000) + 60),\n    });\n  });\n\n  describe('GET /api/admin/rsvps - List RSVPs with Filters', () => {\n    const mockRsvpData = {\n      data: [\n        {\n          id: 'rsvp-1',\n          guestId: 'guest-1',\n          guestFirstName: 'John',\n          guestLastName: 'Doe',\n          guestEmail: 'john@example.com',\n          eventId: 'event-1',\n          eventName: 'Wedding Ceremony',\n          activityId: null,\n          activityName: null,\n          status: 'attending' as const,\n          guestCount: 2,\n          dietaryNotes: 'Vegetarian',\n          specialRequirements: null,\n          notes: null,\n          respondedAt: '2024-01-15T10:00:00Z',\n          createdAt: '2024-01-10T10:00:00Z',\n          updatedAt: '2024-01-15T10:00:00Z',\n        },\n        {\n          id: 'rsvp-2',\n          guestId: 'guest-2',\n          guestFirstName: 'Jane',\n          guestLastName: 'Smith',\n          guestEmail: 'jane@example.com',\n          eventId: 'event-1',\n          eventName: 'Wedding Ceremony',\n          activityId: 'activity-1',\n          activityName: 'Reception Dinner',\n          status: 'pending' as const,\n          guestCount: 1,\n          dietaryNotes: null,\n          specialRequirements: 'Wheelchair access',\n          notes: null,\n          respondedAt: null,\n          createdAt: '2024-01-10T10:00:00Z',\n          updatedAt: '2024-01-10T10:00:00Z',\n        },\n      ],\n      pagination: {\n        page: 1,\n        limit: 50,\n        total: 2,\n        totalPages: 1,\n      },\n      statistics: {\n        totalRSVPs: 2,\n        byStatus: {\n          attending: 1,\n          declined: 0,\n          maybe: 0,\n          pending: 1,\n        },\n        totalGuestCount: 3,\n      },\n    };\n\n    it('should successfully retrieve RSVPs with default pagination', async () => {\n      // Arrange\n      (rsvpManagementService.listRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockRsvpData,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps');\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.data).toHaveLength(2);\n      expect(data.data.pagination.page).toBe(1);\n      expect(data.data.pagination.limit).toBe(50);\n      expect(data.data.statistics.totalRSVPs).toBe(2);\n      expect(rsvpManagementService.listRSVPs).toHaveBeenCalledWith(\n        {},\n        { page: 1, limit: 50 }\n      );\n    });\n\n\n    it('should filter RSVPs by event ID', async () => {\n      // Arrange\n      const filteredData = {\n        ...mockRsvpData,\n        data: [mockRsvpData.data[0]],\n        pagination: { ...mockRsvpData.pagination, total: 1 },\n        statistics: {\n          totalRSVPs: 1,\n          byStatus: { attending: 1, declined: 0, maybe: 0, pending: 0 },\n          totalGuestCount: 2,\n        },\n      };\n\n      (rsvpManagementService.listRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: filteredData,\n      });\n\n      const request = new Request(\n        'http://localhost:3000/api/admin/rsvps?eventId=00000000-0000-0000-0000-000000000001'\n      );\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.data).toHaveLength(1);\n      expect(rsvpManagementService.listRSVPs).toHaveBeenCalledWith(\n        { eventId: '00000000-0000-0000-0000-000000000001' },\n        { page: 1, limit: 50 }\n      );\n    });\n\n    it('should filter RSVPs by status', async () => {\n      // Arrange\n      const filteredData = {\n        ...mockRsvpData,\n        data: [mockRsvpData.data[1]],\n        pagination: { ...mockRsvpData.pagination, total: 1 },\n        statistics: {\n          totalRSVPs: 1,\n          byStatus: { attending: 0, declined: 0, maybe: 0, pending: 1 },\n          totalGuestCount: 1,\n        },\n      };\n\n      (rsvpManagementService.listRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: filteredData,\n      });\n\n      const request = new Request(\n        'http://localhost:3000/api/admin/rsvps?status=pending'\n      );\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.data).toHaveLength(1);\n      expect(data.data.data[0].status).toBe('pending');\n      expect(rsvpManagementService.listRSVPs).toHaveBeenCalledWith(\n        { status: 'pending' },\n        { page: 1, limit: 50 }\n      );\n    });\n\n    it('should apply multiple filters simultaneously', async () => {\n      // Arrange\n      (rsvpManagementService.listRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: {\n          data: [],\n          pagination: { page: 1, limit: 25, total: 0, totalPages: 0 },\n          statistics: {\n            totalRSVPs: 0,\n            byStatus: { attending: 0, declined: 0, maybe: 0, pending: 0 },\n            totalGuestCount: 0,\n          },\n        },\n      });\n\n      const request = new Request(\n        'http://localhost:3000/api/admin/rsvps?eventId=00000000-0000-0000-0000-000000000001&activityId=00000000-0000-0000-0000-000000000002&status=attending&searchQuery=John&page=1&limit=25'\n      );\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(rsvpManagementService.listRSVPs).toHaveBeenCalledWith(\n        {\n          eventId: '00000000-0000-0000-0000-000000000001',\n          activityId: '00000000-0000-0000-0000-000000000002',\n          status: 'attending',\n          searchQuery: 'John',\n        },\n        { page: 1, limit: 25 }\n      );\n    });\n\n\n    it('should return 400 for invalid UUID in eventId filter', async () => {\n      // Arrange\n      const request = new Request(\n        'http://localhost:3000/api/admin/rsvps?eventId=invalid-uuid'\n      );\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(data.error.message).toBe('Invalid query parameters');\n      expect(rsvpManagementService.listRSVPs).not.toHaveBeenCalled();\n    });\n\n    it('should return 400 for invalid status value', async () => {\n      // Arrange\n      const request = new Request(\n        'http://localhost:3000/api/admin/rsvps?status=invalid-status'\n      );\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(rsvpManagementService.listRSVPs).not.toHaveBeenCalled();\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      (apiHelpers.withAuth as jest.Mock).mockImplementation(async () => {\n        return new Response(\n          JSON.stringify({\n            success: false,\n            error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n          }),\n          { status: 401 }\n        );\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps');\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(rsvpManagementService.listRSVPs).not.toHaveBeenCalled();\n    });\n\n    it('should handle database errors from service', async () => {\n      // Arrange\n      (rsvpManagementService.listRSVPs as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to query RSVPs',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps');\n\n      // Act\n      const response = await getRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n\n  describe('PATCH /api/admin/rsvps/bulk - Bulk Update RSVPs', () => {\n    const mockRsvpIds = [\n      '11111111-1111-1111-1111-111111111111',\n      '22222222-2222-2222-2222-222222222222',\n      '33333333-3333-3333-3333-333333333333',\n    ];\n\n    it('should successfully update multiple RSVPs', async () => {\n      // Arrange\n      (rsvpManagementService.bulkUpdateRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: { updatedCount: 3 },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: mockRsvpIds,\n          status: 'attending',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.updatedCount).toBe(3);\n      expect(rsvpManagementService.bulkUpdateRSVPs).toHaveBeenCalledWith(\n        mockRsvpIds,\n        'attending',\n        undefined\n      );\n    });\n\n    it('should update RSVPs with notes', async () => {\n      // Arrange\n      (rsvpManagementService.bulkUpdateRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: { updatedCount: 2 },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: mockRsvpIds.slice(0, 2),\n          status: 'declined',\n          notes: 'Unable to attend due to scheduling conflict',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.updatedCount).toBe(2);\n      expect(rsvpManagementService.bulkUpdateRSVPs).toHaveBeenCalledWith(\n        mockRsvpIds.slice(0, 2),\n        'declined',\n        'Unable to attend due to scheduling conflict'\n      );\n    });\n\n    it('should handle partial success when some RSVPs not found', async () => {\n      // Arrange\n      (rsvpManagementService.bulkUpdateRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: { updatedCount: 2 }, // Only 2 of 3 updated\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: mockRsvpIds,\n          status: 'maybe',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.updatedCount).toBe(2);\n    });\n\n    it('should return 400 when rsvpIds is empty', async () => {\n      // Arrange\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: [],\n          status: 'attending',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(rsvpManagementService.bulkUpdateRSVPs).not.toHaveBeenCalled();\n    });\n\n\n    it('should return 400 when rsvpIds exceeds 100 items', async () => {\n      // Arrange\n      const tooManyIds = Array.from({ length: 101 }, (_, i) =>\n        `${String(i).padStart(8, '0')}-1111-1111-1111-111111111111`\n      );\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: tooManyIds,\n          status: 'attending',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(rsvpManagementService.bulkUpdateRSVPs).not.toHaveBeenCalled();\n    });\n\n    it('should return 400 when rsvpIds contains invalid UUID', async () => {\n      // Arrange\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: ['invalid-uuid', mockRsvpIds[0]],\n          status: 'attending',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(rsvpManagementService.bulkUpdateRSVPs).not.toHaveBeenCalled();\n    });\n\n    it('should return 400 when status is invalid', async () => {\n      // Arrange\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: mockRsvpIds,\n          status: 'invalid-status',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(rsvpManagementService.bulkUpdateRSVPs).not.toHaveBeenCalled();\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      (apiHelpers.withAuth as jest.Mock).mockImplementation(async () => {\n        return new Response(\n          JSON.stringify({\n            success: false,\n            error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n          }),\n          { status: 401 }\n        );\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: mockRsvpIds,\n          status: 'attending',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(rsvpManagementService.bulkUpdateRSVPs).not.toHaveBeenCalled();\n    });\n\n\n    it('should handle database errors from service', async () => {\n      // Arrange\n      (rsvpManagementService.bulkUpdateRSVPs as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to update RSVPs',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: mockRsvpIds,\n          status: 'attending',\n        }),\n      });\n\n      // Act\n      const response = await bulkUpdateRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n  describe('GET /api/admin/rsvps/export - CSV Export', () => {\n    it('should successfully export RSVPs to CSV', async () => {\n      // Arrange\n      const mockCSV = 'RSVP ID,Guest First Name,Guest Last Name,Guest Email,Event Name,Activity Name,Status,Guest Count,Dietary Notes,Special Requirements,Notes,Responded At,Created At,Updated At\\nrsvp-1,John,Doe,john@example.com,Wedding Ceremony,,attending,2,Vegetarian,,,2024-01-15T10:00:00Z,2024-01-10T10:00:00Z,2024-01-15T10:00:00Z';\n\n      (rsvpManagementService.exportRSVPsToCSV as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockCSV,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/export');\n\n      // Act\n      const response = await exportRsvps(request);\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(response.headers.get('Content-Type')).toBe('text/csv; charset=utf-8');\n      expect(response.headers.get('Content-Disposition')).toMatch(\n        /^attachment; filename=\"rsvps-export-\\d{4}-\\d{2}-\\d{2}\\.csv\"$/\n      );\n      expect(response.headers.get('Cache-Control')).toBe('no-cache, no-store, must-revalidate');\n\n      const csvContent = await response.text();\n      expect(csvContent).toBe(mockCSV);\n      expect(rsvpManagementService.exportRSVPsToCSV).toHaveBeenCalledWith({});\n    });\n\n    it('should export RSVPs with filters applied', async () => {\n      // Arrange\n      const mockCSV = 'RSVP ID,Guest First Name,Guest Last Name\\nrsvp-1,John,Doe';\n\n      (rsvpManagementService.exportRSVPsToCSV as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockCSV,\n      });\n\n      const request = new Request(\n        'http://localhost:3000/api/admin/rsvps/export?eventId=00000000-0000-0000-0000-000000000001&status=attending&searchQuery=John'\n      );\n\n      // Act\n      const response = await exportRsvps(request);\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(rsvpManagementService.exportRSVPsToCSV).toHaveBeenCalledWith({\n        eventId: '00000000-0000-0000-0000-000000000001',\n        status: 'attending',\n        searchQuery: 'John',\n      });\n    });\n\n    it('should include rate limit headers in response', async () => {\n      // Arrange\n      (rsvpManagementService.exportRSVPsToCSV as jest.Mock).mockResolvedValue({\n        success: true,\n        data: 'CSV content',\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/export');\n\n      // Act\n      const response = await exportRsvps(request);\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(response.headers.get('X-RateLimit-Limit')).toBe('1');\n      expect(response.headers.get('X-RateLimit-Remaining')).toBe('0');\n      expect(response.headers.has('X-RateLimit-Reset')).toBe(true);\n    });\n\n\n    it('should return 429 when rate limit exceeded', async () => {\n      // Arrange\n      (rateLimit.rateLimitMiddleware as jest.Mock).mockReturnValue({\n        success: false,\n        error: {\n          code: 'RATE_LIMIT_EXCEEDED',\n          message: 'Too many requests. Please try again later.',\n          details: {\n            limit: 1,\n            remaining: 0,\n            reset: Math.floor(Date.now() / 1000) + 60,\n            retryAfter: 60,\n          },\n        },\n      });\n\n      (rateLimit.getRateLimitHeaders as jest.Mock).mockReturnValue({\n        'X-RateLimit-Limit': '1',\n        'X-RateLimit-Remaining': '0',\n        'X-RateLimit-Reset': String(Math.floor(Date.now() / 1000) + 60),\n        'Retry-After': '60',\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/export');\n\n      // Act\n      const response = await exportRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(429);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('RATE_LIMIT_EXCEEDED');\n      expect(response.headers.get('Retry-After')).toBe('60');\n      expect(rsvpManagementService.exportRSVPsToCSV).not.toHaveBeenCalled();\n    });\n\n    it('should return 400 for invalid filter parameters', async () => {\n      // Arrange\n      const request = new Request(\n        'http://localhost:3000/api/admin/rsvps/export?eventId=invalid-uuid'\n      );\n\n      // Act\n      const response = await exportRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n      expect(rsvpManagementService.exportRSVPsToCSV).not.toHaveBeenCalled();\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      // Arrange\n      (apiHelpers.withAuth as jest.Mock).mockImplementation(async () => {\n        return new Response(\n          JSON.stringify({\n            success: false,\n            error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n          }),\n          { status: 401 }\n        );\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/export');\n\n      // Act\n      const response = await exportRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n      expect(rsvpManagementService.exportRSVPsToCSV).not.toHaveBeenCalled();\n    });\n\n    it('should handle database errors from service', async () => {\n      // Arrange\n      (rsvpManagementService.exportRSVPsToCSV as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to export RSVPs',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/rsvps/export');\n\n      // Act\n      const response = await exportRsvps(request);\n      const data = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('DATABASE_ERROR');\n    });\n  });\n\n\n  describe('Complete RSVP Management Workflow', () => {\n    it('should support complete workflow: list, filter, bulk update, export', async () => {\n      // Step 1: List all RSVPs\n      (rsvpManagementService.listRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: {\n          data: [\n            {\n              id: 'rsvp-1',\n              guestId: 'guest-1',\n              guestFirstName: 'John',\n              guestLastName: 'Doe',\n              guestEmail: 'john@example.com',\n              eventId: 'event-1',\n              eventName: 'Wedding Ceremony',\n              activityId: null,\n              activityName: null,\n              status: 'pending' as const,\n              guestCount: 2,\n              dietaryNotes: null,\n              specialRequirements: null,\n              notes: null,\n              respondedAt: null,\n              createdAt: '2024-01-10T10:00:00Z',\n              updatedAt: '2024-01-10T10:00:00Z',\n            },\n          ],\n          pagination: { page: 1, limit: 50, total: 1, totalPages: 1 },\n          statistics: {\n            totalRSVPs: 1,\n            byStatus: { attending: 0, declined: 0, maybe: 0, pending: 1 },\n            totalGuestCount: 2,\n          },\n        },\n      });\n\n      const listRequest = new Request('http://localhost:3000/api/admin/rsvps?status=pending');\n      const listResponse = await getRsvps(listRequest);\n      const listData = await listResponse.json();\n\n      expect(listResponse.status).toBe(200);\n      expect(listData.data.data).toHaveLength(1);\n      expect(listData.data.data[0].status).toBe('pending');\n\n      // Step 2: Bulk update RSVPs to attending\n      (rsvpManagementService.bulkUpdateRSVPs as jest.Mock).mockResolvedValue({\n        success: true,\n        data: { updatedCount: 1 },\n      });\n\n      const updateRequest = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: ['rsvp-1'],\n          status: 'attending',\n          notes: 'Confirmed attendance',\n        }),\n      });\n\n      const updateResponse = await bulkUpdateRsvps(updateRequest);\n      const updateData = await updateResponse.json();\n\n      expect(updateResponse.status).toBe(200);\n      expect(updateData.data.updatedCount).toBe(1);\n\n      // Step 3: Export updated RSVPs\n      (rsvpManagementService.exportRSVPsToCSV as jest.Mock).mockResolvedValue({\n        success: true,\n        data: 'RSVP ID,Guest First Name,Status\\nrsvp-1,John,attending',\n      });\n\n      const exportRequest = new Request(\n        'http://localhost:3000/api/admin/rsvps/export?status=attending'\n      );\n      const exportResponse = await exportRsvps(exportRequest);\n\n      expect(exportResponse.status).toBe(200);\n      expect(exportResponse.headers.get('Content-Type')).toBe('text/csv; charset=utf-8');\n\n      const csvContent = await exportResponse.text();\n      expect(csvContent).toContain('attending');\n    });\n  });\n\n  describe('Error Scenarios Across All Endpoints', () => {\n    it('should handle service throwing unexpected errors', async () => {\n      // Test GET endpoint\n      (rsvpManagementService.listRSVPs as jest.Mock).mockRejectedValue(\n        new Error('Unexpected error')\n      );\n\n      const getRequest = new Request('http://localhost:3000/api/admin/rsvps');\n      const getResponse = await getRsvps(getRequest);\n      const getData = await getResponse.json();\n\n      expect(getResponse.status).toBe(500);\n      expect(getData.error.code).toBe('INTERNAL_ERROR');\n\n      // Test PATCH endpoint\n      (rsvpManagementService.bulkUpdateRSVPs as jest.Mock).mockRejectedValue(\n        new Error('Unexpected error')\n      );\n\n      const patchRequest = new Request('http://localhost:3000/api/admin/rsvps/bulk', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          rsvpIds: ['11111111-1111-1111-1111-111111111111'],\n          status: 'attending',\n        }),\n      });\n\n      const patchResponse = await bulkUpdateRsvps(patchRequest);\n      const patchData = await patchResponse.json();\n\n      expect(patchResponse.status).toBe(500);\n      expect(patchData.error.code).toBe('INTERNAL_ERROR');\n\n      // Test export endpoint\n      (rsvpManagementService.exportRSVPsToCSV as jest.Mock).mockRejectedValue(\n        new Error('Unexpected error')\n      );\n\n      const exportRequest = new Request('http://localhost:3000/api/admin/rsvps/export');\n      const exportResponse = await exportRsvps(exportRequest);\n      const exportData = await exportResponse.json();\n\n      expect(exportResponse.status).toBe(500);\n      expect(exportData.error.code).toBe('INTERNAL_ERROR');\n    });\n  });\n});\n"],"names":["jest","mock","requireActual","withAuth","fn","rateLimitMiddleware","getRateLimitHeaders","describe","mockUserId","beforeEach","clearAllMocks","apiHelpers","mockImplementation","handler","rateLimit","mockReturnValue","success","data","allowed","limit","remaining","reset","Math","floor","Date","now","String","mockRsvpData","id","guestId","guestFirstName","guestLastName","guestEmail","eventId","eventName","activityId","activityName","status","guestCount","dietaryNotes","specialRequirements","notes","respondedAt","createdAt","updatedAt","pagination","page","total","totalPages","statistics","totalRSVPs","byStatus","attending","declined","maybe","pending","totalGuestCount","it","rsvpManagementService","listRSVPs","mockResolvedValue","request","Request","response","getRsvps","json","expect","toBe","toHaveLength","toHaveBeenCalledWith","filteredData","searchQuery","error","code","message","not","toHaveBeenCalled","Response","JSON","stringify","mockRsvpIds","bulkUpdateRSVPs","updatedCount","method","headers","body","rsvpIds","bulkUpdateRsvps","undefined","slice","tooManyIds","Array","from","length","_","i","padStart","mockCSV","exportRSVPsToCSV","exportRsvps","get","toMatch","csvContent","text","has","details","retryAfter","listRequest","listResponse","listData","updateRequest","updateResponse","updateData","exportRequest","exportResponse","toContain","mockRejectedValue","Error","getRequest","getResponse","getData","patchRequest","patchResponse","patchData","exportData"],"mappings":"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"}