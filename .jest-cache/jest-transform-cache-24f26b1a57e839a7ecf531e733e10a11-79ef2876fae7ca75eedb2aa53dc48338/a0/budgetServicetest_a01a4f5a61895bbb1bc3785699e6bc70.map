{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/budgetService.test.ts"],"sourcesContent":["import { describe, it, expect, jest, beforeEach } from '@jest/globals';\nimport type { BudgetCalculationDTO } from '@/schemas/budgetSchemas';\n\n// Set up environment variables BEFORE any imports\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\nprocess.env.SUPABASE_SERVICE_ROLE_KEY = 'test-service-role-key';\n\n// Mock Supabase before importing budgetService - Pattern A\njest.mock('@supabase/supabase-js', () => {\n  const mockFrom = jest.fn();\n  const mockSupabaseClient = {\n    from: mockFrom,\n  };\n  \n  return {\n    createClient: jest.fn(() => mockSupabaseClient),\n    __mockFrom: mockFrom, // Export for test access\n  };\n});\n\n// Import service using require() AFTER mocking\nconst budgetService = require('./budgetService');\n\n// Get the mocked from function\nconst { __mockFrom: mockFrom } = require('@supabase/supabase-js');\n\ndescribe('budgetService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // DO NOT use jest.resetModules() - it breaks the mock setup\n  });\n\n  describe('calculateTotal - validation logic', () => {\n    it('should return VALIDATION_ERROR when invalid vendor categories provided', async () => {\n      const invalidOptions = {\n        vendorCategories: ['invalid-category'],\n      } as any;\n\n      const result = await budgetService.calculateTotal(invalidOptions);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n        expect(result.error.message).toBe('Invalid calculation options');\n        expect(result.error.details).toBeDefined();\n      }\n    });\n\n    it('should accept valid vendor categories', async () => {\n      const validOptions: BudgetCalculationDTO = {\n        vendorCategories: ['photography', 'flowers'],\n        includeVendors: true,\n        includeActivities: false,\n        includeAccommodations: false,\n      };\n\n      // Mock successful vendor query with filtering\n      // Service calls: supabase.from('vendors').select('*').in('category', [...])\n      const mockIn = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n      });\n      const mockSelect = jest.fn().mockReturnValue({ in: mockIn });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await budgetService.calculateTotal(validOptions);\n\n      // Should pass validation and attempt database query\n      expect(mockFrom).toHaveBeenCalledWith('vendors');\n      expect(mockSelect).toHaveBeenCalledWith('*');\n      expect(mockIn).toHaveBeenCalledWith('category', ['photography', 'flowers']);\n    });\n\n    it('should use default options when none provided', async () => {\n      // Mock vendor query - service calls: supabase.from('vendors').select('*')\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n      });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await budgetService.calculateTotal();\n\n      // Should call vendor query since includeVendors defaults to true\n      expect(mockFrom).toHaveBeenCalledWith('vendors');\n      expect(mockSelect).toHaveBeenCalledWith('*');\n    });\n  });\n\n  describe('getPaymentStatusReport - vendor categorization logic', () => {\n    it('should correctly calculate payment totals for different vendor statuses', async () => {\n      const mockVendors = [\n        {\n          id: 'vendor-1',\n          name: 'Photographer',\n          category: 'photography',\n          base_cost: '2000.00',\n          amount_paid: '0.00',\n          payment_status: 'unpaid',\n        },\n        {\n          id: 'vendor-2',\n          name: 'Florist',\n          category: 'flowers',\n          base_cost: '800.00',\n          amount_paid: '400.00',\n          payment_status: 'partial',\n        },\n        {\n          id: 'vendor-3',\n          name: 'Caterer',\n          category: 'catering',\n          base_cost: '5000.00',\n          amount_paid: '5000.00',\n          payment_status: 'paid',\n        },\n      ];\n\n      // Mock vendor query - service calls: supabase.from('vendors').select('*').order('category').order('name')\n      const mockOrder2 = jest.fn().mockResolvedValue({\n        data: mockVendors,\n        error: null,\n      });\n      const mockOrder1 = jest.fn().mockReturnValue({\n        order: mockOrder2,\n      });\n      const mockSelect = jest.fn().mockReturnValue({\n        order: mockOrder1,\n      });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await budgetService.getPaymentStatusReport();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // Verify vendor categorization\n        expect(result.data.unpaidVendors).toHaveLength(1);\n        expect(result.data.partiallyPaidVendors).toHaveLength(1);\n        expect(result.data.paidVendors).toHaveLength(1);\n\n        // Verify total calculations\n        expect(result.data.totalUnpaid).toBe(2000);\n        expect(result.data.totalPartial).toBe(400); // balance due, not total cost\n        expect(result.data.totalPaid).toBe(5000);\n\n        // Verify vendor details\n        expect(result.data.unpaidVendors[0].name).toBe('Photographer');\n        expect(result.data.partiallyPaidVendors[0].balanceDue).toBe(400);\n        expect(result.data.paidVendors[0].amountPaid).toBe(5000);\n      }\n    });\n\n    it('should handle empty vendor list', async () => {\n      // Mock vendor query - service calls: supabase.from('vendors').select('*').order('category').order('name')\n      const mockOrder2 = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n      });\n      const mockOrder1 = jest.fn().mockReturnValue({\n        order: mockOrder2,\n      });\n      const mockSelect = jest.fn().mockReturnValue({\n        order: mockOrder1,\n      });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await budgetService.getPaymentStatusReport();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.unpaidVendors).toHaveLength(0);\n        expect(result.data.partiallyPaidVendors).toHaveLength(0);\n        expect(result.data.paidVendors).toHaveLength(0);\n        expect(result.data.totalUnpaid).toBe(0);\n        expect(result.data.totalPartial).toBe(0);\n        expect(result.data.totalPaid).toBe(0);\n      }\n    });\n  });\n\n  describe('trackSubsidies - subsidy calculation logic', () => {\n    it('should handle empty activity list', async () => {\n      // Mock activity query - service calls: supabase.from('activities').select(...).not('host_subsidy', 'is', null)\n      const mockNot = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n      });\n      const mockActivitySelect = jest.fn().mockReturnValue({ not: mockNot });\n      mockFrom.mockReturnValue({ select: mockActivitySelect });\n\n      const result = await budgetService.trackSubsidies();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.activitySubsidies).toHaveLength(0);\n        expect(result.data.totalActivitySubsidies).toBe(0);\n        expect(result.data.totalAccommodationSubsidies).toBe(0);\n        expect(result.data.grandTotalSubsidies).toBe(0);\n      }\n    });\n\n    it('should query activities with subsidies only', async () => {\n      // Mock activity query - service calls: supabase.from('activities').select(...).not('host_subsidy', 'is', null)\n      const mockNot = jest.fn().mockResolvedValue({\n        data: [],\n        error: null,\n      });\n      const mockActivitySelect = jest.fn().mockReturnValue({ not: mockNot });\n      mockFrom.mockReturnValue({ select: mockActivitySelect });\n\n      await budgetService.trackSubsidies();\n\n      // Verify it queries for activities with non-null host_subsidy\n      expect(mockFrom).toHaveBeenCalledWith('activities');\n      expect(mockActivitySelect).toHaveBeenCalledWith('id, name, host_subsidy');\n      expect(mockNot).toHaveBeenCalledWith('host_subsidy', 'is', null);\n    });\n  });\n\n  describe('generateReport - comprehensive report structure', () => {\n    it('should return complete budget breakdown structure', async () => {\n      // generateReport calls calculateTotal with all options enabled\n      // Mock vendor query - service calls: supabase.from('vendors').select('*')\n      const mockVendorSelect = jest.fn().mockResolvedValue({ data: [], error: null });\n      \n      // Mock activity query - service calls: supabase.from('activities').select(...).not('cost_per_person', 'is', null)\n      const mockActivityNot = jest.fn().mockResolvedValue({ data: [], error: null });\n      const mockActivitySelect = jest.fn().mockReturnValue({\n        not: mockActivityNot,\n      });\n\n      // Use mockReturnValueOnce for sequential calls\n      mockFrom\n        .mockReturnValueOnce({ select: mockVendorSelect })\n        .mockReturnValueOnce({ select: mockActivitySelect });\n\n      const result = await budgetService.generateReport();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // Verify structure\n        expect(result.data).toHaveProperty('vendors');\n        expect(result.data).toHaveProperty('activities');\n        expect(result.data).toHaveProperty('accommodations');\n        expect(result.data).toHaveProperty('totals');\n\n        // Verify totals structure\n        expect(result.data.totals).toHaveProperty('grossTotal');\n        expect(result.data.totals).toHaveProperty('totalSubsidies');\n        expect(result.data.totals).toHaveProperty('totalPaid');\n        expect(result.data.totals).toHaveProperty('netTotal');\n        expect(result.data.totals).toHaveProperty('balanceDue');\n\n        // Verify activities structure\n        expect(result.data.activities).toHaveProperty('totalCost');\n        expect(result.data.activities).toHaveProperty('totalSubsidy');\n        expect(result.data.activities).toHaveProperty('netCost');\n        expect(result.data.activities).toHaveProperty('activities');\n\n        // Verify accommodations structure (placeholder)\n        expect(result.data.accommodations).toHaveProperty('totalCost');\n        expect(result.data.accommodations).toHaveProperty('totalSubsidy');\n        expect(result.data.accommodations).toHaveProperty('netCost');\n        expect(result.data.accommodations).toHaveProperty('accommodations');\n      }\n    });\n  });\n\n  describe('error handling', () => {\n    it('should return DATABASE_ERROR when query fails', async () => {\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Connection failed', code: 'CONNECTION_ERROR' },\n      });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toBe('Connection failed');\n      }\n    });\n\n    it('should return UNKNOWN_ERROR when unexpected error occurs', async () => {\n      // Mock an unexpected error by making mockFrom throw\n      mockFrom.mockImplementation(() => {\n        throw new Error('Unexpected error');\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('UNKNOWN_ERROR');\n        expect(result.error.message).toBe('Unexpected error');\n      }\n    });\n\n    it('should handle non-Error exceptions gracefully', async () => {\n      // Mock a non-Error exception\n      mockFrom.mockImplementation(() => {\n        throw 'String error';\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('UNKNOWN_ERROR');\n        expect(result.error.message).toBe('Unknown error occurred');\n      }\n    });\n  });\n});"],"names":["process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","jest","mock","mockFrom","fn","mockSupabaseClient","from","createClient","__mockFrom","budgetService","require","describe","beforeEach","clearAllMocks","it","invalidOptions","vendorCategories","result","calculateTotal","expect","success","toBe","error","code","message","details","toBeDefined","validOptions","includeVendors","includeActivities","includeAccommodations","mockIn","mockResolvedValue","data","mockSelect","mockReturnValue","in","select","toHaveBeenCalledWith","mockVendors","id","name","category","base_cost","amount_paid","payment_status","mockOrder2","mockOrder1","order","getPaymentStatusReport","unpaidVendors","toHaveLength","partiallyPaidVendors","paidVendors","totalUnpaid","totalPartial","totalPaid","balanceDue","amountPaid","mockNot","mockActivitySelect","not","trackSubsidies","activitySubsidies","totalActivitySubsidies","totalAccommodationSubsidies","grandTotalSubsidies","mockVendorSelect","mockActivityNot","mockReturnValueOnce","generateReport","toHaveProperty","totals","activities","accommodations","mockImplementation","Error"],"mappings":";;;;yBAAuD;AAGvD,kDAAkD;AAClDA,QAAQC,GAAG,CAACC,wBAAwB,GAAG;AACvCF,QAAQC,GAAG,CAACE,yBAAyB,GAAG;AAExC,2DAA2D;AAC3DC,aAAI,CAACC,IAAI,CAAC,yBAAyB;IACjC,MAAMC,WAAWF,aAAI,CAACG,EAAE;IACxB,MAAMC,qBAAqB;QACzBC,MAAMH;IACR;IAEA,OAAO;QACLI,cAAcN,aAAI,CAACG,EAAE,CAAC,IAAMC;QAC5BG,YAAYL;IACd;AACF;AAEA,+CAA+C;AAC/C,MAAMM,gBAAgBC,QAAQ;AAE9B,+BAA+B;AAC/B,MAAM,EAAEF,YAAYL,QAAQ,EAAE,GAAGO,QAAQ;AAEzCC,IAAAA,iBAAQ,EAAC,iBAAiB;IACxBC,IAAAA,mBAAU,EAAC;QACTX,aAAI,CAACY,aAAa;IAClB,4DAA4D;IAC9D;IAEAF,IAAAA,iBAAQ,EAAC,qCAAqC;QAC5CG,IAAAA,WAAE,EAAC,0EAA0E;YAC3E,MAAMC,iBAAiB;gBACrBC,kBAAkB;oBAAC;iBAAmB;YACxC;YAEA,MAAMC,SAAS,MAAMR,cAAcS,cAAc,CAACH;YAElDI,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACC,IAAI,EAAEF,IAAI,CAAC;gBAC/BF,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACE,OAAO,EAAEH,IAAI,CAAC;gBAClCF,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACG,OAAO,EAAEC,WAAW;YAC1C;QACF;QAEAZ,IAAAA,WAAE,EAAC,yCAAyC;YAC1C,MAAMa,eAAqC;gBACzCX,kBAAkB;oBAAC;oBAAe;iBAAU;gBAC5CY,gBAAgB;gBAChBC,mBAAmB;gBACnBC,uBAAuB;YACzB;YAEA,8CAA8C;YAC9C,4EAA4E;YAC5E,MAAMC,SAAS9B,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBACzCC,MAAM,EAAE;gBACRX,OAAO;YACT;YACA,MAAMY,aAAajC,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBAAEC,IAAIL;YAAO;YAC1D5B,SAASgC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMjB,SAAS,MAAMR,cAAcS,cAAc,CAACS;YAElD,oDAAoD;YACpDR,IAAAA,eAAM,EAAChB,UAAUmC,oBAAoB,CAAC;YACtCnB,IAAAA,eAAM,EAACe,YAAYI,oBAAoB,CAAC;YACxCnB,IAAAA,eAAM,EAACY,QAAQO,oBAAoB,CAAC,YAAY;gBAAC;gBAAe;aAAU;QAC5E;QAEAxB,IAAAA,WAAE,EAAC,iDAAiD;YAClD,0EAA0E;YAC1E,MAAMoB,aAAajC,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAC7CC,MAAM,EAAE;gBACRX,OAAO;YACT;YACAnB,SAASgC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMjB,SAAS,MAAMR,cAAcS,cAAc;YAEjD,iEAAiE;YACjEC,IAAAA,eAAM,EAAChB,UAAUmC,oBAAoB,CAAC;YACtCnB,IAAAA,eAAM,EAACe,YAAYI,oBAAoB,CAAC;QAC1C;IACF;IAEA3B,IAAAA,iBAAQ,EAAC,wDAAwD;QAC/DG,IAAAA,WAAE,EAAC,2EAA2E;YAC5E,MAAMyB,cAAc;gBAClB;oBACEC,IAAI;oBACJC,MAAM;oBACNC,UAAU;oBACVC,WAAW;oBACXC,aAAa;oBACbC,gBAAgB;gBAClB;gBACA;oBACEL,IAAI;oBACJC,MAAM;oBACNC,UAAU;oBACVC,WAAW;oBACXC,aAAa;oBACbC,gBAAgB;gBAClB;gBACA;oBACEL,IAAI;oBACJC,MAAM;oBACNC,UAAU;oBACVC,WAAW;oBACXC,aAAa;oBACbC,gBAAgB;gBAClB;aACD;YAED,0GAA0G;YAC1G,MAAMC,aAAa7C,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAC7CC,MAAMM;gBACNjB,OAAO;YACT;YACA,MAAMyB,aAAa9C,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBAC3Ca,OAAOF;YACT;YACA,MAAMZ,aAAajC,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBAC3Ca,OAAOD;YACT;YACA5C,SAASgC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMjB,SAAS,MAAMR,cAAcwC,sBAAsB;YAEzD9B,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClB,+BAA+B;gBAC/BD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACiB,aAAa,EAAEC,YAAY,CAAC;gBAC/ChC,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACmB,oBAAoB,EAAED,YAAY,CAAC;gBACtDhC,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACoB,WAAW,EAAEF,YAAY,CAAC;gBAE7C,4BAA4B;gBAC5BhC,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACqB,WAAW,EAAEjC,IAAI,CAAC;gBACrCF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACsB,YAAY,EAAElC,IAAI,CAAC,MAAM,8BAA8B;gBAC1EF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACuB,SAAS,EAAEnC,IAAI,CAAC;gBAEnC,wBAAwB;gBACxBF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACiB,aAAa,CAAC,EAAE,CAACT,IAAI,EAAEpB,IAAI,CAAC;gBAC/CF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACmB,oBAAoB,CAAC,EAAE,CAACK,UAAU,EAAEpC,IAAI,CAAC;gBAC5DF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACoB,WAAW,CAAC,EAAE,CAACK,UAAU,EAAErC,IAAI,CAAC;YACrD;QACF;QAEAP,IAAAA,WAAE,EAAC,mCAAmC;YACpC,0GAA0G;YAC1G,MAAMgC,aAAa7C,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAC7CC,MAAM,EAAE;gBACRX,OAAO;YACT;YACA,MAAMyB,aAAa9C,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBAC3Ca,OAAOF;YACT;YACA,MAAMZ,aAAajC,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBAC3Ca,OAAOD;YACT;YACA5C,SAASgC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMjB,SAAS,MAAMR,cAAcwC,sBAAsB;YAEzD9B,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACiB,aAAa,EAAEC,YAAY,CAAC;gBAC/ChC,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACmB,oBAAoB,EAAED,YAAY,CAAC;gBACtDhC,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACoB,WAAW,EAAEF,YAAY,CAAC;gBAC7ChC,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACqB,WAAW,EAAEjC,IAAI,CAAC;gBACrCF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACsB,YAAY,EAAElC,IAAI,CAAC;gBACtCF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACuB,SAAS,EAAEnC,IAAI,CAAC;YACrC;QACF;IACF;IAEAV,IAAAA,iBAAQ,EAAC,8CAA8C;QACrDG,IAAAA,WAAE,EAAC,qCAAqC;YACtC,+GAA+G;YAC/G,MAAM6C,UAAU1D,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAC1CC,MAAM,EAAE;gBACRX,OAAO;YACT;YACA,MAAMsC,qBAAqB3D,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBAAE0B,KAAKF;YAAQ;YACpExD,SAASgC,eAAe,CAAC;gBAAEE,QAAQuB;YAAmB;YAEtD,MAAM3C,SAAS,MAAMR,cAAcqD,cAAc;YAEjD3C,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClBD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAAC8B,iBAAiB,EAAEZ,YAAY,CAAC;gBACnDhC,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAAC+B,sBAAsB,EAAE3C,IAAI,CAAC;gBAChDF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACgC,2BAA2B,EAAE5C,IAAI,CAAC;gBACrDF,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACiC,mBAAmB,EAAE7C,IAAI,CAAC;YAC/C;QACF;QAEAP,IAAAA,WAAE,EAAC,+CAA+C;YAChD,+GAA+G;YAC/G,MAAM6C,UAAU1D,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAC1CC,MAAM,EAAE;gBACRX,OAAO;YACT;YACA,MAAMsC,qBAAqB3D,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBAAE0B,KAAKF;YAAQ;YACpExD,SAASgC,eAAe,CAAC;gBAAEE,QAAQuB;YAAmB;YAEtD,MAAMnD,cAAcqD,cAAc;YAElC,8DAA8D;YAC9D3C,IAAAA,eAAM,EAAChB,UAAUmC,oBAAoB,CAAC;YACtCnB,IAAAA,eAAM,EAACyC,oBAAoBtB,oBAAoB,CAAC;YAChDnB,IAAAA,eAAM,EAACwC,SAASrB,oBAAoB,CAAC,gBAAgB,MAAM;QAC7D;IACF;IAEA3B,IAAAA,iBAAQ,EAAC,mDAAmD;QAC1DG,IAAAA,WAAE,EAAC,qDAAqD;YACtD,+DAA+D;YAC/D,0EAA0E;YAC1E,MAAMqD,mBAAmBlE,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAAEC,MAAM,EAAE;gBAAEX,OAAO;YAAK;YAE7E,kHAAkH;YAClH,MAAM8C,kBAAkBnE,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAAEC,MAAM,EAAE;gBAAEX,OAAO;YAAK;YAC5E,MAAMsC,qBAAqB3D,aAAI,CAACG,EAAE,GAAG+B,eAAe,CAAC;gBACnD0B,KAAKO;YACP;YAEA,+CAA+C;YAC/CjE,SACGkE,mBAAmB,CAAC;gBAAEhC,QAAQ8B;YAAiB,GAC/CE,mBAAmB,CAAC;gBAAEhC,QAAQuB;YAAmB;YAEpD,MAAM3C,SAAS,MAAMR,cAAc6D,cAAc;YAEjDnD,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAIJ,OAAOG,OAAO,EAAE;gBAClB,mBAAmB;gBACnBD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,EAAEsC,cAAc,CAAC;gBACnCpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,EAAEsC,cAAc,CAAC;gBACnCpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,EAAEsC,cAAc,CAAC;gBACnCpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,EAAEsC,cAAc,CAAC;gBAEnC,0BAA0B;gBAC1BpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACuC,MAAM,EAAED,cAAc,CAAC;gBAC1CpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACuC,MAAM,EAAED,cAAc,CAAC;gBAC1CpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACuC,MAAM,EAAED,cAAc,CAAC;gBAC1CpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACuC,MAAM,EAAED,cAAc,CAAC;gBAC1CpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACuC,MAAM,EAAED,cAAc,CAAC;gBAE1C,8BAA8B;gBAC9BpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACwC,UAAU,EAAEF,cAAc,CAAC;gBAC9CpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACwC,UAAU,EAAEF,cAAc,CAAC;gBAC9CpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACwC,UAAU,EAAEF,cAAc,CAAC;gBAC9CpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACwC,UAAU,EAAEF,cAAc,CAAC;gBAE9C,gDAAgD;gBAChDpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACyC,cAAc,EAAEH,cAAc,CAAC;gBAClDpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACyC,cAAc,EAAEH,cAAc,CAAC;gBAClDpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACyC,cAAc,EAAEH,cAAc,CAAC;gBAClDpD,IAAAA,eAAM,EAACF,OAAOgB,IAAI,CAACyC,cAAc,EAAEH,cAAc,CAAC;YACpD;QACF;IACF;IAEA5D,IAAAA,iBAAQ,EAAC,kBAAkB;QACzBG,IAAAA,WAAE,EAAC,iDAAiD;YAClD,MAAMoB,aAAajC,aAAI,CAACG,EAAE,GAAG4B,iBAAiB,CAAC;gBAC7CC,MAAM;gBACNX,OAAO;oBAAEE,SAAS;oBAAqBD,MAAM;gBAAmB;YAClE;YACApB,SAASgC,eAAe,CAAC;gBAAEE,QAAQH;YAAW;YAE9C,MAAMjB,SAAS,MAAMR,cAAcS,cAAc;YAEjDC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACC,IAAI,EAAEF,IAAI,CAAC;gBAC/BF,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACE,OAAO,EAAEH,IAAI,CAAC;YACpC;QACF;QAEAP,IAAAA,WAAE,EAAC,4DAA4D;YAC7D,oDAAoD;YACpDX,SAASwE,kBAAkB,CAAC;gBAC1B,MAAM,IAAIC,MAAM;YAClB;YAEA,MAAM3D,SAAS,MAAMR,cAAcS,cAAc;YAEjDC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACC,IAAI,EAAEF,IAAI,CAAC;gBAC/BF,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACE,OAAO,EAAEH,IAAI,CAAC;YACpC;QACF;QAEAP,IAAAA,WAAE,EAAC,iDAAiD;YAClD,6BAA6B;YAC7BX,SAASwE,kBAAkB,CAAC;gBAC1B,MAAM;YACR;YAEA,MAAM1D,SAAS,MAAMR,cAAcS,cAAc;YAEjDC,IAAAA,eAAM,EAACF,OAAOG,OAAO,EAAEC,IAAI,CAAC;YAC5B,IAAI,CAACJ,OAAOG,OAAO,EAAE;gBACnBD,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACC,IAAI,EAAEF,IAAI,CAAC;gBAC/BF,IAAAA,eAAM,EAACF,OAAOK,KAAK,CAACE,OAAO,EAAEH,IAAI,CAAC;YACpC;QACF;IACF;AACF"}