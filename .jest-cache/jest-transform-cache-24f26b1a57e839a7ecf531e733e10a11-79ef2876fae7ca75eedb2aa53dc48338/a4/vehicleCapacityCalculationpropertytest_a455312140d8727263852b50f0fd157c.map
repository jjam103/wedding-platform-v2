{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/vehicleCapacityCalculation.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { calculateVehicleRequirements } from './transportationService';\n\n/**\n * Feature: destination-wedding-platform, Property 29: Vehicle Capacity Calculation\n * \n * For any transportation manifest with assigned guests, the total guest count\n * should not exceed the combined capacity of assigned vehicles.\n * \n * Validates: Requirements 20.2\n */\ndescribe('Feature: destination-wedding-platform, Property 29: Vehicle Capacity Calculation', () => {\n  it('should calculate vehicle requirements that meet or exceed guest count', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Generate guest count from 0 to 200\n        fc.integer({ min: 0, max: 200 }),\n        async (guestCount) => {\n          const result = await calculateVehicleRequirements(guestCount);\n\n          // Property: Result should be successful\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            // Property: Total vehicle capacity should meet or exceed guest count\n            const totalCapacity = result.data.reduce(\n              (sum, req) => sum + (req.capacity * req.quantity_needed),\n              0\n            );\n\n            expect(totalCapacity).toBeGreaterThanOrEqual(guestCount);\n\n            // Property: Each vehicle requirement should have positive values\n            for (const req of result.data) {\n              expect(req.capacity).toBeGreaterThan(0);\n              expect(req.quantity_needed).toBeGreaterThan(0);\n              expect(req.estimated_cost).toBeGreaterThanOrEqual(0);\n            }\n\n            // Property: Vehicle types should be valid\n            const validTypes = ['sedan', 'van', 'minibus', 'bus'];\n            for (const req of result.data) {\n              expect(validTypes).toContain(req.vehicle_type);\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should return empty array for zero guests', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.constant(0),\n        async (guestCount) => {\n          const result = await calculateVehicleRequirements(guestCount);\n\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            // Property: Zero guests should require no vehicles or minimal vehicles\n            const totalVehicles = result.data.reduce(\n              (sum, req) => sum + req.quantity_needed,\n              0\n            );\n            expect(totalVehicles).toBeGreaterThanOrEqual(0);\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should reject negative guest counts', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.integer({ min: -100, max: -1 }),\n        async (guestCount) => {\n          const result = await calculateVehicleRequirements(guestCount);\n\n          // Property: Negative guest counts should return validation error\n          expect(result.success).toBe(false);\n\n          if (!result.success) {\n            expect(result.error.code).toBe('VALIDATION_ERROR');\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should optimize vehicle allocation efficiently', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.integer({ min: 1, max: 150 }),\n        async (guestCount) => {\n          const result = await calculateVehicleRequirements(guestCount);\n\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            // Property: Should not over-allocate by more than one vehicle's capacity\n            const totalCapacity = result.data.reduce(\n              (sum, req) => sum + (req.capacity * req.quantity_needed),\n              0\n            );\n\n            // Find the smallest vehicle capacity used\n            const smallestCapacity = result.data.length > 0\n              ? Math.min(...result.data.map(req => req.capacity))\n              : 4; // Default sedan capacity\n\n            // Over-allocation should be less than smallest vehicle capacity\n            const overAllocation = totalCapacity - guestCount;\n            expect(overAllocation).toBeLessThan(smallestCapacity);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should calculate costs proportional to vehicle quantity', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.integer({ min: 1, max: 100 }),\n        async (guestCount) => {\n          const result = await calculateVehicleRequirements(guestCount);\n\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            // Property: Cost should be proportional to quantity\n            for (const req of result.data) {\n              // Cost per vehicle\n              const costPerVehicle = req.estimated_cost / req.quantity_needed;\n              \n              // Should be a positive number\n              expect(costPerVehicle).toBeGreaterThan(0);\n              \n              // Should be consistent (no fractional cents)\n              expect(req.estimated_cost % req.quantity_needed).toBe(0);\n            }\n\n            // Property: Total cost should increase with guest count\n            const totalCost = result.data.reduce(\n              (sum, req) => sum + req.estimated_cost,\n              0\n            );\n            expect(totalCost).toBeGreaterThan(0);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle edge case guest counts efficiently', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Test exact vehicle capacity boundaries\n        fc.constantFrom(4, 8, 15, 50, 5, 9, 16, 51),\n        async (guestCount) => {\n          const result = await calculateVehicleRequirements(guestCount);\n\n          expect(result.success).toBe(true);\n\n          if (result.success) {\n            const totalCapacity = result.data.reduce(\n              (sum, req) => sum + (req.capacity * req.quantity_needed),\n              0\n            );\n\n            // Property: Should meet capacity exactly or with minimal excess\n            expect(totalCapacity).toBeGreaterThanOrEqual(guestCount);\n            \n            // Property: Should not waste more than one vehicle worth of capacity\n            const wastedCapacity = totalCapacity - guestCount;\n            expect(wastedCapacity).toBeLessThan(50); // Max vehicle capacity\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain consistency across multiple calls with same input', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.integer({ min: 1, max: 100 }),\n        async (guestCount) => {\n          // Call twice with same input\n          const result1 = await calculateVehicleRequirements(guestCount);\n          const result2 = await calculateVehicleRequirements(guestCount);\n\n          expect(result1.success).toBe(true);\n          expect(result2.success).toBe(true);\n\n          if (result1.success && result2.success) {\n            // Property: Results should be identical (deterministic)\n            expect(result1.data).toEqual(result2.data);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should prefer larger vehicles for efficiency', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Test with guest counts that could use multiple vehicle types\n        fc.integer({ min: 20, max: 100 }),\n        async (guestCount) => {\n          const result = await calculateVehicleRequirements(guestCount);\n\n          expect(result.success).toBe(true);\n\n          if (result.success && result.data.length > 0) {\n            // Property: Should use larger vehicles when possible\n            // Sort by capacity descending\n            const sortedReqs = [...result.data].sort((a, b) => b.capacity - a.capacity);\n            \n            // If using multiple vehicle types, larger vehicles should be allocated first\n            if (sortedReqs.length > 1) {\n              // The largest vehicle type should have the most quantity or be used\n              const largestVehicle = sortedReqs[0];\n              expect(largestVehicle.quantity_needed).toBeGreaterThan(0);\n            }\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n});\n"],"names":["describe","it","fc","assert","asyncProperty","integer","min","max","guestCount","result","calculateVehicleRequirements","expect","success","toBe","totalCapacity","data","reduce","sum","req","capacity","quantity_needed","toBeGreaterThanOrEqual","toBeGreaterThan","estimated_cost","validTypes","toContain","vehicle_type","numRuns","constant","totalVehicles","error","code","smallestCapacity","length","Math","map","overAllocation","toBeLessThan","costPerVehicle","totalCost","constantFrom","wastedCapacity","result1","result2","toEqual","sortedReqs","sort","a","b","largestVehicle"],"mappings":"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"}