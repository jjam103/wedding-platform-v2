{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/guests/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport * as guestService from '@/services/guestService';\nimport { createAuthenticatedClient, createServiceRoleClient } from '@/lib/supabaseServer';\n\n/**\n * GET /api/admin/guests\n * \n * Fetches all guests with optional filtering.\n * Requires authentication.\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. Auth check\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. Parse query parameters for filtering\n    const { searchParams } = new URL(request.url);\n    const groupId = searchParams.get('groupId') || undefined;\n    const ageType = (searchParams.get('ageType') as 'adult' | 'child' | 'senior' | null) || undefined;\n    const guestType = searchParams.get('guestType') || undefined;\n    const page = parseInt(searchParams.get('page') || '1');\n    const pageSize = parseInt(searchParams.get('pageSize') || '50');\n\n    // 3. Call service\n    const result = await guestService.list({\n      groupId,\n      ageType,\n      guestType,\n      page,\n      pageSize,\n    });\n\n    // 4. Return response\n    if (!result.success) {\n      console.error('[API /api/admin/guests GET] Service error:', result.error);\n    }\n    return NextResponse.json(result, { status: result.success ? 200 : 500 });\n  } catch (error) {\n    console.error('[API /api/admin/guests GET] Unexpected error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'INTERNAL_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/admin/guests\n * \n * Creates a new guest.\n * Requires authentication.\n */\nexport async function POST(request: Request) {\n  try {\n    // 1. Auth check\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. Parse and validate request body\n    const body = await request.json();\n\n    // 3. Call service\n    const result = await guestService.create(body);\n\n    // 4. Return response with proper status\n    if (result.success) {\n      return NextResponse.json(result, { status: 201 });\n    } else {\n      const statusCode = result.error.code === 'VALIDATION_ERROR' ? 400 : 500;\n      return NextResponse.json(result, { status: statusCode });\n    }\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'INTERNAL_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","POST","request","supabase","createAuthenticatedClient","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","searchParams","URL","url","groupId","get","undefined","ageType","guestType","page","parseInt","pageSize","result","guestService","list","console","Error","body","create","statusCode"],"mappings":"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"}