{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/lib/supabase.test.ts"],"sourcesContent":["/**\n * Unit tests for Supabase client initialization\n * \n * Tests client creation and configuration validation.\n */\n\nimport { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';\n\n// Mock @supabase/supabase-js\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(),\n}));\n\ndescribe('supabase', () => {\n  let originalEnv: NodeJS.ProcessEnv;\n\n  beforeEach(() => {\n    // Save original environment\n    originalEnv = { ...process.env };\n    \n    // Set required environment variables\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';\n    \n    // Clear module cache to get fresh imports\n    jest.resetModules();\n  });\n\n  afterEach(() => {\n    // Restore original environment\n    process.env = originalEnv;\n  });\n\n  describe('createSupabaseClient', () => {\n    it('should create Supabase client with environment variables', () => {\n      const { createClient } = require('@supabase/supabase-js');\n      const { createSupabaseClient } = require('./supabase');\n      \n      createSupabaseClient();\n      \n      expect(createClient).toHaveBeenCalledWith(\n        'https://test.supabase.co',\n        'test-anon-key'\n      );\n    });\n\n    it('should throw error when NEXT_PUBLIC_SUPABASE_URL is missing', () => {\n      delete process.env.NEXT_PUBLIC_SUPABASE_URL;\n      \n      // Re-import to get fresh module with new env\n      jest.resetModules();\n      \n      expect(() => {\n        const { createSupabaseClient } = require('./supabase');\n        createSupabaseClient();\n      }).toThrow('Missing Supabase environment variables');\n    });\n\n    it('should throw error when NEXT_PUBLIC_SUPABASE_ANON_KEY is missing', () => {\n      delete process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n      \n      // Re-import to get fresh module with new env\n      jest.resetModules();\n      \n      expect(() => {\n        const { createSupabaseClient } = require('./supabase');\n        createSupabaseClient();\n      }).toThrow('Missing Supabase environment variables');\n    });\n\n    it('should throw error when both environment variables are missing', () => {\n      delete process.env.NEXT_PUBLIC_SUPABASE_URL;\n      delete process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n      \n      // Re-import to get fresh module with new env\n      jest.resetModules();\n      \n      expect(() => {\n        const { createSupabaseClient } = require('./supabase');\n        createSupabaseClient();\n      }).toThrow('Missing Supabase environment variables');\n    });\n\n    it('should return Supabase client instance', () => {\n      const mockClient = { from: jest.fn(), auth: {} };\n      const { createClient } = require('@supabase/supabase-js');\n      (createClient as jest.Mock).mockReturnValue(mockClient);\n      \n      const { createSupabaseClient } = require('./supabase');\n      const client = createSupabaseClient();\n      \n      expect(client).toBe(mockClient);\n    });\n  });\n\n  describe('supabase singleton', () => {\n    it('should export singleton Supabase client', () => {\n      const mockClient = { from: jest.fn(), auth: {} };\n      const { createClient } = require('@supabase/supabase-js');\n      (createClient as jest.Mock).mockReturnValue(mockClient);\n      \n      const { supabase } = require('./supabase');\n      \n      expect(supabase).toBeDefined();\n      expect(supabase).toBe(mockClient);\n    });\n\n    it('should create client only once for singleton', () => {\n      const { createClient } = require('@supabase/supabase-js');\n      (createClient as jest.Mock).mockClear();\n      \n      // Import module which creates singleton\n      const { supabase } = require('./supabase');\n      \n      // Access singleton multiple times\n      const client1 = supabase;\n      const client2 = supabase;\n      \n      // createClient should only be called once during module initialization\n      expect(client1).toBe(client2);\n    });\n  });\n\n  describe('environment variable validation', () => {\n    it('should accept valid Supabase URL format', () => {\n      process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://abc123.supabase.co';\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'valid-key';\n      \n      jest.resetModules();\n      \n      expect(() => {\n        const { createSupabaseClient } = require('./supabase');\n        createSupabaseClient();\n      }).not.toThrow();\n    });\n\n    it('should accept valid anon key format', () => {\n      process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test';\n      \n      jest.resetModules();\n      \n      expect(() => {\n        const { createSupabaseClient } = require('./supabase');\n        createSupabaseClient();\n      }).not.toThrow();\n    });\n\n    it('should handle empty string environment variables as missing', () => {\n      process.env.NEXT_PUBLIC_SUPABASE_URL = '';\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = '';\n      \n      jest.resetModules();\n      \n      expect(() => {\n        const { createSupabaseClient } = require('./supabase');\n        createSupabaseClient();\n      }).toThrow('Missing Supabase environment variables');\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","describe","originalEnv","beforeEach","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","resetModules","afterEach","it","require","createSupabaseClient","expect","toHaveBeenCalledWith","toThrow","mockClient","from","auth","mockReturnValue","client","toBe","supabase","toBeDefined","mockClear","client1","client2","not"],"mappings":"AAAA;;;;CAIC;;;;yBAEiE;AAElE,6BAA6B;AAC7BA,aAAI,CAACC,IAAI,CAAC,yBAAyB,IAAO,CAAA;QACxCC,cAAcF,aAAI,CAACG,EAAE;IACvB,CAAA;AAEAC,IAAAA,iBAAQ,EAAC,YAAY;IACnB,IAAIC;IAEJC,IAAAA,mBAAU,EAAC;QACT,4BAA4B;QAC5BD,cAAc;YAAE,GAAGE,QAAQC,GAAG;QAAC;QAE/B,qCAAqC;QACrCD,QAAQC,GAAG,CAACC,wBAAwB,GAAG;QACvCF,QAAQC,GAAG,CAACE,6BAA6B,GAAG;QAE5C,0CAA0C;QAC1CV,aAAI,CAACW,YAAY;IACnB;IAEAC,IAAAA,kBAAS,EAAC;QACR,+BAA+B;QAC/BL,QAAQC,GAAG,GAAGH;IAChB;IAEAD,IAAAA,iBAAQ,EAAC,wBAAwB;QAC/BS,IAAAA,WAAE,EAAC,4DAA4D;YAC7D,MAAM,EAAEX,YAAY,EAAE,GAAGY,QAAQ;YACjC,MAAM,EAAEC,oBAAoB,EAAE,GAAGD,QAAQ;YAEzCC;YAEAC,IAAAA,eAAM,EAACd,cAAce,oBAAoB,CACvC,4BACA;QAEJ;QAEAJ,IAAAA,WAAE,EAAC,+DAA+D;YAChE,OAAON,QAAQC,GAAG,CAACC,wBAAwB;YAE3C,6CAA6C;YAC7CT,aAAI,CAACW,YAAY;YAEjBK,IAAAA,eAAM,EAAC;gBACL,MAAM,EAAED,oBAAoB,EAAE,GAAGD,QAAQ;gBACzCC;YACF,GAAGG,OAAO,CAAC;QACb;QAEAL,IAAAA,WAAE,EAAC,oEAAoE;YACrE,OAAON,QAAQC,GAAG,CAACE,6BAA6B;YAEhD,6CAA6C;YAC7CV,aAAI,CAACW,YAAY;YAEjBK,IAAAA,eAAM,EAAC;gBACL,MAAM,EAAED,oBAAoB,EAAE,GAAGD,QAAQ;gBACzCC;YACF,GAAGG,OAAO,CAAC;QACb;QAEAL,IAAAA,WAAE,EAAC,kEAAkE;YACnE,OAAON,QAAQC,GAAG,CAACC,wBAAwB;YAC3C,OAAOF,QAAQC,GAAG,CAACE,6BAA6B;YAEhD,6CAA6C;YAC7CV,aAAI,CAACW,YAAY;YAEjBK,IAAAA,eAAM,EAAC;gBACL,MAAM,EAAED,oBAAoB,EAAE,GAAGD,QAAQ;gBACzCC;YACF,GAAGG,OAAO,CAAC;QACb;QAEAL,IAAAA,WAAE,EAAC,0CAA0C;YAC3C,MAAMM,aAAa;gBAAEC,MAAMpB,aAAI,CAACG,EAAE;gBAAIkB,MAAM,CAAC;YAAE;YAC/C,MAAM,EAAEnB,YAAY,EAAE,GAAGY,QAAQ;YAChCZ,aAA2BoB,eAAe,CAACH;YAE5C,MAAM,EAAEJ,oBAAoB,EAAE,GAAGD,QAAQ;YACzC,MAAMS,SAASR;YAEfC,IAAAA,eAAM,EAACO,QAAQC,IAAI,CAACL;QACtB;IACF;IAEAf,IAAAA,iBAAQ,EAAC,sBAAsB;QAC7BS,IAAAA,WAAE,EAAC,2CAA2C;YAC5C,MAAMM,aAAa;gBAAEC,MAAMpB,aAAI,CAACG,EAAE;gBAAIkB,MAAM,CAAC;YAAE;YAC/C,MAAM,EAAEnB,YAAY,EAAE,GAAGY,QAAQ;YAChCZ,aAA2BoB,eAAe,CAACH;YAE5C,MAAM,EAAEM,QAAQ,EAAE,GAAGX,QAAQ;YAE7BE,IAAAA,eAAM,EAACS,UAAUC,WAAW;YAC5BV,IAAAA,eAAM,EAACS,UAAUD,IAAI,CAACL;QACxB;QAEAN,IAAAA,WAAE,EAAC,gDAAgD;YACjD,MAAM,EAAEX,YAAY,EAAE,GAAGY,QAAQ;YAChCZ,aAA2ByB,SAAS;YAErC,wCAAwC;YACxC,MAAM,EAAEF,QAAQ,EAAE,GAAGX,QAAQ;YAE7B,kCAAkC;YAClC,MAAMc,UAAUH;YAChB,MAAMI,UAAUJ;YAEhB,uEAAuE;YACvET,IAAAA,eAAM,EAACY,SAASJ,IAAI,CAACK;QACvB;IACF;IAEAzB,IAAAA,iBAAQ,EAAC,mCAAmC;QAC1CS,IAAAA,WAAE,EAAC,2CAA2C;YAC5CN,QAAQC,GAAG,CAACC,wBAAwB,GAAG;YACvCF,QAAQC,GAAG,CAACE,6BAA6B,GAAG;YAE5CV,aAAI,CAACW,YAAY;YAEjBK,IAAAA,eAAM,EAAC;gBACL,MAAM,EAAED,oBAAoB,EAAE,GAAGD,QAAQ;gBACzCC;YACF,GAAGe,GAAG,CAACZ,OAAO;QAChB;QAEAL,IAAAA,WAAE,EAAC,uCAAuC;YACxCN,QAAQC,GAAG,CAACC,wBAAwB,GAAG;YACvCF,QAAQC,GAAG,CAACE,6BAA6B,GAAG;YAE5CV,aAAI,CAACW,YAAY;YAEjBK,IAAAA,eAAM,EAAC;gBACL,MAAM,EAAED,oBAAoB,EAAE,GAAGD,QAAQ;gBACzCC;YACF,GAAGe,GAAG,CAACZ,OAAO;QAChB;QAEAL,IAAAA,WAAE,EAAC,+DAA+D;YAChEN,QAAQC,GAAG,CAACC,wBAAwB,GAAG;YACvCF,QAAQC,GAAG,CAACE,6BAA6B,GAAG;YAE5CV,aAAI,CAACW,YAAY;YAEjBK,IAAAA,eAAM,EAAC;gBACL,MAAM,EAAED,oBAAoB,EAAE,GAAGD,QAAQ;gBACzCC;YACF,GAAGG,OAAO,CAAC;QACb;IACF;AACF"}