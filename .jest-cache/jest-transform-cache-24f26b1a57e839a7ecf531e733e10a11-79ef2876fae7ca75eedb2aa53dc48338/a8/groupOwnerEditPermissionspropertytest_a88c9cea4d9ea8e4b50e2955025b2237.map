{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/property/groupOwnerEditPermissions.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { PUT } from '@/app/api/guest/family/[id]/route';\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\n\n/**\n * Property-Based Tests for Group Owner Edit Permissions\n * \n * Feature: destination-wedding-platform\n * Property 19: Group Owner Edit Permissions\n * Validates: Requirements 6.4, 6.5, 6.6, 6.7\n * Task: 16.4\n */\n\n// Mock dependencies\njest.mock('@supabase/auth-helpers-nextjs');\njest.mock('next/headers', () => ({\n  cookies: jest.fn(),\n}));\njest.mock('@/services/emailService', () => ({\n  emailService: {\n    send: jest.fn().mockResolvedValue({ success: true }),\n  },\n}));\n\nconst mockSupabase = {\n  auth: {\n    getSession: jest.fn(),\n  },\n  from: jest.fn().mockReturnThis(),\n  select: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  single: jest.fn(),\n  update: jest.fn().mockReturnThis(),\n};\n\ndescribe('Feature: destination-wedding-platform, Property 19: Group Owner Edit Permissions', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (createRouteHandlerClient as jest.Mock).mockReturnValue(mockSupabase);\n  });\n\n  it('should allow adults to edit any family member in their group', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // currentGuestId\n        fc.uuid(), // targetGuestId\n        fc.uuid(), // groupId\n        fc.emailAddress(),\n        fc.string({ minLength: 1, maxLength: 50 }), // firstName\n        fc.string({ minLength: 1, maxLength: 50 }), // lastName\n        fc.string({ minLength: 0, maxLength: 500 }), // dietaryRestrictions\n        async (currentGuestId, targetGuestId, groupId, email, firstName, lastName, dietaryRestrictions) => {\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'current@example.com' } } },\n            error: null,\n          });\n\n          const currentGuest = {\n            id: currentGuestId,\n            group_id: groupId,\n            age_type: 'adult',\n            email: 'current@example.com',\n          };\n\n          const targetGuest = {\n            id: targetGuestId,\n            group_id: groupId,\n            age_type: 'child',\n            first_name: 'Original',\n            last_name: 'Name',\n          };\n\n          const updatedGuest = {\n            ...targetGuest,\n            first_name: firstName,\n            last_name: lastName,\n            email,\n            dietary_restrictions: dietaryRestrictions || null,\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: currentGuest, error: null })\n            .mockResolvedValueOnce({ data: targetGuest, error: null })\n            .mockResolvedValueOnce({ data: updatedGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${targetGuestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              first_name: firstName,\n              last_name: lastName,\n              email,\n              dietary_restrictions: dietaryRestrictions,\n            }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: targetGuestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(200);\n          expect(data.success).toBe(true);\n          expect(data.data.first_name).toBe(firstName);\n          expect(data.data.last_name).toBe(lastName);\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should prevent adults from editing family members in other groups', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // currentGuestId\n        fc.uuid(), // targetGuestId\n        fc.uuid(), // currentGroupId\n        fc.uuid(), // targetGroupId\n        fc.string({ minLength: 1, maxLength: 50 }), // firstName\n        async (currentGuestId, targetGuestId, currentGroupId, targetGroupId, firstName) => {\n          // Ensure groups are different\n          fc.pre(currentGroupId !== targetGroupId);\n\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'current@example.com' } } },\n            error: null,\n          });\n\n          const currentGuest = {\n            id: currentGuestId,\n            group_id: currentGroupId,\n            age_type: 'adult',\n            email: 'current@example.com',\n          };\n\n          const targetGuest = {\n            id: targetGuestId,\n            group_id: targetGroupId,\n            age_type: 'child',\n            first_name: 'Original',\n            last_name: 'Name',\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: currentGuest, error: null })\n            .mockResolvedValueOnce({ data: targetGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${targetGuestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ first_name: firstName }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: targetGuestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(403);\n          expect(data.success).toBe(false);\n          expect(data.error.code).toBe('FORBIDDEN');\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should allow children to edit only themselves', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // guestId\n        fc.uuid(), // groupId\n        fc.string({ minLength: 1, maxLength: 50 }), // firstName\n        fc.string({ minLength: 1, maxLength: 50 }), // lastName\n        async (guestId, groupId, firstName, lastName) => {\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'child@example.com' } } },\n            error: null,\n          });\n\n          const childGuest = {\n            id: guestId,\n            group_id: groupId,\n            age_type: 'child',\n            email: 'child@example.com',\n            first_name: 'Original',\n            last_name: 'Name',\n          };\n\n          const updatedGuest = {\n            ...childGuest,\n            first_name: firstName,\n            last_name: lastName,\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: childGuest, error: null })\n            .mockResolvedValueOnce({ data: childGuest, error: null })\n            .mockResolvedValueOnce({ data: updatedGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${guestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              first_name: firstName,\n              last_name: lastName,\n            }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: guestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(200);\n          expect(data.success).toBe(true);\n          expect(data.data.first_name).toBe(firstName);\n          expect(data.data.last_name).toBe(lastName);\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should prevent children from editing other family members', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // currentGuestId\n        fc.uuid(), // targetGuestId\n        fc.uuid(), // groupId\n        fc.string({ minLength: 1, maxLength: 50 }), // firstName\n        async (currentGuestId, targetGuestId, groupId, firstName) => {\n          // Ensure guests are different\n          fc.pre(currentGuestId !== targetGuestId);\n\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'child@example.com' } } },\n            error: null,\n          });\n\n          const currentGuest = {\n            id: currentGuestId,\n            group_id: groupId,\n            age_type: 'child',\n            email: 'child@example.com',\n          };\n\n          const targetGuest = {\n            id: targetGuestId,\n            group_id: groupId,\n            age_type: 'adult',\n            first_name: 'Original',\n            last_name: 'Name',\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: currentGuest, error: null })\n            .mockResolvedValueOnce({ data: targetGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${targetGuestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ first_name: firstName }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: targetGuestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(403);\n          expect(data.success).toBe(false);\n          expect(data.error.code).toBe('FORBIDDEN');\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should allow adults to update contact information for all family members', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // currentGuestId\n        fc.uuid(), // targetGuestId\n        fc.uuid(), // groupId\n        fc.emailAddress(),\n        fc.string({ minLength: 10, maxLength: 20 }), // phone\n        async (currentGuestId, targetGuestId, groupId, email, phone) => {\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'adult@example.com' } } },\n            error: null,\n          });\n\n          const currentGuest = {\n            id: currentGuestId,\n            group_id: groupId,\n            age_type: 'adult',\n            email: 'adult@example.com',\n          };\n\n          const targetGuest = {\n            id: targetGuestId,\n            group_id: groupId,\n            age_type: 'child',\n            first_name: 'Child',\n            last_name: 'Name',\n            email: 'old@example.com',\n            phone: '1234567890',\n          };\n\n          const updatedGuest = {\n            ...targetGuest,\n            email,\n            phone,\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: currentGuest, error: null })\n            .mockResolvedValueOnce({ data: targetGuest, error: null })\n            .mockResolvedValueOnce({ data: updatedGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${targetGuestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ email, phone }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: targetGuestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(200);\n          expect(data.success).toBe(true);\n          expect(data.data.email).toBe(email);\n          expect(data.data.phone).toBe(phone);\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should allow adults to update dietary restrictions for all family members', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // currentGuestId\n        fc.uuid(), // targetGuestId\n        fc.uuid(), // groupId\n        fc.string({ minLength: 0, maxLength: 500 }), // dietaryRestrictions\n        async (currentGuestId, targetGuestId, groupId, dietaryRestrictions) => {\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'adult@example.com' } } },\n            error: null,\n          });\n\n          const currentGuest = {\n            id: currentGuestId,\n            group_id: groupId,\n            age_type: 'adult',\n            email: 'adult@example.com',\n          };\n\n          const targetGuest = {\n            id: targetGuestId,\n            group_id: groupId,\n            age_type: 'child',\n            first_name: 'Child',\n            last_name: 'Name',\n            dietary_restrictions: 'Old restrictions',\n          };\n\n          const updatedGuest = {\n            ...targetGuest,\n            dietary_restrictions: dietaryRestrictions || null,\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: currentGuest, error: null })\n            .mockResolvedValueOnce({ data: targetGuest, error: null })\n            .mockResolvedValueOnce({ data: updatedGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${targetGuestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ dietary_restrictions: dietaryRestrictions }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: targetGuestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(200);\n          expect(data.success).toBe(true);\n          expect(data.data.dietary_restrictions).toBe(dietaryRestrictions || null);\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should sanitize all input fields before saving', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // currentGuestId\n        fc.uuid(), // targetGuestId\n        fc.uuid(), // groupId\n        fc.oneof(\n          fc.constant('<script>alert(\"xss\")</script>John'),\n          fc.constant('John<img src=x onerror=alert(1)>'),\n          fc.constant('John\"; DROP TABLE guests; --')\n        ),\n        async (currentGuestId, targetGuestId, groupId, maliciousInput) => {\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'adult@example.com' } } },\n            error: null,\n          });\n\n          const currentGuest = {\n            id: currentGuestId,\n            group_id: groupId,\n            age_type: 'adult',\n            email: 'adult@example.com',\n          };\n\n          const targetGuest = {\n            id: targetGuestId,\n            group_id: groupId,\n            age_type: 'child',\n            first_name: 'Original',\n            last_name: 'Name',\n          };\n\n          const updatedGuest = {\n            ...targetGuest,\n            first_name: 'John', // Sanitized version\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: currentGuest, error: null })\n            .mockResolvedValueOnce({ data: targetGuest, error: null })\n            .mockResolvedValueOnce({ data: updatedGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${targetGuestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ first_name: maliciousInput }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: targetGuestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(200);\n          expect(data.success).toBe(true);\n          // Verify sanitization occurred\n          const updateCall = mockSupabase.update.mock.calls[0];\n          if (updateCall && updateCall[0]?.first_name) {\n            expect(updateCall[0].first_name).not.toContain('<script>');\n            expect(updateCall[0].first_name).not.toContain('DROP TABLE');\n            expect(updateCall[0].first_name).not.toContain('onerror=');\n          }\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should validate email format before saving', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(), // currentGuestId\n        fc.uuid(), // targetGuestId\n        fc.uuid(), // groupId\n        fc.oneof(\n          fc.constant('not-an-email'),\n          fc.constant('missing@domain'),\n          fc.constant('@nodomain.com'),\n          fc.constant('spaces in@email.com')\n        ),\n        async (currentGuestId, targetGuestId, groupId, invalidEmail) => {\n          // Arrange\n          mockSupabase.auth.getSession.mockResolvedValue({\n            data: { session: { user: { email: 'adult@example.com' } } },\n            error: null,\n          });\n\n          const currentGuest = {\n            id: currentGuestId,\n            group_id: groupId,\n            age_type: 'adult',\n            email: 'adult@example.com',\n          };\n\n          const targetGuest = {\n            id: targetGuestId,\n            group_id: groupId,\n            age_type: 'child',\n            first_name: 'Child',\n            last_name: 'Name',\n          };\n\n          mockSupabase.single\n            .mockResolvedValueOnce({ data: currentGuest, error: null })\n            .mockResolvedValueOnce({ data: targetGuest, error: null });\n\n          const request = new Request(`http://localhost:3000/api/guest/family/${targetGuestId}`, {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ email: invalidEmail }),\n          });\n\n          // Act\n          const response = await PUT(request, { params: { id: targetGuestId } });\n          const data = await response.json();\n\n          // Assert\n          expect(response.status).toBe(400);\n          expect(data.success).toBe(false);\n          expect(data.error.code).toBe('VALIDATION_ERROR');\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n});\n"],"names":["jest","mock","cookies","fn","emailService","send","mockResolvedValue","success","mockSupabase","auth","getSession","from","mockReturnThis","select","eq","single","update","describe","beforeEach","clearAllMocks","createRouteHandlerClient","mockReturnValue","it","fc","assert","asyncProperty","uuid","emailAddress","string","minLength","maxLength","currentGuestId","targetGuestId","groupId","email","firstName","lastName","dietaryRestrictions","data","session","user","error","currentGuest","id","group_id","age_type","targetGuest","first_name","last_name","updatedGuest","dietary_restrictions","mockResolvedValueOnce","request","Request","method","headers","body","JSON","stringify","response","PUT","params","json","expect","status","toBe","numRuns","currentGroupId","targetGroupId","pre","code","guestId","childGuest","phone","oneof","constant","maliciousInput","updateCall","calls","not","toContain","invalidEmail"],"mappings":"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"}