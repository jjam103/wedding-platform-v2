72d6a0f0253ea0c0a1a49a8bd8c97f19
/**
 * Property-Based Test: Soft Delete Restoration
 * Feature: guest-portal-and-admin-enhancements
 * Property 33: Soft Delete Restoration
 * 
 * Validates: Requirements 29.9
 * 
 * Property: Restored records must have deleted_at set to NULL and must be
 * accessible in guest-facing queries again.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _fastcheck = /*#__PURE__*/ _interop_require_wildcard(require("fast-check"));
const _contentPagesService = require("./contentPagesService");
const _eventService = require("./eventService");
const _activityService = require("./activityService");
const _supabasejs = require("@supabase/supabase-js");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
describe('Feature: guest-portal-and-admin-enhancements, Property 33: Soft Delete Restoration', ()=>{
    beforeEach(async ()=>{
        // Clean up test data
        await supabase.from('activities').delete().neq('id', '00000000-0000-0000-0000-000000000000');
        await supabase.from('events').delete().neq('id', '00000000-0000-0000-0000-000000000000');
        await supabase.from('content_pages').delete().neq('id', '00000000-0000-0000-0000-000000000000');
    });
    afterAll(async ()=>{
        // Final cleanup
        await supabase.from('activities').delete().neq('id', '00000000-0000-0000-0000-000000000000');
        await supabase.from('events').delete().neq('id', '00000000-0000-0000-0000-000000000000');
        await supabase.from('content_pages').delete().neq('id', '00000000-0000-0000-0000-000000000000');
    });
    it('should restore content page with deleted_at set to NULL', async ()=>{
        await _fastcheck.assert(_fastcheck.asyncProperty(_fastcheck.string({
            minLength: 1,
            maxLength: 100
        }), async (pageTitle)=>{
            // Create content page
            const createResult = await (0, _contentPagesService.createContentPage)({
                title: pageTitle,
                status: 'published'
            });
            if (!createResult.success) {
                throw new Error('Failed to create content page');
            }
            const pageId = createResult.data.id;
            // Soft delete
            await (0, _contentPagesService.deleteContentPage)(pageId, {
                permanent: false
            });
            // Verify deleted
            const { data: deletedPage } = await supabase.from('content_pages').select('deleted_at').eq('id', pageId).single();
            expect(deletedPage?.deleted_at).not.toBeNull();
            // Restore
            const restoreResult = await (0, _contentPagesService.restoreContentPage)(pageId);
            expect(restoreResult.success).toBe(true);
            // Verify restored
            const { data: restoredPage } = await supabase.from('content_pages').select('deleted_at').eq('id', pageId).single();
            expect(restoredPage?.deleted_at).toBeNull();
            // Verify accessible in guest query
            const { data: guestPages } = await supabase.from('content_pages').select('id').eq('status', 'published').is('deleted_at', null);
            const guestPageIds = guestPages?.map((p)=>p.id) || [];
            expect(guestPageIds).toContain(pageId);
            // Cleanup
            await (0, _contentPagesService.deleteContentPage)(pageId, {
                permanent: true
            });
        }), {
            numRuns: 100
        });
    });
    it('should restore event with deleted_at set to NULL', async ()=>{
        await _fastcheck.assert(_fastcheck.asyncProperty(_fastcheck.string({
            minLength: 1,
            maxLength: 100
        }), async (eventName)=>{
            // Create event
            const createResult = await (0, _eventService.create)({
                name: eventName,
                date: new Date().toISOString().split('T')[0]
            });
            if (!createResult.success) {
                throw new Error('Failed to create event');
            }
            const eventId = createResult.data.id;
            // Soft delete
            await (0, _eventService.deleteEvent)(eventId, {
                permanent: false
            });
            // Verify deleted
            const { data: deletedEvent } = await supabase.from('events').select('deleted_at').eq('id', eventId).single();
            expect(deletedEvent?.deleted_at).not.toBeNull();
            // Restore
            const restoreResult = await (0, _eventService.restoreEvent)(eventId);
            expect(restoreResult.success).toBe(true);
            // Verify restored
            const { data: restoredEvent } = await supabase.from('events').select('deleted_at').eq('id', eventId).single();
            expect(restoredEvent?.deleted_at).toBeNull();
            // Verify accessible in guest query
            const { data: guestEvents } = await supabase.from('events').select('id').is('deleted_at', null);
            const guestEventIds = guestEvents?.map((e)=>e.id) || [];
            expect(guestEventIds).toContain(eventId);
            // Cleanup
            await (0, _eventService.deleteEvent)(eventId, {
                permanent: true
            });
        }), {
            numRuns: 100
        });
    });
    it('should restore activity with deleted_at set to NULL', async ()=>{
        await _fastcheck.assert(_fastcheck.asyncProperty(_fastcheck.string({
            minLength: 1,
            maxLength: 100
        }), async (activityName)=>{
            // Create activity
            const createResult = await (0, _activityService.create)({
                name: activityName,
                date: new Date().toISOString().split('T')[0],
                activity_type: 'activity'
            });
            if (!createResult.success) {
                throw new Error('Failed to create activity');
            }
            const activityId = createResult.data.id;
            // Soft delete
            await (0, _activityService.deleteActivity)(activityId, {
                permanent: false
            });
            // Verify deleted
            const { data: deletedActivity } = await supabase.from('activities').select('deleted_at').eq('id', activityId).single();
            expect(deletedActivity?.deleted_at).not.toBeNull();
            // Restore
            const restoreResult = await (0, _activityService.restoreActivity)(activityId);
            expect(restoreResult.success).toBe(true);
            // Verify restored
            const { data: restoredActivity } = await supabase.from('activities').select('deleted_at').eq('id', activityId).single();
            expect(restoredActivity?.deleted_at).toBeNull();
            // Verify accessible in guest query
            const { data: guestActivities } = await supabase.from('activities').select('id').is('deleted_at', null);
            const guestActivityIds = guestActivities?.map((a)=>a.id) || [];
            expect(guestActivityIds).toContain(activityId);
            // Cleanup
            await (0, _activityService.deleteActivity)(activityId, {
                permanent: true
            });
        }), {
            numRuns: 100
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvc29mdERlbGV0ZVJlc3RvcmF0aW9uLnByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcm9wZXJ0eS1CYXNlZCBUZXN0OiBTb2Z0IERlbGV0ZSBSZXN0b3JhdGlvblxuICogRmVhdHVyZTogZ3Vlc3QtcG9ydGFsLWFuZC1hZG1pbi1lbmhhbmNlbWVudHNcbiAqIFByb3BlcnR5IDMzOiBTb2Z0IERlbGV0ZSBSZXN0b3JhdGlvblxuICogXG4gKiBWYWxpZGF0ZXM6IFJlcXVpcmVtZW50cyAyOS45XG4gKiBcbiAqIFByb3BlcnR5OiBSZXN0b3JlZCByZWNvcmRzIG11c3QgaGF2ZSBkZWxldGVkX2F0IHNldCB0byBOVUxMIGFuZCBtdXN0IGJlXG4gKiBhY2Nlc3NpYmxlIGluIGd1ZXN0LWZhY2luZyBxdWVyaWVzIGFnYWluLlxuICovXG5cbmltcG9ydCAqIGFzIGZjIGZyb20gJ2Zhc3QtY2hlY2snO1xuaW1wb3J0IHsgY3JlYXRlQ29udGVudFBhZ2UsIGRlbGV0ZUNvbnRlbnRQYWdlLCByZXN0b3JlQ29udGVudFBhZ2UgfSBmcm9tICcuL2NvbnRlbnRQYWdlc1NlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlIGFzIGNyZWF0ZUV2ZW50LCBkZWxldGVFdmVudCwgcmVzdG9yZUV2ZW50IH0gZnJvbSAnLi9ldmVudFNlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlIGFzIGNyZWF0ZUFjdGl2aXR5LCBkZWxldGVBY3Rpdml0eSwgcmVzdG9yZUFjdGl2aXR5IH0gZnJvbSAnLi9hY3Rpdml0eVNlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkhXG4pO1xuXG5kZXNjcmliZSgnRmVhdHVyZTogZ3Vlc3QtcG9ydGFsLWFuZC1hZG1pbi1lbmhhbmNlbWVudHMsIFByb3BlcnR5IDMzOiBTb2Z0IERlbGV0ZSBSZXN0b3JhdGlvbicsICgpID0+IHtcbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkYXRhXG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnYWN0aXZpdGllcycpLmRlbGV0ZSgpLm5lcSgnaWQnLCAnMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwJyk7XG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnZXZlbnRzJykuZGVsZXRlKCkubmVxKCdpZCcsICcwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAnKTtcbiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdjb250ZW50X3BhZ2VzJykuZGVsZXRlKCkubmVxKCdpZCcsICcwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAnKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIEZpbmFsIGNsZWFudXBcbiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdhY3Rpdml0aWVzJykuZGVsZXRlKCkubmVxKCdpZCcsICcwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAnKTtcbiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdldmVudHMnKS5kZWxldGUoKS5uZXEoJ2lkJywgJzAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCcpO1xuICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ2NvbnRlbnRfcGFnZXMnKS5kZWxldGUoKS5uZXEoJ2lkJywgJzAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCcpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlc3RvcmUgY29udGVudCBwYWdlIHdpdGggZGVsZXRlZF9hdCBzZXQgdG8gTlVMTCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBmYy5hc3NlcnQoXG4gICAgICBmYy5hc3luY1Byb3BlcnR5KFxuICAgICAgICBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEsIG1heExlbmd0aDogMTAwIH0pLFxuICAgICAgICBhc3luYyAocGFnZVRpdGxlKSA9PiB7XG4gICAgICAgICAgLy8gQ3JlYXRlIGNvbnRlbnQgcGFnZVxuICAgICAgICAgIGNvbnN0IGNyZWF0ZVJlc3VsdCA9IGF3YWl0IGNyZWF0ZUNvbnRlbnRQYWdlKHtcbiAgICAgICAgICAgIHRpdGxlOiBwYWdlVGl0bGUsXG4gICAgICAgICAgICBzdGF0dXM6ICdwdWJsaXNoZWQnLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKCFjcmVhdGVSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGNvbnRlbnQgcGFnZScpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHBhZ2VJZCA9IGNyZWF0ZVJlc3VsdC5kYXRhLmlkO1xuXG4gICAgICAgICAgLy8gU29mdCBkZWxldGVcbiAgICAgICAgICBhd2FpdCBkZWxldGVDb250ZW50UGFnZShwYWdlSWQsIHsgcGVybWFuZW50OiBmYWxzZSB9KTtcblxuICAgICAgICAgIC8vIFZlcmlmeSBkZWxldGVkXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBkZWxldGVkUGFnZSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdjb250ZW50X3BhZ2VzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2RlbGV0ZWRfYXQnKVxuICAgICAgICAgICAgLmVxKCdpZCcsIHBhZ2VJZClcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGV4cGVjdChkZWxldGVkUGFnZT8uZGVsZXRlZF9hdCkubm90LnRvQmVOdWxsKCk7XG5cbiAgICAgICAgICAvLyBSZXN0b3JlXG4gICAgICAgICAgY29uc3QgcmVzdG9yZVJlc3VsdCA9IGF3YWl0IHJlc3RvcmVDb250ZW50UGFnZShwYWdlSWQpO1xuICAgICAgICAgIGV4cGVjdChyZXN0b3JlUmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG5cbiAgICAgICAgICAvLyBWZXJpZnkgcmVzdG9yZWRcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IHJlc3RvcmVkUGFnZSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdjb250ZW50X3BhZ2VzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2RlbGV0ZWRfYXQnKVxuICAgICAgICAgICAgLmVxKCdpZCcsIHBhZ2VJZClcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGV4cGVjdChyZXN0b3JlZFBhZ2U/LmRlbGV0ZWRfYXQpLnRvQmVOdWxsKCk7XG5cbiAgICAgICAgICAvLyBWZXJpZnkgYWNjZXNzaWJsZSBpbiBndWVzdCBxdWVyeVxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogZ3Vlc3RQYWdlcyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdjb250ZW50X3BhZ2VzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgIC5lcSgnc3RhdHVzJywgJ3B1Ymxpc2hlZCcpXG4gICAgICAgICAgICAuaXMoJ2RlbGV0ZWRfYXQnLCBudWxsKTtcblxuICAgICAgICAgIGNvbnN0IGd1ZXN0UGFnZUlkcyA9IGd1ZXN0UGFnZXM/Lm1hcCgocCkgPT4gcC5pZCkgfHwgW107XG4gICAgICAgICAgZXhwZWN0KGd1ZXN0UGFnZUlkcykudG9Db250YWluKHBhZ2VJZCk7XG5cbiAgICAgICAgICAvLyBDbGVhbnVwXG4gICAgICAgICAgYXdhaXQgZGVsZXRlQ29udGVudFBhZ2UocGFnZUlkLCB7IHBlcm1hbmVudDogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlc3RvcmUgZXZlbnQgd2l0aCBkZWxldGVkX2F0IHNldCB0byBOVUxMJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGZjLmFzc2VydChcbiAgICAgIGZjLmFzeW5jUHJvcGVydHkoXG4gICAgICAgIGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiAxMDAgfSksXG4gICAgICAgIGFzeW5jIChldmVudE5hbWUpID0+IHtcbiAgICAgICAgICAvLyBDcmVhdGUgZXZlbnRcbiAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVFdmVudCh7XG4gICAgICAgICAgICBuYW1lOiBldmVudE5hbWUsXG4gICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmICghY3JlYXRlUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBldmVudCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGV2ZW50SWQgPSBjcmVhdGVSZXN1bHQuZGF0YS5pZDtcblxuICAgICAgICAgIC8vIFNvZnQgZGVsZXRlXG4gICAgICAgICAgYXdhaXQgZGVsZXRlRXZlbnQoZXZlbnRJZCwgeyBwZXJtYW5lbnQ6IGZhbHNlIH0pO1xuXG4gICAgICAgICAgLy8gVmVyaWZ5IGRlbGV0ZWRcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IGRlbGV0ZWRFdmVudCB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdldmVudHMnKVxuICAgICAgICAgICAgLnNlbGVjdCgnZGVsZXRlZF9hdCcpXG4gICAgICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZClcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGV4cGVjdChkZWxldGVkRXZlbnQ/LmRlbGV0ZWRfYXQpLm5vdC50b0JlTnVsbCgpO1xuXG4gICAgICAgICAgLy8gUmVzdG9yZVxuICAgICAgICAgIGNvbnN0IHJlc3RvcmVSZXN1bHQgPSBhd2FpdCByZXN0b3JlRXZlbnQoZXZlbnRJZCk7XG4gICAgICAgICAgZXhwZWN0KHJlc3RvcmVSZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcblxuICAgICAgICAgIC8vIFZlcmlmeSByZXN0b3JlZFxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogcmVzdG9yZWRFdmVudCB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdldmVudHMnKVxuICAgICAgICAgICAgLnNlbGVjdCgnZGVsZXRlZF9hdCcpXG4gICAgICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZClcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGV4cGVjdChyZXN0b3JlZEV2ZW50Py5kZWxldGVkX2F0KS50b0JlTnVsbCgpO1xuXG4gICAgICAgICAgLy8gVmVyaWZ5IGFjY2Vzc2libGUgaW4gZ3Vlc3QgcXVlcnlcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IGd1ZXN0RXZlbnRzIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ2V2ZW50cycpXG4gICAgICAgICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAgICAgICAuaXMoJ2RlbGV0ZWRfYXQnLCBudWxsKTtcblxuICAgICAgICAgIGNvbnN0IGd1ZXN0RXZlbnRJZHMgPSBndWVzdEV2ZW50cz8ubWFwKChlKSA9PiBlLmlkKSB8fCBbXTtcbiAgICAgICAgICBleHBlY3QoZ3Vlc3RFdmVudElkcykudG9Db250YWluKGV2ZW50SWQpO1xuXG4gICAgICAgICAgLy8gQ2xlYW51cFxuICAgICAgICAgIGF3YWl0IGRlbGV0ZUV2ZW50KGV2ZW50SWQsIHsgcGVybWFuZW50OiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgICApLFxuICAgICAgeyBudW1SdW5zOiAxMDAgfVxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVzdG9yZSBhY3Rpdml0eSB3aXRoIGRlbGV0ZWRfYXQgc2V0IHRvIE5VTEwnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgZmMuYXNzZXJ0KFxuICAgICAgZmMuYXN5bmNQcm9wZXJ0eShcbiAgICAgICAgZmMuc3RyaW5nKHsgbWluTGVuZ3RoOiAxLCBtYXhMZW5ndGg6IDEwMCB9KSxcbiAgICAgICAgYXN5bmMgKGFjdGl2aXR5TmFtZSkgPT4ge1xuICAgICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eVxuICAgICAgICAgIGNvbnN0IGNyZWF0ZVJlc3VsdCA9IGF3YWl0IGNyZWF0ZUFjdGl2aXR5KHtcbiAgICAgICAgICAgIG5hbWU6IGFjdGl2aXR5TmFtZSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgICAgICAgYWN0aXZpdHlfdHlwZTogJ2FjdGl2aXR5JyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmICghY3JlYXRlUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBhY3Rpdml0eScpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBjcmVhdGVSZXN1bHQuZGF0YS5pZDtcblxuICAgICAgICAgIC8vIFNvZnQgZGVsZXRlXG4gICAgICAgICAgYXdhaXQgZGVsZXRlQWN0aXZpdHkoYWN0aXZpdHlJZCwgeyBwZXJtYW5lbnQ6IGZhbHNlIH0pO1xuXG4gICAgICAgICAgLy8gVmVyaWZ5IGRlbGV0ZWRcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IGRlbGV0ZWRBY3Rpdml0eSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdhY3Rpdml0aWVzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2RlbGV0ZWRfYXQnKVxuICAgICAgICAgICAgLmVxKCdpZCcsIGFjdGl2aXR5SWQpXG4gICAgICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgICAgICBleHBlY3QoZGVsZXRlZEFjdGl2aXR5Py5kZWxldGVkX2F0KS5ub3QudG9CZU51bGwoKTtcblxuICAgICAgICAgIC8vIFJlc3RvcmVcbiAgICAgICAgICBjb25zdCByZXN0b3JlUmVzdWx0ID0gYXdhaXQgcmVzdG9yZUFjdGl2aXR5KGFjdGl2aXR5SWQpO1xuICAgICAgICAgIGV4cGVjdChyZXN0b3JlUmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG5cbiAgICAgICAgICAvLyBWZXJpZnkgcmVzdG9yZWRcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IHJlc3RvcmVkQWN0aXZpdHkgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgICAuZnJvbSgnYWN0aXZpdGllcycpXG4gICAgICAgICAgICAuc2VsZWN0KCdkZWxldGVkX2F0JylcbiAgICAgICAgICAgIC5lcSgnaWQnLCBhY3Rpdml0eUlkKVxuICAgICAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICAgICAgZXhwZWN0KHJlc3RvcmVkQWN0aXZpdHk/LmRlbGV0ZWRfYXQpLnRvQmVOdWxsKCk7XG5cbiAgICAgICAgICAvLyBWZXJpZnkgYWNjZXNzaWJsZSBpbiBndWVzdCBxdWVyeVxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogZ3Vlc3RBY3Rpdml0aWVzIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ2FjdGl2aXRpZXMnKVxuICAgICAgICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgICAgICAgLmlzKCdkZWxldGVkX2F0JywgbnVsbCk7XG5cbiAgICAgICAgICBjb25zdCBndWVzdEFjdGl2aXR5SWRzID0gZ3Vlc3RBY3Rpdml0aWVzPy5tYXAoKGEpID0+IGEuaWQpIHx8IFtdO1xuICAgICAgICAgIGV4cGVjdChndWVzdEFjdGl2aXR5SWRzKS50b0NvbnRhaW4oYWN0aXZpdHlJZCk7XG5cbiAgICAgICAgICAvLyBDbGVhbnVwXG4gICAgICAgICAgYXdhaXQgZGVsZXRlQWN0aXZpdHkoYWN0aXZpdHlJZCwgeyBwZXJtYW5lbnQ6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDEwMCB9XG4gICAgKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJzdXBhYmFzZSIsImNyZWF0ZUNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiZnJvbSIsImRlbGV0ZSIsIm5lcSIsImFmdGVyQWxsIiwiaXQiLCJmYyIsImFzc2VydCIsImFzeW5jUHJvcGVydHkiLCJzdHJpbmciLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJwYWdlVGl0bGUiLCJjcmVhdGVSZXN1bHQiLCJjcmVhdGVDb250ZW50UGFnZSIsInRpdGxlIiwic3RhdHVzIiwic3VjY2VzcyIsIkVycm9yIiwicGFnZUlkIiwiZGF0YSIsImlkIiwiZGVsZXRlQ29udGVudFBhZ2UiLCJwZXJtYW5lbnQiLCJkZWxldGVkUGFnZSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiZXhwZWN0IiwiZGVsZXRlZF9hdCIsIm5vdCIsInRvQmVOdWxsIiwicmVzdG9yZVJlc3VsdCIsInJlc3RvcmVDb250ZW50UGFnZSIsInRvQmUiLCJyZXN0b3JlZFBhZ2UiLCJndWVzdFBhZ2VzIiwiaXMiLCJndWVzdFBhZ2VJZHMiLCJtYXAiLCJwIiwidG9Db250YWluIiwibnVtUnVucyIsImV2ZW50TmFtZSIsImNyZWF0ZUV2ZW50IiwibmFtZSIsImRhdGUiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzcGxpdCIsImV2ZW50SWQiLCJkZWxldGVFdmVudCIsImRlbGV0ZWRFdmVudCIsInJlc3RvcmVFdmVudCIsInJlc3RvcmVkRXZlbnQiLCJndWVzdEV2ZW50cyIsImd1ZXN0RXZlbnRJZHMiLCJlIiwiYWN0aXZpdHlOYW1lIiwiY3JlYXRlQWN0aXZpdHkiLCJhY3Rpdml0eV90eXBlIiwiYWN0aXZpdHlJZCIsImRlbGV0ZUFjdGl2aXR5IiwiZGVsZXRlZEFjdGl2aXR5IiwicmVzdG9yZUFjdGl2aXR5IiwicmVzdG9yZWRBY3Rpdml0eSIsImd1ZXN0QWN0aXZpdGllcyIsImd1ZXN0QWN0aXZpdHlJZHMiLCJhIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7O0NBU0M7Ozs7bUVBRW1CO3FDQUNxRDs4QkFDUjtpQ0FDUzs0QkFDN0M7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUU3QixNQUFNQSxXQUFXQyxJQUFBQSx3QkFBWSxFQUMzQkMsUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0IsRUFDcENGLFFBQVFDLEdBQUcsQ0FBQ0UseUJBQXlCO0FBR3ZDQyxTQUFTLHNGQUFzRjtJQUM3RkMsV0FBVztRQUNULHFCQUFxQjtRQUNyQixNQUFNUCxTQUFTUSxJQUFJLENBQUMsY0FBY0MsTUFBTSxHQUFHQyxHQUFHLENBQUMsTUFBTTtRQUNyRCxNQUFNVixTQUFTUSxJQUFJLENBQUMsVUFBVUMsTUFBTSxHQUFHQyxHQUFHLENBQUMsTUFBTTtRQUNqRCxNQUFNVixTQUFTUSxJQUFJLENBQUMsaUJBQWlCQyxNQUFNLEdBQUdDLEdBQUcsQ0FBQyxNQUFNO0lBQzFEO0lBRUFDLFNBQVM7UUFDUCxnQkFBZ0I7UUFDaEIsTUFBTVgsU0FBU1EsSUFBSSxDQUFDLGNBQWNDLE1BQU0sR0FBR0MsR0FBRyxDQUFDLE1BQU07UUFDckQsTUFBTVYsU0FBU1EsSUFBSSxDQUFDLFVBQVVDLE1BQU0sR0FBR0MsR0FBRyxDQUFDLE1BQU07UUFDakQsTUFBTVYsU0FBU1EsSUFBSSxDQUFDLGlCQUFpQkMsTUFBTSxHQUFHQyxHQUFHLENBQUMsTUFBTTtJQUMxRDtJQUVBRSxHQUFHLDJEQUEyRDtRQUM1RCxNQUFNQyxXQUFHQyxNQUFNLENBQ2JELFdBQUdFLGFBQWEsQ0FDZEYsV0FBR0csTUFBTSxDQUFDO1lBQUVDLFdBQVc7WUFBR0MsV0FBVztRQUFJLElBQ3pDLE9BQU9DO1lBQ0ws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