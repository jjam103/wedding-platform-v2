c86eca58ef582907a3c91a9ba8461515
/**
 * Property-based test for photo storage URL consistency.
 * Feature: destination-wedding-platform, Property 16: Photo Storage URL Consistency
 * Validates: Requirements 12.7
 * 
 * For any photo upload, the photo_url saved in the database should use the domain
 * corresponding to the active storage method (Cloudflare CDN domain for B2 storage,
 * Supabase domain for Supabase storage).
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _fastcheck = /*#__PURE__*/ _interop_require_wildcard(require("fast-check"));
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
describe('Feature: destination-wedding-platform, Property 16: Photo Storage URL Consistency', ()=>{
    // Arbitraries for generating test data
    const storageTypeArbitrary = _fastcheck.constantFrom('b2', 'supabase');
    const b2CDNDomainArbitrary = _fastcheck.constantFrom('cdn.example.com', 'f000.backblazeb2.com', 'cdn.mysite.com');
    const supabaseDomainArbitrary = _fastcheck.constantFrom('supabase.co', 'supabase.example.com', 'storage.supabase.co');
    const photoKeyArbitrary = _fastcheck.string({
        minLength: 10,
        maxLength: 100
    }).map((s)=>`photos/${Date.now()}-${s.replace(/[^a-zA-Z0-9._-]/g, '_')}.jpg`);
    it('should use Cloudflare CDN domain for B2 storage', ()=>{
        _fastcheck.assert(_fastcheck.property(b2CDNDomainArbitrary, photoKeyArbitrary, (cdnDomain, photoKey)=>{
            // Arrange
            const storageType = 'b2';
            // Act - Generate URL based on storage type
            const photoUrl = `https://${cdnDomain}/${photoKey}`;
            // Assert - URL should contain the CDN domain
            expect(photoUrl).toContain(cdnDomain);
            expect(photoUrl).toContain('https://');
            expect(photoUrl).toContain(photoKey);
            // Verify it's not a Supabase URL
            expect(photoUrl).not.toContain('supabase');
        }), {
            numRuns: 100
        });
    });
    it('should use Supabase domain for Supabase storage', ()=>{
        _fastcheck.assert(_fastcheck.property(supabaseDomainArbitrary, photoKeyArbitrary, (supabaseDomain, photoKey)=>{
            // Arrange
            const storageType = 'supabase';
            // Act - Generate URL based on storage type
            const photoUrl = `https://${supabaseDomain}/storage/v1/object/public/photos/${photoKey}`;
            // Assert - URL should contain the Supabase domain
            expect(photoUrl).toContain(supabaseDomain);
            expect(photoUrl).toContain('https://');
            expect(photoUrl).toContain('storage/v1/object/public');
            expect(photoUrl).toContain(photoKey);
        }), {
            numRuns: 100
        });
    });
    it('should maintain URL consistency with storage type', ()=>{
        _fastcheck.assert(_fastcheck.property(storageTypeArbitrary, b2CDNDomainArbitrary, supabaseDomainArbitrary, photoKeyArbitrary, (storageType, b2Domain, supabaseDomain, photoKey)=>{
            // Act - Generate URL based on storage type
            let photoUrl;
            if (storageType === 'b2') {
                photoUrl = `https://${b2Domain}/${photoKey}`;
            } else {
                photoUrl = `https://${supabaseDomain}/storage/v1/object/public/photos/${photoKey}`;
            }
            // Assert - URL domain should match storage type
            if (storageType === 'b2') {
                expect(photoUrl).toContain(b2Domain);
                expect(photoUrl).not.toContain('storage/v1/object/public');
            } else {
                expect(photoUrl).toContain(supabaseDomain);
                expect(photoUrl).toContain('storage/v1/object/public');
            }
            // All URLs should be HTTPS
            expect(photoUrl).toMatch(/^https:\/\//);
        }), {
            numRuns: 100
        });
    });
    it('should generate valid URLs for all storage types', ()=>{
        _fastcheck.assert(_fastcheck.property(storageTypeArbitrary, photoKeyArbitrary, (storageType, photoKey)=>{
            // Arrange
            const b2Domain = 'cdn.example.com';
            const supabaseDomain = 'supabase.example.com';
            // Act
            let photoUrl;
            if (storageType === 'b2') {
                photoUrl = `https://${b2Domain}/${photoKey}`;
            } else {
                photoUrl = `https://${supabaseDomain}/storage/v1/object/public/photos/${photoKey}`;
            }
            // Assert - URL should be valid
            expect(()=>new URL(photoUrl)).not.toThrow();
            const url = new URL(photoUrl);
            expect(url.protocol).toBe('https:');
            expect(url.hostname).toBeTruthy();
            expect(url.pathname).toContain(photoKey);
        }), {
            numRuns: 100
        });
    });
    it('should preserve photo key in URL regardless of storage type', ()=>{
        _fastcheck.assert(_fastcheck.property(storageTypeArbitrary, photoKeyArbitrary, (storageType, photoKey)=>{
            // Arrange
            const b2Domain = 'cdn.example.com';
            const supabaseDomain = 'supabase.example.com';
            // Act
            let photoUrl;
            if (storageType === 'b2') {
                photoUrl = `https://${b2Domain}/${photoKey}`;
            } else {
                photoUrl = `https://${supabaseDomain}/storage/v1/object/public/photos/${photoKey}`;
            }
            // Assert - Photo key should be present in URL
            expect(photoUrl).toContain(photoKey);
        }), {
            numRuns: 100
        });
    });
    it('should not mix B2 and Supabase URL patterns', ()=>{
        _fastcheck.assert(_fastcheck.property(storageTypeArbitrary, b2CDNDomainArbitrary, supabaseDomainArbitrary, photoKeyArbitrary, (storageType, b2Domain, supabaseDomain, photoKey)=>{
            // Act
            let photoUrl;
            if (storageType === 'b2') {
                photoUrl = `https://${b2Domain}/${photoKey}`;
            } else {
                photoUrl = `https://${supabaseDomain}/storage/v1/object/public/photos/${photoKey}`;
            }
            // Assert - B2 URLs should not have Supabase patterns and vice versa
            const hasB2Pattern = photoUrl.includes(b2Domain) && !photoUrl.includes('storage/v1/object/public');
            const hasSupabasePattern = photoUrl.includes('storage/v1/object/public');
            // Exactly one pattern should match
            expect(hasB2Pattern !== hasSupabasePattern).toBe(true);
        }), {
            numRuns: 100
        });
    });
    it('should generate consistent URLs for the same storage type and key', ()=>{
        _fastcheck.assert(_fastcheck.property(storageTypeArbitrary, photoKeyArbitrary, (storageType, photoKey)=>{
            // Arrange
            const b2Domain = 'cdn.example.com';
            const supabaseDomain = 'supabase.example.com';
            // Act - Generate URL twice with same inputs
            const generateUrl = (type, key)=>{
                if (type === 'b2') {
                    return `https://${b2Domain}/${key}`;
                } else {
                    return `https://${supabaseDomain}/storage/v1/object/public/photos/${key}`;
                }
            };
            const url1 = generateUrl(storageType, photoKey);
            const url2 = generateUrl(storageType, photoKey);
            // Assert - URLs should be identical
            expect(url1).toBe(url2);
        }), {
            numRuns: 100
        });
    });
    it('should use HTTPS protocol for all storage URLs', ()=>{
        _fastcheck.assert(_fastcheck.property(storageTypeArbitrary, photoKeyArbitrary, (storageType, photoKey)=>{
            // Arrange
            const b2Domain = 'cdn.example.com';
            const supabaseDomain = 'supabase.example.com';
            // Act
            let photoUrl;
            if (storageType === 'b2') {
                photoUrl = `https://${b2Domain}/${photoKey}`;
            } else {
                photoUrl = `https://${supabaseDomain}/storage/v1/object/public/photos/${photoKey}`;
            }
            // Assert - All URLs must use HTTPS
            expect(photoUrl).toMatch(/^https:\/\//);
            expect(photoUrl).not.toMatch(/^http:\/\//);
        }), {
            numRuns: 100
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvcGhvdG9TdG9yYWdlVVJMQ29uc2lzdGVuY3kucHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFByb3BlcnR5LWJhc2VkIHRlc3QgZm9yIHBob3RvIHN0b3JhZ2UgVVJMIGNvbnNpc3RlbmN5LlxuICogRmVhdHVyZTogZGVzdGluYXRpb24td2VkZGluZy1wbGF0Zm9ybSwgUHJvcGVydHkgMTY6IFBob3RvIFN0b3JhZ2UgVVJMIENvbnNpc3RlbmN5XG4gKiBWYWxpZGF0ZXM6IFJlcXVpcmVtZW50cyAxMi43XG4gKiBcbiAqIEZvciBhbnkgcGhvdG8gdXBsb2FkLCB0aGUgcGhvdG9fdXJsIHNhdmVkIGluIHRoZSBkYXRhYmFzZSBzaG91bGQgdXNlIHRoZSBkb21haW5cbiAqIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGFjdGl2ZSBzdG9yYWdlIG1ldGhvZCAoQ2xvdWRmbGFyZSBDRE4gZG9tYWluIGZvciBCMiBzdG9yYWdlLFxuICogU3VwYWJhc2UgZG9tYWluIGZvciBTdXBhYmFzZSBzdG9yYWdlKS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBmYyBmcm9tICdmYXN0LWNoZWNrJztcblxuZGVzY3JpYmUoJ0ZlYXR1cmU6IGRlc3RpbmF0aW9uLXdlZGRpbmctcGxhdGZvcm0sIFByb3BlcnR5IDE2OiBQaG90byBTdG9yYWdlIFVSTCBDb25zaXN0ZW5jeScsICgpID0+IHtcbiAgLy8gQXJiaXRyYXJpZXMgZm9yIGdlbmVyYXRpbmcgdGVzdCBkYXRhXG4gIGNvbnN0IHN0b3JhZ2VUeXBlQXJiaXRyYXJ5ID0gZmMuY29uc3RhbnRGcm9tKCdiMicsICdzdXBhYmFzZScpO1xuICBcbiAgY29uc3QgYjJDRE5Eb21haW5BcmJpdHJhcnkgPSBmYy5jb25zdGFudEZyb20oXG4gICAgJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgJ2YwMDAuYmFja2JsYXplYjIuY29tJyxcbiAgICAnY2RuLm15c2l0ZS5jb20nXG4gICk7XG4gIFxuICBjb25zdCBzdXBhYmFzZURvbWFpbkFyYml0cmFyeSA9IGZjLmNvbnN0YW50RnJvbShcbiAgICAnc3VwYWJhc2UuY28nLFxuICAgICdzdXBhYmFzZS5leGFtcGxlLmNvbScsXG4gICAgJ3N0b3JhZ2Uuc3VwYWJhc2UuY28nXG4gICk7XG4gIFxuICBjb25zdCBwaG90b0tleUFyYml0cmFyeSA9IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMTAsIG1heExlbmd0aDogMTAwIH0pLm1hcChcbiAgICBzID0+IGBwaG90b3MvJHtEYXRlLm5vdygpfS0ke3MucmVwbGFjZSgvW15hLXpBLVowLTkuXy1dL2csICdfJyl9LmpwZ2BcbiAgKTtcblxuICBpdCgnc2hvdWxkIHVzZSBDbG91ZGZsYXJlIENETiBkb21haW4gZm9yIEIyIHN0b3JhZ2UnLCAoKSA9PiB7XG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgIGIyQ0RORG9tYWluQXJiaXRyYXJ5LFxuICAgICAgICBwaG90b0tleUFyYml0cmFyeSxcbiAgICAgICAgKGNkbkRvbWFpbiwgcGhvdG9LZXkpID0+IHtcbiAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgY29uc3Qgc3RvcmFnZVR5cGUgPSAnYjInO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFjdCAtIEdlbmVyYXRlIFVSTCBiYXNlZCBvbiBzdG9yYWdlIHR5cGVcbiAgICAgICAgICBjb25zdCBwaG90b1VybCA9IGBodHRwczovLyR7Y2RuRG9tYWlufS8ke3Bob3RvS2V5fWA7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQXNzZXJ0IC0gVVJMIHNob3VsZCBjb250YWluIHRoZSBDRE4gZG9tYWluXG4gICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS50b0NvbnRhaW4oY2RuRG9tYWluKTtcbiAgICAgICAgICBleHBlY3QocGhvdG9VcmwpLnRvQ29udGFpbignaHR0cHM6Ly8nKTtcbiAgICAgICAgICBleHBlY3QocGhvdG9VcmwpLnRvQ29udGFpbihwaG90b0tleSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVmVyaWZ5IGl0J3Mgbm90IGEgU3VwYWJhc2UgVVJMXG4gICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS5ub3QudG9Db250YWluKCdzdXBhYmFzZScpO1xuICAgICAgICB9XG4gICAgICApLFxuICAgICAgeyBudW1SdW5zOiAxMDAgfVxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdXNlIFN1cGFiYXNlIGRvbWFpbiBmb3IgU3VwYWJhc2Ugc3RvcmFnZScsICgpID0+IHtcbiAgICBmYy5hc3NlcnQoXG4gICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgc3VwYWJhc2VEb21haW5BcmJpdHJhcnksXG4gICAgICAgIHBob3RvS2V5QXJiaXRyYXJ5LFxuICAgICAgICAoc3VwYWJhc2VEb21haW4sIHBob3RvS2V5KSA9PiB7XG4gICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgIGNvbnN0IHN0b3JhZ2VUeXBlID0gJ3N1cGFiYXNlJztcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBY3QgLSBHZW5lcmF0ZSBVUkwgYmFzZWQgb24gc3RvcmFnZSB0eXBlXG4gICAgICAgICAgY29uc3QgcGhvdG9VcmwgPSBgaHR0cHM6Ly8ke3N1cGFiYXNlRG9tYWlufS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvcGhvdG9zLyR7cGhvdG9LZXl9YDtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBc3NlcnQgLSBVUkwgc2hvdWxkIGNvbnRhaW4gdGhlIFN1cGFiYXNlIGRvbWFpblxuICAgICAgICAgIGV4cGVjdChwaG90b1VybCkudG9Db250YWluKHN1cGFiYXNlRG9tYWluKTtcbiAgICAgICAgICBleHBlY3QocGhvdG9VcmwpLnRvQ29udGFpbignaHR0cHM6Ly8nKTtcbiAgICAgICAgICBleHBlY3QocGhvdG9VcmwpLnRvQ29udGFpbignc3RvcmFnZS92MS9vYmplY3QvcHVibGljJyk7XG4gICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS50b0NvbnRhaW4ocGhvdG9LZXkpO1xuICAgICAgICB9XG4gICAgICApLFxuICAgICAgeyBudW1SdW5zOiAxMDAgfVxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbWFpbnRhaW4gVVJMIGNvbnNpc3RlbmN5IHdpdGggc3RvcmFnZSB0eXBlJywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICBzdG9yYWdlVHlwZUFyYml0cmFyeSxcbiAgICAgICAgYjJDRE5Eb21haW5BcmJpdHJhcnksXG4gICAgICAgIHN1cGFiYXNlRG9tYWluQXJiaXRyYXJ5LFxuICAgICAgICBwaG90b0tleUFyYml0cmFyeSxcbiAgICAgICAgKHN0b3JhZ2VUeXBlLCBiMkRvbWFpbiwgc3VwYWJhc2VEb21haW4sIHBob3RvS2V5KSA9PiB7XG4gICAgICAgICAgLy8gQWN0IC0gR2VuZXJhdGUgVVJMIGJhc2VkIG9uIHN0b3JhZ2UgdHlwZVxuICAgICAgICAgIGxldCBwaG90b1VybDogc3RyaW5nO1xuICAgICAgICAgIGlmIChzdG9yYWdlVHlwZSA9PT0gJ2IyJykge1xuICAgICAgICAgICAgcGhvdG9VcmwgPSBgaHR0cHM6Ly8ke2IyRG9tYWlufS8ke3Bob3RvS2V5fWA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBob3RvVXJsID0gYGh0dHBzOi8vJHtzdXBhYmFzZURvbWFpbn0vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL3Bob3Rvcy8ke3Bob3RvS2V5fWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFzc2VydCAtIFVSTCBkb21haW4gc2hvdWxkIG1hdGNoIHN0b3JhZ2UgdHlwZVxuICAgICAgICAgIGlmIChzdG9yYWdlVHlwZSA9PT0gJ2IyJykge1xuICAgICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS50b0NvbnRhaW4oYjJEb21haW4pO1xuICAgICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS5ub3QudG9Db250YWluKCdzdG9yYWdlL3YxL29iamVjdC9wdWJsaWMnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS50b0NvbnRhaW4oc3VwYWJhc2VEb21haW4pO1xuICAgICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS50b0NvbnRhaW4oJ3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYycpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBbGwgVVJMcyBzaG91bGQgYmUgSFRUUFNcbiAgICAgICAgICBleHBlY3QocGhvdG9VcmwpLnRvTWF0Y2goL15odHRwczpcXC9cXC8vKTtcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdlbmVyYXRlIHZhbGlkIFVSTHMgZm9yIGFsbCBzdG9yYWdlIHR5cGVzJywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICBzdG9yYWdlVHlwZUFyYml0cmFyeSxcbiAgICAgICAgcGhvdG9LZXlBcmJpdHJhcnksXG4gICAgICAgIChzdG9yYWdlVHlwZSwgcGhvdG9LZXkpID0+IHtcbiAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgY29uc3QgYjJEb21haW4gPSAnY2RuLmV4YW1wbGUuY29tJztcbiAgICAgICAgICBjb25zdCBzdXBhYmFzZURvbWFpbiA9ICdzdXBhYmFzZS5leGFtcGxlLmNvbSc7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgbGV0IHBob3RvVXJsOiBzdHJpbmc7XG4gICAgICAgICAgaWYgKHN0b3JhZ2VUeXBlID09PSAnYjInKSB7XG4gICAgICAgICAgICBwaG90b1VybCA9IGBodHRwczovLyR7YjJEb21haW59LyR7cGhvdG9LZXl9YDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGhvdG9VcmwgPSBgaHR0cHM6Ly8ke3N1cGFiYXNlRG9tYWlufS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvcGhvdG9zLyR7cGhvdG9LZXl9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQXNzZXJ0IC0gVVJMIHNob3VsZCBiZSB2YWxpZFxuICAgICAgICAgIGV4cGVjdCgoKSA9PiBuZXcgVVJMKHBob3RvVXJsKSkubm90LnRvVGhyb3coKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHBob3RvVXJsKTtcbiAgICAgICAgICBleHBlY3QodXJsLnByb3RvY29sKS50b0JlKCdodHRwczonKTtcbiAgICAgICAgICBleHBlY3QodXJsLmhvc3RuYW1lKS50b0JlVHJ1dGh5KCk7XG4gICAgICAgICAgZXhwZWN0KHVybC5wYXRobmFtZSkudG9Db250YWluKHBob3RvS2V5KTtcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHByZXNlcnZlIHBob3RvIGtleSBpbiBVUkwgcmVnYXJkbGVzcyBvZiBzdG9yYWdlIHR5cGUnLCAoKSA9PiB7XG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgIHN0b3JhZ2VUeXBlQXJiaXRyYXJ5LFxuICAgICAgICBwaG90b0tleUFyYml0cmFyeSxcbiAgICAgICAgKHN0b3JhZ2VUeXBlLCBwaG90b0tleSkgPT4ge1xuICAgICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgICBjb25zdCBiMkRvbWFpbiA9ICdjZG4uZXhhbXBsZS5jb20nO1xuICAgICAgICAgIGNvbnN0IHN1cGFiYXNlRG9tYWluID0gJ3N1cGFiYXNlLmV4YW1wbGUuY29tJztcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBY3RcbiAgICAgICAgICBsZXQgcGhvdG9Vcmw6IHN0cmluZztcbiAgICAgICAgICBpZiAoc3RvcmFnZVR5cGUgPT09ICdiMicpIHtcbiAgICAgICAgICAgIHBob3RvVXJsID0gYGh0dHBzOi8vJHtiMkRvbWFpbn0vJHtwaG90b0tleX1gO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwaG90b1VybCA9IGBodHRwczovLyR7c3VwYWJhc2VEb21haW59L3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9waG90b3MvJHtwaG90b0tleX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBc3NlcnQgLSBQaG90byBrZXkgc2hvdWxkIGJlIHByZXNlbnQgaW4gVVJMXG4gICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS50b0NvbnRhaW4ocGhvdG9LZXkpO1xuICAgICAgICB9XG4gICAgICApLFxuICAgICAgeyBudW1SdW5zOiAxMDAgfVxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbm90IG1peCBCMiBhbmQgU3VwYWJhc2UgVVJMIHBhdHRlcm5zJywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICBzdG9yYWdlVHlwZUFyYml0cmFyeSxcbiAgICAgICAgYjJDRE5Eb21haW5BcmJpdHJhcnksXG4gICAgICAgIHN1cGFiYXNlRG9tYWluQXJiaXRyYXJ5LFxuICAgICAgICBwaG90b0tleUFyYml0cmFyeSxcbiAgICAgICAgKHN0b3JhZ2VUeXBlLCBiMkRvbWFpbiwgc3VwYWJhc2VEb21haW4sIHBob3RvS2V5KSA9PiB7XG4gICAgICAgICAgLy8gQWN0XG4gICAgICAgICAgbGV0IHBob3RvVXJsOiBzdHJpbmc7XG4gICAgICAgICAgaWYgKHN0b3JhZ2VUeXBlID09PSAnYjInKSB7XG4gICAgICAgICAgICBwaG90b1VybCA9IGBodHRwczovLyR7YjJEb21haW59LyR7cGhvdG9LZXl9YDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGhvdG9VcmwgPSBgaHR0cHM6Ly8ke3N1cGFiYXNlRG9tYWlufS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvcGhvdG9zLyR7cGhvdG9LZXl9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQXNzZXJ0IC0gQjIgVVJMcyBzaG91bGQgbm90IGhhdmUgU3VwYWJhc2UgcGF0dGVybnMgYW5kIHZpY2UgdmVyc2FcbiAgICAgICAgICBjb25zdCBoYXNCMlBhdHRlcm4gPSBwaG90b1VybC5pbmNsdWRlcyhiMkRvbWFpbikgJiYgIXBob3RvVXJsLmluY2x1ZGVzKCdzdG9yYWdlL3YxL29iamVjdC9wdWJsaWMnKTtcbiAgICAgICAgICBjb25zdCBoYXNTdXBhYmFzZVBhdHRlcm4gPSBwaG90b1VybC5pbmNsdWRlcygnc3RvcmFnZS92MS9vYmplY3QvcHVibGljJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRXhhY3RseSBvbmUgcGF0dGVybiBzaG91bGQgbWF0Y2hcbiAgICAgICAgICBleHBlY3QoaGFzQjJQYXR0ZXJuICE9PSBoYXNTdXBhYmFzZVBhdHRlcm4pLnRvQmUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDEwMCB9XG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjb25zaXN0ZW50IFVSTHMgZm9yIHRoZSBzYW1lIHN0b3JhZ2UgdHlwZSBhbmQga2V5JywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICBzdG9yYWdlVHlwZUFyYml0cmFyeSxcbiAgICAgICAgcGhvdG9LZXlBcmJpdHJhcnksXG4gICAgICAgIChzdG9yYWdlVHlwZSwgcGhvdG9LZXkpID0+IHtcbiAgICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgICAgY29uc3QgYjJEb21haW4gPSAnY2RuLmV4YW1wbGUuY29tJztcbiAgICAgICAgICBjb25zdCBzdXBhYmFzZURvbWFpbiA9ICdzdXBhYmFzZS5leGFtcGxlLmNvbSc7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWN0IC0gR2VuZXJhdGUgVVJMIHR3aWNlIHdpdGggc2FtZSBpbnB1dHNcbiAgICAgICAgICBjb25zdCBnZW5lcmF0ZVVybCA9ICh0eXBlOiBzdHJpbmcsIGtleTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2IyJykge1xuICAgICAgICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHtiMkRvbWFpbn0vJHtrZXl9YDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBgaHR0cHM6Ly8ke3N1cGFiYXNlRG9tYWlufS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvcGhvdG9zLyR7a2V5fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCB1cmwxID0gZ2VuZXJhdGVVcmwoc3RvcmFnZVR5cGUsIHBob3RvS2V5KTtcbiAgICAgICAgICBjb25zdCB1cmwyID0gZ2VuZXJhdGVVcmwoc3RvcmFnZVR5cGUsIHBob3RvS2V5KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBc3NlcnQgLSBVUkxzIHNob3VsZCBiZSBpZGVudGljYWxcbiAgICAgICAgICBleHBlY3QodXJsMSkudG9CZSh1cmwyKTtcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHVzZSBIVFRQUyBwcm90b2NvbCBmb3IgYWxsIHN0b3JhZ2UgVVJMcycsICgpID0+IHtcbiAgICBmYy5hc3NlcnQoXG4gICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgc3RvcmFnZVR5cGVBcmJpdHJhcnksXG4gICAgICAgIHBob3RvS2V5QXJiaXRyYXJ5LFxuICAgICAgICAoc3RvcmFnZVR5cGUsIHBob3RvS2V5KSA9PiB7XG4gICAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICAgIGNvbnN0IGIyRG9tYWluID0gJ2Nkbi5leGFtcGxlLmNvbSc7XG4gICAgICAgICAgY29uc3Qgc3VwYWJhc2VEb21haW4gPSAnc3VwYWJhc2UuZXhhbXBsZS5jb20nO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFjdFxuICAgICAgICAgIGxldCBwaG90b1VybDogc3RyaW5nO1xuICAgICAgICAgIGlmIChzdG9yYWdlVHlwZSA9PT0gJ2IyJykge1xuICAgICAgICAgICAgcGhvdG9VcmwgPSBgaHR0cHM6Ly8ke2IyRG9tYWlufS8ke3Bob3RvS2V5fWA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBob3RvVXJsID0gYGh0dHBzOi8vJHtzdXBhYmFzZURvbWFpbn0vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL3Bob3Rvcy8ke3Bob3RvS2V5fWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFzc2VydCAtIEFsbCBVUkxzIG11c3QgdXNlIEhUVFBTXG4gICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS50b01hdGNoKC9eaHR0cHM6XFwvXFwvLyk7XG4gICAgICAgICAgZXhwZWN0KHBob3RvVXJsKS5ub3QudG9NYXRjaCgvXmh0dHA6XFwvXFwvLyk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDEwMCB9XG4gICAgKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJkZXNjcmliZSIsInN0b3JhZ2VUeXBlQXJiaXRyYXJ5IiwiZmMiLCJjb25zdGFudEZyb20iLCJiMkNETkRvbWFpbkFyYml0cmFyeSIsInN1cGFiYXNlRG9tYWluQXJiaXRyYXJ5IiwicGhvdG9LZXlBcmJpdHJhcnkiLCJzdHJpbmciLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJtYXAiLCJzIiwiRGF0ZSIsIm5vdyIsInJlcGxhY2UiLCJpdCIsImFzc2VydCIsInByb3BlcnR5IiwiY2RuRG9tYWluIiwicGhvdG9LZXkiLCJzdG9yYWdlVHlwZSIsInBob3RvVXJsIiwiZXhwZWN0IiwidG9Db250YWluIiwibm90IiwibnVtUnVucyIsInN1cGFiYXNlRG9tYWluIiwiYjJEb21haW4iLCJ0b01hdGNoIiwiVVJMIiwidG9UaHJvdyIsInVybCIsInByb3RvY29sIiwidG9CZSIsImhvc3RuYW1lIiwidG9CZVRydXRoeSIsInBhdGhuYW1lIiwiaGFzQjJQYXR0ZXJuIiwiaW5jbHVkZXMiLCJoYXNTdXBhYmFzZVBhdHRlcm4iLCJnZW5lcmF0ZVVybCIsInR5cGUiLCJrZXkiLCJ1cmwxIiwidXJsMiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0NBUUM7Ozs7bUVBRW1COzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFcEJBLFNBQVMscUZBQXFGO0lBQzVGLHVDQUF1QztJQUN2QyxNQUFNQyx1QkFBdUJDLFdBQUdDLFlBQVksQ0FBQyxNQUFNO0lBRW5ELE1BQU1DLHVCQUF1QkYsV0FBR0MsWUFBWSxDQUMxQyxtQkFDQSx3QkFDQTtJQUdGLE1BQU1FLDBCQUEwQkgsV0FBR0MsWUFBWSxDQUM3QyxlQUNBLHdCQUNBO0lBR0YsTUFBTUcsb0JBQW9CSixXQUFHSyxNQUFNLENBQUM7UUFBRUMsV0FBVztRQUFJQyxXQUFXO0lBQUksR0FBR0MsR0FBRyxDQUN4RUMsQ0FBQUEsSUFBSyxDQUFDLE9BQU8sRUFBRUMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUYsRUFBRUcsT0FBTyxDQUFDLG9CQUFvQixLQUFLLElBQUksQ0FBQztJQUd2RUMsR0FBRyxtREFBbUQ7UUFDcERiLFdBQUdjLE1BQU0sQ0FDUGQsV0FBR2UsUUFBUSxDQUNUYixzQkFDQUUsbUJBQ0EsQ0FBQ1ksV0FBV0M7WUFDVixVQUFVO1lBQ1YsTUFBTUMsY0FBYztZQUVwQiwyQ0FBMkM7WUFDM0MsTUFBTUMsV0FBVyxDQUFDLFFBQVEsRUFBRUgsVUFBVSxDQUFDLEVBQUVDLFVBQVU7WUFFbkQsNkNBQTZDO1lBQzdDRyxPQUFPRCxVQUFVRSxTQUFTLENBQUNMO1lBQzNCSSxPQUFPRCxVQUFVRSxTQUFTLENBQUM7WUFDM0JELE9BQU9ELFVBQVVFLFNBQVMsQ0FBQ0o7WUFFM0IsaUNBQWlDO1lBQ2pDRyxPQUFP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