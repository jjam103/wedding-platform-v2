{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/locationsApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Test: Locations API\n * \n * Tests authenticated requests, validation errors, CRUD operations,\n * circular reference detection, and error responses for locations API endpoints.\n */\n\n// Polyfill Web APIs for Next.js server components\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder as any;\n\n// Mock location service BEFORE importing route handlers\njest.mock('@/services/locationService', () => ({\n  create: jest.fn(),\n  get: jest.fn(),\n  update: jest.fn(),\n  deleteLocation: jest.fn(),\n  getHierarchy: jest.fn(),\n  list: jest.fn(),\n}));\n\n// Mock Next.js server module\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n  NextRequest: jest.fn(),\n}));\n\n// Mock Next.js headers and cookies\njest.mock('next/headers', () => ({\n  cookies: jest.fn(() => ({\n    get: jest.fn(),\n    getAll: jest.fn(() => []),\n    set: jest.fn(),\n    delete: jest.fn(),\n  })),\n}));\n\n// Mock Supabase SSR client\nconst mockGetUser = jest.fn();\nconst mockGetSession = jest.fn();\nconst mockSupabaseClient = {\n  auth: {\n    getUser: mockGetUser,\n    getSession: mockGetSession,\n  },\n  from: jest.fn(),\n};\n\njest.mock('@supabase/ssr', () => ({\n  createServerClient: jest.fn(() => mockSupabaseClient),\n}));\n\nimport { GET, POST } from '@/app/api/admin/locations/route';\nimport {\n  GET as GET_BY_ID,\n  PUT,\n  DELETE,\n} from '@/app/api/admin/locations/[id]/route';\nimport { POST as VALIDATE_PARENT } from '@/app/api/admin/locations/[id]/validate-parent/route';\nimport * as locationService from '@/services/locationService';\n\ndescribe('Locations API Integration Tests', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Default: authenticated user\n    mockGetUser.mockResolvedValue({\n      data: {\n        user: { id: 'user-1', email: 'admin@example.com' },\n      },\n      error: null,\n    } as any);\n    \n    // Default: valid session\n    mockGetSession.mockResolvedValue({\n      data: {\n        session: { user: { id: 'user-1', email: 'admin@example.com' } },\n      },\n      error: null,\n    } as any);\n  });\n\n  describe('GET /api/admin/locations', () => {\n    it('should return location hierarchy when authenticated', async () => {\n      const mockHierarchy = [\n        {\n          id: 'loc-1',\n          name: 'Costa Rica',\n          parentLocationId: null,\n          address: null,\n          coordinates: null,\n          description: null,\n          createdAt: '2025-01-01T00:00:00Z',\n          children: [],\n        },\n      ];\n\n      (locationService.getHierarchy as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockHierarchy,\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations',\n      } as any;\n\n      const response = await GET(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockHierarchy);\n    });\n\n    it('should return 500 when service fails', async () => {\n      (locationService.getHierarchy as jest.Mock).mockResolvedValue({\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: 'Database error' },\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations',\n      } as any;\n\n      const response = await GET(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n    });\n  });\n\n  describe('POST /api/admin/locations', () => {\n    it('should create location with valid data', async () => {\n      const newLocation = {\n        id: 'loc-1',\n        name: 'Costa Rica',\n        parentLocationId: null,\n        address: null,\n        coordinates: null,\n        description: null,\n        createdAt: '2025-01-01T00:00:00Z',\n      };\n\n      (locationService.create as jest.Mock).mockResolvedValue({\n        success: true,\n        data: newLocation,\n      } as any);\n\n      const request = {\n        json: async () => ({ name: 'Costa Rica' }),\n        url: 'http://localhost:3000/api/admin/locations',\n      } as any;\n\n      const response = await POST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(newLocation);\n    });\n\n    it('should return 400 for validation errors', async () => {\n      const request = {\n        json: async () => ({ name: '' }), // Invalid: empty name\n        url: 'http://localhost:3000/api/admin/locations',\n      } as any;\n\n      const response = await POST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 400 for invalid parent location ID format', async () => {\n      const request = {\n        json: async () => ({\n          name: 'New Location',\n          parentLocationId: 'invalid-id', // Invalid UUID format\n        }),\n        url: 'http://localhost:3000/api/admin/locations',\n      } as any;\n\n      const response = await POST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 409 for circular reference from service', async () => {\n      (locationService.create as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'CIRCULAR_REFERENCE',\n          message: 'This would create a circular reference',\n        },\n      } as any);\n\n      const request = {\n        json: async () => ({\n          name: 'New Location',\n          parentLocationId: '123e4567-e89b-12d3-a456-426614174000', // Valid UUID\n        }),\n        url: 'http://localhost:3000/api/admin/locations',\n      } as any;\n\n      const response = await POST(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(409);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('CIRCULAR_REFERENCE');\n    });\n  });\n\n  describe('GET /api/admin/locations/:id', () => {\n    it('should return location by ID', async () => {\n      const mockLocation = {\n        id: 'loc-1',\n        name: 'Costa Rica',\n        parentLocationId: null,\n        address: null,\n        coordinates: null,\n        description: null,\n        createdAt: '2025-01-01T00:00:00Z',\n      };\n\n      (locationService.get as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockLocation,\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations/loc-1',\n      } as any;\n\n      const response = await GET_BY_ID(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockLocation);\n    });\n\n    it('should return 404 when location not found', async () => {\n      (locationService.get as jest.Mock).mockResolvedValue({\n        success: false,\n        error: { code: 'NOT_FOUND', message: 'Location not found' },\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations/invalid-id',\n      } as any;\n\n      const response = await GET_BY_ID(request, { params: Promise.resolve({ id: 'invalid-id' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n  });\n\n  describe('PUT /api/admin/locations/:id', () => {\n    it('should update location with valid data', async () => {\n      const updatedLocation = {\n        id: 'loc-1',\n        name: 'Updated Name',\n        parentLocationId: null,\n        address: 'New Address',\n        coordinates: null,\n        description: null,\n        createdAt: '2025-01-01T00:00:00Z',\n      };\n\n      (locationService.update as jest.Mock).mockResolvedValue({\n        success: true,\n        data: updatedLocation,\n      } as any);\n\n      const request = {\n        json: async () => ({ name: 'Updated Name', address: 'New Address' }),\n        url: 'http://localhost:3000/api/admin/locations/loc-1',\n      } as any;\n\n      const response = await PUT(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(updatedLocation);\n    });\n\n    it('should return 404 when location not found', async () => {\n      (locationService.update as jest.Mock).mockResolvedValue({\n        success: false,\n        error: { code: 'NOT_FOUND', message: 'Location not found' },\n      } as any);\n\n      const request = {\n        json: async () => ({ name: 'Updated Name' }),\n        url: 'http://localhost:3000/api/admin/locations/invalid-id',\n      } as any;\n\n      const response = await PUT(request, { params: Promise.resolve({ id: 'invalid-id' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should return 409 for circular reference from service', async () => {\n      (locationService.update as jest.Mock).mockResolvedValue({\n        success: false,\n        error: {\n          code: 'CIRCULAR_REFERENCE',\n          message: 'This would create a circular reference',\n        },\n      } as any);\n\n      const request = {\n        json: async () => ({ parentLocationId: '123e4567-e89b-12d3-a456-426614174000' }), // Valid UUID\n        url: 'http://localhost:3000/api/admin/locations/loc-1',\n      } as any;\n\n      const response = await PUT(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(409);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('CIRCULAR_REFERENCE');\n    });\n  });\n\n  describe('DELETE /api/admin/locations/:id', () => {\n    it('should delete location successfully', async () => {\n      (locationService.deleteLocation as jest.Mock).mockResolvedValue({\n        success: true,\n        data: undefined,\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations/loc-1',\n      } as any;\n\n      const response = await DELETE(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n    });\n\n    it('should return 500 when deletion fails', async () => {\n      (locationService.deleteLocation as jest.Mock).mockResolvedValue({\n        success: false,\n        error: { code: 'DATABASE_ERROR', message: 'Failed to delete' },\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations/loc-1',\n      } as any;\n\n      const response = await DELETE(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n    });\n  });\n\n  describe('POST /api/admin/locations/:id/validate-parent', () => {\n    it('should validate parent successfully when no circular reference', async () => {\n      const request = {\n        json: async () => ({ parentLocationId: 'loc-3' }),\n        url: 'http://localhost:3000/api/admin/locations/loc-1/validate-parent',\n      } as any;\n\n      const response = await VALIDATE_PARENT(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.valid).toBe(true);\n    });\n\n    it('should return 409 when circular reference detected', async () => {\n      const request = {\n        json: async () => ({ parentLocationId: 'loc-1' }), // Self as parent\n        url: 'http://localhost:3000/api/admin/locations/loc-1/validate-parent',\n      } as any;\n\n      const response = await VALIDATE_PARENT(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(409);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('CIRCULAR_REFERENCE');\n    });\n\n    it('should return 400 when parentLocationId missing', async () => {\n      const request = {\n        json: async () => ({}),\n        url: 'http://localhost:3000/api/admin/locations/loc-1/validate-parent',\n      } as any;\n\n      const response = await VALIDATE_PARENT(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n  });\n\n  describe('Tree Structure Retrieval', () => {\n    it('should return hierarchical tree structure', async () => {\n      const mockHierarchy = [\n        {\n          id: 'loc-1',\n          name: 'Costa Rica',\n          parentLocationId: null,\n          address: null,\n          coordinates: null,\n          description: null,\n          createdAt: '2025-01-01T00:00:00Z',\n          children: [\n            {\n              id: 'loc-2',\n              name: 'Guanacaste',\n              parentLocationId: 'loc-1',\n              address: null,\n              coordinates: null,\n              description: null,\n              createdAt: '2025-01-01T00:00:00Z',\n              children: [],\n            },\n          ],\n        },\n      ];\n\n      (locationService.getHierarchy as jest.Mock).mockResolvedValue({\n        success: true,\n        data: mockHierarchy,\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations',\n      } as any;\n\n      const response = await GET(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data[0].children).toBeDefined();\n      expect(data.data[0].children.length).toBe(1);\n    });\n  });\n\n  describe('Cascade Deletion', () => {\n    it('should handle cascade deletion (children become orphans)', async () => {\n      // This is handled by the database trigger, but we test the API behavior\n      (locationService.deleteLocation as jest.Mock).mockResolvedValue({\n        success: true,\n        data: undefined,\n      } as any);\n\n      const request = {\n        url: 'http://localhost:3000/api/admin/locations/loc-1',\n      } as any;\n\n      const response = await DELETE(request, { params: Promise.resolve({ id: 'loc-1' }) });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(locationService.deleteLocation).toHaveBeenCalledWith('loc-1');\n    });\n  });\n});\n"],"names":["jest","mock","create","fn","get","update","deleteLocation","getHierarchy","list","NextResponse","json","data","init","status","NextRequest","cookies","getAll","set","delete","createServerClient","mockSupabaseClient","global","TextEncoder","TextDecoder","mockGetUser","mockGetSession","auth","getUser","getSession","from","describe","beforeEach","clearAllMocks","mockResolvedValue","user","id","email","error","session","it","mockHierarchy","name","parentLocationId","address","coordinates","description","createdAt","children","locationService","success","request","url","response","GET","expect","toBe","toEqual","code","message","newLocation","POST","mockLocation","GET_BY_ID","params","Promise","resolve","updatedLocation","PUT","undefined","DELETE","VALIDATE_PARENT","valid","toBeDefined","length","toHaveBeenCalledWith"],"mappings":"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"}