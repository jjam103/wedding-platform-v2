{"version":3,"names":["DELETE","cov_m3sv95cbk","f","s","GET","PUT","request","params","supabase","_supabaseServer","createAuthenticatedClient","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","id","result","_emailService","getTemplate","Error","body","validation","_emailSchemas","updateEmailTemplateSchema","safeParse","details","issues","updateTemplate","deleteTemplate"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/emails/templates/[id]/route.ts"],"sourcesContent":["import { createAuthenticatedClient } from '@/lib/supabaseServer';\nimport { NextResponse } from 'next/server';\nimport { getTemplate, updateTemplate, deleteTemplate } from '@/services/emailService';\nimport { updateEmailTemplateSchema } from '@/schemas/emailSchemas';\n\n/**\n * GET /api/admin/emails/templates/[id]\n * Fetches a specific email template by ID.\n * Requirements: 8.4\n */\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Auth check\n    const supabase = await createAuthenticatedClient();\n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n        },\n        { status: 401 }\n      );\n    }\n\n    // 2. Get template ID from params\n    const { id } = await params;\n\n    // 3. Fetch template\n    const result = await getTemplate(id);\n\n    if (!result.success) {\n      const status = result.error.code === 'NOT_FOUND' ? 404 : 500;\n      return NextResponse.json(result, { status });\n    }\n\n    return NextResponse.json(result, { status: 200 });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PUT /api/admin/emails/templates/[id]\n * Updates a specific email template.\n * Requirements: 8.4\n */\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Auth check\n    const supabase = await createAuthenticatedClient();\n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n        },\n        { status: 401 }\n      );\n    }\n\n    // 2. Get template ID from params\n    const { id } = await params;\n\n    // 3. Parse and validate\n    const body = await request.json();\n    const validation = updateEmailTemplateSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid request',\n            details: validation.error.issues,\n          },\n        },\n        { status: 400 }\n      );\n    }\n\n    // 4. Update template\n    const result = await updateTemplate(id, validation.data);\n\n    if (!result.success) {\n      const status = result.error.code === 'NOT_FOUND' ? 404 : 500;\n      return NextResponse.json(result, { status });\n    }\n\n    return NextResponse.json(result, { status: 200 });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/admin/emails/templates/[id]\n * Deletes a specific email template.\n * Requirements: 8.4\n */\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Auth check\n    const supabase = await createAuthenticatedClient();\n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n        },\n        { status: 401 }\n      );\n    }\n\n    // 2. Get template ID from params\n    const { id } = await params;\n\n    // 3. Delete template\n    const result = await deleteTemplate(id);\n\n    if (!result.success) {\n      const status = result.error.code === 'NOT_FOUND' ? 404 : 500;\n      return NextResponse.json(result, { status });\n    }\n\n    return NextResponse.json(result, { status: 200 });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}