{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/budgetApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Test: Budget API\n * \n * Tests budget calculation, payment status reporting, and subsidy tracking\n * for budget management API endpoints.\n */\n\n// Polyfill Web APIs for Next.js server components\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder as any;\n\n// Mock budget service BEFORE importing route handlers\njest.mock('@/services/budgetService', () => ({\n  calculateTotal: jest.fn(),\n  getSummary: jest.fn(),\n  getPaymentStatusReport: jest.fn(),\n  trackSubsidies: jest.fn(),\n  generateReport: jest.fn(),\n}));\n\n// Mock Next.js server module\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n  NextRequest: jest.fn(),\n}));\n\n// Mock Next.js headers and cookies\njest.mock('next/headers', () => ({\n  cookies: jest.fn(() => ({\n    get: jest.fn(),\n    getAll: jest.fn(() => []),\n    set: jest.fn(),\n    delete: jest.fn(),\n  })),\n}));\n\n// Mock Supabase SSR client\nconst mockGetSession = jest.fn();\nconst mockSupabaseClient = {\n  auth: {\n    getSession: mockGetSession,\n  },\n  from: jest.fn(),\n};\n\njest.mock('@supabase/ssr', () => ({\n  createServerClient: jest.fn(() => mockSupabaseClient),\n}));\n\nimport { GET as GET_BUDGET_BREAKDOWN } from '@/app/api/admin/budget/breakdown/route';\nimport { GET as GET_PAYMENT_STATUS } from '@/app/api/admin/budget/payment-status/route';\nimport { GET as GET_SUBSIDIES } from '@/app/api/admin/budget/subsidies/route';\nimport * as budgetService from '@/services/budgetService';\n\ndescribe('Budget API Integration Tests', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Default: valid session\n    mockGetSession.mockResolvedValue({\n      data: {\n        session: { user: { id: 'user-1', email: 'admin@example.com' } },\n      },\n      error: null,\n    } as any);\n  });\n\n  describe('Budget Breakdown', () => {\n    describe('GET /api/admin/budget/breakdown', () => {\n      it('should return comprehensive budget breakdown', async () => {\n        const mockBreakdown = {\n          vendors: [\n            {\n              category: 'photography',\n              totalCost: 2500,\n              amountPaid: 1000,\n              balanceDue: 1500,\n              vendors: [\n                {\n                  id: 'vendor-1',\n                  name: 'Costa Rica Photography',\n                  cost: 2500,\n                  paid: 1000,\n                  balance: 1500,\n                  paymentStatus: 'partial',\n                },\n              ],\n            },\n          ],\n          activities: {\n            totalCost: 5000,\n            totalSubsidy: 1000,\n            netCost: 4000,\n            activities: [\n              {\n                id: 'activity-1',\n                name: 'Beach Volleyball',\n                costPerPerson: 25,\n                hostSubsidy: 5,\n                estimatedAttendees: 20,\n                totalCost: 500,\n                netCost: 400,\n              },\n            ],\n          },\n          accommodations: {\n            totalCost: 0,\n            totalSubsidy: 0,\n            netCost: 0,\n            accommodations: [],\n          },\n          totals: {\n            grossTotal: 7500,\n            totalSubsidies: 1000,\n            totalPaid: 1000,\n            netTotal: 6500,\n            balanceDue: 5500,\n          },\n        };\n\n        (budgetService.calculateTotal as jest.Mock).mockResolvedValue({\n          success: true,\n          data: mockBreakdown,\n        } as any);\n\n        const request = {\n          url: 'http://localhost:3000/api/admin/budget/breakdown',\n        } as any;\n\n        const response = await GET_BUDGET_BREAKDOWN();\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data).toEqual(mockBreakdown);\n        expect(budgetService.calculateTotal).toHaveBeenCalledWith({\n          includeVendors: true,\n          includeActivities: true,\n          includeAccommodations: true,\n        });\n      });\n\n      it('should return 401 when not authenticated', async () => {\n        mockGetSession.mockResolvedValue({\n          data: { session: null },\n          error: null,\n        } as any);\n\n        const response = await GET_BUDGET_BREAKDOWN();\n        const data = await response.json();\n\n        expect(response.status).toBe(401);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNAUTHORIZED');\n      });\n\n      it('should return 500 for service errors', async () => {\n        (budgetService.calculateTotal as jest.Mock).mockResolvedValue({\n          success: false,\n          error: {\n            code: 'DATABASE_ERROR',\n            message: 'Database connection failed',\n          },\n        } as any);\n\n        const response = await GET_BUDGET_BREAKDOWN();\n        const data = await response.json();\n\n        expect(response.status).toBe(500);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('DATABASE_ERROR');\n      });\n    });\n  });\n\n  describe('Payment Status Report', () => {\n    describe('GET /api/admin/budget/payment-status', () => {\n      it('should return payment status report', async () => {\n        const mockReport = {\n          unpaidVendors: [\n            {\n              id: 'vendor-1',\n              name: 'DJ Services',\n              category: 'music',\n              baseCost: 1500,\n            },\n          ],\n          partiallyPaidVendors: [\n            {\n              id: 'vendor-2',\n              name: 'Costa Rica Photography',\n              category: 'photography',\n              baseCost: 2500,\n              amountPaid: 1000,\n              balanceDue: 1500,\n            },\n          ],\n          paidVendors: [\n            {\n              id: 'vendor-3',\n              name: 'Catering Services',\n              category: 'catering',\n              amountPaid: 3000,\n            },\n          ],\n          totalUnpaid: 1500,\n          totalPartial: 1500,\n          totalPaid: 3000,\n        };\n\n        (budgetService.getPaymentStatusReport as jest.Mock).mockResolvedValue({\n          success: true,\n          data: mockReport,\n        } as any);\n\n        const response = await GET_PAYMENT_STATUS();\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data).toEqual(mockReport);\n        expect(budgetService.getPaymentStatusReport).toHaveBeenCalled();\n      });\n\n      it('should return 401 when not authenticated', async () => {\n        mockGetSession.mockResolvedValue({\n          data: { session: null },\n          error: null,\n        } as any);\n\n        const response = await GET_PAYMENT_STATUS();\n        const data = await response.json();\n\n        expect(response.status).toBe(401);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNAUTHORIZED');\n      });\n\n      it('should return 500 for service errors', async () => {\n        (budgetService.getPaymentStatusReport as jest.Mock).mockResolvedValue({\n          success: false,\n          error: {\n            code: 'DATABASE_ERROR',\n            message: 'Failed to fetch payment status',\n          },\n        } as any);\n\n        const response = await GET_PAYMENT_STATUS();\n        const data = await response.json();\n\n        expect(response.status).toBe(500);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('DATABASE_ERROR');\n      });\n    });\n  });\n\n  describe('Subsidy Tracking', () => {\n    describe('GET /api/admin/budget/subsidies', () => {\n      it('should return subsidy tracking information', async () => {\n        const mockSubsidies = {\n          activitySubsidies: [\n            {\n              activityId: 'activity-1',\n              activityName: 'Beach Volleyball',\n              subsidyPerPerson: 5,\n              estimatedAttendees: 20,\n              totalSubsidy: 100,\n            },\n            {\n              activityId: 'activity-2',\n              activityName: 'Sunset Dinner',\n              subsidyPerPerson: 15,\n              estimatedAttendees: 50,\n              totalSubsidy: 750,\n            },\n          ],\n          accommodationSubsidies: [],\n          totalActivitySubsidies: 850,\n          totalAccommodationSubsidies: 0,\n          grandTotalSubsidies: 850,\n        };\n\n        (budgetService.trackSubsidies as jest.Mock).mockResolvedValue({\n          success: true,\n          data: mockSubsidies,\n        } as any);\n\n        const response = await GET_SUBSIDIES();\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data).toEqual(mockSubsidies);\n        expect(budgetService.trackSubsidies).toHaveBeenCalled();\n      });\n\n      it('should return 401 when not authenticated', async () => {\n        mockGetSession.mockResolvedValue({\n          data: { session: null },\n          error: null,\n        } as any);\n\n        const response = await GET_SUBSIDIES();\n        const data = await response.json();\n\n        expect(response.status).toBe(401);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNAUTHORIZED');\n      });\n\n      it('should return 500 for service errors', async () => {\n        (budgetService.trackSubsidies as jest.Mock).mockResolvedValue({\n          success: false,\n          error: {\n            code: 'DATABASE_ERROR',\n            message: 'Failed to track subsidies',\n          },\n        } as any);\n\n        const response = await GET_SUBSIDIES();\n        const data = await response.json();\n\n        expect(response.status).toBe(500);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('DATABASE_ERROR');\n      });\n    });\n  });\n\n  describe('Authentication and Authorization', () => {\n    it('should return 401 for all endpoints when not authenticated', async () => {\n      mockGetSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      } as any);\n\n      const endpoints = [\n        { handler: GET_BUDGET_BREAKDOWN },\n        { handler: GET_PAYMENT_STATUS },\n        { handler: GET_SUBSIDIES },\n      ];\n\n      for (const endpoint of endpoints) {\n        const response = await endpoint.handler();\n        const data = await response.json();\n\n        expect(response.status).toBe(401);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNAUTHORIZED');\n      }\n    });\n\n    it('should return 401 when session has error', async () => {\n      mockGetSession.mockResolvedValue({\n        data: { session: null },\n        error: { message: 'Session expired' },\n      } as any);\n\n      const response = await GET_BUDGET_BREAKDOWN();\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n  });\n});"],"names":["jest","mock","calculateTotal","fn","getSummary","getPaymentStatusReport","trackSubsidies","generateReport","NextResponse","json","data","init","status","NextRequest","cookies","get","getAll","set","delete","createServerClient","mockSupabaseClient","global","TextEncoder","TextDecoder","mockGetSession","auth","getSession","from","describe","beforeEach","clearAllMocks","mockResolvedValue","session","user","id","email","error","it","mockBreakdown","vendors","category","totalCost","amountPaid","balanceDue","name","cost","paid","balance","paymentStatus","activities","totalSubsidy","netCost","costPerPerson","hostSubsidy","estimatedAttendees","accommodations","totals","grossTotal","totalSubsidies","totalPaid","netTotal","budgetService","success","request","url","response","GET_BUDGET_BREAKDOWN","expect","toBe","toEqual","toHaveBeenCalledWith","includeVendors","includeActivities","includeAccommodations","code","message","mockReport","unpaidVendors","baseCost","partiallyPaidVendors","paidVendors","totalUnpaid","totalPartial","GET_PAYMENT_STATUS","toHaveBeenCalled","mockSubsidies","activitySubsidies","activityId","activityName","subsidyPerPerson","accommodationSubsidies","totalActivitySubsidies","totalAccommodationSubsidies","grandTotalSubsidies","GET_SUBSIDIES","endpoints","handler","endpoint"],"mappings":"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"}