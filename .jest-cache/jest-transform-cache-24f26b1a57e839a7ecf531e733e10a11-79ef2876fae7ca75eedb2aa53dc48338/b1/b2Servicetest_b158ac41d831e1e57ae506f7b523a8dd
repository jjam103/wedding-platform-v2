c619c0743c3a051883b3fd8add81d8b9
"use strict";
// Mock AWS SDK
jest.mock('@aws-sdk/client-s3', ()=>({
        S3Client: jest.fn().mockImplementation(()=>({
                send: jest.fn()
            })),
        PutObjectCommand: jest.fn(),
        HeadBucketCommand: jest.fn()
    }));
// Mock circuit breaker
jest.mock('../utils/circuitBreaker', ()=>({
        getCircuitBreaker: jest.fn().mockReturnValue({
            execute: jest.fn().mockImplementation((fn)=>fn())
        })
    }));
// Mock sanitization
jest.mock('../utils/sanitization', ()=>({
        sanitizeInput: jest.fn((input)=>input?.replace(/[^a-zA-Z0-9._-]/g, '_') || '')
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _b2Service = require("./b2Service");
describe('b2Service', ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
        (0, _b2Service.resetB2Client)(); // Reset client state before each test
        // Reset environment variables
        process.env.B2_BUCKET_NAME = 'test-bucket';
        process.env.B2_CDN_DOMAIN = 'cdn.example.com';
    });
    afterEach(()=>{
        delete process.env.B2_BUCKET_NAME;
        delete process.env.B2_CDN_DOMAIN;
        (0, _b2Service.resetB2Client)(); // Clean up after each test
    });
    describe('initializeB2Client', ()=>{
        it('should return success when valid configuration provided', ()=>{
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            const result = (0, _b2Service.initializeB2Client)(config);
            expect(result.success).toBe(true);
        });
        it('should initialize B2 client with correct endpoint format', ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            expect(S3Client).toHaveBeenCalledWith(expect.objectContaining({
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                credentials: {
                    accessKeyId: 'test-key-id',
                    secretAccessKey: 'test-secret-key'
                },
                forcePathStyle: true
            }));
        });
        it('should return CONFIGURATION_ERROR when missing endpoint', ()=>{
            const config = {
                endpoint: '',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            const result = (0, _b2Service.initializeB2Client)(config);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('CONFIGURATION_ERROR');
                expect(result.error.message).toBe('Missing required B2 configuration');
            }
        });
        it('should return CONFIGURATION_ERROR when missing accessKeyId', ()=>{
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: '',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            const result = (0, _b2Service.initializeB2Client)(config);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('CONFIGURATION_ERROR');
            }
        });
        it('should return CONFIGURATION_ERROR when missing secretAccessKey', ()=>{
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: '',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            const result = (0, _b2Service.initializeB2Client)(config);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('CONFIGURATION_ERROR');
            }
        });
        it('should return CONFIGURATION_ERROR when missing bucket', ()=>{
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: '',
                cdnDomain: 'cdn.example.com'
            };
            const result = (0, _b2Service.initializeB2Client)(config);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('CONFIGURATION_ERROR');
            }
        });
        it('should return INITIALIZATION_ERROR when S3Client throws error', ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            S3Client.mockImplementationOnce(()=>{
                throw new Error('S3Client initialization failed');
            });
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            const result = (0, _b2Service.initializeB2Client)(config);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('INITIALIZATION_ERROR');
                expect(result.error.message).toBe('S3Client initialization failed');
            }
        });
    });
    describe('uploadToB2', ()=>{
        beforeEach(()=>{
            // Initialize client first
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
        });
        it('should return success when file uploaded successfully', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockResolvedValue({});
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            // Re-initialize with mocked client
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const fileBuffer = Buffer.from('test file content');
            const result = await (0, _b2Service.uploadToB2)(fileBuffer, 'test-photo.jpg', 'image/jpeg');
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.url).toContain('cdn.example.com');
                expect(result.data.key).toContain('test-photo.jpg');
            }
        });
        it('should return CLIENT_NOT_INITIALIZED when client not initialized', async ()=>{
            // Reset client to ensure it's not initialized
            (0, _b2Service.resetB2Client)();
            const fileBuffer = Buffer.from('test file content');
            const result = await (0, _b2Service.uploadToB2)(fileBuffer, 'test-photo.jpg', 'image/jpeg');
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('CLIENT_NOT_INITIALIZED');
            }
        });
        it('should return UPLOAD_ERROR when S3 upload fails', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockRejectedValue(new Error('Upload failed'));
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            // Re-initialize with mocked client
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const fileBuffer = Buffer.from('test file content');
            const result = await (0, _b2Service.uploadToB2)(fileBuffer, 'test-photo.jpg', 'image/jpeg');
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('UPLOAD_ERROR');
            }
        });
        it('should sanitize filename to prevent path traversal', async ()=>{
            const { S3Client, PutObjectCommand } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockResolvedValue({});
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            // Re-initialize with mocked client
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const fileBuffer = Buffer.from('test file content');
            await (0, _b2Service.uploadToB2)(fileBuffer, '../../../malicious.jpg', 'image/jpeg');
            expect(PutObjectCommand).toHaveBeenCalledWith(expect.objectContaining({
                Key: expect.stringMatching(/photos\/\d+-\.\._\.\._\.\._malicious\.jpg/)
            }));
        });
    });
    describe('checkB2Health', ()=>{
        it('should return { available: true } when B2 is configured and healthy', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockResolvedValue({});
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            // Initialize client
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const result = await (0, _b2Service.checkB2Health)();
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.healthy).toBe(true);
                expect(result.data.lastChecked).toBeDefined();
                expect(result.data.lastChecked).toBeInstanceOf(Date);
                expect(result.data.error).toBeUndefined();
            }
        });
        it('should return { available: false } when B2 is not configured', async ()=>{
            // Reset client to ensure it's not initialized
            (0, _b2Service.resetB2Client)();
            const result = await (0, _b2Service.checkB2Health)();
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.healthy).toBe(false);
                expect(result.data.error).toBe('B2 client not initialized');
                expect(result.data.lastChecked).toBeDefined();
            }
        });
        it('should return { available: false } when bucket is not accessible', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockRejectedValue(new Error('Access denied'));
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            // Initialize client
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const result = await (0, _b2Service.checkB2Health)();
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.healthy).toBe(false);
                expect(result.data.error).toBe('Access denied');
                expect(result.data.lastChecked).toBeDefined();
            }
        });
        it('should update health status timestamp on each check', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockResolvedValue({});
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const firstCheck = await (0, _b2Service.checkB2Health)();
            const firstTimestamp = firstCheck.success ? firstCheck.data.lastChecked : null;
            // Wait a bit to ensure timestamp difference
            await new Promise((resolve)=>setTimeout(resolve, 10));
            const secondCheck = await (0, _b2Service.checkB2Health)();
            const secondTimestamp = secondCheck.success ? secondCheck.data.lastChecked : null;
            expect(firstTimestamp).toBeDefined();
            expect(secondTimestamp).toBeDefined();
            if (firstTimestamp && secondTimestamp) {
                expect(secondTimestamp.getTime()).toBeGreaterThanOrEqual(firstTimestamp.getTime());
            }
        });
    });
    describe('getB2HealthStatus', ()=>{
        it('should return current health status', ()=>{
            const status = (0, _b2Service.getB2HealthStatus)();
            expect(status).toHaveProperty('healthy');
            expect(status).toHaveProperty('lastChecked');
        });
    });
    describe('generateCDNUrl', ()=>{
        it('should generate correct CDN URL with proper format', ()=>{
            const url = (0, _b2Service.generateCDNUrl)('photos/1234567890-photo.jpg');
            expect(url).toBe('https://cdn.example.com/photos/1234567890-photo.jpg');
            expect(url).toMatch(/^https:\/\//); // Starts with https://
            expect(url).toContain('cdn.example.com'); // Contains CDN domain
            expect(url).toContain('/photos/'); // Contains photos path
        });
        it('should handle keys with special characters', ()=>{
            const url = (0, _b2Service.generateCDNUrl)('photos/1234567890-test_photo-v2.jpg');
            expect(url).toBe('https://cdn.example.com/photos/1234567890-test_photo-v2.jpg');
            expect(url).toMatch(/^https:\/\/cdn\.example\.com\//);
        });
        it('should handle keys without photos prefix', ()=>{
            const url = (0, _b2Service.generateCDNUrl)('other/path/file.jpg');
            expect(url).toBe('https://cdn.example.com/other/path/file.jpg');
        });
        it('should handle empty CDN domain gracefully', ()=>{
            delete process.env.B2_CDN_DOMAIN;
            const url = (0, _b2Service.generateCDNUrl)('photos/1234567890-photo.jpg');
            expect(url).toBe('https:///photos/1234567890-photo.jpg');
            // Restore for other tests
            process.env.B2_CDN_DOMAIN = 'cdn.example.com';
        });
        it('should not double-encode URLs', ()=>{
            const url = (0, _b2Service.generateCDNUrl)('photos/1234567890-photo%20with%20spaces.jpg');
            expect(url).toBe('https://cdn.example.com/photos/1234567890-photo%20with%20spaces.jpg');
            expect(url).not.toContain('%2520'); // Should not double-encode
        });
    });
    describe('isB2Healthy', ()=>{
        it('should return cached health status when recent', async ()=>{
            // First check to set status
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockResolvedValue({});
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            await (0, _b2Service.checkB2Health)();
            // Now check if it returns cached status
            const result = await (0, _b2Service.isB2Healthy)();
            expect(result.success).toBe(true);
            if (result.success) {
                expect(typeof result.data).toBe('boolean');
            }
        });
        it('should perform new health check when status is stale', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockResolvedValue({});
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const result = await (0, _b2Service.isB2Healthy)();
            expect(result.success).toBe(true);
        });
    });
    describe('Error Handling - Application Stability', ()=>{
        it('should not crash app when B2 upload fails', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockRejectedValue(new Error('Network error'));
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const fileBuffer = Buffer.from('test file content');
            // Should not throw, should return error result
            const result = await (0, _b2Service.uploadToB2)(fileBuffer, 'test-photo.jpg', 'image/jpeg');
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('UPLOAD_ERROR');
                expect(result.error.message).toBe('Network error');
            }
        });
        it('should not crash app when health check fails', async ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            const mockSend = jest.fn().mockRejectedValue(new Error('Connection timeout'));
            S3Client.mockImplementation(()=>({
                    send: mockSend
                }));
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            // Should not throw, should return unhealthy status
            const result = await (0, _b2Service.checkB2Health)();
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.healthy).toBe(false);
                expect(result.data.error).toBe('Connection timeout');
            }
        });
        it('should not crash app when initialization fails', ()=>{
            const { S3Client } = require('@aws-sdk/client-s3');
            S3Client.mockImplementationOnce(()=>{
                throw new Error('Invalid credentials');
            });
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'invalid-key',
                secretAccessKey: 'invalid-secret',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            // Should not throw, should return error result
            const result = (0, _b2Service.initializeB2Client)(config);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.code).toBe('INITIALIZATION_ERROR');
                expect(result.error.message).toBe('Invalid credentials');
            }
        });
        it('should handle circuit breaker open state gracefully', async ()=>{
            const { getCircuitBreaker } = require('../utils/circuitBreaker');
            const mockCircuitBreaker = {
                execute: jest.fn().mockRejectedValue(new Error('Circuit breaker open'))
            };
            getCircuitBreaker.mockReturnValue(mockCircuitBreaker);
            const config = {
                endpoint: 'https://s3.us-west-002.backblazeb2.com',
                region: 'us-west-002',
                accessKeyId: 'test-key-id',
                secretAccessKey: 'test-secret-key',
                bucket: 'test-bucket',
                cdnDomain: 'cdn.example.com'
            };
            (0, _b2Service.initializeB2Client)(config);
            const fileBuffer = Buffer.from('test file content');
            const result = await (0, _b2Service.uploadToB2)(fileBuffer, 'test-photo.jpg', 'image/jpeg');
            // Should handle circuit breaker error gracefully
            expect(result.success).toBe(false);
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvYjJTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgaW5pdGlhbGl6ZUIyQ2xpZW50LFxuICB1cGxvYWRUb0IyLFxuICBjaGVja0IySGVhbHRoLFxuICBnZXRCMkhlYWx0aFN0YXR1cyxcbiAgZ2VuZXJhdGVDRE5VcmwsXG4gIGlzQjJIZWFsdGh5LFxuICByZXNldEIyQ2xpZW50LFxufSBmcm9tICcuL2IyU2VydmljZSc7XG5cbi8vIE1vY2sgQVdTIFNES1xuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnLCAoKSA9PiAoe1xuICBTM0NsaWVudDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIHNlbmQ6IGplc3QuZm4oKSxcbiAgfSkpLFxuICBQdXRPYmplY3RDb21tYW5kOiBqZXN0LmZuKCksXG4gIEhlYWRCdWNrZXRDb21tYW5kOiBqZXN0LmZuKCksXG59KSk7XG5cbi8vIE1vY2sgY2lyY3VpdCBicmVha2VyXG5qZXN0Lm1vY2soJy4uL3V0aWxzL2NpcmN1aXRCcmVha2VyJywgKCkgPT4gKHtcbiAgZ2V0Q2lyY3VpdEJyZWFrZXI6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgIGV4ZWN1dGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGZuKSA9PiBmbigpKSxcbiAgfSksXG59KSk7XG5cbi8vIE1vY2sgc2FuaXRpemF0aW9uXG5qZXN0Lm1vY2soJy4uL3V0aWxzL3Nhbml0aXphdGlvbicsICgpID0+ICh7XG4gIHNhbml0aXplSW5wdXQ6IGplc3QuZm4oKGlucHV0KSA9PiBpbnB1dD8ucmVwbGFjZSgvW15hLXpBLVowLTkuXy1dL2csICdfJykgfHwgJycpLFxufSkpO1xuXG5kZXNjcmliZSgnYjJTZXJ2aWNlJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICByZXNldEIyQ2xpZW50KCk7IC8vIFJlc2V0IGNsaWVudCBzdGF0ZSBiZWZvcmUgZWFjaCB0ZXN0XG4gICAgLy8gUmVzZXQgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gICAgcHJvY2Vzcy5lbnYuQjJfQlVDS0VUX05BTUUgPSAndGVzdC1idWNrZXQnO1xuICAgIHByb2Nlc3MuZW52LkIyX0NETl9ET01BSU4gPSAnY2RuLmV4YW1wbGUuY29tJztcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuQjJfQlVDS0VUX05BTUU7XG4gICAgZGVsZXRlIHByb2Nlc3MuZW52LkIyX0NETl9ET01BSU47XG4gICAgcmVzZXRCMkNsaWVudCgpOyAvLyBDbGVhbiB1cCBhZnRlciBlYWNoIHRlc3RcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2luaXRpYWxpemVCMkNsaWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBzdWNjZXNzIHdoZW4gdmFsaWQgY29uZmlndXJhdGlvbiBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL3MzLnVzLXdlc3QtMDAyLmJhY2tibGF6ZWIyLmNvbScsXG4gICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICd0ZXN0LWtleS1pZCcsXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogJ3Rlc3Qtc2VjcmV0LWtleScsXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3QtYnVja2V0JyxcbiAgICAgICAgY2RuRG9tYWluOiAnY2RuLmV4YW1wbGUuY29tJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGluaXRpYWxpemVCMkNsaWVudChjb25maWcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIEIyIGNsaWVudCB3aXRoIGNvcnJlY3QgZW5kcG9pbnQgZm9ybWF0JywgKCkgPT4ge1xuICAgICAgY29uc3QgeyBTM0NsaWVudCB9ID0gcmVxdWlyZSgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAndGVzdC1rZXktaWQnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuXG4gICAgICBpbml0aWFsaXplQjJDbGllbnQoY29uZmlnKTtcblxuICAgICAgZXhwZWN0KFMzQ2xpZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICAgICAgYWNjZXNzS2V5SWQ6ICd0ZXN0LWtleS1pZCcsXG4gICAgICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9yY2VQYXRoU3R5bGU6IHRydWUsIC8vIFJlcXVpcmVkIGZvciBCMiBTMy1jb21wYXRpYmxlIEFQSVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIENPTkZJR1VSQVRJT05fRVJST1Igd2hlbiBtaXNzaW5nIGVuZHBvaW50JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBlbmRwb2ludDogJycsXG4gICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICd0ZXN0LWtleS1pZCcsXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogJ3Rlc3Qtc2VjcmV0LWtleScsXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3QtYnVja2V0JyxcbiAgICAgICAgY2RuRG9tYWluOiAnY2RuLmV4YW1wbGUuY29tJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGluaXRpYWxpemVCMkNsaWVudChjb25maWcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvci5jb2RlKS50b0JlKCdDT05GSUdVUkFUSU9OX0VSUk9SJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IubWVzc2FnZSkudG9CZSgnTWlzc2luZyByZXF1aXJlZCBCMiBjb25maWd1cmF0aW9uJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBDT05GSUdVUkFUSU9OX0VSUk9SIHdoZW4gbWlzc2luZyBhY2Nlc3NLZXlJZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL3MzLnVzLXdlc3QtMDAyLmJhY2tibGF6ZWIyLmNvbScsXG4gICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICcnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBpbml0aWFsaXplQjJDbGllbnQoY29uZmlnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IuY29kZSkudG9CZSgnQ09ORklHVVJBVElPTl9FUlJPUicpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gQ09ORklHVVJBVElPTl9FUlJPUiB3aGVuIG1pc3Npbmcgc2VjcmV0QWNjZXNzS2V5JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vczMudXMtd2VzdC0wMDIuYmFja2JsYXplYjIuY29tJyxcbiAgICAgICAgcmVnaW9uOiAndXMtd2VzdC0wMDInLFxuICAgICAgICBhY2Nlc3NLZXlJZDogJ3Rlc3Qta2V5LWlkJyxcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiAnJyxcbiAgICAgICAgYnVja2V0OiAndGVzdC1idWNrZXQnLFxuICAgICAgICBjZG5Eb21haW46ICdjZG4uZXhhbXBsZS5jb20nLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gaW5pdGlhbGl6ZUIyQ2xpZW50KGNvbmZpZyk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLmNvZGUpLnRvQmUoJ0NPTkZJR1VSQVRJT05fRVJST1InKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIENPTkZJR1VSQVRJT05fRVJST1Igd2hlbiBtaXNzaW5nIGJ1Y2tldCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL3MzLnVzLXdlc3QtMDAyLmJhY2tibGF6ZWIyLmNvbScsXG4gICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICd0ZXN0LWtleS1pZCcsXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogJ3Rlc3Qtc2VjcmV0LWtleScsXG4gICAgICAgIGJ1Y2tldDogJycsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBpbml0aWFsaXplQjJDbGllbnQoY29uZmlnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IuY29kZSkudG9CZSgnQ09ORklHVVJBVElPTl9FUlJPUicpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gSU5JVElBTElaQVRJT05fRVJST1Igd2hlbiBTM0NsaWVudCB0aHJvd3MgZXJyb3InLCAoKSA9PiB7XG4gICAgICBjb25zdCB7IFMzQ2xpZW50IH0gPSByZXF1aXJlKCdAYXdzLXNkay9jbGllbnQtczMnKTtcbiAgICAgIFMzQ2xpZW50Lm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1MzQ2xpZW50IGluaXRpYWxpemF0aW9uIGZhaWxlZCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL3MzLnVzLXdlc3QtMDAyLmJhY2tibGF6ZWIyLmNvbScsXG4gICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICd0ZXN0LWtleS1pZCcsXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogJ3Rlc3Qtc2VjcmV0LWtleScsXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3QtYnVja2V0JyxcbiAgICAgICAgY2RuRG9tYWluOiAnY2RuLmV4YW1wbGUuY29tJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGluaXRpYWxpemVCMkNsaWVudChjb25maWcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvci5jb2RlKS50b0JlKCdJTklUSUFMSVpBVElPTl9FUlJPUicpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLm1lc3NhZ2UpLnRvQmUoJ1MzQ2xpZW50IGluaXRpYWxpemF0aW9uIGZhaWxlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBsb2FkVG9CMicsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIC8vIEluaXRpYWxpemUgY2xpZW50IGZpcnN0XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAndGVzdC1rZXktaWQnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuICAgICAgaW5pdGlhbGl6ZUIyQ2xpZW50KGNvbmZpZyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBzdWNjZXNzIHdoZW4gZmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IFMzQ2xpZW50IH0gPSByZXF1aXJlKCdAYXdzLXNkay9jbGllbnQtczMnKTtcbiAgICAgIGNvbnN0IG1vY2tTZW5kID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcbiAgICAgIFMzQ2xpZW50Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoeyBzZW5kOiBtb2NrU2VuZCB9KSk7XG5cbiAgICAgIC8vIFJlLWluaXRpYWxpemUgd2l0aCBtb2NrZWQgY2xpZW50XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAndGVzdC1rZXktaWQnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuICAgICAgaW5pdGlhbGl6ZUIyQ2xpZW50KGNvbmZpZyk7XG5cbiAgICAgIGNvbnN0IGZpbGVCdWZmZXIgPSBCdWZmZXIuZnJvbSgndGVzdCBmaWxlIGNvbnRlbnQnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVwbG9hZFRvQjIoZmlsZUJ1ZmZlciwgJ3Rlc3QtcGhvdG8uanBnJywgJ2ltYWdlL2pwZWcnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS51cmwpLnRvQ29udGFpbignY2RuLmV4YW1wbGUuY29tJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5rZXkpLnRvQ29udGFpbigndGVzdC1waG90by5qcGcnKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIENMSUVOVF9OT1RfSU5JVElBTElaRUQgd2hlbiBjbGllbnQgbm90IGluaXRpYWxpemVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gUmVzZXQgY2xpZW50IHRvIGVuc3VyZSBpdCdzIG5vdCBpbml0aWFsaXplZFxuICAgICAgcmVzZXRCMkNsaWVudCgpO1xuICAgICAgXG4gICAgICBjb25zdCBmaWxlQnVmZmVyID0gQnVmZmVyLmZyb20oJ3Rlc3QgZmlsZSBjb250ZW50Jyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGxvYWRUb0IyKGZpbGVCdWZmZXIsICd0ZXN0LXBob3RvLmpwZycsICdpbWFnZS9qcGVnJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IuY29kZSkudG9CZSgnQ0xJRU5UX05PVF9JTklUSUFMSVpFRCcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gVVBMT0FEX0VSUk9SIHdoZW4gUzMgdXBsb2FkIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBTM0NsaWVudCB9ID0gcmVxdWlyZSgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XG4gICAgICBjb25zdCBtb2NrU2VuZCA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1VwbG9hZCBmYWlsZWQnKSk7XG4gICAgICBTM0NsaWVudC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgc2VuZDogbW9ja1NlbmQgfSkpO1xuXG4gICAgICAvLyBSZS1pbml0aWFsaXplIHdpdGggbW9ja2VkIGNsaWVudFxuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vczMudXMtd2VzdC0wMDIuYmFja2JsYXplYjIuY29tJyxcbiAgICAgICAgcmVnaW9uOiAndXMtd2VzdC0wMDInLFxuICAgICAgICBhY2Nlc3NLZXlJZDogJ3Rlc3Qta2V5LWlkJyxcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiAndGVzdC1zZWNyZXQta2V5JyxcbiAgICAgICAgYnVja2V0OiAndGVzdC1idWNrZXQnLFxuICAgICAgICBjZG5Eb21haW46ICdjZG4uZXhhbXBsZS5jb20nLFxuICAgICAgfTtcbiAgICAgIGluaXRpYWxpemVCMkNsaWVudChjb25maWcpO1xuXG4gICAgICBjb25zdCBmaWxlQnVmZmVyID0gQnVmZmVyLmZyb20oJ3Rlc3QgZmlsZSBjb250ZW50Jyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGxvYWRUb0IyKGZpbGVCdWZmZXIsICd0ZXN0LXBob3RvLmpwZycsICdpbWFnZS9qcGVnJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IuY29kZSkudG9CZSgnVVBMT0FEX0VSUk9SJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIGZpbGVuYW1lIHRvIHByZXZlbnQgcGF0aCB0cmF2ZXJzYWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IFMzQ2xpZW50LCBQdXRPYmplY3RDb21tYW5kIH0gPSByZXF1aXJlKCdAYXdzLXNkay9jbGllbnQtczMnKTtcbiAgICAgIGNvbnN0IG1vY2tTZW5kID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcbiAgICAgIFMzQ2xpZW50Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoeyBzZW5kOiBtb2NrU2VuZCB9KSk7XG5cbiAgICAgIC8vIFJlLWluaXRpYWxpemUgd2l0aCBtb2NrZWQgY2xpZW50XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAndGVzdC1rZXktaWQnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuICAgICAgaW5pdGlhbGl6ZUIyQ2xpZW50KGNvbmZpZyk7XG5cbiAgICAgIGNvbnN0IGZpbGVCdWZmZXIgPSBCdWZmZXIuZnJvbSgndGVzdCBmaWxlIGNvbnRlbnQnKTtcbiAgICAgIGF3YWl0IHVwbG9hZFRvQjIoZmlsZUJ1ZmZlciwgJy4uLy4uLy4uL21hbGljaW91cy5qcGcnLCAnaW1hZ2UvanBlZycpO1xuXG4gICAgICBleHBlY3QoUHV0T2JqZWN0Q29tbWFuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBLZXk6IGV4cGVjdC5zdHJpbmdNYXRjaGluZygvcGhvdG9zXFwvXFxkKy1cXC5cXC5fXFwuXFwuX1xcLlxcLl9tYWxpY2lvdXNcXC5qcGcvKSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGVja0IySGVhbHRoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHsgYXZhaWxhYmxlOiB0cnVlIH0gd2hlbiBCMiBpcyBjb25maWd1cmVkIGFuZCBoZWFsdGh5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBTM0NsaWVudCB9ID0gcmVxdWlyZSgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XG4gICAgICBjb25zdCBtb2NrU2VuZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG4gICAgICBTM0NsaWVudC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgc2VuZDogbW9ja1NlbmQgfSkpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIGNsaWVudFxuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vczMudXMtd2VzdC0wMDIuYmFja2JsYXplYjIuY29tJyxcbiAgICAgICAgcmVnaW9uOiAndXMtd2VzdC0wMDInLFxuICAgICAgICBhY2Nlc3NLZXlJZDogJ3Rlc3Qta2V5LWlkJyxcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiAndGVzdC1zZWNyZXQta2V5JyxcbiAgICAgICAgYnVja2V0OiAndGVzdC1idWNrZXQnLFxuICAgICAgICBjZG5Eb21haW46ICdjZG4uZXhhbXBsZS5jb20nLFxuICAgICAgfTtcbiAgICAgIGluaXRpYWxpemVCMkNsaWVudChjb25maWcpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaGVja0IySGVhbHRoKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuaGVhbHRoeSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmxhc3RDaGVja2VkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEubGFzdENoZWNrZWQpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuZXJyb3IpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHsgYXZhaWxhYmxlOiBmYWxzZSB9IHdoZW4gQjIgaXMgbm90IGNvbmZpZ3VyZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBSZXNldCBjbGllbnQgdG8gZW5zdXJlIGl0J3Mgbm90IGluaXRpYWxpemVkXG4gICAgICByZXNldEIyQ2xpZW50KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNoZWNrQjJIZWFsdGgoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5oZWFsdGh5KS50b0JlKGZhbHNlKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmVycm9yKS50b0JlKCdCMiBjbGllbnQgbm90IGluaXRpYWxpemVkJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5sYXN0Q2hlY2tlZCkudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHsgYXZhaWxhYmxlOiBmYWxzZSB9IHdoZW4gYnVja2V0IGlzIG5vdCBhY2Nlc3NpYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBTM0NsaWVudCB9ID0gcmVxdWlyZSgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XG4gICAgICBjb25zdCBtb2NrU2VuZCA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0FjY2VzcyBkZW5pZWQnKSk7XG4gICAgICBTM0NsaWVudC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgc2VuZDogbW9ja1NlbmQgfSkpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIGNsaWVudFxuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vczMudXMtd2VzdC0wMDIuYmFja2JsYXplYjIuY29tJyxcbiAgICAgICAgcmVnaW9uOiAndXMtd2VzdC0wMDInLFxuICAgICAgICBhY2Nlc3NLZXlJZDogJ3Rlc3Qta2V5LWlkJyxcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiAndGVzdC1zZWNyZXQta2V5JyxcbiAgICAgICAgYnVja2V0OiAndGVzdC1idWNrZXQnLFxuICAgICAgICBjZG5Eb21haW46ICdjZG4uZXhhbXBsZS5jb20nLFxuICAgICAgfTtcbiAgICAgIGluaXRpYWxpemVCMkNsaWVudChjb25maWcpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaGVja0IySGVhbHRoKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuaGVhbHRoeSkudG9CZShmYWxzZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5lcnJvcikudG9CZSgnQWNjZXNzIGRlbmllZCcpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEubGFzdENoZWNrZWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBoZWFsdGggc3RhdHVzIHRpbWVzdGFtcCBvbiBlYWNoIGNoZWNrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBTM0NsaWVudCB9ID0gcmVxdWlyZSgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XG4gICAgICBjb25zdCBtb2NrU2VuZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG4gICAgICBTM0NsaWVudC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgc2VuZDogbW9ja1NlbmQgfSkpO1xuXG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAndGVzdC1rZXktaWQnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuICAgICAgaW5pdGlhbGl6ZUIyQ2xpZW50KGNvbmZpZyk7XG5cbiAgICAgIGNvbnN0IGZpcnN0Q2hlY2sgPSBhd2FpdCBjaGVja0IySGVhbHRoKCk7XG4gICAgICBjb25zdCBmaXJzdFRpbWVzdGFtcCA9IGZpcnN0Q2hlY2suc3VjY2VzcyA/IGZpcnN0Q2hlY2suZGF0YS5sYXN0Q2hlY2tlZCA6IG51bGw7XG5cbiAgICAgIC8vIFdhaXQgYSBiaXQgdG8gZW5zdXJlIHRpbWVzdGFtcCBkaWZmZXJlbmNlXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTApKTtcblxuICAgICAgY29uc3Qgc2Vjb25kQ2hlY2sgPSBhd2FpdCBjaGVja0IySGVhbHRoKCk7XG4gICAgICBjb25zdCBzZWNvbmRUaW1lc3RhbXAgPSBzZWNvbmRDaGVjay5zdWNjZXNzID8gc2Vjb25kQ2hlY2suZGF0YS5sYXN0Q2hlY2tlZCA6IG51bGw7XG5cbiAgICAgIGV4cGVjdChmaXJzdFRpbWVzdGFtcCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzZWNvbmRUaW1lc3RhbXApLnRvQmVEZWZpbmVkKCk7XG4gICAgICBpZiAoZmlyc3RUaW1lc3RhbXAgJiYgc2Vjb25kVGltZXN0YW1wKSB7XG4gICAgICAgIGV4cGVjdChzZWNvbmRUaW1lc3RhbXAuZ2V0VGltZSgpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKGZpcnN0VGltZXN0YW1wLmdldFRpbWUoKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRCMkhlYWx0aFN0YXR1cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjdXJyZW50IGhlYWx0aCBzdGF0dXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0dXMgPSBnZXRCMkhlYWx0aFN0YXR1cygpO1xuICAgICAgZXhwZWN0KHN0YXR1cykudG9IYXZlUHJvcGVydHkoJ2hlYWx0aHknKTtcbiAgICAgIGV4cGVjdChzdGF0dXMpLnRvSGF2ZVByb3BlcnR5KCdsYXN0Q2hlY2tlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2VuZXJhdGVDRE5VcmwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjb3JyZWN0IENETiBVUkwgd2l0aCBwcm9wZXIgZm9ybWF0JywgKCkgPT4ge1xuICAgICAgY29uc3QgdXJsID0gZ2VuZXJhdGVDRE5VcmwoJ3Bob3Rvcy8xMjM0NTY3ODkwLXBob3RvLmpwZycpO1xuICAgICAgZXhwZWN0KHVybCkudG9CZSgnaHR0cHM6Ly9jZG4uZXhhbXBsZS5jb20vcGhvdG9zLzEyMzQ1Njc4OTAtcGhvdG8uanBnJyk7XG4gICAgICBleHBlY3QodXJsKS50b01hdGNoKC9eaHR0cHM6XFwvXFwvLyk7IC8vIFN0YXJ0cyB3aXRoIGh0dHBzOi8vXG4gICAgICBleHBlY3QodXJsKS50b0NvbnRhaW4oJ2Nkbi5leGFtcGxlLmNvbScpOyAvLyBDb250YWlucyBDRE4gZG9tYWluXG4gICAgICBleHBlY3QodXJsKS50b0NvbnRhaW4oJy9waG90b3MvJyk7IC8vIENvbnRhaW5zIHBob3RvcyBwYXRoXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBrZXlzIHdpdGggc3BlY2lhbCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXJsID0gZ2VuZXJhdGVDRE5VcmwoJ3Bob3Rvcy8xMjM0NTY3ODkwLXRlc3RfcGhvdG8tdjIuanBnJyk7XG4gICAgICBleHBlY3QodXJsKS50b0JlKCdodHRwczovL2Nkbi5leGFtcGxlLmNvbS9waG90b3MvMTIzNDU2Nzg5MC10ZXN0X3Bob3RvLXYyLmpwZycpO1xuICAgICAgZXhwZWN0KHVybCkudG9NYXRjaCgvXmh0dHBzOlxcL1xcL2NkblxcLmV4YW1wbGVcXC5jb21cXC8vKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGtleXMgd2l0aG91dCBwaG90b3MgcHJlZml4JywgKCkgPT4ge1xuICAgICAgY29uc3QgdXJsID0gZ2VuZXJhdGVDRE5VcmwoJ290aGVyL3BhdGgvZmlsZS5qcGcnKTtcbiAgICAgIGV4cGVjdCh1cmwpLnRvQmUoJ2h0dHBzOi8vY2RuLmV4YW1wbGUuY29tL290aGVyL3BhdGgvZmlsZS5qcGcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IENETiBkb21haW4gZ3JhY2VmdWxseScsICgpID0+IHtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5CMl9DRE5fRE9NQUlOO1xuICAgICAgY29uc3QgdXJsID0gZ2VuZXJhdGVDRE5VcmwoJ3Bob3Rvcy8xMjM0NTY3ODkwLXBob3RvLmpwZycpO1xuICAgICAgZXhwZWN0KHVybCkudG9CZSgnaHR0cHM6Ly8vcGhvdG9zLzEyMzQ1Njc4OTAtcGhvdG8uanBnJyk7XG4gICAgICAvLyBSZXN0b3JlIGZvciBvdGhlciB0ZXN0c1xuICAgICAgcHJvY2Vzcy5lbnYuQjJfQ0ROX0RPTUFJTiA9ICdjZG4uZXhhbXBsZS5jb20nO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgZG91YmxlLWVuY29kZSBVUkxzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXJsID0gZ2VuZXJhdGVDRE5VcmwoJ3Bob3Rvcy8xMjM0NTY3ODkwLXBob3RvJTIwd2l0aCUyMHNwYWNlcy5qcGcnKTtcbiAgICAgIGV4cGVjdCh1cmwpLnRvQmUoJ2h0dHBzOi8vY2RuLmV4YW1wbGUuY29tL3Bob3Rvcy8xMjM0NTY3ODkwLXBob3RvJTIwd2l0aCUyMHNwYWNlcy5qcGcnKTtcbiAgICAgIGV4cGVjdCh1cmwpLm5vdC50b0NvbnRhaW4oJyUyNTIwJyk7IC8vIFNob3VsZCBub3QgZG91YmxlLWVuY29kZVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaXNCMkhlYWx0aHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY2FjaGVkIGhlYWx0aCBzdGF0dXMgd2hlbiByZWNlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBGaXJzdCBjaGVjayB0byBzZXQgc3RhdHVzXG4gICAgICBjb25zdCB7IFMzQ2xpZW50IH0gPSByZXF1aXJlKCdAYXdzLXNkay9jbGllbnQtczMnKTtcbiAgICAgIGNvbnN0IG1vY2tTZW5kID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcbiAgICAgIFMzQ2xpZW50Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoeyBzZW5kOiBtb2NrU2VuZCB9KSk7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL3MzLnVzLXdlc3QtMDAyLmJhY2tibGF6ZWIyLmNvbScsXG4gICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICd0ZXN0LWtleS1pZCcsXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogJ3Rlc3Qtc2VjcmV0LWtleScsXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3QtYnVja2V0JyxcbiAgICAgICAgY2RuRG9tYWluOiAnY2RuLmV4YW1wbGUuY29tJyxcbiAgICAgIH07XG4gICAgICBpbml0aWFsaXplQjJDbGllbnQoY29uZmlnKTtcblxuICAgICAgYXdhaXQgY2hlY2tCMkhlYWx0aCgpO1xuXG4gICAgICAvLyBOb3cgY2hlY2sgaWYgaXQgcmV0dXJucyBjYWNoZWQgc3RhdHVzXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpc0IySGVhbHRoeSgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmRhdGEpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcGVyZm9ybSBuZXcgaGVhbHRoIGNoZWNrIHdoZW4gc3RhdHVzIGlzIHN0YWxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBTM0NsaWVudCB9ID0gcmVxdWlyZSgnQGF3cy1zZGsvY2xpZW50LXMzJyk7XG4gICAgICBjb25zdCBtb2NrU2VuZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG4gICAgICBTM0NsaWVudC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgc2VuZDogbW9ja1NlbmQgfSkpO1xuXG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAndGVzdC1rZXktaWQnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuICAgICAgaW5pdGlhbGl6ZUIyQ2xpZW50KGNvbmZpZyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGlzQjJIZWFsdGh5KCk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZyAtIEFwcGxpY2F0aW9uIFN0YWJpbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG5vdCBjcmFzaCBhcHAgd2hlbiBCMiB1cGxvYWQgZmFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IFMzQ2xpZW50IH0gPSByZXF1aXJlKCdAYXdzLXNkay9jbGllbnQtczMnKTtcbiAgICAgIGNvbnN0IG1vY2tTZW5kID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignTmV0d29yayBlcnJvcicpKTtcbiAgICAgIFMzQ2xpZW50Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoeyBzZW5kOiBtb2NrU2VuZCB9KSk7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL3MzLnVzLXdlc3QtMDAyLmJhY2tibGF6ZWIyLmNvbScsXG4gICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMDAyJyxcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICd0ZXN0LWtleS1pZCcsXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogJ3Rlc3Qtc2VjcmV0LWtleScsXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3QtYnVja2V0JyxcbiAgICAgICAgY2RuRG9tYWluOiAnY2RuLmV4YW1wbGUuY29tJyxcbiAgICAgIH07XG4gICAgICBpbml0aWFsaXplQjJDbGllbnQoY29uZmlnKTtcblxuICAgICAgY29uc3QgZmlsZUJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCd0ZXN0IGZpbGUgY29udGVudCcpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgbm90IHRocm93LCBzaG91bGQgcmV0dXJuIGVycm9yIHJlc3VsdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXBsb2FkVG9CMihmaWxlQnVmZmVyLCAndGVzdC1waG90by5qcGcnLCAnaW1hZ2UvanBlZycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLmNvZGUpLnRvQmUoJ1VQTE9BRF9FUlJPUicpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLm1lc3NhZ2UpLnRvQmUoJ05ldHdvcmsgZXJyb3InKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGNyYXNoIGFwcCB3aGVuIGhlYWx0aCBjaGVjayBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgUzNDbGllbnQgfSA9IHJlcXVpcmUoJ0Bhd3Mtc2RrL2NsaWVudC1zMycpO1xuICAgICAgY29uc3QgbW9ja1NlbmQgPSBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDb25uZWN0aW9uIHRpbWVvdXQnKSk7XG4gICAgICBTM0NsaWVudC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgc2VuZDogbW9ja1NlbmQgfSkpO1xuXG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAndGVzdC1rZXktaWQnLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICd0ZXN0LXNlY3JldC1rZXknLFxuICAgICAgICBidWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIGNkbkRvbWFpbjogJ2Nkbi5leGFtcGxlLmNvbScsXG4gICAgICB9O1xuICAgICAgaW5pdGlhbGl6ZUIyQ2xpZW50KGNvbmZpZyk7XG5cbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3csIHNob3VsZCByZXR1cm4gdW5oZWFsdGh5IHN0YXR1c1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2hlY2tCMkhlYWx0aCgpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmhlYWx0aHkpLnRvQmUoZmFsc2UpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuZXJyb3IpLnRvQmUoJ0Nvbm5lY3Rpb24gdGltZW91dCcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgY3Jhc2ggYXBwIHdoZW4gaW5pdGlhbGl6YXRpb24gZmFpbHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB7IFMzQ2xpZW50IH0gPSByZXF1aXJlKCdAYXdzLXNkay9jbGllbnQtczMnKTtcbiAgICAgIFMzQ2xpZW50Lm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY3JlZGVudGlhbHMnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9zMy51cy13ZXN0LTAwMi5iYWNrYmxhemViMi5jb20nLFxuICAgICAgICByZWdpb246ICd1cy13ZXN0LTAwMicsXG4gICAgICAgIGFjY2Vzc0tleUlkOiAnaW52YWxpZC1rZXknLFxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6ICdpbnZhbGlkLXNlY3JldCcsXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3QtYnVja2V0JyxcbiAgICAgICAgY2RuRG9tYWluOiAnY2RuLmV4YW1wbGUuY29tJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3csIHNob3VsZCByZXR1cm4gZXJyb3IgcmVzdWx0XG4gICAgICBjb25zdCByZXN1bHQgPSBpbml0aWFsaXplQjJDbGllbnQoY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvci5jb2RlKS50b0JlKCdJTklUSUFMSVpBVElPTl9FUlJPUicpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yLm1lc3NhZ2UpLnRvQmUoJ0ludmFsaWQgY3JlZGVudGlhbHMnKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNpcmN1aXQgYnJlYWtlciBvcGVuIHN0YXRlIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IGdldENpcmN1aXRCcmVha2VyIH0gPSByZXF1aXJlKCcuLi91dGlscy9jaXJjdWl0QnJlYWtlcicpO1xuICAgICAgY29uc3QgbW9ja0NpcmN1aXRCcmVha2VyID0ge1xuICAgICAgICBleGVjdXRlOiBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDaXJjdWl0IGJyZWFrZXIgb3BlbicpKSxcbiAgICAgIH07XG4gICAgICBnZXRDaXJjdWl0QnJlYWtlci5tb2NrUmV0dXJuVmFsdWUobW9ja0NpcmN1aXRCcmVha2VyKTtcblxuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vczMudXMtd2VzdC0wMDIuYmFja2JsYXplYjIuY29tJyxcbiAgICAgICAgcmVnaW9uOiAndXMtd2VzdC0wMDInLFxuICAgICAgICBhY2Nlc3NLZXlJZDogJ3Rlc3Qta2V5LWlkJyxcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiAndGVzdC1zZWNyZXQta2V5JyxcbiAgICAgICAgYnVja2V0OiAndGVzdC1idWNrZXQnLFxuICAgICAgICBjZG5Eb21haW46ICdjZG4uZXhhbXBsZS5jb20nLFxuICAgICAgfTtcbiAgICAgIGluaXRpYWxpemVCMkNsaWVudChjb25maWcpO1xuXG4gICAgICBjb25zdCBmaWxlQnVmZmVyID0gQnVmZmVyLmZyb20oJ3Rlc3QgZmlsZSBjb250ZW50Jyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGxvYWRUb0IyKGZpbGVCdWZmZXIsICd0ZXN0LXBob3RvLmpwZycsICdpbWFnZS9qcGVnJyk7XG5cbiAgICAgIC8vIFNob3VsZCBoYW5kbGUgY2lyY3VpdCBicmVha2VyIGVycm9yIGdyYWNlZnVsbHlcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sIm5hbWVzIjpbImplc3QiLCJtb2NrIiwiUzNDbGllbnQiLCJmbiIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsInNlbmQiLCJQdXRPYmplY3RDb21tYW5kIiwiSGVhZEJ1Y2tldENvbW1hbmQiLCJnZXRDaXJjdWl0QnJlYWtlciIsIm1vY2tSZXR1cm5WYWx1ZSIsImV4ZWN1dGUiLCJzYW5pdGl6ZUlucHV0IiwiaW5wdXQiLCJyZXBsYWNlIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInJlc2V0QjJDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiQjJfQlVDS0VUX05BTUUiLCJCMl9DRE5fRE9NQUlOIiwiYWZ0ZXJFYWNoIiwiaXQiLCJjb25maWciLCJlbmRwb2ludCIsInJlZ2lvbiIsImFjY2Vzc0tleUlkIiwic2VjcmV0QWNjZXNzS2V5IiwiYnVja2V0IiwiY2RuRG9tYWluIiwicmVzdWx0IiwiaW5pdGlhbGl6ZUIyQ2xpZW50IiwiZXhwZWN0Iiwic3VjY2VzcyIsInRvQmUiLCJyZXF1aXJlIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJvYmplY3RDb250YWluaW5nIiwiY3JlZGVudGlhbHMiLCJmb3JjZVBhdGhTdHlsZSIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJtb2NrSW1wbGVtZW50YXRpb25PbmNlIiwiRXJyb3IiLCJtb2NrU2VuZCIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiZmlsZUJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJ1cGxvYWRUb0IyIiwiZGF0YSIsInVybCIsInRvQ29udGFpbiIsImtleSIsIm1vY2tSZWplY3RlZFZhbHVlIiwiS2V5Iiwic3RyaW5nTWF0Y2hpbmciLCJjaGVja0IySGVhbHRoIiwiaGVhbHRoeSIsImxhc3RDaGVja2VkIiwidG9CZURlZmluZWQiLCJ0b0JlSW5zdGFuY2VPZiIsIkRhdGUiLCJ0b0JlVW5kZWZpbmVkIiwiZmlyc3RDaGVjayIsImZpcnN0VGltZXN0YW1wIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Iiwic2Vjb25kQ2hlY2siLCJzZWNvbmRUaW1lc3RhbXAiLCJnZXRUaW1lIiwidG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCIsInN0YXR1cyIsImdldEIySGVhbHRoU3RhdHVzIiwidG9IYXZlUHJvcGVydHkiLCJnZW5lcmF0ZUNETlVybCIsInRvTWF0Y2giLCJub3QiLCJpc0IySGVhbHRoeSIsIm1vY2tDaXJjdWl0QnJlYWtlciJdLCJtYXBwaW5ncyI6IjtBQVVBLGVBQWU7QUFDZkEsS0FBS0MsSUFBSSxDQUFD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