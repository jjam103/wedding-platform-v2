{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/b2Service.test.ts"],"sourcesContent":["import {\n  initializeB2Client,\n  uploadToB2,\n  checkB2Health,\n  getB2HealthStatus,\n  generateCDNUrl,\n  isB2Healthy,\n  resetB2Client,\n} from './b2Service';\n\n// Mock AWS SDK\njest.mock('@aws-sdk/client-s3', () => ({\n  S3Client: jest.fn().mockImplementation(() => ({\n    send: jest.fn(),\n  })),\n  PutObjectCommand: jest.fn(),\n  HeadBucketCommand: jest.fn(),\n}));\n\n// Mock circuit breaker\njest.mock('../utils/circuitBreaker', () => ({\n  getCircuitBreaker: jest.fn().mockReturnValue({\n    execute: jest.fn().mockImplementation((fn) => fn()),\n  }),\n}));\n\n// Mock sanitization\njest.mock('../utils/sanitization', () => ({\n  sanitizeInput: jest.fn((input) => input?.replace(/[^a-zA-Z0-9._-]/g, '_') || ''),\n}));\n\ndescribe('b2Service', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    resetB2Client(); // Reset client state before each test\n    // Reset environment variables\n    process.env.B2_BUCKET_NAME = 'test-bucket';\n    process.env.B2_CDN_DOMAIN = 'cdn.example.com';\n  });\n\n  afterEach(() => {\n    delete process.env.B2_BUCKET_NAME;\n    delete process.env.B2_CDN_DOMAIN;\n    resetB2Client(); // Clean up after each test\n  });\n\n  describe('initializeB2Client', () => {\n    it('should return success when valid configuration provided', () => {\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      const result = initializeB2Client(config);\n      expect(result.success).toBe(true);\n    });\n\n    it('should initialize B2 client with correct endpoint format', () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      initializeB2Client(config);\n\n      expect(S3Client).toHaveBeenCalledWith(\n        expect.objectContaining({\n          endpoint: 'https://s3.us-west-002.backblazeb2.com',\n          region: 'us-west-002',\n          credentials: {\n            accessKeyId: 'test-key-id',\n            secretAccessKey: 'test-secret-key',\n          },\n          forcePathStyle: true, // Required for B2 S3-compatible API\n        })\n      );\n    });\n\n    it('should return CONFIGURATION_ERROR when missing endpoint', () => {\n      const config = {\n        endpoint: '',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      const result = initializeB2Client(config);\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CONFIGURATION_ERROR');\n        expect(result.error.message).toBe('Missing required B2 configuration');\n      }\n    });\n\n    it('should return CONFIGURATION_ERROR when missing accessKeyId', () => {\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: '',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      const result = initializeB2Client(config);\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CONFIGURATION_ERROR');\n      }\n    });\n\n    it('should return CONFIGURATION_ERROR when missing secretAccessKey', () => {\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: '',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      const result = initializeB2Client(config);\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CONFIGURATION_ERROR');\n      }\n    });\n\n    it('should return CONFIGURATION_ERROR when missing bucket', () => {\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: '',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      const result = initializeB2Client(config);\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CONFIGURATION_ERROR');\n      }\n    });\n\n    it('should return INITIALIZATION_ERROR when S3Client throws error', () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      S3Client.mockImplementationOnce(() => {\n        throw new Error('S3Client initialization failed');\n      });\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      const result = initializeB2Client(config);\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('INITIALIZATION_ERROR');\n        expect(result.error.message).toBe('S3Client initialization failed');\n      }\n    });\n  });\n\n  describe('uploadToB2', () => {\n    beforeEach(() => {\n      // Initialize client first\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n    });\n\n    it('should return success when file uploaded successfully', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockResolvedValue({});\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      // Re-initialize with mocked client\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const fileBuffer = Buffer.from('test file content');\n      const result = await uploadToB2(fileBuffer, 'test-photo.jpg', 'image/jpeg');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.url).toContain('cdn.example.com');\n        expect(result.data.key).toContain('test-photo.jpg');\n      }\n    });\n\n    it('should return CLIENT_NOT_INITIALIZED when client not initialized', async () => {\n      // Reset client to ensure it's not initialized\n      resetB2Client();\n      \n      const fileBuffer = Buffer.from('test file content');\n      const result = await uploadToB2(fileBuffer, 'test-photo.jpg', 'image/jpeg');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CLIENT_NOT_INITIALIZED');\n      }\n    });\n\n    it('should return UPLOAD_ERROR when S3 upload fails', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockRejectedValue(new Error('Upload failed'));\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      // Re-initialize with mocked client\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const fileBuffer = Buffer.from('test file content');\n      const result = await uploadToB2(fileBuffer, 'test-photo.jpg', 'image/jpeg');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('UPLOAD_ERROR');\n      }\n    });\n\n    it('should sanitize filename to prevent path traversal', async () => {\n      const { S3Client, PutObjectCommand } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockResolvedValue({});\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      // Re-initialize with mocked client\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const fileBuffer = Buffer.from('test file content');\n      await uploadToB2(fileBuffer, '../../../malicious.jpg', 'image/jpeg');\n\n      expect(PutObjectCommand).toHaveBeenCalledWith(\n        expect.objectContaining({\n          Key: expect.stringMatching(/photos\\/\\d+-\\.\\._\\.\\._\\.\\._malicious\\.jpg/),\n        })\n      );\n    });\n  });\n\n  describe('checkB2Health', () => {\n    it('should return { available: true } when B2 is configured and healthy', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockResolvedValue({});\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      // Initialize client\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const result = await checkB2Health();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.healthy).toBe(true);\n        expect(result.data.lastChecked).toBeDefined();\n        expect(result.data.lastChecked).toBeInstanceOf(Date);\n        expect(result.data.error).toBeUndefined();\n      }\n    });\n\n    it('should return { available: false } when B2 is not configured', async () => {\n      // Reset client to ensure it's not initialized\n      resetB2Client();\n      \n      const result = await checkB2Health();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.healthy).toBe(false);\n        expect(result.data.error).toBe('B2 client not initialized');\n        expect(result.data.lastChecked).toBeDefined();\n      }\n    });\n\n    it('should return { available: false } when bucket is not accessible', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockRejectedValue(new Error('Access denied'));\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      // Initialize client\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const result = await checkB2Health();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.healthy).toBe(false);\n        expect(result.data.error).toBe('Access denied');\n        expect(result.data.lastChecked).toBeDefined();\n      }\n    });\n\n    it('should update health status timestamp on each check', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockResolvedValue({});\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const firstCheck = await checkB2Health();\n      const firstTimestamp = firstCheck.success ? firstCheck.data.lastChecked : null;\n\n      // Wait a bit to ensure timestamp difference\n      await new Promise(resolve => setTimeout(resolve, 10));\n\n      const secondCheck = await checkB2Health();\n      const secondTimestamp = secondCheck.success ? secondCheck.data.lastChecked : null;\n\n      expect(firstTimestamp).toBeDefined();\n      expect(secondTimestamp).toBeDefined();\n      if (firstTimestamp && secondTimestamp) {\n        expect(secondTimestamp.getTime()).toBeGreaterThanOrEqual(firstTimestamp.getTime());\n      }\n    });\n  });\n\n  describe('getB2HealthStatus', () => {\n    it('should return current health status', () => {\n      const status = getB2HealthStatus();\n      expect(status).toHaveProperty('healthy');\n      expect(status).toHaveProperty('lastChecked');\n    });\n  });\n\n  describe('generateCDNUrl', () => {\n    it('should generate correct CDN URL with proper format', () => {\n      const url = generateCDNUrl('photos/1234567890-photo.jpg');\n      expect(url).toBe('https://cdn.example.com/photos/1234567890-photo.jpg');\n      expect(url).toMatch(/^https:\\/\\//); // Starts with https://\n      expect(url).toContain('cdn.example.com'); // Contains CDN domain\n      expect(url).toContain('/photos/'); // Contains photos path\n    });\n\n    it('should handle keys with special characters', () => {\n      const url = generateCDNUrl('photos/1234567890-test_photo-v2.jpg');\n      expect(url).toBe('https://cdn.example.com/photos/1234567890-test_photo-v2.jpg');\n      expect(url).toMatch(/^https:\\/\\/cdn\\.example\\.com\\//);\n    });\n\n    it('should handle keys without photos prefix', () => {\n      const url = generateCDNUrl('other/path/file.jpg');\n      expect(url).toBe('https://cdn.example.com/other/path/file.jpg');\n    });\n\n    it('should handle empty CDN domain gracefully', () => {\n      delete process.env.B2_CDN_DOMAIN;\n      const url = generateCDNUrl('photos/1234567890-photo.jpg');\n      expect(url).toBe('https:///photos/1234567890-photo.jpg');\n      // Restore for other tests\n      process.env.B2_CDN_DOMAIN = 'cdn.example.com';\n    });\n\n    it('should not double-encode URLs', () => {\n      const url = generateCDNUrl('photos/1234567890-photo%20with%20spaces.jpg');\n      expect(url).toBe('https://cdn.example.com/photos/1234567890-photo%20with%20spaces.jpg');\n      expect(url).not.toContain('%2520'); // Should not double-encode\n    });\n  });\n\n  describe('isB2Healthy', () => {\n    it('should return cached health status when recent', async () => {\n      // First check to set status\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockResolvedValue({});\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      await checkB2Health();\n\n      // Now check if it returns cached status\n      const result = await isB2Healthy();\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(typeof result.data).toBe('boolean');\n      }\n    });\n\n    it('should perform new health check when status is stale', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockResolvedValue({});\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const result = await isB2Healthy();\n      expect(result.success).toBe(true);\n    });\n  });\n\n  describe('Error Handling - Application Stability', () => {\n    it('should not crash app when B2 upload fails', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockRejectedValue(new Error('Network error'));\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const fileBuffer = Buffer.from('test file content');\n      \n      // Should not throw, should return error result\n      const result = await uploadToB2(fileBuffer, 'test-photo.jpg', 'image/jpeg');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('UPLOAD_ERROR');\n        expect(result.error.message).toBe('Network error');\n      }\n    });\n\n    it('should not crash app when health check fails', async () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      const mockSend = jest.fn().mockRejectedValue(new Error('Connection timeout'));\n      S3Client.mockImplementation(() => ({ send: mockSend }));\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      // Should not throw, should return unhealthy status\n      const result = await checkB2Health();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.healthy).toBe(false);\n        expect(result.data.error).toBe('Connection timeout');\n      }\n    });\n\n    it('should not crash app when initialization fails', () => {\n      const { S3Client } = require('@aws-sdk/client-s3');\n      S3Client.mockImplementationOnce(() => {\n        throw new Error('Invalid credentials');\n      });\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'invalid-key',\n        secretAccessKey: 'invalid-secret',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n\n      // Should not throw, should return error result\n      const result = initializeB2Client(config);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('INITIALIZATION_ERROR');\n        expect(result.error.message).toBe('Invalid credentials');\n      }\n    });\n\n    it('should handle circuit breaker open state gracefully', async () => {\n      const { getCircuitBreaker } = require('../utils/circuitBreaker');\n      const mockCircuitBreaker = {\n        execute: jest.fn().mockRejectedValue(new Error('Circuit breaker open')),\n      };\n      getCircuitBreaker.mockReturnValue(mockCircuitBreaker);\n\n      const config = {\n        endpoint: 'https://s3.us-west-002.backblazeb2.com',\n        region: 'us-west-002',\n        accessKeyId: 'test-key-id',\n        secretAccessKey: 'test-secret-key',\n        bucket: 'test-bucket',\n        cdnDomain: 'cdn.example.com',\n      };\n      initializeB2Client(config);\n\n      const fileBuffer = Buffer.from('test file content');\n      const result = await uploadToB2(fileBuffer, 'test-photo.jpg', 'image/jpeg');\n\n      // Should handle circuit breaker error gracefully\n      expect(result.success).toBe(false);\n    });\n  });\n});"],"names":["jest","mock","S3Client","fn","mockImplementation","send","PutObjectCommand","HeadBucketCommand","getCircuitBreaker","mockReturnValue","execute","sanitizeInput","input","replace","describe","beforeEach","clearAllMocks","resetB2Client","process","env","B2_BUCKET_NAME","B2_CDN_DOMAIN","afterEach","it","config","endpoint","region","accessKeyId","secretAccessKey","bucket","cdnDomain","result","initializeB2Client","expect","success","toBe","require","toHaveBeenCalledWith","objectContaining","credentials","forcePathStyle","error","code","message","mockImplementationOnce","Error","mockSend","mockResolvedValue","fileBuffer","Buffer","from","uploadToB2","data","url","toContain","key","mockRejectedValue","Key","stringMatching","checkB2Health","healthy","lastChecked","toBeDefined","toBeInstanceOf","Date","toBeUndefined","firstCheck","firstTimestamp","Promise","resolve","setTimeout","secondCheck","secondTimestamp","getTime","toBeGreaterThanOrEqual","status","getB2HealthStatus","toHaveProperty","generateCDNUrl","toMatch","not","isB2Healthy","mockCircuitBreaker"],"mappings":"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"}