{"version":3,"names":["PUT","updateAuthMethodSchema","cov_1chpmaq49x","s","_zod","z","object","auth_method","enum","getStatusCode","errorCode","f","statusMap","b","request","params","id","supabase","_supabaseServer","createAuthenticatedClient","data","session","error","authError","auth","getSession","_server","NextResponse","json","success","code","message","status","idValidation","string","uuid","safeParse","body","validation","details","issues","guest","updateError","from","update","eq","select","single","email","first_name","last_name","console","path","url","method"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/guests/[id]/auth-method/route.ts"],"sourcesContent":["import { createAuthenticatedClient } from '@/lib/supabaseServer';\nimport { NextResponse } from 'next/server';\nimport { z } from 'zod';\n\n/**\n * PUT /api/admin/guests/[id]/auth-method\n * \n * Updates authentication method for a specific guest\n * \n * Requirements: 22.3\n */\n\nconst updateAuthMethodSchema = z.object({\n  auth_method: z.enum(['email_matching', 'magic_link']),\n});\n\nfunction getStatusCode(errorCode: string): number {\n  const statusMap: Record<string, number> = {\n    'VALIDATION_ERROR': 400,\n    'UNAUTHORIZED': 401,\n    'FORBIDDEN': 403,\n    'NOT_FOUND': 404,\n    'GUEST_NOT_FOUND': 404,\n    'DATABASE_ERROR': 500,\n    'INTERNAL_ERROR': 500,\n  };\n  return statusMap[errorCode] || 500;\n}\n\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Await params (Next.js 15 requirement)\n    const { id } = await params;\n\n    // 1. AUTHENTICATION\n    const supabase = await createAuthenticatedClient();\n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. VALIDATION\n    // Validate guest ID\n    const idValidation = z.string().uuid().safeParse(id);\n    if (!idValidation.success) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid guest ID format' } },\n        { status: 400 }\n      );\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const validation = updateAuthMethodSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid request data',\n            details: validation.error.issues,\n          },\n        },\n        { status: 400 }\n      );\n    }\n\n    // 3. SERVICE CALL\n    const { data: guest, error: updateError } = await supabase\n      .from('guests')\n      .update({ auth_method: validation.data.auth_method })\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (updateError) {\n      if (updateError.code === 'PGRST116') {\n        return NextResponse.json(\n          { success: false, error: { code: 'GUEST_NOT_FOUND', message: 'Guest not found' } },\n          { status: 404 }\n        );\n      }\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'DATABASE_ERROR', message: 'Failed to update guest', details: updateError },\n        },\n        { status: 500 }\n      );\n    }\n\n    // 4. RESPONSE\n    return NextResponse.json(\n      {\n        success: true,\n        data: {\n          id: guest.id,\n          auth_method: guest.auth_method,\n          email: guest.email,\n          first_name: guest.first_name,\n          last_name: guest.last_name,\n        },\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('API Error:', { path: request.url, method: request.method, error });\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}