{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/authMethodMigrations.regression.test.ts"],"sourcesContent":["/**\n * Regression tests for authentication method migrations\n * Ensures migrations don't break existing guest functionality\n * \n * Requirements: 5.1, 5.2, 5.3, 22.1, 22.2\n * Tasks: 4.1, 4.2\n */\n\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\n\ndescribe('Regression: Authentication Method Migrations', () => {\n  let supabase: ReturnType<typeof createClient>;\n  let testGroupId: string;\n\n  beforeAll(async () => {\n    supabase = createClient(supabaseUrl, supabaseServiceKey);\n\n    // Create test group\n    const { data: group } = await supabase\n      .from('groups')\n      .insert({ name: 'Regression Test Group' })\n      .select()\n      .single();\n\n    testGroupId = group!.id;\n  });\n\n  afterAll(async () => {\n    // Clean up\n    if (testGroupId) {\n      await supabase.from('groups').delete().eq('id', testGroupId);\n    }\n  });\n\n  describe('Existing guest functionality', () => {\n    it('should not break existing guest creation', async () => {\n      const { data: guest, error } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'Regression',\n          last_name: 'Test',\n          email: 'regression.test@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(guest).toBeDefined();\n      expect(guest.first_name).toBe('Regression');\n      expect(guest.last_name).toBe('Test');\n      expect(guest.email).toBe('regression.test@example.com');\n      expect(guest.auth_method).toBe('email_matching'); // Default value\n\n      // Clean up\n      await supabase.from('guests').delete().eq('id', guest.id);\n    });\n\n    it('should not break existing guest updates', async () => {\n      // Create guest\n      const { data: guest } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'Update',\n          last_name: 'Test',\n          email: 'update.test@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        })\n        .select()\n        .single();\n\n      const guestId = guest!.id;\n\n      // Update guest (without touching auth_method)\n      const { data: updated, error } = await supabase\n        .from('guests')\n        .update({\n          first_name: 'Updated',\n          phone: '+1234567890',\n        })\n        .eq('id', guestId)\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(updated).toBeDefined();\n      expect(updated.first_name).toBe('Updated');\n      expect(updated.phone).toBe('+1234567890');\n      expect(updated.auth_method).toBe('email_matching'); // Should remain unchanged\n\n      // Clean up\n      await supabase.from('guests').delete().eq('id', guestId);\n    });\n\n    it('should not break existing guest queries', async () => {\n      // Create multiple guests\n      const guests = [\n        {\n          group_id: testGroupId,\n          first_name: 'Query1',\n          last_name: 'Test',\n          email: 'query1@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        },\n        {\n          group_id: testGroupId,\n          first_name: 'Query2',\n          last_name: 'Test',\n          email: 'query2@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        },\n      ];\n\n      const { data: created } = await supabase\n        .from('guests')\n        .insert(guests)\n        .select();\n\n      // Query guests\n      const { data: queried, error } = await supabase\n        .from('guests')\n        .select('*')\n        .eq('group_id', testGroupId)\n        .in('email', ['query1@example.com', 'query2@example.com']);\n\n      expect(error).toBeNull();\n      expect(queried).toBeDefined();\n      expect(queried.length).toBe(2);\n\n      // Clean up\n      if (created) {\n        for (const guest of created) {\n          await supabase.from('guests').delete().eq('id', guest.id);\n        }\n      }\n    });\n\n    it('should not break existing guest deletion', async () => {\n      // Create guest\n      const { data: guest } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'Delete',\n          last_name: 'Test',\n          email: 'delete.test@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        })\n        .select()\n        .single();\n\n      const guestId = guest!.id;\n\n      // Delete guest\n      const { error } = await supabase\n        .from('guests')\n        .delete()\n        .eq('id', guestId);\n\n      expect(error).toBeNull();\n\n      // Verify deletion\n      const { data: deleted } = await supabase\n        .from('guests')\n        .select('*')\n        .eq('id', guestId)\n        .single();\n\n      expect(deleted).toBeNull();\n    });\n  });\n\n  describe('Existing settings functionality', () => {\n    it('should not break existing settings queries', async () => {\n      const { data: settings, error } = await supabase\n        .from('system_settings')\n        .select('*')\n        .limit(1)\n        .single();\n\n      expect(error).toBeNull();\n      expect(settings).toBeDefined();\n      expect(settings.default_auth_method).toBeDefined();\n      expect(['email_matching', 'magic_link']).toContain(settings.default_auth_method);\n    });\n\n    it('should not break existing settings updates', async () => {\n      // Get existing settings\n      const { data: settings } = await supabase\n        .from('system_settings')\n        .select('id, timezone')\n        .limit(1)\n        .single();\n\n      if (settings) {\n        const originalTimezone = settings.timezone;\n\n        // Update settings (without touching default_auth_method)\n        const { data: updated, error } = await supabase\n          .from('system_settings')\n          .update({ timezone: 'America/New_York' })\n          .eq('id', settings.id)\n          .select()\n          .single();\n\n        expect(error).toBeNull();\n        expect(updated).toBeDefined();\n        expect(updated.timezone).toBe('America/New_York');\n        expect(updated.default_auth_method).toBeDefined();\n\n        // Restore original timezone\n        await supabase\n          .from('system_settings')\n          .update({ timezone: originalTimezone })\n          .eq('id', settings.id);\n      }\n    });\n  });\n\n  describe('Backward compatibility', () => {\n    it('should allow guests without email to have auth_method', async () => {\n      // Some guests might not have email addresses (e.g., children)\n      const { data: guest, error } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'NoEmail',\n          last_name: 'Child',\n          email: null,\n          age_type: 'child',\n          guest_type: 'wedding_guest',\n          auth_method: 'email_matching', // Still has auth_method even without email\n        })\n        .select()\n        .single();\n\n      expect(error).toBeNull();\n      expect(guest).toBeDefined();\n      expect(guest.email).toBeNull();\n      expect(guest.auth_method).toBe('email_matching');\n\n      // Clean up\n      await supabase.from('guests').delete().eq('id', guest.id);\n    });\n\n    it('should maintain existing guest relationships', async () => {\n      // Create guest with RSVP\n      const { data: guest } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'RSVP',\n          last_name: 'Test',\n          email: 'rsvp.test@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n        })\n        .select()\n        .single();\n\n      const guestId = guest!.id;\n\n      // Create event\n      const { data: event } = await supabase\n        .from('events')\n        .insert({\n          name: 'Test Event',\n          event_type: 'ceremony',\n          start_date: new Date().toISOString(),\n          status: 'published',\n        })\n        .select()\n        .single();\n\n      const eventId = event!.id;\n\n      // Create RSVP\n      const { data: rsvp, error: rsvpError } = await supabase\n        .from('rsvps')\n        .insert({\n          guest_id: guestId,\n          event_id: eventId,\n          status: 'attending',\n        })\n        .select()\n        .single();\n\n      expect(rsvpError).toBeNull();\n      expect(rsvp).toBeDefined();\n      expect(rsvp.guest_id).toBe(guestId);\n\n      // Clean up\n      await supabase.from('rsvps').delete().eq('id', rsvp.id);\n      await supabase.from('events').delete().eq('id', eventId);\n      await supabase.from('guests').delete().eq('id', guestId);\n    });\n\n    it('should not affect existing indexes', async () => {\n      // Test that existing indexes still work\n      const { data: guestsByGroup, error: groupError } = await supabase\n        .from('guests')\n        .select('*')\n        .eq('group_id', testGroupId);\n\n      expect(groupError).toBeNull();\n      expect(guestsByGroup).toBeDefined();\n\n      // Test email index\n      const { data: guestsByEmail, error: emailError } = await supabase\n        .from('guests')\n        .select('*')\n        .eq('email', 'test@example.com');\n\n      expect(emailError).toBeNull();\n      expect(guestsByEmail).toBeDefined();\n    });\n  });\n\n  describe('Data integrity', () => {\n    it('should maintain referential integrity with magic link tokens', async () => {\n      // Create guest\n      const { data: guest } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'Integrity',\n          last_name: 'Test',\n          email: 'integrity.test@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n          auth_method: 'magic_link',\n        })\n        .select()\n        .single();\n\n      const guestId = guest!.id;\n\n      // Create magic link token\n      const { data: token } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: 'integrity_test_token_' + Date.now(),\n          guest_id: guestId,\n          expires_at: new Date(Date.now() + 15 * 60 * 1000).toISOString(),\n        })\n        .select()\n        .single();\n\n      const tokenId = token!.id;\n\n      // Verify token references guest\n      const { data: tokenWithGuest } = await supabase\n        .from('magic_link_tokens')\n        .select('*, guests(*)')\n        .eq('id', tokenId)\n        .single();\n\n      expect(tokenWithGuest).toBeDefined();\n      expect(tokenWithGuest.guest_id).toBe(guestId);\n\n      // Delete guest (should cascade delete token)\n      await supabase.from('guests').delete().eq('id', guestId);\n\n      // Verify token was cascade deleted\n      const { data: deletedToken } = await supabase\n        .from('magic_link_tokens')\n        .select('*')\n        .eq('id', tokenId)\n        .single();\n\n      expect(deletedToken).toBeNull();\n    });\n\n    it('should not allow orphaned magic link tokens', async () => {\n      const fakeGuestId = '00000000-0000-0000-0000-000000000000';\n\n      // Try to create token with non-existent guest\n      const { error } = await supabase\n        .from('magic_link_tokens')\n        .insert({\n          token: 'orphan_token_' + Date.now(),\n          guest_id: fakeGuestId,\n          expires_at: new Date(Date.now() + 15 * 60 * 1000).toISOString(),\n        });\n\n      expect(error).not.toBeNull();\n      expect(error?.message).toMatch(/foreign key|violates/i);\n    });\n  });\n\n  describe('Performance regression', () => {\n    it('should not significantly slow down guest queries', async () => {\n      // Create multiple guests for performance testing\n      const guests = Array.from({ length: 50 }, (_, i) => ({\n        group_id: testGroupId,\n        first_name: `Perf${i}`,\n        last_name: 'Test',\n        email: `perf${i}@example.com`,\n        age_type: 'adult',\n        guest_type: 'wedding_guest',\n      }));\n\n      const { data: created } = await supabase\n        .from('guests')\n        .insert(guests)\n        .select();\n\n      // Measure query time\n      const startTime = Date.now();\n\n      await supabase\n        .from('guests')\n        .select('*')\n        .eq('group_id', testGroupId);\n\n      const queryTime = Date.now() - startTime;\n\n      // Clean up\n      if (created) {\n        for (const guest of created) {\n          await supabase.from('guests').delete().eq('id', guest.id);\n        }\n      }\n\n      // Query should complete in reasonable time (< 200ms for 50 guests)\n      expect(queryTime).toBeLessThan(200);\n    });\n\n    it('should efficiently query by email and auth_method', async () => {\n      // Create guest\n      const { data: guest } = await supabase\n        .from('guests')\n        .insert({\n          group_id: testGroupId,\n          first_name: 'EmailQuery',\n          last_name: 'Test',\n          email: 'emailquery@example.com',\n          age_type: 'adult',\n          guest_type: 'wedding_guest',\n          auth_method: 'email_matching',\n        })\n        .select()\n        .single();\n\n      // Measure query time with composite index\n      const startTime = Date.now();\n\n      await supabase\n        .from('guests')\n        .select('*')\n        .eq('email', 'emailquery@example.com')\n        .eq('auth_method', 'email_matching')\n        .single();\n\n      const queryTime = Date.now() - startTime;\n\n      // Clean up\n      await supabase.from('guests').delete().eq('id', guest!.id);\n\n      // Query should be fast with composite index (< 50ms)\n      expect(queryTime).toBeLessThan(50);\n    });\n  });\n});\n"],"names":["supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceKey","SUPABASE_SERVICE_ROLE_KEY","describe","supabase","testGroupId","beforeAll","createClient","data","group","from","insert","name","select","single","id","afterAll","delete","eq","it","guest","error","group_id","first_name","last_name","email","age_type","guest_type","expect","toBeNull","toBeDefined","toBe","auth_method","guestId","updated","update","phone","guests","created","queried","in","length","deleted","settings","limit","default_auth_method","toContain","originalTimezone","timezone","event","event_type","start_date","Date","toISOString","status","eventId","rsvp","rsvpError","guest_id","event_id","guestsByGroup","groupError","guestsByEmail","emailError","token","now","expires_at","tokenId","tokenWithGuest","deletedToken","fakeGuestId","not","message","toMatch","Array","_","i","startTime","queryTime","toBeLessThan"],"mappings":"AAAA;;;;;;CAMC;;;;4BAE4B;AAE7B,MAAMA,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;AACxD,MAAMC,qBAAqBH,QAAQC,GAAG,CAACG,yBAAyB;AAEhEC,SAAS,gDAAgD;IACvD,IAAIC;IACJ,IAAIC;IAEJC,UAAU;QACRF,WAAWG,IAAAA,wBAAY,EAACV,aAAaI;QAErC,oBAAoB;QACpB,MAAM,EAAEO,MAAMC,KAAK,EAAE,GAAG,MAAML,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC;YAAEC,MAAM;QAAwB,GACvCC,MAAM,GACNC,MAAM;QAETT,cAAcI,MAAOM,EAAE;IACzB;IAEAC,SAAS;QACP,WAAW;QACX,IAAIX,aAAa;YACf,MAAMD,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAMb;QAClD;IACF;IAEAF,SAAS,gCAAgC;QACvCgB,GAAG,4CAA4C;YAC7C,MAAM,EAAEX,MAAMY,KAAK,EAAEC,KAAK,EAAE,GAAG,MAAMjB,SAClCM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNW,UAAUjB;gBACVkB,YAAY;gBACZC,WAAW;gBACXC,OAAO;gBACPC,UAAU;gBACVC,YAAY;YACd,GACCd,MAAM,GACNC,MAAM;YAETc,OAAOP,OAAOQ,QAAQ;YACtBD,OAAOR,OAAOU,WAAW;YACzBF,OAAOR,MAAMG,UAAU,EAAEQ,IAAI,CAAC;YAC9BH,OAAOR,MAAMI,SAAS,EAAEO,IAAI,CAAC;YAC7BH,OAAOR,MAAMK,KAAK,EAAEM,IAAI,CAAC;YACzBH,OAAOR,MAAMY,WAAW,EAAED,IAAI,CAAC,mBAAmB,gBAAgB;YAElE,WAAW;YACX,MAAM3B,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAME,MAAML,EAAE;QAC1D;QAEAI,GAAG,2CAA2C;YAC5C,eAAe;YACf,MAAM,EAAEX,MAAMY,KAAK,EAAE,GAAG,MAAMhB,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNW,UAAUjB;gBACVkB,YAAY;gBACZC,WAAW;gBACXC,OAAO;gBACPC,UAAU;gBACVC,YAAY;YACd,GACCd,MAAM,GACNC,MAAM;YAET,MAAMmB,UAAUb,MAAOL,EAAE;YAEzB,8CAA8C;YAC9C,MAAM,EAAEP,MAAM0B,OAAO,EAAEb,KAAK,EAAE,GAAG,MAAMjB,SACpCM,IAAI,CAAC,UACLyB,MAAM,CAAC;gBACNZ,YAAY;gBACZa,OAAO;YACT,GACClB,EAAE,CAAC,MAAMe,SACTpB,MAAM,GACNC,MAAM;YAETc,OAAOP,OAAOQ,QAAQ;YACtBD,OAAOM,SAASJ,WAAW;YAC3BF,OAAOM,QAAQX,UAAU,EAAEQ,IAAI,CAAC;YAChCH,OAAOM,QAAQE,KAAK,EAAEL,IAAI,CAAC;YAC3BH,OAAOM,QAAQF,WAAW,EAAED,IAAI,CAAC,mBAAmB,0BAA0B;YAE9E,WAAW;YACX,MAAM3B,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAMe;QAClD;QAEAd,GAAG,2CAA2C;YAC5C,yBAAyB;YACzB,MAAMkB,SAAS;gBACb;oBACEf,UAAUjB;oBACVkB,YAAY;oBACZC,WAAW;oBACXC,OAAO;oBACPC,UAAU;oBACVC,YAAY;gBACd;gBACA;oBACEL,UAAUjB;oBACVkB,YAAY;oBACZC,WAAW;oBACXC,OAAO;oBACPC,UAAU;oBACVC,YAAY;gBACd;aACD;YAED,MAAM,EAAEnB,MAAM8B,OAAO,EAAE,GAAG,MAAMlC,SAC7BM,IAAI,CAAC,UACLC,MAAM,CAAC0B,QACPxB,MAAM;YAET,eAAe;YACf,MAAM,EAAEL,MAAM+B,OAAO,EAAElB,KAAK,EAAE,GAAG,MAAMjB,SACpCM,IAAI,CAAC,UACLG,MAAM,CAAC,KACPK,EAAE,CAAC,YAAYb,aACfmC,EAAE,CAAC,SAAS;gBAAC;gBAAsB;aAAqB;YAE3DZ,OAAOP,OAAOQ,QAAQ;YACtBD,OAAOW,SAAST,WAAW;YAC3BF,OAAOW,QAAQE,MAAM,EAAEV,IAAI,CAAC;YAE5B,WAAW;YACX,IAAIO,SAAS;gBACX,KAAK,MAAMlB,SAASkB,QAAS;oBAC3B,MAAMlC,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAME,MAAML,EAAE;gBAC1D;YACF;QACF;QAEAI,GAAG,4CAA4C;YAC7C,eAAe;YACf,MAAM,EAAEX,MAAMY,KAAK,EAAE,GAAG,MAAMhB,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNW,UAAUjB;gBACVkB,YAAY;gBACZC,WAAW;gBACXC,OAAO;gBACPC,UAAU;gBACVC,YAAY;YACd,GACCd,MAAM,GACNC,MAAM;YAET,MAAMmB,UAAUb,MAAOL,EAAE;YAEzB,eAAe;YACf,MAAM,EAAEM,KAAK,EAAE,GAAG,MAAMjB,SACrBM,IAAI,CAAC,UACLO,MAAM,GACNC,EAAE,CAAC,MAAMe;YAEZL,OAAOP,OAAOQ,QAAQ;YAEtB,kBAAkB;YAClB,MAAM,EAAErB,MAAMkC,OAAO,EAAE,GAAG,MAAMtC,SAC7BM,IAAI,CAAC,UACLG,MAAM,CAAC,KACPK,EAAE,CAAC,MAAMe,SACTnB,MAAM;YAETc,OAAOc,SAASb,QAAQ;QAC1B;IACF;IAEA1B,SAAS,mCAAmC;QAC1CgB,GAAG,8CAA8C;YAC/C,MAAM,EAAEX,MAAMmC,QAAQ,EAAEtB,KAAK,EAAE,GAAG,MAAMjB,SACrCM,IAAI,CAAC,mBACLG,MAAM,CAAC,KACP+B,KAAK,CAAC,GACN9B,MAAM;YAETc,OAAOP,OAAOQ,QAAQ;YACtBD,OAAOe,UAAUb,WAAW;YAC5BF,OAAOe,SAASE,mBAAmB,EAAEf,WAAW;YAChDF,OAAO;gBAAC;gBAAkB;aAAa,EAAEkB,SAAS,CAACH,SAASE,mBAAmB;QACjF;QAEA1B,GAAG,8CAA8C;YAC/C,wBAAwB;YACxB,MAAM,EAAEX,MAAMmC,QAAQ,EAAE,GAAG,MAAMvC,SAC9BM,IAAI,CAAC,mBACLG,MAAM,CAAC,gBACP+B,KAAK,CAAC,GACN9B,MAAM;YAET,IAAI6B,UAAU;gBACZ,MAAMI,mBAAmBJ,SAASK,QAAQ;gBAE1C,yDAAyD;gBACzD,MAAM,EAAExC,MAAM0B,OAAO,EAAEb,KAAK,EAAE,GAAG,MAAMjB,SACpCM,IAAI,CAAC,mBACLyB,MAAM,CAAC;oBAAEa,UAAU;gBAAmB,GACtC9B,EAAE,CAAC,MAAMyB,SAAS5B,EAAE,EACpBF,MAAM,GACNC,MAAM;gBAETc,OAAOP,OAAOQ,QAAQ;gBACtBD,OAAOM,SAASJ,WAAW;gBAC3BF,OAAOM,QAAQc,QAAQ,EAAEjB,IAAI,CAAC;gBAC9BH,OAAOM,QAAQW,mBAAmB,EAAEf,WAAW;gBAE/C,4BAA4B;gBAC5B,MAAM1B,SACHM,IAAI,CAAC,mBACLyB,MAAM,CAAC;oBAAEa,UAAUD;gBAAiB,GACpC7B,EAAE,CAAC,MAAMyB,SAAS5B,EAAE;YACzB;QACF;IACF;IAEAZ,SAAS,0BAA0B;QACjCgB,GAAG,yDAAyD;YAC1D,8DAA8D;YAC9D,MAAM,EAAEX,MAAMY,KAAK,EAAEC,KAAK,EAAE,GAAG,MAAMjB,SAClCM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNW,UAAUjB;gBACVkB,YAAY;gBACZC,WAAW;gBACXC,OAAO;gBACPC,UAAU;gBACVC,YAAY;gBACZK,aAAa;YACf,GACCnB,MAAM,GACNC,MAAM;YAETc,OAAOP,OAAOQ,QAAQ;YACtBD,OAAOR,OAAOU,WAAW;YACzBF,OAAOR,MAAMK,KAAK,EAAEI,QAAQ;YAC5BD,OAAOR,MAAMY,WAAW,EAAED,IAAI,CAAC;YAE/B,WAAW;YACX,MAAM3B,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAME,MAAML,EAAE;QAC1D;QAEAI,GAAG,gDAAgD;YACjD,yBAAyB;YACzB,MAAM,EAAEX,MAAMY,KAAK,EAAE,GAAG,MAAMhB,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNW,UAAUjB;gBACVkB,YAAY;gBACZC,WAAW;gBACXC,OAAO;gBACPC,UAAU;gBACVC,YAAY;YACd,GACCd,MAAM,GACNC,MAAM;YAET,MAAMmB,UAAUb,MAAOL,EAAE;YAEzB,eAAe;YACf,MAAM,EAAEP,MAAMyC,KAAK,EAAE,GAAG,MAAM7C,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNC,MAAM;gBACNsC,YAAY;gBACZC,YAAY,IAAIC,OAAOC,WAAW;gBAClCC,QAAQ;YACV,GACCzC,MAAM,GACNC,MAAM;YAET,MAAMyC,UAAUN,MAAOlC,EAAE;YAEzB,cAAc;YACd,MAAM,EAAEP,MAAMgD,IAAI,EAAEnC,OAAOoC,SAAS,EAAE,GAAG,MAAMrD,SAC5CM,IAAI,CAAC,SACLC,MAAM,CAAC;gBACN+C,UAAUzB;gBACV0B,UAAUJ;gBACVD,QAAQ;YACV,GACCzC,MAAM,GACNC,MAAM;YAETc,OAAO6B,WAAW5B,QAAQ;YAC1BD,OAAO4B,MAAM1B,WAAW;YACxBF,OAAO4B,KAAKE,QAAQ,EAAE3B,IAAI,CAACE;YAE3B,WAAW;YACX,MAAM7B,SAASM,IAAI,CAAC,SAASO,MAAM,GAAGC,EAAE,CAAC,MAAMsC,KAAKzC,EAAE;YACtD,MAAMX,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAMqC;YAChD,MAAMnD,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAMe;QAClD;QAEAd,GAAG,sCAAsC;YACvC,wCAAwC;YACxC,MAAM,EAAEX,MAAMoD,aAAa,EAAEvC,OAAOwC,UAAU,EAAE,GAAG,MAAMzD,SACtDM,IAAI,CAAC,UACLG,MAAM,CAAC,KACPK,EAAE,CAAC,YAAYb;YAElBuB,OAAOiC,YAAYhC,QAAQ;YAC3BD,OAAOgC,eAAe9B,WAAW;YAEjC,mBAAmB;YACnB,MAAM,EAAEtB,MAAMsD,aAAa,EAAEzC,OAAO0C,UAAU,EAAE,GAAG,MAAM3D,SACtDM,IAAI,CAAC,UACLG,MAAM,CAAC,KACPK,EAAE,CAAC,SAAS;YAEfU,OAAOmC,YAAYlC,QAAQ;YAC3BD,OAAOkC,eAAehC,WAAW;QACnC;IACF;IAEA3B,SAAS,kBAAkB;QACzBgB,GAAG,gEAAgE;YACjE,eAAe;YACf,MAAM,EAAEX,MAAMY,KAAK,EAAE,GAAG,MAAMhB,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNW,UAAUjB;gBACVkB,YAAY;gBACZC,WAAW;gBACXC,OAAO;gBACPC,UAAU;gBACVC,YAAY;gBACZK,aAAa;YACf,GACCnB,MAAM,GACNC,MAAM;YAET,MAAMmB,UAAUb,MAAOL,EAAE;YAEzB,0BAA0B;YAC1B,MAAM,EAAEP,MAAMwD,KAAK,EAAE,GAAG,MAAM5D,SAC3BM,IAAI,CAAC,qBACLC,MAAM,CAAC;gBACNqD,OAAO,0BAA0BZ,KAAKa,GAAG;gBACzCP,UAAUzB;gBACViC,YAAY,IAAId,KAAKA,KAAKa,GAAG,KAAK,KAAK,KAAK,MAAMZ,WAAW;YAC/D,GACCxC,MAAM,GACNC,MAAM;YAET,MAAMqD,UAAUH,MAAOjD,EAAE;YAEzB,gCAAgC;YAChC,MAAM,EAAEP,MAAM4D,cAAc,EAAE,GAAG,MAAMhE,SACpCM,IAAI,CAAC,qBACLG,MAAM,CAAC,gBACPK,EAAE,CAAC,MAAMiD,SACTrD,MAAM;YAETc,OAAOwC,gBAAgBtC,WAAW;YAClCF,OAAOwC,eAAeV,QAAQ,EAAE3B,IAAI,CAACE;YAErC,6CAA6C;YAC7C,MAAM7B,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAMe;YAEhD,mCAAmC;YACnC,MAAM,EAAEzB,MAAM6D,YAAY,EAAE,GAAG,MAAMjE,SAClCM,IAAI,CAAC,qBACLG,MAAM,CAAC,KACPK,EAAE,CAAC,MAAMiD,SACTrD,MAAM;YAETc,OAAOyC,cAAcxC,QAAQ;QAC/B;QAEAV,GAAG,+CAA+C;YAChD,MAAMmD,cAAc;YAEpB,8CAA8C;YAC9C,MAAM,EAAEjD,KAAK,EAAE,GAAG,MAAMjB,SACrBM,IAAI,CAAC,qBACLC,MAAM,CAAC;gBACNqD,OAAO,kBAAkBZ,KAAKa,GAAG;gBACjCP,UAAUY;gBACVJ,YAAY,IAAId,KAAKA,KAAKa,GAAG,KAAK,KAAK,KAAK,MAAMZ,WAAW;YAC/D;YAEFzB,OAAOP,OAAOkD,GAAG,CAAC1C,QAAQ;YAC1BD,OAAOP,OAAOmD,SAASC,OAAO,CAAC;QACjC;IACF;IAEAtE,SAAS,0BAA0B;QACjCgB,GAAG,oDAAoD;YACrD,iDAAiD;YACjD,MAAMkB,SAASqC,MAAMhE,IAAI,CAAC;gBAAE+B,QAAQ;YAAG,GAAG,CAACkC,GAAGC,IAAO,CAAA;oBACnDtD,UAAUjB;oBACVkB,YAAY,CAAC,IAAI,EAAEqD,GAAG;oBACtBpD,WAAW;oBACXC,OAAO,CAAC,IAAI,EAAEmD,EAAE,YAAY,CAAC;oBAC7BlD,UAAU;oBACVC,YAAY;gBACd,CAAA;YAEA,MAAM,EAAEnB,MAAM8B,OAAO,EAAE,GAAG,MAAMlC,SAC7BM,IAAI,CAAC,UACLC,MAAM,CAAC0B,QACPxB,MAAM;YAET,qBAAqB;YACrB,MAAMgE,YAAYzB,KAAKa,GAAG;YAE1B,MAAM7D,SACHM,IAAI,CAAC,UACLG,MAAM,CAAC,KACPK,EAAE,CAAC,YAAYb;YAElB,MAAMyE,YAAY1B,KAAKa,GAAG,KAAKY;YAE/B,WAAW;YACX,IAAIvC,SAAS;gBACX,KAAK,MAAMlB,SAASkB,QAAS;oBAC3B,MAAMlC,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAME,MAAML,EAAE;gBAC1D;YACF;YAEA,mEAAmE;YACnEa,OAAOkD,WAAWC,YAAY,CAAC;QACjC;QAEA5D,GAAG,qDAAqD;YACtD,eAAe;YACf,MAAM,EAAEX,MAAMY,KAAK,EAAE,GAAG,MAAMhB,SAC3BM,IAAI,CAAC,UACLC,MAAM,CAAC;gBACNW,UAAUjB;gBACVkB,YAAY;gBACZC,WAAW;gBACXC,OAAO;gBACPC,UAAU;gBACVC,YAAY;gBACZK,aAAa;YACf,GACCnB,MAAM,GACNC,MAAM;YAET,0CAA0C;YAC1C,MAAM+D,YAAYzB,KAAKa,GAAG;YAE1B,MAAM7D,SACHM,IAAI,CAAC,UACLG,MAAM,CAAC,KACPK,EAAE,CAAC,SAAS,0BACZA,EAAE,CAAC,eAAe,kBAClBJ,MAAM;YAET,MAAMgE,YAAY1B,KAAKa,GAAG,KAAKY;YAE/B,WAAW;YACX,MAAMzE,SAASM,IAAI,CAAC,UAAUO,MAAM,GAAGC,EAAE,CAAC,MAAME,MAAOL,EAAE;YAEzD,qDAAqD;YACrDa,OAAOkD,WAAWC,YAAY,CAAC;QACjC;IACF;AACF"}