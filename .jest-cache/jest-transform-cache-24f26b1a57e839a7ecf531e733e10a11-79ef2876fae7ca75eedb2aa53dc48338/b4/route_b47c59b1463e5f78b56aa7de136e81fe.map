{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/locations/[id]/route.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport * as locationService from '@/services/locationService';\nimport { updateLocationSchema } from '@/schemas/locationSchemas';\n\n/**\n * GET /api/admin/locations/:id - Get location\n */\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // 1. Auth check\n  const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n  const {\n    data: { session },\n    error: authError,\n  } = await supabase.auth.getSession();\n\n  if (authError || !session) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n      },\n      { status: 401 }\n    );\n  }\n\n  // 2. Call service\n  const resolvedParams = await params;\n\n  const result = await locationService.get(resolvedParams.id);\n\n  // 3. Return response\n  if (!result.success) {\n    const statusCode = result.error.code === 'NOT_FOUND' ? 404 : 500;\n    return NextResponse.json(result, { status: statusCode });\n  }\n\n  return NextResponse.json(result, { status: 200 });\n}\n\n/**\n * PUT /api/admin/locations/:id - Update location\n */\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // 1. Auth check\n  const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n  const {\n    data: { session },\n    error: authError,\n  } = await supabase.auth.getSession();\n\n  if (authError || !session) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n      },\n      { status: 401 }\n    );\n  }\n\n  // 2. Parse and validate\n  const resolvedParams = await params;\n  const body = await request.json();\n  const validation = updateLocationSchema.safeParse(body);\n\n  if (!validation.success) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid request',\n          details: validation.error.issues,\n        },\n      },\n      { status: 400 }\n    );\n  }\n\n  // 3. Call service\n  const result = await locationService.update(resolvedParams.id, validation.data);\n\n  // 4. Return response with proper status\n  if (!result.success) {\n    const statusCode =\n      result.error.code === 'VALIDATION_ERROR'\n        ? 400\n        : result.error.code === 'NOT_FOUND'\n        ? 404\n        : result.error.code === 'INVALID_PARENT'\n        ? 400\n        : result.error.code === 'CIRCULAR_REFERENCE'\n        ? 409\n        : 500;\n    return NextResponse.json(result, { status: statusCode });\n  }\n\n  return NextResponse.json(result, { status: 200 });\n}\n\n/**\n * DELETE /api/admin/locations/:id - Delete location\n */\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  // 1. Auth check\n  const cookieStore = await cookies();\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() {\n            return cookieStore.getAll();\n          },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => {\n              cookieStore.set(name, value);\n            });\n          },\n        },\n      }\n    );\n  const {\n    data: { session },\n    error: authError,\n  } = await supabase.auth.getSession();\n\n  if (authError || !session) {\n    return NextResponse.json(\n      {\n        success: false,\n        error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n      },\n      { status: 401 }\n    );\n  }\n\n  // 2. Call service\n  const resolvedParams = await params;\n  const result = await locationService.deleteLocation(resolvedParams.id);\n\n  // 3. Return response\n  return NextResponse.json(result, { status: result.success ? 200 : 500 });\n}\n"],"names":["DELETE","GET","PUT","request","params","cookieStore","cookies","supabase","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","getAll","setAll","cookiesToSet","forEach","name","value","set","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","resolvedParams","result","locationService","get","id","statusCode","body","validation","updateLocationSchema","safeParse","details","issues","update","deleteLocation"],"mappings":"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"}