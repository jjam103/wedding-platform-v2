{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/financialCalculations.regression.test.ts"],"sourcesContent":["/**\n * Regression Test Suite: Financial Calculations\n * \n * Tests financial calculation accuracy to prevent regressions in:\n * - Budget total calculations\n * - Payment balance updates\n * - Vendor cost calculations\n * - Accommodation cost calculations\n * - Activity cost calculations\n * - Subsidy calculations\n * \n * Requirements: 21.4\n */\n\nimport * as budgetService from '@/services/budgetService';\nimport * as vendorService from '@/services/vendorService';\nimport * as accommodationService from '@/services/accommodationService';\n\n// Mock Supabase client\nconst mockSupabase = {\n  from: jest.fn().mockReturnThis(),\n  select: jest.fn().mockReturnThis(),\n  insert: jest.fn().mockReturnThis(),\n  update: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  single: jest.fn(),\n};\n\njest.mock('@/lib/supabase', () => ({\n  createClient: jest.fn(() => mockSupabase),\n}));\n\ndescribe('Regression: Financial Calculations', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Budget Total Calculations', () => {\n    it('should calculate total budget correctly', async () => {\n      const mockData = {\n        vendors: [\n          { baseCost: 2500, pricingModel: 'flat_rate' },\n          { baseCost: 50, pricingModel: 'per_guest', guestCount: 100 },\n        ],\n        activities: [\n          { costPerPerson: 25, hostSubsidy: 10, attendees: 80 },\n          { costPerPerson: 40, hostSubsidy: 15, attendees: 60 },\n        ],\n        accommodations: [\n          { pricePerNight: 150, nights: 3, rooms: 20, hostSubsidy: 50 },\n        ],\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // Vendors: 2500 + (50 * 100) = 7500\n        // Activities: (25-10)*80 + (40-15)*60 = 1200 + 1500 = 2700\n        // Accommodations: (150-50)*3*20 = 6000\n        // Total: 7500 + 2700 + 6000 = 16200\n        expect(result.data.total).toBe(16200);\n      }\n    });\n\n    it('should handle zero costs', async () => {\n      const mockData = {\n        vendors: [],\n        activities: [{ costPerPerson: 0, hostSubsidy: 0, attendees: 50 }],\n        accommodations: [],\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.total).toBe(0);\n      }\n    });\n\n    it('should handle subsidies exceeding costs', async () => {\n      const mockData = {\n        vendors: [],\n        activities: [\n          { costPerPerson: 20, hostSubsidy: 30, attendees: 50 },\n        ],\n        accommodations: [],\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // Cost should not go negative\n        expect(result.data.total).toBeGreaterThanOrEqual(0);\n      }\n    });\n\n    it('should calculate per-guest vendor costs correctly', async () => {\n      const mockData = {\n        vendors: [\n          { baseCost: 75, pricingModel: 'per_guest', guestCount: 120 },\n        ],\n        activities: [],\n        accommodations: [],\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // 75 * 120 = 9000\n        expect(result.data.total).toBe(9000);\n      }\n    });\n  });\n\n  describe('Payment Balance Updates', () => {\n    it('should update balance correctly on payment', async () => {\n      const vendor = {\n        id: 'vendor-1',\n        baseCost: 5000,\n        amountPaid: 0,\n        paymentStatus: 'unpaid' as const,\n      };\n\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: vendor,\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: {\n            ...vendor,\n            amountPaid: 2000,\n            paymentStatus: 'partial',\n          },\n          error: null,\n        });\n\n      const result = await vendorService.recordPayment('vendor-1', 2000);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.amountPaid).toBe(2000);\n        expect(result.data.paymentStatus).toBe('partial');\n        const balance = result.data.baseCost - result.data.amountPaid;\n        expect(balance).toBe(3000);\n      }\n    });\n\n    it('should mark as paid when full amount received', async () => {\n      const vendor = {\n        id: 'vendor-1',\n        baseCost: 5000,\n        amountPaid: 4000,\n        paymentStatus: 'partial' as const,\n      };\n\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: vendor,\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: {\n            ...vendor,\n            amountPaid: 5000,\n            paymentStatus: 'paid',\n          },\n          error: null,\n        });\n\n      const result = await vendorService.recordPayment('vendor-1', 1000);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.amountPaid).toBe(5000);\n        expect(result.data.paymentStatus).toBe('paid');\n      }\n    });\n\n    it('should handle overpayment', async () => {\n      const vendor = {\n        id: 'vendor-1',\n        baseCost: 5000,\n        amountPaid: 0,\n        paymentStatus: 'unpaid' as const,\n      };\n\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: vendor,\n          error: null,\n        })\n        .mockResolvedValueOnce({\n          data: {\n            ...vendor,\n            amountPaid: 6000,\n            paymentStatus: 'paid',\n          },\n          error: null,\n        });\n\n      const result = await vendorService.recordPayment('vendor-1', 6000);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.amountPaid).toBe(6000);\n        expect(result.data.paymentStatus).toBe('paid');\n      }\n    });\n\n    it('should reject negative payment amounts', async () => {\n      const result = await vendorService.recordPayment('vendor-1', -100);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n  });\n\n  describe('Accommodation Cost Calculations', () => {\n    it('should calculate room costs with subsidies', async () => {\n      const roomType = {\n        pricePerNight: 200,\n        hostSubsidyPerNight: 75,\n      };\n\n      const assignment = {\n        checkIn: new Date('2025-06-15'),\n        checkOut: new Date('2025-06-18'), // 3 nights\n      };\n\n      mockSupabase.single.mockResolvedValue({\n        data: { ...roomType, ...assignment },\n        error: null,\n      });\n\n      const result = await accommodationService.calculateRoomCost(\n        'room-1',\n        'assignment-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // (200 - 75) * 3 = 375\n        expect(result.data.guestCost).toBe(375);\n        expect(result.data.hostSubsidy).toBe(225);\n        expect(result.data.totalCost).toBe(600);\n      }\n    });\n\n    it('should handle same-day checkout', async () => {\n      const roomType = {\n        pricePerNight: 200,\n        hostSubsidyPerNight: 0,\n      };\n\n      const assignment = {\n        checkIn: new Date('2025-06-15'),\n        checkOut: new Date('2025-06-15'), // 0 nights\n      };\n\n      mockSupabase.single.mockResolvedValue({\n        data: { ...roomType, ...assignment },\n        error: null,\n      });\n\n      const result = await accommodationService.calculateRoomCost(\n        'room-1',\n        'assignment-1'\n      );\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.guestCost).toBe(0);\n      }\n    });\n  });\n\n  describe('Activity Cost Calculations', () => {\n    it('should calculate activity costs with subsidies', async () => {\n      const activity = {\n        costPerPerson: 50,\n        hostSubsidy: 20,\n      };\n\n      const attendees = 75;\n\n      const guestCost = (activity.costPerPerson - activity.hostSubsidy) * attendees;\n      const hostCost = activity.hostSubsidy * attendees;\n      const totalCost = activity.costPerPerson * attendees;\n\n      expect(guestCost).toBe(2250); // (50-20) * 75\n      expect(hostCost).toBe(1500); // 20 * 75\n      expect(totalCost).toBe(3750); // 50 * 75\n    });\n\n    it('should handle free activities', async () => {\n      const activity = {\n        costPerPerson: 0,\n        hostSubsidy: 0,\n      };\n\n      const attendees = 100;\n\n      const totalCost = activity.costPerPerson * attendees;\n\n      expect(totalCost).toBe(0);\n    });\n\n    it('should handle fully subsidized activities', async () => {\n      const activity = {\n        costPerPerson: 40,\n        hostSubsidy: 40,\n      };\n\n      const attendees = 60;\n\n      const guestCost = (activity.costPerPerson - activity.hostSubsidy) * attendees;\n      const hostCost = activity.hostSubsidy * attendees;\n\n      expect(guestCost).toBe(0);\n      expect(hostCost).toBe(2400);\n    });\n  });\n\n  describe('Precision and Rounding', () => {\n    it('should handle decimal amounts correctly', async () => {\n      const mockData = {\n        vendors: [{ baseCost: 1234.56, pricingModel: 'flat_rate' }],\n        activities: [\n          { costPerPerson: 12.99, hostSubsidy: 5.50, attendees: 73 },\n        ],\n        accommodations: [],\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // Should handle decimals without precision loss\n        expect(result.data.total).toBeCloseTo(1781.33, 2);\n      }\n    });\n\n    it('should not accumulate rounding errors', async () => {\n      const mockData = {\n        vendors: [],\n        activities: Array(100).fill({\n          costPerPerson: 0.33,\n          hostSubsidy: 0.11,\n          attendees: 1,\n        }),\n        accommodations: [],\n      };\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const result = await budgetService.calculateTotal();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        // (0.33 - 0.11) * 1 * 100 = 22.00\n        expect(result.data.total).toBeCloseTo(22.0, 2);\n      }\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","mockSupabase","from","mockReturnThis","select","insert","update","eq","single","describe","beforeEach","clearAllMocks","it","mockData","vendors","baseCost","pricingModel","guestCount","activities","costPerPerson","hostSubsidy","attendees","accommodations","pricePerNight","nights","rooms","mockResolvedValue","data","error","result","budgetService","calculateTotal","expect","success","toBe","total","toBeGreaterThanOrEqual","vendor","id","amountPaid","paymentStatus","mockResolvedValueOnce","vendorService","recordPayment","balance","code","roomType","hostSubsidyPerNight","assignment","checkIn","Date","checkOut","accommodationService","calculateRoomCost","guestCost","totalCost","activity","hostCost","toBeCloseTo","Array","fill"],"mappings":"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"}