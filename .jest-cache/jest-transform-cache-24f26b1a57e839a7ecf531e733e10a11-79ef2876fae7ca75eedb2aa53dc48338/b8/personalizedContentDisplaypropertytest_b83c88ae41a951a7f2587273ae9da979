792e97becec118a0503363c2d43a765e
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _fastcheck = /*#__PURE__*/ _interop_require_wildcard(require("fast-check"));
const _arbitraries = require("../helpers/arbitraries");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
/**
 * Property 18: Personalized Content Display
 * 
 * Feature: destination-wedding-platform
 * 
 * Validates: Requirements 6.1
 * 
 * Property: Guest dashboard displays personalized content based on guest data
 * - Welcome message includes guest's first name
 * - RSVP summary reflects guest's actual RSVPs
 * - Upcoming events are filtered to guest's invitations
 * - Quick links are relevant to guest's needs
 */ describe('Feature: destination-wedding-platform, Property 18: Personalized Content Display', ()=>{
    it('should display personalized welcome message with guest name', ()=>{
        _fastcheck.assert(_fastcheck.property(_arbitraries.guestArbitrary, (guest)=>{
            // Simulate dashboard rendering
            const welcomeMessage = `Â¡Pura Vida, ${guest.first_name}!`;
            // Property: Welcome message must include guest's first name
            expect(welcomeMessage).toContain(guest.first_name);
            expect(welcomeMessage.length).toBeGreaterThan(guest.first_name.length);
        }), {
            numRuns: 100
        });
    });
    it('should filter upcoming events to only show guest invitations', ()=>{
        _fastcheck.assert(_fastcheck.property(_arbitraries.guestArbitrary, _fastcheck.array(_fastcheck.record({
            id: _fastcheck.uuid(),
            name: _fastcheck.string({
                minLength: 5,
                maxLength: 50
            }),
            date: _fastcheck.date({
                min: new Date(),
                max: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000)
            }),
            invitedGuestIds: _fastcheck.array(_fastcheck.uuid(), {
                minLength: 1,
                maxLength: 20
            })
        }), {
            minLength: 0,
            maxLength: 20
        }), (guest, allEvents)=>{
            // Simulate filtering events for guest
            const guestEvents = allEvents.filter((event)=>event.invitedGuestIds.includes(guest.id));
            // Property: Filtered events must only include events where guest is invited
            guestEvents.forEach((event)=>{
                expect(event.invitedGuestIds).toContain(guest.id);
            });
            // Property: No events should be shown that don't include guest
            const nonGuestEvents = allEvents.filter((event)=>!event.invitedGuestIds.includes(guest.id));
            nonGuestEvents.forEach((event)=>{
                expect(guestEvents).not.toContainEqual(event);
            });
        }), {
            numRuns: 100
        });
    });
    it('should calculate RSVP summary based on guest RSVPs only', ()=>{
        _fastcheck.assert(_fastcheck.property(_arbitraries.guestArbitrary, _fastcheck.array(_fastcheck.record({
            id: _fastcheck.uuid(),
            guestId: _fastcheck.uuid(),
            status: _fastcheck.constantFrom('attending', 'declined', 'maybe', 'pending')
        }), {
            minLength: 0,
            maxLength: 50
        }), (guest, allRsvps)=>{
            // Filter RSVPs for this guest
            const guestRsvps = allRsvps.filter((rsvp)=>rsvp.guestId === guest.id);
            // Calculate summary
            const summary = {
                total: guestRsvps.length,
                attending: guestRsvps.filter((r)=>r.status === 'attending').length,
                declined: guestRsvps.filter((r)=>r.status === 'declined').length,
                maybe: guestRsvps.filter((r)=>r.status === 'maybe').length,
                pending: guestRsvps.filter((r)=>r.status === 'pending').length
            };
            // Property: Total must equal sum of all statuses
            expect(summary.total).toBe(summary.attending + summary.declined + summary.maybe + summary.pending);
            // Property: Each count must be non-negative
            expect(summary.attending).toBeGreaterThanOrEqual(0);
            expect(summary.declined).toBeGreaterThanOrEqual(0);
            expect(summary.maybe).toBeGreaterThanOrEqual(0);
            expect(summary.pending).toBeGreaterThanOrEqual(0);
            // Property: Each count must not exceed total
            expect(summary.attending).toBeLessThanOrEqual(summary.total);
            expect(summary.declined).toBeLessThanOrEqual(summary.total);
            expect(summary.maybe).toBeLessThanOrEqual(summary.total);
            expect(summary.pending).toBeLessThanOrEqual(summary.total);
        }), {
            numRuns: 100
        });
    });
    it('should display announcements sorted by urgency and date', ()=>{
        _fastcheck.assert(_fastcheck.property(_fastcheck.array(_fastcheck.record({
            id: _fastcheck.uuid(),
            title: _fastcheck.string({
                minLength: 5,
                maxLength: 50
            }),
            message: _fastcheck.string({
                minLength: 10,
                maxLength: 200
            }),
            urgent: _fastcheck.boolean(),
            created_at: _fastcheck.date({
                min: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),
                max: new Date()
            }),
            active: _fastcheck.boolean()
        }), {
            minLength: 0,
            maxLength: 20
        }), (announcements)=>{
            // Filter active announcements
            const activeAnnouncements = announcements.filter((a)=>a.active);
            // Sort by urgency (urgent first) then by date (newest first)
            const sorted = [
                ...activeAnnouncements
            ].sort((a, b)=>{
                if (a.urgent && !b.urgent) return -1;
                if (!a.urgent && b.urgent) return 1;
                return b.created_at.getTime() - a.created_at.getTime();
            });
            // Property: Urgent announcements must come before non-urgent
            let lastUrgent = true;
            sorted.forEach((announcement)=>{
                if (!announcement.urgent) {
                    lastUrgent = false;
                }
                if (announcement.urgent && !lastUrgent) {
                    throw new Error('Urgent announcement found after non-urgent');
                }
            });
            // Property: Within same urgency level, newer must come before older
            for(let i = 0; i < sorted.length - 1; i++){
                if (sorted[i].urgent === sorted[i + 1].urgent) {
                    expect(sorted[i].created_at.getTime()).toBeGreaterThanOrEqual(sorted[i + 1].created_at.getTime());
                }
            }
        }), {
            numRuns: 100
        });
    });
    it('should only display active announcements to guests', ()=>{
        _fastcheck.assert(_fastcheck.property(_fastcheck.array(_fastcheck.record({
            id: _fastcheck.uuid(),
            title: _fastcheck.string({
                minLength: 5,
                maxLength: 50
            }),
            active: _fastcheck.boolean()
        }), {
            minLength: 0,
            maxLength: 20
        }), (allAnnouncements)=>{
            // Filter to active only
            const displayedAnnouncements = allAnnouncements.filter((a)=>a.active);
            // Property: All displayed announcements must be active
            displayedAnnouncements.forEach((announcement)=>{
                expect(announcement.active).toBe(true);
            });
            // Property: No inactive announcements should be displayed
            const inactiveAnnouncements = allAnnouncements.filter((a)=>!a.active);
            inactiveAnnouncements.forEach((announcement)=>{
                expect(displayedAnnouncements).not.toContainEqual(announcement);
            });
        }), {
            numRuns: 100
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvX190ZXN0c19fL3Byb3BlcnR5L3BlcnNvbmFsaXplZENvbnRlbnREaXNwbGF5LnByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZmMgZnJvbSAnZmFzdC1jaGVjayc7XG5pbXBvcnQgeyBndWVzdEFyYml0cmFyeSB9IGZyb20gJy4uL2hlbHBlcnMvYXJiaXRyYXJpZXMnO1xuXG4vKipcbiAqIFByb3BlcnR5IDE4OiBQZXJzb25hbGl6ZWQgQ29udGVudCBEaXNwbGF5XG4gKiBcbiAqIEZlYXR1cmU6IGRlc3RpbmF0aW9uLXdlZGRpbmctcGxhdGZvcm1cbiAqIFxuICogVmFsaWRhdGVzOiBSZXF1aXJlbWVudHMgNi4xXG4gKiBcbiAqIFByb3BlcnR5OiBHdWVzdCBkYXNoYm9hcmQgZGlzcGxheXMgcGVyc29uYWxpemVkIGNvbnRlbnQgYmFzZWQgb24gZ3Vlc3QgZGF0YVxuICogLSBXZWxjb21lIG1lc3NhZ2UgaW5jbHVkZXMgZ3Vlc3QncyBmaXJzdCBuYW1lXG4gKiAtIFJTVlAgc3VtbWFyeSByZWZsZWN0cyBndWVzdCdzIGFjdHVhbCBSU1ZQc1xuICogLSBVcGNvbWluZyBldmVudHMgYXJlIGZpbHRlcmVkIHRvIGd1ZXN0J3MgaW52aXRhdGlvbnNcbiAqIC0gUXVpY2sgbGlua3MgYXJlIHJlbGV2YW50IHRvIGd1ZXN0J3MgbmVlZHNcbiAqL1xuZGVzY3JpYmUoJ0ZlYXR1cmU6IGRlc3RpbmF0aW9uLXdlZGRpbmctcGxhdGZvcm0sIFByb3BlcnR5IDE4OiBQZXJzb25hbGl6ZWQgQ29udGVudCBEaXNwbGF5JywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIGRpc3BsYXkgcGVyc29uYWxpemVkIHdlbGNvbWUgbWVzc2FnZSB3aXRoIGd1ZXN0IG5hbWUnLCAoKSA9PiB7XG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoZ3Vlc3RBcmJpdHJhcnksIChndWVzdCkgPT4ge1xuICAgICAgICAvLyBTaW11bGF0ZSBkYXNoYm9hcmQgcmVuZGVyaW5nXG4gICAgICAgIGNvbnN0IHdlbGNvbWVNZXNzYWdlID0gYMKhUHVyYSBWaWRhLCAke2d1ZXN0LmZpcnN0X25hbWV9IWA7XG4gICAgICAgIFxuICAgICAgICAvLyBQcm9wZXJ0eTogV2VsY29tZSBtZXNzYWdlIG11c3QgaW5jbHVkZSBndWVzdCdzIGZpcnN0IG5hbWVcbiAgICAgICAgZXhwZWN0KHdlbGNvbWVNZXNzYWdlKS50b0NvbnRhaW4oZ3Vlc3QuZmlyc3RfbmFtZSk7XG4gICAgICAgIGV4cGVjdCh3ZWxjb21lTWVzc2FnZS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbihndWVzdC5maXJzdF9uYW1lLmxlbmd0aCk7XG4gICAgICB9KSxcbiAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbHRlciB1cGNvbWluZyBldmVudHMgdG8gb25seSBzaG93IGd1ZXN0IGludml0YXRpb25zJywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICBndWVzdEFyYml0cmFyeSxcbiAgICAgICAgZmMuYXJyYXkoXG4gICAgICAgICAgZmMucmVjb3JkKHtcbiAgICAgICAgICAgIGlkOiBmYy51dWlkKCksXG4gICAgICAgICAgICBuYW1lOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDUsIG1heExlbmd0aDogNTAgfSksXG4gICAgICAgICAgICBkYXRlOiBmYy5kYXRlKHsgbWluOiBuZXcgRGF0ZSgpLCBtYXg6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSB9KSxcbiAgICAgICAgICAgIGludml0ZWRHdWVzdElkczogZmMuYXJyYXkoZmMudXVpZCgpLCB7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiAyMCB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICB7IG1pbkxlbmd0aDogMCwgbWF4TGVuZ3RoOiAyMCB9XG4gICAgICAgICksXG4gICAgICAgIChndWVzdCwgYWxsRXZlbnRzKSA9PiB7XG4gICAgICAgICAgLy8gU2ltdWxhdGUgZmlsdGVyaW5nIGV2ZW50cyBmb3IgZ3Vlc3RcbiAgICAgICAgICBjb25zdCBndWVzdEV2ZW50cyA9IGFsbEV2ZW50cy5maWx0ZXIoKGV2ZW50KSA9PlxuICAgICAgICAgICAgZXZlbnQuaW52aXRlZEd1ZXN0SWRzLmluY2x1ZGVzKGd1ZXN0LmlkKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBQcm9wZXJ0eTogRmlsdGVyZWQgZXZlbnRzIG11c3Qgb25seSBpbmNsdWRlIGV2ZW50cyB3aGVyZSBndWVzdCBpcyBpbnZpdGVkXG4gICAgICAgICAgZ3Vlc3RFdmVudHMuZm9yRWFjaCgoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChldmVudC5pbnZpdGVkR3Vlc3RJZHMpLnRvQ29udGFpbihndWVzdC5pZCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBQcm9wZXJ0eTogTm8gZXZlbnRzIHNob3VsZCBiZSBzaG93biB0aGF0IGRvbid0IGluY2x1ZGUgZ3Vlc3RcbiAgICAgICAgICBjb25zdCBub25HdWVzdEV2ZW50cyA9IGFsbEV2ZW50cy5maWx0ZXIoXG4gICAgICAgICAgICAoZXZlbnQpID0+ICFldmVudC5pbnZpdGVkR3Vlc3RJZHMuaW5jbHVkZXMoZ3Vlc3QuaWQpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBub25HdWVzdEV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGd1ZXN0RXZlbnRzKS5ub3QudG9Db250YWluRXF1YWwoZXZlbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICApLFxuICAgICAgeyBudW1SdW5zOiAxMDAgfVxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY2FsY3VsYXRlIFJTVlAgc3VtbWFyeSBiYXNlZCBvbiBndWVzdCBSU1ZQcyBvbmx5JywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICBndWVzdEFyYml0cmFyeSxcbiAgICAgICAgZmMuYXJyYXkoXG4gICAgICAgICAgZmMucmVjb3JkKHtcbiAgICAgICAgICAgIGlkOiBmYy51dWlkKCksXG4gICAgICAgICAgICBndWVzdElkOiBmYy51dWlkKCksXG4gICAgICAgICAgICBzdGF0dXM6IGZjLmNvbnN0YW50RnJvbSgnYXR0ZW5kaW5nJywgJ2RlY2xpbmVkJywgJ21heWJlJywgJ3BlbmRpbmcnKSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICB7IG1pbkxlbmd0aDogMCwgbWF4TGVuZ3RoOiA1MCB9XG4gICAgICAgICksXG4gICAgICAgIChndWVzdCwgYWxsUnN2cHMpID0+IHtcbiAgICAgICAgICAvLyBGaWx0ZXIgUlNWUHMgZm9yIHRoaXMgZ3Vlc3RcbiAgICAgICAgICBjb25zdCBndWVzdFJzdnBzID0gYWxsUnN2cHMuZmlsdGVyKChyc3ZwKSA9PiByc3ZwLmd1ZXN0SWQgPT09IGd1ZXN0LmlkKTtcblxuICAgICAgICAgIC8vIENhbGN1bGF0ZSBzdW1tYXJ5XG4gICAgICAgICAgY29uc3Qgc3VtbWFyeSA9IHtcbiAgICAgICAgICAgIHRvdGFsOiBndWVzdFJzdnBzLmxlbmd0aCxcbiAgICAgICAgICAgIGF0dGVuZGluZzogZ3Vlc3RSc3Zwcy5maWx0ZXIoKHIpID0+IHIuc3RhdHVzID09PSAnYXR0ZW5kaW5nJykubGVuZ3RoLFxuICAgICAgICAgICAgZGVjbGluZWQ6IGd1ZXN0UnN2cHMuZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ2RlY2xpbmVkJykubGVuZ3RoLFxuICAgICAgICAgICAgbWF5YmU6IGd1ZXN0UnN2cHMuZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ21heWJlJykubGVuZ3RoLFxuICAgICAgICAgICAgcGVuZGluZzogZ3Vlc3RSc3Zwcy5maWx0ZXIoKHIpID0+IHIuc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgLy8gUHJvcGVydHk6IFRvdGFsIG11c3QgZXF1YWwgc3VtIG9mIGFsbCBzdGF0dXNlc1xuICAgICAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsKS50b0JlKFxuICAgICAgICAgICAgc3VtbWFyeS5hdHRlbmRpbmcgKyBzdW1tYXJ5LmRlY2xpbmVkICsgc3VtbWFyeS5tYXliZSArIHN1bW1hcnkucGVuZGluZ1xuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBQcm9wZXJ0eTogRWFjaCBjb3VudCBtdXN0IGJlIG5vbi1uZWdhdGl2ZVxuICAgICAgICAgIGV4cGVjdChzdW1tYXJ5LmF0dGVuZGluZykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgICBleHBlY3Qoc3VtbWFyeS5kZWNsaW5lZCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgICBleHBlY3Qoc3VtbWFyeS5tYXliZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgICBleHBlY3Qoc3VtbWFyeS5wZW5kaW5nKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuXG4gICAgICAgICAgLy8gUHJvcGVydHk6IEVhY2ggY291bnQgbXVzdCBub3QgZXhjZWVkIHRvdGFsXG4gICAgICAgICAgZXhwZWN0KHN1bW1hcnkuYXR0ZW5kaW5nKS50b0JlTGVzc1RoYW5PckVxdWFsKHN1bW1hcnkudG90YWwpO1xuICAgICAgICAgIGV4cGVjdChzdW1tYXJ5LmRlY2xpbmVkKS50b0JlTGVzc1RoYW5PckVxdWFsKHN1bW1hcnkudG90YWwpO1xuICAgICAgICAgIGV4cGVjdChzdW1tYXJ5Lm1heWJlKS50b0JlTGVzc1RoYW5PckVxdWFsKHN1bW1hcnkudG90YWwpO1xuICAgICAgICAgIGV4cGVjdChzdW1tYXJ5LnBlbmRpbmcpLnRvQmVMZXNzVGhhbk9yRXF1YWwoc3VtbWFyeS50b3RhbCk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDEwMCB9XG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBkaXNwbGF5IGFubm91bmNlbWVudHMgc29ydGVkIGJ5IHVyZ2VuY3kgYW5kIGRhdGUnLCAoKSA9PiB7XG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgIGZjLmFycmF5KFxuICAgICAgICAgIGZjLnJlY29yZCh7XG4gICAgICAgICAgICBpZDogZmMudXVpZCgpLFxuICAgICAgICAgICAgdGl0bGU6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogNSwgbWF4TGVuZ3RoOiA1MCB9KSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMTAsIG1heExlbmd0aDogMjAwIH0pLFxuICAgICAgICAgICAgdXJnZW50OiBmYy5ib29sZWFuKCksXG4gICAgICAgICAgICBjcmVhdGVkX2F0OiBmYy5kYXRlKHsgbWluOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSwgbWF4OiBuZXcgRGF0ZSgpIH0pLFxuICAgICAgICAgICAgYWN0aXZlOiBmYy5ib29sZWFuKCksXG4gICAgICAgICAgfSksXG4gICAgICAgICAgeyBtaW5MZW5ndGg6IDAsIG1heExlbmd0aDogMjAgfVxuICAgICAgICApLFxuICAgICAgICAoYW5ub3VuY2VtZW50cykgPT4ge1xuICAgICAgICAgIC8vIEZpbHRlciBhY3RpdmUgYW5ub3VuY2VtZW50c1xuICAgICAgICAgIGNvbnN0IGFjdGl2ZUFubm91bmNlbWVudHMgPSBhbm5vdW5jZW1lbnRzLmZpbHRlcigoYSkgPT4gYS5hY3RpdmUpO1xuXG4gICAgICAgICAgLy8gU29ydCBieSB1cmdlbmN5ICh1cmdlbnQgZmlyc3QpIHRoZW4gYnkgZGF0ZSAobmV3ZXN0IGZpcnN0KVxuICAgICAgICAgIGNvbnN0IHNvcnRlZCA9IFsuLi5hY3RpdmVBbm5vdW5jZW1lbnRzXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYS51cmdlbnQgJiYgIWIudXJnZW50KSByZXR1cm4gLTE7XG4gICAgICAgICAgICBpZiAoIWEudXJnZW50ICYmIGIudXJnZW50KSByZXR1cm4gMTtcbiAgICAgICAgICAgIHJldHVybiBiLmNyZWF0ZWRfYXQuZ2V0VGltZSgpIC0gYS5jcmVhdGVkX2F0LmdldFRpbWUoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFByb3BlcnR5OiBVcmdlbnQgYW5ub3VuY2VtZW50cyBtdXN0IGNvbWUgYmVmb3JlIG5vbi11cmdlbnRcbiAgICAgICAgICBsZXQgbGFzdFVyZ2VudCA9IHRydWU7XG4gICAgICAgICAgc29ydGVkLmZvckVhY2goKGFubm91bmNlbWVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFhbm5vdW5jZW1lbnQudXJnZW50KSB7XG4gICAgICAgICAgICAgIGxhc3RVcmdlbnQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhbm5vdW5jZW1lbnQudXJnZW50ICYmICFsYXN0VXJnZW50KSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVXJnZW50IGFubm91bmNlbWVudCBmb3VuZCBhZnRlciBub24tdXJnZW50Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBQcm9wZXJ0eTogV2l0aGluIHNhbWUgdXJnZW5jeSBsZXZlbCwgbmV3ZXIgbXVzdCBjb21lIGJlZm9yZSBvbGRlclxuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc29ydGVkLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgaWYgKHNvcnRlZFtpXS51cmdlbnQgPT09IHNvcnRlZFtpICsgMV0udXJnZW50KSB7XG4gICAgICAgICAgICAgIGV4cGVjdChzb3J0ZWRbaV0uY3JlYXRlZF9hdC5nZXRUaW1lKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoXG4gICAgICAgICAgICAgICAgc29ydGVkW2kgKyAxXS5jcmVhdGVkX2F0LmdldFRpbWUoKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG9ubHkgZGlzcGxheSBhY3RpdmUgYW5ub3VuY2VtZW50cyB0byBndWVzdHMnLCAoKSA9PiB7XG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgIGZjLmFycmF5KFxuICAgICAgICAgIGZjLnJlY29yZCh7XG4gICAgICAgICAgICBpZDogZmMudXVpZCgpLFxuICAgICAgICAgICAgdGl0bGU6IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogNSwgbWF4TGVuZ3RoOiA1MCB9KSxcbiAgICAgICAgICAgIGFjdGl2ZTogZmMuYm9vbGVhbigpLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHsgbWluTGVuZ3RoOiAwLCBtYXhMZW5ndGg6IDIwIH1cbiAgICAgICAgKSxcbiAgICAgICAgKGFsbEFubm91bmNlbWVudHMpID0+IHtcbiAgICAgICAgICAvLyBGaWx0ZXIgdG8gYWN0aXZlIG9ubHlcbiAgICAgICAgICBjb25zdCBkaXNwbGF5ZWRBbm5vdW5jZW1lbnRzID0gYWxsQW5ub3VuY2VtZW50cy5maWx0ZXIoKGEpID0+IGEuYWN0aXZlKTtcblxuICAgICAgICAgIC8vIFByb3BlcnR5OiBBbGwgZGlzcGxheWVkIGFubm91bmNlbWVudHMgbXVzdCBiZSBhY3RpdmVcbiAgICAgICAgICBkaXNwbGF5ZWRBbm5vdW5jZW1lbnRzLmZvckVhY2goKGFubm91bmNlbWVudCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGFubm91bmNlbWVudC5hY3RpdmUpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBQcm9wZXJ0eTogTm8gaW5hY3RpdmUgYW5ub3VuY2VtZW50cyBzaG91bGQgYmUgZGlzcGxheWVkXG4gICAgICAgICAgY29uc3QgaW5hY3RpdmVBbm5vdW5jZW1lbnRzID0gYWxsQW5ub3VuY2VtZW50cy5maWx0ZXIoKGEpID0+ICFhLmFjdGl2ZSk7XG4gICAgICAgICAgaW5hY3RpdmVBbm5vdW5jZW1lbnRzLmZvckVhY2goKGFubm91bmNlbWVudCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGRpc3BsYXllZEFubm91bmNlbWVudHMpLm5vdC50b0NvbnRhaW5FcXVhbChhbm5vdW5jZW1lbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICApLFxuICAgICAgeyBudW1SdW5zOiAxMDAgfVxuICAgICk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJpdCIsImZjIiwiYXNzZXJ0IiwicHJvcGVydHkiLCJndWVzdEFyYml0cmFyeSIsImd1ZXN0Iiwid2VsY29tZU1lc3NhZ2UiLCJmaXJzdF9uYW1lIiwiZXhwZWN0IiwidG9Db250YWluIiwibGVuZ3RoIiwidG9CZUdyZWF0ZXJUaGFuIiwibnVtUnVucyIsImFycmF5IiwicmVjb3JkIiwiaWQiLCJ1dWlkIiwibmFtZSIsInN0cmluZyIsIm1pbkxlbmd0aCIsIm1heExlbmd0aCIsImRhdGUiLCJtaW4iLCJEYXRlIiwibWF4Iiwibm93IiwiaW52aXRlZEd1ZXN0SWRzIiwiYWxsRXZlbnRzIiwiZ3Vlc3RFdmVudHMiLCJmaWx0ZXIiLCJldmVudCIsImluY2x1ZGVzIiwiZm9yRWFjaCIsIm5vbkd1ZXN0RXZlbnRzIiwibm90IiwidG9Db250YWluRXF1YWwiLCJndWVzdElkIiwic3RhdHVzIiwiY29uc3RhbnRGcm9tIiwiYWxsUnN2cHMiLCJndWVzdFJzdnBzIiwicnN2cCIsInN1bW1hcnkiLCJ0b3RhbCIsImF0dGVuZGluZyIsInIiLCJkZWNsaW5lZCIsIm1heWJlIiwicGVuZGluZyIsInRvQmUiLCJ0b0JlR3JlYXRlclRoYW5PckVxdWFsIiwidG9CZUxlc3NUaGFuT3JFcXVhbCIsInRpdGxlIiwibWVzc2FnZSIsInVyZ2VudCIsImJvb2xlYW4iLCJjcmVhdGVkX2F0IiwiYWN0aXZlIiwiYW5ub3VuY2VtZW50cyIsImFjdGl2ZUFubm91bmNlbWVudHMiLCJhIiwic29ydGVkIiwic29ydCIsImIiLCJnZXRUaW1lIiwibGFzdFVyZ2VudCIsImFubm91bmNlbWVudCIsIkVycm9yIiwiaSIsImFsbEFubm91bmNlbWVudHMiLCJkaXNwbGF5ZWRBbm5vdW5jZW1lbnRzIiwiaW5hY3RpdmVBbm5vdW5jZW1lbnRzIl0sIm1hcHBpbmdzIjoiOzs7O21FQUFvQjs2QkFDVzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRS9COzs7Ozs7Ozs7Ozs7Q0FZQyxHQUNEQSxTQUFTLG9GQUFvRjtJQUMzRkMsR0FBRywrREFBK0Q7UUFDaEVDLFdBQUdDLE1BQU0sQ0FDUEQsV0FBR0UsUUFBUSxDQUFDQywyQkFBYyxFQUFFLENBQUNDO1lBQzNCLCtCQUErQjtZQUMvQixNQUFNQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUVELE1BQU1FLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFFekQsNERBQTREO1lBQzVEQyxPQUFPRixnQkFBZ0JHLFNBQVMsQ0FBQ0osTUFBTUUsVUFBVTtZQUNqREMsT0FBT0YsZUFBZUksTUFBTSxFQUFFQyxlQUFlLENBQUNOLE1BQU1FLFVBQVUsQ0FBQ0csTUFBTTtRQUN2RSxJQUNBO1lBQUVFLFNBQVM7UUFBSTtJQUVuQjtJQUVBWixHQUFHLGdFQUFnRTtRQUNqRUMsV0FBR0MsTUFBTSxDQUNQRCxXQUFHRSxRQUFRLENBQ1RDLDJCQUFjLEVBQ2RILFdBQUdZLEtBQUssQ0FDTlosV0FBR2EsTUFBTSxDQUFDO1lBQ1JDLElBQUlkLFdBQUdlLElBQUk7WUFDWEMsTUFBTWhCLFdBQUdpQixNQUFNLENBQUM7Z0JBQUVDLFdBQVc7Z0JBQUdDLFdBQVc7WUFBRztZQUM5Q0MsTUFBTXBCLFdBQUdvQixJQUFJLENBQUM7Z0JBQUVDLEtBQUssSUFBSUM7Z0JBQVFDLEtBQUssSUFBSUQsS0FBS0EsS0FBS0UsR0FBRyxLQUFLLE1B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