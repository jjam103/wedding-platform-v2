{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/authService.test.ts"],"sourcesContent":["import * as authService from './authService';\nimport { createClient } from '@supabase/supabase-js';\nimport { ERROR_CODES } from '@/types';\n\n// Mock Supabase\njest.mock('@supabase/supabase-js');\n\ndescribe('authService', () => {\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    // Reset mocks\n    jest.clearAllMocks();\n\n    // Setup mock Supabase client\n    mockSupabase = {\n      auth: {\n        signInWithPassword: jest.fn(),\n        signInWithOtp: jest.fn(),\n        getSession: jest.fn(),\n        refreshSession: jest.fn(),\n        signOut: jest.fn(),\n      },\n      from: jest.fn().mockReturnThis(),\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn(),\n    };\n\n    (createClient as jest.Mock).mockReturnValue(mockSupabase);\n\n    // Set environment variables\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';\n  });\n\n  describe('loginWithPassword', () => {\n    it('should return success with session when valid credentials provided', async () => {\n      const mockSession = {\n        access_token: 'mock-access-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: 1234567890,\n      };\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: mockSession, user: mockUser },\n        error: null,\n      } as any);\n\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'host' },\n        error: null,\n      } as any);\n\n      const result = await authService.loginWithPassword({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.user.id).toBe('user-123');\n        expect(result.data.user.email).toBe('test@example.com');\n        expect(result.data.user.role).toBe('host');\n        expect(result.data.accessToken).toBe('mock-access-token');\n        expect(result.data.refreshToken).toBe('mock-refresh-token');\n      }\n    });\n\n    it('should return INVALID_CREDENTIALS when credentials are wrong', async () => {\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: null, user: null },\n        error: { message: 'Invalid login credentials' },\n      } as any);\n\n      const result = await authService.loginWithPassword({\n        email: 'test@example.com',\n        password: 'wrongpassword',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.INVALID_CREDENTIALS);\n        expect(result.error.message).toBe('Invalid email or password');\n      }\n    });\n\n    it('should default to guest role when user record does not exist', async () => {\n      const mockSession = {\n        access_token: 'mock-access-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: 1234567890,\n      };\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: mockSession, user: mockUser },\n        error: null,\n      } as any);\n\n      mockSupabase.single.mockResolvedValue({\n        data: null,\n        error: { message: 'User not found' },\n      } as any);\n\n      const result = await authService.loginWithPassword({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.user.role).toBe('guest');\n      }\n    });\n\n    it('should return UNAUTHORIZED when session creation fails', async () => {\n      mockSupabase.auth.signInWithPassword.mockResolvedValue({\n        data: { session: null, user: null },\n        error: null,\n      } as any);\n\n      const result = await authService.loginWithPassword({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.UNAUTHORIZED);\n      }\n    });\n  });\n\n  describe('sendMagicLink', () => {\n    it('should return success when magic link is sent', async () => {\n      mockSupabase.auth.signInWithOtp.mockResolvedValue({\n        data: {},\n        error: null,\n      } as any);\n\n      const result = await authService.sendMagicLink({\n        email: 'test@example.com',\n        redirectTo: 'https://example.com/dashboard',\n      });\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.message).toContain('Magic link sent successfully');\n      }\n\n      expect(mockSupabase.auth.signInWithOtp).toHaveBeenCalledWith({\n        email: 'test@example.com',\n        options: {\n          emailRedirectTo: 'https://example.com/dashboard',\n        },\n      });\n    });\n\n    it('should return EXTERNAL_SERVICE_ERROR when magic link fails', async () => {\n      mockSupabase.auth.signInWithOtp.mockResolvedValue({\n        data: null,\n        error: { message: 'Email service unavailable' },\n      } as any);\n\n      const result = await authService.sendMagicLink({\n        email: 'test@example.com',\n      });\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.EXTERNAL_SERVICE_ERROR);\n        expect(result.error.message).toBe('Failed to send magic link');\n      }\n    });\n  });\n\n  describe('getSession', () => {\n    it('should return success with session when valid session exists', async () => {\n      const mockSession = {\n        access_token: 'mock-access-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: 1234567890,\n        user: {\n          id: 'user-123',\n          email: 'test@example.com',\n        },\n      };\n\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: mockSession },\n        error: null,\n      } as any);\n\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'super_admin' },\n        error: null,\n      } as any);\n\n      const result = await authService.getSession();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.user.id).toBe('user-123');\n        expect(result.data.user.role).toBe('super_admin');\n      }\n    });\n\n    it('should return SESSION_EXPIRED when session is invalid', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: { message: 'Session expired' },\n      } as any);\n\n      const result = await authService.getSession();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.SESSION_EXPIRED);\n      }\n    });\n\n    it('should return UNAUTHORIZED when no active session', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      } as any);\n\n      const result = await authService.getSession();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.UNAUTHORIZED);\n        expect(result.error.message).toBe('No active session');\n      }\n    });\n  });\n\n  describe('refreshSession', () => {\n    it('should return success with new session when refresh succeeds', async () => {\n      const mockSession = {\n        access_token: 'new-access-token',\n        refresh_token: 'new-refresh-token',\n        expires_at: 9999999999,\n      };\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      mockSupabase.auth.refreshSession.mockResolvedValue({\n        data: { session: mockSession, user: mockUser },\n        error: null,\n      } as any);\n\n      mockSupabase.single.mockResolvedValue({\n        data: { role: 'host' },\n        error: null,\n      } as any);\n\n      const result = await authService.refreshSession('old-refresh-token');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.accessToken).toBe('new-access-token');\n        expect(result.data.refreshToken).toBe('new-refresh-token');\n      }\n    });\n\n    it('should return SESSION_EXPIRED when refresh fails', async () => {\n      mockSupabase.auth.refreshSession.mockResolvedValue({\n        data: { session: null, user: null },\n        error: { message: 'Invalid refresh token' },\n      } as any);\n\n      const result = await authService.refreshSession('invalid-token');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.SESSION_EXPIRED);\n      }\n    });\n  });\n\n  describe('logout', () => {\n    it('should return success when logout succeeds', async () => {\n      mockSupabase.auth.signOut.mockResolvedValue({\n        error: null,\n      } as any);\n\n      const result = await authService.logout();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.message).toBe('Logged out successfully');\n      }\n    });\n\n    it('should return UNKNOWN_ERROR when logout fails', async () => {\n      mockSupabase.auth.signOut.mockResolvedValue({\n        error: { message: 'Logout failed' },\n      } as any);\n\n      const result = await authService.logout();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.UNKNOWN_ERROR);\n      }\n    });\n  });\n\n  describe('isSessionExpired', () => {\n    it('should return true when session is expired', () => {\n      const pastTimestamp = Math.floor(Date.now() / 1000) - 3600; // 1 hour ago\n      expect(authService.isSessionExpired(pastTimestamp)).toBe(true);\n    });\n\n    it('should return false when session is not expired', () => {\n      const futureTimestamp = Math.floor(Date.now() / 1000) + 3600; // 1 hour from now\n      expect(authService.isSessionExpired(futureTimestamp)).toBe(false);\n    });\n  });\n\n  describe('getCurrentUser', () => {\n    it('should return user data when session is valid', async () => {\n      const mockSession = {\n        access_token: 'mock-access-token',\n        refresh_token: 'mock-refresh-token',\n        expires_at: 9999999999,\n        user: {\n          id: 'user-123',\n          email: 'test@example.com',\n        },\n      };\n\n      const mockUserData = {\n        id: 'user-123',\n        email: 'test@example.com',\n        role: 'host',\n        created_at: '2025-01-01T00:00:00Z',\n        last_login: '2025-01-25T00:00:00Z',\n      };\n\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: mockSession },\n        error: null,\n      } as any);\n\n      // First call for getSession role lookup\n      mockSupabase.single\n        .mockResolvedValueOnce({\n          data: { role: 'host' },\n          error: null,\n        })\n        // Second call for getCurrentUser full user data\n        .mockResolvedValueOnce({\n          data: mockUserData,\n          error: null,\n        });\n\n      const result = await authService.getCurrentUser();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.id).toBe('user-123');\n        expect(result.data.email).toBe('test@example.com');\n        expect(result.data.role).toBe('host');\n      }\n    });\n\n    it('should return error when no session exists', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      } as any);\n\n      const result = await authService.getCurrentUser();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe(ERROR_CODES.UNAUTHORIZED);\n      }\n    });\n  });\n});\n"],"names":["jest","mock","describe","mockSupabase","beforeEach","clearAllMocks","auth","signInWithPassword","fn","signInWithOtp","getSession","refreshSession","signOut","from","mockReturnThis","select","eq","single","createClient","mockReturnValue","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","it","mockSession","access_token","refresh_token","expires_at","mockUser","id","email","mockResolvedValue","data","session","user","error","role","result","authService","loginWithPassword","password","expect","success","toBe","accessToken","refreshToken","message","code","ERROR_CODES","INVALID_CREDENTIALS","UNAUTHORIZED","sendMagicLink","redirectTo","toContain","toHaveBeenCalledWith","options","emailRedirectTo","EXTERNAL_SERVICE_ERROR","SESSION_EXPIRED","logout","UNKNOWN_ERROR","pastTimestamp","Math","floor","Date","now","isSessionExpired","futureTimestamp","mockUserData","created_at","last_login","mockResolvedValueOnce","getCurrentUser"],"mappings":"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"}