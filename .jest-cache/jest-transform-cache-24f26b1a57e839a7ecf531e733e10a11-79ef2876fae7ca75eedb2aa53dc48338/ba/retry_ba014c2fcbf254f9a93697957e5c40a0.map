{"version":3,"names":["RetryPresets","cov_1zj02m9kox","f","s","createRetryWrapper","retryWithBackoff","calculateDelay","attempt","config","delay","exponential","b","baseDelay","Math","pow","maxDelay","jitter","jitterAmount","random","floor","isRetryableError","error","retryableErrors","length","includes","code","fn","startTime","Date","now","lastError","maxRetries","result","success","attempts","totalTime","Promise","resolve","setTimeout","message","Error","details","network","critical","rateLimited","minimal"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/utils/retry.ts"],"sourcesContent":["import type { Result } from '@/types';\n\n/**\n * Retry configuration options.\n */\nexport interface RetryConfig {\n  maxRetries: number; // Maximum number of retry attempts\n  baseDelay: number; // Base delay in milliseconds\n  maxDelay?: number; // Maximum delay cap in milliseconds\n  exponential?: boolean; // Use exponential backoff (default: true)\n  jitter?: boolean; // Add random jitter (default: true)\n  retryableErrors?: string[]; // Only retry these error codes\n}\n\n/**\n * Retry result with attempt information.\n */\nexport type RetryResult<T> = Result<T> & {\n  attempts: number;\n  totalTime: number;\n};\n\n/**\n * Calculates delay for retry attempt with exponential backoff and jitter.\n * \n * @param attempt - Current attempt number (0-indexed)\n * @param config - Retry configuration\n * @returns Delay in milliseconds\n */\nfunction calculateDelay(attempt: number, config: RetryConfig): number {\n  let delay: number;\n\n  if (config.exponential !== false) {\n    // Exponential backoff: baseDelay * 2^attempt\n    delay = config.baseDelay * Math.pow(2, attempt);\n  } else {\n    // Linear backoff: baseDelay * (attempt + 1)\n    delay = config.baseDelay * (attempt + 1);\n  }\n\n  // Apply max delay cap if specified\n  if (config.maxDelay && delay > config.maxDelay) {\n    delay = config.maxDelay;\n  }\n\n  // Add jitter if enabled (default: true)\n  if (config.jitter !== false) {\n    const jitterAmount = delay * 0.1; // 10% jitter\n    const jitter = Math.random() * jitterAmount;\n    delay = delay + jitter;\n  }\n\n  return Math.floor(delay);\n}\n\n/**\n * Checks if an error is retryable based on configuration.\n * \n * @param error - Error to check\n * @param config - Retry configuration\n * @returns True if error should be retried\n */\nfunction isRetryableError(error: { code: string }, config: RetryConfig): boolean {\n  // If no specific retryable errors configured, retry all errors\n  if (!config.retryableErrors || config.retryableErrors.length === 0) {\n    return true;\n  }\n\n  return config.retryableErrors.includes(error.code);\n}\n\n/**\n * Executes a function with automatic retry on failure.\n * \n * @param fn - Async function to execute\n * @param config - Retry configuration\n * @returns Result with attempt information\n * \n * @example\n * const result = await retryWithBackoff(\n *   async () => await externalService.call(),\n *   {\n *     maxRetries: 3,\n *     baseDelay: 1000,\n *     retryableErrors: ['NETWORK_ERROR', 'TIMEOUT'],\n *   }\n * );\n */\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<Result<T>>,\n  config: RetryConfig\n): Promise<RetryResult<T>> {\n  const startTime = Date.now();\n  let lastError: { code: string; message: string; details?: unknown } | null = null;\n\n  for (let attempt = 0; attempt <= config.maxRetries; attempt++) {\n    try {\n      const result = await fn();\n\n      if (result.success) {\n        return {\n          ...result,\n          attempts: attempt + 1,\n          totalTime: Date.now() - startTime,\n        };\n      }\n\n      lastError = result.error;\n\n      // Check if error is retryable\n      if (!isRetryableError(result.error, config)) {\n        return {\n          ...result,\n          attempts: attempt + 1,\n          totalTime: Date.now() - startTime,\n        };\n      }\n\n      // If this was the last attempt, don't delay\n      if (attempt === config.maxRetries) {\n        break;\n      }\n\n      // Calculate and wait for retry delay\n      const delay = calculateDelay(attempt, config);\n      await new Promise((resolve) => setTimeout(resolve, delay));\n    } catch (error) {\n      lastError = {\n        code: 'EXECUTION_ERROR',\n        message: error instanceof Error ? error.message : 'Execution failed',\n        details: error,\n      };\n\n      // If this was the last attempt, don't delay\n      if (attempt === config.maxRetries) {\n        break;\n      }\n\n      // Calculate and wait for retry delay\n      const delay = calculateDelay(attempt, config);\n      await new Promise((resolve) => setTimeout(resolve, delay));\n    }\n  }\n\n  // All retries exhausted\n  return {\n    success: false,\n    error: lastError || {\n      code: 'MAX_RETRIES_EXCEEDED',\n      message: `Failed after ${config.maxRetries + 1} attempts`,\n    },\n    attempts: config.maxRetries + 1,\n    totalTime: Date.now() - startTime,\n  };\n}\n\n/**\n * Creates a retry wrapper function with predefined configuration.\n * \n * @param config - Retry configuration\n * @returns Function that wraps any async function with retry logic\n * \n * @example\n * const retryThreeTimes = createRetryWrapper({\n *   maxRetries: 3,\n *   baseDelay: 1000,\n * });\n * \n * const result = await retryThreeTimes(() => externalService.call());\n */\nexport function createRetryWrapper(config: RetryConfig) {\n  return async <T>(fn: () => Promise<Result<T>>): Promise<RetryResult<T>> => {\n    return retryWithBackoff(fn, config);\n  };\n}\n\n/**\n * Default retry configurations for common scenarios.\n */\nexport const RetryPresets = {\n  /**\n   * Quick retry for transient network errors.\n   */\n  network: {\n    maxRetries: 3,\n    baseDelay: 500,\n    maxDelay: 5000,\n    retryableErrors: ['NETWORK_ERROR', 'TIMEOUT', 'CONNECTION_ERROR'],\n  },\n\n  /**\n   * Aggressive retry for critical operations.\n   */\n  critical: {\n    maxRetries: 5,\n    baseDelay: 1000,\n    maxDelay: 30000,\n  },\n\n  /**\n   * Conservative retry for rate-limited APIs.\n   */\n  rateLimited: {\n    maxRetries: 3,\n    baseDelay: 2000,\n    maxDelay: 60000,\n    retryableErrors: ['RATE_LIMIT_EXCEEDED', 'TOO_MANY_REQUESTS'],\n  },\n\n  /**\n   * Minimal retry for non-critical operations.\n   */\n  minimal: {\n    maxRetries: 1,\n    baseDelay: 1000,\n    maxDelay: 2000,\n  },\n} as const;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}