{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/mocks/mockResendService.ts"],"sourcesContent":["/**\n * Mock Resend Email Service for E2E Testing\n * \n * This mock service simulates Resend email operations without sending real emails.\n * It provides realistic responses for testing email functionality.\n */\n\nimport type { Result } from '@/types';\nimport { ERROR_CODES } from '@/types';\n\ninterface EmailData {\n  from: string;\n  to: string | string[];\n  subject: string;\n  html: string;\n  text?: string;\n}\n\ninterface SentEmail extends EmailData {\n  id: string;\n  timestamp: number;\n  status: 'sent' | 'delivered' | 'failed';\n}\n\n// Track sent emails for debugging and verification\nconst sentEmails: SentEmail[] = [];\n\n// Simulate email delivery failures for testing\nlet shouldFailNextEmail = false;\nlet failureReason = 'Simulated email failure';\n\n/**\n * Mock Resend client\n */\nexport class MockResend {\n  emails = {\n    /**\n     * Mock send email method\n     */\n    send: async (emailData: EmailData): Promise<{ data: { id: string } | null; error: any }> => {\n      try {\n        // Simulate network delay\n        await new Promise((resolve) => setTimeout(resolve, 50));\n\n        // Check for simulated failure\n        if (shouldFailNextEmail) {\n          shouldFailNextEmail = false;\n          console.log('ðŸ§ª [MOCK RESEND] Email failed (simulated):', {\n            to: emailData.to,\n            subject: emailData.subject,\n            reason: failureReason,\n          });\n\n          return {\n            data: null,\n            error: {\n              message: failureReason,\n              name: 'EmailError',\n            },\n          };\n        }\n\n        // Generate mock email ID\n        const emailId = `mock_email_${Date.now()}_${Math.random().toString(36).substring(7)}`;\n\n        // Track sent email\n        const sentEmail: SentEmail = {\n          ...emailData,\n          id: emailId,\n          timestamp: Date.now(),\n          status: 'sent',\n        };\n        sentEmails.push(sentEmail);\n\n        console.log('ðŸ§ª [MOCK RESEND] Email sent:', {\n          id: emailId,\n          to: emailData.to,\n          subject: emailData.subject,\n          from: emailData.from,\n        });\n\n        return {\n          data: { id: emailId },\n          error: null,\n        };\n      } catch (error) {\n        return {\n          data: null,\n          error: {\n            message: error instanceof Error ? error.message : 'Mock email send failed',\n            name: 'EmailError',\n          },\n        };\n      }\n    },\n  };\n}\n\n/**\n * Get all sent emails (for test verification)\n */\nexport function getSentEmails(): SentEmail[] {\n  return [...sentEmails];\n}\n\n/**\n * Get sent emails by recipient\n */\nexport function getSentEmailsByRecipient(recipient: string): SentEmail[] {\n  return sentEmails.filter((email) => {\n    if (Array.isArray(email.to)) {\n      return email.to.includes(recipient);\n    }\n    return email.to === recipient;\n  });\n}\n\n/**\n * Get sent emails by subject\n */\nexport function getSentEmailsBySubject(subject: string): SentEmail[] {\n  return sentEmails.filter((email) => email.subject.includes(subject));\n}\n\n/**\n * Clear sent emails (for test cleanup)\n */\nexport function clearSentEmails(): void {\n  sentEmails.length = 0;\n  console.log('ðŸ§ª [MOCK RESEND] Sent emails cleared');\n}\n\n/**\n * Simulate email delivery failure for next send\n */\nexport function simulateEmailFailure(reason: string = 'Simulated email failure'): void {\n  shouldFailNextEmail = true;\n  failureReason = reason;\n  console.log('ðŸ§ª [MOCK RESEND] Next email will fail:', reason);\n}\n\n/**\n * Simulate email delivery (update status to delivered)\n */\nexport function simulateEmailDelivery(emailId: string): boolean {\n  const email = sentEmails.find((e) => e.id === emailId);\n  if (email) {\n    email.status = 'delivered';\n    console.log('ðŸ§ª [MOCK RESEND] Email delivered:', emailId);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Reset mock state\n */\nexport function resetMockResend(): void {\n  sentEmails.length = 0;\n  shouldFailNextEmail = false;\n  failureReason = 'Simulated email failure';\n  console.log('ðŸ§ª [MOCK RESEND] Mock reset');\n}\n\n/**\n * Get email count\n */\nexport function getEmailCount(): number {\n  return sentEmails.length;\n}\n\n/**\n * Verify email was sent\n */\nexport function verifyEmailSent(criteria: {\n  to?: string;\n  subject?: string;\n  containsText?: string;\n}): boolean {\n  return sentEmails.some((email) => {\n    if (criteria.to) {\n      const toMatch = Array.isArray(email.to)\n        ? email.to.includes(criteria.to)\n        : email.to === criteria.to;\n      if (!toMatch) return false;\n    }\n\n    if (criteria.subject && !email.subject.includes(criteria.subject)) {\n      return false;\n    }\n\n    if (criteria.containsText) {\n      const textMatch =\n        email.html.includes(criteria.containsText) ||\n        (email.text && email.text.includes(criteria.containsText));\n      if (!textMatch) return false;\n    }\n\n    return true;\n  });\n}\n"],"names":["MockResend","clearSentEmails","getEmailCount","getSentEmails","getSentEmailsByRecipient","getSentEmailsBySubject","resetMockResend","simulateEmailDelivery","simulateEmailFailure","verifyEmailSent","sentEmails","shouldFailNextEmail","failureReason","emails","send","emailData","Promise","resolve","setTimeout","console","log","to","subject","reason","data","error","message","name","emailId","Date","now","Math","random","toString","substring","sentEmail","id","timestamp","status","push","from","Error","recipient","filter","email","Array","isArray","includes","length","find","e","criteria","some","toMatch","containsText","textMatch","html","text"],"mappings":"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"}