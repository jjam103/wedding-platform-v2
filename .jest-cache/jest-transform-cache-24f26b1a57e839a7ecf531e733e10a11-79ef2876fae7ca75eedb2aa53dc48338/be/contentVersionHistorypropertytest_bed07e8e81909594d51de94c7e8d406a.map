{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/contentVersionHistory.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { jest, describe, it, expect, beforeEach } from '@jest/globals';\n\n// Mock Supabase before importing services\nconst mockFrom = jest.fn();\njest.mock('@/lib/supabase', () => ({\n  supabase: {\n    from: mockFrom,\n  },\n}));\n\n// Import after mocking\nimport {\n  createSection,\n  createVersionSnapshot,\n  getVersionHistory,\n} from './sectionsService';\n\n// Feature: destination-wedding-platform, Property 20: Content Version History\n\ndescribe('Feature: destination-wedding-platform, Property 20: Content Version History', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should create version entry with timestamp for any content update', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          pageType: fc.constantFrom('activity', 'event', 'accommodation', 'room_type', 'custom'),\n          pageId: fc.uuid(),\n          userId: fc.option(fc.uuid(), { nil: null }),\n          displayOrder: fc.integer({ min: 0, max: 100 }),\n          sectionId: fc.uuid(),\n          versionId: fc.uuid(),\n        }),\n        async (testData) => {\n          const now = new Date().toISOString();\n          \n          // Mock listSections call (used by createVersionSnapshot)\n          // @ts-expect-error - Mock return type inference issue\n          const mockOrder = jest.fn().mockResolvedValue({\n            data: [{\n              id: testData.sectionId,\n              page_type: testData.pageType,\n              page_id: testData.pageId,\n              display_order: testData.displayOrder,\n              created_at: now,\n              updated_at: now,\n            }],\n            error: null,\n          } as any);\n          const mockEq = jest.fn().mockReturnValue({ order: mockOrder } as any);\n          const mockSelect = jest.fn().mockReturnValue({ eq: mockEq } as any);\n          (mockFrom as any).mockReturnValueOnce({ select: mockSelect });\n\n          // Mock columns fetch for listSections\n          // @ts-expect-error - Mock return type inference issue\n          const mockColumnsOrder = jest.fn().mockResolvedValue({\n            data: [],\n            error: null,\n          } as any);\n          const mockIn = jest.fn().mockReturnValue({ order: mockColumnsOrder } as any);\n          const mockColumnsSelect = jest.fn().mockReturnValue({ in: mockIn } as any);\n          (mockFrom as any).mockReturnValueOnce({ select: mockColumnsSelect });\n\n          // Record the time before creating version\n          const beforeTime = new Date();\n\n          // Mock version snapshot creation\n          // @ts-expect-error - Mock return type inference issue\n          const mockSingle = jest.fn().mockResolvedValue({\n            data: {\n              id: testData.versionId,\n              page_type: testData.pageType,\n              page_id: testData.pageId,\n              created_by: testData.userId,\n              sections_snapshot: [{\n                id: testData.sectionId,\n                page_type: testData.pageType,\n                page_id: testData.pageId,\n                display_order: testData.displayOrder,\n                created_at: now,\n                updated_at: now,\n                columns: [],\n              }],\n              created_at: now,\n            },\n            error: null,\n          } as any);\n          const mockVersionSelect = jest.fn().mockReturnValue({ single: mockSingle } as any);\n          const mockInsert = jest.fn().mockReturnValue({ select: mockVersionSelect } as any);\n          (mockFrom as any).mockReturnValueOnce({ insert: mockInsert });\n\n          // Create version snapshot\n          const versionResult = await createVersionSnapshot(\n            testData.pageType,\n            testData.pageId,\n            testData.userId\n          );\n\n          // Record the time after creating version\n          const afterTime = new Date();\n\n          // Property: Version creation should succeed\n          expect(versionResult.success).toBe(true);\n          \n          if (!versionResult.success) {\n            return true;\n          }\n\n          // Property: Version should have a timestamp\n          expect(versionResult.data.created_at).toBeDefined();\n          \n          const versionTime = new Date(versionResult.data.created_at);\n          \n          // Property: Timestamp should be between before and after times (with tolerance)\n          expect(versionTime.getTime()).toBeGreaterThanOrEqual(beforeTime.getTime() - 2000); // 2s tolerance\n          expect(versionTime.getTime()).toBeLessThanOrEqual(afterTime.getTime() + 2000); // 2s tolerance\n\n          // Property: Version should preserve the page type and ID\n          expect(versionResult.data.page_type).toBe(testData.pageType);\n          expect(versionResult.data.page_id).toBe(testData.pageId);\n\n          // Property: Version should preserve the user ID\n          expect(versionResult.data.created_by).toBe(testData.userId);\n\n          // Property: Version should contain sections snapshot\n          expect(versionResult.data.sections_snapshot).toBeDefined();\n\n          return true;\n        }\n      ),\n      { numRuns: 20, timeout: 5000 } // Reduced runs and increased timeout\n    );\n  });\n\n  it('should preserve previous version when creating new version', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          pageType: fc.constantFrom('activity', 'event', 'accommodation', 'room_type', 'custom'),\n          pageId: fc.uuid(),\n          userId: fc.option(fc.uuid(), { nil: null }),\n          version1Id: fc.uuid(),\n          version2Id: fc.uuid(),\n          sectionId: fc.uuid(),\n        }),\n        async (testData) => {\n          const now1 = new Date().toISOString();\n          const now2 = new Date(Date.now() + 1000).toISOString();\n\n          // Mock first version creation - listSections call\n          // @ts-expect-error - Mock return type inference issue\n          const mockOrder1 = jest.fn().mockResolvedValue({\n            data: [{\n              id: testData.sectionId,\n              page_type: testData.pageType,\n              page_id: testData.pageId,\n              display_order: 0,\n              created_at: now1,\n              updated_at: now1,\n            }],\n            error: null,\n          } as any);\n          const mockEq1 = jest.fn().mockReturnValue({ order: mockOrder1 } as any);\n          const mockSelect1 = jest.fn().mockReturnValue({ eq: mockEq1 } as any);\n          (mockFrom as any).mockReturnValueOnce({ select: mockSelect1 });\n\n          // Mock columns fetch for first listSections\n          // @ts-expect-error - Mock return type inference issue\n          const mockColumnsOrder1 = jest.fn().mockResolvedValue({\n            data: [],\n            error: null,\n          } as any);\n          const mockIn1 = jest.fn().mockReturnValue({ order: mockColumnsOrder1 } as any);\n          const mockColumnsSelect1 = jest.fn().mockReturnValue({ in: mockIn1 } as any);\n          (mockFrom as any).mockReturnValueOnce({ select: mockColumnsSelect1 });\n\n          // Mock first version insert\n          // @ts-expect-error - Mock return type inference issue\n          const mockSingle1 = jest.fn().mockResolvedValue({\n            data: {\n              id: testData.version1Id,\n              page_type: testData.pageType,\n              page_id: testData.pageId,\n              created_by: testData.userId,\n              sections_snapshot: [{\n                id: testData.sectionId,\n                page_type: testData.pageType,\n                page_id: testData.pageId,\n                display_order: 0,\n                created_at: now1,\n                updated_at: now1,\n                columns: [],\n              }],\n              created_at: now1,\n            },\n            error: null,\n          } as any);\n          const mockVersionSelect1 = jest.fn().mockReturnValue({ single: mockSingle1 } as any);\n          const mockInsert1 = jest.fn().mockReturnValue({ select: mockVersionSelect1 } as any);\n          (mockFrom as any).mockReturnValueOnce({ insert: mockInsert1 });\n\n          const version1Result = await createVersionSnapshot(\n            testData.pageType,\n            testData.pageId,\n            testData.userId\n          );\n\n          // Mock second version creation - listSections call\n          // @ts-expect-error - Mock return type inference issue\n          const mockOrder2 = jest.fn().mockResolvedValue({\n            data: [{\n              id: testData.sectionId,\n              page_type: testData.pageType,\n              page_id: testData.pageId,\n              display_order: 0,\n              created_at: now2,\n              updated_at: now2,\n            }],\n            error: null,\n          } as any);\n          const mockEq2 = jest.fn().mockReturnValue({ order: mockOrder2 } as any);\n          const mockSelect2 = jest.fn().mockReturnValue({ eq: mockEq2 } as any);\n          (mockFrom as any).mockReturnValueOnce({ select: mockSelect2 });\n\n          // Mock columns fetch for second listSections\n          // @ts-expect-error - Mock return type inference issue\n          const mockColumnsOrder2 = jest.fn().mockResolvedValue({\n            data: [],\n            error: null,\n          } as any);\n          const mockIn2 = jest.fn().mockReturnValue({ order: mockColumnsOrder2 } as any);\n          const mockColumnsSelect2 = jest.fn().mockReturnValue({ in: mockIn2 } as any);\n          (mockFrom as any).mockReturnValueOnce({ select: mockColumnsSelect2 });\n\n          // Mock second version insert\n          // @ts-expect-error - Mock return type inference issue\n          const mockSingle2 = jest.fn().mockResolvedValue({\n            data: {\n              id: testData.version2Id,\n              page_type: testData.pageType,\n              page_id: testData.pageId,\n              created_by: testData.userId,\n              sections_snapshot: [{\n                id: testData.sectionId,\n                page_type: testData.pageType,\n                page_id: testData.pageId,\n                display_order: 0,\n                created_at: now2,\n                updated_at: now2,\n                columns: [],\n              }],\n              created_at: now2,\n            },\n            error: null,\n          } as any);\n          const mockVersionSelect2 = jest.fn().mockReturnValue({ single: mockSingle2 } as any);\n          const mockInsert2 = jest.fn().mockReturnValue({ select: mockVersionSelect2 } as any);\n          (mockFrom as any).mockReturnValueOnce({ insert: mockInsert2 });\n\n          const version2Result = await createVersionSnapshot(\n            testData.pageType,\n            testData.pageId,\n            testData.userId\n          );\n\n          // Property: Both versions should be created successfully\n          expect(version1Result.success).toBe(true);\n          expect(version2Result.success).toBe(true);\n\n          if (!version1Result.success || !version2Result.success) {\n            return true;\n          }\n\n          // Property: Versions should have different IDs\n          expect(version1Result.data.id).not.toBe(version2Result.data.id);\n\n          // Property: Second version should have later or equal timestamp\n          const time1 = new Date(version1Result.data.created_at).getTime();\n          const time2 = new Date(version2Result.data.created_at).getTime();\n          expect(time2).toBeGreaterThanOrEqual(time1);\n\n          // Mock version history retrieval\n          // @ts-expect-error - Mock return type inference issue\n          const mockHistoryOrder = jest.fn().mockResolvedValue({\n            data: [version2Result.data, version1Result.data],\n            error: null,\n          } as any);\n          const mockHistoryEq = jest.fn().mockReturnValue({ order: mockHistoryOrder } as any);\n          const mockHistorySelect = jest.fn().mockReturnValue({ eq: mockHistoryEq } as any);\n          (mockFrom as any).mockReturnValue({ select: mockHistorySelect });\n\n          const historyResult = await getVersionHistory(testData.pageId);\n\n          if (!historyResult.success) {\n            return true;\n          }\n\n          // Property: Both versions should exist in history\n          const foundVersion1 = historyResult.data.find(v => v.id === version1Result.data.id);\n          const foundVersion2 = historyResult.data.find(v => v.id === version2Result.data.id);\n\n          expect(foundVersion1).toBeDefined();\n          expect(foundVersion2).toBeDefined();\n\n          // Property: Versions should be ordered by created_at (newest first)\n          if (historyResult.data.length >= 2) {\n            for (let i = 0; i < historyResult.data.length - 1; i++) {\n              const current = new Date(historyResult.data[i].created_at);\n              const next = new Date(historyResult.data[i + 1].created_at);\n              expect(current.getTime()).toBeGreaterThanOrEqual(next.getTime());\n            }\n          }\n\n          return true;\n        }\n      ),\n      { numRuns: 10, timeout: 5000 } // Fewer runs due to async operations and increased timeout\n    );\n  });\n});\n"],"names":["mockFrom","jest","fn","mock","supabase","from","describe","beforeEach","clearAllMocks","it","fc","assert","asyncProperty","record","pageType","constantFrom","pageId","uuid","userId","option","nil","displayOrder","integer","min","max","sectionId","versionId","testData","now","Date","toISOString","mockOrder","mockResolvedValue","data","id","page_type","page_id","display_order","created_at","updated_at","error","mockEq","mockReturnValue","order","mockSelect","eq","mockReturnValueOnce","select","mockColumnsOrder","mockIn","mockColumnsSelect","in","beforeTime","mockSingle","created_by","sections_snapshot","columns","mockVersionSelect","single","mockInsert","insert","versionResult","createVersionSnapshot","afterTime","expect","success","toBe","toBeDefined","versionTime","getTime","toBeGreaterThanOrEqual","toBeLessThanOrEqual","numRuns","timeout","version1Id","version2Id","now1","now2","mockOrder1","mockEq1","mockSelect1","mockColumnsOrder1","mockIn1","mockColumnsSelect1","mockSingle1","mockVersionSelect1","mockInsert1","version1Result","mockOrder2","mockEq2","mockSelect2","mockColumnsOrder2","mockIn2","mockColumnsSelect2","mockSingle2","mockVersionSelect2","mockInsert2","version2Result","not","time1","time2","mockHistoryOrder","mockHistoryEq","mockHistorySelect","historyResult","getVersionHistory","foundVersion1","find","v","foundVersion2","length","i","current","next"],"mappings":"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"}