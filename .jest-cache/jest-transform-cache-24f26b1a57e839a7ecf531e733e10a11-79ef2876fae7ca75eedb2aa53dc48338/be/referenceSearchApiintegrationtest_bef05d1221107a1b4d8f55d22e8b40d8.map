{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/referenceSearchApi.integration.test.ts"],"sourcesContent":["/**\n * Reference Search API Integration Tests\n * \n * Tests the reference search and preview API endpoints by testing\n * the route handlers directly with mocked Supabase client.\n */\n\n// Polyfill Request for Node.js environment\nif (typeof Request === 'undefined') {\n  global.Request = class Request {\n    url: string;\n    method: string;\n    headers: Map<string, string>;\n    body: any;\n\n    constructor(url: string, init?: any) {\n      this.url = url;\n      this.method = init?.method || 'GET';\n      this.headers = new Map();\n      if (init?.headers) {\n        Object.entries(init.headers).forEach(([key, value]) => {\n          this.headers.set(key, value as string);\n        });\n      }\n      this.body = init?.body;\n    }\n\n    async json() {\n      return this.body ? JSON.parse(this.body) : null;\n    }\n  } as any;\n}\n\n// Mock next/server to avoid Request/Response issues\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n}));\n\n// Mock Supabase client\nconst mockSupabaseClient = {\n  auth: {\n    getSession: jest.fn(),\n  },\n  from: jest.fn(),\n};\n\n// Mock @supabase/ssr\njest.mock('@supabase/ssr', () => ({\n  createServerClient: jest.fn(() => mockSupabaseClient),\n}));\n\n// Mock next/headers\njest.mock('next/headers', () => ({\n  cookies: jest.fn(() => Promise.resolve({\n    getAll: () => [],\n    setAll: () => {},\n  })),\n}));\n\nimport { GET as searchGET } from '@/app/api/admin/references/search/route';\nimport { GET as previewGET } from '@/app/api/admin/references/[type]/[id]/route';\n\ndescribe('Reference Search API Integration Tests', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('GET /api/admin/references/search', () => {\n    describe('Authentication', () => {\n      it('should return 401 when not authenticated', async () => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: null },\n          error: null,\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=test&type=event');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(401);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNAUTHORIZED');\n      });\n\n      it('should return 401 when auth error occurs', async () => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: null },\n          error: { message: 'Auth error' },\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=test&type=event');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(401);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNAUTHORIZED');\n      });\n    });\n\n    describe('Validation', () => {\n      beforeEach(() => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: { user: { id: 'user-1' } } },\n          error: null,\n        });\n      });\n\n      it('should return empty results when query is empty', async () => {\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=&type=event');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.results).toEqual([]);\n        expect(data.data.total).toBe(0);\n      });\n\n      it('should return 400 when no entity types provided', async () => {\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=test&type=');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(400);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('VALIDATION_ERROR');\n      });\n    });\n\n    describe('Multi-Entity Search', () => {\n      beforeEach(() => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: { user: { id: 'user-1' } } },\n          error: null,\n        });\n      });\n\n      it('should search events when type includes event', async () => {\n        const mockEvents = [\n          {\n            id: 'event-1',\n            name: 'Ceremony',\n            slug: 'ceremony',\n            is_active: true,\n            start_time: '2025-06-15T14:00:00Z',\n          },\n        ];\n\n        mockSupabaseClient.from.mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            or: jest.fn().mockReturnValue({\n              limit: jest.fn().mockResolvedValue({ data: mockEvents, error: null }),\n            }),\n          }),\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=ceremony&type=event');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.results).toHaveLength(1);\n        expect(data.data.results[0]).toMatchObject({\n          id: 'event-1',\n          name: 'Ceremony',\n          type: 'event',\n          slug: 'ceremony',\n          status: 'active',\n        });\n      });\n\n      it('should search activities when type includes activity', async () => {\n        const mockActivities = [\n          {\n            id: 'activity-1',\n            name: 'Beach Day',\n            slug: 'beach-day',\n            capacity: 50,\n            start_time: '2025-06-16T10:00:00Z',\n          },\n        ];\n\n        mockSupabaseClient.from.mockImplementation((table: string) => {\n          if (table === 'activities') {\n            return {\n              select: jest.fn().mockReturnValue({\n                or: jest.fn().mockReturnValue({\n                  limit: jest.fn().mockResolvedValue({ data: mockActivities, error: null }),\n                }),\n              }),\n            };\n          }\n          if (table === 'rsvps') {\n            return {\n              select: jest.fn().mockReturnValue({\n                in: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({ data: [], error: null }),\n                }),\n              }),\n            };\n          }\n          return { select: jest.fn() };\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=beach&type=activity');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.results).toHaveLength(1);\n        expect(data.data.results[0]).toMatchObject({\n          id: 'activity-1',\n          name: 'Beach Day',\n          type: 'activity',\n          slug: 'beach-day',\n        });\n      });\n\n      it('should search multiple entity types', async () => {\n        const mockEvents = [\n          {\n            id: 'event-1',\n            name: 'Wedding Ceremony',\n            slug: 'ceremony',\n            is_active: true,\n            start_time: '2025-06-15T14:00:00Z',\n          },\n        ];\n\n        const mockActivities = [\n          {\n            id: 'activity-1',\n            name: 'Wedding Reception',\n            slug: 'reception',\n            capacity: 100,\n            start_time: '2025-06-15T18:00:00Z',\n          },\n        ];\n\n        mockSupabaseClient.from.mockImplementation((table: string) => {\n          if (table === 'events') {\n            return {\n              select: jest.fn().mockReturnValue({\n                or: jest.fn().mockReturnValue({\n                  limit: jest.fn().mockResolvedValue({ data: mockEvents, error: null }),\n                }),\n              }),\n            };\n          }\n          if (table === 'activities') {\n            return {\n              select: jest.fn().mockReturnValue({\n                or: jest.fn().mockReturnValue({\n                  limit: jest.fn().mockResolvedValue({ data: mockActivities, error: null }),\n                }),\n              }),\n            };\n          }\n          if (table === 'rsvps') {\n            return {\n              select: jest.fn().mockReturnValue({\n                in: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({ data: [], error: null }),\n                }),\n              }),\n            };\n          }\n          return { select: jest.fn() };\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=wedding&type=event,activity');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.results.length).toBeGreaterThanOrEqual(2);\n        expect(data.data.results.some((r: any) => r.type === 'event')).toBe(true);\n        expect(data.data.results.some((r: any) => r.type === 'activity')).toBe(true);\n      });\n    });\n\n    describe('Entity Type Filtering', () => {\n      beforeEach(() => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: { user: { id: 'user-1' } } },\n          error: null,\n        });\n      });\n\n      it('should only search specified entity types', async () => {\n        const mockAccommodations = [\n          {\n            id: 'accommodation-1',\n            name: 'Beach Resort',\n            slug: 'beach-resort',\n            check_in_date: '2025-06-14',\n            check_out_date: '2025-06-17',\n          },\n        ];\n\n        mockSupabaseClient.from.mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            or: jest.fn().mockReturnValue({\n              limit: jest.fn().mockResolvedValue({ data: mockAccommodations, error: null }),\n            }),\n          }),\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=beach&type=accommodation');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.results).toHaveLength(1);\n        expect(data.data.results[0].type).toBe('accommodation');\n      });\n    });\n\n    describe('Result Ordering', () => {\n      beforeEach(() => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: { user: { id: 'user-1' } } },\n          error: null,\n        });\n      });\n\n      it('should order exact matches before partial matches', async () => {\n        const mockEvents = [\n          {\n            id: 'event-1',\n            name: 'Beach',\n            slug: 'beach',\n            is_active: true,\n            start_time: '2025-06-15T14:00:00Z',\n          },\n          {\n            id: 'event-2',\n            name: 'Beach Party',\n            slug: 'beach-party',\n            is_active: true,\n            start_time: '2025-06-16T14:00:00Z',\n          },\n          {\n            id: 'event-3',\n            name: 'Sunset at Beach',\n            slug: 'sunset-beach',\n            is_active: true,\n            start_time: '2025-06-17T14:00:00Z',\n          },\n        ];\n\n        mockSupabaseClient.from.mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            or: jest.fn().mockReturnValue({\n              limit: jest.fn().mockResolvedValue({ data: mockEvents, error: null }),\n            }),\n          }),\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=beach&type=event');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.results[0].name).toBe('Beach'); // Exact match first\n      });\n\n      it('should sort alphabetically within same relevance level', async () => {\n        const mockEvents = [\n          {\n            id: 'event-1',\n            name: 'Zebra Event',\n            slug: 'zebra',\n            is_active: true,\n            start_time: '2025-06-15T14:00:00Z',\n          },\n          {\n            id: 'event-2',\n            name: 'Apple Event',\n            slug: 'apple',\n            is_active: true,\n            start_time: '2025-06-16T14:00:00Z',\n          },\n        ];\n\n        mockSupabaseClient.from.mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            or: jest.fn().mockReturnValue({\n              limit: jest.fn().mockResolvedValue({ data: mockEvents, error: null }),\n            }),\n          }),\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/search?q=event&type=event');\n        const response = await searchGET(request);\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.results[0].name).toBe('Apple Event'); // Alphabetically first\n        expect(data.data.results[1].name).toBe('Zebra Event');\n      });\n    });\n  });\n\n  describe('GET /api/admin/references/:type/:id', () => {\n    describe('Authentication', () => {\n      it('should return 401 when not authenticated', async () => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: null },\n          error: null,\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/event/event-1');\n        const response = await previewGET(request, { params: Promise.resolve({ type: 'event', id: 'event-1' }) });\n        const data = await response.json();\n\n        expect(response.status).toBe(401);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNAUTHORIZED');\n      });\n    });\n\n    describe('Validation', () => {\n      beforeEach(() => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: { user: { id: 'user-1' } } },\n          error: null,\n        });\n      });\n\n      it('should return 400 for invalid entity type', async () => {\n        const request = new Request('http://localhost:3000/api/admin/references/invalid/id-1');\n        const response = await previewGET(request, { params: Promise.resolve({ type: 'invalid', id: 'id-1' }) });\n        const data = await response.json();\n\n        expect(response.status).toBe(400);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('VALIDATION_ERROR');\n      });\n    });\n\n    describe('Entity Preview', () => {\n      beforeEach(() => {\n        mockSupabaseClient.auth.getSession.mockResolvedValue({\n          data: { session: { user: { id: 'user-1' } } },\n          error: null,\n        });\n      });\n\n      it('should return event preview with details', async () => {\n        const mockEvent = {\n          id: 'event-1',\n          name: 'Ceremony',\n          slug: 'ceremony',\n          is_active: true,\n          start_time: '2025-06-15T14:00:00Z',\n          end_time: '2025-06-15T15:00:00Z',\n          description: 'Wedding ceremony',\n          event_type: 'ceremony',\n          locations: { name: 'Beach' },\n        };\n\n        mockSupabaseClient.from.mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({ data: mockEvent, error: null }),\n            }),\n          }),\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/event/event-1');\n        const response = await previewGET(request, { params: Promise.resolve({ type: 'event', id: 'event-1' }) });\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data).toMatchObject({\n          id: 'event-1',\n          name: 'Ceremony',\n          type: 'event',\n          slug: 'ceremony',\n          status: 'active',\n        });\n        expect(data.data.details).toMatchObject({\n          eventType: 'ceremony',\n          startTime: '2025-06-15T14:00:00Z',\n          endTime: '2025-06-15T15:00:00Z',\n          description: 'Wedding ceremony',\n          location: 'Beach',\n        });\n      });\n\n      it('should return activity preview with capacity info', async () => {\n        const mockActivity = {\n          id: 'activity-1',\n          name: 'Beach Day',\n          slug: 'beach-day',\n          capacity: 50,\n          start_time: '2025-06-16T10:00:00Z',\n          end_time: '2025-06-16T16:00:00Z',\n          description: 'Fun at the beach',\n          activity_type: 'activity',\n          cost_per_person: 25,\n          locations: { name: 'Playa Tamarindo' },\n        };\n\n        mockSupabaseClient.from.mockImplementation((table: string) => {\n          if (table === 'activities') {\n            return {\n              select: jest.fn().mockReturnValue({\n                eq: jest.fn().mockReturnValue({\n                  single: jest.fn().mockResolvedValue({ data: mockActivity, error: null }),\n                }),\n              }),\n            };\n          }\n          if (table === 'rsvps') {\n            return {\n              select: jest.fn().mockReturnValue({\n                eq: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({ count: 30, error: null }),\n                }),\n              }),\n            };\n          }\n          return { select: jest.fn() };\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/activity/activity-1');\n        const response = await previewGET(request, { params: Promise.resolve({ type: 'activity', id: 'activity-1' }) });\n        const data = await response.json();\n\n        expect(response.status).toBe(200);\n        expect(data.success).toBe(true);\n        expect(data.data.details).toMatchObject({\n          capacity: 50,\n          attendees: 30,\n          costPerPerson: 25,\n        });\n      });\n\n      it('should return 404 when entity not found', async () => {\n        mockSupabaseClient.from.mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            eq: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({ data: null, error: { message: 'Not found' } }),\n            }),\n          }),\n        });\n\n        const request = new Request('http://localhost:3000/api/admin/references/event/nonexistent');\n        const response = await previewGET(request, { params: Promise.resolve({ type: 'event', id: 'nonexistent' }) });\n        const data = await response.json();\n\n        expect(response.status).toBe(404);\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('NOT_FOUND');\n      });\n    });\n  });\n});\n"],"names":["jest","mock","NextResponse","json","data","init","status","createServerClient","fn","mockSupabaseClient","cookies","Promise","resolve","getAll","setAll","Request","global","url","method","headers","Map","Object","entries","forEach","key","value","set","body","JSON","parse","auth","getSession","from","describe","beforeEach","clearAllMocks","it","mockResolvedValue","session","error","request","response","searchGET","expect","toBe","success","code","message","user","id","results","toEqual","total","mockEvents","name","slug","is_active","start_time","mockReturnValue","select","or","limit","toHaveLength","toMatchObject","type","mockActivities","capacity","mockImplementation","table","in","eq","length","toBeGreaterThanOrEqual","some","r","mockAccommodations","check_in_date","check_out_date","previewGET","params","mockEvent","end_time","description","event_type","locations","single","details","eventType","startTime","endTime","location","mockActivity","activity_type","cost_per_person","count","attendees","costPerPerson"],"mappings":"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"}