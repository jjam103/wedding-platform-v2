{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/EmailTemplateEditor.tsx"],"sourcesContent":["'use client';\n\n/**\n * EmailTemplateEditor Component\n * \n * Rich text editor for email templates with variable picker and preview\n * Requirements: 17.1, 17.2, 17.3\n */\n\nimport React, { useState, useCallback } from 'react';\nimport { RichTextEditor } from './RichTextEditor';\nimport { sanitizeInput } from '@/utils/sanitization';\n\ninterface EmailTemplateEditorProps {\n  value?: {\n    name: string;\n    subject: string;\n    body_html: string;\n    category?: string;\n  };\n  onChange: (template: {\n    name: string;\n    subject: string;\n    body_html: string;\n    category?: string;\n  }) => void;\n  onSave?: () => void;\n  onCancel?: () => void;\n  disabled?: boolean;\n}\n\n// Available template variables\nconst TEMPLATE_VARIABLES = [\n  { key: '{{guest_name}}', description: 'Guest full name' },\n  { key: '{{guest_first_name}}', description: 'Guest first name' },\n  { key: '{{guest_last_name}}', description: 'Guest last name' },\n  { key: '{{guest_email}}', description: 'Guest email address' },\n  { key: '{{event_name}}', description: 'Event name' },\n  { key: '{{event_date}}', description: 'Event date' },\n  { key: '{{event_time}}', description: 'Event time' },\n  { key: '{{event_location}}', description: 'Event location' },\n  { key: '{{activity_name}}', description: 'Activity name' },\n  { key: '{{activity_date}}', description: 'Activity date' },\n  { key: '{{activity_time}}', description: 'Activity time' },\n  { key: '{{activity_location}}', description: 'Activity location' },\n  { key: '{{rsvp_deadline}}', description: 'RSVP deadline date' },\n  { key: '{{wedding_date}}', description: 'Wedding date' },\n  { key: '{{venue_name}}', description: 'Venue name' },\n  { key: '{{venue_address}}', description: 'Venue address' },\n  { key: '{{login_link}}', description: 'Guest portal login link' },\n  { key: '{{magic_link}}', description: 'Magic link for authentication' },\n];\n\n// Template categories\nconst TEMPLATE_CATEGORIES = [\n  { value: 'invitation', label: 'Invitation' },\n  { value: 'rsvp', label: 'RSVP' },\n  { value: 'reminder', label: 'Reminder' },\n  { value: 'confirmation', label: 'Confirmation' },\n  { value: 'update', label: 'Update' },\n  { value: 'announcement', label: 'Announcement' },\n  { value: 'other', label: 'Other' },\n];\n\n// Sample data for preview\nconst SAMPLE_DATA = {\n  guest_name: 'John Doe',\n  guest_first_name: 'John',\n  guest_last_name: 'Doe',\n  guest_email: 'john.doe@example.com',\n  event_name: 'Wedding Ceremony',\n  event_date: 'June 15, 2024',\n  event_time: '4:00 PM',\n  event_location: 'Sunset Beach, Costa Rica',\n  activity_name: 'Welcome Dinner',\n  activity_date: 'June 14, 2024',\n  activity_time: '7:00 PM',\n  activity_location: 'Beachside Restaurant',\n  rsvp_deadline: 'May 1, 2024',\n  wedding_date: 'June 15, 2024',\n  venue_name: 'Paradise Resort',\n  venue_address: '123 Beach Road, Costa Rica',\n  login_link: 'https://example.com/auth/guest-login',\n  magic_link: 'https://example.com/auth/magic-link/verify?token=abc123',\n};\n\nexport function EmailTemplateEditor({\n  value,\n  onChange,\n  onSave,\n  onCancel,\n  disabled = false,\n}: EmailTemplateEditorProps) {\n  const [showVariablePicker, setShowVariablePicker] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [subjectCursorPosition, setSubjectCursorPosition] = useState<number | null>(null);\n\n  const template = value || {\n    name: '',\n    subject: '',\n    body_html: '',\n    category: 'other',\n  };\n\n  const handleNameChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      onChange({\n        ...template,\n        name: sanitizeInput(e.target.value),\n      });\n    },\n    [template, onChange]\n  );\n\n  const handleSubjectChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setSubjectCursorPosition(e.target.selectionStart);\n      onChange({\n        ...template,\n        subject: e.target.value, // Don't sanitize subject - allow variables\n      });\n    },\n    [template, onChange]\n  );\n\n  const handleBodyChange = useCallback(\n    (html: string) => {\n      onChange({\n        ...template,\n        body_html: html,\n      });\n    },\n    [template, onChange]\n  );\n\n  const handleCategoryChange = useCallback(\n    (e: React.ChangeEvent<HTMLSelectElement>) => {\n      onChange({\n        ...template,\n        category: e.target.value,\n      });\n    },\n    [template, onChange]\n  );\n\n  const insertVariable = useCallback(\n    (variable: string, target: 'subject' | 'body') => {\n      if (target === 'subject') {\n        const position = subjectCursorPosition ?? template.subject.length;\n        const newSubject =\n          template.subject.slice(0, position) +\n          variable +\n          template.subject.slice(position);\n        onChange({\n          ...template,\n          subject: newSubject,\n        });\n      } else {\n        // For body, append variable at end (RichTextEditor handles cursor position)\n        onChange({\n          ...template,\n          body_html: template.body_html + variable,\n        });\n      }\n      setShowVariablePicker(false);\n    },\n    [template, onChange, subjectCursorPosition]\n  );\n\n  const replaceVariables = useCallback((text: string): string => {\n    let result = text;\n    Object.entries(SAMPLE_DATA).forEach(([key, value]) => {\n      result = result.replace(new RegExp(`{{${key}}}`, 'g'), value);\n    });\n    return result;\n  }, []);\n\n  const previewSubject = replaceVariables(template.subject);\n  const previewBody = replaceVariables(template.body_html);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Template Name */}\n      <div>\n        <label htmlFor=\"template-name\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n          Template Name *\n        </label>\n        <input\n          id=\"template-name\"\n          type=\"text\"\n          value={template.name}\n          onChange={handleNameChange}\n          disabled={disabled}\n          placeholder=\"e.g., RSVP Confirmation\"\n          className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed\"\n          required\n        />\n      </div>\n\n      {/* Category */}\n      <div>\n        <label htmlFor=\"template-category\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n          Category\n        </label>\n        <select\n          id=\"template-category\"\n          value={template.category}\n          onChange={handleCategoryChange}\n          disabled={disabled}\n          className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed\"\n        >\n          {TEMPLATE_CATEGORIES.map((cat) => (\n            <option key={cat.value} value={cat.value}>\n              {cat.label}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      {/* Subject Line */}\n      <div>\n        <div className=\"flex items-center justify-between mb-2\">\n          <label htmlFor=\"template-subject\" className=\"block text-sm font-medium text-gray-700\">\n            Subject Line *\n          </label>\n          <button\n            type=\"button\"\n            onClick={() => setShowVariablePicker(!showVariablePicker)}\n            disabled={disabled}\n            className=\"text-sm text-emerald-600 hover:text-emerald-700 disabled:text-gray-400\"\n          >\n            Insert Variable\n          </button>\n        </div>\n        <input\n          id=\"template-subject\"\n          type=\"text\"\n          value={template.subject}\n          onChange={handleSubjectChange}\n          disabled={disabled}\n          placeholder=\"e.g., Your RSVP for {{event_name}}\"\n          className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed\"\n          required\n        />\n      </div>\n\n      {/* Variable Picker */}\n      {showVariablePicker && (\n        <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-gray-700 mb-3\">Available Variables</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n            {TEMPLATE_VARIABLES.map((variable) => (\n              <button\n                key={variable.key}\n                type=\"button\"\n                onClick={() => insertVariable(variable.key, 'subject')}\n                disabled={disabled}\n                className=\"text-left px-3 py-2 bg-white border border-gray-200 rounded hover:bg-emerald-50 hover:border-emerald-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <div className=\"font-mono text-sm text-emerald-600\">{variable.key}</div>\n                <div className=\"text-xs text-gray-500\">{variable.description}</div>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Email Body */}\n      <div>\n        <div className=\"flex items-center justify-between mb-2\">\n          <label className=\"block text-sm font-medium text-gray-700\">Email Body *</label>\n          <button\n            type=\"button\"\n            onClick={() => setShowPreview(!showPreview)}\n            className=\"text-sm text-emerald-600 hover:text-emerald-700\"\n          >\n            {showPreview ? 'Hide Preview' : 'Show Preview'}\n          </button>\n        </div>\n\n        {!showPreview ? (\n          <div>\n            <RichTextEditor\n              value={template.body_html}\n              onChange={handleBodyChange}\n              disabled={disabled}\n              placeholder=\"Write your email content here. Use the variable picker to insert dynamic content.\"\n            />\n            <div className=\"mt-2\">\n              <button\n                type=\"button\"\n                onClick={() => setShowVariablePicker(!showVariablePicker)}\n                disabled={disabled}\n                className=\"text-sm text-emerald-600 hover:text-emerald-700 disabled:text-gray-400\"\n              >\n                Insert Variable in Body\n              </button>\n            </div>\n          </div>\n        ) : (\n          <div className=\"border border-gray-300 rounded-lg p-6 bg-white\">\n            <div className=\"mb-4 pb-4 border-b border-gray-200\">\n              <div className=\"text-sm text-gray-500 mb-1\">Subject:</div>\n              <div className=\"font-medium\">{previewSubject}</div>\n            </div>\n            <div\n              className=\"prose max-w-none\"\n              dangerouslySetInnerHTML={{ __html: previewBody }}\n            />\n            <div className=\"mt-4 pt-4 border-t border-gray-200 text-xs text-gray-500\">\n              Preview with sample data\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Action Buttons */}\n      {(onSave || onCancel) && (\n        <div className=\"flex items-center justify-end gap-3 pt-4 border-t border-gray-200\">\n          {onCancel && (\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              disabled={disabled}\n              className=\"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Cancel\n            </button>\n          )}\n          {onSave && (\n            <button\n              type=\"button\"\n              onClick={onSave}\n              disabled={disabled || !template.name || !template.subject || !template.body_html}\n              className=\"px-4 py-2 text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Save Template\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["EmailTemplateEditor","TEMPLATE_VARIABLES","key","description","TEMPLATE_CATEGORIES","value","label","SAMPLE_DATA","guest_name","guest_first_name","guest_last_name","guest_email","event_name","event_date","event_time","event_location","activity_name","activity_date","activity_time","activity_location","rsvp_deadline","wedding_date","venue_name","venue_address","login_link","magic_link","onChange","onSave","onCancel","disabled","showVariablePicker","setShowVariablePicker","useState","showPreview","setShowPreview","subjectCursorPosition","setSubjectCursorPosition","template","name","subject","body_html","category","handleNameChange","useCallback","e","sanitizeInput","target","handleSubjectChange","selectionStart","handleBodyChange","html","handleCategoryChange","insertVariable","variable","position","length","newSubject","slice","replaceVariables","text","result","Object","entries","forEach","replace","RegExp","previewSubject","previewBody","div","className","htmlFor","input","id","type","placeholder","required","select","map","cat","option","button","onClick","h3","RichTextEditor","dangerouslySetInnerHTML","__html"],"mappings":"AAAA;;;;;+BAsFgBA;;;eAAAA;;;;+DA7E6B;gCACd;8BACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoB9B,+BAA+B;AAC/B,MAAMC,qBAAqB;IACzB;QAAEC,KAAK;QAAkBC,aAAa;IAAkB;IACxD;QAAED,KAAK;QAAwBC,aAAa;IAAmB;IAC/D;QAAED,KAAK;QAAuBC,aAAa;IAAkB;IAC7D;QAAED,KAAK;QAAmBC,aAAa;IAAsB;IAC7D;QAAED,KAAK;QAAkBC,aAAa;IAAa;IACnD;QAAED,KAAK;QAAkBC,aAAa;IAAa;IACnD;QAAED,KAAK;QAAkBC,aAAa;IAAa;IACnD;QAAED,KAAK;QAAsBC,aAAa;IAAiB;IAC3D;QAAED,KAAK;QAAqBC,aAAa;IAAgB;IACzD;QAAED,KAAK;QAAqBC,aAAa;IAAgB;IACzD;QAAED,KAAK;QAAqBC,aAAa;IAAgB;IACzD;QAAED,KAAK;QAAyBC,aAAa;IAAoB;IACjE;QAAED,KAAK;QAAqBC,aAAa;IAAqB;IAC9D;QAAED,KAAK;QAAoBC,aAAa;IAAe;IACvD;QAAED,KAAK;QAAkBC,aAAa;IAAa;IACnD;QAAED,KAAK;QAAqBC,aAAa;IAAgB;IACzD;QAAED,KAAK;QAAkBC,aAAa;IAA0B;IAChE;QAAED,KAAK;QAAkBC,aAAa;IAAgC;CACvE;AAED,sBAAsB;AACtB,MAAMC,sBAAsB;IAC1B;QAAEC,OAAO;QAAcC,OAAO;IAAa;IAC3C;QAAED,OAAO;QAAQC,OAAO;IAAO;IAC/B;QAAED,OAAO;QAAYC,OAAO;IAAW;IACvC;QAAED,OAAO;QAAgBC,OAAO;IAAe;IAC/C;QAAED,OAAO;QAAUC,OAAO;IAAS;IACnC;QAAED,OAAO;QAAgBC,OAAO;IAAe;IAC/C;QAAED,OAAO;QAASC,OAAO;IAAQ;CAClC;AAED,0BAA0B;AAC1B,MAAMC,cAAc;IAClBC,YAAY;IACZC,kBAAkB;IAClBC,iBAAiB;IACjBC,aAAa;IACbC,YAAY;IACZC,YAAY;IACZC,YAAY;IACZC,gBAAgB;IAChBC,eAAe;IACfC,eAAe;IACfC,eAAe;IACfC,mBAAmB;IACnBC,eAAe;IACfC,cAAc;IACdC,YAAY;IACZC,eAAe;IACfC,YAAY;IACZC,YAAY;AACd;AAEO,SAASzB,oBAAoB,EAClCK,KAAK,EACLqB,QAAQ,EACRC,MAAM,EACNC,QAAQ,EACRC,WAAW,KAAK,EACS;IACzB,MAAM,CAACC,oBAAoBC,sBAAsB,GAAGC,IAAAA,eAAQ,EAAC;IAC7D,MAAM,CAACC,aAAaC,eAAe,GAAGF,IAAAA,eAAQ,EAAC;IAC/C,MAAM,CAACG,uBAAuBC,yBAAyB,GAAGJ,IAAAA,eAAQ,EAAgB;IAElF,MAAMK,WAAWhC,SAAS;QACxBiC,MAAM;QACNC,SAAS;QACTC,WAAW;QACXC,UAAU;IACZ;IAEA,MAAMC,mBAAmBC,IAAAA,kBAAW,EAClC,CAACC;QACClB,SAAS;YACP,GAAGW,QAAQ;YACXC,MAAMO,IAAAA,2BAAa,EAACD,EAAEE,MAAM,CAACzC,KAAK;QACpC;IACF,GACA;QAACgC;QAAUX;KAAS;IAGtB,MAAMqB,sBAAsBJ,IAAAA,kBAAW,EACrC,CAACC;QACCR,yBAAyBQ,EAAEE,MAAM,CAACE,cAAc;QAChDtB,SAAS;YACP,GAAGW,QAAQ;YACXE,SAASK,EAAEE,MAAM,CAACzC,KAAK;QACzB;IACF,GACA;QAACgC;QAAUX;KAAS;IAGtB,MAAMuB,mBAAmBN,IAAAA,kBAAW,EAClC,CAACO;QACCxB,SAAS;YACP,GAAGW,QAAQ;YACXG,WAAWU;QACb;IACF,GACA;QAACb;QAAUX;KAAS;IAGtB,MAAMyB,uBAAuBR,IAAAA,kBAAW,EACtC,CAACC;QACClB,SAAS;YACP,GAAGW,QAAQ;YACXI,UAAUG,EAAEE,MAAM,CAACzC,KAAK;QAC1B;IACF,GACA;QAACgC;QAAUX;KAAS;IAGtB,MAAM0B,iBAAiBT,IAAAA,kBAAW,EAChC,CAACU,UAAkBP;QACjB,IAAIA,WAAW,WAAW;YACxB,MAAMQ,WAAWnB,yBAAyBE,SAASE,OAAO,CAACgB,MAAM;YACjE,MAAMC,aACJnB,SAASE,OAAO,CAACkB,KAAK,CAAC,GAAGH,YAC1BD,WACAhB,SAASE,OAAO,CAACkB,KAAK,CAACH;YACzB5B,SAAS;gBACP,GAAGW,QAAQ;gBACXE,SAASiB;YACX;QACF,OAAO;YACL,4EAA4E;YAC5E9B,SAAS;gBACP,GAAGW,QAAQ;gBACXG,WAAWH,SAASG,SAAS,GAAGa;YAClC;QACF;QACAtB,sBAAsB;IACxB,GACA;QAACM;QAAUX;QAAUS;KAAsB;IAG7C,MAAMuB,mBAAmBf,IAAAA,kBAAW,EAAC,CAACgB;QACpC,IAAIC,SAASD;QACbE,OAAOC,OAAO,CAACvD,aAAawD,OAAO,CAAC,CAAC,CAAC7D,KAAKG,MAAM;YAC/CuD,SAASA,OAAOI,OAAO,CAAC,IAAIC,OAAO,CAAC,EAAE,EAAE/D,IAAI,EAAE,CAAC,EAAE,MAAMG;QACzD;QACA,OAAOuD;IACT,GAAG,EAAE;IAEL,MAAMM,iBAAiBR,iBAAiBrB,SAASE,OAAO;IACxD,MAAM4B,cAAcT,iBAAiBrB,SAASG,SAAS;IAEvD,qBACE,sBAAC4B;QAAIC,WAAU;;0BAEb,sBAACD;;kCACC,qBAAC9D;wBAAMgE,SAAQ;wBAAgBD,WAAU;kCAA+C;;kCAGxF,qBAACE;wBACCC,IAAG;wBACHC,MAAK;wBACLpE,OAAOgC,SAASC,IAAI;wBACpBZ,UAAUgB;wBACVb,UAAUA;wBACV6C,aAAY;wBACZL,WAAU;wBACVM,QAAQ;;;;0BAKZ,sBAACP;;kCACC,qBAAC9D;wBAAMgE,SAAQ;wBAAoBD,WAAU;kCAA+C;;kCAG5F,qBAACO;wBACCJ,IAAG;wBACHnE,OAAOgC,SAASI,QAAQ;wBACxBf,UAAUyB;wBACVtB,UAAUA;wBACVwC,WAAU;kCAETjE,oBAAoByE,GAAG,CAAC,CAACC,oBACxB,qBAACC;gCAAuB1E,OAAOyE,IAAIzE,KAAK;0CACrCyE,IAAIxE,KAAK;+BADCwE,IAAIzE,KAAK;;;;0BAQ5B,sBAAC+D;;kCACC,sBAACA;wBAAIC,WAAU;;0CACb,qBAAC/D;gCAAMgE,SAAQ;gCAAmBD,WAAU;0CAA0C;;0CAGtF,qBAACW;gCACCP,MAAK;gCACLQ,SAAS,IAAMlD,sBAAsB,CAACD;gCACtCD,UAAUA;gCACVwC,WAAU;0CACX;;;;kCAIH,qBAACE;wBACCC,IAAG;wBACHC,MAAK;wBACLpE,OAAOgC,SAASE,OAAO;wBACvBb,UAAUqB;wBACVlB,UAAUA;wBACV6C,aAAY;wBACZL,WAAU;wBACVM,QAAQ;;;;YAKX7C,oCACC,sBAACsC;gBAAIC,WAAU;;kCACb,qBAACa;wBAAGb,WAAU;kCAAyC;;kCACvD,qBAACD;wBAAIC,WAAU;kCACZpE,mBAAmB4E,GAAG,CAAC,CAACxB,yBACvB,sBAAC2B;gCAECP,MAAK;gCACLQ,SAAS,IAAM7B,eAAeC,SAASnD,GAAG,EAAE;gCAC5C2B,UAAUA;gCACVwC,WAAU;;kDAEV,qBAACD;wCAAIC,WAAU;kDAAsChB,SAASnD,GAAG;;kDACjE,qBAACkE;wCAAIC,WAAU;kDAAyBhB,SAASlD,WAAW;;;+BAPvDkD,SAASnD,GAAG;;;;0BAe3B,sBAACkE;;kCACC,sBAACA;wBAAIC,WAAU;;0CACb,qBAAC/D;gCAAM+D,WAAU;0CAA0C;;0CAC3D,qBAACW;gCACCP,MAAK;gCACLQ,SAAS,IAAM/C,eAAe,CAACD;gCAC/BoC,WAAU;0CAETpC,cAAc,iBAAiB;;;;oBAInC,CAACA,4BACA,sBAACmC;;0CACC,qBAACe,8BAAc;gCACb9E,OAAOgC,SAASG,SAAS;gCACzBd,UAAUuB;gCACVpB,UAAUA;gCACV6C,aAAY;;0CAEd,qBAACN;gCAAIC,WAAU;0CACb,cAAA,qBAACW;oCACCP,MAAK;oCACLQ,SAAS,IAAMlD,sBAAsB,CAACD;oCACtCD,UAAUA;oCACVwC,WAAU;8CACX;;;;uCAML,sBAACD;wBAAIC,WAAU;;0CACb,sBAACD;gCAAIC,WAAU;;kDACb,qBAACD;wCAAIC,WAAU;kDAA6B;;kDAC5C,qBAACD;wCAAIC,WAAU;kDAAeH;;;;0CAEhC,qBAACE;gCACCC,WAAU;gCACVe,yBAAyB;oCAAEC,QAAQlB;gCAAY;;0CAEjD,qBAACC;gCAAIC,WAAU;0CAA2D;;;;;;YAQ9E1C,CAAAA,UAAUC,QAAO,mBACjB,sBAACwC;gBAAIC,WAAU;;oBACZzC,0BACC,qBAACoD;wBACCP,MAAK;wBACLQ,SAASrD;wBACTC,UAAUA;wBACVwC,WAAU;kCACX;;oBAIF1C,wBACC,qBAACqD;wBACCP,MAAK;wBACLQ,SAAStD;wBACTE,UAAUA,YAAY,CAACQ,SAASC,IAAI,IAAI,CAACD,SAASE,OAAO,IAAI,CAACF,SAASG,SAAS;wBAChF6B,WAAU;kCACX;;;;;;AAQb"}