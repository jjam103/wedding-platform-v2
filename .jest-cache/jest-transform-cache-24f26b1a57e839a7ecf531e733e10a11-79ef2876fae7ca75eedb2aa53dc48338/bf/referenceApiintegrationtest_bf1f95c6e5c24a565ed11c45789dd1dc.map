{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/referenceApi.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: Reference API Routes\n * \n * Tests the reference validation and preview API endpoints:\n * - POST /api/admin/references/validate - Validates references and detects circular references\n * - GET /api/admin/references/[type]/[id] - Returns preview data for references\n * \n * Requirements: 21.8, 21.9, 25.2, 25.3, 25.6, 25.7\n * \n * CRITICAL: Mock services at module level to avoid worker crashes\n */\n\nimport { POST as validateReferences } from '@/app/api/admin/references/validate/route';\nimport { GET as getPreview } from '@/app/api/admin/references/[type]/[id]/route';\n\n// Mock services at module level\njest.mock('@/services/sectionsService', () => ({\n  validateReferences: jest.fn(),\n  detectCircularReferences: jest.fn(),\n}));\n\njest.mock('@supabase/auth-helpers-nextjs', () => ({\n  createRouteHandlerClient: jest.fn(() => ({\n    auth: {\n      getSession: jest.fn(),\n    },\n    from: jest.fn(),\n  })),\n}));\n\njest.mock('next/headers', () => ({\n  cookies: jest.fn(),\n}));\n\ndescribe('Reference API Integration Tests', () => {\n  let mockSession: any;\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n\n    // Setup mock session\n    mockSession = {\n      user: { id: 'test-user-id', email: 'test@example.com' },\n      access_token: 'test-token',\n    };\n\n    // Setup mock Supabase client\n    const { createRouteHandlerClient } = require('@supabase/auth-helpers-nextjs');\n    mockSupabase = {\n      auth: {\n        getSession: jest.fn().mockResolvedValue({\n          data: { session: mockSession },\n          error: null,\n        }),\n      },\n      from: jest.fn().mockReturnThis(),\n      select: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn(),\n    };\n    createRouteHandlerClient.mockReturnValue(mockSupabase);\n  });\n\n  describe('POST /api/admin/references/validate', () => {\n    it('should validate references successfully when all exist', async () => {\n      const sectionsService = require('@/services/sectionsService');\n      sectionsService.validateReferences.mockResolvedValue({\n        success: true,\n        data: {\n          valid: true,\n          brokenReferences: [],\n          circularReferences: [],\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/validate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          references: [\n            { type: 'event', id: '123e4567-e89b-12d3-a456-426614174000', name: 'Wedding Ceremony' },\n            { type: 'activity', id: '223e4567-e89b-12d3-a456-426614174000', name: 'Beach Party' },\n          ],\n        }),\n      });\n\n      const response = await validateReferences(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.valid).toBe(true);\n      expect(data.data.brokenReferences).toEqual([]);\n      expect(sectionsService.validateReferences).toHaveBeenCalledWith([\n        { type: 'event', id: '123e4567-e89b-12d3-a456-426614174000', name: 'Wedding Ceremony' },\n        { type: 'activity', id: '223e4567-e89b-12d3-a456-426614174000', name: 'Beach Party' },\n      ]);\n    });\n\n    it('should detect broken references', async () => {\n      const sectionsService = require('@/services/sectionsService');\n      sectionsService.validateReferences.mockResolvedValue({\n        success: true,\n        data: {\n          valid: false,\n          brokenReferences: [\n            { type: 'event', id: '123e4567-e89b-12d3-a456-426614174000', name: 'Deleted Event' },\n          ],\n          circularReferences: [],\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/validate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          references: [\n            { type: 'event', id: '123e4567-e89b-12d3-a456-426614174000', name: 'Deleted Event' },\n          ],\n        }),\n      });\n\n      const response = await validateReferences(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.valid).toBe(false);\n      expect(data.data.brokenReferences).toHaveLength(1);\n      expect(data.data.brokenReferences[0].name).toBe('Deleted Event');\n    });\n\n    it('should detect circular references', async () => {\n      const sectionsService = require('@/services/sectionsService');\n      sectionsService.detectCircularReferences.mockResolvedValue({\n        success: true,\n        data: true, // Circular reference detected\n      });\n      sectionsService.validateReferences.mockResolvedValue({\n        success: true,\n        data: {\n          valid: true,\n          brokenReferences: [],\n          circularReferences: [],\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/validate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          pageId: '323e4567-e89b-12d3-a456-426614174000',\n          pageType: 'custom',\n          references: [\n            { type: 'content_page', id: '423e4567-e89b-12d3-a456-426614174000', name: 'Page A' },\n          ],\n        }),\n      });\n\n      const response = await validateReferences(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.valid).toBe(false);\n      expect(data.data.hasCircularReference).toBe(true);\n      expect(sectionsService.detectCircularReferences).toHaveBeenCalledWith(\n        '323e4567-e89b-12d3-a456-426614174000',\n        [{ type: 'content_page', id: '423e4567-e89b-12d3-a456-426614174000', name: 'Page A' }]\n      );\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/validate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          references: [],\n        }),\n      });\n\n      const response = await validateReferences(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 400 when validation fails', async () => {\n      const request = new Request('http://localhost:3000/api/admin/references/validate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          references: [\n            { type: 'invalid_type', id: 'not-a-uuid', name: 'Invalid' },\n          ],\n        }),\n      });\n\n      const response = await validateReferences(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should handle service errors gracefully', async () => {\n      const sectionsService = require('@/services/sectionsService');\n      sectionsService.validateReferences.mockResolvedValue({\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Database connection failed',\n        },\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/validate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          references: [\n            { type: 'event', id: '123e4567-e89b-12d3-a456-426614174000', name: 'Test Event' },\n          ],\n        }),\n      });\n\n      const response = await validateReferences(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n  });\n\n  describe('GET /api/admin/references/[type]/[id]', () => {\n    it('should return event preview data', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                id: '123e4567-e89b-12d3-a456-426614174000',\n                name: 'Wedding Ceremony',\n                slug: 'wedding-ceremony',\n                is_active: true,\n                start_time: '2024-06-15T14:00:00Z',\n                end_time: '2024-06-15T15:00:00Z',\n                description: 'The main wedding ceremony',\n                event_type: 'ceremony',\n                locations: { name: 'Beach Venue' },\n              },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/event/123e4567-e89b-12d3-a456-426614174000');\n      const params = Promise.resolve({ type: 'event', id: '123e4567-e89b-12d3-a456-426614174000' });\n\n      const response = await getPreview(request, { params });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.id).toBe('123e4567-e89b-12d3-a456-426614174000');\n      expect(data.data.name).toBe('Wedding Ceremony');\n      expect(data.data.type).toBe('event');\n      expect(data.data.details.eventType).toBe('ceremony');\n      expect(data.data.details.location).toBe('Beach Venue');\n    });\n\n    it('should return activity preview data with RSVP count', async () => {\n      mockSupabase.from.mockImplementation((table: string) => {\n        if (table === 'activities') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: {\n                    id: '223e4567-e89b-12d3-a456-426614174000',\n                    name: 'Beach Party',\n                    slug: 'beach-party',\n                    capacity: 50,\n                    start_time: '2024-06-16T18:00:00Z',\n                    end_time: '2024-06-16T22:00:00Z',\n                    description: 'Fun beach party',\n                    activity_type: 'social',\n                    cost_per_person: 25.00,\n                    locations: { name: 'Beach Club' },\n                  },\n                  error: null,\n                }),\n              }),\n            }),\n          };\n        } else if (table === 'rsvps') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnThis(),\n            }),\n          };\n        }\n        return mockSupabase;\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/activity/223e4567-e89b-12d3-a456-426614174000');\n      const params = Promise.resolve({ type: 'activity', id: '223e4567-e89b-12d3-a456-426614174000' });\n\n      const response = await getPreview(request, { params });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.name).toBe('Beach Party');\n      expect(data.data.type).toBe('activity');\n      expect(data.data.details.capacity).toBe(50);\n      expect(data.data.details.costPerPerson).toBe(25.00);\n    });\n\n    it('should return content page preview data', async () => {\n      mockSupabase.from.mockImplementation((table: string) => {\n        if (table === 'content_pages') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: {\n                    id: '323e4567-e89b-12d3-a456-426614174000',\n                    title: 'Our Story',\n                    slug: 'our-story',\n                    status: 'published',\n                    created_at: '2024-01-01T00:00:00Z',\n                    updated_at: '2024-01-15T00:00:00Z',\n                  },\n                  error: null,\n                }),\n              }),\n            }),\n          };\n        } else if (table === 'content_sections') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnThis(),\n            }),\n          };\n        }\n        return mockSupabase;\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/content_page/323e4567-e89b-12d3-a456-426614174000');\n      const params = Promise.resolve({ type: 'content_page', id: '323e4567-e89b-12d3-a456-426614174000' });\n\n      const response = await getPreview(request, { params });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.name).toBe('Our Story');\n      expect(data.data.type).toBe('content_page');\n      expect(data.data.slug).toBe('our-story');\n      expect(data.data.status).toBe('published');\n    });\n\n    it('should return accommodation preview data', async () => {\n      mockSupabase.from.mockImplementation((table: string) => {\n        if (table === 'accommodations') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: {\n                    id: '423e4567-e89b-12d3-a456-426614174000',\n                    name: 'Beach Resort',\n                    slug: 'beach-resort',\n                    check_in_date: '2024-06-14',\n                    check_out_date: '2024-06-17',\n                    description: 'Luxury beach resort',\n                    address: '123 Beach Road',\n                    locations: { name: 'Coastal Area' },\n                  },\n                  error: null,\n                }),\n              }),\n            }),\n          };\n        } else if (table === 'room_types') {\n          return {\n            select: jest.fn().mockReturnValue({\n              eq: jest.fn().mockReturnThis(),\n            }),\n          };\n        }\n        return mockSupabase;\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/accommodation/423e4567-e89b-12d3-a456-426614174000');\n      const params = Promise.resolve({ type: 'accommodation', id: '423e4567-e89b-12d3-a456-426614174000' });\n\n      const response = await getPreview(request, { params });\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.data.name).toBe('Beach Resort');\n      expect(data.data.type).toBe('accommodation');\n      expect(data.data.details.address).toBe('123 Beach Road');\n    });\n\n    it('should return 401 when not authenticated', async () => {\n      mockSupabase.auth.getSession.mockResolvedValue({\n        data: { session: null },\n        error: null,\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/event/123e4567-e89b-12d3-a456-426614174000');\n      const params = Promise.resolve({ type: 'event', id: '123e4567-e89b-12d3-a456-426614174000' });\n\n      const response = await getPreview(request, { params });\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return 400 for invalid entity type', async () => {\n      const request = new Request('http://localhost:3000/api/admin/references/invalid_type/123e4567-e89b-12d3-a456-426614174000');\n      const params = Promise.resolve({ type: 'invalid_type', id: '123e4567-e89b-12d3-a456-426614174000' });\n\n      const response = await getPreview(request, { params });\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('VALIDATION_ERROR');\n    });\n\n    it('should return 404 when entity not found', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { code: 'PGRST116', message: 'Not found' },\n            }),\n          }),\n        }),\n      });\n\n      const request = new Request('http://localhost:3000/api/admin/references/event/999e4567-e89b-12d3-a456-426614174000');\n      const params = Promise.resolve({ type: 'event', id: '999e4567-e89b-12d3-a456-426614174000' });\n\n      const response = await getPreview(request, { params });\n      const data = await response.json();\n\n      expect(response.status).toBe(404);\n      expect(data.success).toBe(false);\n      expect(data.error.code).toBe('NOT_FOUND');\n    });\n  });\n});\n"],"names":["jest","mock","validateReferences","fn","detectCircularReferences","createRouteHandlerClient","auth","getSession","from","cookies","describe","mockSession","mockSupabase","beforeEach","clearAllMocks","user","id","email","access_token","require","mockResolvedValue","data","session","error","mockReturnThis","select","eq","single","mockReturnValue","it","sectionsService","success","valid","brokenReferences","circularReferences","request","Request","method","headers","body","JSON","stringify","references","type","name","response","json","expect","status","toBe","toEqual","toHaveBeenCalledWith","toHaveLength","pageId","pageType","hasCircularReference","code","message","slug","is_active","start_time","end_time","description","event_type","locations","params","Promise","resolve","getPreview","details","eventType","location","mockImplementation","table","capacity","activity_type","cost_per_person","costPerPerson","title","created_at","updated_at","check_in_date","check_out_date","address"],"mappings":"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"}