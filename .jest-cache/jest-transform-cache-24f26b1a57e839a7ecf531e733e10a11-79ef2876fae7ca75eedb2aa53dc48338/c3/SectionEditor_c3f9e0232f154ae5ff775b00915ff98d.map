{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/SectionEditor.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useCallback, useEffect } from 'react';\nimport dynamic from 'next/dynamic';\nimport Image from 'next/image';\nimport type { Section, Column, CreateSectionDTO } from '@/schemas/cmsSchemas';\nimport { RichTextEditor } from './RichTextEditor';\nimport { PhotoGallerySkeleton } from './PhotoGallerySkeleton';\nimport { Button } from '@/components/ui/Button';\n\n// Lazy load PhotoPicker component\nconst PhotoPicker = dynamic(() => import('./PhotoPicker').then(mod => ({ default: mod.PhotoPicker })), {\n  loading: () => <PhotoGallerySkeleton />,\n  ssr: false,\n});\n\n// Photo Gallery Preview Component\nfunction PhotoGalleryPreview({ photoIds, displayMode }: { photoIds: string[]; displayMode: string }) {\n  const [photos, setPhotos] = useState<Array<{ id: string; photo_url: string; caption?: string }>>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    async function fetchPhotos() {\n      if (!photoIds || photoIds.length === 0) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        const photoPromises = photoIds.map(async (id) => {\n          const response = await fetch(`/api/admin/photos/${id}`);\n          if (!response.ok) return null;\n          const result = await response.json();\n          return result.success ? result.data : null;\n        });\n\n        const fetchedPhotos = await Promise.all(photoPromises);\n        const validPhotos = fetchedPhotos.filter((p): p is { id: string; photo_url: string; caption?: string } => p !== null);\n        setPhotos(validPhotos);\n      } catch (err) {\n        console.error('Error fetching photos for preview:', err);\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchPhotos();\n  }, [photoIds]);\n\n  if (loading) {\n    return (\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"aspect-square rounded-lg bg-gray-200 animate-pulse\"></div>\n        <div className=\"aspect-square rounded-lg bg-gray-200 animate-pulse\"></div>\n      </div>\n    );\n  }\n\n  if (photos.length === 0) {\n    return (\n      <div className=\"text-gray-400 text-center py-4 text-sm\">\n        No photos selected\n      </div>\n    );\n  }\n\n  // Show display mode indicator\n  const modeLabel = displayMode === 'carousel' ? 'Carousel' : displayMode === 'loop' ? 'Auto-play Loop' : 'Gallery Grid';\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"text-xs text-gray-500 italic\">Display Mode: {modeLabel}</div>\n      <div className=\"grid grid-cols-2 gap-4\">\n        {photos.map((photo) => (\n          <div key={photo.id} className=\"aspect-square rounded-lg overflow-hidden bg-gray-200 relative\">\n            <Image\n              src={photo.photo_url}\n              alt={photo.caption || 'Photo'}\n              fill\n              className=\"object-cover\"\n              sizes=\"(max-width: 768px) 50vw, 25vw\"\n            />\n            {photo.caption && (\n              <div className=\"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs p-1 truncate\">\n                {photo.caption}\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\ninterface SectionEditorProps {\n  pageType: 'activity' | 'event' | 'accommodation' | 'room_type' | 'custom' | 'home';\n  pageId: string;\n  onSave?: () => void;\n  onClose?: () => void;\n}\n\ninterface SectionWithColumns extends Section {\n  columns: Column[];\n}\n\n/**\n * SectionEditor component for managing page sections with rich content\n * \n * Redesigned with improved UX:\n * - Clean section list with drag handles\n * - Section numbers and layout descriptions\n * - View/Edit/Delete action buttons\n * - Collapsible editing interface\n * - Guest preview section\n */\nexport function SectionEditor({ pageType, pageId, onSave, onClose }: SectionEditorProps) {\n  const [sections, setSections] = useState<SectionWithColumns[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [editingSection, setEditingSection] = useState<string | null>(null);\n  const [viewingSection, setViewingSection] = useState<string | null>(null);\n  const [draggedSection, setDraggedSection] = useState<string | null>(null);\n  const [showPreview, setShowPreview] = useState(false);\n\n  // Fetch sections on mount\n  useEffect(() => {\n    fetchSections();\n  }, [pageType, pageId]);\n\n  const fetchSections = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await fetch(`/api/admin/sections/by-page/${pageType}/${pageId}`);\n      const result = await response.json();\n      \n      if (result.success) {\n        setSections(result.data || []);\n      } else {\n        setError(result.error?.message || 'Failed to load sections');\n      }\n    } catch (err) {\n      setError('Failed to load sections');\n    } finally {\n      setLoading(false);\n    }\n  }, [pageType, pageId]);\n\n  const handleAddSection = useCallback(async () => {\n    const newSection: CreateSectionDTO = {\n      page_type: pageType === 'home' ? 'custom' : pageType,\n      page_id: pageId,\n      display_order: sections.length,\n      columns: [\n        {\n          column_number: 1,\n          content_type: 'rich_text',\n          content_data: { html: '' },\n        },\n      ],\n    };\n\n    setSaving(true);\n    setError(null);\n\n    try {\n      const response = await fetch('/api/admin/sections', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(newSection),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        setSections(prev => [...prev, result.data]);\n        setEditingSection(result.data.id);\n      } else {\n        setError(result.error?.message || 'Failed to create section');\n      }\n    } catch (err) {\n      setError('Failed to create section');\n    } finally {\n      setSaving(false);\n    }\n  }, [pageType, pageId, sections.length]);\n\n  const handleDeleteSection = useCallback(async (sectionId: string) => {\n    if (!confirm('Are you sure you want to delete this section?')) {\n      return;\n    }\n\n    setSaving(true);\n    setError(null);\n\n    try {\n      const response = await fetch(`/api/admin/sections/${sectionId}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        setSections(prev => prev.filter(s => s.id !== sectionId));\n      } else {\n        setError(result.error?.message || 'Failed to delete section');\n      }\n    } catch (err) {\n      setError('Failed to delete section');\n    } finally {\n      setSaving(false);\n    }\n  }, []);\n\n  const handleTitleChange = useCallback(async (sectionId: string, title: string) => {\n    // Update local state immediately\n    setSections(prev =>\n      prev.map(s => (s.id === sectionId ? { ...s, title } : s))\n    );\n\n    // Debounce API call\n    setSaving(true);\n    setError(null);\n\n    try {\n      const response = await fetch(`/api/admin/sections/${sectionId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ title: title || null }),\n      });\n\n      const result = await response.json();\n\n      if (!result.success) {\n        setError(result.error?.message || 'Failed to update title');\n        fetchSections();\n      }\n    } catch (err) {\n      setError('Failed to update title');\n      fetchSections();\n    } finally {\n      setSaving(false);\n    }\n  }, [fetchSections]);\n\n  const handleToggleLayout = useCallback(async (sectionId: string) => {\n    const section = sections.find(s => s.id === sectionId);\n    if (!section) return;\n\n    const currentLayout = section.columns.length === 1 ? 'one-column' : 'two-column';\n    const newLayout = currentLayout === 'one-column' ? 'two-column' : 'one-column';\n\n    const updatedColumns = newLayout === 'two-column'\n      ? [\n          {\n            column_number: section.columns[0].column_number,\n            content_type: section.columns[0].content_type,\n            content_data: section.columns[0].content_data,\n          },\n          {\n            column_number: 2 as const,\n            content_type: 'rich_text' as const,\n            content_data: { html: '' },\n          },\n        ]\n      : [\n          {\n            column_number: section.columns[0].column_number,\n            content_type: section.columns[0].content_type,\n            content_data: section.columns[0].content_data,\n          },\n        ];\n\n    setSaving(true);\n    setError(null);\n\n    try {\n      const response = await fetch(`/api/admin/sections/${sectionId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ columns: updatedColumns }),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        setSections(prev =>\n          prev.map(s => (s.id === sectionId ? result.data : s))\n        );\n      } else {\n        setError(result.error?.message || 'Failed to update layout');\n      }\n    } catch (err) {\n      setError('Failed to update layout');\n    } finally {\n      setSaving(false);\n    }\n  }, [sections]);\n\n  const handleColumnTypeChange = useCallback(\n    async (sectionId: string, columnId: string, newType: 'rich_text' | 'photo_gallery' | 'references') => {\n      const section = sections.find(s => s.id === sectionId);\n      if (!section) return;\n\n      const updatedColumns = section.columns.map(col => {\n        if (col.id === columnId) {\n          let contentData: any;\n          switch (newType) {\n            case 'rich_text':\n              contentData = { html: '' };\n              break;\n            case 'photo_gallery':\n              contentData = { photo_ids: [], display_mode: 'gallery' };\n              break;\n            case 'references':\n              contentData = { references: [] };\n              break;\n          }\n          return {\n            column_number: col.column_number,\n            content_type: newType,\n            content_data: contentData,\n          };\n        }\n        return {\n          column_number: col.column_number,\n          content_type: col.content_type,\n          content_data: col.content_data,\n        };\n      });\n\n      setSaving(true);\n      setError(null);\n\n      try {\n        const response = await fetch(`/api/admin/sections/${sectionId}`, {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ columns: updatedColumns }),\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          setSections(prev =>\n            prev.map(s => (s.id === sectionId ? result.data : s))\n          );\n        } else {\n          setError(result.error?.message || 'Failed to update column type');\n        }\n      } catch (err) {\n        setError('Failed to update column type');\n      } finally {\n        setSaving(false);\n      }\n    },\n    [sections]\n  );\n\n  const handleColumnContentChange = useCallback(\n    async (sectionId: string, columnId: string, contentData: any) => {\n      const section = sections.find(s => s.id === sectionId);\n      if (!section) return;\n\n      const updatedColumns = section.columns.map(col => {\n        if (col.id === columnId) {\n          return {\n            column_number: col.column_number,\n            content_type: col.content_type,\n            content_data: contentData,\n          };\n        }\n        return {\n          column_number: col.column_number,\n          content_type: col.content_type,\n          content_data: col.content_data,\n        };\n      });\n\n      // Update local state immediately for better UX\n      setSections(prev =>\n        prev.map(s => {\n          if (s.id === sectionId) {\n            return {\n              ...s,\n              columns: s.columns.map(col => {\n                if (col.id === columnId) {\n                  return { ...col, content_data: contentData };\n                }\n                return col;\n              }),\n            };\n          }\n          return s;\n        })\n      );\n\n      // Debounce the API call\n      setSaving(true);\n      setError(null);\n\n      try {\n        const response = await fetch(`/api/admin/sections/${sectionId}`, {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ columns: updatedColumns }),\n        });\n\n        const result = await response.json();\n\n        if (!result.success) {\n          setError(result.error?.message || 'Failed to update content');\n          // Revert on error\n          fetchSections();\n        }\n      } catch (err) {\n        setError('Failed to update content');\n        fetchSections();\n      } finally {\n        setSaving(false);\n      }\n    },\n    [sections, fetchSections]\n  );\n\n  const handleDragStart = useCallback((sectionId: string) => {\n    setDraggedSection(sectionId);\n  }, []);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n  }, []);\n\n  const handleDrop = useCallback(\n    async (targetSectionId: string) => {\n      if (!draggedSection || draggedSection === targetSectionId) {\n        setDraggedSection(null);\n        return;\n      }\n\n      const draggedIndex = sections.findIndex(s => s.id === draggedSection);\n      const targetIndex = sections.findIndex(s => s.id === targetSectionId);\n\n      if (draggedIndex === -1 || targetIndex === -1) {\n        setDraggedSection(null);\n        return;\n      }\n\n      // Reorder sections locally\n      const newSections = [...sections];\n      const [removed] = newSections.splice(draggedIndex, 1);\n      newSections.splice(targetIndex, 0, removed);\n\n      // Update display_order\n      const updatedSections = newSections.map((s, index) => ({\n        ...s,\n        display_order: index,\n      }));\n\n      setSections(updatedSections);\n      setDraggedSection(null);\n\n      // Save to server\n      setSaving(true);\n      setError(null);\n\n      try {\n        const response = await fetch('/api/admin/sections/reorder', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            pageId,\n            sectionIds: updatedSections.map(s => s.id),\n          }),\n        });\n\n        const result = await response.json();\n\n        if (!result.success) {\n          setError(result.error?.message || 'Failed to reorder sections');\n          // Revert on error\n          fetchSections();\n        }\n      } catch (err) {\n        setError('Failed to reorder sections');\n        fetchSections();\n      } finally {\n        setSaving(false);\n      }\n    },\n    [draggedSection, sections, pageId, fetchSections]\n  );\n\n  const handleMoveUp = useCallback(\n    async (sectionId: string) => {\n      const index = sections.findIndex(s => s.id === sectionId);\n      if (index <= 0) return;\n\n      const newSections = [...sections];\n      [newSections[index - 1], newSections[index]] = [\n        newSections[index],\n        newSections[index - 1],\n      ];\n\n      const updatedSections = newSections.map((s, i) => ({\n        ...s,\n        display_order: i,\n      }));\n\n      setSections(updatedSections);\n\n      // Save to server\n      setSaving(true);\n      try {\n        await fetch('/api/admin/sections/reorder', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            pageId,\n            sectionIds: updatedSections.map(s => s.id),\n          }),\n        });\n      } catch (err) {\n        setError('Failed to reorder sections');\n        fetchSections();\n      } finally {\n        setSaving(false);\n      }\n    },\n    [sections, pageId, fetchSections]\n  );\n\n  const handleMoveDown = useCallback(\n    async (sectionId: string) => {\n      const index = sections.findIndex(s => s.id === sectionId);\n      if (index === -1 || index >= sections.length - 1) return;\n\n      const newSections = [...sections];\n      [newSections[index], newSections[index + 1]] = [\n        newSections[index + 1],\n        newSections[index],\n      ];\n\n      const updatedSections = newSections.map((s, i) => ({\n        ...s,\n        display_order: i,\n      }));\n\n      setSections(updatedSections);\n\n      // Save to server\n      setSaving(true);\n      try {\n        await fetch('/api/admin/sections/reorder', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            pageId,\n            sectionIds: updatedSections.map(s => s.id),\n          }),\n        });\n      } catch (err) {\n        setError('Failed to reorder sections');\n        fetchSections();\n      } finally {\n        setSaving(false);\n      }\n    },\n    [sections, pageId, fetchSections]\n  );\n\n  const handleSaveAll = useCallback(() => {\n    if (onSave) {\n      onSave();\n    }\n  }, [onSave]);\n\n  const handlePreview = useCallback(() => {\n    setShowPreview(true);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <div className=\"text-gray-600\">Loading sections...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"section-editor\">\n      {/* Header with Add Section button and save status */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">Sections</h2>\n          {saving && (\n            <span className=\"text-sm text-blue-600 flex items-center gap-2\">\n              <svg className=\"animate-spin h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n              </svg>\n              Saving...\n            </span>\n          )}\n          {!saving && sections.length > 0 && (\n            <span className=\"text-sm text-green-600 flex items-center gap-1\">\n              <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n              </svg>\n              All changes saved\n            </span>\n          )}\n        </div>\n        <Button\n          onClick={handleAddSection}\n          disabled={saving}\n          size=\"sm\"\n          variant=\"primary\"\n        >\n          + Add Section\n        </Button>\n      </div>\n\n      {/* Error message */}\n      {error && (\n        <div className=\"p-4 bg-red-50 border border-red-200 rounded-md\" role=\"alert\">\n          <p className=\"text-sm text-red-800\">{error}</p>\n        </div>\n      )}\n\n      {/* Sections list */}\n      {sections.length === 0 ? (\n        <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n          <p className=\"text-gray-500 mb-4\">No sections yet</p>\n          <Button onClick={handleAddSection} disabled={saving} variant=\"primary\" size=\"sm\">\n            Create First Section\n          </Button>\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {sections.map((section, index) => (\n            <div\n              key={section.id}\n              draggable\n              onDragStart={() => handleDragStart(section.id)}\n              onDragOver={handleDragOver}\n              onDrop={() => handleDrop(section.id)}\n              className={`border border-gray-200 rounded-lg bg-white shadow-sm transition-opacity ${\n                draggedSection === section.id ? 'opacity-50' : ''\n              }`}\n            >\n              {/* Section header - always visible */}\n              <div className=\"flex items-center justify-between p-4 hover:bg-gray-50\">\n                <div className=\"flex items-center gap-3 flex-1\">\n                  {/* Drag handle */}\n                  <div className=\"cursor-move text-gray-400 hover:text-gray-600\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n                      <circle cx=\"4\" cy=\"4\" r=\"1.5\" />\n                      <circle cx=\"4\" cy=\"8\" r=\"1.5\" />\n                      <circle cx=\"4\" cy=\"12\" r=\"1.5\" />\n                      <circle cx=\"8\" cy=\"4\" r=\"1.5\" />\n                      <circle cx=\"8\" cy=\"8\" r=\"1.5\" />\n                      <circle cx=\"8\" cy=\"12\" r=\"1.5\" />\n                    </svg>\n                  </div>\n                  \n                  {/* Section number and layout info */}\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-semibold text-gray-900\">#{index + 1}</span>\n                      {section.title && (\n                        <span className=\"text-gray-900\">{section.title}</span>\n                      )}\n                      <span className=\"text-sm text-gray-500\">\n                        {section.columns.length === 1 ? 'One Column' : 'Two Columns'}\n                      </span>\n                    </div>\n                    {section.columns.length > 0 && (\n                      <div className=\"text-xs text-gray-500 mt-1\">\n                        {section.columns.map((col, idx) => (\n                          <span key={col.id}>\n                            {idx > 0 && ' • '}\n                            {col.content_type === 'rich_text' && 'Rich Text'}\n                            {col.content_type === 'photo_gallery' && 'Photo Gallery'}\n                            {col.content_type === 'references' && 'References'}\n                          </span>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Action buttons */}\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"secondary\"\n                    onClick={() => setViewingSection(viewingSection === section.id ? null : section.id)}\n                  >\n                    {viewingSection === section.id ? 'Hide' : 'View'}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"secondary\"\n                    onClick={() => setEditingSection(editingSection === section.id ? null : section.id)}\n                  >\n                    {editingSection === section.id ? 'Close' : 'Edit'}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"danger\"\n                    onClick={() => handleDeleteSection(section.id)}\n                    disabled={saving}\n                  >\n                    Delete\n                  </Button>\n                </div>\n              </div>\n\n              {/* View mode - show content preview */}\n              {viewingSection === section.id && (\n                <div className=\"border-t border-gray-200 p-4 bg-gray-50\">\n                  <div className={`grid gap-4 ${section.columns.length === 2 ? 'grid-cols-2' : 'grid-cols-1'}`}>\n                    {section.columns.map(column => (\n                      <div key={column.id} className=\"bg-white rounded p-4 border border-gray-200\">\n                        <div className=\"text-xs font-medium text-gray-500 mb-2\">\n                          Column {column.column_number}\n                        </div>\n                        {column.content_type === 'rich_text' && (\n                          <div\n                            className=\"prose prose-sm max-w-none\"\n                            dangerouslySetInnerHTML={{\n                              __html: (column.content_data as any).html || '<p class=\"text-gray-400\">No content</p>',\n                            }}\n                          />\n                        )}\n                        {column.content_type === 'photo_gallery' && (\n                          <div className=\"text-sm text-gray-600\">\n                            {((column.content_data as any).photo_ids || []).length} photo(s)\n                          </div>\n                        )}\n                        {column.content_type === 'references' && (\n                          <div className=\"text-sm text-gray-600\">\n                            {((column.content_data as any).references || []).length} reference(s)\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Edit mode - show editing interface */}\n              {editingSection === section.id && (\n                <div className=\"border-t border-gray-200 p-4 bg-white space-y-4\">\n                  {/* Section title input */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Section Title (optional)\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={section.title || ''}\n                      onChange={(e) => handleTitleChange(section.id, e.target.value)}\n                      placeholder=\"Enter a title for this section...\"\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                      disabled={saving}\n                    />\n                  </div>\n\n                  {/* Layout selector */}\n                  <div className=\"flex items-center gap-4\">\n                    <label className=\"text-sm font-medium text-gray-700\">Layout:</label>\n                    <select\n                      value={section.columns.length === 1 ? 'one-column' : 'two-column'}\n                      onChange={(e) => handleToggleLayout(section.id)}\n                      className=\"text-sm border border-gray-300 rounded px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                      disabled={saving}\n                    >\n                      <option value=\"one-column\">One Column</option>\n                      <option value=\"two-column\">Two Columns</option>\n                    </select>\n                  </div>\n\n                  {/* Column editors */}\n                  <div className={`grid gap-4 ${section.columns.length === 2 ? 'grid-cols-2' : 'grid-cols-1'}`}>\n                    {section.columns.map(column => (\n                      <div key={column.id} className=\"border border-gray-200 rounded-lg p-4 bg-gray-50\">\n                        {/* Column header with type selector */}\n                        <div className=\"flex items-center justify-between mb-3\">\n                          <div className=\"text-sm font-medium text-gray-700\">\n                            Column {column.column_number}\n                          </div>\n                          <select\n                            value={column.content_type}\n                            onChange={(e) => handleColumnTypeChange(section.id, column.id, e.target.value as any)}\n                            className=\"text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                            disabled={saving}\n                          >\n                            <option value=\"rich_text\">Rich Text</option>\n                            <option value=\"photo_gallery\">Photo Gallery</option>\n                            <option value=\"references\">References</option>\n                          </select>\n                        </div>\n\n                        {/* Column content editor */}\n                        <div className=\"bg-white rounded border border-gray-200 p-3\">\n                          {column.content_type === 'rich_text' && (\n                            <RichTextEditor\n                              value={(column.content_data as any).html || ''}\n                              onChange={(html) => handleColumnContentChange(section.id, column.id, { html })}\n                              placeholder=\"Start typing...\"\n                              disabled={saving}\n                              pageType={\n                                pageType === 'home' ? 'memory' :\n                                pageType === 'custom' ? 'memory' :\n                                pageType === 'room_type' ? 'accommodation' :\n                                pageType\n                              }\n                              pageId={pageId}\n                            />\n                          )}\n                          {column.content_type === 'photo_gallery' && (\n                            <div className=\"space-y-3\">\n                              {/* Display mode selector */}\n                              <div>\n                                <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n                                  Display Mode\n                                </label>\n                                <select\n                                  value={(column.content_data as any).display_mode || 'gallery'}\n                                  onChange={(e) => {\n                                    const currentData = column.content_data as any;\n                                    handleColumnContentChange(section.id, column.id, {\n                                      photo_ids: currentData.photo_ids || [],\n                                      display_mode: e.target.value,\n                                    });\n                                  }}\n                                  className=\"w-full text-sm border border-gray-300 rounded px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                                  disabled={saving}\n                                >\n                                  <option value=\"gallery\">Gallery Grid</option>\n                                  <option value=\"carousel\">Carousel</option>\n                                  <option value=\"loop\">Auto-play Loop</option>\n                                </select>\n                              </div>\n                              \n                              {/* Photo picker */}\n                              <PhotoPicker\n                                selectedPhotoIds={(column.content_data as any).photo_ids || []}\n                                onSelectionChange={(photoIds) => {\n                                  const currentData = column.content_data as any;\n                                  handleColumnContentChange(section.id, column.id, {\n                                    photo_ids: photoIds,\n                                    display_mode: currentData.display_mode || 'gallery',\n                                  });\n                                }}\n                                pageType={\n                                  pageType === 'home' ? 'memory' :\n                                  pageType === 'custom' ? 'memory' :\n                                  pageType === 'room_type' ? 'accommodation' :\n                                  pageType\n                                }\n                                pageId={pageId}\n                                disabled={saving}\n                              />\n                            </div>\n                          )}\n                          {column.content_type === 'references' && (\n                            <div className=\"text-gray-500 text-sm text-center py-4\">\n                              References ({(column.content_data as any).references?.length || 0} items)\n                              <div className=\"text-xs mt-2\">Reference lookup coming soon</div>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Guest Preview - collapsible section */}\n      <div className=\"border border-gray-200 rounded-lg bg-white\">\n        <button\n          onClick={() => setShowPreview(!showPreview)}\n          className=\"w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors\"\n        >\n          <span className=\"font-semibold text-gray-900\">Guest Preview</span>\n          <span className=\"text-gray-500\">{showPreview ? '▼' : '▶'}</span>\n        </button>\n        \n        {showPreview && (\n          <div className=\"border-t border-gray-200 p-6 space-y-6\">\n            {sections.length === 0 ? (\n              <p className=\"text-gray-500 text-center\">No sections to preview</p>\n            ) : (\n              sections.map((section, index) => (\n                <div key={section.id} className=\"space-y-2\">\n                  <div className=\"text-xs font-medium text-gray-400 uppercase tracking-wide\">\n                    Section {index + 1}\n                  </div>\n                  <div className={`grid gap-6 ${section.columns.length === 2 ? 'grid-cols-2' : 'grid-cols-1'}`}>\n                    {section.columns.map(column => (\n                      <div key={column.id}>\n                        {column.content_type === 'rich_text' && (\n                          <div\n                            className=\"prose max-w-none\"\n                            dangerouslySetInnerHTML={{\n                              __html: (column.content_data as any).html || '',\n                            }}\n                          />\n                        )}\n                        {column.content_type === 'photo_gallery' && (\n                          <PhotoGalleryPreview\n                            photoIds={(column.content_data as any).photo_ids || []}\n                            displayMode={(column.content_data as any).display_mode || 'gallery'}\n                          />\n                        )}\n                        {column.content_type === 'references' && (\n                          <div className=\"text-gray-500 text-sm\">\n                            [References Preview]\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":["SectionEditor","PhotoPicker","dynamic","then","mod","default","loading","PhotoGallerySkeleton","ssr","PhotoGalleryPreview","photoIds","displayMode","photos","setPhotos","useState","setLoading","useEffect","fetchPhotos","length","photoPromises","map","id","response","fetch","ok","result","json","success","data","fetchedPhotos","Promise","all","validPhotos","filter","p","err","console","error","div","className","modeLabel","photo","Image","src","photo_url","alt","caption","fill","sizes","pageType","pageId","onSave","onClose","sections","setSections","saving","setSaving","setError","editingSection","setEditingSection","viewingSection","setViewingSection","draggedSection","setDraggedSection","showPreview","setShowPreview","fetchSections","useCallback","message","handleAddSection","newSection","page_type","page_id","display_order","columns","column_number","content_type","content_data","html","method","headers","body","JSON","stringify","prev","handleDeleteSection","sectionId","confirm","s","handleTitleChange","title","handleToggleLayout","section","find","currentLayout","newLayout","updatedColumns","handleColumnTypeChange","columnId","newType","col","contentData","photo_ids","display_mode","references","handleColumnContentChange","handleDragStart","handleDragOver","e","preventDefault","handleDrop","targetSectionId","draggedIndex","findIndex","targetIndex","newSections","removed","splice","updatedSections","index","sectionIds","handleMoveUp","i","handleMoveDown","handleSaveAll","handlePreview","data-testid","h2","span","svg","xmlns","viewBox","circle","cx","cy","r","stroke","strokeWidth","path","d","strokeLinecap","strokeLinejoin","Button","onClick","disabled","size","variant","role","draggable","onDragStart","onDragOver","onDrop","width","height","idx","column","dangerouslySetInnerHTML","__html","label","input","type","value","onChange","target","placeholder","select","option","RichTextEditor","currentData","selectedPhotoIds","onSelectionChange","button"],"mappings":"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"}