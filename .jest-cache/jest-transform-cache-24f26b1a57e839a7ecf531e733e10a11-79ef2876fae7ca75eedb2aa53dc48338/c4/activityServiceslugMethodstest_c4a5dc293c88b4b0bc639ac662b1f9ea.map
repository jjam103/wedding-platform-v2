{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/activityService.slugMethods.test.ts"],"sourcesContent":["/**\n * Unit Tests for Activity Service Slug Methods\n * \n * Tests the slug-related functionality in activityService including:\n * - getBySlug method\n * - Slug generation on create\n * - Slug preservation on update\n * - Slug validation\n */\n\nimport { create, update, getBySlug, deleteActivity } from './activityService';\n\ndescribe('activityService - Slug Methods', () => {\n  // Clean up test activities after each test\n  const createdActivityIds: string[] = [];\n\n  afterEach(async () => {\n    // Clean up all created activities\n    for (const id of createdActivityIds) {\n      await deleteActivity(id);\n    }\n    createdActivityIds.length = 0;\n  });\n\n  describe('getBySlug', () => {\n    it('should retrieve activity by slug', async () => {\n      // Create activity\n      const createResult = await create({\n        name: 'Beach Volleyball',\n        activityType: 'activity',\n        startTime: '2025-06-15T10:00:00Z',\n      });\n\n      expect(createResult.success).toBe(true);\n      if (!createResult.success) return;\n\n      createdActivityIds.push(createResult.data.id);\n      const slug = createResult.data.slug;\n\n      // Retrieve by slug\n      const getResult = await getBySlug(slug);\n\n      expect(getResult.success).toBe(true);\n      if (!getResult.success) return;\n\n      expect(getResult.data.id).toBe(createResult.data.id);\n      expect(getResult.data.name).toBe('Beach Volleyball');\n      expect(getResult.data.slug).toBe(slug);\n    });\n\n    it('should return NOT_FOUND for non-existent slug', async () => {\n      const result = await getBySlug('non-existent-activity-slug');\n\n      expect(result.success).toBe(false);\n      if (result.success) return;\n\n      expect(result.error.code).toBe('NOT_FOUND');\n    });\n\n    it('should return VALIDATION_ERROR for empty slug', async () => {\n      const result = await getBySlug('');\n\n      expect(result.success).toBe(false);\n      if (result.success) return;\n\n      expect(result.error.code).toBe('VALIDATION_ERROR');\n    });\n  });\n\n  describe('Slug Generation on Create', () => {\n    it('should generate slug from activity name', async () => {\n      const result = await create({\n        name: 'Sunset Cruise',\n        activityType: 'activity',\n        startTime: '2025-06-15T18:00:00Z',\n      });\n\n      expect(result.success).toBe(true);\n      if (!result.success) return;\n\n      createdActivityIds.push(result.data.id);\n\n      expect(result.data.slug).toBe('sunset-cruise');\n    });\n\n    it('should generate URL-safe slug from name with special characters', async () => {\n      const result = await create({\n        name: 'Yoga & Meditation Session!',\n        activityType: 'activity',\n        startTime: '2025-06-15T07:00:00Z',\n      });\n\n      expect(result.success).toBe(true);\n      if (!result.success) return;\n\n      createdActivityIds.push(result.data.id);\n\n      // Special characters should be removed\n      expect(result.data.slug).toMatch(/^[a-z0-9-]+$/);\n      expect(result.data.slug).not.toContain('&');\n      expect(result.data.slug).not.toContain('!');\n    });\n\n    it('should generate unique slugs for duplicate names', async () => {\n      // Create first activity\n      const result1 = await create({\n        name: 'Snorkeling',\n        activityType: 'activity',\n        startTime: '2025-06-15T09:00:00Z',\n      });\n\n      expect(result1.success).toBe(true);\n      if (!result1.success) return;\n\n      createdActivityIds.push(result1.data.id);\n\n      // Create second activity with same name\n      const result2 = await create({\n        name: 'Snorkeling',\n        activityType: 'activity',\n        startTime: '2025-06-15T14:00:00Z',\n      });\n\n      expect(result2.success).toBe(true);\n      if (!result2.success) return;\n\n      createdActivityIds.push(result2.data.id);\n\n      // Slugs should be different\n      expect(result1.data.slug).toBe('snorkeling');\n      expect(result2.data.slug).toBe('snorkeling-2');\n    });\n\n    it('should return VALIDATION_ERROR for name with no alphanumeric characters', async () => {\n      const result = await create({\n        name: '---',\n        activityType: 'activity',\n        startTime: '2025-06-15T10:00:00Z',\n      });\n\n      expect(result.success).toBe(false);\n      if (result.success) return;\n\n      expect(result.error.code).toBe('VALIDATION_ERROR');\n      expect(result.error.message).toContain('alphanumeric character');\n    });\n\n    it('should handle names with multiple spaces', async () => {\n      const result = await create({\n        name: 'Zip    Line    Adventure',\n        activityType: 'activity',\n        startTime: '2025-06-16T11:00:00Z',\n      });\n\n      expect(result.success).toBe(true);\n      if (!result.success) return;\n\n      createdActivityIds.push(result.data.id);\n\n      // Multiple spaces should be collapsed to single hyphens\n      expect(result.data.slug).toBe('zip-line-adventure');\n      expect(result.data.slug).not.toContain('--');\n    });\n  });\n\n  describe('Slug Preservation on Update', () => {\n    it('should preserve slug when updating activity name', async () => {\n      // Create activity\n      const createResult = await create({\n        name: 'Original Activity',\n        activityType: 'activity',\n        startTime: '2025-06-15T10:00:00Z',\n      });\n\n      expect(createResult.success).toBe(true);\n      if (!createResult.success) return;\n\n      createdActivityIds.push(createResult.data.id);\n      const originalSlug = createResult.data.slug;\n\n      // Update name\n      const updateResult = await update(createResult.data.id, {\n        name: 'Updated Activity',\n      });\n\n      expect(updateResult.success).toBe(true);\n      if (!updateResult.success) return;\n\n      // Slug should remain unchanged\n      expect(updateResult.data.slug).toBe(originalSlug);\n      expect(updateResult.data.name).toBe('Updated Activity');\n    });\n\n    it('should preserve slug when updating description', async () => {\n      // Create activity\n      const createResult = await create({\n        name: 'Test Activity',\n        activityType: 'activity',\n        startTime: '2025-06-15T10:00:00Z',\n        description: 'Original description',\n      });\n\n      expect(createResult.success).toBe(true);\n      if (!createResult.success) return;\n\n      createdActivityIds.push(createResult.data.id);\n      const originalSlug = createResult.data.slug;\n\n      // Update description\n      const updateResult = await update(createResult.data.id, {\n        description: 'Updated description',\n      });\n\n      expect(updateResult.success).toBe(true);\n      if (!updateResult.success) return;\n\n      // Slug should remain unchanged\n      expect(updateResult.data.slug).toBe(originalSlug);\n    });\n\n    it('should preserve slug across multiple updates', async () => {\n      // Create activity\n      const createResult = await create({\n        name: 'Initial Activity',\n        activityType: 'activity',\n        startTime: '2025-06-15T10:00:00Z',\n      });\n\n      expect(createResult.success).toBe(true);\n      if (!createResult.success) return;\n\n      createdActivityIds.push(createResult.data.id);\n      const originalSlug = createResult.data.slug;\n\n      // Update name multiple times\n      const names = ['First Update', 'Second Update', 'Third Update'];\n      for (const name of names) {\n        const updateResult = await update(createResult.data.id, { name });\n\n        expect(updateResult.success).toBe(true);\n        if (!updateResult.success) continue;\n\n        expect(updateResult.data.slug).toBe(originalSlug);\n      }\n    });\n  });\n\n  describe('Slug Validation', () => {\n    it('should accept valid slug patterns', async () => {\n      const validNames = [\n        'simple-activity',\n        'activity-with-numbers-123',\n        'a',\n        'activity-2',\n      ];\n\n      for (const name of validNames) {\n        const result = await create({\n          name,\n          activityType: 'activity',\n          startTime: '2025-06-15T10:00:00Z',\n        });\n\n        expect(result.success).toBe(true);\n        if (!result.success) continue;\n\n        createdActivityIds.push(result.data.id);\n        expect(result.data.slug).toMatch(/^[a-z0-9-]+$/);\n      }\n    });\n\n    it('should handle unicode characters in names', async () => {\n      const result = await create({\n        name: 'Pi√±a Colada Making',\n        activityType: 'activity',\n        startTime: '2025-06-15T16:00:00Z',\n      });\n\n      expect(result.success).toBe(true);\n      if (!result.success) return;\n\n      createdActivityIds.push(result.data.id);\n\n      // Unicode should be removed, leaving only ASCII\n      expect(result.data.slug).toMatch(/^[a-z0-9-]+$/);\n      expect(result.data.slug).not.toMatch(/[^\\x00-\\x7F]/);\n    });\n  });\n});\n"],"names":["describe","createdActivityIds","afterEach","id","deleteActivity","length","it","createResult","create","name","activityType","startTime","expect","success","toBe","push","data","slug","getResult","getBySlug","result","error","code","toMatch","not","toContain","result1","result2","message","originalSlug","updateResult","update","description","names","validNames"],"mappings":"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"}