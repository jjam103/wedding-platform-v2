256f40606c9dcfe7f389504d1ce8911f
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get createSetting () {
        return createSetting;
    },
    get deleteSetting () {
        return deleteSetting;
    },
    get getDefaultAuthMethod () {
        return getDefaultAuthMethod;
    },
    get getSetting () {
        return getSetting;
    },
    get getSettings () {
        return getSettings;
    },
    get getSettingsByCategory () {
        return getSettingsByCategory;
    },
    get updateDefaultAuthMethod () {
        return updateDefaultAuthMethod;
    },
    get updateSetting () {
        return updateSetting;
    },
    get upsertHomePageConfig () {
        return upsertHomePageConfig;
    },
    get upsertSetting () {
        return upsertSetting;
    }
});
const _settingsSchemas = require("../schemas/settingsSchemas");
// Lazy load supabase to avoid initialization issues in tests
let _supabase = null;
function getSupabase() {
    if (!_supabase) {
        const { supabase } = require('../lib/supabase');
        _supabase = supabase;
    }
    return _supabase;
}
async function getSetting(key) {
    try {
        const supabase = getSupabase();
        const { data, error } = await supabase.from('system_settings').select('value').eq('key', key).single();
        if (error) {
            if (error.code === 'PGRST116') {
                return {
                    success: false,
                    error: {
                        code: 'NOT_FOUND',
                        message: `Setting '${key}' not found`
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: data.value
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function getSettings() {
    try {
        const supabase = getSupabase();
        const { data, error } = await supabase.from('system_settings').select('*').order('category', {
            ascending: true
        }).order('key', {
            ascending: true
        });
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: data || []
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function getSettingsByCategory(category) {
    try {
        const supabase = getSupabase();
        const { data, error } = await supabase.from('system_settings').select('*').eq('category', category).order('key', {
            ascending: true
        });
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: data || []
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function updateSetting(key, value) {
    try {
        const supabase = getSupabase();
        // Check if setting exists
        const { data: existing } = await supabase.from('system_settings').select('id').eq('key', key).single();
        let result;
        if (existing) {
            // Update existing setting
            const { data: updated, error } = await supabase.from('system_settings').update({
                value,
                updated_at: new Date().toISOString()
            }).eq('key', key).select().single();
            if (error) {
                return {
                    success: false,
                    error: {
                        code: 'DATABASE_ERROR',
                        message: error.message,
                        details: error
                    }
                };
            }
            result = updated;
        } else {
            return {
                success: false,
                error: {
                    code: 'NOT_FOUND',
                    message: `Setting '${key}' not found`
                }
            };
        }
        return {
            success: true,
            data: result
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function createSetting(key, value, description, category = 'general', isPublic = false) {
    try {
        const supabase = getSupabase();
        const { data, error } = await supabase.from('system_settings').insert({
            key,
            value,
            description,
            category,
            is_public: isPublic
        }).select().single();
        if (error) {
            if (error.code === '23505') {
                // Unique constraint violation
                return {
                    success: false,
                    error: {
                        code: 'CONFLICT',
                        message: `Setting '${key}' already exists`
                    }
                };
            }
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function deleteSetting(key) {
    try {
        const supabase = getSupabase();
        const { error } = await supabase.from('system_settings').delete().eq('key', key);
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data: undefined
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function upsertSetting(key, value, description, category = 'general', isPublic = false) {
    try {
        const supabase = getSupabase();
        // Use Supabase upsert with conflict resolution on key
        const { data, error } = await supabase.from('system_settings').upsert({
            key,
            value,
            description,
            category,
            is_public: isPublic,
            updated_at: new Date().toISOString()
        }, {
            onConflict: 'key',
            ignoreDuplicates: false
        }).select().single();
        if (error) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: error.message,
                    details: error
                }
            };
        }
        return {
            success: true,
            data
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function upsertHomePageConfig(config) {
    try {
        // Validate input
        const validation = _settingsSchemas.homePageConfigSchema.safeParse(config);
        if (!validation.success) {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: 'Invalid home page configuration',
                    details: validation.error.issues
                }
            };
        }
        const validatedConfig = validation.data;
        const updates = [];
        // Upsert each setting individually
        if (validatedConfig.title !== undefined) {
            updates.push(upsertSetting('home_page_title', validatedConfig.title, 'Home page title', 'home_page', true));
        }
        if (validatedConfig.subtitle !== undefined) {
            updates.push(upsertSetting('home_page_subtitle', validatedConfig.subtitle, 'Home page subtitle', 'home_page', true));
        }
        if (validatedConfig.welcomeMessage !== undefined) {
            updates.push(upsertSetting('home_page_welcome_message', validatedConfig.welcomeMessage, 'Home page welcome message', 'home_page', true));
        }
        if (validatedConfig.heroImageUrl !== undefined) {
            updates.push(upsertSetting('home_page_hero_image_url', validatedConfig.heroImageUrl, 'Home page hero image URL', 'home_page', true));
        }
        // Execute all upserts
        const results = await Promise.all(updates);
        // Check if any upserts failed
        const failures = results.filter((r)=>!r.success);
        if (failures.length > 0) {
            return {
                success: false,
                error: {
                    code: 'DATABASE_ERROR',
                    message: 'Failed to update some home page settings',
                    details: failures.map((f)=>f.error)
                }
            };
        }
        // Return the validated config
        return {
            success: true,
            data: validatedConfig
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function getDefaultAuthMethod() {
    try {
        const result = await getSetting('default_auth_method');
        if (!result.success) {
            // If setting doesn't exist, return default value
            if (result.error.code === 'NOT_FOUND') {
                return {
                    success: true,
                    data: 'email_matching'
                };
            }
            return result;
        }
        // Validate the value
        const value = result.data;
        if (value !== 'email_matching' && value !== 'magic_link') {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: `Invalid auth method value: ${value}`
                }
            };
        }
        return {
            success: true,
            data: value
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}
async function updateDefaultAuthMethod(method, updateExistingGuests = false) {
    try {
        const supabase = getSupabase();
        // Validate method
        if (method !== 'email_matching' && method !== 'magic_link') {
            return {
                success: false,
                error: {
                    code: 'VALIDATION_ERROR',
                    message: `Invalid auth method: ${method}`
                }
            };
        }
        // Update the default_auth_method setting
        const settingResult = await upsertSetting('default_auth_method', method, 'Default authentication method for new guests', 'authentication', false);
        if (!settingResult.success) {
            return {
                success: false,
                error: settingResult.error
            };
        }
        let updatedGuestsCount = 0;
        // If requested, update all existing guests
        if (updateExistingGuests) {
            const { data, error } = await supabase.from('guests').update({
                auth_method: method
            }).neq('auth_method', method) // Only update guests with different auth method
            .select('id');
            if (error) {
                return {
                    success: false,
                    error: {
                        code: 'DATABASE_ERROR',
                        message: 'Failed to update existing guests',
                        details: error
                    }
                };
            }
            updatedGuestsCount = data?.length || 0;
        }
        return {
            success: true,
            data: {
                updatedGuestsCount
            }
        };
    } catch (error) {
        return {
            success: false,
            error: {
                code: 'UNKNOWN_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error'
            }
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvc2VydmljZXMvc2V0dGluZ3NTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIHN5c3RlbVNldHRpbmdzU2NoZW1hLFxuICB1cGRhdGVTeXN0ZW1TZXR0aW5nc1NjaGVtYSxcbiAgaG9tZVBhZ2VDb25maWdTY2hlbWEsXG4gIHR5cGUgU3lzdGVtU2V0dGluZ3MsXG4gIHR5cGUgVXBkYXRlU3lzdGVtU2V0dGluZ3NEVE8sXG4gIHR5cGUgSG9tZVBhZ2VDb25maWcsXG59IGZyb20gJy4uL3NjaGVtYXMvc2V0dGluZ3NTY2hlbWFzJztcblxudHlwZSBSZXN1bHQ8VD4gPVxuICB8IHsgc3VjY2VzczogdHJ1ZTsgZGF0YTogVCB9XG4gIHwgeyBzdWNjZXNzOiBmYWxzZTsgZXJyb3I6IHsgY29kZTogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmc7IGRldGFpbHM/OiBhbnkgfSB9O1xuXG5pbnRlcmZhY2UgU2V0dGluZ1JvdyB7XG4gIGlkOiBzdHJpbmc7XG4gIGtleTogc3RyaW5nO1xuICB2YWx1ZTogYW55O1xuICBkZXNjcmlwdGlvbjogc3RyaW5nIHwgbnVsbDtcbiAgY2F0ZWdvcnk6IHN0cmluZztcbiAgaXNfcHVibGljOiBib29sZWFuO1xuICBjcmVhdGVkX2F0OiBzdHJpbmc7XG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcbn1cblxuLy8gTGF6eSBsb2FkIHN1cGFiYXNlIHRvIGF2b2lkIGluaXRpYWxpemF0aW9uIGlzc3VlcyBpbiB0ZXN0c1xubGV0IF9zdXBhYmFzZTogYW55ID0gbnVsbDtcbmZ1bmN0aW9uIGdldFN1cGFiYXNlKCkge1xuICBpZiAoIV9zdXBhYmFzZSkge1xuICAgIGNvbnN0IHsgc3VwYWJhc2UgfSA9IHJlcXVpcmUoJy4uL2xpYi9zdXBhYmFzZScpO1xuICAgIF9zdXBhYmFzZSA9IHN1cGFiYXNlO1xuICB9XG4gIHJldHVybiBfc3VwYWJhc2U7XG59XG5cbi8qKlxuICogR2V0cyBhIHNpbmdsZSBzZXR0aW5nIGJ5IGtleVxuICogXG4gKiBAcGFyYW0ga2V5IC0gU2V0dGluZyBrZXlcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIHRoZSBzZXR0aW5nIHZhbHVlIG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNldHRpbmcoa2V5OiBzdHJpbmcpOiBQcm9taXNlPFJlc3VsdDxhbnk+PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpO1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnc3lzdGVtX3NldHRpbmdzJylcbiAgICAgIC5zZWxlY3QoJ3ZhbHVlJylcbiAgICAgIC5lcSgna2V5Jywga2V5KVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBTZXR0aW5nICcke2tleX0nIG5vdCBmb3VuZGAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBkYXRhLnZhbHVlIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldHMgYWxsIHN5c3RlbSBzZXR0aW5nc1xuICogXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyBhbGwgc2V0dGluZ3Mgb3IgZXJyb3IgZGV0YWlsc1xuICogXG4gKiBAZXhhbXBsZVxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2V0dGluZ3NTZXJ2aWNlLmdldFNldHRpbmdzKCk7XG4gKiBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAqICAgY29uc29sZS5sb2cocmVzdWx0LmRhdGEpO1xuICogfVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoKTogUHJvbWlzZTxSZXN1bHQ8U2V0dGluZ1Jvd1tdPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3N5c3RlbV9zZXR0aW5ncycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5vcmRlcignY2F0ZWdvcnknLCB7IGFzY2VuZGluZzogdHJ1ZSB9KVxuICAgICAgLm9yZGVyKCdrZXknLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBkYXRhIHx8IFtdIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldHMgc2V0dGluZ3MgYnkgY2F0ZWdvcnlcbiAqIFxuICogQHBhcmFtIGNhdGVnb3J5IC0gU2V0dGluZyBjYXRlZ29yeVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgc2V0dGluZ3MgaW4gdGhlIGNhdGVnb3J5IG9yIGVycm9yIGRldGFpbHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNldHRpbmdzQnlDYXRlZ29yeShjYXRlZ29yeTogc3RyaW5nKTogUHJvbWlzZTxSZXN1bHQ8U2V0dGluZ1Jvd1tdPj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3N5c3RlbV9zZXR0aW5ncycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnY2F0ZWdvcnknLCBjYXRlZ29yeSlcbiAgICAgIC5vcmRlcigna2V5JywgeyBhc2NlbmRpbmc6IHRydWUgfSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogZGF0YSB8fCBbXSB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBVcGRhdGVzIGEgc2luZ2xlIHNldHRpbmdcbiAqIFxuICogQHBhcmFtIGtleSAtIFNldHRpbmcga2V5XG4gKiBAcGFyYW0gdmFsdWUgLSBOZXcgdmFsdWUgKHdpbGwgYmUgc3RvcmVkIGFzIEpTT05CKVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgdGhlIHVwZGF0ZWQgc2V0dGluZyBvciBlcnJvciBkZXRhaWxzXG4gKiBcbiAqIEBleGFtcGxlXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXR0aW5nc1NlcnZpY2UudXBkYXRlU2V0dGluZygnd2VkZGluZ19kYXRlJywgJzIwMjQtMDYtMTUnKTtcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmcoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiBQcm9taXNlPFJlc3VsdDxTZXR0aW5nUm93Pj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2UoKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBzZXR0aW5nIGV4aXN0c1xuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnc3lzdGVtX3NldHRpbmdzJylcbiAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgIC5lcSgna2V5Jywga2V5KVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgbGV0IHJlc3VsdDtcbiAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBzZXR0aW5nXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnc3lzdGVtX3NldHRpbmdzJylcbiAgICAgICAgLnVwZGF0ZSh7IHZhbHVlLCB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSlcbiAgICAgICAgLmVxKCdrZXknLCBrZXkpXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnREFUQUJBU0VfRVJST1InLFxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdCA9IHVwZGF0ZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICAgIG1lc3NhZ2U6IGBTZXR0aW5nICcke2tleX0nIG5vdCBmb3VuZGAsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHJlc3VsdCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHNldHRpbmdcbiAqIFxuICogQHBhcmFtIGtleSAtIFNldHRpbmcga2V5IChtdXN0IGJlIHVuaXF1ZSlcbiAqIEBwYXJhbSB2YWx1ZSAtIFNldHRpbmcgdmFsdWUgKHdpbGwgYmUgc3RvcmVkIGFzIEpTT05CKVxuICogQHBhcmFtIGRlc2NyaXB0aW9uIC0gT3B0aW9uYWwgZGVzY3JpcHRpb25cbiAqIEBwYXJhbSBjYXRlZ29yeSAtIFNldHRpbmcgY2F0ZWdvcnkgKGRlZmF1bHQ6ICdnZW5lcmFsJylcbiAqIEBwYXJhbSBpc1B1YmxpYyAtIFdoZXRoZXIgdGhlIHNldHRpbmcgaXMgcHVibGljbHkgcmVhZGFibGUgKGRlZmF1bHQ6IGZhbHNlKVxuICogQHJldHVybnMgUmVzdWx0IGNvbnRhaW5pbmcgdGhlIGNyZWF0ZWQgc2V0dGluZyBvciBlcnJvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVTZXR0aW5nKFxuICBrZXk6IHN0cmluZyxcbiAgdmFsdWU6IGFueSxcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmcsXG4gIGNhdGVnb3J5OiBzdHJpbmcgPSAnZ2VuZXJhbCcsXG4gIGlzUHVibGljOiBib29sZWFuID0gZmFsc2Vcbik6IFByb21pc2U8UmVzdWx0PFNldHRpbmdSb3c+PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpO1xuICAgIFxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnc3lzdGVtX3NldHRpbmdzJylcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICBrZXksXG4gICAgICAgIHZhbHVlLFxuICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgIGlzX3B1YmxpYzogaXNQdWJsaWMsXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XG4gICAgICAgIC8vIFVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnQ09ORkxJQ1QnLFxuICAgICAgICAgICAgbWVzc2FnZTogYFNldHRpbmcgJyR7a2V5fScgYWxyZWFkeSBleGlzdHNgLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YSB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBEZWxldGVzIGEgc2V0dGluZ1xuICogXG4gKiBAcGFyYW0ga2V5IC0gU2V0dGluZyBrZXlcbiAqIEByZXR1cm5zIFJlc3VsdCBpbmRpY2F0aW5nIHN1Y2Nlc3Mgb3IgZXJyb3IgZGV0YWlsc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlU2V0dGluZyhrZXk6IHN0cmluZyk6IFByb21pc2U8UmVzdWx0PHZvaWQ+PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpO1xuICAgIFxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnc3lzdGVtX3NldHRpbmdzJylcbiAgICAgIC5kZWxldGUoKVxuICAgICAgLmVxKCdrZXknLCBrZXkpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnREFUQUJBU0VfRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZGV0YWlsczogZXJyb3IsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHVuZGVmaW5lZCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBVcHNlcnRzIChjcmVhdGVzIG9yIHVwZGF0ZXMpIGEgc2luZ2xlIHNldHRpbmdcbiAqIEhhbmRsZXMgYm90aCBjcmVhdGUgYW5kIHVwZGF0ZSBpbiBhIHNpbmdsZSBvcGVyYXRpb25cbiAqIFxuICogQHBhcmFtIGtleSAtIFNldHRpbmcga2V5XG4gKiBAcGFyYW0gdmFsdWUgLSBTZXR0aW5nIHZhbHVlICh3aWxsIGJlIHN0b3JlZCBhcyBKU09OQilcbiAqIEBwYXJhbSBkZXNjcmlwdGlvbiAtIE9wdGlvbmFsIGRlc2NyaXB0aW9uICh1c2VkIG9ubHkgb24gY3JlYXRlKVxuICogQHBhcmFtIGNhdGVnb3J5IC0gU2V0dGluZyBjYXRlZ29yeSAoZGVmYXVsdDogJ2dlbmVyYWwnLCB1c2VkIG9ubHkgb24gY3JlYXRlKVxuICogQHBhcmFtIGlzUHVibGljIC0gV2hldGhlciB0aGUgc2V0dGluZyBpcyBwdWJsaWNseSByZWFkYWJsZSAoZGVmYXVsdDogZmFsc2UsIHVzZWQgb25seSBvbiBjcmVhdGUpXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB0aGUgdXBzZXJ0ZWQgc2V0dGluZyBvciBlcnJvciBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cHNlcnRTZXR0aW5nKFxuICBrZXk6IHN0cmluZyxcbiAgdmFsdWU6IGFueSxcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmcsXG4gIGNhdGVnb3J5OiBzdHJpbmcgPSAnZ2VuZXJhbCcsXG4gIGlzUHVibGljOiBib29sZWFuID0gZmFsc2Vcbik6IFByb21pc2U8UmVzdWx0PFNldHRpbmdSb3c+PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpO1xuICAgIFxuICAgIC8vIFVzZSBTdXBhYmFzZSB1cHNlcnQgd2l0aCBjb25mbGljdCByZXNvbHV0aW9uIG9uIGtleVxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnc3lzdGVtX3NldHRpbmdzJylcbiAgICAgIC51cHNlcnQoXG4gICAgICAgIHtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgICAgaXNfcHVibGljOiBpc1B1YmxpYyxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBvbkNvbmZsaWN0OiAna2V5JyxcbiAgICAgICAgICBpZ25vcmVEdXBsaWNhdGVzOiBmYWxzZSxcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YSB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdVTktOT1dOX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBVcHNlcnRzIGhvbWUgcGFnZSBjb25maWd1cmF0aW9uXG4gKiBIYW5kbGVzIGJvdGggY3JlYXRlIGFuZCB1cGRhdGUgaW4gYSBzaW5nbGUgb3BlcmF0aW9uIGZvciBhbGwgaG9tZSBwYWdlIHNldHRpbmdzXG4gKiBcbiAqIEBwYXJhbSBjb25maWcgLSBIb21lIHBhZ2UgY29uZmlndXJhdGlvbiBvYmplY3RcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIHRoZSB1cGRhdGVkIGNvbmZpZ3VyYXRpb24gb3IgZXJyb3IgZGV0YWlsc1xuICogXG4gKiBAZXhhbXBsZVxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2V0dGluZ3NTZXJ2aWNlLnVwc2VydEhvbWVQYWdlQ29uZmlnKHtcbiAqICAgdGl0bGU6ICdXZWxjb21lIHRvIE91ciBXZWRkaW5nJyxcbiAqICAgc3VidGl0bGU6ICdKb2luIHVzIGluIENvc3RhIFJpY2EnLFxuICogICB3ZWxjb21lTWVzc2FnZTogJzxwPldlIGFyZSBleGNpdGVkIHRvIGNlbGVicmF0ZSB3aXRoIHlvdSE8L3A+JyxcbiAqICAgaGVyb0ltYWdlVXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9oZXJvLmpwZycsXG4gKiB9KTtcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwc2VydEhvbWVQYWdlQ29uZmlnKFxuICBjb25maWc6IEhvbWVQYWdlQ29uZmlnXG4pOiBQcm9taXNlPFJlc3VsdDxIb21lUGFnZUNvbmZpZz4+IHtcbiAgdHJ5IHtcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dFxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBob21lUGFnZUNvbmZpZ1NjaGVtYS5zYWZlUGFyc2UoY29uZmlnKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGhvbWUgcGFnZSBjb25maWd1cmF0aW9uJyxcbiAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgdmFsaWRhdGVkQ29uZmlnID0gdmFsaWRhdGlvbi5kYXRhO1xuICAgIGNvbnN0IHVwZGF0ZXM6IFByb21pc2U8UmVzdWx0PFNldHRpbmdSb3c+PltdID0gW107XG5cbiAgICAvLyBVcHNlcnQgZWFjaCBzZXR0aW5nIGluZGl2aWR1YWxseVxuICAgIGlmICh2YWxpZGF0ZWRDb25maWcudGl0bGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdXBkYXRlcy5wdXNoKFxuICAgICAgICB1cHNlcnRTZXR0aW5nKFxuICAgICAgICAgICdob21lX3BhZ2VfdGl0bGUnLFxuICAgICAgICAgIHZhbGlkYXRlZENvbmZpZy50aXRsZSxcbiAgICAgICAgICAnSG9tZSBwYWdlIHRpdGxlJyxcbiAgICAgICAgICAnaG9tZV9wYWdlJyxcbiAgICAgICAgICB0cnVlXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHZhbGlkYXRlZENvbmZpZy5zdWJ0aXRsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB1cGRhdGVzLnB1c2goXG4gICAgICAgIHVwc2VydFNldHRpbmcoXG4gICAgICAgICAgJ2hvbWVfcGFnZV9zdWJ0aXRsZScsXG4gICAgICAgICAgdmFsaWRhdGVkQ29uZmlnLnN1YnRpdGxlLFxuICAgICAgICAgICdIb21lIHBhZ2Ugc3VidGl0bGUnLFxuICAgICAgICAgICdob21lX3BhZ2UnLFxuICAgICAgICAgIHRydWVcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAodmFsaWRhdGVkQ29uZmlnLndlbGNvbWVNZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHVwZGF0ZXMucHVzaChcbiAgICAgICAgdXBzZXJ0U2V0dGluZyhcbiAgICAgICAgICAnaG9tZV9wYWdlX3dlbGNvbWVfbWVzc2FnZScsXG4gICAgICAgICAgdmFsaWRhdGVkQ29uZmlnLndlbGNvbWVNZXNzYWdlLFxuICAgICAgICAgICdIb21lIHBhZ2Ugd2VsY29tZSBtZXNzYWdlJyxcbiAgICAgICAgICAnaG9tZV9wYWdlJyxcbiAgICAgICAgICB0cnVlXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHZhbGlkYXRlZENvbmZpZy5oZXJvSW1hZ2VVcmwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdXBkYXRlcy5wdXNoKFxuICAgICAgICB1cHNlcnRTZXR0aW5nKFxuICAgICAgICAgICdob21lX3BhZ2VfaGVyb19pbWFnZV91cmwnLFxuICAgICAgICAgIHZhbGlkYXRlZENvbmZpZy5oZXJvSW1hZ2VVcmwsXG4gICAgICAgICAgJ0hvbWUgcGFnZSBoZXJvIGltYWdlIFVSTCcsXG4gICAgICAgICAgJ2hvbWVfcGFnZScsXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgYWxsIHVwc2VydHNcbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXBkYXRlcyk7XG5cbiAgICAvLyBDaGVjayBpZiBhbnkgdXBzZXJ0cyBmYWlsZWRcbiAgICBjb25zdCBmYWlsdXJlcyA9IHJlc3VsdHMuZmlsdGVyKChyKSA9PiAhci5zdWNjZXNzKTtcbiAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0RBVEFCQVNFX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBzb21lIGhvbWUgcGFnZSBzZXR0aW5ncycsXG4gICAgICAgICAgZGV0YWlsczogZmFpbHVyZXMubWFwKChmKSA9PiBmLmVycm9yKSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHRoZSB2YWxpZGF0ZWQgY29uZmlnXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdmFsaWRhdGVkQ29uZmlnIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldHMgdGhlIGRlZmF1bHQgYXV0aGVudGljYXRpb24gbWV0aG9kIGZvciBuZXcgZ3Vlc3RzXG4gKiBcbiAqIEByZXR1cm5zIFJlc3VsdCBjb250YWluaW5nIHRoZSBkZWZhdWx0IGF1dGggbWV0aG9kIG9yIGVycm9yIGRldGFpbHNcbiAqIFxuICogQGV4YW1wbGVcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNldHRpbmdzU2VydmljZS5nZXREZWZhdWx0QXV0aE1ldGhvZCgpO1xuICogaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gKiAgIGNvbnNvbGUubG9nKCdEZWZhdWx0IGF1dGggbWV0aG9kOicsIHJlc3VsdC5kYXRhKTtcbiAqIH1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERlZmF1bHRBdXRoTWV0aG9kKCk6IFByb21pc2U8UmVzdWx0PCdlbWFpbF9tYXRjaGluZycgfCAnbWFnaWNfbGluayc+PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0U2V0dGluZygnZGVmYXVsdF9hdXRoX21ldGhvZCcpO1xuICAgIFxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIC8vIElmIHNldHRpbmcgZG9lc24ndCBleGlzdCwgcmV0dXJuIGRlZmF1bHQgdmFsdWVcbiAgICAgIGlmIChyZXN1bHQuZXJyb3IuY29kZSA9PT0gJ05PVF9GT1VORCcpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogJ2VtYWlsX21hdGNoaW5nJyB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSB0aGUgdmFsdWVcbiAgICBjb25zdCB2YWx1ZSA9IHJlc3VsdC5kYXRhO1xuICAgIGlmICh2YWx1ZSAhPT0gJ2VtYWlsX21hdGNoaW5nJyAmJiB2YWx1ZSAhPT0gJ21hZ2ljX2xpbmsnKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogYEludmFsaWQgYXV0aCBtZXRob2QgdmFsdWU6ICR7dmFsdWV9YCxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdmFsdWUgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnVU5LTk9XTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogVXBkYXRlcyB0aGUgZGVmYXVsdCBhdXRoZW50aWNhdGlvbiBtZXRob2QgZm9yIG5ldyBndWVzdHNcbiAqIE9wdGlvbmFsbHkgdXBkYXRlcyBhbGwgZXhpc3RpbmcgZ3Vlc3RzIHRvIHVzZSB0aGUgbmV3IG1ldGhvZFxuICogXG4gKiBAcGFyYW0gbWV0aG9kIC0gVGhlIGF1dGhlbnRpY2F0aW9uIG1ldGhvZCB0byBzZXQgYXMgZGVmYXVsdFxuICogQHBhcmFtIHVwZGF0ZUV4aXN0aW5nR3Vlc3RzIC0gV2hldGhlciB0byB1cGRhdGUgYWxsIGV4aXN0aW5nIGd1ZXN0cyAoZGVmYXVsdDogZmFsc2UpXG4gKiBAcmV0dXJucyBSZXN1bHQgY29udGFpbmluZyB0aGUgbnVtYmVyIG9mIHVwZGF0ZWQgZ3Vlc3RzIG9yIGVycm9yIGRldGFpbHNcbiAqIFxuICogQGV4YW1wbGVcbiAqIC8vIFVwZGF0ZSBkZWZhdWx0IG9ubHlcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNldHRpbmdzU2VydmljZS51cGRhdGVEZWZhdWx0QXV0aE1ldGhvZCgnbWFnaWNfbGluaycsIGZhbHNlKTtcbiAqIFxuICogLy8gVXBkYXRlIGRlZmF1bHQgYW5kIGFsbCBleGlzdGluZyBndWVzdHNcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNldHRpbmdzU2VydmljZS51cGRhdGVEZWZhdWx0QXV0aE1ldGhvZCgnbWFnaWNfbGluaycsIHRydWUpO1xuICogaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gKiAgIGNvbnNvbGUubG9nKGBVcGRhdGVkICR7cmVzdWx0LmRhdGEudXBkYXRlZEd1ZXN0c0NvdW50fSBndWVzdHNgKTtcbiAqIH1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZURlZmF1bHRBdXRoTWV0aG9kKFxuICBtZXRob2Q6ICdlbWFpbF9tYXRjaGluZycgfCAnbWFnaWNfbGluaycsXG4gIHVwZGF0ZUV4aXN0aW5nR3Vlc3RzOiBib29sZWFuID0gZmFsc2Vcbik6IFByb21pc2U8UmVzdWx0PHsgdXBkYXRlZEd1ZXN0c0NvdW50OiBudW1iZXIgfT4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7XG5cbiAgICAvLyBWYWxpZGF0ZSBtZXRob2RcbiAgICBpZiAobWV0aG9kICE9PSAnZW1haWxfbWF0Y2hpbmcnICYmIG1ldGhvZCAhPT0gJ21hZ2ljX2xpbmsnKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogYEludmFsaWQgYXV0aCBtZXRob2Q6ICR7bWV0aG9kfWAsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgZGVmYXVsdF9hdXRoX21ldGhvZCBzZXR0aW5nXG4gICAgY29uc3Qgc2V0dGluZ1Jlc3VsdCA9IGF3YWl0IHVwc2VydFNldHRpbmcoXG4gICAgICAnZGVmYXVsdF9hdXRoX21ldGhvZCcsXG4gICAgICBtZXRob2QsXG4gICAgICAnRGVmYXVsdCBhdXRoZW50aWNhdGlvbiBtZXRob2QgZm9yIG5ldyBndWVzdHMnLFxuICAgICAgJ2F1dGhlbnRpY2F0aW9uJyxcbiAgICAgIGZhbHNlXG4gICAgKTtcblxuICAgIGlmICghc2V0dGluZ1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHNldHRpbmdSZXN1bHQuZXJyb3IsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGxldCB1cGRhdGVkR3Vlc3RzQ291bnQgPSAwO1xuXG4gICAgLy8gSWYgcmVxdWVzdGVkLCB1cGRhdGUgYWxsIGV4aXN0aW5nIGd1ZXN0c1xuICAgIGlmICh1cGRhdGVFeGlzdGluZ0d1ZXN0cykge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2d1ZXN0cycpXG4gICAgICAgIC51cGRhdGUoeyBhdXRoX21ldGhvZDogbWV0aG9kIH0pXG4gICAgICAgIC5uZXEoJ2F1dGhfbWV0aG9kJywgbWV0aG9kKSAvLyBPbmx5IHVwZGF0ZSBndWVzdHMgd2l0aCBkaWZmZXJlbnQgYXV0aCBtZXRob2RcbiAgICAgICAgLnNlbGVjdCgnaWQnKTtcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsXG4gICAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBleGlzdGluZyBndWVzdHMnLFxuICAgICAgICAgICAgZGV0YWlsczogZXJyb3IsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgdXBkYXRlZEd1ZXN0c0NvdW50ID0gZGF0YT8ubGVuZ3RoIHx8IDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7IHVwZGF0ZWRHdWVzdHNDb3VudCB9LFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZVNldHRpbmciLCJkZWxldGVTZXR0aW5nIiwiZ2V0RGVmYXVsdEF1dGhNZXRob2QiLCJnZXRTZXR0aW5nIiwiZ2V0U2V0dGluZ3MiLCJnZXRTZXR0aW5nc0J5Q2F0ZWdvcnkiLCJ1cGRhdGVEZWZhdWx0QXV0aE1ldGhvZCIsInVwZGF0ZVNldHRpbmciLCJ1cHNlcnRIb21lUGFnZUNvbmZpZyIsInVwc2VydFNldHRpbmciLCJfc3VwYWJhc2UiLCJnZXRTdXBhYmFzZSIsInN1cGFiYXNlIiwicmVxdWlyZSIsImtleSIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsImNvZGUiLCJzdWNjZXNzIiwibWVzc2FnZSIsImRldGFpbHMiLCJ2YWx1ZSIsIkVycm9yIiwib3JkZXIiLCJhc2NlbmRpbmciLCJjYXRlZ29yeSIsImV4aXN0aW5nIiwicmVzdWx0IiwidXBkYXRlZCIsInVwZGF0ZSIsInVwZGF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJkZXNjcmlwdGlvbiIsImlzUHVibGljIiwiaW5zZXJ0IiwiaXNfcHVibGljIiwiZGVsZXRlIiwidW5kZWZpbmVkIiwidXBzZXJ0Iiwib25Db25mbGljdCIsImlnbm9yZUR1cGxpY2F0ZXMiLCJjb25maWciLCJ2YWxpZGF0aW9uIiwiaG9tZVBhZ2VDb25maWdTY2hlbWEiLCJzYWZlUGFyc2UiLCJpc3N1ZXMiLCJ2YWxpZGF0ZWRDb25maWciLCJ1cGRhdGVzIiwidGl0bGUiLCJwdXNoIiwic3VidGl0bGUiLCJ3ZWxjb21lTWVzc2FnZSIsImhlcm9JbWFnZVVybCIsInJlc3VsdHMiLCJQcm9taXNlIiwiYWxsIiwiZmFpbHVyZXMiLCJmaWx0ZXIiLCJyIiwibGVuZ3RoIiwibWFwIiwiZiIsIm1ldGhvZCIsInVwZGF0ZUV4aXN0aW5nR3Vlc3RzIiwic2V0dGluZ1Jlc3VsdCIsInVwZGF0ZWRHdWVzdHNDb3VudCIsImF1dGhfbWV0aG9kIiwibmVxIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztRQThPc0JBO2VBQUFBOztRQThEQUM7ZUFBQUE7O1FBNE5BQztlQUFBQTs7UUFoZUFDO2VBQUFBOztRQXFEQUM7ZUFBQUE7O1FBc0NBQztlQUFBQTs7UUEyYkFDO2VBQUFBOztRQWpaQUM7ZUFBQUE7O1FBOE9BQztlQUFBQTs7UUFwRUFDO2VBQUFBOzs7aUNBaFZmO0FBaUJQLDZEQUE2RDtBQUM3RCxJQUFJQyxZQUFpQjtBQUNyQixTQUFTQztJQUNQLElBQUksQ0FBQ0QsV0FBVztRQUNkLE1BQU0sRUFBRUUsUUFBUSxFQUFFLEdBQUdDLFFBQVE7UUFDN0JILFlBQVlFO0lBQ2Q7SUFDQSxPQUFPRjtBQUNUO0FBUU8sZUFBZVAsV0FBV1csR0FBVztJQUMxQyxJQUFJO1FBQ0YsTUFBTUYsV0FBV0Q7UUFDakIsTUFBTSxFQUFFSSxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1KLFNBQzNCSyxJQUFJLENBQUMsbUJBQ0xDLE1BQU0sQ0FBQyxTQUNQQyxFQUFFLENBQUMsT0FBT0wsS0FDVk0sTUFBTTtRQUVULElBQUlKLE9BQU87WUFDVCxJQUFJQSxNQUFNSyxJQUFJLEtBQUssWUFBWTtnQkFDN0IsT0FBTztvQkFDTEMsU0FBUztvQkFDVE4sT0FBTzt3QkFDTEssTUFBTTt3QkFDTkUsU0FBUyxDQUFDLFNBQVMsRUFBRVQsSUFBSSxXQUFXLENBQUM7b0JBQ3ZDO2dCQUNGO1lBQ0Y7WUFFQSxPQUFPO2dCQUNMUSxTQUFTO2dCQUNUTixPQUFPO29CQUNMSyxNQUFNO29CQUNORSxTQUFTUCxNQUFNTyxPQUFPO29CQUN0QkMsU0FBU1I7Z0JBQ1g7WUFDRjtRQUNGO1FBRUEsT0FBTztZQUFFTSxTQUFTO1lBQU1QLE1BQU1BLEtBQUtVLEtBQUs7UUFBQztJQUMzQyxFQUFFLE9BQU9ULE9BQU87UUFDZCxPQUFPO1lBQ0xNLFNBQVM7WUFDVE4sT0FBTztnQkFDTEssTUFBTTtnQkFDTkUsU0FBU1AsaUJBQWlCVSxRQUFRVixNQUFNTyxPQUFPLEdBQUc7WUFDcEQ7UUFDRjtJQUNGO0FBQ0Y7QUFhTyxlQUFlbkI7SUFDcEIsSUFBSTtRQUNGLE1BQU1RLFdBQVdEO1FBQ2pCLE1BQU0sRUFBRUksSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNSixTQUMzQkssSUFBSSxDQUFDLG1CQUNMQyxNQUFNLENBQUMsS0FDUFMsS0FBSyxDQUFDLFlBQVk7WUFBRUMsV0FBVztRQUFLLEdBQ3BDRCxLQUFLLENBQUMsT0FBTztZQUFFQyxXQUFXO1FBQUs7UUFFbEMsSUFBSVosT0FBTztZQUNULE9BQU87Z0JBQ0xNLFNBQVM7Z0JBQ1ROLE9BQU87b0JBQ0xLLE1BQU07b0JBQ05FLFNBQVNQLE1BQU1PLE9BQU87b0JBQ3RCQyxTQUFTUjtnQkFDWDtZQUNGO1FBQ0Y7UUFFQSxPQUFPO1lBQUVNLFNBQVM7WUFBTVAsTUFBTUEsUUFBUSxFQUFFO1FBQUM7SUFDM0MsRUFBRSxPQUFPQyxPQUFPO1FBQ2QsT0FBTztZQUNMTSxTQUFTO1lBQ1ROLE9BQU87Z0JBQ0xLLE1BQU07Z0JBQ05FLFNBQVNQLGlCQUFpQlUsUUFBUVYsTUFBTU8sT0FBTyxHQUFHO1lBQ3BEO1FBQ0Y7SUFDRjtBQUNGO0FBUU8sZUFBZWxCLHNCQUFzQndCLFFBQWdCO0lBQzFELElBQUk7UUFDRixNQUFNakIsV0FBV0Q7UUFDakIsTUFBTSxFQUFFSSxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1KLFNBQzNCSyxJQUFJLENBQUMsbUJBQ0xDLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsWUFBWVUsVUFDZkYsS0FBSyxDQUFDLE9BQU87WUFBRUMsV0FBVztRQUFLO1FBRWxDLElBQUlaLE9BQU87WUFDVCxPQUFPO2dCQUNMTSxTQUFTO2dCQUNUTixPQUFPO29CQUNMSyxNQUFNO29CQUNORSxTQUFTUCxNQUFNTyxPQUFPO29CQUN0QkMsU0FBU1I7Z0JBQ1g7WUFDRjtRQUNGO1FBRUEsT0FBTztZQUFFTSxTQUFTO1lBQU1QLE1BQU1BLFFBQVEsRUFBRTtRQUFDO0lBQzNDLEVBQUUsT0FBT0MsT0FBTztRQUNkLE9BQU87WUFDTE0sU0FBUztZQUNUTixPQUFPO2dCQUNMSyxNQUFNO2dCQUNORSxTQUFTUCxpQkFBaUJVLFFBQVFWLE1BQU1PLE9BQU8sR0FBRztZQUNwRDtRQUNGO0lBQ0Y7QUFDRjtBQVlPLGVBQWVoQixjQUFjTyxHQUFXLEVBQUVXLEtBQVU7SUFDekQsSUFBSTtRQUNGLE1BQU1iLFdBQVdEO1FBRWpCLDBCQUEwQjtRQUMxQixNQUFNLEVBQUVJLE1BQU1lLFFBQVEsRUFBRSxHQUFHLE1BQU1sQixTQUM5QkssSUFBSSxDQUFDLG1CQUNMQyxNQUFNLENBQUMsTUFDUEMsRUFBRSxDQUFDLE9BQU9MLEtBQ1ZNLE1BQU07UUFFVCxJQUFJVztRQUNKLElBQUlELFVBQVU7WUFDWiwwQkFBMEI7WUFDMUIsTUFBTSxFQUFFZixNQUFNaUIsT0FBTyxFQUFFaEIsS0FBSyxFQUFFLEdBQUcsTUFBTUosU0FDcENLLElBQUksQ0FBQyxtQkFDTGdCLE1BQU0sQ0FBQztnQkFBRVI7Z0JBQU9TLFlBQVksSUFBSUMsT0FBT0MsV0FBVztZQUFHLEdBQ3JEakIsRUFBRSxDQUFDLE9BQU9MLEtBQ1ZJLE1BQU0sR0FDTkUsTUFBTTtZQUVULElBQUlKLE9BQU87Z0JBQ1QsT0FBTztvQkFDTE0sU0FBUztvQkFDVE4sT0FBTzt3QkFDTEssTUFBTTt3QkFDTkUsU0FBU1AsTUFBTU8sT0FBTzt3QkFDdEJDLFNBQVNSO29CQUNYO2dCQUNGO1lBQ0Y7WUFFQWUsU0FBU0M7UUFDWCxPQUFPO1lBQ0wsT0FBTztnQkFDTFYsU0FBUztnQkFDVE4sT0FBTztvQkFDTEssTUFBTTtvQkFDTkUsU0FBUyxDQUFDLFNBQVMsRUFBRVQsSUFBSSxXQUFXLENBQUM7Z0JBQ3ZDO1lBQ0Y7UUFDRjtRQUVBLE9BQU87WUFBRVEsU0FBUztZQUFNUCxNQUFNZ0I7UUFBTztJQUN2QyxFQUFFLE9BQU9mLE9BQU87UUFDZCxPQUFPO1lBQ0xNLFNBQVM7WUFDVE4sT0FBTztnQkFDTEssTUFBTTtnQkFDTkUsU0FBU1AsaUJBQWlCVSxRQUFRVixNQUFNTyxPQUFPLEdBQUc7WUFDcEQ7UUFDRjtJQUNGO0FBQ0Y7QUFZTyxlQUFldkIsY0FDcEJjLEdBQVcsRUFDWFcsS0FBVSxFQUNWWSxXQUFvQixFQUNwQlIsV0FBbUIsU0FBUyxFQUM1QlMsV0FBb0IsS0FBSztJQUV6QixJQUFJO1FBQ0YsTUFBTTFCLFdBQVdEO1FBRWpCLE1BQU0sRUFBRUksSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNSixTQUMzQkssSUFBSSxDQUFDLG1CQUNMc0IsTUFBTSxDQUFDO1lBQ056QjtZQUNBVztZQUNBWTtZQUNBUjtZQUNBVyxXQUFXRjtRQUNiLEdBQ0NwQixNQUFNLEdBQ05FLE1BQU07UUFFVCxJQUFJSixPQUFPO1lBQ1QsSUFBSUEsTUFBTUssSUFBSSxLQUFLLFNBQVM7Z0JBQzFCLDhCQUE4QjtnQkFDOUIsT0FBTztvQkFDTEMsU0FBUztvQkFDVE4sT0FBTzt3QkFDTEssTUFBTTt3QkFDTkUsU0FBUyxDQUFDLFNBQVMsRUFBRVQsSUFBSSxnQkFBZ0IsQ0FBQztvQkFDNUM7Z0JBQ0Y7WUFDRjtZQUVBLE9BQU87Z0JBQ0xRLFNBQVM7Z0JBQ1ROLE9BQU87b0JBQ0xLLE1BQU07b0JBQ05FLFNBQVNQLE1BQU1PLE9BQU87b0JBQ3RCQyxTQUFTUjtnQkFDWDtZQUNGO1FBQ0Y7UUFFQSxPQUFPO1lBQUVNLFNBQVM7WUFBTVA7UUFBSztJQUMvQixFQUFFLE9BQU9DLE9BQU87UUFDZCxPQUFPO1lBQ0xNLFNBQVM7WUFDVE4sT0FBTztnQkFDTEssTUFBTTtnQkFDTkUsU0FBU1AsaUJBQWlCVSxRQUFRVixNQUFNTyxPQUFPLEdBQUc7WUFDcEQ7UUFDRjtJQUNGO0FBQ0Y7QUFRTyxlQUFldEIsY0FBY2EsR0FBVztJQUM3QyxJQUFJO1FBQ0YsTUFBTUYsV0FBV0Q7UUFFakIsTUFBTSxFQUFFSyxLQUFLLEVBQUUsR0FBRyxNQUFNSixTQUNyQkssSUFBSSxDQUFDLG1CQUNMd0IsTUFBTSxHQUNOdEIsRUFBRSxDQUFDLE9BQU9MO1FBRWIsSUFBSUUsT0FBTztZQUNULE9BQU87Z0JBQ0xNLFNBQVM7Z0JBQ1ROLE9BQU87b0JBQ0xLLE1BQU07b0JBQ05FLFNBQVNQLE1BQU1PLE9BQU87b0JBQ3RCQyxTQUFTUjtnQkFDWDtZQUNGO1FBQ0Y7UUFFQSxPQUFPO1lBQUVNLFNBQVM7WUFBTVAsTUFBTTJCO1FBQVU7SUFDMUMsRUFBRSxPQUFPMUIsT0FBTztRQUNkLE9BQU87WUFDTE0sU0FBUztZQUNUTixPQUFPO2dCQUNMSyxNQUFNO2dCQUNORSxTQUFTUCxpQkFBaUJVLFFBQVFWLE1BQU1PLE9BQU8sR0FBRztZQUNwRDtRQUNGO0lBQ0Y7QUFDRjtBQWFPLGVBQWVkLGNBQ3BCSyxHQUFXLEVBQ1hXLEtBQVUsRUFDVlksV0FBb0IsRUFDcEJSLFdBQW1CLFNBQVMsRUFDNUJTLFdBQW9CLEtBQUs7SUFFekIsSUFBSTtRQUNGLE1BQU0xQixXQUFXRDtRQUVqQixzREFBc0Q7UUFDdEQsTUFBTSxFQUFFSSxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1KLFNBQzNCSyxJQUFJLENBQUMsbUJBQ0wwQixNQUFNLENBQ0w7WUFDRTdCO1lBQ0FXO1lBQ0FZO1lBQ0FSO1lBQ0FXLFdBQVdGO1lBQ1hKLFlBQVksSUFBSUMsT0FBT0MsV0FBVztRQUNwQyxHQUNBO1lBQ0VRLFlBQVk7WUFDWkMsa0JBQWtCO1FBQ3BCLEdBRUQzQixNQUFNLEdBQ05FLE1BQU07UUFFVCxJQUFJSixPQUFPO1lBQ1QsT0FBTztnQkFDTE0sU0FBUztnQkFDVE4sT0FBTztvQkFDTEssTUFBTTtvQkFDTkUsU0FBU1AsTUFBTU8sT0FBTztvQkFDdEJDLFNBQVNSO2dCQUNYO1lBQ0Y7UUFDRjtRQUVBLE9BQU87WUFBRU0sU0FBUztZQUFNUDtRQUFLO0lBQy9CLEVBQUUsT0FBT0MsT0FBTztRQUNkLE9BQU87WUFDTE0sU0FBUztZQUNUTixPQUFPO2dCQUNMSyxNQUFNO2dCQUNORSxTQUFTUCxpQkFBaUJVLFFBQVFWLE1BQU1PLE9BQU8sR0FBRztZQUNwRDtRQUNGO0lBQ0Y7QUFDRjtBQWlCTyxlQUFlZixxQkFDcEJzQyxNQUFzQjtJQUV0QixJQUFJO1FBQ0YsaUJBQWlCO1FBQ2pCLE1BQU1DLGFBQWFDLHFDQUFvQixDQUFDQyxTQUFTLENBQUNIO1FBQ2xELElBQUksQ0FBQ0MsV0FBV3pCLE9BQU8sRUFBRTtZQUN2QixPQUFPO2dCQUNMQSxTQUFTO2dCQUNUTixPQUFPO29CQUNMSyxNQUFNO29CQUNORSxTQUFTO29CQUNUQyxTQUFTdUIsV0FBVy9CLEtBQUssQ0FBQ2tDLE1BQU07Z0JBQ2xDO1lBQ0Y7UUFDRjtRQUVBLE1BQU1DLGtCQUFrQkosV0FBV2hDLElBQUk7UUFDdkMsTUFBTXFDLFVBQXlDLEVBQUU7UUFFakQsbUNBQW1DO1FBQ25DLElBQUlELGdCQUFnQkUsS0FBSyxLQUFLWCxXQUFXO1lBQ3ZDVSxRQUFRRSxJQUFJLENBQ1Y3QyxjQUNFLG1CQUNBMEMsZ0JBQWdCRSxLQUFLLEVBQ3JCLG1CQUNBLGFBQ0E7UUFHTjtRQUVBLElBQUlGLGdCQUFnQkksUUFBUSxLQUFLYixXQUFXO1lBQzFDVSxRQUFRRSxJQUFJLENBQ1Y3QyxjQUNFLHNCQUNBMEMsZ0JBQWdCSSxRQUFRLEVBQ3hCLHNCQUNBLGFBQ0E7UUFHTjtRQUVBLElBQUlKLGdCQUFnQkssY0FBYyxLQUFLZCxXQUFXO1lBQ2hEVSxRQUFRRSxJQUFJLENBQ1Y3QyxjQUNFLDZCQUNBMEMsZ0JBQWdCSyxjQUFjLEVBQzlCLDZCQUNBLGFBQ0E7UUFHTjtRQUVBLElBQUlMLGdCQUFnQk0sWUFBWSxLQUFLZixXQUFXO1lBQzlDVSxRQUFRRSxJQUFJLENBQ1Y3QyxjQUNFLDRCQUNBMEMsZ0JBQWdCTSxZQUFZLEVBQzVCLDRCQUNBLGFBQ0E7UUFHTjtRQUVBLHNCQUFzQjtRQUN0QixNQUFNQyxVQUFVLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ1I7UUFFbEMsOEJBQThCO1FBQzlCLE1BQU1TLFdBQVdILFFBQVFJLE1BQU0sQ0FBQyxDQUFDQyxJQUFNLENBQUNBLEVBQUV6QyxPQUFPO1FBQ2pELElBQUl1QyxTQUFTRyxNQUFNLEdBQUcsR0FBRztZQUN2QixPQUFPO2dCQUNMMUMsU0FBUztnQkFDVE4sT0FBTztvQkFDTEssTUFBTTtvQkFDTkUsU0FBUztvQkFDVEMsU0FBU3FDLFNBQVNJLEdBQUcsQ0FBQyxDQUFDQyxJQUFNQSxFQUFFbEQsS0FBSztnQkFDdEM7WUFDRjtRQUNGO1FBRUEsOEJBQThCO1FBQzlCLE9BQU87WUFBRU0sU0FBUztZQUFNUCxNQUFNb0M7UUFBZ0I7SUFDaEQsRUFBRSxPQUFPbkMsT0FBTztRQUNkLE9BQU87WUFDTE0sU0FBUztZQUNUTixPQUFPO2dCQUNMSyxNQUFNO2dCQUNORSxTQUFTUCxpQkFBaUJVLFFBQVFWLE1BQU1PLE9BQU8sR0FBRztZQUNwRDtRQUNGO0lBQ0Y7QUFDRjtBQWFPLGVBQWVyQjtJQUNwQixJQUFJO1FBQ0YsTUFBTTZCLFNBQVMsTUFBTTVCLFdBQVc7UUFFaEMsSUFBSSxDQUFDNEIsT0FBT1QsT0FBTyxFQUFFO1lBQ25CLGlEQUFpRDtZQUNqRCxJQUFJUyxPQUFPZixLQUFLLENBQUNLLElBQUksS0FBSyxhQUFhO2dCQUNyQyxPQUFPO29CQUFFQyxTQUFTO29CQUFNUCxNQUFNO2dCQUFpQjtZQUNqRDtZQUNBLE9BQU9nQjtRQUNUO1FBRUEscUJBQXFCO1FBQ3JCLE1BQU1OLFFBQVFNLE9BQU9oQixJQUFJO1FBQ3pCLElBQUlVLFVBQVUsb0JBQW9CQSxVQUFVLGNBQWM7WUFDeEQsT0FBTztnQkFDTEgsU0FBUztnQkFDVE4sT0FBTztvQkFDTEssTUFBTTtvQkFDTkUsU0FBUyxDQUFDLDJCQUEyQixFQUFFRSxPQUFPO2dCQUNoRDtZQUNGO1FBQ0Y7UUFFQSxPQUFPO1lBQUVILFNBQVM7WUFBTVAsTUFBTVU7UUFBTTtJQUN0QyxFQUFFLE9BQU9ULE9BQU87UUFDZCxPQUFPO1lBQ0xNLFNBQVM7WUFDVE4sT0FBTztnQkFDTEssTUFBTTtnQkFDTkUsU0FBU1AsaUJBQWlCVSxRQUFRVixNQUFNTyxPQUFPLEdBQUc7WUFDcEQ7UUFDRjtJQUNGO0FBQ0Y7QUFvQk8sZUFBZWpCLHdCQUNwQjZELE1BQXVDLEVBQ3ZDQyx1QkFBZ0MsS0FBSztJQUVyQyxJQUFJO1FBQ0YsTUFBTXhELFdBQVdEO1FBRWpCLGtCQUFrQjtRQUNsQixJQUFJd0QsV0FBVyxvQkFBb0JBLFdBQVcsY0FBYztZQUMxRCxPQUFPO2dCQUNMN0MsU0FBUztnQkFDVE4sT0FBTztvQkFDTEssTUFBTTtvQkFDTkUsU0FBUyxDQUFDLHFCQUFxQixFQUFFNEMsUUFBUTtnQkFDM0M7WUFDRjtRQUNGO1FBRUEseUNBQXlDO1FBQ3pDLE1BQU1FLGdCQUFnQixNQUFNNUQsY0FDMUIsdUJBQ0EwRCxRQUNBLGdEQUNBLGtCQUNBO1FBR0YsSUFBSSxDQUFDRSxjQUFjL0MsT0FBTyxFQUFFO1lBQzFCLE9BQU87Z0JBQ0xBLFNBQVM7Z0JBQ1ROLE9BQU9xRCxjQUFjckQsS0FBSztZQUM1QjtRQUNGO1FBRUEsSUFBSXNELHFCQUFxQjtRQUV6QiwyQ0FBMkM7UUFDM0MsSUFBSUYsc0JBQXNCO1lBQ3hCLE1BQU0sRUFBRXJELElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUosU0FDM0JLLElBQUksQ0FBQyxVQUNMZ0IsTUFBTSxDQUFDO2dCQUFFc0MsYUFBYUo7WUFBTyxHQUM3QkssR0FBRyxDQUFDLGVBQWVMLFFBQVEsZ0RBQWdEO2FBQzNFakQsTUFBTSxDQUFDO1lBRVYsSUFBSUYsT0FBTztnQkFDVCxPQUFPO29CQUNMTSxTQUFTO29CQUNUTixPQUFPO3dCQUNMSyxNQUFNO3dCQUNORSxTQUFTO3dCQUNUQyxTQUFTUjtvQkFDWDtnQkFDRjtZQUNGO1lBRUFzRCxxQkFBcUJ2RCxNQUFNaUQsVUFBVTtRQUN2QztRQUVBLE9BQU87WUFDTDFDLFNBQVM7WUFDVFAsTUFBTTtnQkFBRXVEO1lBQW1CO1FBQzdCO0lBQ0YsRUFBRSxPQUFPdEQsT0FBTztRQUNkLE9BQU87WUFDTE0sU0FBUztZQUNUTixPQUFPO2dCQUNMSyxNQUFNO2dCQUNORSxTQUFTUCxpQkFBaUJVLFFBQVFWLE1BQU1PLE9BQU8sR0FBRztZQUNwRDtRQUNGO0lBQ0Y7QUFDRiJ9