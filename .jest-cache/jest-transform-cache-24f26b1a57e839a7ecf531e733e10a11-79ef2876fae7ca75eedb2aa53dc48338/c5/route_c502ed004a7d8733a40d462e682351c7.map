{"version":3,"names":["cov_2qunpldybh","actualCoverage","s","POST","bulkDeleteSchema","_zod","z","object","ids","array","string","uuid","min","max","request","f","cookieStore","_headers","cookies","supabase","_authhelpersnextjs","createRouteHandlerClient","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","body","validation","safeParse","details","issues","deleteError","count","from","update","deleted_at","Date","toISOString","deleted_by","user","id","in","is","console","deleted","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/events/bulk-delete/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport { z } from 'zod';\n\nconst bulkDeleteSchema = z.object({\n  ids: z.array(z.string().uuid()).min(1).max(100),\n});\n\n/**\n * Bulk delete events\n * \n * @param request - Request with array of event IDs\n * @returns Success response with count of deleted events\n */\nexport async function POST(request: Request): Promise<NextResponse> {\n  try {\n    // 1. Authentication\n    const cookieStore = cookies();\n    const supabase = createRouteHandlerClient({ \n      cookies: () => cookieStore \n    });\n    \n    const {\n      data: { session },\n      error: authError,\n    } = await supabase.auth.getSession();\n\n    if (authError || !session) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n        },\n        { status: 401 }\n      );\n    }\n\n    // 2. Validation\n    const body = await request.json();\n    const validation = bulkDeleteSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid request data',\n            details: validation.error.issues,\n          },\n        },\n        { status: 400 }\n      );\n    }\n\n    const { ids } = validation.data;\n\n    // 3. Soft delete events (set deleted_at timestamp)\n    const { error: deleteError, count } = await supabase\n      .from('events')\n      .update({ \n        deleted_at: new Date().toISOString(),\n        deleted_by: session.user.id \n      })\n      .in('id', ids)\n      .is('deleted_at', null); // Only delete non-deleted events\n\n    if (deleteError) {\n      console.error('Bulk delete error:', deleteError);\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'DATABASE_ERROR',\n            message: 'Failed to delete events',\n            details: deleteError,\n          },\n        },\n        { status: 500 }\n      );\n    }\n\n    // 4. Response\n    return NextResponse.json({\n      success: true,\n      data: {\n        deleted: count || 0,\n        message: `Successfully deleted ${count || 0} event(s)`,\n      },\n    });\n  } catch (error) {\n    console.error('Bulk delete events error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'INTERNAL_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}