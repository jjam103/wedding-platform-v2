{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/hooks/useSections.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\n\ninterface Column {\n  id: string;\n  columnNumber: 1 | 2;\n  contentType: 'rich_text' | 'photos' | 'references';\n  contentData: any;\n}\n\ninterface Section {\n  id: string;\n  pageType: 'activity' | 'event' | 'accommodation' | 'room_type' | 'custom' | 'home';\n  pageId: string;\n  displayOrder: number;\n  layout: 'one-column' | 'two-column';\n  columns: Column[];\n}\n\ninterface UseSectionsParams {\n  pageType: string;\n  pageId: string;\n}\n\ninterface UseSectionsReturn {\n  data: Section[];\n  loading: boolean;\n  error: Error | null;\n  refetch: () => Promise<void>;\n  create: (data: Partial<Section>) => Promise<{ success: boolean; data?: Section; error?: string }>;\n  update: (id: string, data: Partial<Section>) => Promise<{ success: boolean; data?: Section; error?: string }>;\n  remove: (id: string) => Promise<{ success: boolean; error?: string }>;\n  reorder: (sectionIds: string[]) => Promise<{ success: boolean; error?: string }>;\n}\n\n/**\n * Custom hook for managing page sections\n * \n * Provides:\n * - Data fetching with loading and error states\n * - CRUD operations (create, update, delete)\n * - Section reordering\n * - Automatic refetch after mutations\n */\nexport function useSections({ pageType, pageId }: UseSectionsParams): UseSectionsReturn {\n  const [data, setData] = useState<Section[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const refetch = useCallback(async () => {\n    if (!pageType || !pageId) {\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await fetch(`/api/admin/sections/by-page/${pageType}/${pageId}`);\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        throw new Error(result.error?.message || 'Failed to fetch sections');\n      }\n\n      setData(result.data || []);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Unknown error');\n      setError(errorObj);\n      console.error('Failed to fetch sections:', errorObj);\n    } finally {\n      setLoading(false);\n    }\n  }, [pageType, pageId]);\n\n  const create = useCallback(async (sectionData: Partial<Section>) => {\n    try {\n      const response = await fetch('/api/admin/sections', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...sectionData,\n          pageType,\n          pageId,\n        }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Failed to create section',\n        };\n      }\n\n      // Optimistic update\n      setData((prev) => [...prev, result.data].sort((a, b) => a.displayOrder - b.displayOrder));\n\n      return { success: true, data: result.data };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to create section:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, [pageType, pageId]);\n\n  const update = useCallback(async (id: string, sectionData: Partial<Section>) => {\n    try {\n      const response = await fetch(`/api/admin/sections/${id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(sectionData),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Failed to update section',\n        };\n      }\n\n      // Optimistic update\n      setData((prev) =>\n        prev.map((section) => (section.id === id ? { ...section, ...result.data } : section))\n      );\n\n      return { success: true, data: result.data };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to update section:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, []);\n\n  const remove = useCallback(async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/sections/${id}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Failed to delete section',\n        };\n      }\n\n      // Optimistic update\n      setData((prev) => prev.filter((section) => section.id !== id));\n\n      return { success: true };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to delete section:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, []);\n\n  const reorder = useCallback(async (sectionIds: string[]) => {\n    try {\n      const response = await fetch('/api/admin/sections/reorder', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ sectionIds }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok || !result.success) {\n        return {\n          success: false,\n          error: result.error?.message || 'Failed to reorder sections',\n        };\n      }\n\n      // Optimistic update\n      setData((prev) => {\n        const ordered = sectionIds\n          .map((id) => prev.find((s) => s.id === id))\n          .filter((s): s is Section => s !== undefined);\n        return ordered;\n      });\n\n      return { success: true };\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Unknown error';\n      console.error('Failed to reorder sections:', err);\n      return { success: false, error: errorMsg };\n    }\n  }, []);\n\n  useEffect(() => {\n    refetch();\n  }, [refetch]);\n\n  return {\n    data,\n    loading,\n    error,\n    refetch,\n    create,\n    update,\n    remove,\n    reorder,\n  };\n}\n"],"names":["useSections","pageType","pageId","data","setData","useState","loading","setLoading","error","setError","refetch","useCallback","response","fetch","result","json","ok","success","Error","message","err","errorObj","console","create","sectionData","method","headers","body","JSON","stringify","prev","sort","a","b","displayOrder","errorMsg","update","id","map","section","remove","filter","reorder","sectionIds","ordered","find","s","undefined","useEffect"],"mappings":"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"}