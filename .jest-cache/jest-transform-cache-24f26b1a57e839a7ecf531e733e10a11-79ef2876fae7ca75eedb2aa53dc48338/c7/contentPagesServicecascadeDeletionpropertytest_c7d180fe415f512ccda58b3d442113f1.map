{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/contentPagesService.cascadeDeletion.property.test.ts"],"sourcesContent":["import { describe, it, expect, jest, beforeEach } from '@jest/globals';\nimport * as fc from 'fast-check';\n\n// Mock Supabase before importing contentPagesService\nconst mockFrom = jest.fn();\njest.mock('@/lib/supabase', () => ({\n  supabase: {\n    from: mockFrom,\n  },\n}));\n\n// Import after mocking\nimport * as contentPagesService from './contentPagesService';\n\n/**\n * Feature: admin-backend-integration-cms, Property 3: Cascade Deletion of Sections\n * \n * For any content page with associated sections and columns, when the page is deleted,\n * the system SHALL delete all associated sections and their columns.\n * \n * Validates: Requirements 1.3\n */\ndescribe('Feature: admin-backend-integration-cms, Property 3: Cascade Deletion of Sections', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  // Generator for content page with sections\n  const contentPageWithSectionsArbitrary = fc.record({\n    pageId: fc.uuid(),\n    sections: fc.array(\n      fc.record({\n        id: fc.uuid(),\n        displayOrder: fc.integer({ min: 0, max: 100 }),\n        columns: fc.array(\n          fc.record({\n            id: fc.uuid(),\n            columnNumber: fc.constantFrom(1, 2) as fc.Arbitrary<1 | 2>,\n            contentType: fc.constantFrom('rich_text', 'photo_gallery', 'references') as fc.Arbitrary<'rich_text' | 'photo_gallery' | 'references'>,\n            contentData: fc.jsonValue(),\n          }),\n          { minLength: 1, maxLength: 2 }\n        ),\n      }),\n      { minLength: 1, maxLength: 10 }\n    ),\n  });\n\n  it('should delete all sections when content page is deleted', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        contentPageWithSectionsArbitrary,\n        async (pageData) => {\n          const deletedSections: string[] = [];\n          const deletedColumns: string[] = [];\n\n          // Mock the sections delete operation\n          const sectionsDeleteMock = jest.fn().mockImplementation(() => {\n            // Track which sections would be deleted\n            pageData.sections.forEach(section => {\n              deletedSections.push(section.id);\n              // Columns are cascade deleted by database\n              section.columns.forEach(column => {\n                deletedColumns.push(column.id);\n              });\n            });\n\n            return {\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          // Mock the content page delete operation\n          const contentPageDeleteMock = jest.fn().mockResolvedValue({\n            error: null,\n          } as any);\n\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'sections') {\n              return {\n                delete: sectionsDeleteMock,\n                eq: jest.fn().mockReturnThis(),\n              };\n            }\n            if (table === 'content_pages') {\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({ error: null }),\n                }),\n              };\n            }\n            return {\n              delete: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          const result = await contentPagesService.deleteContentPage(pageData.pageId);\n\n          expect(result.success).toBe(true);\n\n          // Property 1: Sections delete should be called\n          expect(sectionsDeleteMock).toHaveBeenCalled();\n\n          // Property 2: All sections should be marked for deletion\n          expect(deletedSections.length).toBe(pageData.sections.length);\n          pageData.sections.forEach(section => {\n            expect(deletedSections).toContain(section.id);\n          });\n\n          // Property 3: All columns should be cascade deleted (tracked in our mock)\n          expect(deletedColumns.length).toBe(\n            pageData.sections.reduce((sum, section) => sum + section.columns.length, 0)\n          );\n          pageData.sections.forEach(section => {\n            section.columns.forEach(column => {\n              expect(deletedColumns).toContain(column.id);\n            });\n          });\n\n          // Property 4: Content page delete should be called after sections\n          const fromCalls = mockFrom.mock.calls;\n          const sectionsCallIndex = fromCalls.findIndex(call => call[0] === 'sections');\n          const contentPagesCallIndex = fromCalls.findIndex(call => call[0] === 'content_pages');\n          expect(sectionsCallIndex).toBeLessThan(contentPagesCallIndex);\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should handle deletion of page with no sections', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        async (pageId) => {\n          let sectionsDeleteCalled = false;\n          let contentPageDeleteCalled = false;\n\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'sections') {\n              sectionsDeleteCalled = true;\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockReturnThis(),\n                }),\n                eq: jest.fn().mockReturnThis(),\n              };\n            }\n            if (table === 'content_pages') {\n              contentPageDeleteCalled = true;\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({ error: null }),\n                }),\n              };\n            }\n            return {\n              delete: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          const result = await contentPagesService.deleteContentPage(pageId);\n\n          expect(result.success).toBe(true);\n\n          // Property: Even with no sections, sections delete should be attempted\n          expect(sectionsDeleteCalled).toBe(true);\n\n          // Property: Content page delete should still be called\n          expect(contentPageDeleteCalled).toBe(true);\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should handle deletion with varying numbers of sections and columns', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        fc.integer({ min: 0, max: 20 }), // Number of sections\n        fc.integer({ min: 1, max: 2 }), // Columns per section\n        async (pageId, numSections, columnsPerSection) => {\n          const sections = Array.from({ length: numSections }, (_, i) => ({\n            id: `section-${i}`,\n            columns: Array.from({ length: columnsPerSection }, (_, j) => ({\n              id: `column-${i}-${j}`,\n            })),\n          }));\n\n          const deletedSections: string[] = [];\n          const deletedColumns: string[] = [];\n\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'sections') {\n              return {\n                delete: jest.fn().mockImplementation(() => {\n                  sections.forEach(section => {\n                    deletedSections.push(section.id);\n                    section.columns.forEach(column => {\n                      deletedColumns.push(column.id);\n                    });\n                  });\n                  return {\n                    eq: jest.fn().mockReturnThis(),\n                  };\n                }),\n                eq: jest.fn().mockReturnThis(),\n              };\n            }\n            if (table === 'content_pages') {\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({ error: null }),\n                }),\n              };\n            }\n            return {\n              delete: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          const result = await contentPagesService.deleteContentPage(pageId);\n\n          expect(result.success).toBe(true);\n\n          // Property: Number of deleted sections matches expected\n          expect(deletedSections.length).toBe(numSections);\n\n          // Property: Number of deleted columns matches expected\n          const expectedColumns = numSections * columnsPerSection;\n          expect(deletedColumns.length).toBe(expectedColumns);\n\n          // Property: Each section has correct number of columns\n          if (numSections > 0) {\n            const columnsPerDeletedSection = deletedColumns.length / deletedSections.length;\n            expect(columnsPerDeletedSection).toBe(columnsPerSection);\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should maintain referential integrity during cascade deletion', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        contentPageWithSectionsArbitrary,\n        async (pageData) => {\n          const deletionOrder: Array<{ table: string; id: string }> = [];\n\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'sections') {\n              return {\n                delete: jest.fn().mockImplementation(() => {\n                  // Record section deletions\n                  pageData.sections.forEach(section => {\n                    deletionOrder.push({ table: 'sections', id: section.id });\n                    // Columns are cascade deleted by database\n                    section.columns.forEach(column => {\n                      deletionOrder.push({ table: 'columns', id: column.id });\n                    });\n                  });\n                  return {\n                    eq: jest.fn().mockReturnThis(),\n                  };\n                }),\n                eq: jest.fn().mockReturnThis(),\n              };\n            }\n            if (table === 'content_pages') {\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockImplementation(async () => {\n                    deletionOrder.push({ table: 'content_pages', id: pageData.pageId });\n                    return { error: null };\n                  }),\n                }),\n              };\n            }\n            return {\n              delete: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          const result = await contentPagesService.deleteContentPage(pageData.pageId);\n\n          expect(result.success).toBe(true);\n\n          // Property: Sections and columns are deleted before content page\n          const contentPageDeletionIndex = deletionOrder.findIndex(\n            item => item.table === 'content_pages'\n          );\n          const sectionDeletions = deletionOrder.filter(item => item.table === 'sections');\n          const columnDeletions = deletionOrder.filter(item => item.table === 'columns');\n\n          // All sections should be deleted before content page\n          sectionDeletions.forEach(deletion => {\n            const sectionIndex = deletionOrder.indexOf(deletion);\n            expect(sectionIndex).toBeLessThan(contentPageDeletionIndex);\n          });\n\n          // All columns should be deleted before content page\n          columnDeletions.forEach(deletion => {\n            const columnIndex = deletionOrder.indexOf(deletion);\n            expect(columnIndex).toBeLessThan(contentPageDeletionIndex);\n          });\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should return error if sections deletion fails but not affect content page deletion', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        async (pageId) => {\n          // Mock sections delete to succeed (no error thrown)\n          // Mock content page delete to succeed\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'sections') {\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockReturnThis(),\n                }),\n                eq: jest.fn().mockReturnThis(),\n              };\n            }\n            if (table === 'content_pages') {\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({ error: null }),\n                }),\n              };\n            }\n            return {\n              delete: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          const result = await contentPagesService.deleteContentPage(pageId);\n\n          // Property: Deletion should succeed even if sections table is empty\n          expect(result.success).toBe(true);\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should return error if content page deletion fails', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.uuid(),\n        fc.string({ minLength: 1, maxLength: 100 }),\n        async (pageId, errorMessage) => {\n          mockFrom.mockImplementation((table: string) => {\n            if (table === 'sections') {\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockReturnThis(),\n                }),\n                eq: jest.fn().mockReturnThis(),\n              };\n            }\n            if (table === 'content_pages') {\n              return {\n                delete: jest.fn().mockReturnValue({\n                  eq: jest.fn().mockResolvedValue({\n                    error: {\n                      message: errorMessage,\n                      code: 'DATABASE_ERROR',\n                    },\n                  }),\n                }),\n              };\n            }\n            return {\n              delete: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n            };\n          });\n\n          const result = await contentPagesService.deleteContentPage(pageId);\n\n          // Property: Should return error when content page deletion fails\n          expect(result.success).toBe(false);\n          if (!result.success) {\n            expect(result.error.code).toBe('DATABASE_ERROR');\n            expect(result.error.message).toBe(errorMessage);\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n});\n"],"names":["mockFrom","jest","fn","mock","supabase","from","describe","beforeEach","clearAllMocks","contentPageWithSectionsArbitrary","fc","record","pageId","uuid","sections","array","id","displayOrder","integer","min","max","columns","columnNumber","constantFrom","contentType","contentData","jsonValue","minLength","maxLength","it","assert","asyncProperty","pageData","deletedSections","deletedColumns","sectionsDeleteMock","mockImplementation","forEach","section","push","column","eq","mockReturnThis","contentPageDeleteMock","mockResolvedValue","error","table","delete","mockReturnValue","result","contentPagesService","deleteContentPage","expect","success","toBe","toHaveBeenCalled","length","toContain","reduce","sum","fromCalls","calls","sectionsCallIndex","findIndex","call","contentPagesCallIndex","toBeLessThan","numRuns","sectionsDeleteCalled","contentPageDeleteCalled","numSections","columnsPerSection","Array","_","i","j","expectedColumns","columnsPerDeletedSection","deletionOrder","contentPageDeletionIndex","item","sectionDeletions","filter","columnDeletions","deletion","sectionIndex","indexOf","columnIndex","string","errorMessage","message","code"],"mappings":"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"}