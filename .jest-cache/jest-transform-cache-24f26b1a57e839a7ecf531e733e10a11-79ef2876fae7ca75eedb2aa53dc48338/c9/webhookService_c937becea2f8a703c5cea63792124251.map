{"version":3,"names":["calculateRetryDelay","cov_1egdb61k2q","f","s","generateWebhookSignature","retryFailedWebhooks","sendWebhookEvent","testWebhookConnectivity","validateWebhookConfig","verifyWebhookSignature","_supabase","getSupabase","b","supabase","require","webhookConfigSchema","_zod","z","object","url","string","events","array","secret","min","enabled","boolean","optional","default","retryConfig","maxRetries","number","int","max","baseDelay","webhookPayloadSchema","event","timestamp","datetime","data","record","unknown","payload","_crypto","createHmac","update","digest","signature","expectedSignature","timingSafeEqual","Buffer","from","attempt","exponentialDelay","Math","pow","jitter","random","floor","deliverWebhook","config","payloadString","JSON","stringify","controller","AbortController","timeoutId","setTimeout","abort","response","fetch","method","headers","body","signal","clearTimeout","responseBody","text","ok","success","error","code","message","status","details","Error","name","webhooks","fetchError","select","eq","contains","length","undefined","Date","toISOString","validation","safeParse","issues","deliveryPromises","map","webhook","retry_config","logEntry","logError","insert","webhook_id","id","attempts","single","console","deliveryResult","last_attempt_at","response_status","response_body","retryDelay","nextRetryAt","now","next_retry_at","error_message","Promise","allSettled","pendingDeliveries","lte","order","ascending","limit","retriedCount","delivery","testPayload","result"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/webhookService.ts"],"sourcesContent":["import { z } from 'zod';\nimport crypto from 'crypto';\nimport type { Result } from '../types';\n\n// Lazy load supabase to avoid initialization issues in tests\nlet _supabase: any = null;\nfunction getSupabase() {\n  if (!_supabase) {\n    const { supabase } = require('../lib/supabase');\n    _supabase = supabase;\n  }\n  return _supabase;\n}\n\n/**\n * Webhook event types supported by the system.\n */\nexport type WebhookEventType =\n  | 'rsvp.submitted'\n  | 'rsvp.updated'\n  | 'photo.uploaded'\n  | 'photo.approved'\n  | 'photo.rejected'\n  | 'payment.recorded'\n  | 'guest.created'\n  | 'guest.updated'\n  | 'email.delivered'\n  | 'email.bounced'\n  | 'email.failed';\n\n/**\n * Webhook delivery status.\n */\nexport type WebhookDeliveryStatus = 'pending' | 'delivered' | 'failed' | 'retrying';\n\n/**\n * Webhook configuration schema.\n */\nconst webhookConfigSchema = z.object({\n  url: z.string().url('Invalid webhook URL'),\n  events: z.array(z.string()),\n  secret: z.string().min(32, 'Webhook secret must be at least 32 characters'),\n  enabled: z.boolean().optional().default(true),\n  retryConfig: z.object({\n    maxRetries: z.number().int().min(0).max(10).optional().default(5),\n    baseDelay: z.number().int().min(100).max(10000).optional().default(1000),\n  }).optional(),\n});\n\nexport type WebhookConfig = z.infer<typeof webhookConfigSchema>;\n\n/**\n * Webhook payload schema.\n */\nconst webhookPayloadSchema = z.object({\n  event: z.string(),\n  timestamp: z.string().datetime(),\n  data: z.record(z.unknown()),\n});\n\nexport type WebhookPayload = z.infer<typeof webhookPayloadSchema>;\n\n/**\n * Webhook delivery log entry.\n */\nexport interface WebhookDeliveryLog {\n  id: string;\n  webhookId: string;\n  event: string;\n  payload: WebhookPayload;\n  url: string;\n  status: WebhookDeliveryStatus;\n  attempts: number;\n  lastAttemptAt: string | null;\n  nextRetryAt: string | null;\n  responseStatus: number | null;\n  responseBody: string | null;\n  errorMessage: string | null;\n  createdAt: string;\n  updatedAt: string;\n}\n\n/**\n * Generates HMAC signature for webhook payload.\n * \n * @param payload - Webhook payload to sign\n * @param secret - Webhook secret key\n * @returns HMAC SHA-256 signature\n */\nexport function generateWebhookSignature(payload: string, secret: string): string {\n  return crypto\n    .createHmac('sha256', secret)\n    .update(payload)\n    .digest('hex');\n}\n\n/**\n * Verifies webhook signature.\n * \n * @param payload - Webhook payload\n * @param signature - Provided signature\n * @param secret - Webhook secret key\n * @returns True if signature is valid\n */\nexport function verifyWebhookSignature(\n  payload: string,\n  signature: string,\n  secret: string\n): boolean {\n  const expectedSignature = generateWebhookSignature(payload, secret);\n  \n  // Use timing-safe comparison to prevent timing attacks\n  try {\n    return crypto.timingSafeEqual(\n      Buffer.from(signature),\n      Buffer.from(expectedSignature)\n    );\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Calculates exponential backoff delay for webhook retries.\n * \n * @param attempt - Current attempt number (0-indexed)\n * @param baseDelay - Base delay in milliseconds\n * @returns Delay in milliseconds with exponential backoff\n */\nexport function calculateRetryDelay(attempt: number, baseDelay: number = 1000): number {\n  // Exponential backoff: baseDelay * 2^attempt\n  // With jitter to prevent thundering herd\n  const exponentialDelay = baseDelay * Math.pow(2, attempt);\n  const jitter = Math.random() * 0.1 * exponentialDelay; // 10% jitter\n  \n  return Math.floor(exponentialDelay + jitter);\n}\n\n/**\n * Delivers a webhook to the configured URL.\n * \n * @param config - Webhook configuration\n * @param payload - Webhook payload\n * @returns Result containing delivery status\n */\nasync function deliverWebhook(\n  config: WebhookConfig,\n  payload: WebhookPayload\n): Promise<Result<{ status: number; body: string }>> {\n  try {\n    const payloadString = JSON.stringify(payload);\n    const signature = generateWebhookSignature(payloadString, config.secret);\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n\n    const response = await fetch(config.url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Webhook-Signature': signature,\n        'X-Webhook-Event': payload.event,\n        'X-Webhook-Timestamp': payload.timestamp,\n        'User-Agent': 'WeddingPlatform-Webhook/1.0',\n      },\n      body: payloadString,\n      signal: controller.signal,\n    });\n\n    clearTimeout(timeoutId);\n\n    const responseBody = await response.text();\n\n    if (!response.ok) {\n      return {\n        success: false,\n        error: {\n          code: 'WEBHOOK_DELIVERY_FAILED',\n          message: `Webhook delivery failed with status ${response.status}`,\n          details: {\n            status: response.status,\n            body: responseBody,\n          },\n        },\n      };\n    }\n\n    return {\n      success: true,\n      data: {\n        status: response.status,\n        body: responseBody,\n      },\n    };\n  } catch (error) {\n    if (error instanceof Error && error.name === 'AbortError') {\n      return {\n        success: false,\n        error: {\n          code: 'WEBHOOK_TIMEOUT',\n          message: 'Webhook delivery timed out after 30 seconds',\n        },\n      };\n    }\n\n    return {\n      success: false,\n      error: {\n        code: 'WEBHOOK_DELIVERY_ERROR',\n        message: error instanceof Error ? error.message : 'Webhook delivery failed',\n        details: error,\n      },\n    };\n  }\n}\n\n/**\n * Sends a webhook event to all configured webhooks.\n * \n * @param event - Event type\n * @param data - Event data\n * @returns Result containing delivery results\n * \n * @example\n * await sendWebhookEvent('rsvp.submitted', {\n *   guestId: 'guest-123',\n *   eventId: 'event-456',\n *   status: 'attending',\n * });\n */\nexport async function sendWebhookEvent(\n  event: WebhookEventType,\n  data: Record<string, unknown>\n): Promise<Result<void>> {\n  try {\n    const supabase = getSupabase();\n\n    // 1. Get all enabled webhooks that subscribe to this event\n    const { data: webhooks, error: fetchError } = await supabase\n      .from('webhooks')\n      .select('*')\n      .eq('enabled', true)\n      .contains('events', [event]);\n\n    if (fetchError) {\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to fetch webhook configurations',\n          details: fetchError,\n        },\n      };\n    }\n\n    if (!webhooks || webhooks.length === 0) {\n      // No webhooks configured for this event - not an error\n      return { success: true, data: undefined };\n    }\n\n    // 2. Create webhook payload\n    const payload: WebhookPayload = {\n      event,\n      timestamp: new Date().toISOString(),\n      data,\n    };\n\n    // 3. Validate payload\n    const validation = webhookPayloadSchema.safeParse(payload);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid webhook payload',\n          details: validation.error.issues,\n        },\n      };\n    }\n\n    // 4. Queue webhook deliveries\n    const deliveryPromises = webhooks.map(async (webhook: any) => {\n      const config: WebhookConfig = {\n        url: webhook.url,\n        events: webhook.events,\n        secret: webhook.secret,\n        enabled: webhook.enabled,\n        retryConfig: webhook.retry_config || undefined,\n      };\n\n      // Create delivery log entry\n      const { data: logEntry, error: logError } = await supabase\n        .from('webhook_delivery_logs')\n        .insert({\n          webhook_id: webhook.id,\n          event,\n          payload,\n          url: webhook.url,\n          status: 'pending',\n          attempts: 0,\n        })\n        .select()\n        .single();\n\n      if (logError || !logEntry) {\n        console.error('Failed to create webhook delivery log:', logError);\n        return;\n      }\n\n      // Attempt delivery\n      const deliveryResult = await deliverWebhook(config, payload);\n\n      // Update delivery log\n      if (deliveryResult.success) {\n        await supabase\n          .from('webhook_delivery_logs')\n          .update({\n            status: 'delivered',\n            attempts: 1,\n            last_attempt_at: new Date().toISOString(),\n            response_status: deliveryResult.data.status,\n            response_body: deliveryResult.data.body,\n          })\n          .eq('id', logEntry.id);\n      } else {\n        // Schedule retry\n        const retryDelay = calculateRetryDelay(0, config.retryConfig?.baseDelay);\n        const nextRetryAt = new Date(Date.now() + retryDelay).toISOString();\n\n        await supabase\n          .from('webhook_delivery_logs')\n          .update({\n            status: 'retrying',\n            attempts: 1,\n            last_attempt_at: new Date().toISOString(),\n            next_retry_at: nextRetryAt,\n            error_message: deliveryResult.error.message,\n          })\n          .eq('id', logEntry.id);\n      }\n    });\n\n    await Promise.allSettled(deliveryPromises);\n\n    return { success: true, data: undefined };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'WEBHOOK_ERROR',\n        message: error instanceof Error ? error.message : 'Webhook processing failed',\n        details: error,\n      },\n    };\n  }\n}\n\n/**\n * Retries failed webhook deliveries.\n * Should be called by a scheduled job.\n * \n * @returns Result containing retry results\n */\nexport async function retryFailedWebhooks(): Promise<Result<{ retriedCount: number }>> {\n  try {\n    const supabase = getSupabase();\n\n    // 1. Get all webhook deliveries that need retry\n    const { data: pendingDeliveries, error: fetchError } = await supabase\n      .from('webhook_delivery_logs')\n      .select('*, webhooks(*)')\n      .eq('status', 'retrying')\n      .lte('next_retry_at', new Date().toISOString())\n      .order('next_retry_at', { ascending: true })\n      .limit(100); // Process in batches\n\n    if (fetchError) {\n      return {\n        success: false,\n        error: {\n          code: 'DATABASE_ERROR',\n          message: 'Failed to fetch pending webhook deliveries',\n          details: fetchError,\n        },\n      };\n    }\n\n    if (!pendingDeliveries || pendingDeliveries.length === 0) {\n      return { success: true, data: { retriedCount: 0 } };\n    }\n\n    // 2. Retry each delivery\n    let retriedCount = 0;\n\n    for (const delivery of pendingDeliveries) {\n      const webhook = delivery.webhooks;\n      if (!webhook || !webhook.enabled) {\n        continue;\n      }\n\n      const config: WebhookConfig = {\n        url: webhook.url,\n        events: webhook.events,\n        secret: webhook.secret,\n        enabled: webhook.enabled,\n        retryConfig: webhook.retry_config || undefined,\n      };\n\n      const maxRetries = config.retryConfig?.maxRetries || 5;\n\n      if (delivery.attempts >= maxRetries) {\n        // Max retries reached, mark as failed\n        await supabase\n          .from('webhook_delivery_logs')\n          .update({\n            status: 'failed',\n            error_message: `Max retries (${maxRetries}) exceeded`,\n          })\n          .eq('id', delivery.id);\n        continue;\n      }\n\n      // Attempt delivery\n      const deliveryResult = await deliverWebhook(config, delivery.payload);\n\n      if (deliveryResult.success) {\n        await supabase\n          .from('webhook_delivery_logs')\n          .update({\n            status: 'delivered',\n            attempts: delivery.attempts + 1,\n            last_attempt_at: new Date().toISOString(),\n            next_retry_at: null,\n            response_status: deliveryResult.data.status,\n            response_body: deliveryResult.data.body,\n            error_message: null,\n          })\n          .eq('id', delivery.id);\n        retriedCount++;\n      } else {\n        // Schedule next retry with exponential backoff\n        const retryDelay = calculateRetryDelay(\n          delivery.attempts,\n          config.retryConfig?.baseDelay\n        );\n        const nextRetryAt = new Date(Date.now() + retryDelay).toISOString();\n\n        await supabase\n          .from('webhook_delivery_logs')\n          .update({\n            status: 'retrying',\n            attempts: delivery.attempts + 1,\n            last_attempt_at: new Date().toISOString(),\n            next_retry_at: nextRetryAt,\n            error_message: deliveryResult.error.message,\n          })\n          .eq('id', delivery.id);\n      }\n    }\n\n    return { success: true, data: { retriedCount } };\n  } catch (error) {\n    return {\n      success: false,\n      error: {\n        code: 'WEBHOOK_RETRY_ERROR',\n        message: error instanceof Error ? error.message : 'Webhook retry failed',\n        details: error,\n      },\n    };\n  }\n}\n\n/**\n * Validates webhook configuration.\n * \n * @param config - Webhook configuration to validate\n * @returns Result indicating if configuration is valid\n */\nexport function validateWebhookConfig(config: unknown): Result<WebhookConfig> {\n  const validation = webhookConfigSchema.safeParse(config);\n\n  if (!validation.success) {\n    return {\n      success: false,\n      error: {\n        code: 'VALIDATION_ERROR',\n        message: 'Invalid webhook configuration',\n        details: validation.error.issues,\n      },\n    };\n  }\n\n  return { success: true, data: validation.data };\n}\n\n/**\n * Tests webhook connectivity by sending a test payload.\n * \n * @param config - Webhook configuration\n * @returns Result indicating if webhook is reachable\n */\nexport async function testWebhookConnectivity(\n  config: WebhookConfig\n): Promise<Result<void>> {\n  const testPayload: WebhookPayload = {\n    event: 'webhook.test',\n    timestamp: new Date().toISOString(),\n    data: {\n      message: 'This is a test webhook delivery',\n    },\n  };\n\n  const result = await deliverWebhook(config, testPayload);\n\n  if (!result.success) {\n    return result as Result<void>;\n  }\n\n  return { success: true, data: undefined };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}