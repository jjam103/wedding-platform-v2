{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/eventService.slugURLSafety.property.test.ts"],"sourcesContent":["/**\n * Property-Based Tests for Event Service Slug URL Safety\n * \n * **Property 23: Slug URL Safety**\n * **Validates: Requirements 24.2, 24.9**\n * \n * Tests that all generated slugs are URL-safe and follow the required pattern.\n */\n\nimport * as fc from 'fast-check';\nimport { create } from './eventService';\n\ndescribe('Feature: guest-portal-and-admin-enhancements, Property 23: Slug URL Safety', () => {\n  /**\n   * Property: All generated event slugs must be URL-safe\n   * \n   * A URL-safe slug must:\n   * - Contain only lowercase letters, numbers, and hyphens\n   * - Not start or end with a hyphen\n   * - Not contain consecutive hyphens\n   * - Contain at least one alphanumeric character\n   */\n  it('should generate URL-safe slugs from any event name', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.string({ minLength: 1, maxLength: 100 }),\n        fc.date(),\n        async (name, startDate) => {\n          // Skip names that would generate empty slugs (only special characters)\n          const hasAlphanumeric = /[a-zA-Z0-9]/.test(name);\n          if (!hasAlphanumeric) {\n            return true; // Skip this test case\n          }\n\n          const result = await create({\n            name,\n            eventType: 'ceremony',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            // If creation failed, it should be due to validation, not slug generation\n            return true;\n          }\n\n          const slug = result.data.slug;\n\n          // Slug must match URL-safe pattern: lowercase alphanumeric and hyphens only\n          expect(slug).toMatch(/^[a-z0-9-]+$/);\n\n          // Slug must not start or end with hyphen\n          expect(slug).not.toMatch(/^-/);\n          expect(slug).not.toMatch(/-$/);\n\n          // Slug must not contain consecutive hyphens\n          expect(slug).not.toMatch(/--/);\n\n          // Slug must contain at least one alphanumeric character\n          expect(slug).toMatch(/[a-z0-9]/);\n\n          return true;\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  /**\n   * Property: Slugs with special characters are normalized to URL-safe format\n   */\n  it('should normalize special characters in event names to URL-safe slugs', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.string({ minLength: 1, maxLength: 50 }).filter(s => /[a-zA-Z0-9]/.test(s)),\n        fc.constantFrom('!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '=', '+', '[', ']', '{', '}', '|', '\\\\', ':', ';', '\"', \"'\", '<', '>', ',', '.', '?', '/'),\n        fc.date(),\n        async (baseName, specialChar, startDate) => {\n          const name = `${baseName}${specialChar}${baseName}`;\n\n          const result = await create({\n            name,\n            eventType: 'reception',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          const slug = result.data.slug;\n\n          // Special characters should be removed or converted to hyphens\n          expect(slug).not.toContain(specialChar);\n          expect(slug).toMatch(/^[a-z0-9-]+$/);\n\n          return true;\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  /**\n   * Property: Slugs with unicode characters are normalized to ASCII\n   */\n  it('should normalize unicode characters in event names to ASCII slugs', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.constantFrom(\n          'Café Reception',\n          'Fiesta Española',\n          'Über Party',\n          'Naïve Ceremony',\n          'Résumé Event',\n          'Crème Brûlée Dinner'\n        ),\n        fc.date(),\n        async (name, startDate) => {\n          const result = await create({\n            name,\n            eventType: 'meal',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          const slug = result.data.slug;\n\n          // Unicode characters should be removed, leaving only ASCII\n          expect(slug).toMatch(/^[a-z0-9-]+$/);\n          expect(slug).not.toMatch(/[^\\x00-\\x7F]/); // No non-ASCII characters\n\n          return true;\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  /**\n   * Property: Slugs with excessive whitespace are normalized\n   */\n  it('should normalize excessive whitespace in event names', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.array(fc.string({ minLength: 1, maxLength: 20 }).filter(s => /[a-zA-Z0-9]/.test(s)), { minLength: 2, maxLength: 5 }),\n        fc.nat({ max: 5 }),\n        fc.date(),\n        async (words, extraSpaces, startDate) => {\n          // Join words with varying amounts of whitespace\n          const name = words.join(' '.repeat(extraSpaces + 1));\n\n          const result = await create({\n            name,\n            eventType: 'activity',\n            startDate: startDate.toISOString(),\n          });\n\n          if (!result.success) {\n            return true;\n          }\n\n          const slug = result.data.slug;\n\n          // Multiple spaces should be converted to single hyphens\n          expect(slug).not.toMatch(/--/); // No consecutive hyphens\n          expect(slug).toMatch(/^[a-z0-9-]+$/);\n\n          return true;\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n});\n"],"names":["describe","it","fc","assert","asyncProperty","string","minLength","maxLength","date","name","startDate","hasAlphanumeric","test","result","create","eventType","toISOString","success","slug","data","expect","toMatch","not","numRuns","filter","s","constantFrom","baseName","specialChar","toContain","array","nat","max","words","extraSpaces","join","repeat"],"mappings":"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"}