{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/settingsService.authMethod.test.ts"],"sourcesContent":["/**\n * Unit tests for auth method configuration in settingsService\n * \n * Tests:\n * - getDefaultAuthMethod\n * - updateDefaultAuthMethod\n * - Bulk guest updates\n */\n\nimport * as settingsService from './settingsService';\n\n// Mock supabase\njest.mock('../lib/supabase', () => ({\n  supabase: {\n    from: jest.fn(),\n    auth: {\n      getSession: jest.fn(),\n    },\n  },\n}));\n\ndescribe('settingsService - Auth Method Configuration', () => {\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    const { supabase } = require('../lib/supabase');\n    mockSupabase = supabase;\n  });\n\n  describe('getDefaultAuthMethod', () => {\n    it('should return email_matching when setting exists', async () => {\n      // Mock getSetting to return email_matching\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: { value: 'email_matching' },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.getDefaultAuthMethod();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe('email_matching');\n      }\n    });\n\n    it('should return magic_link when setting exists', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: { value: 'magic_link' },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.getDefaultAuthMethod();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe('magic_link');\n      }\n    });\n\n    it('should return email_matching as default when setting not found', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { code: 'PGRST116', message: 'Not found' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.getDefaultAuthMethod();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe('email_matching');\n      }\n    });\n\n    it('should return VALIDATION_ERROR for invalid auth method value', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: { value: 'invalid_method' },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.getDefaultAuthMethod();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n        expect(result.error.message).toContain('Invalid auth method value');\n      }\n    });\n\n    it('should return DATABASE_ERROR when database query fails', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          eq: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { code: 'PGRST000', message: 'Database error' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.getDefaultAuthMethod();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('updateDefaultAuthMethod', () => {\n    it('should update default auth method to email_matching without updating guests', async () => {\n      // Mock upsert for setting\n      mockSupabase.from.mockReturnValue({\n        upsert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                key: 'default_auth_method',\n                value: 'email_matching',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.updateDefaultAuthMethod('email_matching', false);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.updatedGuestsCount).toBe(0);\n      }\n    });\n\n    it('should update default auth method to magic_link without updating guests', async () => {\n      mockSupabase.from.mockReturnValue({\n        upsert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                key: 'default_auth_method',\n                value: 'magic_link',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.updateDefaultAuthMethod('magic_link', false);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.updatedGuestsCount).toBe(0);\n      }\n    });\n\n    it('should update default auth method and bulk update existing guests', async () => {\n      // Mock upsert for setting\n      const mockFrom = jest.fn();\n      mockSupabase.from = mockFrom;\n\n      // First call: upsert setting\n      mockFrom.mockReturnValueOnce({\n        upsert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                key: 'default_auth_method',\n                value: 'magic_link',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Second call: update guests\n      mockFrom.mockReturnValueOnce({\n        update: jest.fn().mockReturnValue({\n          neq: jest.fn().mockReturnValue({\n            select: jest.fn().mockResolvedValue({\n              data: [{ id: '1' }, { id: '2' }, { id: '3' }],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.updateDefaultAuthMethod('magic_link', true);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.updatedGuestsCount).toBe(3);\n      }\n    });\n\n    it('should return VALIDATION_ERROR for invalid auth method', async () => {\n      const result = await settingsService.updateDefaultAuthMethod(\n        'invalid_method' as any,\n        false\n      );\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('VALIDATION_ERROR');\n        expect(result.error.message).toContain('Invalid auth method');\n      }\n    });\n\n    it('should return DATABASE_ERROR when setting update fails', async () => {\n      mockSupabase.from.mockReturnValue({\n        upsert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Database error' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.updateDefaultAuthMethod('email_matching', false);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n\n    it('should return DATABASE_ERROR when guest bulk update fails', async () => {\n      const mockFrom = jest.fn();\n      mockSupabase.from = mockFrom;\n\n      // First call: upsert setting (success)\n      mockFrom.mockReturnValueOnce({\n        upsert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                key: 'default_auth_method',\n                value: 'magic_link',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Second call: update guests (failure)\n      mockFrom.mockReturnValueOnce({\n        update: jest.fn().mockReturnValue({\n          neq: jest.fn().mockReturnValue({\n            select: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Failed to update guests' },\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.updateDefaultAuthMethod('magic_link', true);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n        expect(result.error.message).toContain('Failed to update existing guests');\n      }\n    });\n\n    it('should handle zero guests needing update', async () => {\n      const mockFrom = jest.fn();\n      mockSupabase.from = mockFrom;\n\n      // First call: upsert setting\n      mockFrom.mockReturnValueOnce({\n        upsert: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: {\n                key: 'default_auth_method',\n                value: 'email_matching',\n              },\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      // Second call: update guests (no guests to update)\n      mockFrom.mockReturnValueOnce({\n        update: jest.fn().mockReturnValue({\n          neq: jest.fn().mockReturnValue({\n            select: jest.fn().mockResolvedValue({\n              data: [],\n              error: null,\n            }),\n          }),\n        }),\n      });\n\n      const result = await settingsService.updateDefaultAuthMethod('email_matching', true);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.updatedGuestsCount).toBe(0);\n      }\n    });\n  });\n});\n"],"names":["jest","mock","supabase","from","fn","auth","getSession","describe","mockSupabase","beforeEach","clearAllMocks","require","it","mockReturnValue","select","eq","single","mockResolvedValue","data","value","error","result","settingsService","getDefaultAuthMethod","expect","success","toBe","code","message","toContain","upsert","key","updateDefaultAuthMethod","updatedGuestsCount","mockFrom","mockReturnValueOnce","update","neq","id"],"mappings":"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"}