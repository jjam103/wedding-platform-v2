{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/budget/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport BudgetDashboard from '@/components/admin/BudgetDashboard';\nimport type { Vendor } from '@/schemas/vendorSchemas';\nimport type { Activity } from '@/schemas/activitySchemas';\nimport type { Accommodation } from '@/schemas/accommodationSchemas';\nimport type { BudgetBreakdown, PaymentStatusReport, SubsidyTracking } from '@/schemas/budgetSchemas';\n\n/**\n * Budget Dashboard Page\n * \n * Displays comprehensive budget overview including:\n * - Total cost, host contribution, guest payments, balance due\n * - Vendor payment tracking table\n * - Individual guest subsidies\n * - Real-time recalculation\n * \n * Requirements: 11.1-11.8\n */\nexport default function BudgetPage() {\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [accommodations, setAccommodations] = useState<Accommodation[]>([]);\n  const [budgetBreakdown, setBudgetBreakdown] = useState<BudgetBreakdown | null>(null);\n  const [paymentStatusReport, setPaymentStatusReport] = useState<PaymentStatusReport | null>(null);\n  const [subsidyTracking, setSubsidyTracking] = useState<SubsidyTracking | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Fetch all budget data\n  const fetchBudgetData = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Fetch vendors\n      const vendorsResponse = await fetch('/api/admin/vendors?pageSize=1000');\n      const vendorsData = await vendorsResponse.json();\n      if (!vendorsResponse.ok || !vendorsData.success) {\n        throw new Error(vendorsData.error?.message || 'Failed to fetch vendors');\n      }\n      setVendors(vendorsData.data.vendors);\n\n      // Fetch activities\n      const activitiesResponse = await fetch('/api/admin/activities?pageSize=1000');\n      const activitiesData = await activitiesResponse.json();\n      if (!activitiesResponse.ok || !activitiesData.success) {\n        throw new Error(activitiesData.error?.message || 'Failed to fetch activities');\n      }\n      setActivities(activitiesData.data.activities);\n\n      // Fetch accommodations\n      const accommodationsResponse = await fetch('/api/admin/accommodations?page=1&pageSize=1000');\n      const accommodationsData = await accommodationsResponse.json();\n      if (!accommodationsResponse.ok || !accommodationsData.success) {\n        throw new Error(accommodationsData.error?.message || 'Failed to fetch accommodations');\n      }\n      setAccommodations(accommodationsData.data.accommodations);\n\n      // Fetch budget breakdown\n      const breakdownResponse = await fetch('/api/admin/budget/breakdown');\n      const breakdownData = await breakdownResponse.json();\n      if (!breakdownResponse.ok || !breakdownData.success) {\n        throw new Error(breakdownData.error?.message || 'Failed to fetch budget breakdown');\n      }\n      setBudgetBreakdown(breakdownData.data);\n\n      // Fetch payment status report\n      const paymentResponse = await fetch('/api/admin/budget/payment-status');\n      const paymentData = await paymentResponse.json();\n      if (!paymentResponse.ok || !paymentData.success) {\n        throw new Error(paymentData.error?.message || 'Failed to fetch payment status');\n      }\n      setPaymentStatusReport(paymentData.data);\n\n      // Fetch subsidy tracking\n      const subsidyResponse = await fetch('/api/admin/budget/subsidies');\n      const subsidyData = await subsidyResponse.json();\n      if (!subsidyResponse.ok || !subsidyData.success) {\n        throw new Error(subsidyData.error?.message || 'Failed to fetch subsidy tracking');\n      }\n      setSubsidyTracking(subsidyData.data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load budget data');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Initial load\n  useEffect(() => {\n    fetchBudgetData();\n  }, [fetchBudgetData]);\n\n  // Real-time recalculation - refresh every 30 seconds\n  useEffect(() => {\n    const interval = setInterval(() => {\n      fetchBudgetData();\n    }, 30000);\n\n    return () => clearInterval(interval);\n  }, [fetchBudgetData]);\n\n  if (loading && !budgetBreakdown) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold text-sage-900\">Budget Dashboard</h1>\n          <p className=\"text-sage-600 mt-2\">\n            Track wedding expenses, vendor payments, and budget allocations\n          </p>\n        </div>\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"text-sage-600\">Loading budget data...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold text-sage-900\">Budget Dashboard</h1>\n          <p className=\"text-sage-600 mt-2\">\n            Track wedding expenses, vendor payments, and budget allocations\n          </p>\n        </div>\n        <div className=\"bg-volcano-50 border border-volcano-200 rounded-lg p-4\">\n          <p className=\"text-volcano-900\">Error loading budget data: {error}</p>\n          <button\n            onClick={fetchBudgetData}\n            className=\"mt-2 px-4 py-2 bg-volcano-600 text-white rounded hover:bg-volcano-700\"\n          >\n            Retry\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-6 flex justify-between items-start\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-sage-900\">Budget Dashboard</h1>\n          <p className=\"text-sage-600 mt-2\">\n            Track wedding expenses, vendor payments, and budget allocations\n          </p>\n        </div>\n        <button\n          onClick={fetchBudgetData}\n          disabled={loading}\n          className=\"px-4 py-2 bg-jungle-600 text-white rounded hover:bg-jungle-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          {loading ? 'Refreshing...' : 'Refresh Data'}\n        </button>\n      </div>\n\n      <BudgetDashboard\n        vendors={vendors}\n        activities={activities}\n        accommodations={accommodations}\n        budgetBreakdown={budgetBreakdown}\n        paymentStatusReport={paymentStatusReport}\n        subsidyTracking={subsidyTracking}\n        onRefresh={fetchBudgetData}\n      />\n    </div>\n  );\n}\n"],"names":["BudgetPage","vendors","setVendors","useState","activities","setActivities","accommodations","setAccommodations","budgetBreakdown","setBudgetBreakdown","paymentStatusReport","setPaymentStatusReport","subsidyTracking","setSubsidyTracking","loading","setLoading","error","setError","fetchBudgetData","useCallback","vendorsResponse","fetch","vendorsData","json","ok","success","Error","message","data","activitiesResponse","activitiesData","accommodationsResponse","accommodationsData","breakdownResponse","breakdownData","paymentResponse","paymentData","subsidyResponse","subsidyData","err","useEffect","interval","setInterval","clearInterval","div","className","h1","p","button","onClick","disabled","BudgetDashboard","onRefresh"],"mappings":"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"}