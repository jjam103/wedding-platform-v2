375ef682d17b44d13721197a670fb388
/**
 * Query Optimization Utilities Tests
 * 
 * Tests for database query optimization functions
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _queryOptimization = require("./queryOptimization");
describe('Query Optimization Utilities', ()=>{
    describe('getPaginationRange', ()=>{
        it('should calculate correct range for first page', ()=>{
            const result = (0, _queryOptimization.getPaginationRange)(1, 50);
            expect(result).toEqual({
                from: 0,
                to: 49
            });
        });
        it('should calculate correct range for second page', ()=>{
            const result = (0, _queryOptimization.getPaginationRange)(2, 50);
            expect(result).toEqual({
                from: 50,
                to: 99
            });
        });
        it('should calculate correct range for custom page size', ()=>{
            const result = (0, _queryOptimization.getPaginationRange)(3, 25);
            expect(result).toEqual({
                from: 50,
                to: 74
            });
        });
        it('should handle page 1 with different page sizes', ()=>{
            expect((0, _queryOptimization.getPaginationRange)(1, 10)).toEqual({
                from: 0,
                to: 9
            });
            expect((0, _queryOptimization.getPaginationRange)(1, 100)).toEqual({
                from: 0,
                to: 99
            });
        });
    });
    describe('PAGINATION_DEFAULTS', ()=>{
        it('should have correct default values', ()=>{
            expect(_queryOptimization.PAGINATION_DEFAULTS.GUESTS_PER_PAGE).toBe(50);
            expect(_queryOptimization.PAGINATION_DEFAULTS.ACTIVITIES_PER_PAGE).toBe(50);
            expect(_queryOptimization.PAGINATION_DEFAULTS.EVENTS_PER_PAGE).toBe(50);
            expect(_queryOptimization.PAGINATION_DEFAULTS.PHOTOS_PER_PAGE).toBe(50);
            expect(_queryOptimization.PAGINATION_DEFAULTS.EMAIL_HISTORY_PER_PAGE).toBe(50);
            expect(_queryOptimization.PAGINATION_DEFAULTS.AUDIT_LOGS_PER_PAGE).toBe(100);
        });
    });
    describe('fetchGuestsWithRSVPs', ()=>{
        it('should build query with default pagination', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchGuestsWithRSVPs)(mockSupabase);
            expect(mockSupabase.from).toHaveBeenCalledWith('guests');
            expect(mockSupabase.select).toHaveBeenCalledWith(expect.stringContaining('rsvps'), {
                count: 'exact'
            });
            expect(mockSupabase.range).toHaveBeenCalledWith(0, 49);
            expect(mockSupabase.order).toHaveBeenCalledWith('last_name', {
                ascending: true
            });
        });
        it('should filter by group ID when provided', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchGuestsWithRSVPs)(mockSupabase, {
                groupId: 'group-123'
            });
            expect(mockSupabase.eq).toHaveBeenCalledWith('group_id', 'group-123');
        });
        it('should use custom pagination', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchGuestsWithRSVPs)(mockSupabase, {
                page: 2,
                pageSize: 25
            });
            expect(mockSupabase.range).toHaveBeenCalledWith(25, 49);
        });
    });
    describe('fetchEventsWithActivities', ()=>{
        it('should build query with default pagination', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchEventsWithActivities)(mockSupabase);
            expect(mockSupabase.from).toHaveBeenCalledWith('events');
            expect(mockSupabase.select).toHaveBeenCalledWith(expect.stringContaining('activities'), {
                count: 'exact'
            });
            expect(mockSupabase.range).toHaveBeenCalledWith(0, 49);
            expect(mockSupabase.order).toHaveBeenCalledWith('event_date', {
                ascending: true
            });
        });
        it('should filter active events by default', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchEventsWithActivities)(mockSupabase);
            expect(mockSupabase.eq).toHaveBeenCalledWith('is_active', true);
        });
        it('should include inactive events when requested', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchEventsWithActivities)(mockSupabase, {
                includeInactive: true
            });
            expect(mockSupabase.eq).not.toHaveBeenCalled();
        });
    });
    describe('fetchActivitiesWithRSVPs', ()=>{
        it('should build query with default pagination', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchActivitiesWithRSVPs)(mockSupabase);
            expect(mockSupabase.from).toHaveBeenCalledWith('activities');
            expect(mockSupabase.select).toHaveBeenCalledWith(expect.stringContaining('rsvps'), {
                count: 'exact'
            });
            expect(mockSupabase.range).toHaveBeenCalledWith(0, 49);
            expect(mockSupabase.order).toHaveBeenCalledWith('activity_date', {
                ascending: true
            });
        });
        it('should filter by event ID when provided', ()=>{
            const mockSupabase = createMockSupabaseClient();
            (0, _queryOptimization.fetchActivitiesWithRSVPs)(mockSupabase, {
                eventId: 'event-123'
            });
            expect(mockSupabase.eq).toHaveBeenCalledWith('event_id', 'event-123');
        });
    });
    describe('batchFetchByIds', ()=>{
        it('should return empty array for empty IDs', async ()=>{
            const mockSupabase = createMockSupabaseClient();
            const result = await (0, _queryOptimization.batchFetchByIds)(mockSupabase, 'guests', []);
            expect(result).toEqual({
                data: [],
                error: null
            });
            expect(mockSupabase.from).not.toHaveBeenCalled();
        });
        it('should fetch multiple entities by IDs', async ()=>{
            const mockSupabase = createMockSupabaseClient();
            const ids = [
                'id-1',
                'id-2',
                'id-3'
            ];
            await (0, _queryOptimization.batchFetchByIds)(mockSupabase, 'guests', ids);
            expect(mockSupabase.from).toHaveBeenCalledWith('guests');
            expect(mockSupabase.select).toHaveBeenCalledWith('*');
            expect(mockSupabase.in).toHaveBeenCalledWith('id', ids);
        });
        it('should use custom select fields', async ()=>{
            const mockSupabase = createMockSupabaseClient();
            const ids = [
                'id-1',
                'id-2'
            ];
            await (0, _queryOptimization.batchFetchByIds)(mockSupabase, 'guests', ids, 'id, first_name, last_name');
            expect(mockSupabase.select).toHaveBeenCalledWith('id, first_name, last_name');
        });
    });
});
// Mock Supabase client for testing
function createMockSupabaseClient() {
    const mockChain = {
        from: jest.fn().mockReturnThis(),
        select: jest.fn().mockReturnThis(),
        eq: jest.fn().mockReturnThis(),
        in: jest.fn().mockReturnThis(),
        range: jest.fn().mockReturnThis(),
        order: jest.fn().mockReturnThis(),
        single: jest.fn().mockResolvedValue({
            data: null,
            error: null
        }),
        maybeSingle: jest.fn().mockResolvedValue({
            data: null,
            error: null
        })
    };
    return mockChain;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvbGliL3F1ZXJ5T3B0aW1pemF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBRdWVyeSBPcHRpbWl6YXRpb24gVXRpbGl0aWVzIFRlc3RzXG4gKiBcbiAqIFRlc3RzIGZvciBkYXRhYmFzZSBxdWVyeSBvcHRpbWl6YXRpb24gZnVuY3Rpb25zXG4gKi9cblxuaW1wb3J0IHtcbiAgZ2V0UGFnaW5hdGlvblJhbmdlLFxuICBQQUdJTkFUSU9OX0RFRkFVTFRTLFxuICBmZXRjaEd1ZXN0c1dpdGhSU1ZQcyxcbiAgZmV0Y2hFdmVudHNXaXRoQWN0aXZpdGllcyxcbiAgZmV0Y2hBY3Rpdml0aWVzV2l0aFJTVlBzLFxuICBiYXRjaEZldGNoQnlJZHMsXG59IGZyb20gJy4vcXVlcnlPcHRpbWl6YXRpb24nO1xuXG5kZXNjcmliZSgnUXVlcnkgT3B0aW1pemF0aW9uIFV0aWxpdGllcycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ2dldFBhZ2luYXRpb25SYW5nZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjb3JyZWN0IHJhbmdlIGZvciBmaXJzdCBwYWdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gZ2V0UGFnaW5hdGlvblJhbmdlKDEsIDUwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBmcm9tOiAwLCB0bzogNDkgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjb3JyZWN0IHJhbmdlIGZvciBzZWNvbmQgcGFnZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGdldFBhZ2luYXRpb25SYW5nZSgyLCA1MCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgZnJvbTogNTAsIHRvOiA5OSB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGNvcnJlY3QgcmFuZ2UgZm9yIGN1c3RvbSBwYWdlIHNpemUnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBnZXRQYWdpbmF0aW9uUmFuZ2UoMywgMjUpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IGZyb206IDUwLCB0bzogNzQgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwYWdlIDEgd2l0aCBkaWZmZXJlbnQgcGFnZSBzaXplcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChnZXRQYWdpbmF0aW9uUmFuZ2UoMSwgMTApKS50b0VxdWFsKHsgZnJvbTogMCwgdG86IDkgfSk7XG4gICAgICBleHBlY3QoZ2V0UGFnaW5hdGlvblJhbmdlKDEsIDEwMCkpLnRvRXF1YWwoeyBmcm9tOiAwLCB0bzogOTkgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQQUdJTkFUSU9OX0RFRkFVTFRTJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IGRlZmF1bHQgdmFsdWVzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KFBBR0lOQVRJT05fREVGQVVMVFMuR1VFU1RTX1BFUl9QQUdFKS50b0JlKDUwKTtcbiAgICAgIGV4cGVjdChQQUdJTkFUSU9OX0RFRkFVTFRTLkFDVElWSVRJRVNfUEVSX1BBR0UpLnRvQmUoNTApO1xuICAgICAgZXhwZWN0KFBBR0lOQVRJT05fREVGQVVMVFMuRVZFTlRTX1BFUl9QQUdFKS50b0JlKDUwKTtcbiAgICAgIGV4cGVjdChQQUdJTkFUSU9OX0RFRkFVTFRTLlBIT1RPU19QRVJfUEFHRSkudG9CZSg1MCk7XG4gICAgICBleHBlY3QoUEFHSU5BVElPTl9ERUZBVUxUUy5FTUFJTF9ISVNUT1JZX1BFUl9QQUdFKS50b0JlKDUwKTtcbiAgICAgIGV4cGVjdChQQUdJTkFUSU9OX0RFRkFVTFRTLkFVRElUX0xPR1NfUEVSX1BBR0UpLnRvQmUoMTAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZldGNoR3Vlc3RzV2l0aFJTVlBzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYnVpbGQgcXVlcnkgd2l0aCBkZWZhdWx0IHBhZ2luYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrU3VwYWJhc2UgPSBjcmVhdGVNb2NrU3VwYWJhc2VDbGllbnQoKTtcbiAgICAgIFxuICAgICAgZmV0Y2hHdWVzdHNXaXRoUlNWUHMobW9ja1N1cGFiYXNlIGFzIGFueSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2UuZnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2d1ZXN0cycpO1xuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5zZWxlY3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygncnN2cHMnKSxcbiAgICAgICAgeyBjb3VudDogJ2V4YWN0JyB9XG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5yYW5nZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMCwgNDkpO1xuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5vcmRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2xhc3RfbmFtZScsIHsgYXNjZW5kaW5nOiB0cnVlIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgZ3JvdXAgSUQgd2hlbiBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdXBhYmFzZSA9IGNyZWF0ZU1vY2tTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgXG4gICAgICBmZXRjaEd1ZXN0c1dpdGhSU1ZQcyhtb2NrU3VwYWJhc2UgYXMgYW55LCB7IGdyb3VwSWQ6ICdncm91cC0xMjMnIH0pO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlLmVxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZ3JvdXBfaWQnLCAnZ3JvdXAtMTIzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBjdXN0b20gcGFnaW5hdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdXBhYmFzZSA9IGNyZWF0ZU1vY2tTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgXG4gICAgICBmZXRjaEd1ZXN0c1dpdGhSU1ZQcyhtb2NrU3VwYWJhc2UgYXMgYW55LCB7IHBhZ2U6IDIsIHBhZ2VTaXplOiAyNSB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5yYW5nZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjUsIDQ5KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZldGNoRXZlbnRzV2l0aEFjdGl2aXRpZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBidWlsZCBxdWVyeSB3aXRoIGRlZmF1bHQgcGFnaW5hdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdXBhYmFzZSA9IGNyZWF0ZU1vY2tTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgXG4gICAgICBmZXRjaEV2ZW50c1dpdGhBY3Rpdml0aWVzKG1vY2tTdXBhYmFzZSBhcyBhbnkpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlLmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudHMnKTtcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2Uuc2VsZWN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2FjdGl2aXRpZXMnKSxcbiAgICAgICAgeyBjb3VudDogJ2V4YWN0JyB9XG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5yYW5nZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMCwgNDkpO1xuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5vcmRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50X2RhdGUnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIGFjdGl2ZSBldmVudHMgYnkgZGVmYXVsdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdXBhYmFzZSA9IGNyZWF0ZU1vY2tTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgXG4gICAgICBmZXRjaEV2ZW50c1dpdGhBY3Rpdml0aWVzKG1vY2tTdXBhYmFzZSBhcyBhbnkpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlLmVxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaXNfYWN0aXZlJywgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgaW5hY3RpdmUgZXZlbnRzIHdoZW4gcmVxdWVzdGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1N1cGFiYXNlID0gY3JlYXRlTW9ja1N1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBcbiAgICAgIGZldGNoRXZlbnRzV2l0aEFjdGl2aXRpZXMobW9ja1N1cGFiYXNlIGFzIGFueSwgeyBpbmNsdWRlSW5hY3RpdmU6IHRydWUgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2UuZXEpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmZXRjaEFjdGl2aXRpZXNXaXRoUlNWUHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBidWlsZCBxdWVyeSB3aXRoIGRlZmF1bHQgcGFnaW5hdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdXBhYmFzZSA9IGNyZWF0ZU1vY2tTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgXG4gICAgICBmZXRjaEFjdGl2aXRpZXNXaXRoUlNWUHMobW9ja1N1cGFiYXNlIGFzIGFueSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2UuZnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FjdGl2aXRpZXMnKTtcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2Uuc2VsZWN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ3JzdnBzJyksXG4gICAgICAgIHsgY291bnQ6ICdleGFjdCcgfVxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2UucmFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDAsIDQ5KTtcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2Uub3JkZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdhY3Rpdml0eV9kYXRlJywgeyBhc2NlbmRpbmc6IHRydWUgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBieSBldmVudCBJRCB3aGVuIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1N1cGFiYXNlID0gY3JlYXRlTW9ja1N1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBcbiAgICAgIGZldGNoQWN0aXZpdGllc1dpdGhSU1ZQcyhtb2NrU3VwYWJhc2UgYXMgYW55LCB7IGV2ZW50SWQ6ICdldmVudC0xMjMnIH0pO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlLmVxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXZlbnRfaWQnLCAnZXZlbnQtMTIzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdiYXRjaEZldGNoQnlJZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgZm9yIGVtcHR5IElEcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdXBhYmFzZSA9IGNyZWF0ZU1vY2tTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiYXRjaEZldGNoQnlJZHMobW9ja1N1cGFiYXNlIGFzIGFueSwgJ2d1ZXN0cycsIFtdKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IGRhdGE6IFtdLCBlcnJvcjogbnVsbCB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2UuZnJvbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmV0Y2ggbXVsdGlwbGUgZW50aXRpZXMgYnkgSURzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1N1cGFiYXNlID0gY3JlYXRlTW9ja1N1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBjb25zdCBpZHMgPSBbJ2lkLTEnLCAnaWQtMicsICdpZC0zJ107XG4gICAgICBcbiAgICAgIGF3YWl0IGJhdGNoRmV0Y2hCeUlkcyhtb2NrU3VwYWJhc2UgYXMgYW55LCAnZ3Vlc3RzJywgaWRzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5mcm9tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZ3Vlc3RzJyk7XG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlLnNlbGVjdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJyonKTtcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2UuaW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpZCcsIGlkcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBjdXN0b20gc2VsZWN0IGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdXBhYmFzZSA9IGNyZWF0ZU1vY2tTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgY29uc3QgaWRzID0gWydpZC0xJywgJ2lkLTInXTtcbiAgICAgIFxuICAgICAgYXdhaXQgYmF0Y2hGZXRjaEJ5SWRzKG1vY2tTdXBhYmFzZSBhcyBhbnksICdndWVzdHMnLCBpZHMsICdpZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2Uuc2VsZWN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG4vLyBNb2NrIFN1cGFiYXNlIGNsaWVudCBmb3IgdGVzdGluZ1xuZnVuY3Rpb24gY3JlYXRlTW9ja1N1cGFiYXNlQ2xpZW50KCkge1xuICBjb25zdCBtb2NrQ2hhaW4gPSB7XG4gICAgZnJvbTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgaW46IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgIHJhbmdlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBvcmRlcjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSxcbiAgICBtYXliZVNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbnVsbCwgZXJyb3I6IG51bGwgfSksXG4gIH07XG5cbiAgcmV0dXJuIG1vY2tDaGFpbjtcbn1cbiJdLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0IiwicmVzdWx0IiwiZ2V0UGFnaW5hdGlvblJhbmdlIiwiZXhwZWN0IiwidG9FcXVhbCIsImZyb20iLCJ0byIsIlBBR0lOQVRJT05fREVGQVVMVFMiLCJHVUVTVFNfUEVSX1BBR0UiLCJ0b0JlIiwiQUNUSVZJVElFU19QRVJfUEFHRSIsIkVWRU5UU19QRVJfUEFHRSIsIlBIT1RPU19QRVJfUEFHRSIsIkVNQUlMX0hJU1RPUllfUEVSX1BBR0UiLCJBVURJVF9MT0dTX1BFUl9QQUdFIiwibW9ja1N1cGFiYXNlIiwiY3JlYXRlTW9ja1N1cGFiYXNlQ2xpZW50IiwiZmV0Y2hHdWVzdHNXaXRoUlNWUHMiLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsInNlbGVjdCIsInN0cmluZ0NvbnRhaW5pbmciLCJjb3VudCIsInJhbmdlIiwib3JkZXIiLCJhc2NlbmRpbmciLCJncm91cElkIiwiZXEiLCJwYWdlIiwicGFnZVNpemUiLCJmZXRjaEV2ZW50c1dpdGhBY3Rpdml0aWVzIiwiaW5jbHVkZUluYWN0aXZlIiwibm90IiwidG9IYXZlQmVlbkNhbGxlZCIsImZldGNoQWN0aXZpdGllc1dpdGhSU1ZQcyIsImV2ZW50SWQiLCJiYXRjaEZldGNoQnlJZHMiLCJkYXRhIiwiZXJyb3IiLCJpZHMiLCJpbiIsIm1vY2tDaGFpbiIsImplc3QiLCJmbiIsIm1vY2tSZXR1cm5UaGlzIiwic2luZ2xlIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJtYXliZVNpbmdsZSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Q0FJQzs7OzttQ0FTTTtBQUVQQSxTQUFTLGdDQUFnQztJQUN2Q0EsU0FBUyxzQkFBc0I7UUFDN0JDLEdBQUcsaURBQWlEO1lBQ2xELE1BQU1DLFNBQVNDLElBQUFBLHFDQUFrQixFQUFDLEdBQUc7WUFDckNDLE9BQU9GLFFBQVFHLE9BQU8sQ0FBQztnQkFBRUMsTUFBTTtnQkFBR0MsSUFBSTtZQUFHO1FBQzNDO1FBRUFOLEdBQUcsa0RBQWtEO1lBQ25ELE1BQU1DLFNBQVNDLElBQUFBLHFDQUFrQixFQUFDLEdBQUc7WUFDckNDLE9BQU9GLFFBQVFHLE9BQU8sQ0FBQztnQkFBRUMsTUFBTTtnQkFBSUMsSUFBSTtZQUFHO1FBQzVDO1FBRUFOLEdBQUcsdURBQXVEO1lBQ3hELE1BQU1DLFNBQVNDLElBQUFBLHFDQUFrQixFQUFDLEdBQUc7WUFDckNDLE9BQU9GLFFBQVFHLE9BQU8sQ0FBQztnQkFBRUMsTUFBTTtnQkFBSUMsSUFBSTtZQUFHO1FBQzVDO1FBRUFOLEdBQUcsa0RBQWtEO1lBQ25ERyxPQUFPRCxJQUFBQSxxQ0FBa0IsRUFBQyxHQUFHLEtBQUtFLE9BQU8sQ0FBQztnQkFBRUMsTUFBTTtnQkFBR0MsSUFBSTtZQUFFO1lBQzNESCxPQUFPRCxJQUFBQSxxQ0FBa0IsRUFBQyxHQUFHLE1BQU1FLE9BQU8sQ0FBQztnQkFBRUMsTUFBTTtnQkFBR0MsSUFBSTtZQUFHO1FBQy9EO0lBQ0Y7SUFFQVAsU0FBUyx1QkFBdUI7UUFDOUJDLEdBQUcsc0NBQXNDO1lBQ3ZDRyxPQUFPSSxzQ0FBbUIsQ0FB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