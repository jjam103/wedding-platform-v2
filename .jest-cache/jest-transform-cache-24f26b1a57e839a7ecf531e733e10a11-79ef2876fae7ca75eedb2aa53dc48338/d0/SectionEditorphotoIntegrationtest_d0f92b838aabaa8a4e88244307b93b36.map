{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/SectionEditor.photoIntegration.test.tsx"],"sourcesContent":["/**\n * Unit Tests for SectionEditor Photo Integration\n * \n * Tests:\n * - Photo selection\n * - Multiple photo handling\n * - Photo preview\n * \n * Requirements: 2.4\n */\n\nimport { render, screen, fireEvent, waitFor, cleanup } from '@testing-library/react';\nimport { SectionEditor } from './SectionEditor';\n\n// Mock fetch globally\nglobal.fetch = jest.fn();\n\n// Mock window.confirm\nconst originalConfirm = window.confirm;\n\n// Mock scrollIntoView\nElement.prototype.scrollIntoView = jest.fn();\n\n// Mock photo data\nconst mockPhotos = [\n  {\n    id: 'photo-1',\n    photo_url: 'https://example.com/photo1.jpg',\n    caption: 'Beach sunset',\n    alt_text: 'Beautiful sunset at the beach',\n    moderation_status: 'approved' as const,\n    created_at: '2025-01-01T00:00:00Z',\n  },\n  {\n    id: 'photo-2',\n    photo_url: 'https://example.com/photo2.jpg',\n    caption: 'Wedding ceremony',\n    alt_text: 'Ceremony at the venue',\n    moderation_status: 'approved' as const,\n    created_at: '2025-01-02T00:00:00Z',\n  },\n  {\n    id: 'photo-3',\n    photo_url: 'https://example.com/photo3.jpg',\n    caption: 'Reception dinner',\n    alt_text: 'Dinner reception',\n    moderation_status: 'approved' as const,\n    created_at: '2025-01-03T00:00:00Z',\n  },\n];\n\n// Mock section with photo gallery column\nconst mockPhotoSection = {\n  id: 'section-1',\n  page_type: 'custom' as const,\n  page_id: 'page-1',\n  display_order: 0,\n  created_at: '2024-01-01T00:00:00Z',\n  updated_at: '2024-01-01T00:00:00Z',\n  columns: [\n    {\n      id: 'column-1',\n      section_id: 'section-1',\n      column_number: 1 as const,\n      content_type: 'photo_gallery' as const,\n      content_data: { photo_ids: [] },\n      created_at: '2024-01-01T00:00:00Z',\n      updated_at: '2024-01-01T00:00:00Z',\n    },\n  ],\n};\n\nconst mockPhotoSectionWithPhotos = {\n  ...mockPhotoSection,\n  columns: [\n    {\n      ...mockPhotoSection.columns[0],\n      content_data: { photo_ids: ['photo-1', 'photo-2'] },\n    },\n  ],\n};\n\ndescribe('SectionEditor - Photo Integration', () => {\n  let mockOnSave: jest.Mock;\n  let mockOnClose: jest.Mock;\n\n  beforeEach(() => {\n    mockOnSave = jest.fn();\n    mockOnClose = jest.fn();\n    window.confirm = jest.fn().mockReturnValue(true);\n    (global.fetch as jest.Mock).mockReset();\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    cleanup();\n    window.confirm = originalConfirm;\n  });\n\n  const mockFetchSuccess = (data: any) => {\n    (global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ success: true, data }),\n    });\n  };\n\n  describe('Photo Selection', () => {\n    it('should display PhotoPicker component for photo_gallery column type', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // PhotoPicker should render the \"Add Photos from Gallery\" button\n      expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n    });\n\n    it('should open photo picker modal when add photos button is clicked', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // Photos API response\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n    });\n\n    it('should fetch photos when photo picker opens', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 });\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('/api/admin/photos')\n        );\n      });\n    });\n\n    it('should update section when photo is selected', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // Photos API\n      mockFetchSuccess(mockPhotoSectionWithPhotos); // Update section API\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByAltText('Beautiful sunset at the beach')).toBeInTheDocument();\n      });\n\n      // Select a photo\n      fireEvent.click(screen.getByAltText('Beautiful sunset at the beach'));\n\n      // Close the modal\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('/api/admin/sections/section-1'),\n          expect.objectContaining({\n            method: 'PUT',\n            body: expect.stringContaining('photo_ids'),\n          })\n        );\n      });\n    });\n\n    it('should pass correct pageType to PhotoPicker', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"event\"\n          pageId=\"event-123\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // The PhotoPicker should be rendered with the correct pageType\n      // This is verified by checking that the component renders\n      expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n    });\n\n    it('should pass correct pageId to PhotoPicker', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 });\n\n      render(\n        <SectionEditor\n          pageType=\"activity\"\n          pageId=\"activity-456\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('page_id=activity-456')\n        );\n      });\n    });\n\n    it('should disable photo picker when section is saving', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      \n      // Mock a delayed response for section update\n      (global.fetch as jest.Mock).mockImplementationOnce(() =>\n        new Promise(resolve => setTimeout(() => resolve({\n          ok: true,\n          json: async () => ({ success: true, data: mockPhotoSection }),\n        }), 100))\n      );\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // Trigger a save operation by toggling layout\n      const layoutButton = screen.getByRole('button', { name: /toggle to two column layout/i });\n      fireEvent.click(layoutButton);\n\n      // Photo picker button should be disabled during save\n      const addPhotosButton = screen.getByText('+ Add Photos from Gallery');\n      expect(addPhotosButton).toBeDisabled();\n    });\n  });\n\n  describe('Multiple Photo Handling', () => {\n    it('should display selected photos count', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n    });\n\n    it('should display all selected photos in preview grid', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Open photo picker to trigger photo fetch\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n\n      // Close picker\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Should display 2 photo previews in the grid\n        const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n        expect(photoGrid).toBeInTheDocument();\n        \n        // Grid should contain photo elements\n        const images = photoGrid?.querySelectorAll('img');\n        expect(images?.length).toBe(2);\n      });\n    });\n\n    it('should allow selecting multiple photos', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // Photos API\n      mockFetchSuccess(mockPhotoSection); // First update with 1 photo\n      mockFetchSuccess(mockPhotoSectionWithPhotos); // Second update with 2 photos\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByAltText('Beautiful sunset at the beach')).toBeInTheDocument();\n      });\n\n      // Select first photo\n      fireEvent.click(screen.getByAltText('Beautiful sunset at the beach'));\n      \n      // Wait for first update\n      await waitFor(() => {\n        const firstUpdateCall = (global.fetch as jest.Mock).mock.calls.find(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(firstUpdateCall).toBeDefined();\n      });\n\n      // Select second photo\n      fireEvent.click(screen.getByAltText('Ceremony at the venue'));\n\n      // Close modal\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Should have made at least 2 update calls (one for each photo selection)\n        const updateCalls = (global.fetch as jest.Mock).mock.calls.filter(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(updateCalls.length).toBeGreaterThanOrEqual(1);\n        \n        // The last update should contain both photos\n        const lastUpdateCall = updateCalls[updateCalls.length - 1];\n        if (lastUpdateCall) {\n          const body = JSON.parse(lastUpdateCall[1].body);\n          // Should have at least one photo selected\n          expect(body.columns[0].content_data.photo_ids.length).toBeGreaterThan(0);\n        }\n      });\n    });\n\n    it('should allow removing individual photos from selection', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker to fetch photos\n      mockFetchSuccess(mockPhotoSection); // Update with 0 photos\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Open photo picker to trigger photo fetch\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n\n      // Close picker\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Find and click remove button on first photo\n        const removeButtons = screen.getAllByLabelText('Remove photo');\n        expect(removeButtons.length).toBeGreaterThan(0);\n        fireEvent.click(removeButtons[0]);\n      });\n\n      await waitFor(() => {\n        expect(global.fetch).toHaveBeenCalledWith(\n          expect.stringContaining('/api/admin/sections/section-1'),\n          expect.objectContaining({\n            method: 'PUT',\n          })\n        );\n      });\n    });\n\n    it('should allow clearing all selected photos', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess(mockPhotoSection); // Update with 0 photos\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Click \"Clear All\" button\n      fireEvent.click(screen.getByText('Clear All'));\n\n      await waitFor(() => {\n        const updateCall = (global.fetch as jest.Mock).mock.calls.find(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(updateCall).toBeDefined();\n        const body = JSON.parse(updateCall[1].body);\n        expect(body.columns[0].content_data.photo_ids).toHaveLength(0);\n      });\n    });\n\n    it('should maintain photo order in selection', async () => {\n      const orderedPhotoSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_data: { photo_ids: ['photo-3', 'photo-1', 'photo-2'] },\n          },\n        ],\n      };\n      mockFetchSuccess([orderedPhotoSection]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (3)')).toBeInTheDocument();\n      });\n\n      // Open photo picker to trigger photo fetch\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n\n      // Close picker\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Photos should be displayed in the order they were selected\n        const photoGrid = screen.getByText('Selected Photos (3)').closest('.border');\n        const images = photoGrid?.querySelectorAll('img');\n        \n        expect(images?.length).toBe(3);\n        // Order should be maintained (photo-3, photo-1, photo-2)\n      });\n    });\n\n    it('should handle empty photo selection', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // Should not show \"Selected Photos\" section when no photos selected\n      expect(screen.queryByText(/Selected Photos/)).not.toBeInTheDocument();\n      \n      // Should show the add photos button\n      expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n    });\n  });\n\n  describe('Photo Preview', () => {\n    it('should display photo thumbnails in selected photos section', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Open photo picker to trigger photo fetch\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n\n      // Close picker\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Should display photo thumbnails\n        const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n        const images = photoGrid?.querySelectorAll('img');\n        \n        expect(images?.length).toBe(2);\n      });\n    });\n\n    it('should display photo captions in preview', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker to resolve photo details\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Captions should be visible in the preview grid\n      const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n      expect(photoGrid).toBeInTheDocument();\n    });\n\n    it('should show photos in guest preview modal', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // Open preview modal\n      fireEvent.click(screen.getByRole('button', { name: /preview as guest/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Guest Preview')).toBeInTheDocument();\n      });\n\n      // Preview should show photo placeholders\n      const previewModal = screen.getByText('Guest Preview').closest('.bg-white');\n      expect(previewModal).toBeInTheDocument();\n      \n      // Should display photo IDs in preview\n      expect(previewModal?.textContent).toContain('photo-1');\n      expect(previewModal?.textContent).toContain('photo-2');\n    });\n\n    it('should show \"No photos selected\" message in preview when empty', async () => {\n      mockFetchSuccess([mockPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // Open preview modal\n      fireEvent.click(screen.getByRole('button', { name: /preview as guest/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Guest Preview')).toBeInTheDocument();\n      });\n\n      // Should show empty state message\n      expect(screen.getByText('No photos selected')).toBeInTheDocument();\n    });\n\n    it('should display photo grid layout in preview', async () => {\n      const multiPhotoSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_data: { photo_ids: ['photo-1', 'photo-2', 'photo-3'] },\n          },\n        ],\n      };\n      mockFetchSuccess([multiPhotoSection]);\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // Open preview modal\n      fireEvent.click(screen.getByRole('button', { name: /preview as guest/i }));\n\n      await waitFor(() => {\n        expect(screen.getByText('Guest Preview')).toBeInTheDocument();\n      });\n\n      // Preview should use grid layout for photos\n      const previewModal = screen.getByText('Guest Preview').closest('.bg-white');\n      const photoGrid = previewModal?.querySelector('.grid.grid-cols-2');\n      expect(photoGrid).toBeInTheDocument();\n    });\n\n    it('should show hover effects on photo thumbnails', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Open photo picker to trigger photo fetch\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n\n      // Close picker\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Photo containers should have group class for hover effects\n        const photoGrid = screen.getByText('Selected Photos (2)').closest('.border');\n        const photoContainers = photoGrid?.querySelectorAll('.group');\n        \n        expect(photoContainers?.length).toBeGreaterThan(0);\n      });\n    });\n\n    it('should display remove button on hover', async () => {\n      mockFetchSuccess([mockPhotoSectionWithPhotos]);\n      mockFetchSuccess({ photos: mockPhotos, total: 3 }); // For PhotoPicker\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Selected Photos (2)')).toBeInTheDocument();\n      });\n\n      // Open photo picker to trigger photo fetch\n      fireEvent.click(screen.getByText('+ Add Photos from Gallery'));\n\n      await waitFor(() => {\n        expect(screen.getByText('Select Photos')).toBeInTheDocument();\n      });\n\n      // Close picker\n      fireEvent.click(screen.getByText('Done'));\n\n      await waitFor(() => {\n        // Remove buttons should be present (with opacity-0 initially)\n        const removeButtons = screen.getAllByLabelText('Remove photo');\n        expect(removeButtons.length).toBe(2);\n        \n        // Buttons should have group-hover:opacity-100 class\n        removeButtons.forEach(button => {\n          expect(button.className).toContain('group-hover:opacity-100');\n        });\n      });\n    });\n  });\n\n  describe('Column Type Change to Photo Gallery', () => {\n    it('should initialize empty photo_ids when changing to photo_gallery type', async () => {\n      const richTextSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_type: 'rich_text' as const,\n            content_data: { html: '<p>Some text</p>' },\n          },\n        ],\n      };\n      mockFetchSuccess([richTextSection]);\n      mockFetchSuccess(mockPhotoSection); // Updated to photo_gallery\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // Change column type to photo_gallery\n      const select = screen.getByRole('combobox');\n      fireEvent.change(select, { target: { value: 'photo_gallery' } });\n\n      await waitFor(() => {\n        const updateCall = (global.fetch as jest.Mock).mock.calls.find(\n          call => call[0].includes('/api/admin/sections/section-1') && call[1]?.method === 'PUT'\n        );\n        expect(updateCall).toBeDefined();\n        const body = JSON.parse(updateCall[1].body);\n        expect(body.columns[0].content_type).toBe('photo_gallery');\n        expect(body.columns[0].content_data).toEqual({ photo_ids: [] });\n      });\n    });\n\n    it('should display PhotoPicker after changing column type to photo_gallery', async () => {\n      const richTextSection = {\n        ...mockPhotoSection,\n        columns: [\n          {\n            ...mockPhotoSection.columns[0],\n            content_type: 'rich_text' as const,\n            content_data: { html: '<p>Some text</p>' },\n          },\n        ],\n      };\n      mockFetchSuccess([richTextSection]);\n      mockFetchSuccess(mockPhotoSection); // Updated to photo_gallery\n\n      render(\n        <SectionEditor\n          pageType=\"custom\"\n          pageId=\"page-1\"\n          onSave={mockOnSave}\n          onClose={mockOnClose}\n        />\n      );\n\n      await waitFor(() => {\n        expect(screen.getByText('Section 1')).toBeInTheDocument();\n      });\n\n      // Change column type to photo_gallery\n      const select = screen.getByRole('combobox');\n      fireEvent.change(select, { target: { value: 'photo_gallery' } });\n\n      await waitFor(() => {\n        expect(screen.getByText('+ Add Photos from Gallery')).toBeInTheDocument();\n      });\n    });\n  });\n});\n"],"names":["global","fetch","jest","fn","originalConfirm","window","confirm","Element","prototype","scrollIntoView","mockPhotos","id","photo_url","caption","alt_text","moderation_status","created_at","mockPhotoSection","page_type","page_id","display_order","updated_at","columns","section_id","column_number","content_type","content_data","photo_ids","mockPhotoSectionWithPhotos","describe","mockOnSave","mockOnClose","beforeEach","mockReturnValue","mockReset","clearAllMocks","afterEach","cleanup","mockFetchSuccess","data","mockResolvedValueOnce","ok","json","success","it","render","SectionEditor","pageType","pageId","onSave","onClose","waitFor","expect","screen","getByText","toBeInTheDocument","photos","total","fireEvent","click","toHaveBeenCalledWith","stringContaining","getByAltText","objectContaining","method","body","mockImplementationOnce","Promise","resolve","setTimeout","layoutButton","getByRole","name","addPhotosButton","toBeDisabled","photoGrid","closest","images","querySelectorAll","length","toBe","firstUpdateCall","mock","calls","find","call","includes","toBeDefined","updateCalls","filter","toBeGreaterThanOrEqual","lastUpdateCall","JSON","parse","toBeGreaterThan","removeButtons","getAllByLabelText","updateCall","toHaveLength","orderedPhotoSection","queryByText","not","previewModal","textContent","toContain","multiPhotoSection","querySelector","photoContainers","forEach","button","className","richTextSection","html","select","change","target","value","toEqual"],"mappings":"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"}