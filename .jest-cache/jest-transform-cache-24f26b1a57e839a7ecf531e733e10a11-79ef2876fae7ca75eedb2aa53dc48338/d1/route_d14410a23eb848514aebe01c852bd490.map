{"version":3,"names":["GET","request","cov_97qv9l1gp","f","s","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","searchParams","URL","url","filters","has","recipient_email","get","delivery_status","template_id","limit","parseInt","dateFrom","dateTo","result","_emailService","getEmailLogs","filteredLogs","fromDate","Date","filter","log","created_at","toDate","setHours"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/emails/history/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport * as emailService from '@/services/emailService';\n\n/**\n * GET /api/admin/emails/history\n * Returns email history with delivery status\n * Requirements: 4.6, 4.7\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. Auth check\n    const supabase = createRouteHandlerClient({ cookies });\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. Parse query parameters\n    const { searchParams } = new URL(request.url);\n    const filters: any = {};\n\n    if (searchParams.has('recipient')) {\n      filters.recipient_email = searchParams.get('recipient');\n    }\n\n    if (searchParams.has('status')) {\n      filters.delivery_status = searchParams.get('status');\n    }\n\n    if (searchParams.has('template_id')) {\n      filters.template_id = searchParams.get('template_id');\n    }\n\n    if (searchParams.has('limit')) {\n      filters.limit = parseInt(searchParams.get('limit') || '50', 10);\n    }\n\n    // Date range filtering\n    const dateFrom = searchParams.get('date_from');\n    const dateTo = searchParams.get('date_to');\n\n    // 3. Call service\n    const result = await emailService.getEmailLogs(filters);\n\n    if (!result.success) {\n      return NextResponse.json(result, { status: 500 });\n    }\n\n    // 4. Apply date filtering if needed (service doesn't support it yet)\n    let filteredLogs = result.data;\n\n    if (dateFrom) {\n      const fromDate = new Date(dateFrom);\n      filteredLogs = filteredLogs.filter(log => \n        log.created_at && new Date(log.created_at) >= fromDate\n      );\n    }\n\n    if (dateTo) {\n      const toDate = new Date(dateTo);\n      toDate.setHours(23, 59, 59, 999); // End of day\n      filteredLogs = filteredLogs.filter(log => \n        log.created_at && new Date(log.created_at) <= toDate\n      );\n    }\n\n    // 5. Return response\n    return NextResponse.json({\n      success: true,\n      data: filteredLogs,\n    }, { status: 200 });\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}