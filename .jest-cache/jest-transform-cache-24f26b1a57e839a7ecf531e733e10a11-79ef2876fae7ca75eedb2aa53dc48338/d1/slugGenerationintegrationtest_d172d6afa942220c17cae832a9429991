4e4427b63104191e69142981062e6882
/**
 * Integration tests for slug generation in database
 * Tests the database trigger that auto-generates slugs from names
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _supabasejs = require("@supabase/supabase-js");
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
describe('Slug Generation Integration Tests', ()=>{
    let supabase;
    beforeAll(()=>{
        supabase = (0, _supabasejs.createClient)(supabaseUrl, supabaseServiceKey);
    });
    afterEach(async ()=>{
        // Clean up test data
        await supabase.from('events').delete().like('name', 'Test Event%');
        await supabase.from('activities').delete().like('name', 'Test Activity%');
    });
    describe('Events Slug Generation', ()=>{
        it('should auto-generate slug from event name on insert', async ()=>{
            const { data, error } = await supabase.from('events').insert({
                name: 'Test Event One',
                event_type: 'ceremony',
                start_date: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(error).toBeNull();
            expect(data).toBeDefined();
            expect(data?.slug).toBe('test-event-one');
        });
        it('should handle special characters in event name', async ()=>{
            const { data, error } = await supabase.from('events').insert({
                name: 'Test Event: Special & Characters!',
                event_type: 'ceremony',
                start_date: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(error).toBeNull();
            expect(data?.slug).toBe('test-event-special-characters');
        });
        it('should handle duplicate event names with numeric suffixes', async ()=>{
            // Insert first event
            const { data: event1 } = await supabase.from('events').insert({
                name: 'Test Event Duplicate',
                event_type: 'ceremony',
                start_date: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(event1?.slug).toBe('test-event-duplicate');
            // Insert second event with same name
            const { data: event2, error: error2 } = await supabase.from('events').insert({
                name: 'Test Event Duplicate',
                event_type: 'ceremony',
                start_date: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            // This will fail with unique constraint violation if trigger doesn't handle uniqueness
            if (error2) {
                console.log('Error inserting duplicate:', error2);
                // The trigger doesn't handle uniqueness - this is expected to fail
                expect(error2.code).toBe('23505'); // Unique violation
            } else {
                // If it succeeds, the slug should have a numeric suffix
                expect(event2?.slug).toMatch(/^test-event-duplicate-\d+$/);
            }
        });
        it('should preserve custom slug on update', async ()=>{
            // Insert event with custom slug
            const { data: event } = await supabase.from('events').insert({
                name: 'Test Event Custom',
                slug: 'my-custom-slug',
                event_type: 'ceremony',
                start_date: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(event?.slug).toBe('my-custom-slug');
            // Update event name
            const { data: updated } = await supabase.from('events').update({
                name: 'Test Event Custom Updated'
            }).eq('id', event.id).select().single();
            // Slug should be preserved
            expect(updated?.slug).toBe('my-custom-slug');
        });
    });
    describe('Activities Slug Generation', ()=>{
        it('should auto-generate slug from activity name on insert', async ()=>{
            const { data, error } = await supabase.from('activities').insert({
                name: 'Test Activity One',
                activity_type: 'activity',
                start_time: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(error).toBeNull();
            expect(data).toBeDefined();
            expect(data?.slug).toBe('test-activity-one');
        });
        it('should handle special characters in activity name', async ()=>{
            const { data, error } = await supabase.from('activities').insert({
                name: 'Test Activity: Special & Characters!',
                activity_type: 'activity',
                start_time: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(error).toBeNull();
            expect(data?.slug).toBe('test-activity-special-characters');
        });
        it('should handle duplicate activity names with numeric suffixes', async ()=>{
            // Insert first activity
            const { data: activity1 } = await supabase.from('activities').insert({
                name: 'Test Activity Duplicate',
                activity_type: 'activity',
                start_time: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(activity1?.slug).toBe('test-activity-duplicate');
            // Insert second activity with same name
            const { data: activity2, error: error2 } = await supabase.from('activities').insert({
                name: 'Test Activity Duplicate',
                activity_type: 'activity',
                start_time: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            // This will fail with unique constraint violation if trigger doesn't handle uniqueness
            if (error2) {
                console.log('Error inserting duplicate:', error2);
                // The trigger doesn't handle uniqueness - this is expected to fail
                expect(error2.code).toBe('23505'); // Unique violation
            } else {
                // If it succeeds, the slug should have a numeric suffix
                expect(activity2?.slug).toMatch(/^test-activity-duplicate-\d+$/);
            }
        });
        it('should preserve custom slug on update', async ()=>{
            // Insert activity with custom slug
            const { data: activity } = await supabase.from('activities').insert({
                name: 'Test Activity Custom',
                slug: 'my-custom-activity-slug',
                activity_type: 'activity',
                start_time: new Date().toISOString(),
                status: 'draft'
            }).select().single();
            expect(activity?.slug).toBe('my-custom-activity-slug');
            // Update activity name
            const { data: updated } = await supabase.from('activities').update({
                name: 'Test Activity Custom Updated'
            }).eq('id', activity.id).select().single();
            // Slug should be preserved
            expect(updated?.slug).toBe('my-custom-activity-slug');
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvX190ZXN0c19fL2ludGVncmF0aW9uL3NsdWdHZW5lcmF0aW9uLmludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbnRlZ3JhdGlvbiB0ZXN0cyBmb3Igc2x1ZyBnZW5lcmF0aW9uIGluIGRhdGFiYXNlXG4gKiBUZXN0cyB0aGUgZGF0YWJhc2UgdHJpZ2dlciB0aGF0IGF1dG8tZ2VuZXJhdGVzIHNsdWdzIGZyb20gbmFtZXNcbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCE7XG5jb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZITtcblxuZGVzY3JpYmUoJ1NsdWcgR2VuZXJhdGlvbiBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IHN1cGFiYXNlOiBSZXR1cm5UeXBlPHR5cGVvZiBjcmVhdGVDbGllbnQ+O1xuXG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkYXRhXG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnZXZlbnRzJykuZGVsZXRlKCkubGlrZSgnbmFtZScsICdUZXN0IEV2ZW50JScpO1xuICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ2FjdGl2aXRpZXMnKS5kZWxldGUoKS5saWtlKCduYW1lJywgJ1Rlc3QgQWN0aXZpdHklJyk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFdmVudHMgU2x1ZyBHZW5lcmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYXV0by1nZW5lcmF0ZSBzbHVnIGZyb20gZXZlbnQgbmFtZSBvbiBpbnNlcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnZXZlbnRzJylcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgbmFtZTogJ1Rlc3QgRXZlbnQgT25lJyxcbiAgICAgICAgICBldmVudF90eXBlOiAnY2VyZW1vbnknLFxuICAgICAgICAgIHN0YXJ0X2RhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBzdGF0dXM6ICdkcmFmdCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGV4cGVjdChlcnJvcikudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRhdGE/LnNsdWcpLnRvQmUoJ3Rlc3QtZXZlbnQtb25lJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gZXZlbnQgbmFtZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBFdmVudDogU3BlY2lhbCAmIENoYXJhY3RlcnMhJyxcbiAgICAgICAgICBldmVudF90eXBlOiAnY2VyZW1vbnknLFxuICAgICAgICAgIHN0YXJ0X2RhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBzdGF0dXM6ICdkcmFmdCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGV4cGVjdChlcnJvcikudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChkYXRhPy5zbHVnKS50b0JlKCd0ZXN0LWV2ZW50LXNwZWNpYWwtY2hhcmFjdGVycycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZHVwbGljYXRlIGV2ZW50IG5hbWVzIHdpdGggbnVtZXJpYyBzdWZmaXhlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEluc2VydCBmaXJzdCBldmVudFxuICAgICAgY29uc3QgeyBkYXRhOiBldmVudDEgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBFdmVudCBEdXBsaWNhdGUnLFxuICAgICAgICAgIGV2ZW50X3R5cGU6ICdjZXJlbW9ueScsXG4gICAgICAgICAgc3RhcnRfZGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHN0YXR1czogJ2RyYWZ0JyxcbiAgICAgICAgfSlcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgZXhwZWN0KGV2ZW50MT8uc2x1ZykudG9CZSgndGVzdC1ldmVudC1kdXBsaWNhdGUnKTtcblxuICAgICAgLy8gSW5zZXJ0IHNlY29uZCBldmVudCB3aXRoIHNhbWUgbmFtZVxuICAgICAgY29uc3QgeyBkYXRhOiBldmVudDIsIGVycm9yOiBlcnJvcjIgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBFdmVudCBEdXBsaWNhdGUnLFxuICAgICAgICAgIGV2ZW50X3R5cGU6ICdjZXJlbW9ueScsXG4gICAgICAgICAgc3RhcnRfZGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHN0YXR1czogJ2RyYWZ0JyxcbiAgICAgICAgfSlcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgLy8gVGhpcyB3aWxsIGZhaWwgd2l0aCB1bmlxdWUgY29uc3RyYWludCB2aW9sYXRpb24gaWYgdHJpZ2dlciBkb2Vzbid0IGhhbmRsZSB1bmlxdWVuZXNzXG4gICAgICBpZiAoZXJyb3IyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbnNlcnRpbmcgZHVwbGljYXRlOicsIGVycm9yMik7XG4gICAgICAgIC8vIFRoZSB0cmlnZ2VyIGRvZXNuJ3QgaGFuZGxlIHVuaXF1ZW5lc3MgLSB0aGlzIGlzIGV4cGVjdGVkIHRvIGZhaWxcbiAgICAgICAgZXhwZWN0KGVycm9yMi5jb2RlKS50b0JlKCcyMzUwNScpOyAvLyBVbmlxdWUgdmlvbGF0aW9uXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBpdCBzdWNjZWVkcywgdGhlIHNsdWcgc2hvdWxkIGhhdmUgYSBudW1lcmljIHN1ZmZpeFxuICAgICAgICBleHBlY3QoZXZlbnQyPy5zbHVnKS50b01hdGNoKC9edGVzdC1ldmVudC1kdXBsaWNhdGUtXFxkKyQvKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJlc2VydmUgY3VzdG9tIHNsdWcgb24gdXBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gSW5zZXJ0IGV2ZW50IHdpdGggY3VzdG9tIHNsdWdcbiAgICAgIGNvbnN0IHsgZGF0YTogZXZlbnQgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBFdmVudCBDdXN0b20nLFxuICAgICAgICAgIHNsdWc6ICdteS1jdXN0b20tc2x1ZycsXG4gICAgICAgICAgZXZlbnRfdHlwZTogJ2NlcmVtb255JyxcbiAgICAgICAgICBzdGFydF9kYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgc3RhdHVzOiAnZHJhZnQnLFxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBleHBlY3QoZXZlbnQ/LnNsdWcpLnRvQmUoJ215LWN1c3RvbS1zbHVnJyk7XG5cbiAgICAgIC8vIFVwZGF0ZSBldmVudCBuYW1lXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxuICAgICAgICAudXBkYXRlKHsgbmFtZTogJ1Rlc3QgRXZlbnQgQ3VzdG9tIFVwZGF0ZWQnIH0pXG4gICAgICAgIC5lcSgnaWQnLCBldmVudCEuaWQpXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIC8vIFNsdWcgc2hvdWxkIGJlIHByZXNlcnZlZFxuICAgICAgZXhwZWN0KHVwZGF0ZWQ/LnNsdWcpLnRvQmUoJ215LWN1c3RvbS1zbHVnJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBY3Rpdml0aWVzIFNsdWcgR2VuZXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGF1dG8tZ2VuZXJhdGUgc2x1ZyBmcm9tIGFjdGl2aXR5IG5hbWUgb24gaW5zZXJ0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2FjdGl2aXRpZXMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBBY3Rpdml0eSBPbmUnLFxuICAgICAgICAgIGFjdGl2aXR5X3R5cGU6ICdhY3Rpdml0eScsXG4gICAgICAgICAgc3RhcnRfdGltZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHN0YXR1czogJ2RyYWZ0JyxcbiAgICAgICAgfSlcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGF0YT8uc2x1ZykudG9CZSgndGVzdC1hY3Rpdml0eS1vbmUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNwZWNpYWwgY2hhcmFjdGVycyBpbiBhY3Rpdml0eSBuYW1lJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2FjdGl2aXRpZXMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBBY3Rpdml0eTogU3BlY2lhbCAmIENoYXJhY3RlcnMhJyxcbiAgICAgICAgICBhY3Rpdml0eV90eXBlOiAnYWN0aXZpdHknLFxuICAgICAgICAgIHN0YXJ0X3RpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBzdGF0dXM6ICdkcmFmdCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGV4cGVjdChlcnJvcikudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChkYXRhPy5zbHVnKS50b0JlKCd0ZXN0LWFjdGl2aXR5LXNwZWNpYWwtY2hhcmFjdGVycycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZHVwbGljYXRlIGFjdGl2aXR5IG5hbWVzIHdpdGggbnVtZXJpYyBzdWZmaXhlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEluc2VydCBmaXJzdCBhY3Rpdml0eVxuICAgICAgY29uc3QgeyBkYXRhOiBhY3Rpdml0eTEgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhY3Rpdml0aWVzJylcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgbmFtZTogJ1Rlc3QgQWN0aXZpdHkgRHVwbGljYXRlJyxcbiAgICAgICAgICBhY3Rpdml0eV90eXBlOiAnYWN0aXZpdHknLFxuICAgICAgICAgIHN0YXJ0X3RpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBzdGF0dXM6ICdkcmFmdCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGV4cGVjdChhY3Rpdml0eTE/LnNsdWcpLnRvQmUoJ3Rlc3QtYWN0aXZpdHktZHVwbGljYXRlJyk7XG5cbiAgICAgIC8vIEluc2VydCBzZWNvbmQgYWN0aXZpdHkgd2l0aCBzYW1lIG5hbWVcbiAgICAgIGNvbnN0IHsgZGF0YTogYWN0aXZpdHkyLCBlcnJvcjogZXJyb3IyIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnYWN0aXZpdGllcycpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIG5hbWU6ICdUZXN0IEFjdGl2aXR5IER1cGxpY2F0ZScsXG4gICAgICAgICAgYWN0aXZpdHlfdHlwZTogJ2FjdGl2aXR5JyxcbiAgICAgICAgICBzdGFydF90aW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgc3RhdHVzOiAnZHJhZnQnLFxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICAvLyBUaGlzIHdpbGwgZmFpbCB3aXRoIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvbiBpZiB0cmlnZ2VyIGRvZXNuJ3QgaGFuZGxlIHVuaXF1ZW5lc3NcbiAgICAgIGlmIChlcnJvcjIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGluc2VydGluZyBkdXBsaWNhdGU6JywgZXJyb3IyKTtcbiAgICAgICAgLy8gVGhlIHRyaWdnZXIgZG9lc24ndCBoYW5kbGUgdW5pcXVlbmVzcyAtIHRoaXMgaXMgZXhwZWN0ZWQgdG8gZmFpbFxuICAgICAgICBleHBlY3QoZXJyb3IyLmNvZGUpLnRvQmUoJzIzNTA1Jyk7IC8vIFVuaXF1ZSB2aW9sYXRpb25cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIGl0IHN1Y2NlZWRzLCB0aGUgc2x1ZyBzaG91bGQgaGF2ZSBhIG51bWVyaWMgc3VmZml4XG4gICAgICAgIGV4cGVjdChhY3Rpdml0eTI/LnNsdWcpLnRvTWF0Y2goL150ZXN0LWFjdGl2aXR5LWR1cGxpY2F0ZS1cXGQrJC8pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSBjdXN0b20gc2x1ZyBvbiB1cGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBJbnNlcnQgYWN0aXZpdHkgd2l0aCBjdXN0b20gc2x1Z1xuICAgICAgY29uc3QgeyBkYXRhOiBhY3Rpdml0eSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2FjdGl2aXRpZXMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBBY3Rpdml0eSBDdXN0b20nLFxuICAgICAgICAgIHNsdWc6ICdteS1jdXN0b20tYWN0aXZpdHktc2x1ZycsXG4gICAgICAgICAgYWN0aXZpdHlfdHlwZTogJ2FjdGl2aXR5JyxcbiAgICAgICAgICBzdGFydF90aW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgc3RhdHVzOiAnZHJhZnQnLFxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBleHBlY3QoYWN0aXZpdHk/LnNsdWcpLnRvQmUoJ215LWN1c3RvbS1hY3Rpdml0eS1zbHVnJyk7XG5cbiAgICAgIC8vIFVwZGF0ZSBhY3Rpdml0eSBuYW1lXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhY3Rpdml0aWVzJylcbiAgICAgICAgLnVwZGF0ZSh7IG5hbWU6ICdUZXN0IEFjdGl2aXR5IEN1c3RvbSBVcGRhdGVkJyB9KVxuICAgICAgICAuZXEoJ2lkJywgYWN0aXZpdHkhLmlkKVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICAvLyBTbHVnIHNob3VsZCBiZSBwcmVzZXJ2ZWRcbiAgICAgIGV4cGVjdCh1cGRhdGVkPy5zbHVnKS50b0JlKCdteS1jdXN0b20tYWN0aXZpdHktc2x1ZycpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlU2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJkZXNjcmliZSIsInN1cGFiYXNlIiwiYmVmb3JlQWxsIiwiY3JlYXRlQ2xpZW50IiwiYWZ0ZXJFYWNoIiwiZnJvbSIsImRlbGV0ZSIsImxpa2UiLCJpdCIsImRhdGEiLCJlcnJvciIsImluc2VydCIsIm5hbWUiLCJldmVudF90eXBlIiwic3RhcnRfZGF0ZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInN0YXR1cyIsInNlbGVjdCIsInNpbmdsZSIsImV4cGVjdCIsInRvQmVOdWxsIiwidG9CZURlZmluZWQiLCJzbHVnIiwidG9CZSIsImV2ZW50MSIsImV2ZW50MiIsImVycm9yMiIsImNvbnNvbGUiLCJsb2ciLCJjb2RlIiwidG9NYXRjaCIsImV2ZW50IiwidXBkYXRlZCIsInVwZGF0ZSIsImVxIiwiaWQiLCJhY3Rpdml0eV90eXBlIiwic3RhcnRfdGltZSIsImFjdGl2aXR5MSIsImFjdGl2aXR5MiIsImFjdGl2aXR5Il0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7Ozs7NEJBRTRCO0FBRTdCLE1BQU1BLGNBQWNDLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCO0FBQ3hELE1BQU1DLHFCQUFxQkgsUUFBUUMsR0FBRyxDQUFDRyx5QkFBeUI7QUFFaEVDLFNBQVMscUNBQXFDO0lBQzVDLElBQUlDO0lBRUpDLFVBQVU7UUFDUkQsV0FBV0UsSUFBQUEsd0JBQVksRUFBQ1QsYUFBYUk7SUFDdkM7SUFFQU0sVUFBVTtRQUNSLHFC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