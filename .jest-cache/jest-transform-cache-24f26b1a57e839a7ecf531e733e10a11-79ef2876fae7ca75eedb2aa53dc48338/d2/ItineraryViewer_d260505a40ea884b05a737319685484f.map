{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/guest/ItineraryViewer.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport type { Guest } from '@/types';\nimport { generateItinerary, cacheItinerary, getCachedItinerary } from '@/services/itineraryService';\n\ninterface ItineraryViewerProps {\n  guest: Guest;\n}\n\ninterface ItineraryEvent {\n  id: string;\n  name: string;\n  type: 'event' | 'activity';\n  date: string;\n  time: string;\n  location?: string;\n  description?: string;\n  rsvp_status?: string;\n}\n\ninterface Itinerary {\n  guest_id: string;\n  guest_name: string;\n  events: ItineraryEvent[];\n  accommodation?: any;\n  transportation?: any;\n  generated_at: string;\n}\n\n/**\n * Itinerary Viewer Component\n * \n * Displays personalized itinerary with offline caching:\n * - Events and activities timeline\n * - Accommodation information\n * - Transportation details\n * - PDF export (future enhancement)\n * - Offline access via caching\n * \n * Requirements: 13.10, 18.3, 18.4\n */\nexport function ItineraryViewer({ guest }: ItineraryViewerProps) {\n  const [itinerary, setItinerary] = useState<Itinerary | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isOffline, setIsOffline] = useState(false);\n\n  useEffect(() => {\n    loadItinerary();\n    \n    // Listen for online/offline events\n    const handleOnline = () => setIsOffline(false);\n    const handleOffline = () => setIsOffline(true);\n    \n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    \n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, [guest.id]);\n\n  const loadItinerary = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Try to load from cache first\n      const cachedResult = await getCachedItinerary(guest.id);\n      \n      if (cachedResult.success && cachedResult.data) {\n        setItinerary(cachedResult.data);\n        setLoading(false);\n        \n        // Still try to fetch fresh data in the background\n        fetchFreshItinerary();\n        return;\n      }\n      \n      // No cache, fetch fresh data\n      await fetchFreshItinerary();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n      setLoading(false);\n    }\n  };\n\n  const fetchFreshItinerary = async () => {\n    try {\n      const result = await generateItinerary(guest.id);\n      \n      if (!result.success) {\n        setError(result.error.message);\n        return;\n      }\n      \n      setItinerary(result.data);\n      \n      // Cache the itinerary for offline access\n      await cacheItinerary(guest.id, result.data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n    });\n  };\n\n  const formatTime = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleTimeString('en-US', {\n      hour: 'numeric',\n      minute: '2-digit',\n      hour12: true,\n    });\n  };\n\n  const groupEventsByDate = (events: ItineraryEvent[]) => {\n    const grouped = new Map<string, ItineraryEvent[]>();\n    \n    events.forEach(event => {\n      const dateKey = new Date(event.date).toDateString();\n      if (!grouped.has(dateKey)) {\n        grouped.set(dateKey, []);\n      }\n      grouped.get(dateKey)!.push(event);\n    });\n    \n    return Array.from(grouped.entries()).map(([date, events]) => ({\n      date,\n      events: events.sort((a, b) => new Date(a.time).getTime() - new Date(b.time).getTime()),\n    }));\n  };\n\n  const getRSVPStatusColor = (status?: string) => {\n    switch (status) {\n      case 'attending':\n        return 'bg-jungle-100 text-jungle-800 border-jungle-300';\n      case 'declined':\n        return 'bg-sage-100 text-sage-800 border-sage-300';\n      case 'maybe':\n        return 'bg-sunset-100 text-sunset-800 border-sunset-300';\n      default:\n        return 'bg-volcano-100 text-volcano-800 border-volcano-300';\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-jungle-50 via-ocean-50 to-sunset-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b border-sage-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-jungle-700\">Your Itinerary</h1>\n              <p className=\"text-sage-600 mt-1\">Personalized wedding schedule</p>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              {isOffline && (\n                <span className=\"text-sm text-volcano-600 font-medium\">\n                  üì° Offline Mode\n                </span>\n              )}\n              <a\n                href=\"/guest/dashboard\"\n                className=\"text-ocean-600 hover:text-ocean-700 font-medium\"\n              >\n                ‚Üê Back to Dashboard\n              </a>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Offline Notice */}\n        {isOffline && itinerary && (\n          <div className=\"bg-ocean-50 border border-ocean-200 rounded-lg p-4 mb-6\">\n            <p className=\"text-ocean-800\">\n              ‚ÑπÔ∏è You're viewing a cached version of your itinerary. Connect to the internet to\n              see the latest updates.\n            </p>\n          </div>\n        )}\n\n        {/* Error Message */}\n        {error && !itinerary && (\n          <div className=\"bg-volcano-50 border border-volcano-200 rounded-lg p-4 mb-6\">\n            <p className=\"text-volcano-800\">‚úó {error}</p>\n          </div>\n        )}\n\n        {loading && !itinerary ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-jungle-600\"></div>\n          </div>\n        ) : itinerary ? (\n          <div className=\"space-y-6\">\n            {/* Transportation Info */}\n            {itinerary.transportation && (itinerary.transportation.arrival_date || itinerary.transportation.departure_date) && (\n              <div className=\"bg-white rounded-lg shadow-md border border-sage-200 p-6\">\n                <h2 className=\"text-xl font-bold text-jungle-700 mb-4\">‚úàÔ∏è Transportation</h2>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {itinerary.transportation.arrival_date && (\n                    <div>\n                      <div className=\"text-sm font-medium text-sage-600 mb-1\">Arrival</div>\n                      <div className=\"text-lg text-sage-800\">\n                        {formatDate(itinerary.transportation.arrival_date)}\n                      </div>\n                      <div className=\"text-sm text-sage-600\">\n                        {formatTime(itinerary.transportation.arrival_date)}\n                      </div>\n                      {itinerary.transportation.airport_code && (\n                        <div className=\"text-sm text-sage-600 mt-1\">\n                          Airport: {itinerary.transportation.airport_code}\n                        </div>\n                      )}\n                    </div>\n                  )}\n                  {itinerary.transportation.departure_date && (\n                    <div>\n                      <div className=\"text-sm font-medium text-sage-600 mb-1\">Departure</div>\n                      <div className=\"text-lg text-sage-800\">\n                        {formatDate(itinerary.transportation.departure_date)}\n                      </div>\n                      <div className=\"text-sm text-sage-600\">\n                        {formatTime(itinerary.transportation.departure_date)}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Accommodation Info */}\n            {itinerary.accommodation && (\n              <div className=\"bg-white rounded-lg shadow-md border border-sage-200 p-6\">\n                <h2 className=\"text-xl font-bold text-jungle-700 mb-4\">üè® Accommodation</h2>\n                <div className=\"space-y-2\">\n                  {itinerary.accommodation.accommodation_name && (\n                    <div className=\"text-lg font-semibold text-sage-800\">\n                      {itinerary.accommodation.accommodation_name}\n                    </div>\n                  )}\n                  {itinerary.accommodation.room_type && (\n                    <div className=\"text-sage-700\">\n                      Room: {itinerary.accommodation.room_type}\n                    </div>\n                  )}\n                  {itinerary.accommodation.check_in && itinerary.accommodation.check_out && (\n                    <div className=\"text-sm text-sage-600\">\n                      {formatDate(itinerary.accommodation.check_in)} -{' '}\n                      {formatDate(itinerary.accommodation.check_out)}\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Events Timeline */}\n            <div className=\"bg-white rounded-lg shadow-md border border-sage-200 p-6\">\n              <h2 className=\"text-xl font-bold text-jungle-700 mb-6\">üìÖ Schedule</h2>\n              \n              {itinerary.events.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <p className=\"text-sage-600\">No events scheduled yet.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-8\">\n                  {groupEventsByDate(itinerary.events).map(({ date, events }) => (\n                    <div key={date}>\n                      <h3 className=\"text-lg font-semibold text-jungle-700 mb-4 pb-2 border-b border-sage-200\">\n                        {formatDate(events[0].date)}\n                      </h3>\n                      <div className=\"space-y-4\">\n                        {events.map(event => (\n                          <div\n                            key={event.id}\n                            className=\"flex items-start space-x-4 pl-4 border-l-4 border-jungle-300\"\n                          >\n                            <div className=\"flex-shrink-0 w-20 text-right\">\n                              <div className=\"text-sm font-medium text-sage-700\">\n                                {formatTime(event.time)}\n                              </div>\n                            </div>\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-start justify-between\">\n                                <div>\n                                  <h4 className=\"font-semibold text-sage-800\">{event.name}</h4>\n                                  {event.description && (\n                                    <p className=\"text-sm text-sage-600 mt-1\">\n                                      {event.description}\n                                    </p>\n                                  )}\n                                </div>\n                                {event.rsvp_status && (\n                                  <span\n                                    className={`ml-4 inline-block px-2 py-1 rounded-full text-xs font-medium border ${getRSVPStatusColor(\n                                      event.rsvp_status\n                                    )}`}\n                                  >\n                                    {event.rsvp_status}\n                                  </span>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* Generated Timestamp */}\n            <div className=\"text-center text-sm text-sage-500\">\n              Generated on {new Date(itinerary.generated_at).toLocaleString()}\n            </div>\n          </div>\n        ) : null}\n      </main>\n    </div>\n  );\n}\n"],"names":["ItineraryViewer","guest","itinerary","setItinerary","useState","loading","setLoading","error","setError","isOffline","setIsOffline","useEffect","loadItinerary","handleOnline","handleOffline","window","addEventListener","removeEventListener","id","cachedResult","getCachedItinerary","success","data","fetchFreshItinerary","err","Error","message","result","generateItinerary","cacheItinerary","formatDate","dateString","date","Date","toLocaleDateString","weekday","year","month","day","formatTime","toLocaleTimeString","hour","minute","hour12","groupEventsByDate","events","grouped","Map","forEach","event","dateKey","toDateString","has","set","get","push","Array","from","entries","map","sort","a","b","time","getTime","getRSVPStatusColor","status","div","className","header","h1","p","span","href","main","transportation","arrival_date","departure_date","h2","airport_code","accommodation","accommodation_name","room_type","check_in","check_out","length","h3","h4","name","description","rsvp_status","generated_at","toLocaleString"],"mappings":"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"}