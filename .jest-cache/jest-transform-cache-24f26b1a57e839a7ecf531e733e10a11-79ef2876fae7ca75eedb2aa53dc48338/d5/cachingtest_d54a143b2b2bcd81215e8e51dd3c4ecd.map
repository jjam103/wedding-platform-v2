{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/lib/caching.test.ts"],"sourcesContent":["/**\n * Caching Module Tests\n * \n * Tests for caching utilities and strategies\n */\n\nimport {\n  CACHE_TTL,\n  CacheKeys,\n  CacheTags,\n  getCache,\n  CacheInvalidation,\n} from './caching';\n\ndescribe('Caching Module', () => {\n  describe('CACHE_TTL', () => {\n    it('should have correct TTL values', () => {\n      expect(CACHE_TTL.RSVPS).toBe(300); // 5 minutes\n      expect(CACHE_TTL.GUESTS).toBe(300);\n      expect(CACHE_TTL.CONTENT_PAGES).toBe(3600); // 1 hour\n      expect(CACHE_TTL.LOCATIONS).toBe(3600);\n      expect(CACHE_TTL.PHOTOS).toBe(900); // 15 minutes\n      expect(CACHE_TTL.RSVP_ANALYTICS).toBe(600); // 10 minutes\n    });\n\n    it('should have dynamic data with shorter TTL than static data', () => {\n      expect(CACHE_TTL.RSVPS).toBeLessThan(CACHE_TTL.CONTENT_PAGES);\n      expect(CACHE_TTL.GUESTS).toBeLessThan(CACHE_TTL.LOCATIONS);\n      expect(CACHE_TTL.ACTIVITIES).toBeLessThan(CACHE_TTL.SETTINGS);\n    });\n  });\n\n  describe('CacheKeys', () => {\n    it('should generate correct guest keys', () => {\n      expect(CacheKeys.guest('123')).toBe('guest:123');\n      expect(CacheKeys.guestsByGroup('group-1')).toBe('guests:group:group-1');\n      expect(CacheKeys.guestRSVPs('guest-1')).toBe('guest:guest-1:rsvps');\n    });\n\n    it('should generate correct event keys', () => {\n      expect(CacheKeys.event('event-1')).toBe('event:event-1');\n      expect(CacheKeys.eventBySlug('ceremony')).toBe('event:slug:ceremony');\n      expect(CacheKeys.events()).toBe('events');\n      expect(CacheKeys.events('active')).toBe('events:active');\n      expect(CacheKeys.eventActivities('event-1')).toBe('event:event-1:activities');\n    });\n\n    it('should generate correct activity keys', () => {\n      expect(CacheKeys.activity('activity-1')).toBe('activity:activity-1');\n      expect(CacheKeys.activityBySlug('beach-volleyball')).toBe('activity:slug:beach-volleyball');\n      expect(CacheKeys.activityRSVPs('activity-1')).toBe('activity:activity-1:rsvps');\n      expect(CacheKeys.activityCapacity('activity-1')).toBe('activity:activity-1:capacity');\n    });\n\n    it('should generate correct content page keys', () => {\n      expect(CacheKeys.contentPage('page-1')).toBe('content_page:page-1');\n      expect(CacheKeys.contentPageBySlug('our-story')).toBe('content_page:slug:our-story');\n      expect(CacheKeys.contentPages()).toBe('content_pages');\n      expect(CacheKeys.contentPages('published')).toBe('content_pages:published');\n      expect(CacheKeys.pageSections('content_page', 'page-1')).toBe('sections:content_page:page-1');\n    });\n\n    it('should generate correct photo keys', () => {\n      expect(CacheKeys.photo('photo-1')).toBe('photo:photo-1');\n      expect(CacheKeys.photos()).toBe('photos');\n      expect(CacheKeys.photos('approved')).toBe('photos:approved');\n      expect(CacheKeys.photosByPage('event', 'event-1')).toBe('photos:event:event-1');\n    });\n  });\n\n  describe('CacheTags', () => {\n    it('should have all required tags', () => {\n      expect(CacheTags.GUESTS).toBe('guests');\n      expect(CacheTags.EVENTS).toBe('events');\n      expect(CacheTags.ACTIVITIES).toBe('activities');\n      expect(CacheTags.RSVPS).toBe('rsvps');\n      expect(CacheTags.CONTENT_PAGES).toBe('content_pages');\n      expect(CacheTags.SECTIONS).toBe('sections');\n      expect(CacheTags.PHOTOS).toBe('photos');\n      expect(CacheTags.LOCATIONS).toBe('locations');\n      expect(CacheTags.SETTINGS).toBe('settings');\n      expect(CacheTags.ANALYTICS).toBe('analytics');\n    });\n  });\n\n  describe('InMemoryCache', () => {\n    let cache: any;\n\n    beforeEach(() => {\n      cache = getCache();\n    });\n\n    it('should set and get values', async () => {\n      await cache.set('test-key', { data: 'test' }, 60);\n      const value = await cache.get('test-key');\n      expect(value).toEqual({ data: 'test' });\n    });\n\n    it('should return null for non-existent keys', async () => {\n      const value = await cache.get('non-existent');\n      expect(value).toBeNull();\n    });\n\n    it('should expire values after TTL', async () => {\n      await cache.set('expire-test', { data: 'test' }, 1); // 1 second TTL\n      \n      // Should exist immediately\n      let value = await cache.get('expire-test');\n      expect(value).toEqual({ data: 'test' });\n      \n      // Wait for expiry\n      await new Promise(resolve => setTimeout(resolve, 1100));\n      \n      // Should be expired\n      value = await cache.get('expire-test');\n      expect(value).toBeNull();\n    });\n\n    it('should delete values', async () => {\n      await cache.set('delete-test', { data: 'test' }, 60);\n      await cache.del('delete-test');\n      \n      const value = await cache.get('delete-test');\n      expect(value).toBeNull();\n    });\n\n    it('should delete by pattern', async () => {\n      await cache.set('guest:1', { id: '1' }, 60);\n      await cache.set('guest:2', { id: '2' }, 60);\n      await cache.set('event:1', { id: '1' }, 60);\n      \n      await cache.delByPattern('guest:*');\n      \n      expect(await cache.get('guest:1')).toBeNull();\n      expect(await cache.get('guest:2')).toBeNull();\n      expect(await cache.get('event:1')).not.toBeNull();\n    });\n  });\n\n  describe('CacheInvalidation', () => {\n    let cache: any;\n\n    beforeEach(async () => {\n      cache = getCache();\n      \n      // Set up test data\n      await cache.set(CacheKeys.guest('guest-1'), { id: 'guest-1' }, 60);\n      await cache.set(CacheKeys.guestRSVPs('guest-1'), [], 60);\n      await cache.set(CacheKeys.event('event-1'), { id: 'event-1' }, 60);\n      await cache.set(CacheKeys.eventBySlug('ceremony'), { id: 'event-1' }, 60);\n      await cache.set(CacheKeys.activity('activity-1'), { id: 'activity-1' }, 60);\n      await cache.set(CacheKeys.activityBySlug('beach-volleyball'), { id: 'activity-1' }, 60);\n    });\n\n    it('should invalidate guest caches', async () => {\n      await CacheInvalidation.invalidateGuest('guest-1');\n      \n      expect(await cache.get(CacheKeys.guest('guest-1'))).toBeNull();\n      expect(await cache.get(CacheKeys.guestRSVPs('guest-1'))).toBeNull();\n    });\n\n    it('should invalidate event caches', async () => {\n      await CacheInvalidation.invalidateEvent('event-1', 'ceremony');\n      \n      expect(await cache.get(CacheKeys.event('event-1'))).toBeNull();\n      expect(await cache.get(CacheKeys.eventBySlug('ceremony'))).toBeNull();\n    });\n\n    it('should invalidate activity caches', async () => {\n      await CacheInvalidation.invalidateActivity('activity-1', 'beach-volleyball');\n      \n      expect(await cache.get(CacheKeys.activity('activity-1'))).toBeNull();\n      expect(await cache.get(CacheKeys.activityBySlug('beach-volleyball'))).toBeNull();\n    });\n\n    it('should invalidate RSVP-related caches', async () => {\n      await cache.set(CacheKeys.activityRSVPs('activity-1'), [], 60);\n      await cache.set(CacheKeys.activityCapacity('activity-1'), { remaining: 10 }, 60);\n      \n      await CacheInvalidation.invalidateRSVP('guest-1', 'activity-1');\n      \n      expect(await cache.get(CacheKeys.guestRSVPs('guest-1'))).toBeNull();\n      expect(await cache.get(CacheKeys.activityRSVPs('activity-1'))).toBeNull();\n      expect(await cache.get(CacheKeys.activityCapacity('activity-1'))).toBeNull();\n    });\n  });\n\n  describe('Cache Performance', () => {\n    it('should have fast get operations', async () => {\n      const cache = getCache();\n      await cache.set('perf-test', { data: 'test' }, 60);\n      \n      const start = performance.now();\n      await cache.get('perf-test');\n      const end = performance.now();\n      \n      const duration = end - start;\n      expect(duration).toBeLessThan(10); // < 10ms\n    });\n\n    it('should have fast set operations', async () => {\n      const cache = getCache();\n      \n      const start = performance.now();\n      await cache.set('perf-test', { data: 'test' }, 60);\n      const end = performance.now();\n      \n      const duration = end - start;\n      expect(duration).toBeLessThan(10); // < 10ms\n    });\n  });\n});\n\n/**\n * Cache Testing Guidelines:\n * \n * 1. Test cache hit/miss scenarios\n * 2. Test TTL expiration\n * 3. Test cache invalidation\n * 4. Test pattern-based deletion\n * 5. Test tag-based invalidation\n * 6. Test cache performance (< 10ms)\n * 7. Test concurrent access\n * 8. Test cache size limits\n * 9. Test cache warming\n * 10. Monitor cache hit rates in production\n * \n * Performance Targets:\n * - Cache get: < 10ms\n * - Cache set: < 10ms\n * - Cache invalidation: < 100ms\n * - Cache hit rate: > 80%\n */\n"],"names":["describe","it","expect","CACHE_TTL","RSVPS","toBe","GUESTS","CONTENT_PAGES","LOCATIONS","PHOTOS","RSVP_ANALYTICS","toBeLessThan","ACTIVITIES","SETTINGS","CacheKeys","guest","guestsByGroup","guestRSVPs","event","eventBySlug","events","eventActivities","activity","activityBySlug","activityRSVPs","activityCapacity","contentPage","contentPageBySlug","contentPages","pageSections","photo","photos","photosByPage","CacheTags","EVENTS","SECTIONS","ANALYTICS","cache","beforeEach","getCache","set","data","value","get","toEqual","toBeNull","Promise","resolve","setTimeout","del","id","delByPattern","not","CacheInvalidation","invalidateGuest","invalidateEvent","invalidateActivity","remaining","invalidateRSVP","start","performance","now","end","duration"],"mappings":"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"}