{"version":3,"names":["cov_1sbo2cfry5","actualCoverage","s","GET","request","params","f","slug","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","b","_server","NextResponse","json","success","code","message","status","guest","guestError","from","select","eq","user","email","single","result","_contentPagesService","getContentPageBySlug","sections","sectionsError","id","order","ascending"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/content-pages/[slug]/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport { getContentPageBySlug } from '@/services/contentPagesService';\n\n/**\n * Guest Content Page by Slug API Route\n * \n * Returns a single published content page by slug with sections and columns.\n * \n * Requirements: 8.1, 8.2\n */\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ slug: string }> }\n) {\n  try {\n    // Await params for Next.js 15+\n    const { slug } = await params;\n    \n    // 1. Auth check\n    const supabase = createRouteHandlerClient({ cookies });\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. Get guest ID from session\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id')\n      .eq('email', session.user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'NOT_FOUND', message: 'Guest not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // 3. Get content page by slug\n    const result = await getContentPageBySlug(slug);\n    \n    if (!result.success) {\n      return NextResponse.json(result, { status: result.error.code === 'NOT_FOUND' ? 404 : 500 });\n    }\n    \n    // 4. Verify page is published\n    if (result.data.status !== 'published') {\n      return NextResponse.json(\n        { success: false, error: { code: 'NOT_FOUND', message: 'Content page not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // 5. Get sections and columns for the page\n    const { data: sections, error: sectionsError } = await supabase\n      .from('sections')\n      .select(`\n        *,\n        columns (*)\n      `)\n      .eq('page_type', 'custom')\n      .eq('page_id', result.data.id)\n      .order('display_order', { ascending: true });\n    \n    if (sectionsError) {\n      return NextResponse.json(\n        { success: false, error: { code: 'DATABASE_ERROR', message: sectionsError.message } },\n        { status: 500 }\n      );\n    }\n    \n    // 6. Return response with sections\n    return NextResponse.json(\n      {\n        success: true,\n        data: {\n          ...result.data,\n          sections: sections || [],\n        },\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}