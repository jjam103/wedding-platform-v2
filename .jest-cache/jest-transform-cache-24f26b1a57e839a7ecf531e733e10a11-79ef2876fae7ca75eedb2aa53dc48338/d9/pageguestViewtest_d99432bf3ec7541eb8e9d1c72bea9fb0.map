{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/events/page.guestView.test.tsx"],"sourcesContent":["/**\n * Guest View Navigation Tests for Events\n * \n * Tests the \"View as Guest\" functionality for events.\n * Requirements: 32.2\n */\n\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport EventsPage from './page';\nimport { useToast } from '@/components/ui/ToastContext';\nimport { useRouter } from 'next/navigation';\n\n// Mock dependencies\njest.mock('@/components/ui/ToastContext');\njest.mock('next/navigation', () => ({\n  useRouter: jest.fn(),\n  useSearchParams: () => ({\n    get: jest.fn(),\n    getAll: jest.fn(),\n    has: jest.fn(),\n    keys: jest.fn(),\n    values: jest.fn(),\n    entries: jest.fn(),\n    forEach: jest.fn(),\n    toString: jest.fn(),\n  }),\n  usePathname: () => '/admin/events',\n}));\n\n// Mock fetch\nglobal.fetch = jest.fn();\n\n// Mock window.location\ndelete (window as any).location;\nwindow.location = { href: '' } as any;\n\nconst mockUseToast = useToast as jest.MockedFunction<typeof useToast>;\nconst mockUseRouter = useRouter as jest.MockedFunction<typeof useRouter>;\n\ndescribe('EventsPage - Guest View Navigation', () => {\n  const mockAddToast = jest.fn();\n  const mockPush = jest.fn();\n\n  const mockEvents = [\n    {\n      id: 'event-1',\n      name: 'Ceremony on the Beach',\n      eventType: 'ceremony',\n      startDate: '2025-06-15T14:00:00Z',\n      endDate: '2025-06-15T15:00:00Z',\n      status: 'published',\n      locationId: 'loc-1',\n      description: 'Beach ceremony',\n      rsvpRequired: true,\n      rsvpDeadline: '2025-06-01T00:00:00Z',\n    },\n    {\n      id: 'event-2',\n      name: 'Welcome Dinner',\n      eventType: 'reception',\n      startDate: '2025-06-14T18:00:00Z',\n      endDate: '2025-06-14T21:00:00Z',\n      status: 'published',\n      locationId: 'loc-2',\n      description: 'Welcome dinner',\n      rsvpRequired: true,\n      rsvpDeadline: '2025-06-01T00:00:00Z',\n    },\n  ];\n\n  const mockLocations = [\n    { id: 'loc-1', name: 'Beach Venue' },\n    { id: 'loc-2', name: 'Restaurant' },\n  ];\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    mockUseToast.mockReturnValue({\n      addToast: mockAddToast,\n      toasts: [],\n      removeToast: jest.fn(),\n    });\n\n    mockUseRouter.mockReturnValue({\n      push: mockPush,\n      replace: jest.fn(),\n      refresh: jest.fn(),\n      back: jest.fn(),\n      forward: jest.fn(),\n      prefetch: jest.fn(),\n    } as any);\n\n    // Mock fetch responses\n    (global.fetch as jest.Mock).mockImplementation((url: string) => {\n      if (url.includes('/api/admin/events')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({\n            success: true,\n            data: { events: mockEvents },\n          }),\n        });\n      }\n      if (url.includes('/api/admin/locations')) {\n        return Promise.resolve({\n          ok: true,\n          json: () => Promise.resolve({\n            success: true,\n            data: mockLocations,\n          }),\n        });\n      }\n      return Promise.reject(new Error('Unknown URL'));\n    });\n  });\n\n  describe('View Button', () => {\n    it('should render View button for each event', async () => {\n      render(<EventsPage />);\n\n      // Wait for events to load\n      await waitFor(() => {\n        expect(screen.queryByText('Ceremony on the Beach')).toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      expect(viewButtons.length).toBeGreaterThanOrEqual(mockEvents.length);\n    });\n\n    it('should navigate to guest-facing event page when View button is clicked', async () => {\n      render(<EventsPage />);\n\n      await waitFor(() => {\n        expect(screen.queryByText('Ceremony on the Beach')).toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toBe('/guest/events/event-1');\n    });\n\n    it('should generate correct URL for each event ID', async () => {\n      render(<EventsPage />);\n\n      await waitFor(() => {\n        expect(screen.queryByText('Ceremony on the Beach')).toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      // Test first event\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n      expect(window.location.href).toBe('/guest/events/event-1');\n\n      // Reset location\n      window.location.href = '';\n\n      // Test second event (if rendered)\n      if (viewButtons.length > 1) {\n        fireEvent.click(viewButtons[1]);\n        expect(window.location.href).toContain('/guest/events/');\n      }\n    });\n\n    it('should not propagate click event to row', async () => {\n      render(<EventsPage />);\n\n      await waitFor(() => {\n        expect(screen.queryByText('Ceremony on the Beach')).toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      const clickEvent = new MouseEvent('click', { bubbles: true });\n      const stopPropagationSpy = jest.spyOn(clickEvent, 'stopPropagation');\n      \n      viewButtons[0].dispatchEvent(clickEvent);\n\n      expect(stopPropagationSpy).toHaveBeenCalled();\n    });\n  });\n\n  describe('Link Generation', () => {\n    it('should generate URL with /guest/events/ prefix', async () => {\n      render(<EventsPage />);\n\n      await waitFor(() => {\n        expect(screen.queryByText('Ceremony on the Beach')).toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toMatch(/^\\/guest\\/events\\//);\n    });\n\n    it('should use event ID in URL', async () => {\n      render(<EventsPage />);\n\n      await waitFor(() => {\n        expect(screen.queryByText('Ceremony on the Beach')).toBeInTheDocument();\n      }, { timeout: 3000 });\n\n      const viewButtons = screen.getAllByRole('button', { name: /^view$/i });\n      fireEvent.click(viewButtons[0]);\n\n      expect(window.location.href).toContain('event-1');\n    });\n  });\n});\n"],"names":["jest","mock","useRouter","fn","useSearchParams","get","getAll","has","keys","values","entries","forEach","toString","usePathname","global","fetch","window","location","href","mockUseToast","useToast","mockUseRouter","describe","mockAddToast","mockPush","mockEvents","id","name","eventType","startDate","endDate","status","locationId","description","rsvpRequired","rsvpDeadline","mockLocations","beforeEach","clearAllMocks","mockReturnValue","addToast","toasts","removeToast","push","replace","refresh","back","forward","prefetch","mockImplementation","url","includes","Promise","resolve","ok","json","success","data","events","reject","Error","it","render","EventsPage","waitFor","expect","screen","queryByText","toBeInTheDocument","timeout","viewButtons","getAllByRole","length","toBeGreaterThanOrEqual","fireEvent","click","toBe","toContain","clickEvent","MouseEvent","bubbles","stopPropagationSpy","spyOn","dispatchEvent","toHaveBeenCalled","toMatch"],"mappings":"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"}