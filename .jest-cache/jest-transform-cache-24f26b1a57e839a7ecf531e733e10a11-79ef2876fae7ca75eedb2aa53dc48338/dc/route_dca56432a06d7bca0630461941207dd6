10979315d86ef8fcf9834b638f3b267c
"use strict";

/* istanbul ignore next */
function cov_1myrl6j5gg() {
  var path = "/Users/jaron/Desktop/wedding-platform-v2/app/api/auth/guest/magic-link/verify/route.ts";
  var hash = "a0dd67c6726c223639ecac8c523153b86363b6ea";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/jaron/Desktop/wedding-platform-v2/app/api/auth/guest/magic-link/verify/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 19
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 38
        }
      },
      "4": {
        start: {
          line: 12,
          column: 17
        },
        end: {
          line: 12,
          column: 40
        }
      },
      "5": {
        start: {
          line: 13,
          column: 18
        },
        end: {
          line: 13,
          column: 59
        }
      },
      "6": {
        start: {
          line: 14,
          column: 13
        },
        end: {
          line: 14,
          column: 27
        }
      },
      "7": {
        start: {
          line: 23,
          column: 30
        },
        end: {
          line: 25,
          column: 2
        }
      },
      "8": {
        start: {
          line: 27,
          column: 4
        },
        end: {
          line: 171,
          column: 5
        }
      },
      "9": {
        start: {
          line: 29,
          column: 33
        },
        end: {
          line: 29,
          column: 53
        }
      },
      "10": {
        start: {
          line: 30,
          column: 22
        },
        end: {
          line: 30,
          column: 47
        }
      },
      "11": {
        start: {
          line: 31,
          column: 27
        },
        end: {
          line: 33,
          column: 10
        }
      },
      "12": {
        start: {
          line: 34,
          column: 8
        },
        end: {
          line: 45,
          column: 9
        }
      },
      "13": {
        start: {
          line: 35,
          column: 12
        },
        end: {
          line: 44,
          column: 15
        }
      },
      "14": {
        start: {
          line: 47,
          column: 25
        },
        end: {
          line: 47,
          column: 62
        }
      },
      "15": {
        start: {
          line: 49,
          column: 57
        },
        end: {
          line: 49,
          column: 241
        }
      },
      "16": {
        start: {
          line: 50,
          column: 8
        },
        end: {
          line: 60,
          column: 9
        }
      },
      "17": {
        start: {
          line: 51,
          column: 12
        },
        end: {
          line: 59,
          column: 15
        }
      },
      "18": {
        start: {
          line: 62,
          column: 8
        },
        end: {
          line: 72,
          column: 9
        }
      },
      "19": {
        start: {
          line: 63,
          column: 12
        },
        end: {
          line: 71,
          column: 15
        }
      },
      "20": {
        start: {
          line: 74,
          column: 20
        },
        end: {
          line: 74,
          column: 30
        }
      },
      "21": {
        start: {
          line: 75,
          column: 26
        },
        end: {
          line: 75,
          column: 58
        }
      },
      "22": {
        start: {
          line: 76,
          column: 8
        },
        end: {
          line: 86,
          column: 9
        }
      },
      "23": {
        start: {
          line: 77,
          column: 12
        },
        end: {
          line: 85,
          column: 15
        }
      },
      "24": {
        start: {
          line: 88,
          column: 39
        },
        end: {
          line: 91,
          column: 35
        }
      },
      "25": {
        start: {
          line: 92,
          column: 8
        },
        end: {
          line: 103,
          column: 9
        }
      },
      "26": {
        start: {
          line: 93,
          column: 12
        },
        end: {
          line: 93,
          column: 72
        }
      },
      "27": {
        start: {
          line: 94,
          column: 12
        },
        end: {
          line: 102,
          column: 15
        }
      },
      "28": {
        start: {
          line: 105,
          column: 29
        },
        end: {
          line: 105,
          column: 134
        }
      },
      "29": {
        start: {
          line: 105,
          column: 93
        },
        end: {
          line: 105,
          column: 124
        }
      },
      "30": {
        start: {
          line: 107,
          column: 33
        },
        end: {
          line: 107,
          column: 75
        }
      },
      "31": {
        start: {
          line: 108,
          column: 55
        },
        end: {
          line: 114,
          column: 28
        }
      },
      "32": {
        start: {
          line: 115,
          column: 8
        },
        end: {
          line: 126,
          column: 9
        }
      },
      "33": {
        start: {
          line: 116,
          column: 12
        },
        end: {
          line: 116,
          column: 75
        }
      },
      "34": {
        start: {
          line: 117,
          column: 12
        },
        end: {
          line: 125,
          column: 15
        }
      },
      "35": {
        start: {
          line: 128,
          column: 28
        },
        end: {
          line: 128,
          column: 57
        }
      },
      "36": {
        start: {
          line: 129,
          column: 8
        },
        end: {
          line: 135,
          column: 11
        }
      },
      "37": {
        start: {
          line: 137,
          column: 8
        },
        end: {
          line: 146,
          column: 11
        }
      },
      "38": {
        start: {
          line: 148,
          column: 22
        },
        end: {
          line: 148,
          column: 40
        }
      },
      "39": {
        start: {
          line: 149,
          column: 8
        },
        end: {
          line: 159,
          column: 11
        }
      },
      "40": {
        start: {
          line: 161,
          column: 8
        },
        end: {
          line: 161,
          column: 63
        }
      },
      "41": {
        start: {
          line: 162,
          column: 8
        },
        end: {
          line: 170,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "GET",
        decl: {
          start: {
            line: 26,
            column: 15
          },
          end: {
            line: 26,
            column: 18
          }
        },
        loc: {
          start: {
            line: 26,
            column: 28
          },
          end: {
            line: 172,
            column: 1
          }
        },
        line: 26
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 105,
            column: 88
          },
          end: {
            line: 105,
            column: 89
          }
        },
        loc: {
          start: {
            line: 105,
            column: 93
          },
          end: {
            line: 105,
            column: 124
          }
        },
        line: 105
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 34,
            column: 8
          },
          end: {
            line: 45,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 34,
            column: 8
          },
          end: {
            line: 45,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 34
      },
      "1": {
        loc: {
          start: {
            line: 50,
            column: 8
          },
          end: {
            line: 60,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 50,
            column: 8
          },
          end: {
            line: 60,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 50
      },
      "2": {
        loc: {
          start: {
            line: 50,
            column: 12
          },
          end: {
            line: 50,
            column: 38
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 50,
            column: 12
          },
          end: {
            line: 50,
            column: 22
          }
        }, {
          start: {
            line: 50,
            column: 26
          },
          end: {
            line: 50,
            column: 38
          }
        }],
        line: 50
      },
      "3": {
        loc: {
          start: {
            line: 62,
            column: 8
          },
          end: {
            line: 72,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 62,
            column: 8
          },
          end: {
            line: 72,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 62
      },
      "4": {
        loc: {
          start: {
            line: 76,
            column: 8
          },
          end: {
            line: 86,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 76,
            column: 8
          },
          end: {
            line: 86,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 76
      },
      "5": {
        loc: {
          start: {
            line: 92,
            column: 8
          },
          end: {
            line: 103,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 92,
            column: 8
          },
          end: {
            line: 103,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 92
      },
      "6": {
        loc: {
          start: {
            line: 112,
            column: 24
          },
          end: {
            line: 112,
            column: 111
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 112,
            column: 24
          },
          end: {
            line: 112,
            column: 62
          }
        }, {
          start: {
            line: 112,
            column: 66
          },
          end: {
            line: 112,
            column: 98
          }
        }, {
          start: {
            line: 112,
            column: 102
          },
          end: {
            line: 112,
            column: 111
          }
        }],
        line: 112
      },
      "7": {
        loc: {
          start: {
            line: 113,
            column: 24
          },
          end: {
            line: 113,
            column: 70
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 113,
            column: 24
          },
          end: {
            line: 113,
            column: 57
          }
        }, {
          start: {
            line: 113,
            column: 61
          },
          end: {
            line: 113,
            column: 70
          }
        }],
        line: 113
      },
      "8": {
        loc: {
          start: {
            line: 115,
            column: 8
          },
          end: {
            line: 126,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 115,
            column: 8
          },
          end: {
            line: 126,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 115
      },
      "9": {
        loc: {
          start: {
            line: 115,
            column: 12
          },
          end: {
            line: 115,
            column: 36
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 115,
            column: 12
          },
          end: {
            line: 115,
            column: 24
          }
        }, {
          start: {
            line: 115,
            column: 28
          },
          end: {
            line: 115,
            column: 36
          }
        }],
        line: 115
      },
      "10": {
        loc: {
          start: {
            line: 144,
            column: 28
          },
          end: {
            line: 144,
            column: 115
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 144,
            column: 28
          },
          end: {
            line: 144,
            column: 66
          }
        }, {
          start: {
            line: 144,
            column: 70
          },
          end: {
            line: 144,
            column: 102
          }
        }, {
          start: {
            line: 144,
            column: 106
          },
          end: {
            line: 144,
            column: 115
          }
        }],
        line: 144
      },
      "11": {
        loc: {
          start: {
            line: 166,
            column: 25
          },
          end: {
            line: 166,
            column: 90
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 166,
            column: 50
          },
          end: {
            line: 166,
            column: 63
          }
        }, {
          start: {
            line: 166,
            column: 66
          },
          end: {
            line: 166,
            column: 90
          }
        }],
        line: 166
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0, 0],
      "11": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/jaron/Desktop/wedding-platform-v2/app/api/auth/guest/magic-link/verify/route.ts"],
      sourcesContent: ["import { NextResponse } from 'next/server';\nimport { cookies } from 'next/headers';\nimport { createSupabaseClient } from '@/lib/supabase';\nimport { z } from 'zod';\n\n/**\n * Magic Link Verification API Route\n * \n * Verifies a magic link token, marks it as used, creates a guest session,\n * and sets an HTTP-only session cookie.\n * \n * Requirements: 5.3, 5.9\n * Task: 6.2\n */\n\nconst verifyTokenSchema = z.object({\n  token: z.string().min(64).max(64), // 32 bytes = 64 hex characters\n});\n\n/**\n * GET /api/auth/guest/magic-link/verify?token=...\n * \n * Verifies a magic link token and creates a guest session.\n * \n * @param request - Request containing token in query params\n * @returns Success response with guest data, or error response\n */\nexport async function GET(request: Request) {\n  try {\n    // 1. Parse and validate query parameters\n    const { searchParams } = new URL(request.url);\n    const token = searchParams.get('token');\n    \n    const validation = verifyTokenSchema.safeParse({ token });\n    \n    if (!validation.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'VALIDATION_ERROR',\n            message: 'Invalid token format',\n            details: validation.error.issues,\n          },\n        },\n        { status: 400 }\n      );\n    }\n    \n    // 2. Create Supabase client\n    const supabase = createSupabaseClient();\n    \n    // 3. Find token in database\n    const { data: tokenRecord, error: tokenError } = await supabase\n      .from('magic_link_tokens')\n      .select('id, guest_id, token, expires_at, used, guests(id, email, first_name, last_name, group_id)')\n      .eq('token', validation.data.token)\n      .single();\n    \n    if (tokenError || !tokenRecord) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'NOT_FOUND',\n            message: 'Invalid or expired magic link',\n          },\n        },\n        { status: 404 }\n      );\n    }\n    \n    // 4. Check if token has already been used\n    if (tokenRecord.used) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'TOKEN_USED',\n            message: 'This magic link has already been used',\n          },\n        },\n        { status: 409 }\n      );\n    }\n    \n    // 5. Check if token has expired\n    const now = new Date();\n    const expiresAt = new Date(tokenRecord.expires_at);\n    \n    if (now > expiresAt) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'TOKEN_EXPIRED',\n            message: 'This magic link has expired',\n          },\n        },\n        { status: 410 }\n      );\n    }\n    \n    // 6. Mark token as used\n    const { error: updateError } = await supabase\n      .from('magic_link_tokens')\n      .update({ \n        used: true,\n        used_at: now.toISOString(),\n      })\n      .eq('id', tokenRecord.id);\n    \n    if (updateError) {\n      console.error('Failed to mark token as used:', updateError);\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'TOKEN_ERROR',\n            message: 'Failed to verify magic link',\n          },\n        },\n        { status: 500 }\n      );\n    }\n    \n    // 7. Generate session token (32 bytes)\n    const sessionToken = Array.from(crypto.getRandomValues(new Uint8Array(32)))\n      .map(b => b.toString(16).padStart(2, '0'))\n      .join('');\n    \n    // 8. Create session record in database\n    const sessionExpiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\n    \n    const { data: session, error: sessionError } = await supabase\n      .from('guest_sessions')\n      .insert({\n        guest_id: tokenRecord.guest_id,\n        token: sessionToken,\n        expires_at: sessionExpiresAt.toISOString(),\n        ip_address: request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown',\n        user_agent: request.headers.get('user-agent') || 'unknown',\n      })\n      .select()\n      .single();\n    \n    if (sessionError || !session) {\n      console.error('Failed to create guest session:', sessionError);\n      return NextResponse.json(\n        {\n          success: false,\n          error: {\n            code: 'SESSION_ERROR',\n            message: 'Failed to create session',\n          },\n        },\n        { status: 500 }\n      );\n    }\n    \n    // 9. Set HTTP-only session cookie\n    const cookieStore = await cookies();\n    cookieStore.set('guest_session', sessionToken, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production',\n      sameSite: 'lax',\n      maxAge: 60 * 60 * 24, // 24 hours\n      path: '/',\n    });\n    \n    // 10. Log authentication event\n    await supabase.from('audit_logs').insert({\n      action: 'guest_login',\n      entity_type: 'guest',\n      entity_id: tokenRecord.guest_id,\n      details: {\n        auth_method: 'magic_link',\n        email: (tokenRecord.guests as any).email,\n        ip_address: request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown',\n      },\n    });\n    \n    // 11. Return success response\n    const guest = tokenRecord.guests as any;\n    return NextResponse.json(\n      {\n        success: true,\n        data: {\n          guestId: guest.id,\n          groupId: guest.group_id,\n          firstName: guest.first_name,\n          lastName: guest.last_name,\n        },\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('Magic link verification error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: {\n          code: 'UNKNOWN_ERROR',\n          message: error instanceof Error ? error.message : 'Unknown error occurred',\n        },\n      },\n      { status: 500 }\n    );\n  }\n}\n"],
      names: ["GET", "verifyTokenSchema", "z", "object", "token", "string", "min", "max", "request", "searchParams", "URL", "url", "get", "validation", "safeParse", "success", "NextResponse", "json", "error", "code", "message", "details", "issues", "status", "supabase", "createSupabaseClient", "data", "tokenRecord", "tokenError", "from", "select", "eq", "single", "used", "now", "Date", "expiresAt", "expires_at", "updateError", "update", "used_at", "toISOString", "id", "console", "sessionToken", "Array", "crypto", "getRandomValues", "Uint8Array", "map", "b", "toString", "padStart", "join", "sessionExpiresAt", "session", "sessionError", "insert", "guest_id", "ip_address", "headers", "user_agent", "cookieStore", "cookies", "set", "httpOnly", "secure", "process", "env", "NODE_ENV", "sameSite", "maxAge", "path", "action", "entity_type", "entity_id", "auth_method", "email", "guests", "guest", "guestId", "groupId", "group_id", "firstName", "first_name", "lastName", "last_name", "Error"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "a0dd67c6726c223639ecac8c523153b86363b6ea"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1myrl6j5gg = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1myrl6j5gg();
cov_1myrl6j5gg().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_1myrl6j5gg().s[1]++;
Object.defineProperty(exports, "GET", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_1myrl6j5gg().f[0]++;
    cov_1myrl6j5gg().s[2]++;
    return GET;
  }
});
const _server =
/* istanbul ignore next */
(cov_1myrl6j5gg().s[3]++, require("next/server"));
const _headers =
/* istanbul ignore next */
(cov_1myrl6j5gg().s[4]++, require("next/headers"));
const _supabase =
/* istanbul ignore next */
(cov_1myrl6j5gg().s[5]++, require("../../../../../../lib/supabase"));
const _zod =
/* istanbul ignore next */
(cov_1myrl6j5gg().s[6]++, require("zod"));
/**
 * Magic Link Verification API Route
 * 
 * Verifies a magic link token, marks it as used, creates a guest session,
 * and sets an HTTP-only session cookie.
 * 
 * Requirements: 5.3, 5.9
 * Task: 6.2
 */
const verifyTokenSchema =
/* istanbul ignore next */
(cov_1myrl6j5gg().s[7]++, _zod.z.object({
  token: _zod.z.string().min(64).max(64)
}));
async function GET(request) {
  /* istanbul ignore next */
  cov_1myrl6j5gg().f[1]++;
  cov_1myrl6j5gg().s[8]++;
  try {
    // 1. Parse and validate query parameters
    const {
      searchParams
    } =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[9]++, new URL(request.url));
    const token =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[10]++, searchParams.get('token'));
    const validation =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[11]++, verifyTokenSchema.safeParse({
      token
    }));
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[12]++;
    if (!validation.success) {
      /* istanbul ignore next */
      cov_1myrl6j5gg().b[0][0]++;
      cov_1myrl6j5gg().s[13]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'Invalid token format',
          details: validation.error.issues
        }
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_1myrl6j5gg().b[0][1]++;
    }
    // 2. Create Supabase client
    const supabase =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[14]++, (0, _supabase.createSupabaseClient)());
    // 3. Find token in database
    const {
      data: tokenRecord,
      error: tokenError
    } =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[15]++, await supabase.from('magic_link_tokens').select('id, guest_id, token, expires_at, used, guests(id, email, first_name, last_name, group_id)').eq('token', validation.data.token).single());
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[16]++;
    if (
    /* istanbul ignore next */
    (cov_1myrl6j5gg().b[2][0]++, tokenError) ||
    /* istanbul ignore next */
    (cov_1myrl6j5gg().b[2][1]++, !tokenRecord)) {
      /* istanbul ignore next */
      cov_1myrl6j5gg().b[1][0]++;
      cov_1myrl6j5gg().s[17]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'NOT_FOUND',
          message: 'Invalid or expired magic link'
        }
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_1myrl6j5gg().b[1][1]++;
    }
    // 4. Check if token has already been used
    cov_1myrl6j5gg().s[18]++;
    if (tokenRecord.used) {
      /* istanbul ignore next */
      cov_1myrl6j5gg().b[3][0]++;
      cov_1myrl6j5gg().s[19]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'TOKEN_USED',
          message: 'This magic link has already been used'
        }
      }, {
        status: 409
      });
    } else
    /* istanbul ignore next */
    {
      cov_1myrl6j5gg().b[3][1]++;
    }
    // 5. Check if token has expired
    const now =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[20]++, new Date());
    const expiresAt =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[21]++, new Date(tokenRecord.expires_at));
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[22]++;
    if (now > expiresAt) {
      /* istanbul ignore next */
      cov_1myrl6j5gg().b[4][0]++;
      cov_1myrl6j5gg().s[23]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'TOKEN_EXPIRED',
          message: 'This magic link has expired'
        }
      }, {
        status: 410
      });
    } else
    /* istanbul ignore next */
    {
      cov_1myrl6j5gg().b[4][1]++;
    }
    // 6. Mark token as used
    const {
      error: updateError
    } =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[24]++, await supabase.from('magic_link_tokens').update({
      used: true,
      used_at: now.toISOString()
    }).eq('id', tokenRecord.id));
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[25]++;
    if (updateError) {
      /* istanbul ignore next */
      cov_1myrl6j5gg().b[5][0]++;
      cov_1myrl6j5gg().s[26]++;
      console.error('Failed to mark token as used:', updateError);
      /* istanbul ignore next */
      cov_1myrl6j5gg().s[27]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'TOKEN_ERROR',
          message: 'Failed to verify magic link'
        }
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_1myrl6j5gg().b[5][1]++;
    }
    // 7. Generate session token (32 bytes)
    const sessionToken =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[28]++, Array.from(crypto.getRandomValues(new Uint8Array(32))).map(b => {
      /* istanbul ignore next */
      cov_1myrl6j5gg().f[2]++;
      cov_1myrl6j5gg().s[29]++;
      return b.toString(16).padStart(2, '0');
    }).join(''));
    // 8. Create session record in database
    const sessionExpiresAt =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[30]++, new Date(Date.now() + 24 * 60 * 60 * 1000)); // 24 hours
    const {
      data: session,
      error: sessionError
    } =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[31]++, await supabase.from('guest_sessions').insert({
      guest_id: tokenRecord.guest_id,
      token: sessionToken,
      expires_at: sessionExpiresAt.toISOString(),
      ip_address:
      /* istanbul ignore next */
      (cov_1myrl6j5gg().b[6][0]++, request.headers.get('x-forwarded-for')) ||
      /* istanbul ignore next */
      (cov_1myrl6j5gg().b[6][1]++, request.headers.get('x-real-ip')) ||
      /* istanbul ignore next */
      (cov_1myrl6j5gg().b[6][2]++, 'unknown'),
      user_agent:
      /* istanbul ignore next */
      (cov_1myrl6j5gg().b[7][0]++, request.headers.get('user-agent')) ||
      /* istanbul ignore next */
      (cov_1myrl6j5gg().b[7][1]++, 'unknown')
    }).select().single());
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[32]++;
    if (
    /* istanbul ignore next */
    (cov_1myrl6j5gg().b[9][0]++, sessionError) ||
    /* istanbul ignore next */
    (cov_1myrl6j5gg().b[9][1]++, !session)) {
      /* istanbul ignore next */
      cov_1myrl6j5gg().b[8][0]++;
      cov_1myrl6j5gg().s[33]++;
      console.error('Failed to create guest session:', sessionError);
      /* istanbul ignore next */
      cov_1myrl6j5gg().s[34]++;
      return _server.NextResponse.json({
        success: false,
        error: {
          code: 'SESSION_ERROR',
          message: 'Failed to create session'
        }
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_1myrl6j5gg().b[8][1]++;
    }
    // 9. Set HTTP-only session cookie
    const cookieStore =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[35]++, await (0, _headers.cookies)());
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[36]++;
    cookieStore.set('guest_session', sessionToken, {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'lax',
      maxAge: 60 * 60 * 24,
      path: '/'
    });
    // 10. Log authentication event
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[37]++;
    await supabase.from('audit_logs').insert({
      action: 'guest_login',
      entity_type: 'guest',
      entity_id: tokenRecord.guest_id,
      details: {
        auth_method: 'magic_link',
        email: tokenRecord.guests.email,
        ip_address:
        /* istanbul ignore next */
        (cov_1myrl6j5gg().b[10][0]++, request.headers.get('x-forwarded-for')) ||
        /* istanbul ignore next */
        (cov_1myrl6j5gg().b[10][1]++, request.headers.get('x-real-ip')) ||
        /* istanbul ignore next */
        (cov_1myrl6j5gg().b[10][2]++, 'unknown')
      }
    });
    // 11. Return success response
    const guest =
    /* istanbul ignore next */
    (cov_1myrl6j5gg().s[38]++, tokenRecord.guests);
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[39]++;
    return _server.NextResponse.json({
      success: true,
      data: {
        guestId: guest.id,
        groupId: guest.group_id,
        firstName: guest.first_name,
        lastName: guest.last_name
      }
    }, {
      status: 200
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[40]++;
    console.error('Magic link verification error:', error);
    /* istanbul ignore next */
    cov_1myrl6j5gg().s[41]++;
    return _server.NextResponse.json({
      success: false,
      error: {
        code: 'UNKNOWN_ERROR',
        message: error instanceof Error ?
        /* istanbul ignore next */
        (cov_1myrl6j5gg().b[11][0]++, error.message) :
        /* istanbul ignore next */
        (cov_1myrl6j5gg().b[11][1]++, 'Unknown error occurred')
      }
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHRVQiLCJ2ZXJpZnlUb2tlblNjaGVtYSIsImNvdl8xbXlybDZqNWdnIiwicyIsIl96b2QiLCJ6Iiwib2JqZWN0IiwidG9rZW4iLCJzdHJpbmciLCJtaW4iLCJtYXgiLCJyZXF1ZXN0IiwiZiIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsImdldCIsInZhbGlkYXRpb24iLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwiYiIsIl9zZXJ2ZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwiZXJyb3IiLCJjb2RlIiwibWVzc2FnZSIsImRldGFpbHMiLCJpc3N1ZXMiLCJzdGF0dXMiLCJzdXBhYmFzZSIsIl9zdXBhYmFzZSIsImNyZWF0ZVN1cGFiYXNlQ2xpZW50IiwiZGF0YSIsInRva2VuUmVjb3JkIiwidG9rZW5FcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsInVzZWQiLCJub3ciLCJEYXRlIiwiZXhwaXJlc0F0IiwiZXhwaXJlc19hdCIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwidXNlZF9hdCIsInRvSVNPU3RyaW5nIiwiaWQiLCJjb25zb2xlIiwic2Vzc2lvblRva2VuIiwiQXJyYXkiLCJjcnlwdG8iLCJnZXRSYW5kb21WYWx1ZXMiLCJVaW50OEFycmF5IiwibWFwIiwidG9TdHJpbmciLCJwYWRTdGFydCIsImpvaW4iLCJzZXNzaW9uRXhwaXJlc0F0Iiwic2Vzc2lvbiIsInNlc3Npb25FcnJvciIsImluc2VydCIsImd1ZXN0X2lkIiwiaXBfYWRkcmVzcyIsImhlYWRlcnMiLCJ1c2VyX2FnZW50IiwiY29va2llU3RvcmUiLCJfaGVhZGVycyIsImNvb2tpZXMiLCJzZXQiLCJodHRwT25seSIsInNlY3VyZSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInNhbWVTaXRlIiwibWF4QWdlIiwicGF0aCIsImFjdGlvbiIsImVudGl0eV90eXBlIiwiZW50aXR5X2lkIiwiYXV0aF9tZXRob2QiLCJlbWFpbCIsImd1ZXN0cyIsImd1ZXN0IiwiZ3Vlc3RJZCIsImdyb3VwSWQiLCJncm91cF9pZCIsImZpcnN0TmFtZSIsImZpcnN0X25hbWUiLCJsYXN0TmFtZSIsImxhc3RfbmFtZSIsIkVycm9yIl0sInNvdXJjZXMiOlsiL1VzZXJzL2phcm9uL0Rlc2t0b3Avd2VkZGluZy1wbGF0Zm9ybS12Mi9hcHAvYXBpL2F1dGgvZ3Vlc3QvbWFnaWMtbGluay92ZXJpZnkvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBjcmVhdGVTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG4vKipcbiAqIE1hZ2ljIExpbmsgVmVyaWZpY2F0aW9uIEFQSSBSb3V0ZVxuICogXG4gKiBWZXJpZmllcyBhIG1hZ2ljIGxpbmsgdG9rZW4sIG1hcmtzIGl0IGFzIHVzZWQsIGNyZWF0ZXMgYSBndWVzdCBzZXNzaW9uLFxuICogYW5kIHNldHMgYW4gSFRUUC1vbmx5IHNlc3Npb24gY29va2llLlxuICogXG4gKiBSZXF1aXJlbWVudHM6IDUuMywgNS45XG4gKiBUYXNrOiA2LjJcbiAqL1xuXG5jb25zdCB2ZXJpZnlUb2tlblNjaGVtYSA9IHoub2JqZWN0KHtcbiAgdG9rZW46IHouc3RyaW5nKCkubWluKDY0KS5tYXgoNjQpLCAvLyAzMiBieXRlcyA9IDY0IGhleCBjaGFyYWN0ZXJzXG59KTtcblxuLyoqXG4gKiBHRVQgL2FwaS9hdXRoL2d1ZXN0L21hZ2ljLWxpbmsvdmVyaWZ5P3Rva2VuPS4uLlxuICogXG4gKiBWZXJpZmllcyBhIG1hZ2ljIGxpbmsgdG9rZW4gYW5kIGNyZWF0ZXMgYSBndWVzdCBzZXNzaW9uLlxuICogXG4gKiBAcGFyYW0gcmVxdWVzdCAtIFJlcXVlc3QgY29udGFpbmluZyB0b2tlbiBpbiBxdWVyeSBwYXJhbXNcbiAqIEByZXR1cm5zIFN1Y2Nlc3MgcmVzcG9uc2Ugd2l0aCBndWVzdCBkYXRhLCBvciBlcnJvciByZXNwb25zZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBQYXJzZSBhbmQgdmFsaWRhdGUgcXVlcnkgcGFyYW1ldGVyc1xuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCB0b2tlbiA9IHNlYXJjaFBhcmFtcy5nZXQoJ3Rva2VuJyk7XG4gICAgXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZlcmlmeVRva2VuU2NoZW1hLnNhZmVQYXJzZSh7IHRva2VuIH0pO1xuICAgIFxuICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgdG9rZW4gZm9ybWF0JyxcbiAgICAgICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgLy8gMi4gQ3JlYXRlIFN1cGFiYXNlIGNsaWVudFxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU3VwYWJhc2VDbGllbnQoKTtcbiAgICBcbiAgICAvLyAzLiBGaW5kIHRva2VuIGluIGRhdGFiYXNlXG4gICAgY29uc3QgeyBkYXRhOiB0b2tlblJlY29yZCwgZXJyb3I6IHRva2VuRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnbWFnaWNfbGlua190b2tlbnMnKVxuICAgICAgLnNlbGVjdCgnaWQsIGd1ZXN0X2lkLCB0b2tlbiwgZXhwaXJlc19hdCwgdXNlZCwgZ3Vlc3RzKGlkLCBlbWFpbCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBncm91cF9pZCknKVxuICAgICAgLmVxKCd0b2tlbicsIHZhbGlkYXRpb24uZGF0YS50b2tlbilcbiAgICAgIC5zaW5nbGUoKTtcbiAgICBcbiAgICBpZiAodG9rZW5FcnJvciB8fCAhdG9rZW5SZWNvcmQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIG9yIGV4cGlyZWQgbWFnaWMgbGluaycsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyA0LiBDaGVjayBpZiB0b2tlbiBoYXMgYWxyZWFkeSBiZWVuIHVzZWRcbiAgICBpZiAodG9rZW5SZWNvcmQudXNlZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdUT0tFTl9VU0VEJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIG1hZ2ljIGxpbmsgaGFzIGFscmVhZHkgYmVlbiB1c2VkJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDA5IH1cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIC8vIDUuIENoZWNrIGlmIHRva2VuIGhhcyBleHBpcmVkXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZSh0b2tlblJlY29yZC5leHBpcmVzX2F0KTtcbiAgICBcbiAgICBpZiAobm93ID4gZXhwaXJlc0F0KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ1RPS0VOX0VYUElSRUQnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgbWFnaWMgbGluayBoYXMgZXhwaXJlZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQxMCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyA2LiBNYXJrIHRva2VuIGFzIHVzZWRcbiAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdtYWdpY19saW5rX3Rva2VucycpXG4gICAgICAudXBkYXRlKHsgXG4gICAgICAgIHVzZWQ6IHRydWUsXG4gICAgICAgIHVzZWRfYXQ6IG5vdy50b0lTT1N0cmluZygpLFxuICAgICAgfSlcbiAgICAgIC5lcSgnaWQnLCB0b2tlblJlY29yZC5pZCk7XG4gICAgXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbWFyayB0b2tlbiBhcyB1c2VkOicsIHVwZGF0ZUVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnVE9LRU5fRVJST1InLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB2ZXJpZnkgbWFnaWMgbGluaycsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyA3LiBHZW5lcmF0ZSBzZXNzaW9uIHRva2VuICgzMiBieXRlcylcbiAgICBjb25zdCBzZXNzaW9uVG9rZW4gPSBBcnJheS5mcm9tKGNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoMzIpKSlcbiAgICAgIC5tYXAoYiA9PiBiLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpKVxuICAgICAgLmpvaW4oJycpO1xuICAgIFxuICAgIC8vIDguIENyZWF0ZSBzZXNzaW9uIHJlY29yZCBpbiBkYXRhYmFzZVxuICAgIGNvbnN0IHNlc3Npb25FeHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCk7IC8vIDI0IGhvdXJzXG4gICAgXG4gICAgY29uc3QgeyBkYXRhOiBzZXNzaW9uLCBlcnJvcjogc2Vzc2lvbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2d1ZXN0X3Nlc3Npb25zJylcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICBndWVzdF9pZDogdG9rZW5SZWNvcmQuZ3Vlc3RfaWQsXG4gICAgICAgIHRva2VuOiBzZXNzaW9uVG9rZW4sXG4gICAgICAgIGV4cGlyZXNfYXQ6IHNlc3Npb25FeHBpcmVzQXQudG9JU09TdHJpbmcoKSxcbiAgICAgICAgaXBfYWRkcmVzczogcmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHwgcmVxdWVzdC5oZWFkZXJzLmdldCgneC1yZWFsLWlwJykgfHwgJ3Vua25vd24nLFxuICAgICAgICB1c2VyX2FnZW50OiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nLFxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpO1xuICAgIFxuICAgIGlmIChzZXNzaW9uRXJyb3IgfHwgIXNlc3Npb24pIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgZ3Vlc3Qgc2Vzc2lvbjonLCBzZXNzaW9uRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdTRVNTSU9OX0VSUk9SJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIHNlc3Npb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgLy8gOS4gU2V0IEhUVFAtb25seSBzZXNzaW9uIGNvb2tpZVxuICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuICAgIGNvb2tpZVN0b3JlLnNldCgnZ3Vlc3Rfc2Vzc2lvbicsIHNlc3Npb25Ub2tlbiwge1xuICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgICBzYW1lU2l0ZTogJ2xheCcsXG4gICAgICBtYXhBZ2U6IDYwICogNjAgKiAyNCwgLy8gMjQgaG91cnNcbiAgICAgIHBhdGg6ICcvJyxcbiAgICB9KTtcbiAgICBcbiAgICAvLyAxMC4gTG9nIGF1dGhlbnRpY2F0aW9uIGV2ZW50XG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnYXVkaXRfbG9ncycpLmluc2VydCh7XG4gICAgICBhY3Rpb246ICdndWVzdF9sb2dpbicsXG4gICAgICBlbnRpdHlfdHlwZTogJ2d1ZXN0JyxcbiAgICAgIGVudGl0eV9pZDogdG9rZW5SZWNvcmQuZ3Vlc3RfaWQsXG4gICAgICBkZXRhaWxzOiB7XG4gICAgICAgIGF1dGhfbWV0aG9kOiAnbWFnaWNfbGluaycsXG4gICAgICAgIGVtYWlsOiAodG9rZW5SZWNvcmQuZ3Vlc3RzIGFzIGFueSkuZW1haWwsXG4gICAgICAgIGlwX2FkZHJlc3M6IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpIHx8IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtcmVhbC1pcCcpIHx8ICd1bmtub3duJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgXG4gICAgLy8gMTEuIFJldHVybiBzdWNjZXNzIHJlc3BvbnNlXG4gICAgY29uc3QgZ3Vlc3QgPSB0b2tlblJlY29yZC5ndWVzdHMgYXMgYW55O1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGd1ZXN0SWQ6IGd1ZXN0LmlkLFxuICAgICAgICAgIGdyb3VwSWQ6IGd1ZXN0Lmdyb3VwX2lkLFxuICAgICAgICAgIGZpcnN0TmFtZTogZ3Vlc3QuZmlyc3RfbmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogZ3Vlc3QubGFzdF9uYW1lLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiAyMDAgfVxuICAgICk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignTWFnaWMgbGluayB2ZXJpZmljYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ1VOS05PV05fRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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