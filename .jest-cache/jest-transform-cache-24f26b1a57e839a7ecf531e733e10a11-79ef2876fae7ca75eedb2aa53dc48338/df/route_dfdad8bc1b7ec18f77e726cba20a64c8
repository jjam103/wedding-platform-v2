2e9a49b97274358ebe47d6d2ff9416e5
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "GET", {
    enumerable: true,
    get: function() {
        return GET;
    }
});
const _authhelpersnextjs = require("@supabase/auth-helpers-nextjs");
const _headers = require("next/headers");
const _server = require("next/server");
async function GET(request) {
    try {
        const supabase = (0, _authhelpersnextjs.createRouteHandlerClient)({
            cookies: _headers.cookies
        });
        // Check authentication
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // Get current guest
        const { data: guest, error: guestError } = await supabase.from('guests').select('id, group_id, age_type').eq('email', session.user.email).single();
        if (guestError || !guest) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'NOT_FOUND',
                    message: 'Guest profile not found'
                }
            }, {
                status: 404
            });
        }
        // Get family members based on access control
        let familyMembers = [];
        if (guest.age_type === 'adult') {
            // Adults can see all family members in their group
            const { data, error } = await supabase.from('guests').select('*').eq('group_id', guest.group_id).order('age_type', {
                ascending: false
            }) // Adults first
            .order('first_name', {
                ascending: true
            });
            if (error) {
                return _server.NextResponse.json({
                    success: false,
                    error: {
                        code: 'DATABASE_ERROR',
                        message: error.message
                    }
                }, {
                    status: 500
                });
            }
            familyMembers = data || [];
        } else {
            // Children can only see themselves
            familyMembers = [
                guest
            ];
        }
        return _server.NextResponse.json({
            success: true,
            data: familyMembers
        });
    } catch (error) {
        console.error('Error fetching family members:', error);
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'INTERNAL_ERROR',
                message: 'Failed to fetch family members'
            }
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9ndWVzdC9mYW1pbHkvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlUm91dGVIYW5kbGVyQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL2F1dGgtaGVscGVycy1uZXh0anMnO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5cbi8qKlxuICogRmFtaWx5IE1lbWJlcnMgQVBJIFJvdXRlc1xuICogXG4gKiBHRVQ6IEdldCBhbGwgZmFtaWx5IG1lbWJlcnMgaW4gdGhlIGd1ZXN0J3MgZ3JvdXBcbiAqIFxuICogUmVxdWlyZW1lbnRzOiA2LjNcbiAqL1xuXG4vKipcbiAqIEdFVCAvYXBpL2d1ZXN0L2ZhbWlseVxuICogR2V0IGFsbCBmYW1pbHkgbWVtYmVycyBpbiB0aGUgZ3Vlc3QncyBncm91cFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCh7IGNvb2tpZXMgfSk7XG4gICAgXG4gICAgLy8gQ2hlY2sgYXV0aGVudGljYXRpb25cbiAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcbiAgICBcbiAgICBpZiAoYXV0aEVycm9yIHx8ICFzZXNzaW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdVTkFVVEhPUklaRUQnLCBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0gfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZXQgY3VycmVudCBndWVzdFxuICAgIGNvbnN0IHsgZGF0YTogZ3Vlc3QsIGVycm9yOiBndWVzdEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2d1ZXN0cycpXG4gICAgICAuc2VsZWN0KCdpZCwgZ3JvdXBfaWQsIGFnZV90eXBlJylcbiAgICAgIC5lcSgnZW1haWwnLCBzZXNzaW9uLnVzZXIuZW1haWwpXG4gICAgICAuc2luZ2xlKCk7XG4gICAgXG4gICAgaWYgKGd1ZXN0RXJyb3IgfHwgIWd1ZXN0KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdOT1RfRk9VTkQnLCBtZXNzYWdlOiAnR3Vlc3QgcHJvZmlsZSBub3QgZm91bmQnIH0gfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZXQgZmFtaWx5IG1lbWJlcnMgYmFzZWQgb24gYWNjZXNzIGNvbnRyb2xcbiAgICBsZXQgZmFtaWx5TWVtYmVycyA9IFtdO1xuICAgIFxuICAgIGlmIChndWVzdC5hZ2VfdHlwZSA9PT0gJ2FkdWx0Jykge1xuICAgICAgLy8gQWR1bHRzIGNhbiBzZWUgYWxsIGZhbWlseSBtZW1iZXJzIGluIHRoZWlyIGdyb3VwXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnZ3Vlc3RzJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5lcSgnZ3JvdXBfaWQnLCBndWVzdC5ncm91cF9pZClcbiAgICAgICAgLm9yZGVyKCdhZ2VfdHlwZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KSAvLyBBZHVsdHMgZmlyc3RcbiAgICAgICAgLm9yZGVyKCdmaXJzdF9uYW1lJywgeyBhc2NlbmRpbmc6IHRydWUgfSk7XG4gICAgICBcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgY29kZTogJ0RBVEFCQVNFX0VSUk9SJywgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9IH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGZhbWlseU1lbWJlcnMgPSBkYXRhIHx8IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDaGlsZHJlbiBjYW4gb25seSBzZWUgdGhlbXNlbHZlc1xuICAgICAgZmFtaWx5TWVtYmVycyA9IFtndWVzdF07XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogZmFtaWx5TWVtYmVyc1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGZhbWlseSBtZW1iZXJzOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBjb2RlOiAnSU5URVJOQUxfRVJST1InLCBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGZhbWlseSBtZW1iZXJzJyB9IH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiR0VUIiwicmVxdWVzdCIsInN1cGFiYXNlIiwiY3JlYXRlUm91dGVIYW5kbGVyQ2xpZW50IiwiY29va2llcyIsImRhdGEiLCJzZXNzaW9uIiwiZXJyb3IiLCJhdXRoRXJyb3IiLCJhdXRoIiwiZ2V0U2Vzc2lvbiIsIk5leHRSZXNwb25zZSIsImpzb24iLCJzdWNjZXNzIiwiY29kZSIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJndWVzdCIsImd1ZXN0RXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJ1c2VyIiwiZW1haWwiLCJzaW5nbGUiLCJmYW1pbHlNZW1iZXJzIiwiYWdlX3R5cGUiLCJncm91cF9pZCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiY29uc29sZSJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFnQnNCQTs7O2VBQUFBOzs7bUNBaEJtQjt5QkFDakI7d0JBQ0s7QUFjdEIsZUFBZUEsSUFBSUMsT0FBZ0I7SUFDeEMsSUFBSTtRQUNGLE1BQU1DLFdBQVdDLElBQUFBLDJDQUF3QixFQUFDO1lBQUVDLFNBQUFBLGdCQUFPO1FBQUM7UUFFcEQsdUJBQXVCO1FBQ3ZCLE1BQU0sRUFBRUMsTUFBTSxFQUFFQyxPQUFPLEVBQUUsRUFBRUMsT0FBT0MsU0FBUyxFQUFFLEdBQUcsTUFBTU4sU0FBU08sSUFBSSxDQUFDQyxVQUFVO1FBRTlFLElBQUlGLGFBQWEsQ0FBQ0YsU0FBUztZQUN6QixPQUFPSyxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO2dCQUFFQyxTQUFTO2dCQUFPTixPQUFPO29CQUFFTyxNQUFNO29CQUFnQkMsU0FBUztnQkFBMEI7WUFBRSxHQUN0RjtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsb0JBQW9CO1FBQ3BCLE1BQU0sRUFBRVgsTUFBTVksS0FBSyxFQUFFVixPQUFPVyxVQUFVLEVBQUUsR0FBRyxNQUFNaEIsU0FDOUNpQixJQUFJLENBQUMsVUFDTEMsTUFBTSxDQUFDLDBCQUNQQyxFQUFFLENBQUMsU0FBU2YsUUFBUWdCLElBQUksQ0FBQ0MsS0FBSyxFQUM5QkMsTUFBTTtRQUVULElBQUlOLGNBQWMsQ0FBQ0QsT0FBTztZQUN4QixPQUFPTixvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO2dCQUFFQyxTQUFTO2dCQUFPTixPQUFPO29CQUFFTyxNQUFNO29CQUFhQyxTQUFTO2dCQUEwQjtZQUFFLEdBQ25GO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSw2Q0FBNkM7UUFDN0MsSUFBSVMsZ0JBQWdCLEVBQUU7UUFFdEIsSUFBSVIsTUFBTVMsUUFBUSxLQUFLLFNBQVM7WUFDOUIsbURBQW1EO1lBQ25ELE1BQU0sRUFBRXJCLElBQUksRUFBRUUsS0FBSyxFQUFFLEdBQUcsTUFBTUwsU0FDM0JpQixJQUFJLENBQUMsVUFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxZQUFZSixNQUFNVSxRQUFRLEVBQzdCQyxLQUFLLENBQUMsWUFBWTtnQkFBRUMsV0FBVztZQUFNLEdBQUcsZUFBZTthQUN2REQsS0FBSyxDQUFDLGNBQWM7Z0JBQUVDLFdBQVc7WUFBSztZQUV6QyxJQUFJdEIsT0FBTztnQkFDVCxPQUFPSSxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO29CQUFFQyxTQUFTO29CQUFPTixPQUFPO3dCQUFFTyxNQUFNO3dCQUFrQkMsU0FBU1IsTUFBTVEsT0FBTztvQkFBQztnQkFBRSxHQUM1RTtvQkFBRUMsUUFBUTtnQkFBSTtZQUVsQjtZQUVBUyxnQkFBZ0JwQixRQUFRLEVBQUU7UUFDNUIsT0FBTztZQUNMLG1DQUFtQztZQUNuQ29CLGdCQUFnQjtnQkFBQ1I7YUFBTTtRQUN6QjtRQUVBLE9BQU9OLG9CQUFZLENBQUNDLElBQUksQ0FBQztZQUN2QkMsU0FBUztZQUNUUixNQUFNb0I7UUFDUjtJQUNGLEVBQUUsT0FBT2xCLE9BQU87UUFDZHVCLFFBQVF2QixLQUFLLENBQUMsa0NBQWtDQTtRQUNoRCxPQUFPSSxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO1lBQUVDLFNBQVM7WUFBT04sT0FBTztnQkFBRU8sTUFBTTtnQkFBa0JDLFNBQVM7WUFBaUM7UUFBRSxHQUMvRjtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiJ9