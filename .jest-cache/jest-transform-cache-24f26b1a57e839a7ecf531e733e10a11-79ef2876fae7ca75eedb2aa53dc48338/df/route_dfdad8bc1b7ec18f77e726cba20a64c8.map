{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/guest/family/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\n\n/**\n * Family Members API Routes\n * \n * GET: Get all family members in the guest's group\n * \n * Requirements: 6.3\n */\n\n/**\n * GET /api/guest/family\n * Get all family members in the guest's group\n */\nexport async function GET(request: Request) {\n  try {\n    const supabase = createRouteHandlerClient({ cookies });\n    \n    // Check authentication\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // Get current guest\n    const { data: guest, error: guestError } = await supabase\n      .from('guests')\n      .select('id, group_id, age_type')\n      .eq('email', session.user.email)\n      .single();\n    \n    if (guestError || !guest) {\n      return NextResponse.json(\n        { success: false, error: { code: 'NOT_FOUND', message: 'Guest profile not found' } },\n        { status: 404 }\n      );\n    }\n    \n    // Get family members based on access control\n    let familyMembers = [];\n    \n    if (guest.age_type === 'adult') {\n      // Adults can see all family members in their group\n      const { data, error } = await supabase\n        .from('guests')\n        .select('*')\n        .eq('group_id', guest.group_id)\n        .order('age_type', { ascending: false }) // Adults first\n        .order('first_name', { ascending: true });\n      \n      if (error) {\n        return NextResponse.json(\n          { success: false, error: { code: 'DATABASE_ERROR', message: error.message } },\n          { status: 500 }\n        );\n      }\n      \n      familyMembers = data || [];\n    } else {\n      // Children can only see themselves\n      familyMembers = [guest];\n    }\n    \n    return NextResponse.json({\n      success: true,\n      data: familyMembers\n    });\n  } catch (error) {\n    console.error('Error fetching family members:', error);\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'Failed to fetch family members' } },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["GET","request","supabase","createRouteHandlerClient","cookies","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","guest","guestError","from","select","eq","user","email","single","familyMembers","age_type","group_id","order","ascending","console"],"mappings":";;;;+BAgBsBA;;;eAAAA;;;mCAhBmB;yBACjB;wBACK;AActB,eAAeA,IAAIC,OAAgB;IACxC,IAAI;QACF,MAAMC,WAAWC,IAAAA,2CAAwB,EAAC;YAAEC,SAAAA,gBAAO;QAAC;QAEpD,uBAAuB;QACvB,MAAM,EAAEC,MAAM,EAAEC,OAAO,EAAE,EAAEC,OAAOC,SAAS,EAAE,GAAG,MAAMN,SAASO,IAAI,CAACC,UAAU;QAE9E,IAAIF,aAAa,CAACF,SAAS;YACzB,OAAOK,oBAAY,CAACC,IAAI,CACtB;gBAAEC,SAAS;gBAAON,OAAO;oBAAEO,MAAM;oBAAgBC,SAAS;gBAA0B;YAAE,GACtF;gBAAEC,QAAQ;YAAI;QAElB;QAEA,oBAAoB;QACpB,MAAM,EAAEX,MAAMY,KAAK,EAAEV,OAAOW,UAAU,EAAE,GAAG,MAAMhB,SAC9CiB,IAAI,CAAC,UACLC,MAAM,CAAC,0BACPC,EAAE,CAAC,SAASf,QAAQgB,IAAI,CAACC,KAAK,EAC9BC,MAAM;QAET,IAAIN,cAAc,CAACD,OAAO;YACxB,OAAON,oBAAY,CAACC,IAAI,CACtB;gBAAEC,SAAS;gBAAON,OAAO;oBAAEO,MAAM;oBAAaC,SAAS;gBAA0B;YAAE,GACnF;gBAAEC,QAAQ;YAAI;QAElB;QAEA,6CAA6C;QAC7C,IAAIS,gBAAgB,EAAE;QAEtB,IAAIR,MAAMS,QAAQ,KAAK,SAAS;YAC9B,mDAAmD;YACnD,MAAM,EAAErB,IAAI,EAAEE,KAAK,EAAE,GAAG,MAAML,SAC3BiB,IAAI,CAAC,UACLC,MAAM,CAAC,KACPC,EAAE,CAAC,YAAYJ,MAAMU,QAAQ,EAC7BC,KAAK,CAAC,YAAY;gBAAEC,WAAW;YAAM,GAAG,eAAe;aACvDD,KAAK,CAAC,cAAc;gBAAEC,WAAW;YAAK;YAEzC,IAAItB,OAAO;gBACT,OAAOI,oBAAY,CAACC,IAAI,CACtB;oBAAEC,SAAS;oBAAON,OAAO;wBAAEO,MAAM;wBAAkBC,SAASR,MAAMQ,OAAO;oBAAC;gBAAE,GAC5E;oBAAEC,QAAQ;gBAAI;YAElB;YAEAS,gBAAgBpB,QAAQ,EAAE;QAC5B,OAAO;YACL,mCAAmC;YACnCoB,gBAAgB;gBAACR;aAAM;QACzB;QAEA,OAAON,oBAAY,CAACC,IAAI,CAAC;YACvBC,SAAS;YACTR,MAAMoB;QACR;IACF,EAAE,OAAOlB,OAAO;QACduB,QAAQvB,KAAK,CAAC,kCAAkCA;QAChD,OAAOI,oBAAY,CAACC,IAAI,CACtB;YAAEC,SAAS;YAAON,OAAO;gBAAEO,MAAM;gBAAkBC,SAAS;YAAiC;QAAE,GAC/F;YAAEC,QAAQ;QAAI;IAElB;AACF"}