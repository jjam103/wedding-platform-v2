{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/activityCapacityWarning.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\n\n/**\n * Property 9: Activity Capacity Warning Threshold\n * \n * Validates: Requirements 7.7\n * \n * Property: For any activity with capacity and current RSVPs,\n * IF utilization >= 90% AND utilization < 100%,\n * THEN the system SHALL display a warning indicator.\n * \n * This property ensures that activities approaching capacity\n * trigger appropriate warnings to help admins manage attendance.\n */\n\ndescribe('Feature: admin-backend-integration-cms, Property 9: Activity Capacity Warning Threshold', () => {\n  /**\n   * Calculate utilization percentage\n   */\n  function calculateUtilization(currentRsvps: number, capacity: number): number {\n    if (capacity === 0) return 0;\n    return (currentRsvps / capacity) * 100;\n  }\n\n  /**\n   * Determine if warning should be displayed\n   */\n  function shouldDisplayWarning(currentRsvps: number, capacity: number): boolean {\n    const utilization = calculateUtilization(currentRsvps, capacity);\n    return utilization >= 90 && utilization < 100;\n  }\n\n  it('should display warning for activities at 90%+ capacity but below 100%', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 10 and 1000\n        fc.integer({ min: 10, max: 1000 }),\n        (capacity) => {\n          // Generate current RSVPs that result in 90-99% utilization\n          const minRsvps = Math.ceil(capacity * 0.9);\n          const maxRsvps = capacity - 1;\n          \n          fc.assert(\n            fc.property(\n              fc.integer({ min: minRsvps, max: maxRsvps }),\n              (currentRsvps) => {\n                const utilization = calculateUtilization(currentRsvps, capacity);\n                const warning = shouldDisplayWarning(currentRsvps, capacity);\n                \n                // Property: If utilization is between 90% and 100%, warning should be true\n                if (utilization >= 90 && utilization < 100) {\n                  expect(warning).toBe(true);\n                  expect(utilization).toBeGreaterThanOrEqual(90);\n                  expect(utilization).toBeLessThan(100);\n                }\n              }\n            ),\n            { numRuns: 50 }\n          );\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should NOT display warning for activities below 90% capacity', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 10 and 1000\n        fc.integer({ min: 10, max: 1000 }),\n        (capacity) => {\n          // Generate current RSVPs that result in <90% utilization\n          const maxRsvps = Math.floor(capacity * 0.89);\n          \n          if (maxRsvps >= 0) {\n            fc.assert(\n              fc.property(\n                fc.integer({ min: 0, max: maxRsvps }),\n                (currentRsvps) => {\n                  const utilization = calculateUtilization(currentRsvps, capacity);\n                  const warning = shouldDisplayWarning(currentRsvps, capacity);\n                  \n                  // Property: If utilization is below 90%, warning should be false\n                  if (utilization < 90) {\n                    expect(warning).toBe(false);\n                    expect(utilization).toBeLessThan(90);\n                  }\n                }\n              ),\n              { numRuns: 50 }\n            );\n          }\n        }\n      ),\n      { numRuns: 20 }\n    );\n  });\n\n  it('should NOT display warning for activities at exactly 100% capacity', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 1 and 1000\n        fc.integer({ min: 1, max: 1000 }),\n        (capacity) => {\n          const currentRsvps = capacity; // Exactly at capacity\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const warning = shouldDisplayWarning(currentRsvps, capacity);\n          \n          // Property: At exactly 100%, warning should be false (alert should be shown instead)\n          expect(utilization).toBe(100);\n          expect(warning).toBe(false);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle edge case: exactly 90% capacity', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity that is divisible by 10 for exact 90%\n        fc.integer({ min: 10, max: 1000 }).map(n => n * 10),\n        (capacity) => {\n          const currentRsvps = capacity * 0.9; // Exactly 90%\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const warning = shouldDisplayWarning(currentRsvps, capacity);\n          \n          // Property: At exactly 90%, warning should be true\n          expect(utilization).toBe(90);\n          expect(warning).toBe(true);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle edge case: 99% capacity (just below 100%)', () => {\n    fc.assert(\n      fc.property(\n        // Generate capacity between 100 and 1000\n        fc.integer({ min: 100, max: 1000 }),\n        (capacity) => {\n          const currentRsvps = Math.floor(capacity * 0.99);\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const warning = shouldDisplayWarning(currentRsvps, capacity);\n          \n          // Property: At 99%, warning should be true\n          if (utilization >= 90 && utilization < 100) {\n            expect(warning).toBe(true);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle zero capacity (unlimited)', () => {\n    fc.assert(\n      fc.property(\n        fc.integer({ min: 0, max: 1000 }),\n        (currentRsvps) => {\n          const capacity = 0; // Unlimited capacity\n          const utilization = calculateUtilization(currentRsvps, capacity);\n          const warning = shouldDisplayWarning(currentRsvps, capacity);\n          \n          // Property: With unlimited capacity, no warning should be shown\n          expect(utilization).toBe(0);\n          expect(warning).toBe(false);\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain warning threshold consistency across all valid inputs', () => {\n    fc.assert(\n      fc.property(\n        fc.integer({ min: 1, max: 1000 }), // capacity\n        fc.integer({ min: 0, max: 1000 }), // currentRsvps\n        (capacity, currentRsvps) => {\n          // Ensure currentRsvps doesn't exceed capacity\n          const validRsvps = Math.min(currentRsvps, capacity);\n          const utilization = calculateUtilization(validRsvps, capacity);\n          const warning = shouldDisplayWarning(validRsvps, capacity);\n          \n          // Property: Warning state must be consistent with utilization calculation\n          if (utilization >= 90 && utilization < 100) {\n            expect(warning).toBe(true);\n          } else {\n            expect(warning).toBe(false);\n          }\n        }\n      ),\n      { numRuns: 200 }\n    );\n  });\n});\n"],"names":["describe","calculateUtilization","currentRsvps","capacity","shouldDisplayWarning","utilization","it","fc","assert","property","integer","min","max","minRsvps","Math","ceil","maxRsvps","warning","expect","toBe","toBeGreaterThanOrEqual","toBeLessThan","numRuns","floor","map","n","validRsvps"],"mappings":";;;;mEAAoB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEpB;;;;;;;;;;;CAWC,GAEDA,SAAS,2FAA2F;IAClG;;GAEC,GACD,SAASC,qBAAqBC,YAAoB,EAAEC,QAAgB;QAClE,IAAIA,aAAa,GAAG,OAAO;QAC3B,OAAO,AAACD,eAAeC,WAAY;IACrC;IAEA;;GAEC,GACD,SAASC,qBAAqBF,YAAoB,EAAEC,QAAgB;QAClE,MAAME,cAAcJ,qBAAqBC,cAAcC;QACvD,OAAOE,eAAe,MAAMA,cAAc;IAC5C;IAEAC,GAAG,yEAAyE;QAC1EC,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACT,wCAAwC;QACxCF,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAIC,KAAK;QAAK,IAChC,CAACT;YACC,2DAA2D;YAC3D,MAAMU,WAAWC,KAAKC,IAAI,CAACZ,WAAW;YACtC,MAAMa,WAAWb,WAAW;YAE5BI,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACTF,WAAGG,OAAO,CAAC;gBAAEC,KAAKE;gBAAUD,KAAKI;YAAS,IAC1C,CAACd;gBACC,MAAMG,cAAcJ,qBAAqBC,cAAcC;gBACvD,MAAMc,UAAUb,qBAAqBF,cAAcC;gBAEnD,2EAA2E;gBAC3E,IAAIE,eAAe,MAAMA,cAAc,KAAK;oBAC1Ca,OAAOD,SAASE,IAAI,CAAC;oBACrBD,OAAOb,aAAae,sBAAsB,CAAC;oBAC3CF,OAAOb,aAAagB,YAAY,CAAC;gBACnC;YACF,IAEF;gBAAEC,SAAS;YAAG;QAElB,IAEF;YAAEA,SAAS;QAAG;IAElB;IAEAhB,GAAG,gEAAgE;QACjEC,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACT,wCAAwC;QACxCF,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAIC,KAAK;QAAK,IAChC,CAACT;YACC,yDAAyD;YACzD,MAAMa,WAAWF,KAAKS,KAAK,CAACpB,WAAW;YAEvC,IAAIa,YAAY,GAAG;gBACjBT,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACTF,WAAGG,OAAO,CAAC;oBAAEC,KAAK;oBAAGC,KAAKI;gBAAS,IACnC,CAACd;oBACC,MAAMG,cAAcJ,qBAAqBC,cAAcC;oBACvD,MAAMc,UAAUb,qBAAqBF,cAAcC;oBAEnD,iEAAiE;oBACjE,IAAIE,cAAc,IAAI;wBACpBa,OAAOD,SAASE,IAAI,CAAC;wBACrBD,OAAOb,aAAagB,YAAY,CAAC;oBACnC;gBACF,IAEF;oBAAEC,SAAS;gBAAG;YAElB;QACF,IAEF;YAAEA,SAAS;QAAG;IAElB;IAEAhB,GAAG,sEAAsE;QACvEC,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACT,uCAAuC;QACvCF,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAGC,KAAK;QAAK,IAC/B,CAACT;YACC,MAAMD,eAAeC,UAAU,sBAAsB;YACrD,MAAME,cAAcJ,qBAAqBC,cAAcC;YACvD,MAAMc,UAAUb,qBAAqBF,cAAcC;YAEnD,qFAAqF;YACrFe,OAAOb,aAAac,IAAI,CAAC;YACzBD,OAAOD,SAASE,IAAI,CAAC;QACvB,IAEF;YAAEG,SAAS;QAAI;IAEnB;IAEAhB,GAAG,iDAAiD;QAClDC,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACT,0DAA0D;QAC1DF,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAIC,KAAK;QAAK,GAAGY,GAAG,CAACC,CAAAA,IAAKA,IAAI,KAChD,CAACtB;YACC,MAAMD,eAAeC,WAAW,KAAK,cAAc;YACnD,MAAME,cAAcJ,qBAAqBC,cAAcC;YACvD,MAAMc,UAAUb,qBAAqBF,cAAcC;YAEnD,mDAAmD;YACnDe,OAAOb,aAAac,IAAI,CAAC;YACzBD,OAAOD,SAASE,IAAI,CAAC;QACvB,IAEF;YAAEG,SAAS;QAAI;IAEnB;IAEAhB,GAAG,2DAA2D;QAC5DC,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACT,yCAAyC;QACzCF,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAKC,KAAK;QAAK,IACjC,CAACT;YACC,MAAMD,eAAeY,KAAKS,KAAK,CAACpB,WAAW;YAC3C,MAAME,cAAcJ,qBAAqBC,cAAcC;YACvD,MAAMc,UAAUb,qBAAqBF,cAAcC;YAEnD,2CAA2C;YAC3C,IAAIE,eAAe,MAAMA,cAAc,KAAK;gBAC1Ca,OAAOD,SAASE,IAAI,CAAC;YACvB;QACF,IAEF;YAAEG,SAAS;QAAI;IAEnB;IAEAhB,GAAG,2CAA2C;QAC5CC,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACTF,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAGC,KAAK;QAAK,IAC/B,CAACV;YACC,MAAMC,WAAW,GAAG,qBAAqB;YACzC,MAAME,cAAcJ,qBAAqBC,cAAcC;YACvD,MAAMc,UAAUb,qBAAqBF,cAAcC;YAEnD,gEAAgE;YAChEe,OAAOb,aAAac,IAAI,CAAC;YACzBD,OAAOD,SAASE,IAAI,CAAC;QACvB,IAEF;YAAEG,SAAS;QAAI;IAEnB;IAEAhB,GAAG,yEAAyE;QAC1EC,WAAGC,MAAM,CACPD,WAAGE,QAAQ,CACTF,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAGC,KAAK;QAAK,IAC/BL,WAAGG,OAAO,CAAC;YAAEC,KAAK;YAAGC,KAAK;QAAK,IAC/B,CAACT,UAAUD;YACT,8CAA8C;YAC9C,MAAMwB,aAAaZ,KAAKH,GAAG,CAACT,cAAcC;YAC1C,MAAME,cAAcJ,qBAAqByB,YAAYvB;YACrD,MAAMc,UAAUb,qBAAqBsB,YAAYvB;YAEjD,0EAA0E;YAC1E,IAAIE,eAAe,MAAMA,cAAc,KAAK;gBAC1Ca,OAAOD,SAASE,IAAI,CAAC;YACvB,OAAO;gBACLD,OAAOD,SAASE,IAAI,CAAC;YACvB;QACF,IAEF;YAAEG,SAAS;QAAI;IAEnB;AACF"}