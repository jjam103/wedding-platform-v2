2aad8572cef9d1e329064a6b08489a2b
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    }
});
const _apiHelpers = require("../../../../lib/apiHelpers");
const _contentPagesService = require("../../../../services/contentPagesService");
const _cmsSchemas = require("../../../../schemas/cmsSchemas");
async function GET(request) {
    return (0, _apiHelpers.withAuth)(async ()=>{
        try {
            const { searchParams } = new URL(request.url);
            // Parse filters
            const filters = (0, _apiHelpers.parseFilters)(searchParams, [
                'status'
            ]);
            // Validate status filter if provided
            const status = filters.status;
            if (status && status !== 'draft' && status !== 'published') {
                return (0, _apiHelpers.errorResponse)('VALIDATION_ERROR', 'Invalid status filter. Must be "draft" or "published"', 400);
            }
            // Call service
            const result = await (0, _contentPagesService.listContentPages)(status ? {
                status
            } : undefined);
            if (!result.success) {
                return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, 500, result.error.details);
            }
            return (0, _apiHelpers.successResponse)(result.data);
        } catch (error) {
            console.error('GET /api/admin/content-pages error:', error);
            return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', 'Failed to fetch content pages', 500);
        }
    });
}
async function POST(request) {
    return (0, _apiHelpers.withAuth)(async ()=>{
        try {
            const body = await request.json();
            // Validate request body
            const validation = (0, _apiHelpers.validateBody)(body, _cmsSchemas.createContentPageSchema);
            if (!validation.success) {
                return (0, _apiHelpers.errorResponse)(validation.error.code, validation.error.message, 400, validation.error.details);
            }
            // Call service
            const result = await (0, _contentPagesService.createContentPage)(validation.data);
            if (!result.success) {
                // Map error codes to appropriate HTTP status codes
                const statusCode = result.error.code === 'VALIDATION_ERROR' ? 400 : 500;
                return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, statusCode, result.error.details);
            }
            return (0, _apiHelpers.successResponse)(result.data, 201);
        } catch (error) {
            console.error('POST /api/admin/content-pages error:', error);
            return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', 'Failed to create content page', 500);
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9jb250ZW50LXBhZ2VzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHtcbiAgd2l0aEF1dGgsXG4gIHN1Y2Nlc3NSZXNwb25zZSxcbiAgZXJyb3JSZXNwb25zZSxcbiAgdmFsaWRhdGVCb2R5LFxuICBwYXJzZVBhZ2luYXRpb24sXG4gIGdldFBhZ2luYXRpb25SYW5nZSxcbiAgcGFyc2VGaWx0ZXJzLFxufSBmcm9tICdAL2xpYi9hcGlIZWxwZXJzJztcbmltcG9ydCB7XG4gIGNyZWF0ZUNvbnRlbnRQYWdlLFxuICBsaXN0Q29udGVudFBhZ2VzLFxufSBmcm9tICdAL3NlcnZpY2VzL2NvbnRlbnRQYWdlc1NlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlQ29udGVudFBhZ2VTY2hlbWEgfSBmcm9tICdAL3NjaGVtYXMvY21zU2NoZW1hcyc7XG5cbi8qKlxuICogR0VUIC9hcGkvYWRtaW4vY29udGVudC1wYWdlc1xuICogXG4gKiBMaXN0IGFsbCBjb250ZW50IHBhZ2VzIHdpdGggb3B0aW9uYWwgZmlsdGVyaW5nIGJ5IHN0YXR1c1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHJldHVybiB3aXRoQXV0aChhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcblxuICAgICAgLy8gUGFyc2UgZmlsdGVyc1xuICAgICAgY29uc3QgZmlsdGVycyA9IHBhcnNlRmlsdGVycyhzZWFyY2hQYXJhbXMsIFsnc3RhdHVzJ10pO1xuICAgICAgXG4gICAgICAvLyBWYWxpZGF0ZSBzdGF0dXMgZmlsdGVyIGlmIHByb3ZpZGVkXG4gICAgICBjb25zdCBzdGF0dXMgPSBmaWx0ZXJzLnN0YXR1cyBhcyAnZHJhZnQnIHwgJ3B1Ymxpc2hlZCcgfCB1bmRlZmluZWQ7XG4gICAgICBpZiAoc3RhdHVzICYmIHN0YXR1cyAhPT0gJ2RyYWZ0JyAmJiBzdGF0dXMgIT09ICdwdWJsaXNoZWQnKSB7XG4gICAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICAgICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICAnSW52YWxpZCBzdGF0dXMgZmlsdGVyLiBNdXN0IGJlIFwiZHJhZnRcIiBvciBcInB1Ymxpc2hlZFwiJyxcbiAgICAgICAgICA0MDBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FsbCBzZXJ2aWNlXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsaXN0Q29udGVudFBhZ2VzKHN0YXR1cyA/IHsgc3RhdHVzIH0gOiB1bmRlZmluZWQpO1xuXG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICAgIHJlc3VsdC5lcnJvci5jb2RlLFxuICAgICAgICAgIHJlc3VsdC5lcnJvci5tZXNzYWdlLFxuICAgICAgICAgIDUwMCxcbiAgICAgICAgICByZXN1bHQuZXJyb3IuZGV0YWlsc1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3VjY2Vzc1Jlc3BvbnNlKHJlc3VsdC5kYXRhKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignR0VUIC9hcGkvYWRtaW4vY29udGVudC1wYWdlcyBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZSgnSU5URVJOQUxfRVJST1InLCAnRmFpbGVkIHRvIGZldGNoIGNvbnRlbnQgcGFnZXMnLCA1MDApO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogUE9TVCAvYXBpL2FkbWluL2NvbnRlbnQtcGFnZXNcbiAqIFxuICogQ3JlYXRlIGEgbmV3IGNvbnRlbnQgcGFnZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICByZXR1cm4gd2l0aEF1dGgoYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVlc3QgYm9keVxuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlQm9keShib2R5LCBjcmVhdGVDb250ZW50UGFnZVNjaGVtYSk7XG4gICAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gZXJyb3JSZXNwb25zZShcbiAgICAgICAgICB2YWxpZGF0aW9uLmVycm9yLmNvZGUsXG4gICAgICAgICAgdmFsaWRhdGlvbi5lcnJvci5tZXNzYWdlLFxuICAgICAgICAgIDQwMCxcbiAgICAgICAgICB2YWxpZGF0aW9uLmVycm9yLmRldGFpbHNcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FsbCBzZXJ2aWNlXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250ZW50UGFnZSh2YWxpZGF0aW9uLmRhdGEpO1xuXG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIC8vIE1hcCBlcnJvciBjb2RlcyB0byBhcHByb3ByaWF0ZSBIVFRQIHN0YXR1cyBjb2Rlc1xuICAgICAgICBjb25zdCBzdGF0dXNDb2RlID0gcmVzdWx0LmVycm9yLmNvZGUgPT09ICdWQUxJREFUSU9OX0VSUk9SJyA/IDQwMCA6IDUwMDtcbiAgICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgICAgcmVzdWx0LmVycm9yLmNvZGUsXG4gICAgICAgICAgcmVzdWx0LmVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgc3RhdHVzQ29kZSxcbiAgICAgICAgICByZXN1bHQuZXJyb3IuZGV0YWlsc1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3VjY2Vzc1Jlc3BvbnNlKHJlc3VsdC5kYXRhLCAyMDEpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdQT1NUIC9hcGkvYWRtaW4vY29udGVudC1wYWdlcyBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZXJyb3JSZXNwb25zZSgnSU5URVJOQUxfRVJST1InLCAnRmFpbGVkIHRvIGNyZWF0ZSBjb250ZW50IHBhZ2UnLCA1MDApO1xuICAgIH1cbiAgfSk7XG59XG4iXSwibmFtZXMiOlsiR0VUIiwiUE9TVCIsInJlcXVlc3QiLCJ3aXRoQXV0aCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsImZpbHRlcnMiLCJwYXJzZUZpbHRlcnMiLCJzdGF0dXMiLCJlcnJvclJlc3BvbnNlIiwicmVzdWx0IiwibGlzdENvbnRlbnRQYWdlcyIsInVuZGVmaW5lZCIsInN1Y2Nlc3MiLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwiZGV0YWlscyIsInN1Y2Nlc3NSZXNwb25zZSIsImRhdGEiLCJjb25zb2xlIiwiYm9keSIsImpzb24iLCJ2YWxpZGF0aW9uIiwidmFsaWRhdGVCb2R5IiwiY3JlYXRlQ29udGVudFBhZ2VTY2hlbWEiLCJjcmVhdGVDb250ZW50UGFnZSIsInN0YXR1c0NvZGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O1FBcUJzQkE7ZUFBQUE7O1FBMkNBQztlQUFBQTs7OzRCQXZEZjtxQ0FJQTs0QkFDaUM7QUFPakMsZUFBZUQsSUFBSUUsT0FBb0I7SUFDNUMsT0FBT0MsSUFBQUEsb0JBQVEsRUFBQztRQUNkLElBQUk7WUFDRixNQUFNLEVBQUVDLFlBQVksRUFBRSxHQUFHLElBQUlDLElBQUlILFFBQVFJLEdBQUc7WUFFNUMsZ0JBQWdCO1lBQ2hCLE1BQU1DLFVBQVVDLElBQUFBLHdCQUFZLEVBQUNKLGNBQWM7Z0JBQUM7YUFBUztZQUVyRCxxQ0FBcUM7WUFDckMsTUFBTUssU0FBU0YsUUFBUUUsTUFBTTtZQUM3QixJQUFJQSxVQUFVQSxXQUFXLFdBQVdBLFdBQVcsYUFBYTtnQkFDMUQsT0FBT0MsSUFBQUEseUJBQWEsRUFDbEIsb0JBQ0EseURBQ0E7WUFFSjtZQUVBLGVBQWU7WUFDZixNQUFNQyxTQUFTLE1BQU1DLElBQUFBLHFDQUFnQixFQUFDSCxTQUFTO2dCQUFFQTtZQUFPLElBQUlJO1lBRTVELElBQUksQ0FBQ0YsT0FBT0csT0FBTyxFQUFFO2dCQUNuQixPQUFPSixJQUFBQSx5QkFBYSxFQUNsQkMsT0FBT0ksS0FBSyxDQUFDQyxJQUFJLEVBQ2pCTCxPQUFPSSxLQUFLLENBQUNFLE9BQU8sRUFDcEIsS0FDQU4sT0FBT0ksS0FBSyxDQUFDRyxPQUFPO1lBRXhCO1lBRUEsT0FBT0MsSUFBQUEsMkJBQWUsRUFBQ1IsT0FBT1MsSUFBSTtRQUNwQyxFQUFFLE9BQU9MLE9BQU87WUFDZE0sUUFBUU4sS0FBSyxDQUFDLHVDQUF1Q0E7WUFDckQsT0FBT0wsSUFBQUEseUJBQWEsRUFBQyxrQkFBa0IsaUNBQWlDO1FBQzFFO0lBQ0Y7QUFDRjtBQU9PLGVBQWVULEtBQUtDLE9BQW9CO0lBQzdDLE9BQU9DLElBQUFBLG9CQUFRLEVBQUM7UUFDZCxJQUFJO1lBQ0YsTUFBTW1CLE9BQU8sTUFBTXBCLFFBQVFxQixJQUFJO1lBRS9CLHdCQUF3QjtZQUN4QixNQUFNQyxhQUFhQyxJQUFBQSx3QkFBWSxFQUFDSCxNQUFNSSxtQ0FBdUI7WUFDN0QsSUFBSSxDQUFDRixXQUFXVixPQUFPLEVBQUU7Z0JBQ3ZCLE9BQU9KLElBQUFBLHlCQUFhLEVBQ2xCYyxXQUFXVCxLQUFLLENBQUNDLElBQUksRUFDckJRLFdBQVdULEtBQUssQ0FBQ0UsT0FBTyxFQUN4QixLQUNBTyxXQUFXVCxLQUFLLENBQUNHLE9BQU87WUFFNUI7WUFFQSxlQUFlO1lBQ2YsTUFBTVAsU0FBUyxNQUFNZ0IsSUFBQUEsc0NBQWlCLEVBQUNILFdBQVdKLElBQUk7WUFFdEQsSUFBSSxDQUFDVCxPQUFPRyxPQUFPLEVBQUU7Z0JBQ25CLG1EQUFtRDtnQkFDbkQsTUFBTWMsYUFBYWpCLE9BQU9JLEtBQUssQ0FBQ0MsSUFBSSxLQUFLLHFCQUFxQixNQUFNO2dCQUNwRSxPQUFPTixJQUFBQSx5QkFBYSxFQUNsQkMsT0FBT0ksS0FBSyxDQUFDQyxJQUFJLEVBQ2pCTCxPQUFPSSxLQUFLLENBQUNFLE9BQU8sRUFDcEJXLFlBQ0FqQixPQUFPSSxLQUFLLENBQUNHLE9BQU87WUFFeEI7WUFFQSxPQUFPQyxJQUFBQSwyQkFBZSxFQUFDUixPQUFPUyxJQUFJLEVBQUU7UUFDdEMsRUFBRSxPQUFPTCxPQUFPO1lBQ2RNLFFBQVFOLEtBQUssQ0FBQyx3Q0FBd0NBO1lBQ3RELE9BQU9MLElBQUFBLHlCQUFhLEVBQUMsa0JBQWtCLGlDQUFpQztRQUMxRTtJQUNGO0FBQ0YifQ==