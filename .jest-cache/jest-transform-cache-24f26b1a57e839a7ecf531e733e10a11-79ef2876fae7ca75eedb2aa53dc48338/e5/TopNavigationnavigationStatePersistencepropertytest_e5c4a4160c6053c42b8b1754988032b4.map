{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/TopNavigation.navigationStatePersistence.property.test.tsx"],"sourcesContent":["/**\n * Property-Based Test: Navigation State Persistence\n * \n * Feature: guest-portal-and-admin-enhancements\n * Property 2: Navigation State Persistence\n * \n * Validates Requirements: 1.10, 20.1, 20.2, 20.3\n * \n * Property: For any valid tab and sub-item selection, the navigation state\n * SHALL be persisted in sessionStorage and restored on page refresh.\n * \n * Test Strategy:\n * - Generate random tab and sub-item combinations\n * - Verify state is saved to sessionStorage\n * - Simulate page refresh by clearing and restoring state\n * - Verify state is correctly restored\n */\n\nimport * as fc from 'fast-check';\n\n// Mock sessionStorage for testing\nconst mockSessionStorage = (() => {\n  let store: Record<string, string> = {};\n\n  return {\n    getItem: (key: string) => store[key] || null,\n    setItem: (key: string, value: string) => {\n      store[key] = value;\n    },\n    removeItem: (key: string) => {\n      delete store[key];\n    },\n    clear: () => {\n      store = {};\n    },\n  };\n})();\n\n// Replace global sessionStorage with mock\nObject.defineProperty(window, 'sessionStorage', {\n  value: mockSessionStorage,\n  writable: true,\n});\n\n// Navigation structure matching TopNavigation component\nconst NAVIGATION_TABS = [\n  {\n    id: 'content',\n    subItems: ['home-page', 'activities', 'events', 'content-pages', 'locations', 'photos'],\n  },\n  {\n    id: 'guests',\n    subItems: ['guest-list', 'guest-groups', 'import-export'],\n  },\n  {\n    id: 'rsvps',\n    subItems: ['rsvp-analytics', 'activity-rsvps', 'event-rsvps', 'deadlines'],\n  },\n  {\n    id: 'logistics',\n    subItems: ['accommodations', 'transportation', 'budget', 'vendors'],\n  },\n  {\n    id: 'admin',\n    subItems: ['admin-users', 'settings', 'email-templates', 'audit-logs'],\n  },\n];\n\n// Arbitrary for generating valid tab IDs\nconst tabIdArbitrary = fc.constantFrom(\n  'content',\n  'guests',\n  'rsvps',\n  'logistics',\n  'admin'\n);\n\n// Arbitrary for generating valid sub-item IDs for a given tab\nconst subItemIdArbitrary = (tabId: string) => {\n  const tab = NAVIGATION_TABS.find(t => t.id === tabId);\n  if (!tab) return fc.constant('');\n  return fc.constantFrom(...tab.subItems);\n};\n\n// Arbitrary for generating navigation state\nconst navigationStateArbitrary = fc\n  .tuple(tabIdArbitrary, fc.string())\n  .chain(([tabId]) =>\n    fc.tuple(fc.constant(tabId), subItemIdArbitrary(tabId))\n  )\n  .map(([tabId, subItemId]) => ({ tabId, subItemId }));\n\ndescribe('Feature: guest-portal-and-admin-enhancements, Property 2: Navigation State Persistence', () => {\n  beforeEach(() => {\n    mockSessionStorage.clear();\n  });\n\n  it('should persist navigation state to sessionStorage', () => {\n    fc.assert(\n      fc.property(navigationStateArbitrary, ({ tabId, subItemId }) => {\n        // Simulate setting navigation state\n        sessionStorage.setItem('activeTab', tabId);\n        sessionStorage.setItem('activeSubItem', subItemId);\n\n        // Verify state is persisted\n        const storedTab = sessionStorage.getItem('activeTab');\n        const storedSubItem = sessionStorage.getItem('activeSubItem');\n\n        expect(storedTab).toBe(tabId);\n        expect(storedSubItem).toBe(subItemId);\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should restore navigation state from sessionStorage after page refresh', () => {\n    fc.assert(\n      fc.property(navigationStateArbitrary, ({ tabId, subItemId }) => {\n        // Set initial state\n        sessionStorage.setItem('activeTab', tabId);\n        sessionStorage.setItem('activeSubItem', subItemId);\n\n        // Simulate page refresh by reading state\n        const restoredTab = sessionStorage.getItem('activeTab');\n        const restoredSubItem = sessionStorage.getItem('activeSubItem');\n\n        // Verify state is correctly restored\n        expect(restoredTab).toBe(tabId);\n        expect(restoredSubItem).toBe(subItemId);\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should maintain state consistency across multiple updates', () => {\n    fc.assert(\n      fc.property(\n        fc.array(navigationStateArbitrary, { minLength: 1, maxLength: 10 }),\n        (states) => {\n          // Apply multiple state updates\n          states.forEach(({ tabId, subItemId }) => {\n            sessionStorage.setItem('activeTab', tabId);\n            sessionStorage.setItem('activeSubItem', subItemId);\n          });\n\n          // Verify final state matches last update\n          const lastState = states[states.length - 1];\n          const storedTab = sessionStorage.getItem('activeTab');\n          const storedSubItem = sessionStorage.getItem('activeSubItem');\n\n          expect(storedTab).toBe(lastState.tabId);\n          expect(storedSubItem).toBe(lastState.subItemId);\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should handle missing sessionStorage gracefully', () => {\n    fc.assert(\n      fc.property(navigationStateArbitrary, ({ tabId, subItemId }) => {\n        // Clear sessionStorage to simulate missing data\n        mockSessionStorage.clear();\n\n        // Attempt to read state\n        const storedTab = sessionStorage.getItem('activeTab');\n        const storedSubItem = sessionStorage.getItem('activeSubItem');\n\n        // Should return null for missing keys\n        expect(storedTab).toBeNull();\n        expect(storedSubItem).toBeNull();\n\n        // Set state\n        sessionStorage.setItem('activeTab', tabId);\n        sessionStorage.setItem('activeSubItem', subItemId);\n\n        // Verify state is now available\n        expect(sessionStorage.getItem('activeTab')).toBe(tabId);\n        expect(sessionStorage.getItem('activeSubItem')).toBe(subItemId);\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should preserve state when navigating between sub-items within same tab', () => {\n    fc.assert(\n      fc.property(\n        tabIdArbitrary,\n        fc.array(fc.string(), { minLength: 2, maxLength: 5 }),\n        (tabId, subItemIds) => {\n          const tab = NAVIGATION_TABS.find(t => t.id === tabId);\n          if (!tab) return true; // Skip if tab not found\n\n          // Filter to valid sub-items for this tab\n          const validSubItems = subItemIds.filter(id => tab.subItems.includes(id));\n          if (validSubItems.length < 2) return true; // Need at least 2 sub-items\n\n          // Navigate through sub-items\n          validSubItems.forEach(subItemId => {\n            sessionStorage.setItem('activeTab', tabId);\n            sessionStorage.setItem('activeSubItem', subItemId);\n\n            // Verify tab remains consistent\n            expect(sessionStorage.getItem('activeTab')).toBe(tabId);\n          });\n\n          // Verify final sub-item is correct\n          const lastSubItem = validSubItems[validSubItems.length - 1];\n          expect(sessionStorage.getItem('activeSubItem')).toBe(lastSubItem);\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should update URL state to reflect navigation (simulated)', () => {\n    fc.assert(\n      fc.property(navigationStateArbitrary, ({ tabId, subItemId }) => {\n        // Simulate URL update by storing state\n        sessionStorage.setItem('activeTab', tabId);\n        sessionStorage.setItem('activeSubItem', subItemId);\n\n        // In real implementation, URL would be updated via Next.js router\n        // Here we verify state is available for URL construction\n        const storedTab = sessionStorage.getItem('activeTab');\n        const storedSubItem = sessionStorage.getItem('activeSubItem');\n\n        // Verify state can be used to construct URL\n        expect(storedTab).toBeTruthy();\n        expect(storedSubItem).toBeTruthy();\n        expect(typeof storedTab).toBe('string');\n        expect(typeof storedSubItem).toBe('string');\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle browser back/forward navigation state updates', () => {\n    fc.assert(\n      fc.property(\n        fc.array(navigationStateArbitrary, { minLength: 2, maxLength: 5 }),\n        (navigationHistory) => {\n          // Simulate forward navigation\n          navigationHistory.forEach(({ tabId, subItemId }) => {\n            sessionStorage.setItem('activeTab', tabId);\n            sessionStorage.setItem('activeSubItem', subItemId);\n          });\n\n          // Verify final state\n          const lastState = navigationHistory[navigationHistory.length - 1];\n          expect(sessionStorage.getItem('activeTab')).toBe(lastState.tabId);\n          expect(sessionStorage.getItem('activeSubItem')).toBe(lastState.subItemId);\n\n          // Simulate back navigation (restore previous state)\n          if (navigationHistory.length > 1) {\n            const previousState = navigationHistory[navigationHistory.length - 2];\n            sessionStorage.setItem('activeTab', previousState.tabId);\n            sessionStorage.setItem('activeSubItem', previousState.subItemId);\n\n            expect(sessionStorage.getItem('activeTab')).toBe(previousState.tabId);\n            expect(sessionStorage.getItem('activeSubItem')).toBe(previousState.subItemId);\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n});\n"],"names":["mockSessionStorage","store","getItem","key","setItem","value","removeItem","clear","Object","defineProperty","window","writable","NAVIGATION_TABS","id","subItems","tabIdArbitrary","fc","constantFrom","subItemIdArbitrary","tabId","tab","find","t","constant","navigationStateArbitrary","tuple","string","chain","map","subItemId","describe","beforeEach","it","assert","property","sessionStorage","storedTab","storedSubItem","expect","toBe","numRuns","restoredTab","restoredSubItem","array","minLength","maxLength","states","forEach","lastState","length","toBeNull","subItemIds","validSubItems","filter","includes","lastSubItem","toBeTruthy","navigationHistory","previousState"],"mappings":"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"}