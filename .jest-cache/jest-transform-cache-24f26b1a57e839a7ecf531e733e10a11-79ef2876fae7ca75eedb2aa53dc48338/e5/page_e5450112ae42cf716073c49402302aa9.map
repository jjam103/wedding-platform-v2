{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/content-pages/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useCallback } from 'react';\nimport dynamic from 'next/dynamic';\nimport { DataTable } from '@/components/ui/DataTable';\nimport { SectionEditor } from '@/components/admin/SectionEditor';\nimport { Button } from '@/components/ui/Button';\nimport { StatusBadge } from '@/components/ui/StatusBadge';\nimport { useContentPages } from '@/hooks/useContentPages';\nimport { useToast } from '@/components/ui/ToastContext';\nimport { ConfirmDialog } from '@/components/ui/ConfirmDialog';\nimport type { ContentPage } from '@/schemas/cmsSchemas';\n\n// Lazy load ContentPageForm\nconst ContentPageForm = dynamic(() => import('@/components/admin/ContentPageForm').then(mod => ({ default: mod.ContentPageForm })), {\n  loading: () => (\n    <div className=\"animate-pulse space-y-4 p-4 border border-gray-200 rounded-lg\">\n      <div className=\"h-10 bg-gray-200 rounded\"></div>\n      <div className=\"h-10 bg-gray-200 rounded\"></div>\n      <div className=\"h-10 bg-gray-200 rounded\"></div>\n      <div className=\"flex gap-2\">\n        <div className=\"h-10 w-24 bg-gray-200 rounded\"></div>\n        <div className=\"h-10 w-24 bg-gray-200 rounded\"></div>\n      </div>\n    </div>\n  ),\n  ssr: false,\n});\n\ninterface ContentPageFormData {\n  title: string;\n  slug: string;\n  status: 'draft' | 'published';\n}\n\nexport default function ContentPagesPage() {\n  const { data: pages, loading, error, refetch, create, update, remove } = useContentPages();\n  const { showToast } = useToast();\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [editingPage, setEditingPage] = useState<ContentPage | null>(null);\n  const [expandedPageId, setExpandedPageId] = useState<string | null>(null);\n  const [deleteConfirmPage, setDeleteConfirmPage] = useState<ContentPage | null>(null);\n\n  const handleCreate = useCallback(async (data: ContentPageFormData) => {\n    const result = await create(data);\n    if (result.success) {\n      showToast({ type: 'success', message: 'Content page created successfully' });\n      setIsFormOpen(false);\n      await refetch();\n    } else {\n      showToast({ type: 'error', message: result.error || 'Failed to create page' });\n    }\n  }, [create, showToast, refetch]);\n\n  const handleUpdate = useCallback(async (data: ContentPageFormData) => {\n    if (!editingPage) return;\n    \n    const result = await update(editingPage.id, data);\n    if (result.success) {\n      showToast({ type: 'success', message: 'Content page updated successfully' });\n      setEditingPage(null);\n      setIsFormOpen(false);\n      await refetch();\n    } else {\n      showToast({ type: 'error', message: result.error || 'Failed to update page' });\n    }\n  }, [editingPage, update, showToast, refetch]);\n\n  const handleDelete = useCallback(async () => {\n    if (!deleteConfirmPage) return;\n    \n    const result = await remove(deleteConfirmPage.id);\n    if (result.success) {\n      showToast({ type: 'success', message: 'Content page deleted successfully' });\n      setDeleteConfirmPage(null);\n      await refetch();\n    } else {\n      showToast({ type: 'error', message: result.error || 'Failed to delete page' });\n    }\n  }, [deleteConfirmPage, remove, showToast, refetch]);\n\n  const handleEdit = useCallback((page: ContentPage) => {\n    setEditingPage(page);\n    setIsFormOpen(true);\n  }, []);\n\n  const handleCancel = useCallback(() => {\n    setEditingPage(null);\n    setIsFormOpen(false);\n  }, []);\n\n  const handleToggleSections = useCallback((pageId: string) => {\n    setExpandedPageId(prev => prev === pageId ? null : pageId);\n  }, []);\n\n  const columns = [\n    {\n      key: 'title',\n      label: 'Title',\n      sortable: true,\n    },\n    {\n      key: 'slug',\n      label: 'Slug',\n      sortable: true,\n      render: (value: string) => (\n        <code className=\"text-sm bg-gray-100 px-2 py-1 rounded\">/{value}</code>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'Status',\n      sortable: true,\n      render: (value: string) => {\n        const statusMap: Record<string, 'page-published' | 'page-draft'> = {\n          published: 'page-published',\n          draft: 'page-draft',\n        };\n        return <StatusBadge status={statusMap[value] || 'page-draft'} />;\n      },\n    },\n    {\n      key: 'actions',\n      label: 'Actions',\n      render: (_: any, page: ContentPage) => (\n        <div className=\"flex gap-2\">\n          <Button\n            size=\"sm\"\n            variant=\"secondary\"\n            onClick={() => window.location.href = `/${page.slug}`}\n            aria-label={`View ${page.title} as guest`}\n          >\n            View\n          </Button>\n          <Button\n            size=\"sm\"\n            variant=\"secondary\"\n            onClick={() => handleEdit(page)}\n            aria-label={`Edit ${page.title}`}\n          >\n            Edit\n          </Button>\n          <Button\n            size=\"sm\"\n            variant=\"secondary\"\n            onClick={() => handleToggleSections(page.id)}\n            aria-label={`${expandedPageId === page.id ? 'Hide' : 'Show'} sections for ${page.title}`}\n          >\n            {expandedPageId === page.id ? 'Hide Sections' : 'Sections'}\n          </Button>\n          <Button\n            size=\"sm\"\n            variant=\"danger\"\n            onClick={() => setDeleteConfirmPage(page)}\n            aria-label={`Delete ${page.title}`}\n          >\n            Delete\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  if (loading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-4\"></div>\n          <div className=\"h-64 bg-gray-200 rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <p className=\"text-red-800\">Error loading content pages: {error.message}</p>\n          <Button onClick={refetch} className=\"mt-2\">\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Content Pages</h1>\n        <p className=\"text-gray-600\">\n          Manage custom content pages with rich text and sections\n        </p>\n      </div>\n\n      <ContentPageForm\n        title={editingPage ? 'Edit Content Page' : 'Add Content Page'}\n        onSubmit={editingPage ? handleUpdate : handleCreate}\n        onCancel={handleCancel}\n        initialData={editingPage || undefined}\n        isOpen={isFormOpen}\n        onToggle={() => setIsFormOpen(!isFormOpen)}\n        submitLabel={editingPage ? 'Update' : 'Create'}\n      />\n\n      <div className=\"mt-6\">\n        {pages && pages.length > 0 ? (\n          <div className=\"space-y-4\">\n            {pages.map((page) => (\n              <div key={page.id} className=\"border border-gray-200 rounded-lg overflow-hidden\">\n                {/* Page row */}\n                <div className=\"bg-white p-4 flex items-center justify-between hover:bg-gray-50\">\n                  <div className=\"flex items-center gap-4 flex-1\">\n                    <div className=\"flex-1\">\n                      <div className=\"font-medium text-gray-900\">{page.title}</div>\n                      <code className=\"text-sm bg-gray-100 px-2 py-1 rounded\">/{page.slug}</code>\n                    </div>\n                    <div>\n                      <StatusBadge \n                        status={page.status === 'published' ? 'page-published' : 'page-draft'} \n                      />\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"secondary\"\n                      onClick={() => window.location.href = `/${page.slug}`}\n                      aria-label={`View ${page.title} as guest`}\n                    >\n                      View\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"secondary\"\n                      onClick={() => handleEdit(page)}\n                      aria-label={`Edit ${page.title}`}\n                    >\n                      Edit\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"secondary\"\n                      onClick={() => handleToggleSections(page.id)}\n                      aria-label={`${expandedPageId === page.id ? 'Hide' : 'Show'} sections for ${page.title}`}\n                    >\n                      {expandedPageId === page.id ? '▼ Hide Sections' : '▶ Sections'}\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"danger\"\n                      onClick={() => setDeleteConfirmPage(page)}\n                      aria-label={`Delete ${page.title}`}\n                    >\n                      Delete\n                    </Button>\n                  </div>\n                </div>\n\n                {/* Sections editor - appears inline below the page row */}\n                {expandedPageId === page.id && (\n                  <div className=\"border-t border-gray-200 bg-gray-50 p-6\">\n                    <SectionEditor\n                      pageType=\"custom\"\n                      pageId={page.id}\n                    />\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n            <p className=\"text-gray-500 mb-4\">No content pages yet</p>\n            <Button onClick={() => setIsFormOpen(true)} variant=\"primary\" size=\"sm\">\n              Create First Page\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {deleteConfirmPage && (\n        <ConfirmDialog\n          isOpen={true}\n          title=\"Delete Content Page\"\n          message={`Are you sure you want to delete \"${deleteConfirmPage.title}\"? This will also delete all associated sections and cannot be undone.`}\n          confirmLabel=\"Delete\"\n          cancelLabel=\"Cancel\"\n          onConfirm={handleDelete}\n          onClose={() => setDeleteConfirmPage(null)}\n          variant=\"danger\"\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["ContentPagesPage","ContentPageForm","dynamic","then","mod","default","loading","div","className","ssr","data","pages","error","refetch","create","update","remove","useContentPages","showToast","useToast","isFormOpen","setIsFormOpen","useState","editingPage","setEditingPage","expandedPageId","setExpandedPageId","deleteConfirmPage","setDeleteConfirmPage","handleCreate","useCallback","result","success","type","message","handleUpdate","id","handleDelete","handleEdit","page","handleCancel","handleToggleSections","pageId","prev","columns","key","label","sortable","render","value","code","statusMap","published","draft","StatusBadge","status","_","Button","size","variant","onClick","window","location","href","slug","aria-label","title","p","h1","onSubmit","onCancel","initialData","undefined","isOpen","onToggle","submitLabel","length","map","SectionEditor","pageType","ConfirmDialog","confirmLabel","cancelLabel","onConfirm","onClose"],"mappings":"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"}