247ed2fe633b8db09bfe0a7bba4441da
/**
 * Unit Tests: PUT /api/admin/guests/[id]/auth-method
 * 
 * Tests the API route for updating a single guest's auth method
 * 
 * Requirements: 22.3
 */ "use strict";
// Mock Supabase
jest.mock('@/lib/supabaseServer');
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _route = require("./route");
const _supabaseServer = require("../../../../../../lib/supabaseServer");
describe('PUT /api/admin/guests/[id]/auth-method', ()=>{
    const mockSupabase = {
        auth: {
            getSession: jest.fn()
        },
        from: jest.fn()
    };
    beforeEach(()=>{
        jest.clearAllMocks();
        _supabaseServer.createAuthenticatedClient.mockResolvedValue(mockSupabase);
    });
    it('should update guest auth method successfully', async ()=>{
        // Mock authenticated session
        mockSupabase.auth.getSession.mockResolvedValue({
            data: {
                session: {
                    user: {
                        id: 'admin-123'
                    }
                }
            },
            error: null
        });
        // Mock successful update
        const mockUpdate = jest.fn().mockReturnValue({
            eq: jest.fn().mockReturnValue({
                select: jest.fn().mockReturnValue({
                    single: jest.fn().mockResolvedValue({
                        data: {
                            id: 'guest-123',
                            auth_method: 'magic_link',
                            email: 'test@example.com',
                            first_name: 'Test',
                            last_name: 'User'
                        },
                        error: null
                    })
                })
            })
        });
        mockSupabase.from.mockReturnValue({
            update: mockUpdate
        });
        const request = new Request('http://localhost:3000/api/admin/guests/guest-123/auth-method', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                auth_method: 'magic_link'
            })
        });
        const response = await (0, _route.PUT)(request, {
            params: {
                id: 'guest-123'
            }
        });
        const result = await response.json();
        expect(response.status).toBe(200);
        expect(result.success).toBe(true);
        expect(result.data.auth_method).toBe('magic_link');
    });
    it('should return 400 for invalid guest ID format', async ()=>{
        mockSupabase.auth.getSession.mockResolvedValue({
            data: {
                session: {
                    user: {
                        id: 'admin-123'
                    }
                }
            },
            error: null
        });
        const request = new Request('http://localhost:3000/api/admin/guests/invalid-id/auth-method', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                auth_method: 'magic_link'
            })
        });
        const response = await (0, _route.PUT)(request, {
            params: {
                id: 'invalid-id'
            }
        });
        const result = await response.json();
        expect(response.status).toBe(400);
        expect(result.success).toBe(false);
        expect(result.error.code).toBe('VALIDATION_ERROR');
    });
    it('should return 400 for invalid auth method', async ()=>{
        mockSupabase.auth.getSession.mockResolvedValue({
            data: {
                session: {
                    user: {
                        id: 'admin-123'
                    }
                }
            },
            error: null
        });
        const request = new Request('http://localhost:3000/api/admin/guests/00000000-0000-0000-0000-000000000000/auth-method', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                auth_method: 'invalid_method'
            })
        });
        const response = await (0, _route.PUT)(request, {
            params: {
                id: '00000000-0000-0000-0000-000000000000'
            }
        });
        const result = await response.json();
        expect(response.status).toBe(400);
        expect(result.success).toBe(false);
        expect(result.error.code).toBe('VALIDATION_ERROR');
    });
    it('should return 404 for non-existent guest', async ()=>{
        mockSupabase.auth.getSession.mockResolvedValue({
            data: {
                session: {
                    user: {
                        id: 'admin-123'
                    }
                }
            },
            error: null
        });
        const mockUpdate = jest.fn().mockReturnValue({
            eq: jest.fn().mockReturnValue({
                select: jest.fn().mockReturnValue({
                    single: jest.fn().mockResolvedValue({
                        data: null,
                        error: {
                            code: 'PGRST116',
                            message: 'Not found'
                        }
                    })
                })
            })
        });
        mockSupabase.from.mockReturnValue({
            update: mockUpdate
        });
        const request = new Request('http://localhost:3000/api/admin/guests/00000000-0000-0000-0000-000000000000/auth-method', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                auth_method: 'magic_link'
            })
        });
        const response = await (0, _route.PUT)(request, {
            params: {
                id: '00000000-0000-0000-0000-000000000000'
            }
        });
        const result = await response.json();
        expect(response.status).toBe(404);
        expect(result.success).toBe(false);
        expect(result.error.code).toBe('GUEST_NOT_FOUND');
    });
    it('should return 401 when not authenticated', async ()=>{
        mockSupabase.auth.getSession.mockResolvedValue({
            data: {
                session: null
            },
            error: null
        });
        const request = new Request('http://localhost:3000/api/admin/guests/guest-123/auth-method', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                auth_method: 'magic_link'
            })
        });
        const response = await (0, _route.PUT)(request, {
            params: {
                id: 'guest-123'
            }
        });
        const result = await response.json();
        expect(response.status).toBe(401);
        expect(result.success).toBe(false);
        expect(result.error.code).toBe('UNAUTHORIZED');
    });
    it('should return 500 for database errors', async ()=>{
        mockSupabase.auth.getSession.mockResolvedValue({
            data: {
                session: {
                    user: {
                        id: 'admin-123'
                    }
                }
            },
            error: null
        });
        const mockUpdate = jest.fn().mockReturnValue({
            eq: jest.fn().mockReturnValue({
                select: jest.fn().mockReturnValue({
                    single: jest.fn().mockResolvedValue({
                        data: null,
                        error: {
                            code: 'DATABASE_ERROR',
                            message: 'Database connection failed'
                        }
                    })
                })
            })
        });
        mockSupabase.from.mockReturnValue({
            update: mockUpdate
        });
        const request = new Request('http://localhost:3000/api/admin/guests/guest-123/auth-method', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                auth_method: 'magic_link'
            })
        });
        const response = await (0, _route.PUT)(request, {
            params: {
                id: 'guest-123'
            }
        });
        const result = await response.json();
        expect(response.status).toBe(500);
        expect(result.success).toBe(false);
        expect(result.error.code).toBe('DATABASE_ERROR');
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9ndWVzdHMvW2lkXS9hdXRoLW1ldGhvZC9yb3V0ZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCBUZXN0czogUFVUIC9hcGkvYWRtaW4vZ3Vlc3RzL1tpZF0vYXV0aC1tZXRob2RcbiAqIFxuICogVGVzdHMgdGhlIEFQSSByb3V0ZSBmb3IgdXBkYXRpbmcgYSBzaW5nbGUgZ3Vlc3QncyBhdXRoIG1ldGhvZFxuICogXG4gKiBSZXF1aXJlbWVudHM6IDIyLjNcbiAqL1xuXG5pbXBvcnQgeyBQVVQgfSBmcm9tICcuL3JvdXRlJztcbmltcG9ydCB7IGNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZVNlcnZlcic7XG5cbi8vIE1vY2sgU3VwYWJhc2Vcbmplc3QubW9jaygnQC9saWIvc3VwYWJhc2VTZXJ2ZXInKTtcblxuZGVzY3JpYmUoJ1BVVCAvYXBpL2FkbWluL2d1ZXN0cy9baWRdL2F1dGgtbWV0aG9kJywgKCkgPT4ge1xuICBjb25zdCBtb2NrU3VwYWJhc2UgPSB7XG4gICAgYXV0aDoge1xuICAgICAgZ2V0U2Vzc2lvbjogamVzdC5mbigpLFxuICAgIH0sXG4gICAgZnJvbTogamVzdC5mbigpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIChjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N1cGFiYXNlKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB1cGRhdGUgZ3Vlc3QgYXV0aCBtZXRob2Qgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIE1vY2sgYXV0aGVudGljYXRlZCBzZXNzaW9uXG4gICAgbW9ja1N1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbi5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBkYXRhOiB7IHNlc3Npb246IHsgdXNlcjogeyBpZDogJ2FkbWluLTEyMycgfSB9IH0sXG4gICAgICBlcnJvcjogbnVsbCxcbiAgICB9KTtcblxuICAgIC8vIE1vY2sgc3VjY2Vzc2Z1bCB1cGRhdGVcbiAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBpZDogJ2d1ZXN0LTEyMycsXG4gICAgICAgICAgICAgIGF1dGhfbWV0aG9kOiAnbWFnaWNfbGluaycsXG4gICAgICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgICAgICAgIGZpcnN0X25hbWU6ICdUZXN0JyxcbiAgICAgICAgICAgICAgbGFzdF9uYW1lOiAnVXNlcicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICBtb2NrU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgdXBkYXRlOiBtb2NrVXBkYXRlLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2FkbWluL2d1ZXN0cy9ndWVzdC0xMjMvYXV0aC1tZXRob2QnLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF1dGhfbWV0aG9kOiAnbWFnaWNfbGluaycgfSksXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFBVVChyZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogJ2d1ZXN0LTEyMycgfSB9KTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChyZXN1bHQuZGF0YS5hdXRoX21ldGhvZCkudG9CZSgnbWFnaWNfbGluaycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiA0MDAgZm9yIGludmFsaWQgZ3Vlc3QgSUQgZm9ybWF0JywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tTdXBhYmFzZS5hdXRoLmdldFNlc3Npb24ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgZGF0YTogeyBzZXNzaW9uOiB7IHVzZXI6IHsgaWQ6ICdhZG1pbi0xMjMnIH0gfSB9LFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvYWRtaW4vZ3Vlc3RzL2ludmFsaWQtaWQvYXV0aC1tZXRob2QnLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF1dGhfbWV0aG9kOiAnbWFnaWNfbGluaycgfSksXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFBVVChyZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogJ2ludmFsaWQtaWQnIH0gfSk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDApO1xuICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgZXhwZWN0KHJlc3VsdC5lcnJvci5jb2RlKS50b0JlKCdWQUxJREFUSU9OX0VSUk9SJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmV0dXJuIDQwMCBmb3IgaW52YWxpZCBhdXRoIG1ldGhvZCcsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrU3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIGRhdGE6IHsgc2Vzc2lvbjogeyB1c2VyOiB7IGlkOiAnYWRtaW4tMTIzJyB9IH0gfSxcbiAgICAgIGVycm9yOiBudWxsLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2FkbWluL2d1ZXN0cy8wMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAvYXV0aC1tZXRob2QnLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF1dGhfbWV0aG9kOiAnaW52YWxpZF9tZXRob2QnIH0pLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQVVQocmVxdWVzdCwgeyBwYXJhbXM6IHsgaWQ6ICcwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAnIH0gfSk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDApO1xuICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgZXhwZWN0KHJlc3VsdC5lcnJvci5jb2RlKS50b0JlKCdWQUxJREFUSU9OX0VSUk9SJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmV0dXJuIDQwNCBmb3Igbm9uLWV4aXN0ZW50IGd1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tTdXBhYmFzZS5hdXRoLmdldFNlc3Npb24ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgZGF0YTogeyBzZXNzaW9uOiB7IHVzZXI6IHsgaWQ6ICdhZG1pbi0xMjMnIH0gfSB9LFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgfSk7XG5cbiAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICAgIGVycm9yOiB7IGNvZGU6ICdQR1JTVDExNicsIG1lc3NhZ2U6ICdOb3QgZm91bmQnIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICBtb2NrU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgdXBkYXRlOiBtb2NrVXBkYXRlLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2FkbWluL2d1ZXN0cy8wMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAvYXV0aC1tZXRob2QnLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF1dGhfbWV0aG9kOiAnbWFnaWNfbGluaycgfSksXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFBVVChyZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogJzAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCcgfSB9KTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwNCk7XG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICBleHBlY3QocmVzdWx0LmVycm9yLmNvZGUpLnRvQmUoJ0dVRVNUX05PVF9GT1VORCcpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiA0MDEgd2hlbiBub3QgYXV0aGVudGljYXRlZCcsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrU3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIGRhdGE6IHsgc2Vzc2lvbjogbnVsbCB9LFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvYWRtaW4vZ3Vlc3RzL2d1ZXN0LTEyMy9hdXRoLW1ldGhvZCcsIHtcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXV0aF9tZXRob2Q6ICdtYWdpY19saW5rJyB9KSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUFVUKHJlcXVlc3QsIHsgcGFyYW1zOiB7IGlkOiAnZ3Vlc3QtMTIzJyB9IH0pO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAxKTtcbiAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgIGV4cGVjdChyZXN1bHQuZXJyb3IuY29kZSkudG9CZSgnVU5BVVRIT1JJWkVEJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmV0dXJuIDUwMCBmb3IgZGF0YWJhc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tTdXBhYmFzZS5hdXRoLmdldFNlc3Npb24ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgZGF0YTogeyBzZXNzaW9uOiB7IHVzZXI6IHsgaWQ6ICdhZG1pbi0xMjMnIH0gfSB9LFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgfSk7XG5cbiAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICAgIGVycm9yOiB7IGNvZGU6ICdEQVRBQkFTRV9FUlJPUicsIG1lc3NhZ2U6ICdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIG1vY2tTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICB1cGRhdGU6IG1vY2tVcGRhdGUsXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvYWRtaW4vZ3Vlc3RzL2d1ZXN0LTEyMy9hdXRoLW1ldGhvZCcsIHtcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXV0aF9tZXRob2Q6ICdtYWdpY19saW5rJyB9KSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUFVUKHJlcXVlc3QsIHsgcGFyYW1zOiB7IGlkOiAnZ3Vlc3QtMTIzJyB9IH0pO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNTAwKTtcbiAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgIGV4cGVjdChyZXN1bHQuZXJyb3IuY29kZSkudG9CZSgnREFUQUJBU0VfRVJST1InKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImRlc2NyaWJlIiwibW9ja1N1cGFiYXNlIiwiYXV0aCIsImdldFNlc3Npb24iLCJmbiIsImZyb20iLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsImNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsIml0IiwiZGF0YSIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJlcnJvciIsIm1vY2tVcGRhdGUiLCJtb2NrUmV0dXJuVmFsdWUiLCJlcSIsInNlbGVjdCIsInNpbmdsZSIsImF1dGhfbWV0aG9kIiwiZW1haWwiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwidXBkYXRlIiwicmVxdWVzdCIsIlJlcXVlc3QiLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXNwb25zZSIsIlBVVCIsInBhcmFtcyIsInJlc3VsdCIsImpzb24iLCJleHBlY3QiLCJzdGF0dXMiLCJ0b0JlIiwic3VjY2VzcyIsImNvZGUiLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0NBTUM7QUFLRCxnQkFBZ0I7QUFDaEJBLEtBQUtDLElBQUksQ0FBQzs7Ozt1QkFKVTtnQ0FDc0I7QUFLMUNDLFNB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