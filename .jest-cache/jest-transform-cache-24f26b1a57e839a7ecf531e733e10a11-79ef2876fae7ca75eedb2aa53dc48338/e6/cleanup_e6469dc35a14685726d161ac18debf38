e910efe8529b1d582808101cc7ee9c4b
/**
 * Test Cleanup Utilities
 * 
 * Utilities for cleaning up test data after tests run.
 * Ensures test isolation and prevents data leakage between tests.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get CleanupTracker () {
        return CleanupTracker;
    },
    get cleanupAllTestData () {
        return cleanupAllTestData;
    },
    get cleanupById () {
        return cleanupById;
    },
    get cleanupByIds () {
        return cleanupByIds;
    },
    get cleanupTestAccommodations () {
        return cleanupTestAccommodations;
    },
    get cleanupTestActivities () {
        return cleanupTestActivities;
    },
    get cleanupTestContentPages () {
        return cleanupTestContentPages;
    },
    get cleanupTestEvents () {
        return cleanupTestEvents;
    },
    get cleanupTestGuestGroups () {
        return cleanupTestGuestGroups;
    },
    get cleanupTestGuests () {
        return cleanupTestGuests;
    },
    get cleanupTestLocations () {
        return cleanupTestLocations;
    },
    get cleanupTestRSVPs () {
        return cleanupTestRSVPs;
    },
    get cleanupTestRoomTypes () {
        return cleanupTestRoomTypes;
    },
    get cleanupTestSections () {
        return cleanupTestSections;
    },
    get createCleanupTracker () {
        return createCleanupTracker;
    },
    get withCleanup () {
        return withCleanup;
    }
});
const _supabasejs = require("@supabase/supabase-js");
/**
 * Get Supabase client for test cleanup
 * Uses service role key to bypass RLS for cleanup operations
 */ function getCleanupClient() {
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
    if (!supabaseUrl || !supabaseServiceKey) {
        throw new Error('Missing Supabase credentials for test cleanup');
    }
    return (0, _supabasejs.createClient)(supabaseUrl, supabaseServiceKey, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        }
    });
}
async function cleanupTestGuests(emailPattern = 'test.user%@example.com') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('guests').delete().like('email', emailPattern);
    if (error) {
        console.error('Failed to cleanup test guests:', error);
    }
}
async function cleanupTestGuestGroups(namePattern = 'Test Family%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('guest_groups').delete().like('name', namePattern);
    if (error) {
        console.error('Failed to cleanup test guest groups:', error);
    }
}
async function cleanupTestEvents(namePattern = 'Test Event%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('events').delete().like('name', namePattern);
    if (error) {
        console.error('Failed to cleanup test events:', error);
    }
}
async function cleanupTestActivities(namePattern = 'Test Activity%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('activities').delete().like('name', namePattern);
    if (error) {
        console.error('Failed to cleanup test activities:', error);
    }
}
async function cleanupTestAccommodations(namePattern = 'Test Hotel%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('accommodations').delete().like('name', namePattern);
    if (error) {
        console.error('Failed to cleanup test accommodations:', error);
    }
}
async function cleanupTestRoomTypes(namePattern = 'Test Room%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('room_types').delete().like('name', namePattern);
    if (error) {
        console.error('Failed to cleanup test room types:', error);
    }
}
async function cleanupTestLocations(namePattern = 'Test Location%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('locations').delete().like('name', namePattern);
    if (error) {
        console.error('Failed to cleanup test locations:', error);
    }
}
async function cleanupTestSections(entityIdPattern = 'test-entity%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('sections').delete().like('entity_id', entityIdPattern);
    if (error) {
        console.error('Failed to cleanup test sections:', error);
    }
}
async function cleanupTestContentPages(slugPattern = 'test-page%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('content_pages').delete().like('slug', slugPattern);
    if (error) {
        console.error('Failed to cleanup test content pages:', error);
    }
}
async function cleanupTestRSVPs(guestIdPattern = 'test-guest%') {
    const supabase = getCleanupClient();
    const { error } = await supabase.from('rsvps').delete().like('guest_id', guestIdPattern);
    if (error) {
        console.error('Failed to cleanup test RSVPs:', error);
    }
}
async function cleanupById(table, id) {
    const supabase = getCleanupClient();
    const { error } = await supabase.from(table).delete().eq('id', id);
    if (error) {
        console.error(`Failed to cleanup ${table} with id ${id}:`, error);
    }
}
async function cleanupByIds(table, ids) {
    if (ids.length === 0) return;
    const supabase = getCleanupClient();
    const { error } = await supabase.from(table).delete().in('id', ids);
    if (error) {
        console.error(`Failed to cleanup ${table} with ids:`, error);
    }
}
async function cleanupAllTestData() {
    console.log('ðŸ§¹ Cleaning up all test data...');
    // Clean up in order to respect foreign key constraints
    await cleanupTestRSVPs();
    await cleanupTestGuests();
    await cleanupTestGuestGroups();
    await cleanupTestActivities();
    await cleanupTestEvents();
    await cleanupTestRoomTypes();
    await cleanupTestAccommodations();
    await cleanupTestLocations();
    await cleanupTestSections();
    await cleanupTestContentPages();
    console.log('âœ… Test data cleanup complete');
}
class CleanupTracker {
    /**
   * Track an entity for cleanup
   */ track(table, id) {
        const ids = this.entities.get(table) || [];
        ids.push(id);
        this.entities.set(table, ids);
    }
    /**
   * Track multiple entities for cleanup
   */ trackMany(table, ids) {
        const existing = this.entities.get(table) || [];
        this.entities.set(table, [
            ...existing,
            ...ids
        ]);
    }
    /**
   * Clean up all tracked entities
   */ async cleanup() {
        // Clean up in reverse order of tracking (LIFO)
        const tables = Array.from(this.entities.keys()).reverse();
        for (const table of tables){
            const ids = this.entities.get(table) || [];
            if (ids.length > 0) {
                await cleanupByIds(table, ids);
            }
        }
        this.entities.clear();
    }
    /**
   * Get all tracked entities
   */ getTracked() {
        return new Map(this.entities);
    }
    /**
   * Clear tracking without cleanup
   */ clear() {
        this.entities.clear();
    }
    constructor(){
        this.entities = new Map();
    }
}
function createCleanupTracker() {
    return new CleanupTracker();
}
async function withCleanup(fn) {
    const tracker = createCleanupTracker();
    try {
        return await fn(tracker);
    } finally{
        await tracker.cleanup();
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvX190ZXN0c19fL2hlbHBlcnMvY2xlYW51cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3QgQ2xlYW51cCBVdGlsaXRpZXNcbiAqIFxuICogVXRpbGl0aWVzIGZvciBjbGVhbmluZyB1cCB0ZXN0IGRhdGEgYWZ0ZXIgdGVzdHMgcnVuLlxuICogRW5zdXJlcyB0ZXN0IGlzb2xhdGlvbiBhbmQgcHJldmVudHMgZGF0YSBsZWFrYWdlIGJldHdlZW4gdGVzdHMuXG4gKi9cblxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuLyoqXG4gKiBHZXQgU3VwYWJhc2UgY2xpZW50IGZvciB0ZXN0IGNsZWFudXBcbiAqIFVzZXMgc2VydmljZSByb2xlIGtleSB0byBieXBhc3MgUkxTIGZvciBjbGVhbnVwIG9wZXJhdGlvbnNcbiAqL1xuZnVuY3Rpb24gZ2V0Q2xlYW51cENsaWVudCgpIHtcbiAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gIGNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XG4gIFxuICBpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU3VwYWJhc2UgY3JlZGVudGlhbHMgZm9yIHRlc3QgY2xlYW51cCcpO1xuICB9XG4gIFxuICByZXR1cm4gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXksIHtcbiAgICBhdXRoOiB7XG4gICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZSxcbiAgICB9LFxuICB9KTtcbn1cblxuLyoqXG4gKiBDbGVhbiB1cCB0ZXN0IGd1ZXN0cyBieSBlbWFpbCBwYXR0ZXJuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwVGVzdEd1ZXN0cyhlbWFpbFBhdHRlcm4gPSAndGVzdC51c2VyJUBleGFtcGxlLmNvbScpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRDbGVhbnVwQ2xpZW50KCk7XG4gIFxuICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdndWVzdHMnKVxuICAgIC5kZWxldGUoKVxuICAgIC5saWtlKCdlbWFpbCcsIGVtYWlsUGF0dGVybik7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB0ZXN0IGd1ZXN0czonLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhbiB1cCB0ZXN0IGd1ZXN0IGdyb3VwcyBieSBuYW1lIHBhdHRlcm5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBUZXN0R3Vlc3RHcm91cHMobmFtZVBhdHRlcm4gPSAnVGVzdCBGYW1pbHklJyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGdldENsZWFudXBDbGllbnQoKTtcbiAgXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ2d1ZXN0X2dyb3VwcycpXG4gICAgLmRlbGV0ZSgpXG4gICAgLmxpa2UoJ25hbWUnLCBuYW1lUGF0dGVybik7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB0ZXN0IGd1ZXN0IGdyb3VwczonLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhbiB1cCB0ZXN0IGV2ZW50cyBieSBuYW1lIHBhdHRlcm5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBUZXN0RXZlbnRzKG5hbWVQYXR0ZXJuID0gJ1Rlc3QgRXZlbnQlJyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGdldENsZWFudXBDbGllbnQoKTtcbiAgXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ2V2ZW50cycpXG4gICAgLmRlbGV0ZSgpXG4gICAgLmxpa2UoJ25hbWUnLCBuYW1lUGF0dGVybik7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB0ZXN0IGV2ZW50czonLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhbiB1cCB0ZXN0IGFjdGl2aXRpZXMgYnkgbmFtZSBwYXR0ZXJuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwVGVzdEFjdGl2aXRpZXMobmFtZVBhdHRlcm4gPSAnVGVzdCBBY3Rpdml0eSUnKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0Q2xlYW51cENsaWVudCgpO1xuICBcbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnYWN0aXZpdGllcycpXG4gICAgLmRlbGV0ZSgpXG4gICAgLmxpa2UoJ25hbWUnLCBuYW1lUGF0dGVybik7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB0ZXN0IGFjdGl2aXRpZXM6JywgZXJyb3IpO1xuICB9XG59XG5cbi8qKlxuICogQ2xlYW4gdXAgdGVzdCBhY2NvbW1vZGF0aW9ucyBieSBuYW1lIHBhdHRlcm5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBUZXN0QWNjb21tb2RhdGlvbnMobmFtZVBhdHRlcm4gPSAnVGVzdCBIb3RlbCUnKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0Q2xlYW51cENsaWVudCgpO1xuICBcbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnYWNjb21tb2RhdGlvbnMnKVxuICAgIC5kZWxldGUoKVxuICAgIC5saWtlKCduYW1lJywgbmFtZVBhdHRlcm4pO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNsZWFudXAgdGVzdCBhY2NvbW1vZGF0aW9uczonLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhbiB1cCB0ZXN0IHJvb20gdHlwZXMgYnkgbmFtZSBwYXR0ZXJuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwVGVzdFJvb21UeXBlcyhuYW1lUGF0dGVybiA9ICdUZXN0IFJvb20lJyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGdldENsZWFudXBDbGllbnQoKTtcbiAgXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3Jvb21fdHlwZXMnKVxuICAgIC5kZWxldGUoKVxuICAgIC5saWtlKCduYW1lJywgbmFtZVBhdHRlcm4pO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNsZWFudXAgdGVzdCByb29tIHR5cGVzOicsIGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFuIHVwIHRlc3QgbG9jYXRpb25zIGJ5IG5hbWUgcGF0dGVyblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW51cFRlc3RMb2NhdGlvbnMobmFtZVBhdHRlcm4gPSAnVGVzdCBMb2NhdGlvbiUnKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0Q2xlYW51cENsaWVudCgpO1xuICBcbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnbG9jYXRpb25zJylcbiAgICAuZGVsZXRlKClcbiAgICAubGlrZSgnbmFtZScsIG5hbWVQYXR0ZXJuKTtcbiAgXG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjbGVhbnVwIHRlc3QgbG9jYXRpb25zOicsIGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFuIHVwIHRlc3Qgc2VjdGlvbnMgYnkgZW50aXR5IElEIHBhdHRlcm5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBUZXN0U2VjdGlvbnMoZW50aXR5SWRQYXR0ZXJuID0gJ3Rlc3QtZW50aXR5JScpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRDbGVhbnVwQ2xpZW50KCk7XG4gIFxuICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdzZWN0aW9ucycpXG4gICAgLmRlbGV0ZSgpXG4gICAgLmxpa2UoJ2VudGl0eV9pZCcsIGVudGl0eUlkUGF0dGVybik7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB0ZXN0IHNlY3Rpb25zOicsIGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFuIHVwIHRlc3QgY29udGVudCBwYWdlcyBieSBzbHVnIHBhdHRlcm5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBUZXN0Q29udGVudFBhZ2VzKHNsdWdQYXR0ZXJuID0gJ3Rlc3QtcGFnZSUnKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0Q2xlYW51cENsaWVudCgpO1xuICBcbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnY29udGVudF9wYWdlcycpXG4gICAgLmRlbGV0ZSgpXG4gICAgLmxpa2UoJ3NsdWcnLCBzbHVnUGF0dGVybik7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB0ZXN0IGNvbnRlbnQgcGFnZXM6JywgZXJyb3IpO1xuICB9XG59XG5cbi8qKlxuICogQ2xlYW4gdXAgdGVzdCBSU1ZQcyBieSBndWVzdCBJRCBwYXR0ZXJuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwVGVzdFJTVlBzKGd1ZXN0SWRQYXR0ZXJuID0gJ3Rlc3QtZ3Vlc3QlJyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGdldENsZWFudXBDbGllbnQoKTtcbiAgXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3JzdnBzJylcbiAgICAuZGVsZXRlKClcbiAgICAubGlrZSgnZ3Vlc3RfaWQnLCBndWVzdElkUGF0dGVybik7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB0ZXN0IFJTVlBzOicsIGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFuIHVwIGEgc3BlY2lmaWMgZW50aXR5IGJ5IElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwQnlJZCh0YWJsZTogc3RyaW5nLCBpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0Q2xlYW51cENsaWVudCgpO1xuICBcbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSh0YWJsZSlcbiAgICAuZGVsZXRlKClcbiAgICAuZXEoJ2lkJywgaWQpO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNsZWFudXAgJHt0YWJsZX0gd2l0aCBpZCAke2lkfTpgLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhbiB1cCBtdWx0aXBsZSBlbnRpdGllcyBieSBJRHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBCeUlkcyh0YWJsZTogc3RyaW5nLCBpZHM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmIChpZHMubGVuZ3RoID09PSAwKSByZXR1cm47XG4gIFxuICBjb25zdCBzdXBhYmFzZSA9IGdldENsZWFudXBDbGllbnQoKTtcbiAgXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20odGFibGUpXG4gICAgLmRlbGV0ZSgpXG4gICAgLmluKCdpZCcsIGlkcyk7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gY2xlYW51cCAke3RhYmxlfSB3aXRoIGlkczpgLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhbiB1cCBhbGwgdGVzdCBkYXRhICh1c2Ugd2l0aCBjYXV0aW9uISlcbiAqIFRoaXMgcnVucyBhbGwgY2xlYW51cCBmdW5jdGlvbnMgaW4gdGhlIGNvcnJlY3Qgb3JkZXIgdG8gaGFuZGxlIGZvcmVpZ24ga2V5IGNvbnN0cmFpbnRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwQWxsVGVzdERhdGEoKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnNvbGUubG9nKCfwn6e5IENsZWFuaW5nIHVwIGFsbCB0ZXN0IGRhdGEuLi4nKTtcbiAgXG4gIC8vIENsZWFuIHVwIGluIG9yZGVyIHRvIHJlc3BlY3QgZm9yZWlnbiBrZXkgY29uc3RyYWludHNcbiAgYXdhaXQgY2xlYW51cFRlc3RSU1ZQcygpO1xuICBhd2FpdCBjbGVhbnVwVGVzdEd1ZXN0cygpO1xuICBhd2FpdCBjbGVhbnVwVGVzdEd1ZXN0R3JvdXBzKCk7XG4gIGF3YWl0IGNsZWFudXBUZXN0QWN0aXZpdGllcygpO1xuICBhd2FpdCBjbGVhbnVwVGVzdEV2ZW50cygpO1xuICBhd2FpdCBjbGVhbnVwVGVzdFJvb21UeXBlcygpO1xuICBhd2FpdCBjbGVhbnVwVGVzdEFjY29tbW9kYXRpb25zKCk7XG4gIGF3YWl0IGNsZWFudXBUZXN0TG9jYXRpb25zKCk7XG4gIGF3YWl0IGNsZWFudXBUZXN0U2VjdGlvbnMoKTtcbiAgYXdhaXQgY2xlYW51cFRlc3RDb250ZW50UGFnZXMoKTtcbiAgXG4gIGNvbnNvbGUubG9nKCfinIUgVGVzdCBkYXRhIGNsZWFudXAgY29tcGxldGUnKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBjbGVhbnVwIHRyYWNrZXIgZm9yIHRyYWNraW5nIGNyZWF0ZWQgZW50aXRpZXMgZHVyaW5nIGEgdGVzdFxuICovXG5leHBvcnQgY2xhc3MgQ2xlYW51cFRyYWNrZXIge1xuICBwcml2YXRlIGVudGl0aWVzOiBNYXA8c3RyaW5nLCBzdHJpbmdbXT4gPSBuZXcgTWFwKCk7XG4gIFxuICAvKipcbiAgICogVHJhY2sgYW4gZW50aXR5IGZvciBjbGVhbnVwXG4gICAqL1xuICB0cmFjayh0YWJsZTogc3RyaW5nLCBpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgaWRzID0gdGhpcy5lbnRpdGllcy5nZXQodGFibGUpIHx8IFtdO1xuICAgIGlkcy5wdXNoKGlkKTtcbiAgICB0aGlzLmVudGl0aWVzLnNldCh0YWJsZSwgaWRzKTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIFRyYWNrIG11bHRpcGxlIGVudGl0aWVzIGZvciBjbGVhbnVwXG4gICAqL1xuICB0cmFja01hbnkodGFibGU6IHN0cmluZywgaWRzOiBzdHJpbmdbXSk6IHZvaWQge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5lbnRpdGllcy5nZXQodGFibGUpIHx8IFtdO1xuICAgIHRoaXMuZW50aXRpZXMuc2V0KHRhYmxlLCBbLi4uZXhpc3RpbmcsIC4uLmlkc10pO1xuICB9XG4gIFxuICAvKipcbiAgICogQ2xlYW4gdXAgYWxsIHRyYWNrZWQgZW50aXRpZXNcbiAgICovXG4gIGFzeW5jIGNsZWFudXAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gQ2xlYW4gdXAgaW4gcmV2ZXJzZSBvcmRlciBvZiB0cmFja2luZyAoTElGTylcbiAgICBjb25zdCB0YWJsZXMgPSBBcnJheS5mcm9tKHRoaXMuZW50aXRpZXMua2V5cygpKS5yZXZlcnNlKCk7XG4gICAgXG4gICAgZm9yIChjb25zdCB0YWJsZSBvZiB0YWJsZXMpIHtcbiAgICAgIGNvbnN0IGlkcyA9IHRoaXMuZW50aXRpZXMuZ2V0KHRhYmxlKSB8fCBbXTtcbiAgICAgIGlmIChpZHMubGVuZ3RoID4gMCkge1xuICAgICAgICBhd2FpdCBjbGVhbnVwQnlJZHModGFibGUsIGlkcyk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHRoaXMuZW50aXRpZXMuY2xlYXIoKTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIEdldCBhbGwgdHJhY2tlZCBlbnRpdGllc1xuICAgKi9cbiAgZ2V0VHJhY2tlZCgpOiBNYXA8c3RyaW5nLCBzdHJpbmdbXT4ge1xuICAgIHJldHVybiBuZXcgTWFwKHRoaXMuZW50aXRpZXMpO1xuICB9XG4gIFxuICAvKipcbiAgICogQ2xlYXIgdHJhY2tpbmcgd2l0aG91dCBjbGVhbnVwXG4gICAqL1xuICBjbGVhcigpOiB2b2lkIHtcbiAgICB0aGlzLmVudGl0aWVzLmNsZWFyKCk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBjbGVhbnVwIHRyYWNrZXIgaW5zdGFuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNsZWFudXBUcmFja2VyKCk6IENsZWFudXBUcmFja2VyIHtcbiAgcmV0dXJuIG5ldyBDbGVhbnVwVHJhY2tlcigpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBydW4gYSB0ZXN0IHdpdGggYXV0b21hdGljIGNsZWFudXBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdpdGhDbGVhbnVwPFQ+KFxuICBmbjogKHRyYWNrZXI6IENsZWFudXBUcmFja2VyKSA9PiBQcm9taXNlPFQ+XG4pOiBQcm9taXNlPFQ+IHtcbiAgY29uc3QgdHJhY2tlciA9IGNyZWF0ZUNsZWFudXBUcmFja2VyKCk7XG4gIFxuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCBmbih0cmFja2VyKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCB0cmFja2VyLmNsZWFudXAoKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkNsZWFudXBUcmFja2VyIiwiY2xlYW51cEFsbFRlc3REYXRhIiwiY2xlYW51cEJ5SWQiLCJjbGVhbnVwQnlJZHMiLCJjbGVhbnVwVGVzdEFjY29tbW9kYXRpb25zIiwiY2xlYW51cFRlc3RBY3Rpdml0aWVzIiwiY2xlYW51cFRlc3RDb250ZW50UGFnZXMiLCJjbGVhbnVwVGVzdEV2ZW50cyIsImNsZWFudXBUZXN0R3Vlc3RHcm91cHMiLCJjbGVhbnVwVGVzdEd1ZXN0cyIsImNsZWFudXBUZXN0TG9jYXRpb25zIiwiY2xlYW51cFRlc3RSU1ZQcyIsImNsZWFudXBUZXN0Um9vbVR5cGVzIiwiY2xlYW51cFRlc3RTZWN0aW9ucyIsImNyZWF0ZUNsZWFudXBUcmFja2VyIiwid2l0aENsZWFudXAiLCJnZXRDbGVhbnVwQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwiY3JlYXRlQ2xpZW50IiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsImVtYWlsUGF0dGVybiIsInN1cGFiYXNlIiwiZXJyb3IiLCJmcm9tIiwiZGVsZXRlIiwibGlrZSIsImNvbnNvbGUiLCJuYW1lUGF0dGVybiIsImVudGl0eUlkUGF0dGVybiIsInNsdWdQYXR0ZXJuIiwiZ3Vlc3RJZFBhdHRlcm4iLCJ0YWJsZSIsImlkIiwiZXEiLCJpZHMiLCJsZW5ndGgiLCJpbiIsImxvZyIsInRyYWNrIiwiZW50aXRpZXMiLCJnZXQiLCJwdXNoIiwic2V0IiwidHJhY2tNYW55IiwiZXhpc3RpbmciLCJjbGVhbnVwIiwidGFibGVzIiwiQXJyYXkiLCJrZXlzIiwicmV2ZXJzZSIsImNsZWFyIiwiZ2V0VHJhY2tlZCIsIk1hcCIsImZuIiwidHJhY2tlciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0NBS0M7Ozs7Ozs7Ozs7O1FBbVBZQTtlQUFBQTs7UUFyQlNDO2VBQUFBOztRQW5DQUM7ZUFBQUE7O1FBZ0JBQztlQUFBQTs7UUFo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