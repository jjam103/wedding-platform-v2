f214fd75936738d85c91d6762bdc4703
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "POST", {
    enumerable: true,
    get: function() {
        return POST;
    }
});
const _ssr = require("@supabase/ssr");
const _headers = require("next/headers");
const _server = require("next/server");
const _accommodationService = /*#__PURE__*/ _interop_require_wildcard(require("../../../../services/accommodationService"));
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
async function POST(request) {
    try {
        // 1. Auth check
        const cookieStore = await (0, _headers.cookies)();
        const supabase = (0, _ssr.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY, {
            cookies: {
                getAll () {
                    return cookieStore.getAll();
                },
                setAll (cookiesToSet) {
                    cookiesToSet.forEach(({ name, value })=>{
                        cookieStore.set(name, value);
                    });
                }
            }
        });
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // 2. Parse and validate
        const body = await request.json();
        // 3. Call service
        const result = await _accommodationService.createRoomType(body);
        // 4. Return response with proper status
        if (!result.success) {
            const statusCode = result.error.code === 'VALIDATION_ERROR' ? 400 : 500;
            return _server.NextResponse.json(result, {
                status: statusCode
            });
        }
        return _server.NextResponse.json(result, {
            status: 201
        });
    } catch (error) {
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'INTERNAL_ERROR',
                message: error instanceof Error ? error.message : 'Internal server error'
            }
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9yb29tLXR5cGVzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVNlcnZlckNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zc3InO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgKiBhcyBhY2NvbW1vZGF0aW9uU2VydmljZSBmcm9tICdAL3NlcnZpY2VzL2FjY29tbW9kYXRpb25TZXJ2aWNlJztcbmltcG9ydCB0eXBlIHsgQ3JlYXRlUm9vbVR5cGVEVE8gfSBmcm9tICdAL3NjaGVtYXMvYWNjb21tb2RhdGlvblNjaGVtYXMnO1xuXG4vKipcbiAqIFBPU1QgL2FwaS9hZG1pbi9yb29tLXR5cGVzXG4gKiBDcmVhdGVzIGEgbmV3IHJvb20gdHlwZVxuICogXG4gKiBCb2R5OiBDcmVhdGVSb29tVHlwZURUT1xuICogXG4gKiBSZXF1aXJlbWVudHM6IDIyLjEtMjIuOFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gMS4gQXV0aCBjaGVja1xuICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyQ2xpZW50KFxuICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcbiAgICAgIHtcbiAgICAgICAgY29va2llczoge1xuICAgICAgICAgIGdldEFsbCgpIHtcbiAgICAgICAgICAgIHJldHVybiBjb29raWVTdG9yZS5nZXRBbGwoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldEFsbChjb29raWVzVG9TZXQpIHtcbiAgICAgICAgICAgIGNvb2tpZXNUb1NldC5mb3JFYWNoKCh7IG5hbWUsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICAgICAgY29va2llU3RvcmUuc2V0KG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcbiAgICBcbiAgICBpZiAoYXV0aEVycm9yIHx8ICFzZXNzaW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IGNvZGU6ICdVTkFVVEhPUklaRUQnLCBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0gfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIDIuIFBhcnNlIGFuZCB2YWxpZGF0ZVxuICAgIGNvbnN0IGJvZHk6IENyZWF0ZVJvb21UeXBlRFRPID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICAvLyAzLiBDYWxsIHNlcnZpY2VcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY2NvbW1vZGF0aW9uU2VydmljZS5jcmVhdGVSb29tVHlwZShib2R5KTtcblxuICAgIC8vIDQuIFJldHVybiByZXNwb25zZSB3aXRoIHByb3BlciBzdGF0dXNcbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICBjb25zdCBzdGF0dXNDb2RlID0gcmVzdWx0LmVycm9yLmNvZGUgPT09ICdWQUxJREFUSU9OX0VSUk9SJyA/IDQwMCA6IDUwMDtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXN1bHQsIHsgc3RhdHVzOiBzdGF0dXNDb2RlIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXN1bHQsIHsgc3RhdHVzOiAyMDEgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnSU5URVJOQUxfRVJST1InLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlBPU1QiLCJyZXF1ZXN0IiwiY29va2llU3RvcmUiLCJjb29raWVzIiwic3VwYWJhc2UiLCJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJnZXRBbGwiLCJzZXRBbGwiLCJjb29raWVzVG9TZXQiLCJmb3JFYWNoIiwibmFtZSIsInZhbHVlIiwic2V0IiwiZGF0YSIsInNlc3Npb24iLCJlcnJvciIsImF1dGhFcnJvciIsImF1dGgiLCJnZXRTZXNzaW9uIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsInN1Y2Nlc3MiLCJjb2RlIiwibWVzc2FnZSIsInN0YXR1cyIsImJvZHkiLCJyZXN1bHQiLCJhY2NvbW1vZGF0aW9uU2VydmljZSIsImNyZWF0ZVJvb21UeXBlIiwic3RhdHVzQ29kZSIsIkVycm9yIl0sIm1hcHBpbmdzIjoiOzs7OytCQWNzQkE7OztlQUFBQTs7O3FCQWRhO3lCQUNYO3dCQUNLOzhFQUNTOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFXL0IsZUFBZUEsS0FBS0MsT0FBZ0I7SUFDekMsSUFBSTtRQUNGLGdCQUFnQjtRQUNoQixNQUFNQyxjQUFjLE1BQU1DLElBQUFBLGdCQUFPO1FBQ2pDLE1BQU1DLFdBQVdDLElBQUFBLHVCQUFrQixFQUNqQ0MsUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0IsRUFDcENGLFFBQVFDLEdBQUcsQ0FBQ0UsNkJBQTZCLEVBQ3pDO1lBQ0VOLFNBQVM7Z0JBQ1BPO29CQUNFLE9BQU9SLFlBQVlRLE1BQU07Z0JBQzNCO2dCQUNBQyxRQUFPQyxZQUFZO29CQUNqQkEsYUFBYUMsT0FBTyxDQUFDLENBQUMsRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUU7d0JBQ25DYixZQUFZYyxHQUFHLENBQUNGLE1BQU1DO29CQUN4QjtnQkFDRjtZQUNGO1FBQ0Y7UUFFRixNQUFNLEVBQUVFLE1BQU0sRUFBRUMsT0FBTyxFQUFFLEVBQUVDLE9BQU9DLFNBQVMsRUFBRSxHQUFHLE1BQU1oQixTQUFTaUIsSUFBSSxDQUFDQyxVQUFVO1FBRTlFLElBQUlGLGFBQWEsQ0FBQ0YsU0FBUztZQUN6QixPQUFPSyxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO2dCQUFFQyxTQUFTO2dCQUFPTixPQUFPO29CQUFFTyxNQUFNO29CQUFnQkMsU0FBUztnQkFBMEI7WUFBRSxHQUN0RjtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsd0JBQXdCO1FBQ3hCLE1BQU1DLE9BQTBCLE1BQU01QixRQUFRdUIsSUFBSTtRQUVsRCxrQkFBa0I7UUFDbEIsTUFBTU0sU0FBUyxNQUFNQyxzQkFBcUJDLGNBQWMsQ0FBQ0g7UUFFekQsd0NBQXdDO1FBQ3hDLElBQUksQ0FBQ0MsT0FBT0wsT0FBTyxFQUFFO1lBQ25CLE1BQU1RLGFBQWFILE9BQU9YLEtBQUssQ0FBQ08sSUFBSSxLQUFLLHFCQUFxQixNQUFNO1lBQ3BFLE9BQU9ILG9CQUFZLENBQUNDLElBQUksQ0FBQ00sUUFBUTtnQkFBRUYsUUFBUUs7WUFBVztRQUN4RDtRQUVBLE9BQU9WLG9CQUFZLENBQUNDLElBQUksQ0FBQ00sUUFBUTtZQUFFRixRQUFRO1FBQUk7SUFDakQsRUFBRSxPQUFPVCxPQUFPO1FBQ2QsT0FBT0ksb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtZQUNFQyxTQUFTO1lBQ1ROLE9BQU87Z0JBQ0xPLE1BQU07Z0JBQ05DLFNBQVNSLGlCQUFpQmUsUUFBUWYsTUFBTVEsT0FBTyxHQUFHO1lBQ3BEO1FBQ0YsR0FDQTtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiJ9