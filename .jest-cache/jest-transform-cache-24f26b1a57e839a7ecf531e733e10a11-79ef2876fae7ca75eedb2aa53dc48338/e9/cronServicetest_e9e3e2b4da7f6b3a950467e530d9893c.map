{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/cronService.test.ts"],"sourcesContent":["// Mock Supabase before importing the service\njest.mock('@/lib/supabase', () => ({\n  supabase: {\n    from: jest.fn(),\n  },\n}));\n\nimport {\n  executeCronJob,\n  getJobLogs,\n  getJobStats,\n  isJobRunning,\n} from './cronService';\n\n// Get the mocked supabase client\nconst { supabase } = require('@/lib/supabase');\nconst mockFrom = supabase.from as jest.Mock;\n\ndescribe('cronService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('executeCronJob', () => {\n    it('should return success when job function completes successfully', async () => {\n      const mockJobFunction = jest.fn().mockResolvedValue({\n        itemsProcessed: 10,\n        itemsFailed: 0,\n      });\n\n      // Mock successful job log creation\n      const mockJobLog = {\n        id: 'job-log-123',\n        job_type: 'rsvp_deadline_reminders',\n        status: 'running',\n        started_at: '2024-01-01T10:00:00Z',\n      };\n\n      const mockSingle = jest.fn().mockResolvedValue({ data: mockJobLog, error: null });\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n\n      const mockEq = jest.fn().mockResolvedValue({ data: null, error: null });\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\n\n      mockFrom\n        .mockReturnValueOnce({ insert: mockInsert }) // For startJobLog\n        .mockReturnValueOnce({ update: mockUpdate }); // For completeJobLog\n\n      const result = await executeCronJob('rsvp_deadline_reminders', mockJobFunction);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.jobType).toBe('rsvp_deadline_reminders');\n        expect(result.data.status).toBe('completed');\n        expect(result.data.itemsProcessed).toBe(10);\n        expect(result.data.itemsFailed).toBe(0);\n      }\n      expect(mockJobFunction).toHaveBeenCalled();\n    });\n\n    it('should return success with completed status when job has failures', async () => {\n      const mockJobFunction = jest.fn().mockResolvedValue({\n        itemsProcessed: 8,\n        itemsFailed: 2,\n      });\n\n      const mockJobLog = {\n        id: 'job-log-123',\n        job_type: 'scheduled_email_processing',\n        status: 'running',\n        started_at: '2024-01-01T10:00:00Z',\n      };\n\n      const mockSingle = jest.fn().mockResolvedValue({ data: mockJobLog, error: null });\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n\n      const mockEq = jest.fn().mockResolvedValue({ data: null, error: null });\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\n\n      mockFrom\n        .mockReturnValueOnce({ insert: mockInsert })\n        .mockReturnValueOnce({ update: mockUpdate });\n\n      const result = await executeCronJob('scheduled_email_processing', mockJobFunction);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.status).toBe('completed');\n        expect(result.data.itemsProcessed).toBe(8);\n        expect(result.data.itemsFailed).toBe(2);\n      }\n    });\n\n    it('should return DATABASE_ERROR when job log creation fails', async () => {\n      const mockJobFunction = jest.fn();\n\n      const mockSingle = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n\n      mockFrom.mockReturnValue({ insert: mockInsert });\n\n      const result = await executeCronJob('temp_file_cleanup', mockJobFunction);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n      expect(mockJobFunction).not.toHaveBeenCalled();\n    });\n\n    it('should return CRON_JOB_ERROR when job function throws error', async () => {\n      const mockJobFunction = jest.fn().mockRejectedValue(new Error('Job failed'));\n\n      const mockJobLog = {\n        id: 'job-log-123',\n        job_type: 'expired_session_cleanup',\n        status: 'running',\n        started_at: '2024-01-01T10:00:00Z',\n      };\n\n      const mockSingle = jest.fn().mockResolvedValue({ data: mockJobLog, error: null });\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n\n      const mockEq = jest.fn().mockResolvedValue({ data: null, error: null });\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\n\n      mockFrom\n        .mockReturnValueOnce({ insert: mockInsert })\n        .mockReturnValueOnce({ update: mockUpdate });\n\n      const result = await executeCronJob('expired_session_cleanup', mockJobFunction);\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('CRON_JOB_ERROR');\n        expect(result.error.message).toContain('Job failed');\n      }\n    });\n\n    it('should update job log with failure when job function fails', async () => {\n      const mockJobFunction = jest.fn().mockRejectedValue(new Error('Job failed'));\n\n      const mockJobLog = {\n        id: 'job-log-123',\n        job_type: 'expired_session_cleanup',\n        status: 'running',\n        started_at: '2024-01-01T10:00:00Z',\n      };\n\n      const mockSingle = jest.fn().mockResolvedValue({ data: mockJobLog, error: null });\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\n      const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\n\n      const mockEq = jest.fn().mockResolvedValue({ data: null, error: null });\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\n\n      mockFrom\n        .mockReturnValueOnce({ insert: mockInsert })\n        .mockReturnValueOnce({ update: mockUpdate });\n\n      await executeCronJob('expired_session_cleanup', mockJobFunction);\n\n      // Verify update was called with failure status\n      expect(mockUpdate).toHaveBeenCalledWith({\n        status: 'failed',\n        completed_at: expect.any(String),\n        duration_ms: expect.any(Number),\n        items_processed: 0,\n        items_failed: 0,\n        error_message: 'Job failed',\n      });\n    });\n  });\n\n  describe('getJobLogs', () => {\n    it('should return success with job logs when no filters provided', async () => {\n      const mockLogs = [\n        {\n          id: 'log-1',\n          job_type: 'rsvp_deadline_reminders',\n          status: 'completed',\n          started_at: '2024-01-01T10:00:00Z',\n          completed_at: '2024-01-01T10:05:00Z',\n          duration_ms: 300000,\n          items_processed: 10,\n          items_failed: 0,\n        },\n        {\n          id: 'log-2',\n          job_type: 'temp_file_cleanup',\n          status: 'completed',\n          started_at: '2024-01-01T11:00:00Z',\n          completed_at: '2024-01-01T11:02:00Z',\n          duration_ms: 120000,\n          items_processed: 5,\n          items_failed: 0,\n        },\n      ];\n\n      const mockLimit = jest.fn().mockResolvedValue({ data: mockLogs, error: null });\n      const mockOrder = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockSelect = jest.fn().mockReturnValue({ order: mockOrder });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await getJobLogs();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toEqual(mockLogs);\n      }\n    });\n\n    it.skip('should return success with filtered job logs when job type provided', async () => {\n      const mockLogs = [\n        {\n          id: 'log-1',\n          job_type: 'rsvp_deadline_reminders',\n          status: 'completed',\n          started_at: '2024-01-01T10:00:00Z',\n          completed_at: '2024-01-01T10:05:00Z',\n          duration_ms: 300000,\n          items_processed: 10,\n          items_failed: 0,\n        },\n      ];\n\n      // Mock the query chain: from -> select -> order -> limit -> eq\n      // The final query object is awaited directly with destructuring\n      const mockQuery = {\n        then: jest.fn().mockResolvedValue({ data: mockLogs, error: null }),\n        eq: jest.fn().mockReturnThis(),\n      };\n      \n      const mockLimit = jest.fn().mockReturnValue(mockQuery);\n      const mockOrder = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockSelect = jest.fn().mockReturnValue({ order: mockOrder });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await getJobLogs('rsvp_deadline_reminders', 50);\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toEqual(mockLogs);\n      }\n    });\n\n    it('should return DATABASE_ERROR when query fails', async () => {\n      const mockLimit = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      const mockOrder = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockSelect = jest.fn().mockReturnValue({ order: mockOrder });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await getJobLogs();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n\n    it('should return success with empty array when no data returned', async () => {\n      const mockLimit = jest.fn().mockResolvedValue({ data: null, error: null });\n      const mockOrder = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockSelect = jest.fn().mockReturnValue({ order: mockOrder });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await getJobLogs();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toEqual([]);\n      }\n    });\n  });\n\n  describe('getJobStats', () => {\n    it('should return success with job statistics when logs exist', async () => {\n      const mockLogs = [\n        { status: 'completed', duration_ms: 1000, items_processed: 5, items_failed: 0 },\n        { status: 'completed', duration_ms: 2000, items_processed: 3, items_failed: 1 },\n        { status: 'failed', duration_ms: 500, items_processed: 0, items_failed: 2 },\n      ];\n\n      const mockSelect = jest.fn().mockResolvedValue({ data: mockLogs, error: null });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await getJobStats();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.totalExecutions).toBe(3);\n        expect(result.data.successfulExecutions).toBe(2);\n        expect(result.data.failedExecutions).toBe(1);\n        expect(result.data.averageDurationMs).toBeCloseTo(1166.67, 2); // (1000+2000+500)/3\n        expect(result.data.totalItemsProcessed).toBe(8);\n        expect(result.data.totalItemsFailed).toBe(3);\n      }\n    });\n\n    it('should return success with zero stats when no logs exist', async () => {\n      const mockSelect = jest.fn().mockResolvedValue({ data: [], error: null });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await getJobStats();\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.totalExecutions).toBe(0);\n        expect(result.data.successfulExecutions).toBe(0);\n        expect(result.data.failedExecutions).toBe(0);\n        expect(result.data.averageDurationMs).toBe(0);\n        expect(result.data.totalItemsProcessed).toBe(0);\n        expect(result.data.totalItemsFailed).toBe(0);\n      }\n    });\n\n    it('should apply job type filter when provided', async () => {\n      const mockEq = jest.fn().mockResolvedValue({ data: [], error: null });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      await getJobStats('rsvp_deadline_reminders');\n\n      expect(mockEq).toHaveBeenCalledWith('job_type', 'rsvp_deadline_reminders');\n    });\n\n    it('should apply since filter when provided', async () => {\n      const mockGte = jest.fn().mockResolvedValue({ data: [], error: null });\n      const mockSelect = jest.fn().mockReturnValue({ gte: mockGte });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      await getJobStats(undefined, '2024-01-01T00:00:00Z');\n\n      expect(mockGte).toHaveBeenCalledWith('started_at', '2024-01-01T00:00:00Z');\n    });\n\n    it('should return DATABASE_ERROR when query fails', async () => {\n      const mockSelect = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await getJobStats();\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n  });\n\n  describe('isJobRunning', () => {\n    it('should return success with true when job is running', async () => {\n      const mockLimit = jest.fn().mockResolvedValue({\n        data: [{ id: 'job-1', status: 'running' }],\n        error: null,\n      });\n      const mockEq2 = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockEq1 = jest.fn().mockReturnValue({ eq: mockEq2 });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await isJobRunning('rsvp_deadline_reminders');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe(true);\n      }\n    });\n\n    it('should return success with false when job is not running', async () => {\n      const mockLimit = jest.fn().mockResolvedValue({ data: [], error: null });\n      const mockEq2 = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockEq1 = jest.fn().mockReturnValue({ eq: mockEq2 });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await isJobRunning('scheduled_email_processing');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe(false);\n      }\n    });\n\n    it('should return DATABASE_ERROR when query fails', async () => {\n      const mockLimit = jest.fn().mockResolvedValue({\n        data: null,\n        error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n      });\n      const mockEq2 = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockEq1 = jest.fn().mockReturnValue({ eq: mockEq2 });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await isJobRunning('temp_file_cleanup');\n\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.code).toBe('DATABASE_ERROR');\n      }\n    });\n\n    it('should return success with false when no data returned', async () => {\n      const mockLimit = jest.fn().mockResolvedValue({ data: [], error: null });\n      const mockEq2 = jest.fn().mockReturnValue({ limit: mockLimit });\n      const mockEq1 = jest.fn().mockReturnValue({ eq: mockEq2 });\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });\n\n      mockFrom.mockReturnValue({ select: mockSelect });\n\n      const result = await isJobRunning('temp_file_cleanup');\n\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toBe(false);\n      }\n    });\n  });\n});"],"names":["jest","mock","supabase","from","fn","require","mockFrom","describe","beforeEach","clearAllMocks","it","mockJobFunction","mockResolvedValue","itemsProcessed","itemsFailed","mockJobLog","id","job_type","status","started_at","mockSingle","data","error","mockSelect","mockReturnValue","single","mockInsert","select","mockEq","mockUpdate","eq","mockReturnValueOnce","insert","update","result","executeCronJob","expect","success","toBe","jobType","toHaveBeenCalled","message","code","not","mockRejectedValue","Error","toContain","toHaveBeenCalledWith","completed_at","any","String","duration_ms","Number","items_processed","items_failed","error_message","mockLogs","mockLimit","mockOrder","limit","order","getJobLogs","toEqual","skip","mockQuery","then","mockReturnThis","getJobStats","totalExecutions","successfulExecutions","failedExecutions","averageDurationMs","toBeCloseTo","totalItemsProcessed","totalItemsFailed","mockGte","gte","undefined","mockEq2","mockEq1","isJobRunning"],"mappings":"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"}