{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/activity/[id]/page.test.tsx"],"sourcesContent":["/**\n * Activity Page Route Tests\n * \n * Validates: Requirements 4.2 (E2E Critical Path Testing - section management flow)\n * \n * Tests that the activity route:\n * - Exists and renders without 404\n * - Fetches activity data correctly\n * - Displays sections using SectionRenderer\n * - Handles async params (Next.js 15)\n */\n\nimport { describe, it, expect, jest, beforeEach } from '@jest/globals';\n\n// Mock Next.js modules\njest.mock('next/headers', () => ({\n  cookies: jest.fn(() => ({\n    get: jest.fn(),\n    set: jest.fn(),\n    delete: jest.fn(),\n  })),\n}));\n\njest.mock('next/navigation', () => ({\n  notFound: jest.fn(),\n}));\n\n// Mock Supabase\njest.mock('@supabase/auth-helpers-nextjs', () => ({\n  createServerComponentClient: jest.fn(() => ({\n    from: jest.fn(() => ({\n      select: jest.fn(() => ({\n        eq: jest.fn(() => ({\n          single: jest.fn(() => Promise.resolve({\n            data: {\n              id: 'activity-1',\n              name: 'Beach Volleyball',\n              activity_type: 'activity',\n              start_time: '2025-06-15T10:00:00Z',\n              capacity: 20,\n              description: '<p>Fun beach volleyball game</p>',\n              events: {\n                id: 'event-1',\n                name: 'Welcome Day',\n                start_date: '2025-06-15',\n                end_date: '2025-06-15',\n              },\n              locations: {\n                id: 'location-1',\n                name: 'Beach',\n                location_type: 'venue',\n              },\n            },\n            error: null,\n          })),\n        })),\n      })),\n    })),\n  })),\n}));\n\n// Mock sections service\njest.mock('@/services/sectionsService', () => ({\n  listSections: jest.fn(() => Promise.resolve({\n    success: true,\n    data: [\n      {\n        id: 'section-1',\n        title: 'Activity Details',\n        page_type: 'activity',\n        page_id: 'activity-1',\n        display_order: 1,\n        created_at: '2025-01-01T00:00:00Z',\n        updated_at: '2025-01-01T00:00:00Z',\n        columns: [\n          {\n            id: 'column-1',\n            section_id: 'section-1',\n            column_number: 1,\n            content_type: 'rich_text',\n            content_data: { html: '<p>Test content</p>' },\n            created_at: '2025-01-01T00:00:00Z',\n            updated_at: '2025-01-01T00:00:00Z',\n          },\n        ],\n      },\n    ],\n  })),\n}));\n\n// Mock SectionRenderer component\njest.mock('@/components/guest/SectionRenderer', () => ({\n  SectionRenderer: ({ section }: any) => (\n    <div data-testid={`section-${section.id}`}>\n      {section.title}\n    </div>\n  ),\n}));\n\ndescribe('Activity Page Route', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should exist and be importable', async () => {\n    const ActivityPage = (await import('./page')).default;\n    expect(ActivityPage).toBeDefined();\n    expect(typeof ActivityPage).toBe('function');\n  });\n\n  it('should handle async params (Next.js 15 pattern)', async () => {\n    const ActivityPage = (await import('./page')).default;\n    \n    // Next.js 15: params is a Promise\n    const params = Promise.resolve({ id: 'activity-1' });\n    \n    // Should not throw when awaiting params\n    await expect(ActivityPage({ params })).resolves.toBeDefined();\n  });\n\n  it('should fetch activity data from Supabase', async () => {\n    const { createServerComponentClient } = await import('@supabase/auth-helpers-nextjs');\n    const ActivityPage = (await import('./page')).default;\n    \n    const params = Promise.resolve({ id: 'activity-1' });\n    await ActivityPage({ params });\n    \n    // Verify Supabase client was created\n    expect(createServerComponentClient).toHaveBeenCalled();\n  });\n\n  it('should fetch sections for the activity', async () => {\n    const { listSections } = await import('@/services/sectionsService');\n    const ActivityPage = (await import('./page')).default;\n    \n    const params = Promise.resolve({ id: 'activity-1' });\n    await ActivityPage({ params });\n    \n    // Verify sections were fetched\n    expect(listSections).toHaveBeenCalledWith('activity', 'activity-1');\n  });\n\n  it('should call notFound when activity does not exist', async () => {\n    const { notFound } = await import('next/navigation');\n    const { createServerComponentClient } = await import('@supabase/auth-helpers-nextjs');\n    \n    // Mock notFound to throw (simulating Next.js behavior)\n    (notFound as jest.Mock).mockImplementation(() => {\n      throw new Error('NEXT_NOT_FOUND');\n    });\n    \n    // Mock activity not found\n    (createServerComponentClient as jest.Mock).mockReturnValueOnce({\n      from: jest.fn(() => ({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(() => Promise.resolve({\n              data: null,\n              error: { message: 'Not found' },\n            })),\n          })),\n        })),\n      })),\n    });\n    \n    const ActivityPage = (await import('./page')).default;\n    const params = Promise.resolve({ id: 'nonexistent' });\n    \n    // Should throw when notFound is called\n    await expect(ActivityPage({ params })).rejects.toThrow('NEXT_NOT_FOUND');\n    \n    // Verify notFound was called\n    expect(notFound).toHaveBeenCalled();\n  });\n\n  it('should render activity information', async () => {\n    const ActivityPage = (await import('./page')).default;\n    const params = Promise.resolve({ id: 'activity-1' });\n    \n    const result = await ActivityPage({ params });\n    \n    // Verify result is a React element\n    expect(result).toBeDefined();\n    expect(result).toHaveProperty('type');\n    expect(result).toHaveProperty('props');\n  });\n\n  it('should use SectionRenderer for sections', async () => {\n    const { listSections } = await import('@/services/sectionsService');\n    const ActivityPage = (await import('./page')).default;\n    \n    const params = Promise.resolve({ id: 'activity-1' });\n    await ActivityPage({ params });\n    \n    // Verify sections were fetched (SectionRenderer will be used in render)\n    expect(listSections).toHaveBeenCalledWith('activity', 'activity-1');\n  });\n\n  it('should handle empty sections gracefully', async () => {\n    const { listSections } = await import('@/services/sectionsService');\n    \n    // Mock empty sections\n    (listSections as jest.Mock).mockResolvedValueOnce({\n      success: true,\n      data: [],\n    });\n    \n    const ActivityPage = (await import('./page')).default;\n    const params = Promise.resolve({ id: 'activity-1' });\n    \n    const result = await ActivityPage({ params });\n    \n    // Should render without error\n    expect(result).toBeDefined();\n  });\n\n  it('should handle sections service error gracefully', async () => {\n    const { listSections } = await import('@/services/sectionsService');\n    \n    // Mock sections service error\n    (listSections as jest.Mock).mockResolvedValueOnce({\n      success: false,\n      error: { code: 'DATABASE_ERROR', message: 'Connection failed' },\n    });\n    \n    const ActivityPage = (await import('./page')).default;\n    const params = Promise.resolve({ id: 'activity-1' });\n    \n    const result = await ActivityPage({ params });\n    \n    // Should render with empty sections\n    expect(result).toBeDefined();\n  });\n});\n"],"names":["jest","mock","cookies","fn","get","set","delete","notFound","createServerComponentClient","from","select","eq","single","Promise","resolve","data","id","name","activity_type","start_time","capacity","description","events","start_date","end_date","locations","location_type","error","listSections","success","title","page_type","page_id","display_order","created_at","updated_at","columns","section_id","column_number","content_type","content_data","html","SectionRenderer","section","div","data-testid","describe","beforeEach","clearAllMocks","it","ActivityPage","default","expect","toBeDefined","toBe","params","resolves","toHaveBeenCalled","toHaveBeenCalledWith","mockImplementation","Error","mockReturnValueOnce","message","rejects","toThrow","result","toHaveProperty","mockResolvedValueOnce","code"],"mappings":"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"}