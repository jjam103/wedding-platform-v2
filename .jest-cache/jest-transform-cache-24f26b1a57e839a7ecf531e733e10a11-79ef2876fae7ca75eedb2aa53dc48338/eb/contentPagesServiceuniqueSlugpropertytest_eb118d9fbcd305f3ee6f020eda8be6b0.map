{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/contentPagesService.uniqueSlug.property.test.ts"],"sourcesContent":["import { describe, it, expect, jest, beforeEach } from '@jest/globals';\nimport * as fc from 'fast-check';\nimport { generateSlug } from '@/utils/slugs';\n\n// Mock Supabase before importing contentPagesService\nconst mockFrom = jest.fn();\njest.mock('@/lib/supabase', () => ({\n  supabase: {\n    from: mockFrom,\n  },\n}));\n\n// Import after mocking\nimport * as contentPagesService from './contentPagesService';\nimport type { CreateContentPageDTO } from '@/schemas/cmsSchemas';\n\n/**\n * Feature: admin-backend-integration-cms, Property 1: Unique Slug Generation\n * \n * For any valid content page data, when creating a page, the generated slug\n * SHALL be unique across all existing pages.\n * \n * Validates: Requirements 1.1\n */\ndescribe('Feature: admin-backend-integration-cms, Property 1: Unique Slug Generation', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  // Generator for valid content page data with unique identifiers\n  const validContentPageArbitrary = fc.record({\n    title: fc.string({ minLength: 1, maxLength: 200 })\n      .filter(s => s.trim().length > 0)\n      .filter(s => {\n        // Filter out titles that would generate empty slugs\n        const slug = s.toLowerCase()\n          .trim()\n          .replace(/[^\\w\\s-]/g, '') // Remove special chars (keeps alphanumeric, underscore, space, hyphen)\n          .replace(/\\s+/g, '-') // Replace spaces with hyphens\n          .replace(/-+/g, '-') // Replace multiple hyphens with single\n          .replace(/^-+|-+$/g, ''); // Remove leading/trailing hyphens\n        // Must have at least one alphanumeric character (not just underscores or hyphens)\n        return slug.length > 0 && /[a-z0-9]/.test(slug);\n      })\n      .map(s => `${s} ${Date.now()} ${Math.random().toString(36).substr(2, 5)}`), // Add unique suffix\n    slug: fc.option(\n      fc.string({ minLength: 1, maxLength: 200 })\n        .filter(s => s.trim().length > 0)\n        .filter(s => {\n          // Filter out slugs that would normalize to empty strings or invalid slugs\n          const normalized = s.toLowerCase()\n            .replace(/[^\\w\\s-]/g, '')\n            .replace(/\\s+/g, '-')\n            .replace(/-+/g, '-')\n            .replace(/^-+|-+$/g, '');\n          // Must have at least one alphanumeric character\n          return normalized.length > 0 && /[a-z0-9]/.test(normalized);\n        })\n        .map(s => `${s.toLowerCase()\n          .replace(/[^\\w\\s-]/g, '')\n          .replace(/_/g, '-')\n          .replace(/\\s+/g, '-')\n          .replace(/-+/g, '-')\n          .replace(/^-+|-+$/g, '')\n        }-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`), // Add unique suffix\n      { nil: undefined }\n    ),\n    status: fc.constantFrom('draft', 'published') as fc.Arbitrary<'draft' | 'published'>,\n  });\n\n  it('should generate unique slugs when creating multiple pages with the same title', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        validContentPageArbitrary,\n        fc.integer({ min: 2, max: 5 }), // Number of pages to create with same title\n        async (pageData, numPages) => {\n          const createdPages: any[] = [];\n          const slugs = new Set<string>();\n\n          // Mock database responses for slug uniqueness checks\n          let callCount = 0;\n          mockFrom.mockImplementation(() => {\n            const mockQuery: any = {\n              select: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n              neq: jest.fn().mockReturnThis(),\n              single: jest.fn().mockImplementation(async (): Promise<any> => {\n                callCount++;\n                \n                // First call for first page - no conflict\n                if (callCount === 1) {\n                  return { data: null, error: { code: 'PGRST116' } };\n                }\n                \n                // Subsequent calls - simulate conflicts for base slug\n                const currentSlug: string = mockQuery._currentSlug;\n                const existingSlug: any = createdPages.find(p => p.slug === currentSlug);\n                \n                if (existingSlug) {\n                  return { data: { id: existingSlug.id }, error: null };\n                }\n                \n                return { data: null, error: { code: 'PGRST116' } };\n              }),\n              insert: jest.fn().mockReturnThis(),\n              _currentSlug: '',\n            };\n\n            // Capture the slug being checked\n            const originalEq = mockQuery.eq;\n            mockQuery.eq = jest.fn((field: string, value: any) => {\n              if (field === 'slug') {\n                mockQuery._currentSlug = value;\n              }\n              return originalEq.call(mockQuery, field, value);\n            });\n\n            return mockQuery;\n          });\n\n          // Create multiple pages with the same title\n          for (let i = 0; i < numPages; i++) {\n            // Mock the insert operation to return a page with the generated slug\n            const insertMock = jest.fn().mockReturnThis();\n            const selectMock = jest.fn().mockReturnThis();\n            const singleMock = jest.fn().mockResolvedValue({\n              data: {\n                id: `page-${i}`,\n                title: pageData.title,\n                slug: '', // Will be set by the service\n                status: pageData.status,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n              },\n              error: null,\n            } as any);\n\n            mockFrom.mockImplementation(((table: string) => {\n              if (table === 'content_pages') {\n                const mockQuery: any = {\n                  select: jest.fn().mockReturnThis(),\n                  eq: jest.fn().mockReturnThis(),\n                  neq: jest.fn().mockReturnThis(),\n                  single: jest.fn().mockImplementation(async () => {\n                    // Check if slug exists in our created pages\n                    const currentSlug = mockQuery._currentSlug;\n                    const existingPage = createdPages.find(p => p.slug === currentSlug);\n                    \n                    if (existingPage) {\n                      return { data: { id: existingPage.id }, error: null };\n                    }\n                    \n                    return { data: null, error: { code: 'PGRST116' } };\n                  }),\n                  insert: insertMock,\n                  _currentSlug: '',\n                };\n\n                // Capture the slug being checked\n                const originalEq = mockQuery.eq;\n                mockQuery.eq = jest.fn((field: string, value: any) => {\n                  if (field === 'slug') {\n                    mockQuery._currentSlug = value;\n                  }\n                  return originalEq.call(mockQuery, field, value);\n                });\n\n                insertMock.mockReturnValue({\n                  select: selectMock,\n                });\n\n                selectMock.mockReturnValue({\n                  single: singleMock,\n                });\n\n                return mockQuery;\n              }\n              return {\n                select: jest.fn().mockReturnThis(),\n                eq: jest.fn().mockReturnThis(),\n                single: jest.fn().mockResolvedValue({ data: null, error: { code: 'PGRST116' } } as any),\n              };\n            }) as any);\n\n            const result = await contentPagesService.createContentPage({\n              title: pageData.title,\n              slug: pageData.slug,\n              status: pageData.status,\n            });\n\n            expect(result.success).toBe(true);\n            \n            if (result.success) {\n              // Update the mock data with the actual slug that was generated\n              const generatedSlug: string = (insertMock.mock.calls[0] as any)[0].slug;\n              result.data.slug = generatedSlug;\n              \n              createdPages.push(result.data);\n              slugs.add(result.data.slug);\n            }\n          }\n\n          // Property: All slugs should be unique\n          expect(slugs.size).toBe(numPages);\n          \n          // Property: Slugs should follow the pattern: base, base-2, base-3, etc.\n          const baseSlug = createdPages[0].slug;\n          for (let i = 1; i < createdPages.length; i++) {\n            const expectedSlug = `${baseSlug}-${i + 1}`;\n            expect(createdPages[i].slug).toBe(expectedSlug);\n          }\n        }\n      ),\n      { numRuns: 50 } // Reduced runs for async operations\n    );\n  });\n\n  it('should generate unique slugs when slug conflicts with existing pages', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        validContentPageArbitrary,\n        fc.array(\n          fc.string({ minLength: 1, maxLength: 50 })\n            .filter(s => s.trim().length > 0)\n            .filter(s => {\n              const normalized = s.toLowerCase()\n                .replace(/[^\\w\\s-]/g, '')\n                .replace(/_/g, '-')\n                .replace(/\\s+/g, '-')\n                .replace(/-+/g, '-')\n                .replace(/^-+|-+$/g, '');\n              return normalized.length > 0 && /[a-z0-9]/.test(normalized);\n            }),\n          { minLength: 1, maxLength: 3 }\n        ),\n        async (newPage, existingSlugs) => {\n          // Normalize existing slugs\n          const normalizedExistingSlugs = existingSlugs.map(s => \n            s.toLowerCase()\n              .replace(/[^\\w\\s-]/g, '')\n              .replace(/_/g, '-')\n              .replace(/\\s+/g, '-')\n              .replace(/-+/g, '-')\n              .replace(/^-+|-+$/g, '')\n          );\n\n          // Mock database to return existing slugs\n          mockFrom.mockImplementation(((table: string) => {\n            if (table === 'content_pages') {\n              const mockQuery: any = {\n                select: jest.fn().mockReturnThis(),\n                eq: jest.fn().mockReturnThis(),\n                neq: jest.fn().mockReturnThis(),\n                single: jest.fn().mockImplementation(async () => {\n                  const currentSlug = mockQuery._currentSlug;\n                  \n                  // Check if slug exists in our mock existing slugs\n                  if (normalizedExistingSlugs.includes(currentSlug)) {\n                    return { data: { id: 'existing-id' }, error: null };\n                  }\n                  \n                  return { data: null, error: { code: 'PGRST116' } };\n                }),\n                insert: jest.fn().mockReturnThis(),\n                _currentSlug: '',\n              };\n\n              // Capture the slug being checked\n              const originalEq = mockQuery.eq;\n              mockQuery.eq = jest.fn((field: string, value: any) => {\n                if (field === 'slug') {\n                  mockQuery._currentSlug = value;\n                }\n                return originalEq.call(mockQuery, field, value);\n              });\n\n              // Mock insert to return success\n              mockQuery.insert.mockReturnValue({\n                select: jest.fn().mockReturnValue({\n                  single: jest.fn().mockResolvedValue({\n                    data: {\n                      id: 'new-page-id',\n                      title: newPage.title,\n                      slug: '', // Will be set by service\n                      status: newPage.status,\n                      created_at: new Date().toISOString(),\n                      updated_at: new Date().toISOString(),\n                    },\n                    error: null,\n                  }),\n                }),\n              });\n\n              return mockQuery;\n            }\n            return {\n              select: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n              single: jest.fn().mockResolvedValue({ data: null, error: { code: 'PGRST116' } } as any),\n            };\n          }) as any);\n\n          const result = await contentPagesService.createContentPage({\n            title: newPage.title,\n            slug: newPage.slug,\n            status: newPage.status,\n          });\n\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            // Get the generated slug from the insert call\n            const insertCall: any = mockFrom.mock.results[mockFrom.mock.results.length - 1].value.insert.mock.calls[0];\n            const generatedSlug = insertCall[0].slug;\n            \n            // Property: Generated slug should not match any existing slugs\n            expect(normalizedExistingSlugs).not.toContain(generatedSlug);\n            \n            // Property: If base slug exists, generated slug should have a numeric suffix\n            const baseSlug = newPage.slug || generateSlug(newPage.title);\n            if (normalizedExistingSlugs.includes(baseSlug)) {\n              expect(generatedSlug).toMatch(new RegExp(`^${baseSlug}-\\\\d+$`));\n            }\n          }\n        }\n      ),\n      { numRuns: 50 } // Reduced runs for async operations\n    );\n  });\n\n  it('should generate URL-safe slugs from any title', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.string({ minLength: 1, maxLength: 200 })\n          .filter(s => s.trim().length > 0)\n          .filter(s => {\n            // Filter out titles that would generate empty slugs\n            const slug = s.toLowerCase()\n              .trim()\n              .replace(/[^\\w\\s-]/g, '')\n              .replace(/_/g, '-')\n              .replace(/\\s+/g, '-')\n              .replace(/-+/g, '-')\n              .replace(/^-+|-+$/g, '');\n            // Must have at least one alphanumeric character\n            return slug.length > 0 && /[a-z0-9]/.test(slug);\n          }),\n        fc.constantFrom('draft', 'published') as fc.Arbitrary<'draft' | 'published'>,\n        async (title, status) => {\n          // Mock database to return no conflicts\n          mockFrom.mockImplementation(() => ({\n            select: jest.fn().mockReturnThis(),\n            eq: jest.fn().mockReturnThis(),\n            neq: jest.fn().mockReturnThis(),\n            single: jest.fn().mockResolvedValue({ data: null, error: { code: 'PGRST116' } }),\n            insert: jest.fn().mockReturnValue({\n              select: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: {\n                    id: 'test-id',\n                    title,\n                    slug: generateSlug(title),\n                    status,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString(),\n                  },\n                  error: null,\n                }),\n              }),\n            }),\n          }));\n\n          const result = await contentPagesService.createContentPage({\n            title,\n            status,\n          });\n\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            const slug = result.data.slug;\n            \n            // Property: Slug should be lowercase\n            expect(slug).toBe(slug.toLowerCase());\n            \n            // Property: Slug should not contain spaces\n            expect(slug).not.toContain(' ');\n            \n            // Property: Slug should not contain special characters (except hyphens)\n            expect(slug).toMatch(/^[a-z0-9-]+$/);\n            \n            // Property: Slug should not start or end with hyphens\n            expect(slug).not.toMatch(/^-/);\n            expect(slug).not.toMatch(/-$/);\n            \n            // Property: Slug should not have consecutive hyphens\n            expect(slug).not.toMatch(/--/);\n            \n            // Property: Slug should contain at least one alphanumeric character\n            expect(slug).toMatch(/[a-z0-9]/);\n          }\n        }\n      ),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle explicit slug parameter and ensure uniqueness', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.string({ minLength: 1, maxLength: 200 })\n          .filter(s => s.trim().length > 0)\n          .filter(s => {\n            // Filter out titles that would generate empty slugs\n            const slug = s.toLowerCase()\n              .trim()\n              .replace(/[^\\w\\s-]/g, '')\n              .replace(/_/g, '-')\n              .replace(/\\s+/g, '-')\n              .replace(/-+/g, '-')\n              .replace(/^-+|-+$/g, '');\n            return slug.length > 0 && /[a-z0-9]/.test(slug);\n          }),\n        // Generate slugs that already match the schema regex pattern\n        fc.string({ minLength: 1, maxLength: 200 })\n          .filter(s => {\n            const normalized = s.toLowerCase()\n              .replace(/[^\\w\\s-]/g, '')\n              .replace(/_/g, '-')\n              .replace(/\\s+/g, '-')\n              .replace(/-+/g, '-')\n              .replace(/^-+|-+$/g, '');\n            // Must match the schema regex and have at least one alphanumeric character\n            return normalized.length > 0 && /^[a-z0-9-]+$/.test(normalized) && /[a-z0-9]/.test(normalized);\n          })\n          .map(s => s.toLowerCase()\n            .replace(/[^\\w\\s-]/g, '')\n            .replace(/_/g, '-')\n            .replace(/\\s+/g, '-')\n            .replace(/-+/g, '-')\n            .replace(/^-+|-+$/g, '')\n          ),\n        fc.constantFrom('draft', 'published') as fc.Arbitrary<'draft' | 'published'>,\n        async (title, explicitSlug, status) => {\n          const normalizedSlug = explicitSlug;\n\n          // Mock database to simulate existing slug\n          let checkCount = 0;\n          mockFrom.mockImplementation(() => {\n            const mockQuery: any = {\n              select: jest.fn().mockReturnThis(),\n              eq: jest.fn().mockReturnThis(),\n              neq: jest.fn().mockReturnThis(),\n              single: jest.fn().mockImplementation(async () => {\n                checkCount++;\n                const currentSlug = mockQuery._currentSlug;\n                \n                // First check - base slug exists\n                if (checkCount === 1 && currentSlug === normalizedSlug) {\n                  return { data: { id: 'existing-id' }, error: null };\n                }\n                \n                // Subsequent checks - no conflict\n                return { data: null, error: { code: 'PGRST116' } };\n              }),\n              insert: jest.fn().mockReturnThis(),\n              _currentSlug: '',\n            };\n\n            const originalEq = mockQuery.eq;\n            mockQuery.eq = jest.fn((field: string, value: any) => {\n              if (field === 'slug') {\n                mockQuery._currentSlug = value;\n              }\n              return originalEq.call(mockQuery, field, value);\n            });\n\n            mockQuery.insert.mockReturnValue({\n              select: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: {\n                    id: 'new-id',\n                    title,\n                    slug: `${normalizedSlug}-2`,\n                    status,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString(),\n                  },\n                  error: null,\n                }),\n              }),\n            });\n\n            return mockQuery;\n          });\n\n          const result = await contentPagesService.createContentPage({\n            title,\n            slug: explicitSlug,\n            status,\n          });\n\n          expect(result.success).toBe(true);\n          \n          if (result.success) {\n            // Property: When explicit slug conflicts, system should append number\n            expect(result.data.slug).toBe(`${normalizedSlug}-2`);\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n});\n"],"names":["mockFrom","jest","fn","mock","supabase","from","describe","beforeEach","clearAllMocks","validContentPageArbitrary","fc","record","title","string","minLength","maxLength","filter","s","trim","length","slug","toLowerCase","replace","test","map","Date","now","Math","random","toString","substr","option","normalized","nil","undefined","status","constantFrom","it","assert","asyncProperty","integer","min","max","pageData","numPages","createdPages","slugs","Set","callCount","mockImplementation","mockQuery","select","mockReturnThis","eq","neq","single","data","error","code","currentSlug","_currentSlug","existingSlug","find","p","id","insert","originalEq","field","value","call","i","insertMock","selectMock","singleMock","mockResolvedValue","created_at","toISOString","updated_at","table","existingPage","mockReturnValue","result","contentPagesService","createContentPage","expect","success","toBe","generatedSlug","calls","push","add","size","baseSlug","expectedSlug","numRuns","array","newPage","existingSlugs","normalizedExistingSlugs","includes","insertCall","results","not","toContain","generateSlug","toMatch","RegExp","explicitSlug","normalizedSlug","checkCount"],"mappings":"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"}