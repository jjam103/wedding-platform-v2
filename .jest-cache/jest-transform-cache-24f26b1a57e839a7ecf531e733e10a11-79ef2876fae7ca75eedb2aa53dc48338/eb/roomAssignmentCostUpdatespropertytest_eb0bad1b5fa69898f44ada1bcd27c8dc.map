{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/roomAssignmentCostUpdates.property.test.ts"],"sourcesContent":["/**\n * Property-Based Test: Room Assignment Cost Updates\n * Feature: destination-wedding-platform, Property 15: Room Assignment Cost Updates\n * Validates: Requirements 10.14\n *\n * Property: For any room assignment, when the assignment changes (different room type,\n * different dates), the related cost calculations (including subsidies) should\n * automatically recalculate based on the new assignment.\n */\n\nimport * as fc from 'fast-check';\nimport {\n  createRoomType,\n  calculateRoomCost,\n} from './accommodationService';\nimport type {\n  CreateRoomTypeDTO,\n  CalculateCostDTO,\n} from '../schemas/accommodationSchemas';\nimport { createClient } from '@supabase/supabase-js';\n\n// Mock Supabase client\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(),\n}));\n\ndescribe('Feature: destination-wedding-platform, Property 15: Room Assignment Cost Updates', () => {\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    mockSupabase = {\n      from: jest.fn().mockReturnThis(),\n      select: jest.fn().mockReturnThis(),\n      insert: jest.fn().mockReturnThis(),\n      update: jest.fn().mockReturnThis(),\n      delete: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      single: jest.fn(),\n      or: jest.fn().mockReturnThis(),\n    };\n    (createClient as jest.Mock).mockReturnValue(mockSupabase);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should recalculate costs when room type changes', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        // Generate two different room types with different prices\n        fc.record({\n          roomType1: fc.record({\n            accommodationId: fc.uuid(),\n            name: fc.string({ minLength: 2, maxLength: 50 }).filter(s => s.trim().length >= 2),\n            capacity: fc.integer({ min: 1, max: 6 }),\n            totalRooms: fc.integer({ min: 1, max: 20 }),\n            pricePerNight: fc.float({ min: 50, max: 500, noNaN: true }),\n            hostSubsidyPerNight: fc.float({ min: 0, max: 100, noNaN: true }),\n          }),\n          roomType2: fc.record({\n            accommodationId: fc.uuid(),\n            name: fc.string({ minLength: 2, maxLength: 50 }).filter(s => s.trim().length >= 2),\n            capacity: fc.integer({ min: 1, max: 6 }),\n            totalRooms: fc.integer({ min: 1, max: 20 }),\n            pricePerNight: fc.float({ min: 50, max: 500, noNaN: true }),\n            hostSubsidyPerNight: fc.float({ min: 0, max: 100, noNaN: true }),\n          }),\n          checkIn: fc.date({ min: new Date('2025-01-01'), max: new Date('2025-12-01') }),\n          checkOut: fc.date({ min: new Date('2025-01-02'), max: new Date('2025-12-31') }),\n        }).filter(({ roomType1, roomType2 }) => {\n          // Ensure room types have different prices (at least $10 difference)\n          return Math.abs(roomType1.pricePerNight - roomType2.pricePerNight) >= 10;\n        }),\n        async ({ roomType1, roomType2, checkIn, checkOut }) => {\n          // Ensure check-out is after check-in\n          if (checkOut <= checkIn) {\n            checkOut = new Date(checkIn.getTime() + 24 * 60 * 60 * 1000);\n          }\n\n          // Ensure subsidies don't exceed prices\n          roomType1.hostSubsidyPerNight = Math.min(roomType1.hostSubsidyPerNight, roomType1.pricePerNight);\n          roomType2.hostSubsidyPerNight = Math.min(roomType2.hostSubsidyPerNight, roomType2.pricePerNight);\n\n          const roomType1Id = '00000000-0000-0000-0000-000000000001';\n          const roomType2Id = '00000000-0000-0000-0000-000000000002';\n\n          // Mock room type 1 creation and retrieval\n          mockSupabase.single.mockResolvedValueOnce({\n            data: {\n              id: roomType1Id,\n              accommodation_id: roomType1.accommodationId,\n              name: roomType1.name,\n              capacity: roomType1.capacity,\n              total_rooms: roomType1.totalRooms,\n              price_per_night: roomType1.pricePerNight,\n              host_subsidy_per_night: roomType1.hostSubsidyPerNight,\n              status: 'draft',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            },\n            error: null,\n          });\n\n          // Mock room type 2 creation and retrieval\n          mockSupabase.single.mockResolvedValueOnce({\n            data: {\n              id: roomType2Id,\n              accommodation_id: roomType2.accommodationId,\n              name: roomType2.name,\n              capacity: roomType2.capacity,\n              total_rooms: roomType2.totalRooms,\n              price_per_night: roomType2.pricePerNight,\n              host_subsidy_per_night: roomType2.hostSubsidyPerNight,\n              status: 'draft',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            },\n            error: null,\n          });\n\n          // Create both room types\n          const result1 = await createRoomType(roomType1 as CreateRoomTypeDTO);\n          const result2 = await createRoomType(roomType2 as CreateRoomTypeDTO);\n\n          if (!result1.success || !result2.success) {\n            throw new Error('Failed to create room types');\n          }\n\n          // Mock getRoomType for cost calculation (room type 1)\n          mockSupabase.single.mockResolvedValueOnce({\n            data: {\n              id: roomType1Id,\n              accommodation_id: roomType1.accommodationId,\n              name: roomType1.name,\n              capacity: roomType1.capacity,\n              total_rooms: roomType1.totalRooms,\n              price_per_night: roomType1.pricePerNight,\n              host_subsidy_per_night: roomType1.hostSubsidyPerNight,\n              status: 'draft',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            },\n            error: null,\n          });\n\n          // Calculate cost for room type 1\n          const cost1Result = await calculateRoomCost({\n            roomTypeId: roomType1Id,\n            checkIn: checkIn.toISOString(),\n            checkOut: checkOut.toISOString(),\n          } as CalculateCostDTO);\n\n          if (!cost1Result.success) {\n            throw new Error(`Failed to calculate cost for room type 1: ${cost1Result.error.code} - ${cost1Result.error.message}`);\n          }\n\n          const cost1 = cost1Result.data;\n\n          // Mock getRoomType for cost calculation (room type 2)\n          mockSupabase.single.mockResolvedValueOnce({\n            data: {\n              id: roomType2Id,\n              accommodation_id: roomType2.accommodationId,\n              name: roomType2.name,\n              capacity: roomType2.capacity,\n              total_rooms: roomType2.totalRooms,\n              price_per_night: roomType2.pricePerNight,\n              host_subsidy_per_night: roomType2.hostSubsidyPerNight,\n              status: 'draft',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            },\n            error: null,\n          });\n\n          // Calculate cost for room type 2 (simulating room type change)\n          const cost2Result = await calculateRoomCost({\n            roomTypeId: roomType2Id,\n            checkIn: checkIn.toISOString(),\n            checkOut: checkOut.toISOString(),\n          } as CalculateCostDTO);\n\n          if (!cost2Result.success) {\n            throw new Error(`Failed to calculate cost for room type 2: ${cost2Result.error.code} - ${cost2Result.error.message}`);\n          }\n\n          const cost2 = cost2Result.data;\n\n          // Property: Costs should be recalculated based on new room type\n          // The number of nights should be the same\n          if (cost1.numberOfNights !== cost2.numberOfNights) {\n            throw new Error(`Number of nights mismatch: ${cost1.numberOfNights} !== ${cost2.numberOfNights}`);\n          }\n\n          // But the costs should reflect the different room types\n          if (cost1.pricePerNight !== roomType1.pricePerNight) {\n            throw new Error(`Room type 1 price mismatch: ${cost1.pricePerNight} !== ${roomType1.pricePerNight}`);\n          }\n          if (cost2.pricePerNight !== roomType2.pricePerNight) {\n            throw new Error(`Room type 2 price mismatch: ${cost2.pricePerNight} !== ${roomType2.pricePerNight}`);\n          }\n\n          if (cost1.subsidyPerNight !== roomType1.hostSubsidyPerNight) {\n            throw new Error(`Room type 1 subsidy mismatch: ${cost1.subsidyPerNight} !== ${roomType1.hostSubsidyPerNight}`);\n          }\n          if (cost2.subsidyPerNight !== roomType2.hostSubsidyPerNight) {\n            throw new Error(`Room type 2 subsidy mismatch: ${cost2.subsidyPerNight} !== ${roomType2.hostSubsidyPerNight}`);\n          }\n\n          // Total costs should be correctly calculated\n          const expectedCost1 = roomType1.pricePerNight * cost1.numberOfNights;\n          const expectedCost2 = roomType2.pricePerNight * cost2.numberOfNights;\n          \n          if (Math.abs(cost1.totalCost - expectedCost1) > 0.01) {\n            throw new Error(`Room type 1 total cost mismatch: ${cost1.totalCost} !== ${expectedCost1}`);\n          }\n          if (Math.abs(cost2.totalCost - expectedCost2) > 0.01) {\n            throw new Error(`Room type 2 total cost mismatch: ${cost2.totalCost} !== ${expectedCost2}`);\n          }\n\n          const expectedSubsidy1 = roomType1.hostSubsidyPerNight * cost1.numberOfNights;\n          const expectedSubsidy2 = roomType2.hostSubsidyPerNight * cost2.numberOfNights;\n          \n          if (Math.abs(cost1.totalSubsidy - expectedSubsidy1) > 0.01) {\n            throw new Error(`Room type 1 total subsidy mismatch: ${cost1.totalSubsidy} !== ${expectedSubsidy1}`);\n          }\n          if (Math.abs(cost2.totalSubsidy - expectedSubsidy2) > 0.01) {\n            throw new Error(`Room type 2 total subsidy mismatch: ${cost2.totalSubsidy} !== ${expectedSubsidy2}`);\n          }\n\n          const expectedGuestCost1 = cost1.totalCost - cost1.totalSubsidy;\n          const expectedGuestCost2 = cost2.totalCost - cost2.totalSubsidy;\n          \n          if (Math.abs(cost1.guestCost - expectedGuestCost1) > 0.01) {\n            throw new Error(`Room type 1 guest cost mismatch: ${cost1.guestCost} !== ${expectedGuestCost1}`);\n          }\n          if (Math.abs(cost2.guestCost - expectedGuestCost2) > 0.01) {\n            throw new Error(`Room type 2 guest cost mismatch: ${cost2.guestCost} !== ${expectedGuestCost2}`);\n          }\n        }\n      ),\n      { numRuns: 20, timeout: 5000 } // Reduced runs and increased timeout\n    );\n  });\n\n  it('should recalculate costs when dates change', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        fc.record({\n          roomType: fc.record({\n            accommodationId: fc.uuid(),\n            name: fc.string({ minLength: 2, maxLength: 50 }).filter(s => s.trim().length >= 2),\n            capacity: fc.integer({ min: 1, max: 6 }),\n            totalRooms: fc.integer({ min: 1, max: 20 }),\n            pricePerNight: fc.float({ min: 50, max: 500, noNaN: true }),\n            hostSubsidyPerNight: fc.float({ min: 0, max: 100, noNaN: true }),\n          }),\n          checkIn1: fc.date({ min: new Date('2025-01-01'), max: new Date('2025-06-01') }),\n          checkOut1: fc.date({ min: new Date('2025-01-02'), max: new Date('2025-06-15') }),\n          checkIn2: fc.date({ min: new Date('2025-06-16'), max: new Date('2025-11-01') }),\n          checkOut2: fc.date({ min: new Date('2025-06-17'), max: new Date('2025-12-31') }),\n        }),\n        async ({ roomType, checkIn1, checkOut1, checkIn2, checkOut2 }) => {\n          // Ensure check-outs are after check-ins\n          if (checkOut1 <= checkIn1) {\n            checkOut1 = new Date(checkIn1.getTime() + 24 * 60 * 60 * 1000);\n          }\n          if (checkOut2 <= checkIn2) {\n            checkOut2 = new Date(checkIn2.getTime() + 24 * 60 * 60 * 1000);\n          }\n\n          // Ensure subsidy doesn't exceed price\n          roomType.hostSubsidyPerNight = Math.min(roomType.hostSubsidyPerNight, roomType.pricePerNight);\n\n          const roomTypeId = '00000000-0000-0000-0000-000000000001';\n\n          // Mock room type creation\n          mockSupabase.single.mockResolvedValueOnce({\n            data: {\n              id: roomTypeId,\n              accommodation_id: roomType.accommodationId,\n              name: roomType.name,\n              capacity: roomType.capacity,\n              total_rooms: roomType.totalRooms,\n              price_per_night: roomType.pricePerNight,\n              host_subsidy_per_night: roomType.hostSubsidyPerNight,\n              status: 'draft',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            },\n            error: null,\n          });\n\n          const result = await createRoomType(roomType as CreateRoomTypeDTO);\n          if (!result.success) {\n            throw new Error('Failed to create room type');\n          }\n\n          // Mock getRoomType for first cost calculation\n          mockSupabase.single.mockResolvedValueOnce({\n            data: {\n              id: roomTypeId,\n              accommodation_id: roomType.accommodationId,\n              name: roomType.name,\n              capacity: roomType.capacity,\n              total_rooms: roomType.totalRooms,\n              price_per_night: roomType.pricePerNight,\n              host_subsidy_per_night: roomType.hostSubsidyPerNight,\n              status: 'draft',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            },\n            error: null,\n          });\n\n          // Calculate cost for first date range\n          const cost1Result = await calculateRoomCost({\n            roomTypeId,\n            checkIn: checkIn1.toISOString(),\n            checkOut: checkOut1.toISOString(),\n          } as CalculateCostDTO);\n\n          if (!cost1Result.success) {\n            throw new Error(`Failed to calculate cost for first date range: ${cost1Result.error.code} - ${cost1Result.error.message}`);\n          }\n\n          const cost1 = cost1Result.data;\n\n          // Mock getRoomType for second cost calculation\n          mockSupabase.single.mockResolvedValueOnce({\n            data: {\n              id: roomTypeId,\n              accommodation_id: roomType.accommodationId,\n              name: roomType.name,\n              capacity: roomType.capacity,\n              total_rooms: roomType.totalRooms,\n              price_per_night: roomType.pricePerNight,\n              host_subsidy_per_night: roomType.hostSubsidyPerNight,\n              status: 'draft',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            },\n            error: null,\n          });\n\n          // Calculate cost for second date range (simulating date change)\n          const cost2Result = await calculateRoomCost({\n            roomTypeId,\n            checkIn: checkIn2.toISOString(),\n            checkOut: checkOut2.toISOString(),\n          } as CalculateCostDTO);\n\n          if (!cost2Result.success) {\n            throw new Error(`Failed to calculate cost for second date range: ${cost2Result.error.code} - ${cost2Result.error.message}`);\n          }\n\n          const cost2 = cost2Result.data;\n\n          // Property: Costs should be recalculated based on new dates\n          // Calculate expected number of nights\n          const nights1 = Math.ceil((checkOut1.getTime() - checkIn1.getTime()) / (1000 * 60 * 60 * 24));\n          const nights2 = Math.ceil((checkOut2.getTime() - checkIn2.getTime()) / (1000 * 60 * 60 * 24));\n\n          if (cost1.numberOfNights !== nights1) {\n            throw new Error(`First date range nights mismatch: ${cost1.numberOfNights} !== ${nights1}`);\n          }\n          if (cost2.numberOfNights !== nights2) {\n            throw new Error(`Second date range nights mismatch: ${cost2.numberOfNights} !== ${nights2}`);\n          }\n\n          // Per-night rates should remain the same\n          if (cost1.pricePerNight !== roomType.pricePerNight) {\n            throw new Error(`First date range price mismatch: ${cost1.pricePerNight} !== ${roomType.pricePerNight}`);\n          }\n          if (cost2.pricePerNight !== roomType.pricePerNight) {\n            throw new Error(`Second date range price mismatch: ${cost2.pricePerNight} !== ${roomType.pricePerNight}`);\n          }\n\n          if (cost1.subsidyPerNight !== roomType.hostSubsidyPerNight) {\n            throw new Error(`First date range subsidy mismatch: ${cost1.subsidyPerNight} !== ${roomType.hostSubsidyPerNight}`);\n          }\n          if (cost2.subsidyPerNight !== roomType.hostSubsidyPerNight) {\n            throw new Error(`Second date range subsidy mismatch: ${cost2.subsidyPerNight} !== ${roomType.hostSubsidyPerNight}`);\n          }\n\n          // Total costs should be proportional to number of nights\n          const expectedCost1 = roomType.pricePerNight * nights1;\n          const expectedCost2 = roomType.pricePerNight * nights2;\n          \n          if (Math.abs(cost1.totalCost - expectedCost1) > 0.01) {\n            throw new Error(`First date range total cost mismatch: ${cost1.totalCost} !== ${expectedCost1}`);\n          }\n          if (Math.abs(cost2.totalCost - expectedCost2) > 0.01) {\n            throw new Error(`Second date range total cost mismatch: ${cost2.totalCost} !== ${expectedCost2}`);\n          }\n\n          const expectedSubsidy1 = roomType.hostSubsidyPerNight * nights1;\n          const expectedSubsidy2 = roomType.hostSubsidyPerNight * nights2;\n          \n          if (Math.abs(cost1.totalSubsidy - expectedSubsidy1) > 0.01) {\n            throw new Error(`First date range total subsidy mismatch: ${cost1.totalSubsidy} !== ${expectedSubsidy1}`);\n          }\n          if (Math.abs(cost2.totalSubsidy - expectedSubsidy2) > 0.01) {\n            throw new Error(`Second date range total subsidy mismatch: ${cost2.totalSubsidy} !== ${expectedSubsidy2}`);\n          }\n\n          const expectedGuestCost1 = cost1.totalCost - cost1.totalSubsidy;\n          const expectedGuestCost2 = cost2.totalCost - cost2.totalSubsidy;\n          \n          if (Math.abs(cost1.guestCost - expectedGuestCost1) > 0.01) {\n            throw new Error(`First date range guest cost mismatch: ${cost1.guestCost} !== ${expectedGuestCost1}`);\n          }\n          if (Math.abs(cost2.guestCost - expectedGuestCost2) > 0.01) {\n            throw new Error(`Second date range guest cost mismatch: ${cost2.guestCost} !== ${expectedGuestCost2}`);\n          }\n        }\n      ),\n      { numRuns: 20, timeout: 5000 } // Reduced runs and increased timeout\n    );\n  });\n});\n"],"names":["jest","mock","createClient","fn","describe","mockSupabase","beforeEach","from","mockReturnThis","select","insert","update","delete","eq","single","or","mockReturnValue","afterEach","clearAllMocks","it","fc","assert","asyncProperty","record","roomType1","accommodationId","uuid","name","string","minLength","maxLength","filter","s","trim","length","capacity","integer","min","max","totalRooms","pricePerNight","float","noNaN","hostSubsidyPerNight","roomType2","checkIn","date","Date","checkOut","Math","abs","getTime","roomType1Id","roomType2Id","mockResolvedValueOnce","data","id","accommodation_id","total_rooms","price_per_night","host_subsidy_per_night","status","created_at","toISOString","updated_at","error","result1","createRoomType","result2","success","Error","cost1Result","calculateRoomCost","roomTypeId","code","message","cost1","cost2Result","cost2","numberOfNights","subsidyPerNight","expectedCost1","expectedCost2","totalCost","expectedSubsidy1","expectedSubsidy2","totalSubsidy","expectedGuestCost1","expectedGuestCost2","guestCost","numRuns","timeout","roomType","checkIn1","checkOut1","checkIn2","checkOut2","result","nights1","ceil","nights2"],"mappings":"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"}