7f2806c2cecf6074f8af342a5732c33b
/**
 * Guest View Navigation Tests for Events
 * 
 * Tests the "View as Guest" functionality for events.
 * Requirements: 32.2
 */ "use strict";
// Mock dependencies
jest.mock('@/components/ui/ToastContext');
jest.mock('next/navigation', ()=>({
        useRouter: jest.fn(),
        useSearchParams: ()=>({
                get: jest.fn(),
                getAll: jest.fn(),
                has: jest.fn(),
                keys: jest.fn(),
                values: jest.fn(),
                entries: jest.fn(),
                forEach: jest.fn(),
                toString: jest.fn()
            }),
        usePathname: ()=>'/admin/events'
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = require("@testing-library/react");
const _page = /*#__PURE__*/ _interop_require_default(require("./page"));
const _ToastContext = require("../../../components/ui/ToastContext");
const _navigation = require("next/navigation");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
// Mock fetch
global.fetch = jest.fn();
// Mock window.location
delete window.location;
window.location = {
    href: ''
};
const mockUseToast = _ToastContext.useToast;
const mockUseRouter = _navigation.useRouter;
describe('EventsPage - Guest View Navigation', ()=>{
    const mockAddToast = jest.fn();
    const mockPush = jest.fn();
    const mockEvents = [
        {
            id: 'event-1',
            name: 'Ceremony on the Beach',
            eventType: 'ceremony',
            startDate: '2025-06-15T14:00:00Z',
            endDate: '2025-06-15T15:00:00Z',
            status: 'published',
            locationId: 'loc-1',
            description: 'Beach ceremony',
            rsvpRequired: true,
            rsvpDeadline: '2025-06-01T00:00:00Z'
        },
        {
            id: 'event-2',
            name: 'Welcome Dinner',
            eventType: 'reception',
            startDate: '2025-06-14T18:00:00Z',
            endDate: '2025-06-14T21:00:00Z',
            status: 'published',
            locationId: 'loc-2',
            description: 'Welcome dinner',
            rsvpRequired: true,
            rsvpDeadline: '2025-06-01T00:00:00Z'
        }
    ];
    const mockLocations = [
        {
            id: 'loc-1',
            name: 'Beach Venue'
        },
        {
            id: 'loc-2',
            name: 'Restaurant'
        }
    ];
    beforeEach(()=>{
        jest.clearAllMocks();
        mockUseToast.mockReturnValue({
            addToast: mockAddToast,
            toasts: [],
            removeToast: jest.fn()
        });
        mockUseRouter.mockReturnValue({
            push: mockPush,
            replace: jest.fn(),
            refresh: jest.fn(),
            back: jest.fn(),
            forward: jest.fn(),
            prefetch: jest.fn()
        });
        // Mock fetch responses
        global.fetch.mockImplementation((url)=>{
            if (url.includes('/api/admin/events')) {
                return Promise.resolve({
                    ok: true,
                    json: ()=>Promise.resolve({
                            success: true,
                            data: {
                                events: mockEvents
                            }
                        })
                });
            }
            if (url.includes('/api/admin/locations')) {
                return Promise.resolve({
                    ok: true,
                    json: ()=>Promise.resolve({
                            success: true,
                            data: mockLocations
                        })
                });
            }
            return Promise.reject(new Error('Unknown URL'));
        });
    });
    describe('View Button', ()=>{
        it('should render View button for each event', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            // Wait for events to load
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Ceremony on the Beach').length).toBeGreaterThan(0);
            }, {
                timeout: 3000
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            expect(viewButtons.length).toBeGreaterThan(0);
        });
        it('should navigate to guest-facing event page when View button is clicked', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Ceremony on the Beach').length).toBeGreaterThan(0);
            }, {
                timeout: 3000
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toBe('/guest/events/event-1');
        });
        it('should generate correct URL for each event ID', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Ceremony on the Beach').length).toBeGreaterThan(0);
            }, {
                timeout: 3000
            });
            // Test first event
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toBe('/guest/events/event-1');
            // Reset location
            window.location.href = '';
            // Test second event (accounting for possible duplicates)
            const secondButtonIndex = viewButtons.length > 2 ? 2 : 1;
            if (viewButtons.length > secondButtonIndex) {
                _react.fireEvent.click(viewButtons[secondButtonIndex]);
                expect(window.location.href).toContain('/guest/events/');
            }
        });
        it('should not propagate click event to row', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Ceremony on the Beach').length).toBeGreaterThan(0);
            }, {
                timeout: 3000
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            const clickEvent = new MouseEvent('click', {
                bubbles: true
            });
            const stopPropagationSpy = jest.spyOn(clickEvent, 'stopPropagation');
            viewButtons[0].dispatchEvent(clickEvent);
            expect(stopPropagationSpy).toHaveBeenCalled();
        });
    });
    describe('Link Generation', ()=>{
        it('should generate URL with /guest/events/ prefix', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Ceremony on the Beach').length).toBeGreaterThan(0);
            }, {
                timeout: 3000
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toMatch(/^\/guest\/events\//);
        });
        it('should use event ID in URL', async ()=>{
            (0, _react.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_page.default, {}));
            await (0, _react.waitFor)(()=>{
                expect(_react.screen.getAllByText('Ceremony on the Beach').length).toBeGreaterThan(0);
            }, {
                timeout: 3000
            });
            const viewButtons = _react.screen.getAllByRole('button', {
                name: /^view$/i
            });
            _react.fireEvent.click(viewButtons[0]);
            expect(window.location.href).toContain('event-1');
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FkbWluL2V2ZW50cy9wYWdlLmd1ZXN0Vmlldy50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEd1ZXN0IFZpZXcgTmF2aWdhdGlvbiBUZXN0cyBmb3IgRXZlbnRzXG4gKiBcbiAqIFRlc3RzIHRoZSBcIlZpZXcgYXMgR3Vlc3RcIiBmdW5jdGlvbmFsaXR5IGZvciBldmVudHMuXG4gKiBSZXF1aXJlbWVudHM6IDMyLjJcbiAqL1xuXG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50LCB3YWl0Rm9yIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCc7XG5pbXBvcnQgRXZlbnRzUGFnZSBmcm9tICcuL3BhZ2UnO1xuaW1wb3J0IHsgdXNlVG9hc3QgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvVG9hc3RDb250ZXh0JztcbmltcG9ydCB7IHVzZVJvdXRlciB9IGZyb20gJ25leHQvbmF2aWdhdGlvbic7XG5cbi8vIE1vY2sgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJ0AvY29tcG9uZW50cy91aS9Ub2FzdENvbnRleHQnKTtcbmplc3QubW9jaygnbmV4dC9uYXZpZ2F0aW9uJywgKCkgPT4gKHtcbiAgdXNlUm91dGVyOiBqZXN0LmZuKCksXG4gIHVzZVNlYXJjaFBhcmFtczogKCkgPT4gKHtcbiAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICBnZXRBbGw6IGplc3QuZm4oKSxcbiAgICBoYXM6IGplc3QuZm4oKSxcbiAgICBrZXlzOiBqZXN0LmZuKCksXG4gICAgdmFsdWVzOiBqZXN0LmZuKCksXG4gICAgZW50cmllczogamVzdC5mbigpLFxuICAgIGZvckVhY2g6IGplc3QuZm4oKSxcbiAgICB0b1N0cmluZzogamVzdC5mbigpLFxuICB9KSxcbiAgdXNlUGF0aG5hbWU6ICgpID0+ICcvYWRtaW4vZXZlbnRzJyxcbn0pKTtcblxuLy8gTW9jayBmZXRjaFxuZ2xvYmFsLmZldGNoID0gamVzdC5mbigpO1xuXG4vLyBNb2NrIHdpbmRvdy5sb2NhdGlvblxuZGVsZXRlICh3aW5kb3cgYXMgYW55KS5sb2NhdGlvbjtcbndpbmRvdy5sb2NhdGlvbiA9IHsgaHJlZjogJycgfSBhcyBhbnk7XG5cbmNvbnN0IG1vY2tVc2VUb2FzdCA9IHVzZVRvYXN0IGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIHVzZVRvYXN0PjtcbmNvbnN0IG1vY2tVc2VSb3V0ZXIgPSB1c2VSb3V0ZXIgYXMgamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgdXNlUm91dGVyPjtcblxuZGVzY3JpYmUoJ0V2ZW50c1BhZ2UgLSBHdWVzdCBWaWV3IE5hdmlnYXRpb24nLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tBZGRUb2FzdCA9IGplc3QuZm4oKTtcbiAgY29uc3QgbW9ja1B1c2ggPSBqZXN0LmZuKCk7XG5cbiAgY29uc3QgbW9ja0V2ZW50cyA9IFtcbiAgICB7XG4gICAgICBpZDogJ2V2ZW50LTEnLFxuICAgICAgbmFtZTogJ0NlcmVtb255IG9uIHRoZSBCZWFjaCcsXG4gICAgICBldmVudFR5cGU6ICdjZXJlbW9ueScsXG4gICAgICBzdGFydERhdGU6ICcyMDI1LTA2LTE1VDE0OjAwOjAwWicsXG4gICAgICBlbmREYXRlOiAnMjAyNS0wNi0xNVQxNTowMDowMFonLFxuICAgICAgc3RhdHVzOiAncHVibGlzaGVkJyxcbiAgICAgIGxvY2F0aW9uSWQ6ICdsb2MtMScsXG4gICAgICBkZXNjcmlwdGlvbjogJ0JlYWNoIGNlcmVtb255JyxcbiAgICAgIHJzdnBSZXF1aXJlZDogdHJ1ZSxcbiAgICAgIHJzdnBEZWFkbGluZTogJzIwMjUtMDYtMDFUMDA6MDA6MDBaJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAnZXZlbnQtMicsXG4gICAgICBuYW1lOiAnV2VsY29tZSBEaW5uZXInLFxuICAgICAgZXZlbnRUeXBlOiAncmVjZXB0aW9uJyxcbiAgICAgIHN0YXJ0RGF0ZTogJzIwMjUtMDYtMTRUMTg6MDA6MDBaJyxcbiAgICAgIGVuZERhdGU6ICcyMDI1LTA2LTE0VDIxOjAwOjAwWicsXG4gICAgICBzdGF0dXM6ICdwdWJsaXNoZWQnLFxuICAgICAgbG9jYXRpb25JZDogJ2xvYy0yJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnV2VsY29tZSBkaW5uZXInLFxuICAgICAgcnN2cFJlcXVpcmVkOiB0cnVlLFxuICAgICAgcnN2cERlYWRsaW5lOiAnMjAyNS0wNi0wMVQwMDowMDowMFonLFxuICAgIH0sXG4gIF07XG5cbiAgY29uc3QgbW9ja0xvY2F0aW9ucyA9IFtcbiAgICB7IGlkOiAnbG9jLTEnLCBuYW1lOiAnQmVhY2ggVmVudWUnIH0sXG4gICAgeyBpZDogJ2xvYy0yJywgbmFtZTogJ1Jlc3RhdXJhbnQnIH0sXG4gIF07XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgXG4gICAgbW9ja1VzZVRvYXN0Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBhZGRUb2FzdDogbW9ja0FkZFRvYXN0LFxuICAgICAgdG9hc3RzOiBbXSxcbiAgICAgIHJlbW92ZVRvYXN0OiBqZXN0LmZuKCksXG4gICAgfSk7XG5cbiAgICBtb2NrVXNlUm91dGVyLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBwdXNoOiBtb2NrUHVzaCxcbiAgICAgIHJlcGxhY2U6IGplc3QuZm4oKSxcbiAgICAgIHJlZnJlc2g6IGplc3QuZm4oKSxcbiAgICAgIGJhY2s6IGplc3QuZm4oKSxcbiAgICAgIGZvcndhcmQ6IGplc3QuZm4oKSxcbiAgICAgIHByZWZldGNoOiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnkpO1xuXG4gICAgLy8gTW9jayBmZXRjaCByZXNwb25zZXNcbiAgICAoZ2xvYmFsLmZldGNoIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKCh1cmw6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHVybC5pbmNsdWRlcygnL2FwaS9hZG1pbi9ldmVudHMnKSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGE6IHsgZXZlbnRzOiBtb2NrRXZlbnRzIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHVybC5pbmNsdWRlcygnL2FwaS9hZG1pbi9sb2NhdGlvbnMnKSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGE6IG1vY2tMb2NhdGlvbnMsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignVW5rbm93biBVUkwnKSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdWaWV3IEJ1dHRvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlbmRlciBWaWV3IGJ1dHRvbiBmb3IgZWFjaCBldmVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJlbmRlcig8RXZlbnRzUGFnZSAvPik7XG5cbiAgICAgIC8vIFdhaXQgZm9yIGV2ZW50cyB0byBsb2FkXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRBbGxCeVRleHQoJ0NlcmVtb255IG9uIHRoZSBCZWFjaCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSwgeyB0aW1lb3V0OiAzMDAwIH0pO1xuXG4gICAgICBjb25zdCB2aWV3QnV0dG9ucyA9IHNjcmVlbi5nZXRBbGxCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL152aWV3JC9pIH0pO1xuICAgICAgZXhwZWN0KHZpZXdCdXR0b25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBuYXZpZ2F0ZSB0byBndWVzdC1mYWNpbmcgZXZlbnQgcGFnZSB3aGVuIFZpZXcgYnV0dG9uIGlzIGNsaWNrZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEV2ZW50c1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRBbGxCeVRleHQoJ0NlcmVtb255IG9uIHRoZSBCZWFjaCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSwgeyB0aW1lb3V0OiAzMDAwIH0pO1xuXG4gICAgICBjb25zdCB2aWV3QnV0dG9ucyA9IHNjcmVlbi5nZXRBbGxCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL152aWV3JC9pIH0pO1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKHZpZXdCdXR0b25zWzBdKTtcblxuICAgICAgZXhwZWN0KHdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCcvZ3Vlc3QvZXZlbnRzL2V2ZW50LTEnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgY29ycmVjdCBVUkwgZm9yIGVhY2ggZXZlbnQgSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEV2ZW50c1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRBbGxCeVRleHQoJ0NlcmVtb255IG9uIHRoZSBCZWFjaCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSwgeyB0aW1lb3V0OiAzMDAwIH0pO1xuXG4gICAgICAvLyBUZXN0IGZpcnN0IGV2ZW50XG4gICAgICBjb25zdCB2aWV3QnV0dG9ucyA9IHNjcmVlbi5nZXRBbGxCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL152aWV3JC9pIH0pO1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKHZpZXdCdXR0b25zWzBdKTtcbiAgICAgIGV4cGVjdCh3aW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnL2d1ZXN0L2V2ZW50cy9ldmVudC0xJyk7XG5cbiAgICAgIC8vIFJlc2V0IGxvY2F0aW9uXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcnO1xuXG4gICAgICAvLyBUZXN0IHNlY29uZCBldmVudCAoYWNjb3VudGluZyBmb3IgcG9zc2libGUgZHVwbGljYXRlcylcbiAgICAgIGNvbnN0IHNlY29uZEJ1dHRvbkluZGV4ID0gdmlld0J1dHRvbnMubGVuZ3RoID4gMiA/IDIgOiAxO1xuICAgICAgaWYgKHZpZXdCdXR0b25zLmxlbmd0aCA+IHNlY29uZEJ1dHRvbkluZGV4KSB7XG4gICAgICAgIGZpcmVFdmVudC5jbGljayh2aWV3QnV0dG9uc1tzZWNvbmRCdXR0b25JbmRleF0pO1xuICAgICAgICBleHBlY3Qod2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQ29udGFpbignL2d1ZXN0L2V2ZW50cy8nKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHByb3BhZ2F0ZSBjbGljayBldmVudCB0byByb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEV2ZW50c1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRBbGxCeVRleHQoJ0NlcmVtb255IG9uIHRoZSBCZWFjaCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSwgeyB0aW1lb3V0OiAzMDAwIH0pO1xuXG4gICAgICBjb25zdCB2aWV3QnV0dG9ucyA9IHNjcmVlbi5nZXRBbGxCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL152aWV3JC9pIH0pO1xuICAgICAgY29uc3QgY2xpY2tFdmVudCA9IG5ldyBNb3VzZUV2ZW50KCdjbGljaycsIHsgYnViYmxlczogdHJ1ZSB9KTtcbiAgICAgIGNvbnN0IHN0b3BQcm9wYWdhdGlvblNweSA9IGplc3Quc3B5T24oY2xpY2tFdmVudCwgJ3N0b3BQcm9wYWdhdGlvbicpO1xuICAgICAgXG4gICAgICB2aWV3QnV0dG9uc1swXS5kaXNwYXRjaEV2ZW50KGNsaWNrRXZlbnQpO1xuXG4gICAgICBleHBlY3Qoc3RvcFByb3BhZ2F0aW9uU3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdMaW5rIEdlbmVyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBVUkwgd2l0aCAvZ3Vlc3QvZXZlbnRzLyBwcmVmaXgnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXIoPEV2ZW50c1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRBbGxCeVRleHQoJ0NlcmVtb255IG9uIHRoZSBCZWFjaCcpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSwgeyB0aW1lb3V0OiAzMDAwIH0pO1xuXG4gICAgICBjb25zdCB2aWV3QnV0dG9ucyA9IHNjcmVlbi5nZXRBbGxCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL152aWV3JC9pIH0pO1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKHZpZXdCdXR0b25zWzBdKTtcblxuICAgICAgZXhwZWN0KHdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b01hdGNoKC9eXFwvZ3Vlc3RcXC9ldmVudHNcXC8vKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGV2ZW50IElEIGluIFVSTCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJlbmRlcig8RXZlbnRzUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEFsbEJ5VGV4dCgnQ2VyZW1vbnkgb24gdGhlIEJlYWNoJykubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICB9LCB7IHRpbWVvdXQ6IDMwMDAgfSk7XG5cbiAgICAgIGNvbnN0IHZpZXdCdXR0b25zID0gc2NyZWVuLmdldEFsbEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvXnZpZXckL2kgfSk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2sodmlld0J1dHRvbnNbMF0pO1xuXG4gICAgICBleHBlY3Qod2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQ29udGFpbignZXZlbnQtMScpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbImplc3QiLCJtb2NrIiwidXNlUm91dGVyIiwiZm4iLCJ1c2VTZWFyY2hQYXJhbXMiLCJnZXQiLCJnZXRBbGwiLCJoYXMiLCJrZXlzIiwidmFsdWVzIiwiZW50cmllcyIsImZvckVhY2giLCJ0b1N0cmluZyIsInVzZVBhdGhuYW1lIiwiZ2xvYmFsIiwiZmV0Y2giLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJtb2NrVXNlVG9hc3QiLCJ1c2VUb2FzdCIsIm1vY2tVc2VSb3V0ZXIiLCJkZXNjcmliZSIsIm1vY2tBZGRUb2FzdCIsIm1vY2tQdXNoIiwibW9ja0V2ZW50cyIsImlkIiwibmFtZSIsImV2ZW50VHlwZSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJzdGF0dXMiLCJsb2NhdGlvbklkIiwiZGVzY3JpcHRpb24iLCJyc3ZwUmVxdWlyZWQiLCJyc3ZwRGVhZGxpbmUiLCJtb2NrTG9jYXRpb25zIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJtb2NrUmV0dXJuVmFsdWUiLCJhZGRUb2FzdCIsInRvYXN0cyIsInJlbW92ZVRvYXN0IiwicHVzaCIsInJlcGxhY2UiLCJyZWZyZXNoIiwiYmFjayIsImZvcndhcmQiLCJwcmVmZXRjaCIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsInVybCIsImluY2x1ZGVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJvayIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImV2ZW50cyIsInJlamVjdCIsIkVycm9yIiwiaXQiLCJyZW5kZXIiLCJFdmVudHNQYWdlIiwid2FpdEZvciIsImV4cGVjdCIsInNjcmVlbiIsImdldEFsbEJ5VGV4dCIsImxlbmd0aCIsInRvQmVHcmVhdGVyVGhhbiIsInRpbWVvdXQiLCJ2aWV3QnV0dG9ucyIsImdldEFsbEJ5Um9sZSIsImZpcmVFdmVudCIsImNsaWNrIiwidG9CZSIsInNlY29uZEJ1dHRvbkluZGV4IiwidG9Db250YWluIiwiY2xpY2tFdmVudCIsIk1vdXNlRXZlbnQiLCJidWJibGVzIiwic3RvcFByb3BhZ2F0aW9uU3B5Iiwic3B5T24iLCJkaXNwYXRjaEV2ZW50IiwidG9IYXZlQmVlbkNhbGxlZCIsInRvTWF0Y2giXSwibWFwcGluZ3MiOiJBQUFBOzs7OztDQUtDO0FBT0Qsb0JBQW9CO0FBQ3BCQSxLQUFLQyxJQUFJLENBQUM7QUFDVkQsS0FBS0MsSUFBSSxDQUFDLG1CQUFtQixJQUFPLENBQUE7UUFDbENDLFdBQVdGLEtBQUtHLEVBQUU7UUFDbEJDLGlCQUFpQixJQUFPLENBQUE7Z0JBQ3RCQyxLQUFLTCxLQUFLRyxFQUFFO2dCQUNaRyxRQUFRTixLQUFLRyxFQUFFO2dCQUNmSSxLQUFLUCxLQUFLRyxFQUFFO2dCQUNaSyxNQUFNUixLQUFLRyxFQUFFO2dCQUNiTSxRQUFRVCxLQUFLRyxFQUFFO2dCQUNmTyxTQUFTVixLQUFLRyxFQUFFO2dCQUNoQlEsU0FBU1gsS0FBS0csRUFBRTtnQkFDaEJTLFVBQVVaLEtBQUtHLEVBQUU7WUFDbkIsQ0FBQTtRQUNBVSxhQUFhLElBQU07SUFDckIsQ0FBQTs7Ozs7dUJBcEJtRDs2REFDNUI7OEJBQ0U7NEJBQ0M7Ozs7OztBQW1CMUIsYUFBYTtBQUNiQyxPQUFPQyxLQUFLLEdBQUdmLEtBQUtHLEVBQUU7QUFFdEIsdUJBQXVCO0FBQ3ZCLE9BQU8sQUFBQ2EsT0FBZUMsUUFBUTtBQUMvQkQsT0FBT0MsUUFBUSxHQUFHO0lBQUVDLE1BQU07QUFBRztBQUU3QixNQUFNQyxlQUFlQyxzQkFBUTtBQUM3QixNQUFNQyxn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