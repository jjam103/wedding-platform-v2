{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/lib/performanceMonitoring.test.ts"],"sourcesContent":["import {\n  performanceMonitor,\n  measurePerformance,\n  measureApiRequest,\n  measureDbQuery,\n  PERFORMANCE_THRESHOLDS,\n} from './performanceMonitoring';\n\ndescribe('performanceMonitoring', () => {\n  beforeEach(() => {\n    performanceMonitor.clearMetrics();\n    jest.clearAllMocks();\n  });\n\n  describe('performanceMonitor', () => {\n    it('should record metrics', () => {\n      performanceMonitor.recordMetric('test_metric', 100, { foo: 'bar' });\n\n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics).toHaveLength(1);\n      expect(metrics[0]).toMatchObject({\n        name: 'test_metric',\n        value: 100,\n        metadata: { foo: 'bar' },\n      });\n    });\n\n    it('should clear metrics', () => {\n      performanceMonitor.recordMetric('test_metric', 100);\n      expect(performanceMonitor.getMetrics()).toHaveLength(1);\n\n      performanceMonitor.clearMetrics();\n      expect(performanceMonitor.getMetrics()).toHaveLength(0);\n    });\n\n    it('should calculate metrics summary', () => {\n      performanceMonitor.recordMetric('api_call', 100);\n      performanceMonitor.recordMetric('api_call', 200);\n      performanceMonitor.recordMetric('api_call', 300);\n\n      const summary = performanceMonitor.getSummary();\n      expect(summary.api_call).toEqual({\n        count: 3,\n        avg: 200,\n        min: 100,\n        max: 300,\n      });\n    });\n\n    it('should handle multiple metric types', () => {\n      performanceMonitor.recordMetric('api_call', 100);\n      performanceMonitor.recordMetric('db_query', 50);\n      performanceMonitor.recordMetric('api_call', 200);\n\n      const summary = performanceMonitor.getSummary();\n      expect(summary.api_call.count).toBe(2);\n      expect(summary.db_query.count).toBe(1);\n    });\n  });\n\n  describe('measurePerformance', () => {\n    it('should measure synchronous function execution', () => {\n      const result = measurePerformance('sync_test', () => {\n        return 'test result';\n      });\n\n      expect(result).toBe('test result');\n      \n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics).toHaveLength(1);\n      expect(metrics[0].name).toBe('sync_test');\n      expect(metrics[0].value).toBeGreaterThanOrEqual(0);\n    });\n\n    it('should measure asynchronous function execution', async () => {\n      const result = await measurePerformance('async_test', async () => {\n        await new Promise(resolve => setTimeout(resolve, 10));\n        return 'async result';\n      });\n\n      expect(result).toBe('async result');\n      \n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics).toHaveLength(1);\n      expect(metrics[0].name).toBe('async_test');\n      expect(metrics[0].value).toBeGreaterThanOrEqual(10);\n    });\n\n    it('should include metadata in metrics', () => {\n      measurePerformance('test_with_metadata', () => 'result', { userId: '123' });\n\n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics[0].metadata).toEqual({ userId: '123' });\n    });\n  });\n\n  describe('measureApiRequest', () => {\n    it('should measure successful API request', async () => {\n      const mockFetch = jest.fn().mockResolvedValue({ data: 'test' });\n\n      const result = await measureApiRequest('/api/test', mockFetch);\n\n      expect(result).toEqual({ data: 'test' });\n      \n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics).toHaveLength(1);\n      expect(metrics[0].name).toBe('api_response');\n      expect(metrics[0].metadata?.url).toBe('/api/test');\n    });\n\n    it('should measure failed API request', async () => {\n      const mockFetch = jest.fn().mockRejectedValue(new Error('API Error'));\n\n      await expect(measureApiRequest('/api/test', mockFetch)).rejects.toThrow('API Error');\n      \n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics).toHaveLength(1);\n      expect(metrics[0].name).toBe('api_error');\n      expect(metrics[0].metadata?.url).toBe('/api/test');\n    });\n  });\n\n  describe('measureDbQuery', () => {\n    it('should measure successful database query', async () => {\n      const mockQuery = jest.fn().mockResolvedValue([{ id: 1 }]);\n\n      const result = await measureDbQuery('get_users', mockQuery);\n\n      expect(result).toEqual([{ id: 1 }]);\n      \n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics).toHaveLength(1);\n      expect(metrics[0].name).toBe('db_query');\n      expect(metrics[0].metadata?.query).toBe('get_users');\n    });\n\n    it('should measure failed database query', async () => {\n      const mockQuery = jest.fn().mockRejectedValue(new Error('DB Error'));\n\n      await expect(measureDbQuery('get_users', mockQuery)).rejects.toThrow('DB Error');\n      \n      const metrics = performanceMonitor.getMetrics();\n      expect(metrics).toHaveLength(1);\n      expect(metrics[0].name).toBe('db_error');\n      expect(metrics[0].metadata?.query).toBe('get_users');\n    });\n  });\n\n  describe('PERFORMANCE_THRESHOLDS', () => {\n    it('should define all required thresholds', () => {\n      expect(PERFORMANCE_THRESHOLDS.FCP).toBe(1500);\n      expect(PERFORMANCE_THRESHOLDS.LCP).toBe(2500);\n      expect(PERFORMANCE_THRESHOLDS.FID).toBe(100);\n      expect(PERFORMANCE_THRESHOLDS.CLS).toBe(0.1);\n      expect(PERFORMANCE_THRESHOLDS.TTFB).toBe(600);\n      expect(PERFORMANCE_THRESHOLDS.API_RESPONSE).toBe(500);\n      expect(PERFORMANCE_THRESHOLDS.DB_QUERY).toBe(100);\n      expect(PERFORMANCE_THRESHOLDS.INITIAL_BUNDLE).toBe(200 * 1024);\n      expect(PERFORMANCE_THRESHOLDS.TOTAL_PAGE_WEIGHT).toBe(1024 * 1024);\n    });\n  });\n});\n"],"names":["describe","beforeEach","performanceMonitor","clearMetrics","jest","clearAllMocks","it","recordMetric","foo","metrics","getMetrics","expect","toHaveLength","toMatchObject","name","value","metadata","summary","getSummary","api_call","toEqual","count","avg","min","max","toBe","db_query","result","measurePerformance","toBeGreaterThanOrEqual","Promise","resolve","setTimeout","userId","mockFetch","fn","mockResolvedValue","data","measureApiRequest","url","mockRejectedValue","Error","rejects","toThrow","mockQuery","id","measureDbQuery","query","PERFORMANCE_THRESHOLDS","FCP","LCP","FID","CLS","TTFB","API_RESPONSE","DB_QUERY","INITIAL_BUNDLE","TOTAL_PAGE_WEIGHT"],"mappings":"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"}