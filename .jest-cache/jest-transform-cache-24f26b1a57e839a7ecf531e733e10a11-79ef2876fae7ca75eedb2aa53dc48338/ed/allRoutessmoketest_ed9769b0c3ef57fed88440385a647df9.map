{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/smoke/allRoutes.smoke.test.ts"],"sourcesContent":["/**\n * All Routes Smoke Tests\n * \n * Quick validation that all API routes respond without crashing.\n * These tests don't validate business logic, just that:\n * - Routes exist\n * - They return proper HTTP status codes\n * - They don't crash with 500 errors\n * - They return JSON responses\n * \n * Run these tests frequently to catch broken routes early.\n */\n\nimport { startTestServer, stopTestServer, getTestServerUrl } from '../helpers/testServer';\n\n// All API routes in the application\nconst API_ROUTES = {\n  // Admin routes\n  admin: [\n    '/api/admin/locations',\n    '/api/admin/guests',\n    '/api/admin/guest-groups',\n    '/api/admin/events',\n    '/api/admin/activities',\n    '/api/admin/accommodations',\n    '/api/admin/room-types',\n    '/api/admin/vendors',\n    '/api/admin/budget',\n    '/api/admin/photos',\n    '/api/admin/emails',\n    '/api/admin/content-pages',\n    '/api/admin/home-page',\n    '/api/admin/rsvps',\n    '/api/admin/rsvp-analytics',\n    '/api/admin/transportation',\n    '/api/admin/audit-logs',\n    '/api/admin/settings',\n  ],\n  \n  // Guest routes\n  guest: [\n    '/api/guest/rsvp',\n    '/api/guest/profile',\n  ],\n  \n  // Public routes\n  public: [\n    '/api/health',\n  ],\n};\n\ndescribe('Smoke Tests - All API Routes', () => {\n  let serverUrl: string;\n  \n  beforeAll(async () => {\n    serverUrl = await startTestServer();\n  }, 60000);\n  \n  afterAll(async () => {\n    await stopTestServer();\n  }, 10000);\n  \n  describe('Admin Routes', () => {\n    API_ROUTES.admin.forEach(route => {\n      it(`${route} should respond`, async () => {\n        const response = await fetch(`${serverUrl}${route}`);\n        \n        // Should not crash (500 error)\n        expect(response.status).not.toBe(500);\n        \n        // Should return JSON\n        const contentType = response.headers.get('content-type');\n        expect(contentType).toContain('application/json');\n        \n        // Should have proper error structure if not authenticated\n        if (response.status === 401) {\n          const data = await response.json();\n          expect(data.success).toBe(false);\n          expect(data.error).toBeDefined();\n          expect(data.error.code).toBe('UNAUTHORIZED');\n        }\n      });\n    });\n  });\n  \n  describe('Guest Routes', () => {\n    API_ROUTES.guest.forEach(route => {\n      it(`${route} should respond`, async () => {\n        const response = await fetch(`${serverUrl}${route}`);\n        \n        // Should not crash\n        expect(response.status).not.toBe(500);\n        \n        // Should return JSON\n        const contentType = response.headers.get('content-type');\n        expect(contentType).toContain('application/json');\n      });\n    });\n  });\n  \n  describe('Public Routes', () => {\n    API_ROUTES.public.forEach(route => {\n      it(`${route} should respond`, async () => {\n        const response = await fetch(`${serverUrl}${route}`);\n        \n        // Should be accessible\n        expect(response.ok).toBe(true);\n        \n        // Should return JSON\n        const contentType = response.headers.get('content-type');\n        expect(contentType).toContain('application/json');\n      });\n    });\n  });\n  \n  describe('Dynamic Routes', () => {\n    it('should handle dynamic route params', async () => {\n      const dynamicRoutes = [\n        '/api/admin/locations/test-id',\n        '/api/admin/guests/test-id',\n        '/api/admin/events/test-id',\n        '/api/admin/accommodations/test-id/room-types',\n      ];\n      \n      for (const route of dynamicRoutes) {\n        const response = await fetch(`${serverUrl}${route}`);\n        \n        // Should not crash with params error\n        expect(response.status).not.toBe(500);\n        \n        // Should return 401 (auth) or 404 (not found), not 500 (crash)\n        expect([401, 404]).toContain(response.status);\n      }\n    });\n  });\n  \n  describe('HTTP Methods', () => {\n    it('should handle GET requests', async () => {\n      const response = await fetch(`${serverUrl}/api/admin/locations`);\n      expect([200, 401]).toContain(response.status);\n    });\n    \n    it('should handle POST requests', async () => {\n      const response = await fetch(`${serverUrl}/api/admin/locations`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name: 'Test' }),\n      });\n      expect([200, 201, 400, 401]).toContain(response.status);\n    });\n    \n    it('should handle PUT requests', async () => {\n      const response = await fetch(`${serverUrl}/api/admin/locations/test-id`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name: 'Test' }),\n      });\n      expect([200, 400, 401, 404]).toContain(response.status);\n    });\n    \n    it('should handle DELETE requests', async () => {\n      const response = await fetch(`${serverUrl}/api/admin/locations/test-id`, {\n        method: 'DELETE',\n      });\n      expect([200, 401, 404]).toContain(response.status);\n    });\n  });\n  \n  describe('Error Responses', () => {\n    it('should return proper error structure', async () => {\n      const response = await fetch(`${serverUrl}/api/admin/locations`);\n      const data = await response.json();\n      \n      if (!data.success) {\n        expect(data.error).toBeDefined();\n        expect(data.error.code).toBeDefined();\n        expect(data.error.message).toBeDefined();\n        expect(typeof data.error.code).toBe('string');\n        expect(typeof data.error.message).toBe('string');\n      }\n    });\n  });\n});\n\n/**\n * Performance Benchmarks\n * \n * Track response times to catch performance regressions\n */\ndescribe('Smoke Tests - Performance', () => {\n  let serverUrl: string;\n  \n  beforeAll(async () => {\n    serverUrl = await startTestServer();\n  }, 60000);\n  \n  afterAll(async () => {\n    await stopTestServer();\n  }, 10000);\n  \n  it('should respond within reasonable time', async () => {\n    const start = Date.now();\n    await fetch(`${serverUrl}/api/health`);\n    const duration = Date.now() - start;\n    \n    // Should respond within 1 second\n    expect(duration).toBeLessThan(1000);\n  });\n  \n  it('should handle concurrent requests', async () => {\n    const requests = Array(10).fill(null).map(() =>\n      fetch(`${serverUrl}/api/health`)\n    );\n    \n    const responses = await Promise.all(requests);\n    \n    // All should succeed\n    responses.forEach(response => {\n      expect(response.ok).toBe(true);\n    });\n  });\n});\n\n/**\n * NOTE: These are smoke tests, not comprehensive tests.\n * They verify routes exist and respond, but don't test:\n * - Business logic\n * - Data validation\n * - Authentication flows\n * - Database operations\n * \n * For comprehensive testing, see:\n * - Unit tests (business logic)\n * - Integration tests (API + database)\n * - E2E tests (complete workflows)\n */\n"],"names":["API_ROUTES","admin","guest","public","describe","serverUrl","beforeAll","startTestServer","afterAll","stopTestServer","forEach","route","it","response","fetch","expect","status","not","toBe","contentType","headers","get","toContain","data","json","success","error","toBeDefined","code","ok","dynamicRoutes","method","body","JSON","stringify","name","message","start","Date","now","duration","toBeLessThan","requests","Array","fill","map","responses","Promise","all"],"mappings":"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"}