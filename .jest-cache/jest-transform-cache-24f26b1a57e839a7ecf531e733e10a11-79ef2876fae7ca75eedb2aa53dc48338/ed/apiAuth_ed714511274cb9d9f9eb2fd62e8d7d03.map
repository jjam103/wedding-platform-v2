{"version":3,"names":["createApiClient","cov_1jvj7hk24y","f","s","getAuthenticatedUser","getAuthorizedAdmin","cookieStore","_headers","cookies","_ssr","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","getAll","setAll","cookiesToSet","forEach","name","value","options","set","supabase","data","user","error","auth","getUser","b","userData","from","select","eq","id","single","includes","role"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/lib/apiAuth.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\nimport type { SupabaseClient } from '@supabase/supabase-js';\n\n/**\n * Creates a Supabase client for API routes with proper cookie handling\n */\nexport async function createApiClient(): Promise<SupabaseClient> {\n  const cookieStore = await cookies();\n  \n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value, options }) => {\n            cookieStore.set(name, value, options);\n          });\n        },\n      },\n    }\n  );\n}\n\n/**\n * Verifies user authentication and returns user object\n * Returns null if not authenticated\n */\nexport async function getAuthenticatedUser() {\n  const supabase = await createApiClient();\n  const { data: { user }, error } = await supabase.auth.getUser();\n  \n  if (error || !user) {\n    return null;\n  }\n  \n  return { user, supabase };\n}\n\n/**\n * Verifies user has admin/host role\n * Returns null if not authorized\n */\nexport async function getAuthorizedAdmin() {\n  const auth = await getAuthenticatedUser();\n  if (!auth) return null;\n  \n  const { user, supabase } = auth;\n  \n  const { data: userData, error } = await supabase\n    .from('users')\n    .select('role')\n    .eq('id', user.id)\n    .single();\n  \n  if (error || !userData || !['super_admin', 'host'].includes(userData.role)) {\n    return null;\n  }\n  \n  return { user, supabase, role: userData.role };\n}\n"],"mappings":"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","ignoreList":[]}