{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/lib/performanceMonitoring.ts"],"sourcesContent":["/**\n * Performance Monitoring Configuration\n * \n * Configures performance monitoring with Vercel Analytics and custom logging.\n * Requirements: 19.1, 19.2\n */\n\n// Performance metrics interface\nexport interface PerformanceMetric {\n  name: string;\n  value: number;\n  timestamp: number;\n  metadata?: Record<string, any>;\n}\n\n// Performance thresholds\nexport const PERFORMANCE_THRESHOLDS = {\n  // Page load metrics (Core Web Vitals)\n  FCP: 1500, // First Contentful Paint (ms)\n  LCP: 2500, // Largest Contentful Paint (ms)\n  FID: 100, // First Input Delay (ms)\n  CLS: 0.1, // Cumulative Layout Shift (score)\n  TTFB: 600, // Time to First Byte (ms)\n  \n  // API response times (p95)\n  API_RESPONSE: 500, // ms\n  \n  // Database query times (p95)\n  DB_QUERY: 100, // ms\n  \n  // Bundle sizes\n  INITIAL_BUNDLE: 200 * 1024, // 200KB\n  TOTAL_PAGE_WEIGHT: 1024 * 1024, // 1MB\n} as const;\n\n// Performance monitoring class\nclass PerformanceMonitor {\n  private metrics: PerformanceMetric[] = [];\n  private isEnabled: boolean;\n\n  constructor() {\n    this.isEnabled = typeof window !== 'undefined' && process.env.NODE_ENV === 'production';\n  }\n\n  /**\n   * Record a performance metric\n   */\n  recordMetric(name: string, value: number, metadata?: Record<string, any>): void {\n    if (!this.isEnabled) return;\n\n    const metric: PerformanceMetric = {\n      name,\n      value,\n      timestamp: Date.now(),\n      metadata,\n    };\n\n    this.metrics.push(metric);\n\n    // Send to analytics if available\n    if (typeof window !== 'undefined' && (window as any).va) {\n      (window as any).va('track', name, { value, ...metadata });\n    }\n\n    // Log to console in development\n    if (process.env.NODE_ENV === 'development') {\n      console.log(`[Performance] ${name}: ${value}ms`, metadata);\n    }\n\n    // Check against thresholds\n    this.checkThreshold(name, value);\n  }\n\n  /**\n   * Check if metric exceeds threshold\n   */\n  private checkThreshold(name: string, value: number): void {\n    const thresholdKey = name.toUpperCase().replace(/[^A-Z_]/g, '_') as keyof typeof PERFORMANCE_THRESHOLDS;\n    const threshold = PERFORMANCE_THRESHOLDS[thresholdKey];\n\n    if (threshold && value > threshold) {\n      console.warn(`[Performance] ${name} exceeded threshold: ${value} > ${threshold}`);\n      \n      // Send alert if configured\n      this.sendAlert(name, value, threshold);\n    }\n  }\n\n  /**\n   * Send performance alert\n   */\n  private sendAlert(name: string, value: number, threshold: number): void {\n    // In production, this would send to monitoring service\n    if (process.env.NODE_ENV === 'production') {\n      // Send to Sentry or other monitoring service\n      if (typeof window !== 'undefined' && (window as any).Sentry) {\n        (window as any).Sentry.captureMessage(`Performance threshold exceeded: ${name}`, {\n          level: 'warning',\n          extra: { value, threshold },\n        });\n      }\n    }\n  }\n\n  /**\n   * Get all recorded metrics\n   */\n  getMetrics(): PerformanceMetric[] {\n    return [...this.metrics];\n  }\n\n  /**\n   * Clear all metrics\n   */\n  clearMetrics(): void {\n    this.metrics = [];\n  }\n\n  /**\n   * Get metrics summary\n   */\n  getSummary(): Record<string, { count: number; avg: number; min: number; max: number }> {\n    const summary: Record<string, { count: number; avg: number; min: number; max: number }> = {};\n\n    this.metrics.forEach(metric => {\n      if (!summary[metric.name]) {\n        summary[metric.name] = {\n          count: 0,\n          avg: 0,\n          min: Infinity,\n          max: -Infinity,\n        };\n      }\n\n      const s = summary[metric.name];\n      s.count++;\n      s.avg = (s.avg * (s.count - 1) + metric.value) / s.count;\n      s.min = Math.min(s.min, metric.value);\n      s.max = Math.max(s.max, metric.value);\n    });\n\n    return summary;\n  }\n}\n\n// Singleton instance\nexport const performanceMonitor = new PerformanceMonitor();\n\n/**\n * Measure function execution time\n */\nexport function measurePerformance<T>(\n  name: string,\n  fn: () => T | Promise<T>,\n  metadata?: Record<string, any>\n): T | Promise<T> {\n  const start = performance.now();\n\n  const result = fn();\n\n  if (result instanceof Promise) {\n    return result.then(value => {\n      const duration = performance.now() - start;\n      performanceMonitor.recordMetric(name, duration, metadata);\n      return value;\n    });\n  }\n\n  const duration = performance.now() - start;\n  performanceMonitor.recordMetric(name, duration, metadata);\n  return result;\n}\n\n/**\n * Measure API request performance\n */\nexport async function measureApiRequest<T>(\n  url: string,\n  fetchFn: () => Promise<T>\n): Promise<T> {\n  const start = performance.now();\n\n  try {\n    const result = await fetchFn();\n    const duration = performance.now() - start;\n    \n    performanceMonitor.recordMetric('api_response', duration, { url });\n    \n    return result;\n  } catch (error) {\n    const duration = performance.now() - start;\n    performanceMonitor.recordMetric('api_error', duration, { url, error: String(error) });\n    throw error;\n  }\n}\n\n/**\n * Measure database query performance\n */\nexport async function measureDbQuery<T>(\n  queryName: string,\n  queryFn: () => Promise<T>\n): Promise<T> {\n  const start = performance.now();\n\n  try {\n    const result = await queryFn();\n    const duration = performance.now() - start;\n    \n    performanceMonitor.recordMetric('db_query', duration, { query: queryName });\n    \n    return result;\n  } catch (error) {\n    const duration = performance.now() - start;\n    performanceMonitor.recordMetric('db_error', duration, { query: queryName, error: String(error) });\n    throw error;\n  }\n}\n\n/**\n * Report Web Vitals to analytics\n */\nexport function reportWebVitals(metric: any): void {\n  if (typeof window === 'undefined') return;\n\n  const { name, value, id } = metric;\n\n  // Record in our monitoring system\n  performanceMonitor.recordMetric(name.toLowerCase(), value, { id });\n\n  // Send to Vercel Analytics if available\n  if ((window as any).va) {\n    (window as any).va('track', name, { value, id });\n  }\n\n  // Log in development\n  if (process.env.NODE_ENV === 'development') {\n    console.log(`[Web Vitals] ${name}: ${value}`, { id });\n  }\n}\n\n/**\n * Initialize performance monitoring\n */\nexport function initPerformanceMonitoring(): void {\n  if (typeof window === 'undefined') return;\n\n  // Monitor page load performance\n  if ('PerformanceObserver' in window) {\n    // Monitor navigation timing\n    const navObserver = new PerformanceObserver((list) => {\n      for (const entry of list.getEntries()) {\n        if (entry.entryType === 'navigation') {\n          const navEntry = entry as PerformanceNavigationTiming;\n          \n          performanceMonitor.recordMetric('ttfb', navEntry.responseStart - navEntry.requestStart);\n          performanceMonitor.recordMetric('dom_content_loaded', navEntry.domContentLoadedEventEnd - navEntry.domContentLoadedEventStart);\n          performanceMonitor.recordMetric('load_complete', navEntry.loadEventEnd - navEntry.loadEventStart);\n        }\n      }\n    });\n\n    navObserver.observe({ entryTypes: ['navigation'] });\n\n    // Monitor resource timing\n    const resourceObserver = new PerformanceObserver((list) => {\n      for (const entry of list.getEntries()) {\n        if (entry.entryType === 'resource') {\n          const resourceEntry = entry as PerformanceResourceTiming;\n          \n          performanceMonitor.recordMetric('resource_load', resourceEntry.duration, {\n            name: resourceEntry.name,\n            type: resourceEntry.initiatorType,\n          });\n        }\n      }\n    });\n\n    resourceObserver.observe({ entryTypes: ['resource'] });\n  }\n\n  // Log initialization\n  console.log('[Performance Monitoring] Initialized');\n}\n\n// Auto-initialize in browser\nif (typeof window !== 'undefined') {\n  initPerformanceMonitoring();\n}\n"],"names":["PERFORMANCE_THRESHOLDS","initPerformanceMonitoring","measureApiRequest","measureDbQuery","measurePerformance","performanceMonitor","reportWebVitals","FCP","LCP","FID","CLS","TTFB","API_RESPONSE","DB_QUERY","INITIAL_BUNDLE","TOTAL_PAGE_WEIGHT","PerformanceMonitor","metrics","isEnabled","window","process","env","NODE_ENV","recordMetric","name","value","metadata","metric","timestamp","Date","now","push","va","console","log","checkThreshold","thresholdKey","toUpperCase","replace","threshold","warn","sendAlert","Sentry","captureMessage","level","extra","getMetrics","clearMetrics","getSummary","summary","forEach","count","avg","min","Infinity","max","s","Math","fn","start","performance","result","Promise","then","duration","url","fetchFn","error","String","queryName","queryFn","query","id","toLowerCase","navObserver","PerformanceObserver","list","entry","getEntries","entryType","navEntry","responseStart","requestStart","domContentLoadedEventEnd","domContentLoadedEventStart","loadEventEnd","loadEventStart","observe","entryTypes","resourceObserver","resourceEntry","type","initiatorType"],"mappings":"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"}