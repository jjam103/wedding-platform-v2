{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/mocks/serviceDetector.ts"],"sourcesContent":["/**\n * Service Detector for E2E Testing\n * \n * This module detects the test environment and automatically switches between\n * real and mock external services. This prevents real API calls during E2E tests\n * while allowing the application to use real services in production.\n */\n\n/**\n * Determines if the application is running in E2E test mode\n */\nexport function isE2ETestMode(): boolean {\n  // Check multiple indicators of E2E test environment\n  const indicators = [\n    process.env.NODE_ENV === 'test',\n    process.env.E2E_TEST === 'true',\n    process.env.PLAYWRIGHT_TEST === 'true',\n    // Check if running with Playwright web server\n    process.env.PLAYWRIGHT === '1',\n    // Check for test database URL\n    process.env.NEXT_PUBLIC_SUPABASE_URL?.includes('test'),\n  ];\n\n  return indicators.some((indicator) => indicator === true);\n}\n\n/**\n * Determines if mock services should be used\n */\nexport function shouldUseMockServices(): boolean {\n  // Explicit override to use mocks\n  if (process.env.USE_MOCK_SERVICES === 'true') {\n    return true;\n  }\n\n  // Explicit override to use real services\n  if (process.env.USE_MOCK_SERVICES === 'false') {\n    return false;\n  }\n\n  // Default: use mocks in E2E test mode\n  return isE2ETestMode();\n}\n\n/**\n * Logs service detection decision\n */\nexport function logServiceDetection(serviceName: string, useMock: boolean): void {\n  if (useMock) {\n    console.log(`üß™ [SERVICE DETECTOR] Using MOCK ${serviceName} service (E2E test mode)`);\n  } else {\n    console.log(`üîå [SERVICE DETECTOR] Using REAL ${serviceName} service (production mode)`);\n  }\n}\n\n/**\n * Gets the appropriate B2 service based on environment\n */\nexport async function getB2Service() {\n  const useMock = shouldUseMockServices();\n  logServiceDetection('B2', useMock);\n\n  if (useMock) {\n    return await import('./mockB2Service');\n  } else {\n    return await import('@/services/b2Service');\n  }\n}\n\n/**\n * Gets the appropriate Resend client based on environment\n */\nexport async function getResendClient() {\n  const useMock = shouldUseMockServices();\n  logServiceDetection('Resend', useMock);\n\n  if (useMock) {\n    const { MockResend } = await import('./mockResendService');\n    return new MockResend();\n  } else {\n    const { Resend } = await import('resend');\n    return new Resend(process.env.RESEND_API_KEY);\n  }\n}\n\n/**\n * Gets the appropriate Twilio client based on environment\n */\nexport async function getTwilioClient() {\n  const useMock = shouldUseMockServices();\n  logServiceDetection('Twilio', useMock);\n\n  if (useMock) {\n    const { mockTwilio } = await import('./mockTwilioService');\n    return mockTwilio('test-account-sid', 'test-auth-token');\n  } else {\n    const twilio = (await import('twilio')).default;\n    return twilio(\n      process.env.TWILIO_ACCOUNT_SID!,\n      process.env.TWILIO_AUTH_TOKEN!\n    );\n  }\n}\n\n/**\n * Gets the appropriate Gemini AI client based on environment\n */\nexport async function getGeminiClient() {\n  const useMock = shouldUseMockServices();\n  logServiceDetection('Gemini AI', useMock);\n\n  if (useMock) {\n    const { MockGoogleGenerativeAI } = await import('./mockGeminiService');\n    return new MockGoogleGenerativeAI('test-gemini-key');\n  } else {\n    const { GoogleGenerativeAI } = await import('@google/generative-ai');\n    return new GoogleGenerativeAI(process.env.GEMINI_API_KEY!);\n  }\n}\n\n/**\n * Environment detection summary\n */\nexport function getEnvironmentSummary() {\n  return {\n    nodeEnv: process.env.NODE_ENV,\n    isE2ETest: isE2ETestMode(),\n    useMockServices: shouldUseMockServices(),\n    indicators: {\n      e2eTest: process.env.E2E_TEST,\n      playwrightTest: process.env.PLAYWRIGHT_TEST,\n      playwright: process.env.PLAYWRIGHT,\n      testDatabase: process.env.NEXT_PUBLIC_SUPABASE_URL?.includes('test'),\n    },\n  };\n}\n\n/**\n * Validates that mock services are being used in test environment\n */\nexport function validateTestEnvironment(): void {\n  if (isE2ETestMode() && !shouldUseMockServices()) {\n    console.warn(\n      '‚ö†Ô∏è  [SERVICE DETECTOR] Running in E2E test mode but mock services are disabled. ' +\n      'This may result in real API calls during tests!'\n    );\n  }\n}\n\n/**\n * Resets all mock services (for test cleanup)\n */\nexport async function resetAllMockServices(): Promise<void> {\n  if (!shouldUseMockServices()) {\n    return;\n  }\n\n  console.log('üß™ [SERVICE DETECTOR] Resetting all mock services...');\n\n  try {\n    const [mockB2, mockResend, mockTwilio, mockGemini] = await Promise.all([\n      import('./mockB2Service'),\n      import('./mockResendService'),\n      import('./mockTwilioService'),\n      import('./mockGeminiService'),\n    ]);\n\n    mockB2.resetB2Client();\n    mockResend.resetMockResend();\n    mockTwilio.resetMockTwilio();\n    mockGemini.resetMockGemini();\n\n    console.log('‚úÖ [SERVICE DETECTOR] All mock services reset');\n  } catch (error) {\n    console.error('‚ùå [SERVICE DETECTOR] Failed to reset mock services:', error);\n  }\n}\n"],"names":["getB2Service","getEnvironmentSummary","getGeminiClient","getResendClient","getTwilioClient","isE2ETestMode","logServiceDetection","resetAllMockServices","shouldUseMockServices","validateTestEnvironment","indicators","process","env","NODE_ENV","E2E_TEST","PLAYWRIGHT_TEST","PLAYWRIGHT","NEXT_PUBLIC_SUPABASE_URL","includes","some","indicator","USE_MOCK_SERVICES","serviceName","useMock","console","log","MockResend","Resend","RESEND_API_KEY","mockTwilio","twilio","default","TWILIO_ACCOUNT_SID","TWILIO_AUTH_TOKEN","MockGoogleGenerativeAI","GoogleGenerativeAI","GEMINI_API_KEY","nodeEnv","isE2ETest","useMockServices","e2eTest","playwrightTest","playwright","testDatabase","warn","mockB2","mockResend","mockGemini","Promise","all","resetB2Client","resetMockResend","resetMockTwilio","resetMockGemini","error"],"mappings":"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"}