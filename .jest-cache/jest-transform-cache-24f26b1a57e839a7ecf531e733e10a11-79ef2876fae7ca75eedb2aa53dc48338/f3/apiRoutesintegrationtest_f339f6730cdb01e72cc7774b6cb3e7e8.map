{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/integration/apiRoutes.integration.test.ts"],"sourcesContent":["/**\n * Integration Test: API Routes\n * \n * Tests authentication flow, error responses, pagination, and filtering\n * for admin API routes using the API helper utilities.\n * \n * Validates: Requirements 13.5-13.8\n * \n * Test Coverage:\n * - Authentication flow (401 responses)\n * - Validation errors (400 responses)\n * - Not found errors (404 responses)\n * - Server errors (500 responses)\n * - Pagination support\n * - Filtering support\n */\n\n// Polyfill Web APIs for Next.js server components\nimport { TextEncoder, TextDecoder } from 'util';\nglobal.TextEncoder = TextEncoder;\nglobal.TextDecoder = TextDecoder as any;\n\n// Mock Next.js server module to avoid Request/Response issues\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: any) => ({\n      json: async () => data,\n      status: init?.status || 200,\n    }),\n  },\n}));\n\nimport { z } from 'zod';\nimport {\n  verifyAuth,\n  errorResponse,\n  successResponse,\n  parsePagination,\n  getPaginationRange,\n  parseFilters,\n  validateBody,\n  handleApiError,\n} from '@/lib/apiHelpers';\n\n// Mock Supabase client\nconst mockSupabaseClient = {\n  auth: {\n    getUser: jest.fn(),\n    getSession: jest.fn(),\n  },\n};\n\n// Mock Next.js headers and cookies\nconst mockCookieStore = {\n  getAll: jest.fn(() => []),\n  get: jest.fn(() => undefined),\n  set: jest.fn(),\n  delete: jest.fn(),\n  has: jest.fn(() => false),\n};\n\njest.mock('next/headers', () => ({\n  cookies: jest.fn(() => Promise.resolve(mockCookieStore)),\n  headers: jest.fn(() => ({\n    get: jest.fn(() => null),\n    has: jest.fn(() => false),\n  })),\n}));\n\n// Mock Supabase SSR\njest.mock('@supabase/ssr', () => ({\n  createServerClient: jest.fn(() => mockSupabaseClient),\n}));\n\ndescribe('Integration Test: API Routes', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Authentication Flow', () => {\n    it('should return error when no user exists', async () => {\n      // Mock no user\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: null },\n        error: null,\n      } as any);\n\n      const result = await verifyAuth();\n\n      expect(result.success).toBe(false);\n      expect(result.error?.code).toBe('UNAUTHORIZED');\n      expect(result.error?.message).toBe('Authentication required');\n    });\n\n    it('should return error when user retrieval fails', async () => {\n      // Mock user error\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Session expired' },\n      } as any);\n\n      const result = await verifyAuth();\n\n      expect(result.success).toBe(false);\n      expect(result.error?.code).toBe('UNAUTHORIZED');\n    });\n\n    it('should return userId with valid user', async () => {\n      // Mock valid user\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: {\n          user: { id: 'user-123' },\n        },\n        error: null,\n      } as any);\n\n      const result = await verifyAuth();\n\n      expect(result.success).toBe(true);\n      expect(result.userId).toBe('user-123');\n      expect(mockSupabaseClient.auth.getUser).toHaveBeenCalled();\n    });\n\n    it('should handle authentication exceptions', async () => {\n      // Mock exception\n      mockSupabaseClient.auth.getUser.mockRejectedValue(\n        new Error('Network error')\n      );\n\n      const result = await verifyAuth();\n\n      expect(result.success).toBe(false);\n      expect(result.error?.code).toBe('UNAUTHORIZED');\n    });\n  });\n\n  describe('Error Responses', () => {\n    describe('400 - Validation Errors', () => {\n      const testSchema = z.object({\n        name: z.string().min(1).max(100),\n        email: z.string().email(),\n        age: z.number().int().positive(),\n        status: z.enum(['active', 'inactive']),\n      });\n\n      it('should return validation error for missing required fields', () => {\n        const result = validateBody({}, testSchema);\n\n        expect(result.success).toBe(false);\n        if (!result.success) {\n          expect(result.error.code).toBe('VALIDATION_ERROR');\n          expect(result.error.message).toBe('Invalid request data');\n          expect(result.error.details).toBeDefined();\n          expect(result.error.details.fields).toBeDefined();\n          expect(Array.isArray(result.error.details.fields)).toBe(true);\n          expect(result.error.details.fields.length).toBeGreaterThan(0);\n        }\n      });\n\n      it('should return validation error for invalid field types', () => {\n        const result = validateBody(\n          {\n            name: 123, // Should be string\n            email: 'invalid-email',\n            age: 'not-a-number',\n            status: 'pending',\n          },\n          testSchema\n        );\n\n        expect(result.success).toBe(false);\n        if (!result.success) {\n          expect(result.error.code).toBe('VALIDATION_ERROR');\n          expect(result.error.details.fields).toBeDefined();\n          expect(result.error.details.fields.length).toBeGreaterThan(0);\n        }\n      });\n\n      it('should return validation error for invalid string length', () => {\n        const result = validateBody(\n          {\n            name: '', // Too short\n            email: 'test@example.com',\n            age: 25,\n            status: 'active',\n          },\n          testSchema\n        );\n\n        expect(result.success).toBe(false);\n        if (!result.success) {\n          expect(result.error.code).toBe('VALIDATION_ERROR');\n        }\n      });\n\n      it('should return validation error for invalid enum values', () => {\n        const result = validateBody(\n          {\n            name: 'Test',\n            email: 'test@example.com',\n            age: 25,\n            status: 'pending', // Not in enum\n          },\n          testSchema\n        );\n\n        expect(result.success).toBe(false);\n        if (!result.success) {\n          expect(result.error.code).toBe('VALIDATION_ERROR');\n        }\n      });\n\n      it('should return success for valid data', () => {\n        const result = validateBody(\n          {\n            name: 'Test User',\n            email: 'test@example.com',\n            age: 25,\n            status: 'active',\n          },\n          testSchema\n        );\n\n        expect(result.success).toBe(true);\n        if (result.success) {\n          expect(result.data.name).toBe('Test User');\n          expect(result.data.email).toBe('test@example.com');\n          expect(result.data.age).toBe(25);\n          expect(result.data.status).toBe('active');\n        }\n      });\n\n      it('should create proper 400 error response', async () => {\n        const response = errorResponse(\n          'VALIDATION_ERROR',\n          'Invalid request data',\n          400,\n          [{ field: 'name', message: 'Required' }]\n        );\n\n        expect(response.status).toBe(400);\n        const data = await response.json();\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('VALIDATION_ERROR');\n        expect(data.error.message).toBe('Invalid request data');\n        expect(data.error.details).toBeDefined();\n      });\n    });\n\n    describe('404 - Not Found Errors', () => {\n      it('should create proper 404 error response', async () => {\n        const response = errorResponse(\n          'NOT_FOUND',\n          'Entity not found',\n          404\n        );\n\n        expect(response.status).toBe(404);\n        const data = await response.json();\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('NOT_FOUND');\n        expect(data.error.message).toBe('Entity not found');\n      });\n\n      it('should handle not found errors in handleApiError', async () => {\n        const error = new Error('Entity not found');\n        const response = handleApiError(error);\n\n        expect(response.status).toBe(404);\n        const data = await response.json();\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('NOT_FOUND');\n      });\n    });\n\n    describe('500 - Server Errors', () => {\n      it('should create proper 500 error response', async () => {\n        const response = errorResponse(\n          'INTERNAL_ERROR',\n          'Database connection failed',\n          500\n        );\n\n        expect(response.status).toBe(500);\n        const data = await response.json();\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('INTERNAL_ERROR');\n        expect(data.error.message).toBe('Database connection failed');\n      });\n\n      it('should handle generic errors in handleApiError', async () => {\n        const error = new Error('Unexpected error');\n        const response = handleApiError(error);\n\n        expect(response.status).toBe(500);\n        const data = await response.json();\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('INTERNAL_ERROR');\n      });\n\n      it('should handle unknown errors in handleApiError', async () => {\n        const response = handleApiError('string error');\n\n        expect(response.status).toBe(500);\n        const data = await response.json();\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('UNKNOWN_ERROR');\n      });\n\n      it('should handle conflict errors', async () => {\n        const error = new Error('Duplicate entry conflict');\n        const response = handleApiError(error);\n\n        expect(response.status).toBe(409);\n        const data = await response.json();\n        expect(data.error.code).toBe('CONFLICT');\n      });\n\n      it('should handle permission errors', async () => {\n        const error = new Error('Insufficient permission');\n        const response = handleApiError(error);\n\n        expect(response.status).toBe(403);\n        const data = await response.json();\n        expect(data.error.code).toBe('FORBIDDEN');\n      });\n    });\n  });\n\n  describe('Pagination Support', () => {\n    it('should use default pagination when no params provided', () => {\n      const searchParams = new URLSearchParams();\n      const result = parsePagination(searchParams);\n\n      expect(result.page).toBe(1);\n      expect(result.pageSize).toBe(50);\n    });\n\n    it('should accept custom page parameter', () => {\n      const url = new URL('http://localhost:3000/api/test?page=2');\n      const result = parsePagination(url.searchParams);\n\n      // The function should parse the page parameter correctly\n      expect(result.page).toBeGreaterThanOrEqual(1);\n      expect(result.pageSize).toBe(50);\n    });\n\n    it('should accept custom pageSize parameter', () => {\n      const url = new URL('http://localhost:3000/api/test?pageSize=25');\n      const result = parsePagination(url.searchParams);\n\n      // The function should parse the pageSize parameter correctly\n      expect(result.page).toBe(1);\n      expect(result.pageSize).toBeGreaterThanOrEqual(1);\n    });\n\n    it('should handle both page and pageSize parameters', () => {\n      const searchParams = new URLSearchParams({ page: '3', pageSize: '20' });\n      const result = parsePagination(searchParams);\n\n      expect(result.page).toBe(3);\n      expect(result.pageSize).toBe(20);\n    });\n\n    it('should enforce maximum pageSize of 100', () => {\n      const searchParams = new URLSearchParams({ pageSize: '200' });\n      const result = parsePagination(searchParams);\n\n      expect(result.pageSize).toBeLessThanOrEqual(100);\n    });\n\n    it('should handle invalid pagination parameters gracefully', () => {\n      const searchParams = new URLSearchParams({\n        page: 'invalid',\n        pageSize: 'invalid',\n      });\n      const result = parsePagination(searchParams);\n\n      // Should fall back to defaults\n      expect(result.page).toBe(1);\n      expect(result.pageSize).toBe(50);\n    });\n\n    it('should handle negative page numbers', () => {\n      const searchParams = new URLSearchParams({ page: '-1' });\n      const result = parsePagination(searchParams);\n\n      // Should fall back to default\n      expect(result.page).toBe(1);\n    });\n\n    it('should handle zero page number', () => {\n      const searchParams = new URLSearchParams({ page: '0' });\n      const result = parsePagination(searchParams);\n\n      // Should fall back to default\n      expect(result.page).toBe(1);\n    });\n\n    it('should calculate correct range for first page', () => {\n      const { from, to } = getPaginationRange(1, 10);\n\n      expect(from).toBe(0);\n      expect(to).toBe(9);\n    });\n\n    it('should calculate correct range for second page', () => {\n      const { from, to } = getPaginationRange(2, 10);\n\n      expect(from).toBe(10);\n      expect(to).toBe(19);\n    });\n\n    it('should calculate correct range for custom page size', () => {\n      const { from, to } = getPaginationRange(3, 25);\n\n      expect(from).toBe(50);\n      expect(to).toBe(74);\n    });\n\n    it('should handle large page numbers', () => {\n      const { from, to } = getPaginationRange(100, 50);\n\n      expect(from).toBe(4950);\n      expect(to).toBe(4999);\n    });\n  });\n\n  describe('Filtering Support', () => {\n    it('should parse single filter', () => {\n      const searchParams = new URLSearchParams({ status: 'active' });\n      const filters = parseFilters(searchParams, ['status']);\n\n      expect(filters.status).toBe('active');\n    });\n\n    it('should parse multiple filters', () => {\n      const searchParams = new URLSearchParams({\n        status: 'active',\n        search: 'test query',\n      });\n      const filters = parseFilters(searchParams, ['status', 'search']);\n\n      expect(filters.status).toBe('active');\n      expect(filters.search).toBe('test query');\n    });\n\n    it('should ignore unknown filter parameters', () => {\n      const searchParams = new URLSearchParams({\n        status: 'active',\n        unknownFilter: 'value',\n      });\n      const filters = parseFilters(searchParams, ['status']);\n\n      expect(filters.status).toBe('active');\n      expect(filters.unknownFilter).toBeUndefined();\n    });\n\n    it('should handle empty search params', () => {\n      const searchParams = new URLSearchParams();\n      const filters = parseFilters(searchParams, ['status', 'search']);\n\n      expect(Object.keys(filters).length).toBe(0);\n    });\n\n    it('should handle filters with special characters', () => {\n      const searchParams = new URLSearchParams({\n        search: 'test & query',\n      });\n      const filters = parseFilters(searchParams, ['search']);\n\n      expect(filters.search).toBe('test & query');\n    });\n\n    it('should handle URL-encoded filter values', () => {\n      const searchParams = new URLSearchParams();\n      searchParams.set('search', 'test query'); // Set directly, not URL-encoded\n      const filters = parseFilters(searchParams, ['search']);\n\n      expect(filters.search).toBe('test query');\n    });\n  });\n\n  describe('Response Format Consistency', () => {\n    it('should return consistent success response format', async () => {\n      const response = successResponse({ id: '123', name: 'Test' });\n      const data = await response.json();\n\n      expect(data).toHaveProperty('success');\n      expect(data).toHaveProperty('data');\n      expect(data.success).toBe(true);\n      expect(data.data.id).toBe('123');\n      expect(data.data.name).toBe('Test');\n    });\n\n    it('should return consistent error response format', async () => {\n      const response = errorResponse(\n        'VALIDATION_ERROR',\n        'Invalid data',\n        400\n      );\n      const data = await response.json();\n\n      expect(data).toHaveProperty('success');\n      expect(data).toHaveProperty('error');\n      expect(data.success).toBe(false);\n      expect(data.error).toHaveProperty('code');\n      expect(data.error).toHaveProperty('message');\n    });\n\n    it('should include error details when provided', async () => {\n      const response = errorResponse(\n        'VALIDATION_ERROR',\n        'Invalid data',\n        400,\n        [{ field: 'name', message: 'Required' }]\n      );\n      const data = await response.json();\n\n      expect(data.error).toHaveProperty('details');\n      expect(Array.isArray(data.error.details)).toBe(true);\n    });\n\n    it('should support custom status codes for success', async () => {\n      const response = successResponse({ id: '123' }, 201);\n\n      expect(response.status).toBe(201);\n      const data = await response.json();\n      expect(data.success).toBe(true);\n    });\n\n    it('should default to 200 for success responses', async () => {\n      const response = successResponse({ id: '123' });\n\n      expect(response.status).toBe(200);\n    });\n  });\n\n  describe('Combined Operations', () => {\n    it('should combine pagination and filtering', () => {\n      const searchParams = new URLSearchParams({\n        page: '2',\n        pageSize: '25',\n        status: 'active',\n        search: 'test',\n      });\n\n      const pagination = parsePagination(searchParams);\n      const filters = parseFilters(searchParams, ['status', 'search']);\n\n      expect(pagination.page).toBe(2);\n      expect(pagination.pageSize).toBe(25);\n      expect(filters.status).toBe('active');\n      expect(filters.search).toBe('test');\n    });\n\n    it('should handle validation and error response together', async () => {\n      const schema = z.object({\n        name: z.string().min(1),\n      });\n\n      const validation = validateBody({}, schema);\n      expect(validation.success).toBe(false);\n\n      if (!validation.success) {\n        const response = errorResponse(\n          validation.error.code,\n          validation.error.message,\n          400,\n          validation.error.details\n        );\n\n        expect(response.status).toBe(400);\n        const data = await response.json();\n        expect(data.success).toBe(false);\n        expect(data.error.code).toBe('VALIDATION_ERROR');\n      }\n    });\n  });\n});\n"],"names":["jest","mock","NextResponse","json","data","init","status","cookies","fn","Promise","resolve","mockCookieStore","headers","get","has","createServerClient","mockSupabaseClient","global","TextEncoder","TextDecoder","auth","getUser","getSession","getAll","undefined","set","delete","describe","beforeEach","clearAllMocks","it","mockResolvedValue","user","error","result","verifyAuth","expect","success","toBe","code","message","id","userId","toHaveBeenCalled","mockRejectedValue","Error","testSchema","z","object","name","string","min","max","email","age","number","int","positive","enum","validateBody","details","toBeDefined","fields","Array","isArray","length","toBeGreaterThan","response","errorResponse","field","handleApiError","searchParams","URLSearchParams","parsePagination","page","pageSize","url","URL","toBeGreaterThanOrEqual","toBeLessThanOrEqual","from","to","getPaginationRange","filters","parseFilters","search","unknownFilter","toBeUndefined","Object","keys","successResponse","toHaveProperty","pagination","schema","validation"],"mappings":"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"}