{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/admin/photos/page.tsx"],"sourcesContent":["'use client';\n\nexport const dynamic = 'force-dynamic';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { createClient } from '@supabase/supabase-js';\nimport { AdminLayout } from '@/components/admin/AdminLayout';\nimport { Toast } from '@/components/ui/Toast';\nimport { GridSkeleton } from '@/components/ui/SkeletonLoaders';\n\ninterface Photo {\n  id: string;\n  uploader_id: string;\n  photo_url: string;\n  storage_type: 'b2' | 'supabase';\n  page_type: 'event' | 'activity' | 'accommodation' | 'memory';\n  page_id?: string;\n  caption?: string;\n  alt_text?: string;\n  moderation_status: 'pending' | 'approved' | 'rejected';\n  moderation_reason?: string;\n  display_order?: number;\n  created_at: string;\n  moderated_at?: string;\n  updated_at: string;\n}\n\ninterface ToastState {\n  id: string;\n  message: string;\n  type: 'success' | 'error' | 'warning' | 'info';\n}\n\ninterface PhotoPreviewModalProps {\n  photo: Photo;\n  onClose: () => void;\n  onApprove: (id: string) => Promise<void>;\n  onReject: (id: string) => Promise<void>;\n  onDelete: (id: string) => Promise<void>;\n}\n\nfunction PhotoPreviewModal({ photo, onClose, onApprove, onReject, onDelete }: PhotoPreviewModalProps) {\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleApprove = async () => {\n    setIsProcessing(true);\n    try {\n      await onApprove(photo.id);\n      onClose();\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleReject = async () => {\n    setIsProcessing(true);\n    try {\n      await onReject(photo.id);\n      onClose();\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    setIsProcessing(true);\n    try {\n      await onDelete(photo.id);\n      onClose();\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // Close on Escape key\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n    window.addEventListener('keydown', handleEscape);\n    return () => window.removeEventListener('keydown', handleEscape);\n  }, [onClose]);\n\n  // Prevent body scroll\n  useEffect(() => {\n    document.body.style.overflow = 'hidden';\n    return () => {\n      document.body.style.overflow = 'unset';\n    };\n  }, []);\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b border-sage-200 flex items-center justify-between\">\n          <h2 className=\"text-xl font-semibold text-sage-900\">Photo Preview</h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-sage-100 rounded-lg transition-colors\"\n            aria-label=\"Close modal\"\n          >\n            âœ•\n          </button>\n        </div>\n\n        {/* Body */}\n        <div className=\"px-6 py-4\">\n          {/* Photo */}\n          <div className=\"mb-4\">\n            <img\n              src={photo.photo_url}\n              alt={photo.alt_text || 'Photo preview'}\n              className=\"w-full h-auto rounded-lg\"\n            />\n          </div>\n\n          {/* Metadata */}\n          <div className=\"space-y-2 text-sm\">\n            <div>\n              <span className=\"font-medium text-sage-700\">Status:</span>{' '}\n              <span\n                className={`px-2 py-1 rounded-full text-xs font-medium ${\n                  photo.moderation_status === 'approved'\n                    ? 'bg-jungle-100 text-jungle-700'\n                    : photo.moderation_status === 'rejected'\n                    ? 'bg-volcano-100 text-volcano-700'\n                    : 'bg-sunset-100 text-sunset-700'\n                }`}\n              >\n                {photo.moderation_status}\n              </span>\n            </div>\n            {photo.caption && (\n              <div>\n                <span className=\"font-medium text-sage-700\">Caption:</span>{' '}\n                <span className=\"text-sage-600\">{photo.caption}</span>\n              </div>\n            )}\n            <div>\n              <span className=\"font-medium text-sage-700\">Uploaded:</span>{' '}\n              <span className=\"text-sage-600\">\n                {new Date(photo.created_at).toLocaleDateString()} at{' '}\n                {new Date(photo.created_at).toLocaleTimeString()}\n              </span>\n            </div>\n            {photo.moderated_at && (\n              <div>\n                <span className=\"font-medium text-sage-700\">Moderated:</span>{' '}\n                <span className=\"text-sage-600\">\n                  {new Date(photo.moderated_at).toLocaleDateString()} at{' '}\n                  {new Date(photo.moderated_at).toLocaleTimeString()}\n                </span>\n              </div>\n            )}\n            {photo.moderation_reason && (\n              <div>\n                <span className=\"font-medium text-sage-700\">Reason:</span>{' '}\n                <span className=\"text-sage-600\">{photo.moderation_reason}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"px-6 py-4 border-t border-sage-200 flex items-center justify-end gap-3\">\n          <button\n            onClick={handleDelete}\n            disabled={isProcessing}\n            className=\"px-4 py-2 bg-volcano-500 hover:bg-volcano-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isProcessing ? 'Processing...' : 'Delete'}\n          </button>\n          <button\n            onClick={handleReject}\n            disabled={isProcessing}\n            className=\"px-4 py-2 bg-sage-200 hover:bg-sage-300 text-sage-900 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isProcessing ? 'Processing...' : 'Reject'}\n          </button>\n          <button\n            onClick={handleApprove}\n            disabled={isProcessing}\n            className=\"px-4 py-2 bg-jungle-500 hover:bg-jungle-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isProcessing ? 'Processing...' : 'Approve'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function PhotosPage() {\n  const [photos, setPhotos] = useState<Photo[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [filter, setFilter] = useState<'pending' | 'approved' | 'rejected'>('pending');\n  const [selectedPhoto, setSelectedPhoto] = useState<Photo | null>(null);\n  const [toasts, setToasts] = useState<ToastState[]>([]);\n\n  const addToast = useCallback((message: string, type: ToastState['type']) => {\n    const id = Date.now().toString();\n    setToasts((prev) => [...prev, { id, message, type }]);\n  }, []);\n\n  const removeToast = useCallback((id: string) => {\n    setToasts((prev) => prev.filter((toast) => toast.id !== id));\n  }, []);\n\n  const fetchPhotos = useCallback(async () => {\n    setLoading(true);\n    try {\n      const response = await fetch(\n        `/api/admin/photos?moderation_status=${filter}&limit=100&offset=0`\n      );\n      const result = await response.json();\n\n      if (result.success) {\n        setPhotos(result.data.photos);\n      } else {\n        addToast(result.error.message || 'Failed to load photos', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to load photos', 'error');\n    } finally {\n      setLoading(false);\n    }\n  }, [filter, addToast]);\n\n  useEffect(() => {\n    fetchPhotos();\n  }, [fetchPhotos]);\n\n  /**\n   * Set up real-time subscription for photo changes\n   */\n  useEffect(() => {\n    // Create Supabase client for real-time subscriptions\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n    if (!supabaseUrl || !supabaseAnonKey) {\n      console.error('Missing Supabase environment variables for real-time subscriptions');\n      return;\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n    // Subscribe to photo table changes\n    const channel = supabase\n      .channel('photos-changes')\n      .on(\n        'postgres_changes',\n        {\n          event: '*', // Listen to all events (INSERT, UPDATE, DELETE)\n          schema: 'public',\n          table: 'photos',\n        },\n        (payload) => {\n          console.log('Photo change detected:', payload);\n\n          // Update photo grid when photos are uploaded or moderated\n          if (payload.eventType === 'INSERT') {\n            addToast('New photo uploaded', 'info');\n          } else if (payload.eventType === 'UPDATE') {\n            addToast('Photo status updated', 'info');\n          } else if (payload.eventType === 'DELETE') {\n            addToast('Photo deleted', 'info');\n          }\n\n          // Refresh the photo list\n          fetchPhotos();\n\n          // Trigger event to update pending count badge in sidebar\n          window.dispatchEvent(new CustomEvent('photoModerated'));\n        }\n      )\n      .subscribe();\n\n    // Cleanup subscription on unmount\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [fetchPhotos, addToast]);\n\n  const handleApprove = async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/photos/${id}/moderate`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ moderation_status: 'approved' }),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast('Photo approved successfully', 'success');\n        await fetchPhotos();\n        // Trigger event to update pending count in sidebar\n        window.dispatchEvent(new CustomEvent('photoModerated'));\n      } else {\n        addToast(result.error.message || 'Failed to approve photo', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to approve photo', 'error');\n    }\n  };\n\n  const handleReject = async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/photos/${id}/moderate`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ moderation_status: 'rejected' }),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast('Photo rejected successfully', 'success');\n        await fetchPhotos();\n        // Trigger event to update pending count in sidebar\n        window.dispatchEvent(new CustomEvent('photoModerated'));\n      } else {\n        addToast(result.error.message || 'Failed to reject photo', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to reject photo', 'error');\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/photos/${id}`, {\n        method: 'DELETE',\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        addToast('Photo deleted successfully', 'success');\n        await fetchPhotos();\n        // Trigger event to update pending count in sidebar\n        window.dispatchEvent(new CustomEvent('photoModerated'));\n      } else {\n        addToast(result.error.message || 'Failed to delete photo', 'error');\n      }\n    } catch (error) {\n      addToast('Failed to delete photo', 'error');\n    }\n  };\n\n  return (\n    <AdminLayout currentSection=\"photos\">\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-sage-900\">Photo Moderation</h1>\n            <p className=\"text-sage-600 mt-1\">Review and moderate guest-uploaded photos</p>\n          </div>\n        </div>\n\n        {/* Filter tabs */}\n        <div className=\"flex gap-2 border-b border-sage-200\">\n          <button\n            onClick={() => setFilter('pending')}\n            className={`px-4 py-2 font-medium transition-colors ${\n              filter === 'pending'\n                ? 'text-jungle-600 border-b-2 border-jungle-600'\n                : 'text-sage-600 hover:text-sage-900'\n            }`}\n          >\n            Pending\n          </button>\n          <button\n            onClick={() => setFilter('approved')}\n            className={`px-4 py-2 font-medium transition-colors ${\n              filter === 'approved'\n                ? 'text-jungle-600 border-b-2 border-jungle-600'\n                : 'text-sage-600 hover:text-sage-900'\n            }`}\n          >\n            Approved\n          </button>\n          <button\n            onClick={() => setFilter('rejected')}\n            className={`px-4 py-2 font-medium transition-colors ${\n              filter === 'rejected'\n                ? 'text-jungle-600 border-b-2 border-jungle-600'\n                : 'text-sage-600 hover:text-sage-900'\n            }`}\n          >\n            Rejected\n          </button>\n        </div>\n\n        {/* Photo grid */}\n        {loading ? (\n          <GridSkeleton items={8} columns={4} />\n        ) : photos.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-sage-600\">No {filter} photos found</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {photos.map((photo) => (\n              <div\n                key={photo.id}\n                className=\"group relative aspect-square bg-sage-100 rounded-lg overflow-hidden cursor-pointer hover:ring-2 hover:ring-jungle-500 transition-all\"\n                onClick={() => setSelectedPhoto(photo)}\n              >\n                <img\n                  src={photo.photo_url}\n                  alt={photo.alt_text || 'Photo thumbnail'}\n                  className=\"w-full h-full object-cover\"\n                />\n                <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all\" />\n                <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-3 opacity-0 group-hover:opacity-100 transition-opacity\">\n                  <p className=\"text-white text-sm font-medium truncate\">\n                    {photo.caption || 'No caption'}\n                  </p>\n                  <p className=\"text-white text-xs opacity-75\">\n                    {new Date(photo.created_at).toLocaleDateString()}\n                  </p>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Photo preview modal */}\n      {selectedPhoto && (\n        <PhotoPreviewModal\n          photo={selectedPhoto}\n          onClose={() => setSelectedPhoto(null)}\n          onApprove={handleApprove}\n          onReject={handleReject}\n          onDelete={handleDelete}\n        />\n      )}\n\n      {/* Toast notifications */}\n      <div className=\"fixed top-4 right-4 z-50 space-y-2\">\n        {toasts.map((toast) => (\n          <Toast\n            key={toast.id}\n            id={toast.id}\n            message={toast.message}\n            type={toast.type}\n            onClose={() => removeToast(toast.id)}\n            duration={5000}\n          />\n        ))}\n      </div>\n    </AdminLayout>\n  );\n}\n"],"names":["PhotosPage","dynamic","PhotoPreviewModal","photo","onClose","onApprove","onReject","onDelete","isProcessing","setIsProcessing","useState","handleApprove","id","handleReject","handleDelete","useEffect","handleEscape","e","key","window","addEventListener","removeEventListener","document","body","style","overflow","div","className","onClick","stopPropagation","h2","button","aria-label","img","src","photo_url","alt","alt_text","span","moderation_status","caption","Date","created_at","toLocaleDateString","toLocaleTimeString","moderated_at","moderation_reason","disabled","photos","setPhotos","loading","setLoading","filter","setFilter","selectedPhoto","setSelectedPhoto","toasts","setToasts","addToast","useCallback","message","type","now","toString","prev","removeToast","toast","fetchPhotos","response","fetch","result","json","success","data","error","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","console","supabase","createClient","channel","on","event","schema","table","payload","log","eventType","dispatchEvent","CustomEvent","subscribe","removeChannel","method","headers","JSON","stringify","AdminLayout","currentSection","h1","p","GridSkeleton","items","columns","length","map","Toast","duration"],"mappings":"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"}