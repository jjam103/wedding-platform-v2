{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/performance/loadTest.performance.test.ts"],"sourcesContent":["/**\n * Performance Test Suite: Load Testing\n * \n * Tests system performance under load with:\n * - 100 concurrent users\n * - Bulk operations (100+ guests)\n * - API response time measurements\n * - Database query performance monitoring\n * \n * Task: 24.4\n */\n\nimport * as guestServiceModule from '@/services/guestService';\nimport * as rsvpServiceModule from '@/services/rsvpService';\nimport * as eventServiceModule from '@/services/eventService';\nimport * as activityServiceModule from '@/services/activityService';\n\nconst guestService = guestServiceModule;\nconst rsvpService = rsvpServiceModule;\nconst eventService = eventServiceModule;\nconst activityService = activityServiceModule;\n\n// Mock Supabase client\nconst mockSupabase = {\n  from: jest.fn().mockReturnThis(),\n  select: jest.fn().mockReturnThis(),\n  insert: jest.fn().mockReturnThis(),\n  update: jest.fn().mockReturnThis(),\n  delete: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  in: jest.fn().mockReturnThis(),\n  range: jest.fn().mockReturnThis(),\n  single: jest.fn(),\n  auth: {\n    getSession: jest.fn().mockResolvedValue({\n      data: { session: { user: { id: 'user-1' } } },\n      error: null,\n    }),\n  },\n};\n\njest.mock('@/lib/supabase', () => ({\n  createClient: jest.fn(() => mockSupabase),\n}));\n\n// Mock external services\njest.mock('@/services/b2Service', () => ({\n  b2Service: {\n    uploadPhoto: jest.fn().mockResolvedValue({\n      success: true,\n      data: { url: 'https://cdn.example.com/photo.jpg' },\n    }),\n  },\n}));\n\njest.mock('@/services/emailService', () => ({\n  emailService: {\n    send: jest.fn().mockResolvedValue({\n      success: true,\n      data: { id: 'email-1' },\n    }),\n  },\n}));\n\ndescribe('Performance: Load Testing', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Concurrent User Load (100 users)', () => {\n    it('should handle 100 concurrent guest reads within 2 seconds', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          firstName: 'John',\n          lastName: 'Doe',\n          email: 'john@example.com',\n          groupId: 'group-1',\n          ageType: 'adult',\n          guestType: 'wedding_guest',\n        },\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      // Simulate 100 concurrent users reading guest data\n      const promises = Array(100)\n        .fill(null)\n        .map((_, i) => guestService.get(`guest-${i % 10}`));\n\n      const results = await Promise.all(promises);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(2000);\n      expect(results.every((r) => r.success)).toBe(true);\n      expect(results).toHaveLength(100);\n    });\n\n    it('should handle 100 concurrent RSVP submissions within 3 seconds', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'rsvp-1',\n          guestId: 'guest-1',\n          eventId: 'event-1',\n          status: 'attending',\n          guestCount: 2,\n        },\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      // Simulate 100 concurrent RSVP submissions\n      const promises = Array(100)\n        .fill(null)\n        .map((_, i) =>\n          rsvpService.create({\n            guestId: `guest-${i}`,\n            eventId: 'event-1',\n            status: 'attending',\n            guestCount: 2,\n          })\n        );\n\n      const results = await Promise.all(promises);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(3000);\n      expect(results.every((r) => r.success)).toBe(true);\n      expect(results).toHaveLength(100);\n    });\n\n    it('should handle 100 concurrent event list requests within 2.5 seconds', async () => {\n      const mockEvents = Array(20)\n        .fill(null)\n        .map((_, i) => ({\n          id: `event-${i}`,\n          name: `Event ${i}`,\n          startDate: new Date().toISOString(),\n          status: 'published',\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockEvents,\n        error: null,\n        count: 20,\n      });\n\n      const startTime = performance.now();\n\n      // Simulate 100 concurrent users viewing event list\n      const promises = Array(100)\n        .fill(null)\n        .map(() => eventService.list({ page: 1, pageSize: 20 }));\n\n      const results = await Promise.all(promises);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(2500);\n      expect(results.every((r) => r.success)).toBe(true);\n      expect(results).toHaveLength(100);\n    });\n\n    it('should handle mixed concurrent operations within 3 seconds', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'test-1' },\n        error: null,\n      });\n\n      mockSupabase.select.mockResolvedValue({\n        data: [{ id: 'test-1' }],\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      // Simulate 100 concurrent mixed operations\n      const promises = Array(100)\n        .fill(null)\n        .map((_, i) => {\n          const operation = i % 4;\n          switch (operation) {\n            case 0:\n              return guestService.get(`guest-${i}`);\n            case 1:\n              return eventService.list({ page: 1, pageSize: 10 });\n            case 2:\n              return activityService.list({ page: 1, pageSize: 10 });\n            case 3:\n              return rsvpService.list({ guestId: `guest-${i}` });\n            default:\n              return guestService.get(`guest-${i}`);\n          }\n        });\n\n      const results = await Promise.all(promises);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(3000);\n      expect(results.every((r) => r.success)).toBe(true);\n      expect(results).toHaveLength(100);\n    });\n  });\n\n  describe('Bulk Operations (100+ guests)', () => {\n    it('should create 100 guests within 1 second', async () => {\n      const guests = Array(100)\n        .fill(null)\n        .map((_, i) => ({\n          firstName: `Guest${i}`,\n          lastName: 'Doe',\n          email: `guest${i}@example.com`,\n          groupId: 'group-1',\n          ageType: 'adult' as const,\n          guestType: 'wedding_guest' as const,\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: guests.map((g, i) => ({ id: `guest-${i}`, ...g })),\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      const result = await guestService.bulkCreate(guests);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(1000);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toHaveLength(100);\n      }\n    });\n\n    it('should update 150 guests within 1.5 seconds', async () => {\n      const updates = Array(150)\n        .fill(null)\n        .map((_, i) => ({\n          id: `guest-${i}`,\n          firstName: `Updated${i}`,\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: updates,\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      const result = await guestService.bulkUpdate(updates);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(1500);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toHaveLength(150);\n      }\n    });\n\n    it('should delete 100 guests within 800ms', async () => {\n      const guestIds = Array(100)\n        .fill(null)\n        .map((_, i) => `guest-${i}`);\n\n      mockSupabase.select.mockResolvedValue({\n        data: null,\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      const result = await guestService.bulkDelete(guestIds);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(800);\n      expect(result.success).toBe(true);\n    });\n\n    it('should export 200 guests to CSV within 500ms', async () => {\n      const guests = Array(200)\n        .fill(null)\n        .map((_, i) => ({\n          id: `guest-${i}`,\n          firstName: `Guest${i}`,\n          lastName: 'Doe',\n          email: `guest${i}@example.com`,\n          groupId: 'group-1',\n          ageType: 'adult' as const,\n          guestType: 'wedding_guest' as const,\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: guests,\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      const result = await guestService.exportToCSV({ groupId: 'group-1' });\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(500);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.split('\\n').length).toBeGreaterThan(200);\n      }\n    });\n\n    it('should import 100 guests from CSV within 1.2 seconds', async () => {\n      const csvData = Array(100)\n        .fill(null)\n        .map(\n          (_, i) =>\n            `Guest${i},Doe,guest${i}@example.com,group-1,adult,wedding_guest`\n        )\n        .join('\\n');\n\n      const csvWithHeaders = `firstName,lastName,email,groupId,ageType,guestType\\n${csvData}`;\n\n      mockSupabase.select.mockResolvedValue({\n        data: Array(100)\n          .fill(null)\n          .map((_, i) => ({ id: `guest-${i}` })),\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      const result = await guestService.importFromCSV(csvWithHeaders);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(1200);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data).toHaveLength(100);\n      }\n    });\n\n    it('should handle bulk RSVP creation for 120 guests within 1 second', async () => {\n      const rsvps = Array(120)\n        .fill(null)\n        .map((_, i) => ({\n          guestId: `guest-${i}`,\n          eventId: 'event-1',\n          status: 'attending' as const,\n          guestCount: 2,\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: rsvps.map((r, i) => ({ id: `rsvp-${i}`, ...r })),\n        error: null,\n      });\n\n      const startTime = performance.now();\n\n      // Simulate bulk RSVP creation\n      const promises = rsvps.map((rsvp) => rsvpService.create(rsvp));\n      const results = await Promise.all(promises);\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      expect(duration).toBeLessThan(1000);\n      expect(results.every((r) => r.success)).toBe(true);\n      expect(results).toHaveLength(120);\n    });\n  });\n\n  describe('API Response Time Measurements', () => {\n    it('should respond to GET /api/guests/:id within 100ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          firstName: 'John',\n          lastName: 'Doe',\n        },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      // Take 10 measurements\n      for (let i = 0; i < 10; i++) {\n        const startTime = performance.now();\n        await guestService.get('guest-1');\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgResponseTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n      const maxResponseTime = Math.max(...measurements);\n\n      expect(avgResponseTime).toBeLessThan(100);\n      expect(maxResponseTime).toBeLessThan(150);\n    });\n\n    it('should respond to POST /api/guests within 150ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          firstName: 'John',\n          lastName: 'Doe',\n        },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      // Take 10 measurements\n      for (let i = 0; i < 10; i++) {\n        const startTime = performance.now();\n        await guestService.create({\n          firstName: 'John',\n          lastName: 'Doe',\n          email: 'john@example.com',\n          groupId: 'group-1',\n          ageType: 'adult',\n          guestType: 'wedding_guest',\n        });\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgResponseTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n      const maxResponseTime = Math.max(...measurements);\n\n      expect(avgResponseTime).toBeLessThan(150);\n      expect(maxResponseTime).toBeLessThan(200);\n    });\n\n    it('should respond to PUT /api/guests/:id within 120ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: {\n          id: 'guest-1',\n          firstName: 'Jane',\n        },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      // Take 10 measurements\n      for (let i = 0; i < 10; i++) {\n        const startTime = performance.now();\n        await guestService.update('guest-1', { firstName: 'Jane' });\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgResponseTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n      const maxResponseTime = Math.max(...measurements);\n\n      expect(avgResponseTime).toBeLessThan(120);\n      expect(maxResponseTime).toBeLessThan(180);\n    });\n\n    it('should respond to DELETE /api/guests/:id within 80ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: null,\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      // Take 10 measurements\n      for (let i = 0; i < 10; i++) {\n        const startTime = performance.now();\n        await guestService.delete('guest-1');\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgResponseTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n      const maxResponseTime = Math.max(...measurements);\n\n      expect(avgResponseTime).toBeLessThan(80);\n      expect(maxResponseTime).toBeLessThan(120);\n    });\n\n    it('should respond to GET /api/guests (list) within 200ms', async () => {\n      const mockGuests = Array(50)\n        .fill(null)\n        .map((_, i) => ({\n          id: `guest-${i}`,\n          firstName: `Guest${i}`,\n          lastName: 'Doe',\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockGuests,\n        error: null,\n        count: 50,\n      });\n\n      const measurements: number[] = [];\n\n      // Take 10 measurements\n      for (let i = 0; i < 10; i++) {\n        const startTime = performance.now();\n        await guestService.list({ page: 1, pageSize: 50 });\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgResponseTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n      const maxResponseTime = Math.max(...measurements);\n\n      expect(avgResponseTime).toBeLessThan(200);\n      expect(maxResponseTime).toBeLessThan(300);\n    });\n\n    it('should measure response time percentiles', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'guest-1' },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      // Take 100 measurements\n      for (let i = 0; i < 100; i++) {\n        const startTime = performance.now();\n        await guestService.get('guest-1');\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      measurements.sort((a, b) => a - b);\n\n      const p50 = measurements[Math.floor(measurements.length * 0.5)];\n      const p95 = measurements[Math.floor(measurements.length * 0.95)];\n      const p99 = measurements[Math.floor(measurements.length * 0.99)];\n\n      expect(p50).toBeLessThan(100); // Median under 100ms\n      expect(p95).toBeLessThan(150); // 95th percentile under 150ms\n      expect(p99).toBeLessThan(200); // 99th percentile under 200ms\n    });\n  });\n\n  describe('Database Query Performance', () => {\n    it('should execute simple SELECT query within 30ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'guest-1', firstName: 'John' },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase.from('guests').select('*').eq('id', 'guest-1').single();\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(30);\n    });\n\n    it('should execute filtered SELECT query within 50ms', async () => {\n      const mockData = Array(20)\n        .fill(null)\n        .map((_, i) => ({ id: `guest-${i}`, groupId: 'group-1' }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase.from('guests').select('*').eq('group_id', 'group-1');\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(50);\n    });\n\n    it('should execute paginated query within 80ms', async () => {\n      const mockData = Array(50)\n        .fill(null)\n        .map((_, i) => ({ id: `guest-${i}` }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n        count: 100,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase\n          .from('guests')\n          .select('*', { count: 'exact' })\n          .range(0, 49);\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(80);\n    });\n\n    it('should execute JOIN query within 100ms', async () => {\n      const mockData = Array(30)\n        .fill(null)\n        .map((_, i) => ({\n          id: `rsvp-${i}`,\n          guest: { firstName: `Guest${i}`, lastName: 'Doe' },\n          event: { name: 'Wedding Ceremony' },\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: mockData,\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase\n          .from('rsvps')\n          .select('*, guests(*), events(*)')\n          .eq('event_id', 'event-1');\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(100);\n    });\n\n    it('should execute aggregate query within 60ms', async () => {\n      mockSupabase.select.mockResolvedValue({\n        data: [{ count: 150 }],\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase\n          .from('guests')\n          .select('*', { count: 'exact', head: true })\n          .eq('group_id', 'group-1');\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(60);\n    });\n\n    it('should execute INSERT query within 40ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'guest-1', firstName: 'John' },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase\n          .from('guests')\n          .insert({ firstName: 'John', lastName: 'Doe' })\n          .select()\n          .single();\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(40);\n    });\n\n    it('should execute UPDATE query within 35ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'guest-1', firstName: 'Jane' },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase\n          .from('guests')\n          .update({ firstName: 'Jane' })\n          .eq('id', 'guest-1')\n          .select()\n          .single();\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(35);\n    });\n\n    it('should execute DELETE query within 30ms', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: null,\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      for (let i = 0; i < 20; i++) {\n        const startTime = performance.now();\n        await mockSupabase.from('guests').delete().eq('id', 'guest-1');\n        const endTime = performance.now();\n        measurements.push(endTime - startTime);\n      }\n\n      const avgQueryTime =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n\n      expect(avgQueryTime).toBeLessThan(30);\n    });\n  });\n\n  describe('Throughput Measurements', () => {\n    it('should handle 500 requests per second', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'guest-1' },\n        error: null,\n      });\n\n      const startTime = performance.now();\n      const requests = 500;\n\n      const promises = Array(requests)\n        .fill(null)\n        .map(() => guestService.get('guest-1'));\n\n      await Promise.all(promises);\n\n      const endTime = performance.now();\n      const duration = (endTime - startTime) / 1000; // Convert to seconds\n\n      const throughput = requests / duration;\n\n      expect(throughput).toBeGreaterThan(500);\n    });\n\n    it('should maintain throughput under sustained load', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'guest-1' },\n        error: null,\n      });\n\n      const measurements: number[] = [];\n\n      // Run 5 batches of 100 requests\n      for (let batch = 0; batch < 5; batch++) {\n        const startTime = performance.now();\n\n        const promises = Array(100)\n          .fill(null)\n          .map(() => guestService.get('guest-1'));\n\n        await Promise.all(promises);\n\n        const endTime = performance.now();\n        const duration = (endTime - startTime) / 1000;\n        const throughput = 100 / duration;\n        measurements.push(throughput);\n      }\n\n      // All batches should maintain similar throughput\n      const avgThroughput =\n        measurements.reduce((sum, t) => sum + t, 0) / measurements.length;\n      const minThroughput = Math.min(...measurements);\n\n      expect(avgThroughput).toBeGreaterThan(500);\n      expect(minThroughput).toBeGreaterThan(400); // No more than 20% degradation\n    });\n  });\n\n  describe('Resource Utilization', () => {\n    it('should not exceed memory limits under load', async () => {\n      mockSupabase.single.mockResolvedValue({\n        data: { id: 'guest-1', firstName: 'John' },\n        error: null,\n      });\n\n      const initialMemory = process.memoryUsage().heapUsed;\n\n      // Perform 500 operations\n      for (let i = 0; i < 500; i++) {\n        await guestService.get('guest-1');\n      }\n\n      const finalMemory = process.memoryUsage().heapUsed;\n      const memoryIncrease = (finalMemory - initialMemory) / (1024 * 1024); // MB\n\n      // Memory increase should be minimal (less than 20MB)\n      expect(memoryIncrease).toBeLessThan(20);\n    });\n\n    it('should handle large result sets efficiently', async () => {\n      const largeDataset = Array(1000)\n        .fill(null)\n        .map((_, i) => ({\n          id: `guest-${i}`,\n          firstName: `Guest${i}`,\n          lastName: 'Doe',\n          email: `guest${i}@example.com`,\n        }));\n\n      mockSupabase.select.mockResolvedValue({\n        data: largeDataset,\n        error: null,\n      });\n\n      const initialMemory = process.memoryUsage().heapUsed;\n      const startTime = performance.now();\n\n      await guestService.list({ page: 1, pageSize: 1000 });\n\n      const endTime = performance.now();\n      const finalMemory = process.memoryUsage().heapUsed;\n\n      const duration = endTime - startTime;\n      const memoryIncrease = (finalMemory - initialMemory) / (1024 * 1024);\n\n      expect(duration).toBeLessThan(500);\n      expect(memoryIncrease).toBeLessThan(50);\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","mockSupabase","b2Service","uploadPhoto","mockResolvedValue","success","data","url","emailService","send","id","guestService","guestServiceModule","rsvpService","rsvpServiceModule","eventService","eventServiceModule","activityService","activityServiceModule","from","mockReturnThis","select","insert","update","delete","eq","in","range","single","auth","getSession","session","user","error","describe","beforeEach","clearAllMocks","it","firstName","lastName","email","groupId","ageType","guestType","startTime","performance","now","promises","Array","fill","map","_","i","get","results","Promise","all","endTime","duration","expect","toBeLessThan","every","r","toBe","toHaveLength","guestId","eventId","status","guestCount","create","mockEvents","name","startDate","Date","toISOString","count","list","page","pageSize","operation","guests","g","result","bulkCreate","updates","bulkUpdate","guestIds","bulkDelete","exportToCSV","split","length","toBeGreaterThan","csvData","join","csvWithHeaders","importFromCSV","rsvps","rsvp","measurements","push","avgResponseTime","reduce","sum","t","maxResponseTime","Math","max","mockGuests","sort","a","b","p50","floor","p95","p99","avgQueryTime","mockData","guest","event","head","requests","throughput","batch","avgThroughput","minThroughput","min","initialMemory","process","memoryUsage","heapUsed","finalMemory","memoryIncrease","largeDataset"],"mappings":"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"}