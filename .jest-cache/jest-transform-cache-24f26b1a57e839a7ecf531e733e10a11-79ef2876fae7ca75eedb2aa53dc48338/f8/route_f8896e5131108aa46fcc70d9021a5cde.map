{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/guest-groups/[id]/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { updateGroupSchema } from '@/schemas/groupSchemas';\nimport * as groupService from '@/services/groupService';\nimport { createAuthenticatedClient } from '@/lib/supabaseServer';\nimport { z } from 'zod';\n\nfunction getStatusCode(errorCode: string): number {\n  const statusMap: Record<string, number> = {\n    'VALIDATION_ERROR': 400,\n    'NOT_FOUND': 404,\n    'CONFLICT': 409,\n    'DATABASE_ERROR': 500,\n    'UNKNOWN_ERROR': 500,\n  };\n  return statusMap[errorCode] || 500;\n}\n\n/**\n * GET /api/admin/guest-groups/[id]\n * Get a specific guest group\n */\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Authentication\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. Await params and validate ID\n    const { id } = await params;\n    const validation = z.string().uuid().safeParse(id);\n    if (!validation.success) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid ID format' } },\n        { status: 400 }\n      );\n    }\n    \n    // 3. Service call\n    const result = await groupService.get(supabase, id);\n    \n    // 4. Response\n    return NextResponse.json(result, { status: result.success ? 200 : getStatusCode(result.error.code) });\n    \n  } catch (error) {\n    console.error('GET /api/admin/guest-groups/[id] error:', error);\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PUT /api/admin/guest-groups/[id]\n * Update a guest group\n */\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Authentication\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. Await params and validate ID\n    const { id } = await params;\n    const idValidation = z.string().uuid().safeParse(id);\n    if (!idValidation.success) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid ID format' } },\n        { status: 400 }\n      );\n    }\n    \n    // 3. Validate body\n    const body = await request.json();\n    const validation = updateGroupSchema.safeParse(body);\n    \n    if (!validation.success) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid request data', details: validation.error.issues } },\n        { status: 400 }\n      );\n    }\n    \n    // 4. Service call\n    const result = await groupService.update(supabase, id, validation.data);\n    \n    // 5. Response\n    return NextResponse.json(result, { status: result.success ? 200 : getStatusCode(result.error.code) });\n    \n  } catch (error) {\n    console.error('PUT /api/admin/guest-groups/[id] error:', error);\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/admin/guest-groups/[id]\n * Delete a guest group\n */\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // 1. Authentication\n    const supabase = await createAuthenticatedClient();\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n    \n    // 2. Await params and validate ID\n    const { id } = await params;\n    const validation = z.string().uuid().safeParse(id);\n    if (!validation.success) {\n      return NextResponse.json(\n        { success: false, error: { code: 'VALIDATION_ERROR', message: 'Invalid ID format' } },\n        { status: 400 }\n      );\n    }\n    \n    // 3. Service call\n    const result = await groupService.deleteGroup(supabase, id);\n    \n    // 4. Response\n    return NextResponse.json(result, { status: result.success ? 200 : getStatusCode(result.error.code) });\n    \n  } catch (error) {\n    console.error('DELETE /api/admin/guest-groups/[id] error:', error);\n    return NextResponse.json(\n      { success: false, error: { code: 'INTERNAL_ERROR', message: 'An unexpected error occurred' } },\n      { status: 500 }\n    );\n  }\n}\n"],"names":["DELETE","GET","PUT","getStatusCode","errorCode","statusMap","request","params","supabase","createAuthenticatedClient","data","session","error","authError","auth","getSession","NextResponse","json","success","code","message","status","id","validation","z","string","uuid","safeParse","result","groupService","get","console","idValidation","body","updateGroupSchema","details","issues","update","deleteGroup"],"mappings":"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"}