{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/mocks/mockGeminiService.ts"],"sourcesContent":["/**\n * Mock Google Gemini AI Service for E2E Testing\n * \n * This mock service simulates Google Gemini AI operations without making real API calls.\n * It provides realistic responses for testing AI content extraction functionality.\n */\n\nimport type { Result } from '@/types';\n\ninterface GenerateContentResponse {\n  response: {\n    text: () => string;\n  };\n}\n\ninterface ExtractedActivity {\n  name: string;\n  description?: string;\n  activityType: string;\n  startTime: string;\n  endTime?: string;\n  capacity?: number;\n  costPerPerson?: number;\n  adultsOnly?: boolean;\n  plusOneAllowed?: boolean;\n}\n\ninterface ExtractedAccommodation {\n  name: string;\n  description?: string;\n  address?: string;\n}\n\ninterface ExtractedVendor {\n  name: string;\n  category: string;\n  contactName?: string;\n  email?: string;\n  phone?: string;\n  pricingModel: string;\n  baseCost: number;\n  notes?: string;\n}\n\n// Track AI requests for debugging\nconst aiRequests: Array<{\n  prompt: string;\n  timestamp: number;\n  response: string;\n}> = [];\n\n// Simulate AI failures for testing\nlet shouldFailNextRequest = false;\nlet failureReason = 'Simulated AI failure';\n\n/**\n * Mock Gemini model\n */\nclass MockGeminiModel {\n  async generateContent(prompt: string): Promise<GenerateContentResponse> {\n    // Simulate network delay\n    await new Promise((resolve) => setTimeout(resolve, 100));\n\n    // Check for simulated failure\n    if (shouldFailNextRequest) {\n      shouldFailNextRequest = false;\n      console.log('ðŸ§ª [MOCK GEMINI] Request failed (simulated):', failureReason);\n      throw new Error(failureReason);\n    }\n\n    // Determine content type from prompt\n    let response: string;\n    if (prompt.includes('Content Type: activity')) {\n      response = this.generateActivityResponse();\n    } else if (prompt.includes('Content Type: accommodation')) {\n      response = this.generateAccommodationResponse();\n    } else if (prompt.includes('Content Type: vendor')) {\n      response = this.generateVendorResponse();\n    } else {\n      response = '{\"error\": \"Unknown content type\"}';\n    }\n\n    // Track request\n    aiRequests.push({\n      prompt: prompt.substring(0, 200) + '...',\n      timestamp: Date.now(),\n      response,\n    });\n\n    console.log('ðŸ§ª [MOCK GEMINI] Content generated:', {\n      contentType: this.extractContentType(prompt),\n      responseLength: response.length,\n    });\n\n    return {\n      response: {\n        text: () => response,\n      },\n    };\n  }\n\n  private extractContentType(prompt: string): string {\n    if (prompt.includes('Content Type: activity')) return 'activity';\n    if (prompt.includes('Content Type: accommodation')) return 'accommodation';\n    if (prompt.includes('Content Type: vendor')) return 'vendor';\n    return 'unknown';\n  }\n\n  private generateActivityResponse(): string {\n    const activity: ExtractedActivity = {\n      name: 'Mock Activity',\n      description: 'This is a mock activity extracted by the AI service for testing purposes.',\n      activityType: 'activity',\n      startTime: new Date(Date.now() + 86400000).toISOString(), // Tomorrow\n      endTime: new Date(Date.now() + 90000000).toISOString(), // Tomorrow + 1 hour\n      capacity: 50,\n      costPerPerson: 75.0,\n      adultsOnly: false,\n      plusOneAllowed: true,\n    };\n\n    return JSON.stringify(activity, null, 2);\n  }\n\n  private generateAccommodationResponse(): string {\n    const accommodation: ExtractedAccommodation = {\n      name: 'Mock Hotel',\n      description: 'This is a mock accommodation extracted by the AI service for testing purposes.',\n      address: '123 Test Street, Test City, TC 12345',\n    };\n\n    return JSON.stringify(accommodation, null, 2);\n  }\n\n  private generateVendorResponse(): string {\n    const vendor: ExtractedVendor = {\n      name: 'Mock Vendor',\n      category: 'catering',\n      contactName: 'John Doe',\n      email: 'john@mockvendor.com',\n      phone: '+15551234567',\n      pricingModel: 'per_guest',\n      baseCost: 50.0,\n      notes: 'This is a mock vendor extracted by the AI service for testing purposes.',\n    };\n\n    return JSON.stringify(vendor, null, 2);\n  }\n}\n\n/**\n * Mock GoogleGenerativeAI class\n */\nexport class MockGoogleGenerativeAI {\n  constructor(apiKey: string) {\n    console.log('ðŸ§ª [MOCK GEMINI] Client created with API key:', apiKey.substring(0, 10) + '...');\n  }\n\n  getGenerativeModel(config: { model: string }): MockGeminiModel {\n    console.log('ðŸ§ª [MOCK GEMINI] Model initialized:', config.model);\n    return new MockGeminiModel();\n  }\n}\n\n/**\n * Get all AI requests (for test verification)\n */\nexport function getAIRequests() {\n  return [...aiRequests];\n}\n\n/**\n * Get AI request count\n */\nexport function getAIRequestCount(): number {\n  return aiRequests.length;\n}\n\n/**\n * Clear AI requests (for test cleanup)\n */\nexport function clearAIRequests(): void {\n  aiRequests.length = 0;\n  console.log('ðŸ§ª [MOCK GEMINI] AI requests cleared');\n}\n\n/**\n * Simulate AI failure for next request\n */\nexport function simulateAIFailure(reason: string = 'Simulated AI failure'): void {\n  shouldFailNextRequest = true;\n  failureReason = reason;\n  console.log('ðŸ§ª [MOCK GEMINI] Next request will fail:', reason);\n}\n\n/**\n * Reset mock state\n */\nexport function resetMockGemini(): void {\n  aiRequests.length = 0;\n  shouldFailNextRequest = false;\n  failureReason = 'Simulated AI failure';\n  console.log('ðŸ§ª [MOCK GEMINI] Mock reset');\n}\n\n/**\n * Verify AI request was made\n */\nexport function verifyAIRequest(criteria: {\n  contentType?: string;\n  containsText?: string;\n}): boolean {\n  return aiRequests.some((req) => {\n    if (criteria.contentType && !req.prompt.includes(`Content Type: ${criteria.contentType}`)) {\n      return false;\n    }\n\n    if (criteria.containsText && !req.prompt.includes(criteria.containsText)) {\n      return false;\n    }\n\n    return true;\n  });\n}\n\n/**\n * Get last AI request\n */\nexport function getLastAIRequest() {\n  return aiRequests[aiRequests.length - 1];\n}\n\n/**\n * Set custom response for next request\n */\nlet customNextResponse: string | null = null;\n\nexport function setCustomResponse(response: string): void {\n  customNextResponse = response;\n  console.log('ðŸ§ª [MOCK GEMINI] Custom response set for next request');\n}\n"],"names":["MockGoogleGenerativeAI","clearAIRequests","getAIRequestCount","getAIRequests","getLastAIRequest","resetMockGemini","setCustomResponse","simulateAIFailure","verifyAIRequest","aiRequests","shouldFailNextRequest","failureReason","MockGeminiModel","generateContent","prompt","Promise","resolve","setTimeout","console","log","Error","response","includes","generateActivityResponse","generateAccommodationResponse","generateVendorResponse","push","substring","timestamp","Date","now","contentType","extractContentType","responseLength","length","text","activity","name","description","activityType","startTime","toISOString","endTime","capacity","costPerPerson","adultsOnly","plusOneAllowed","JSON","stringify","accommodation","address","vendor","category","contactName","email","phone","pricingModel","baseCost","notes","apiKey","getGenerativeModel","config","model","reason","criteria","some","req","containsText","customNextResponse"],"mappings":"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"}