{"version":3,"names":["cov_3ywaoj6s9","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","version","sources","sourcesContent","names","mappings","_coverageSchema","coverage","actualCoverage","POST","request","params","id","supabase","_authhelpersnextjs","createRouteHandlerClient","cookies","_headers","data","session","error","authError","auth","getSession","_server","NextResponse","json","success","code","message","status","adminUser","from","select","eq","user","single","role","result","_adminUserService","adminUserService","deactivate","statusCode","insert","user_id","action","entity_type","entity_id","details","email","Error"],"sources":["/Users/jaron/Desktop/wedding-platform-v2/app/api/admin/admin-users/[id]/deactivate/route.ts"],"sourcesContent":["/**\n * Admin User Deactivation API Route\n * \n * POST - Deactivate admin user\n * \n * Requirements: 3.6, 3.8, 3.9, 3.10\n */\n\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\nimport { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport { adminUserService } from '@/services/adminUserService';\n\n/**\n * POST /api/admin/admin-users/[id]/deactivate\n * Deactivate admin user\n */\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n\n    // 1. Auth check\n    const supabase = createRouteHandlerClient({ cookies });\n    const { data: { session }, error: authError } = await supabase.auth.getSession();\n    \n    if (authError || !session) {\n      return NextResponse.json(\n        { success: false, error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },\n        { status: 401 }\n      );\n    }\n\n    // 2. Check if user is owner\n    const { data: adminUser } = await supabase\n      .from('admin_users')\n      .select('role')\n      .eq('id', session.user.id)\n      .single();\n\n    if (!adminUser || adminUser.role !== 'owner') {\n      return NextResponse.json(\n        { success: false, error: { code: 'FORBIDDEN', message: 'Owner role required' } },\n        { status: 403 }\n      );\n    }\n\n    // 3. Deactivate admin user\n    const result = await adminUserService.deactivate(id);\n\n    if (!result.success) {\n      const statusCode = \n        result.error.code === 'NOT_FOUND' ? 404 :\n        result.error.code === 'FORBIDDEN' ? 403 :\n        500;\n      return NextResponse.json(result, { status: statusCode });\n    }\n\n    // 4. Log action in audit log\n    await supabase.from('audit_logs').insert({\n      user_id: session.user.id,\n      action: 'admin_user_deactivated',\n      entity_type: 'admin_user',\n      entity_id: id,\n      details: { email: result.data.email },\n    });\n\n    return NextResponse.json(result);\n  } catch (error) {\n    return NextResponse.json(\n      { \n        success: false, \n        error: { \n          code: 'INTERNAL_ERROR', \n          message: error instanceof Error ? error.message : 'Unknown error' \n        } \n      },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}