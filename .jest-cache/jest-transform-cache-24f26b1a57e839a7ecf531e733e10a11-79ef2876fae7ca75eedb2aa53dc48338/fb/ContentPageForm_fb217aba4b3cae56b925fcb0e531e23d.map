{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/admin/ContentPageForm.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { generateSlug, getSlugPreview, isValidSlug } from '@/utils/slugs';\nimport type { ContentPage } from '@/schemas/cmsSchemas';\n\ninterface ContentPageFormData {\n  title: string;\n  slug: string;\n  status: 'draft' | 'published';\n}\n\ninterface ContentPageFormProps {\n  title: string;\n  onSubmit: (data: ContentPageFormData) => Promise<void>;\n  onCancel?: () => void;\n  initialData?: ContentPage;\n  isOpen: boolean;\n  onToggle: () => void;\n  submitLabel?: string;\n  cancelLabel?: string;\n}\n\n/**\n * ContentPageForm Component\n * \n * Specialized form for content pages with:\n * - Auto-slug generation from title\n * - Manual slug override capability\n * - URL path preview\n * - Validation feedback\n */\nexport function ContentPageForm({\n  title,\n  onSubmit,\n  onCancel,\n  initialData,\n  isOpen,\n  onToggle,\n  submitLabel = 'Create',\n  cancelLabel = 'Cancel',\n}: ContentPageFormProps) {\n  const [formTitle, setFormTitle] = useState(initialData?.title || '');\n  const [formSlug, setFormSlug] = useState(initialData?.slug || '');\n  const [formStatus, setFormStatus] = useState<'draft' | 'published'>(initialData?.status || 'draft');\n  const [slugManuallyEdited, setSlugManuallyEdited] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isDirty, setIsDirty] = useState(false);\n  const formRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n\n  // Reset form when initialData changes\n  useEffect(() => {\n    if (initialData) {\n      setFormTitle(initialData.title);\n      setFormSlug(initialData.slug);\n      setFormStatus(initialData.status);\n      setSlugManuallyEdited(true); // Preserve existing slug when editing\n      setIsDirty(false);\n    } else if (!isOpen) {\n      // Reset form when closing\n      setFormTitle('');\n      setFormSlug('');\n      setFormStatus('draft');\n      setSlugManuallyEdited(false);\n      setIsDirty(false);\n      setErrors({});\n    }\n  }, [initialData, isOpen]);\n\n  // Auto-generate slug from title\n  useEffect(() => {\n    if (!slugManuallyEdited && formTitle) {\n      setFormSlug(generateSlug(formTitle));\n    }\n  }, [formTitle, slugManuallyEdited]);\n\n  // Auto-scroll to form when expanded and force height recalculation\n  useEffect(() => {\n    if (isOpen && formRef.current && contentRef.current) {\n      // Force height recalculation after content renders\n      setTimeout(() => {\n        if (contentRef.current) {\n          contentRef.current.style.maxHeight = `${contentRef.current.scrollHeight}px`;\n        }\n        formRef.current?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n      }, 100);\n    }\n  }, [isOpen]);\n\n  // Recalculate height when form content changes\n  useEffect(() => {\n    if (isOpen && contentRef.current) {\n      const recalculate = () => {\n        if (contentRef.current) {\n          contentRef.current.style.maxHeight = `${contentRef.current.scrollHeight}px`;\n        }\n      };\n      \n      recalculate();\n      const timer = setTimeout(recalculate, 50);\n      \n      return () => clearTimeout(timer);\n    }\n  }, [isOpen, formTitle, formSlug, formStatus, errors]);\n\n  const handleTitleChange = useCallback((value: string) => {\n    setFormTitle(value);\n    setIsDirty(true);\n    if (errors.title) {\n      setErrors((prev) => {\n        const next = { ...prev };\n        delete next.title;\n        return next;\n      });\n    }\n  }, [errors.title]);\n\n  const handleSlugChange = useCallback((value: string) => {\n    setFormSlug(value);\n    setSlugManuallyEdited(true);\n    setIsDirty(true);\n    if (errors.slug) {\n      setErrors((prev) => {\n        const next = { ...prev };\n        delete next.slug;\n        return next;\n      });\n    }\n  }, [errors.slug]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Validate\n    const validationErrors: Record<string, string> = {};\n    \n    if (!formTitle.trim()) {\n      validationErrors.title = 'Title is required';\n    }\n    \n    if (!formSlug.trim()) {\n      validationErrors.slug = 'Slug is required';\n    } else if (!isValidSlug(formSlug)) {\n      validationErrors.slug = 'Slug must contain only lowercase letters, numbers, and hyphens';\n    }\n    \n    if (Object.keys(validationErrors).length > 0) {\n      setErrors(validationErrors);\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      await onSubmit({\n        title: formTitle,\n        slug: formSlug,\n        status: formStatus,\n      });\n      // Form will be reset by useEffect when isOpen changes\n    } catch (error) {\n      console.error('Form submission error:', error);\n      setErrors({ _form: error instanceof Error ? error.message : 'Submission failed' });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleCancel = () => {\n    if (isDirty) {\n      const confirmed = window.confirm(\n        'You have unsaved changes. Are you sure you want to cancel?'\n      );\n      if (!confirmed) return;\n    }\n\n    onToggle();\n    if (onCancel) onCancel();\n  };\n\n  const slugPreview = formSlug ? getSlugPreview(formSlug, 'pages') : '';\n\n  return (\n    <div ref={formRef} className=\"border border-sage-200 rounded-lg overflow-hidden bg-white shadow-sm\">\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full flex items-center justify-between px-4 py-3 bg-sage-50 hover:bg-sage-100 transition-colors\"\n        aria-expanded={isOpen}\n        aria-controls=\"content-page-form-content\"\n      >\n        <span className=\"font-medium text-sage-900\">{title}</span>\n        <span \n          className={`text-sage-600 transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`}\n          aria-hidden=\"true\"\n        >\n          â–¼\n        </span>\n      </button>\n\n      {/* Collapsible Content */}\n      <div\n        ref={contentRef}\n        id=\"content-page-form-content\"\n        className={`transition-all duration-300 ease-in-out ${isOpen ? '' : 'overflow-hidden'}`}\n        style={{\n          maxHeight: isOpen ? 'none' : '0px',\n          opacity: isOpen ? 1 : 0,\n        }}\n        aria-hidden={!isOpen}\n      >\n        <form onSubmit={handleSubmit} className=\"p-4 space-y-4\">\n          {/* Form-level error */}\n          {errors._form && (\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\" role=\"alert\">\n              <p className=\"text-sm text-red-700\">{errors._form}</p>\n            </div>\n          )}\n\n          {/* Fields in Grid Layout */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {/* Title Field */}\n            <div className=\"space-y-1\">\n              <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700\">\n                Title\n                <span className=\"text-red-500 ml-1\">*</span>\n              </label>\n              <input\n                id=\"title\"\n                type=\"text\"\n                value={formTitle}\n                onChange={(e) => handleTitleChange(e.target.value)}\n                placeholder=\"Our Story\"\n                required\n                className={`w-full px-3 py-2 border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 ${\n                  errors.title ? 'border-red-500' : 'border-gray-300'\n                }`}\n                aria-invalid={!!errors.title}\n                aria-describedby={errors.title ? 'title-error' : undefined}\n              />\n              {errors.title && (\n                <p id=\"title-error\" className=\"text-sm text-red-600\" role=\"alert\">\n                  {errors.title}\n                </p>\n              )}\n            </div>\n\n            {/* Status Field */}\n            <div className=\"space-y-1\">\n              <label htmlFor=\"status\" className=\"block text-sm font-medium text-gray-700\">\n                Status\n                <span className=\"text-red-500 ml-1\">*</span>\n              </label>\n              <select\n                id=\"status\"\n                value={formStatus}\n                onChange={(e) => {\n                  setFormStatus(e.target.value as 'draft' | 'published');\n                  setIsDirty(true);\n                }}\n                required\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-green-500\"\n              >\n                <option value=\"draft\">Draft</option>\n                <option value=\"published\">Published</option>\n              </select>\n            </div>\n\n            {/* Slug Field - Full Width */}\n            <div className=\"md:col-span-2 space-y-1\">\n              <label htmlFor=\"slug\" className=\"block text-sm font-medium text-gray-700\">\n                Slug\n                <span className=\"text-red-500 ml-1\">*</span>\n              </label>\n              <input\n                id=\"slug\"\n                type=\"text\"\n                value={formSlug}\n                onChange={(e) => handleSlugChange(e.target.value)}\n                placeholder=\"our-story\"\n                required\n                className={`w-full px-3 py-2 border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 ${\n                  errors.slug ? 'border-red-500' : 'border-gray-300'\n                }`}\n                aria-invalid={!!errors.slug}\n                aria-describedby={errors.slug ? 'slug-error slug-help' : 'slug-help'}\n              />\n              <p id=\"slug-help\" className=\"text-xs text-gray-600\">\n                URL-safe identifier (lowercase, hyphens only). Auto-generated from title.\n              </p>\n              {slugPreview && (\n                <div className=\"mt-1 p-2 bg-gray-50 border border-gray-200 rounded\">\n                  <p className=\"text-xs text-gray-600 mb-1\">URL Preview:</p>\n                  <code className=\"text-sm text-green-700 font-mono\">{slugPreview}</code>\n                </div>\n              )}\n              {errors.slug && (\n                <p id=\"slug-error\" className=\"text-sm text-red-600\" role=\"alert\">\n                  {errors.slug}\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-3 pt-2\">\n            <button\n              type=\"submit\"\n              disabled={isSubmitting}\n              className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium\"\n            >\n              {isSubmitting ? 'Submitting...' : submitLabel}\n            </button>\n            <button\n              type=\"button\"\n              onClick={handleCancel}\n              disabled={isSubmitting}\n              className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium\"\n            >\n              {cancelLabel}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":["ContentPageForm","title","onSubmit","onCancel","initialData","isOpen","onToggle","submitLabel","cancelLabel","formTitle","setFormTitle","useState","formSlug","setFormSlug","slug","formStatus","setFormStatus","status","slugManuallyEdited","setSlugManuallyEdited","errors","setErrors","isSubmitting","setIsSubmitting","isDirty","setIsDirty","formRef","useRef","contentRef","useEffect","generateSlug","current","setTimeout","style","maxHeight","scrollHeight","scrollIntoView","behavior","block","recalculate","timer","clearTimeout","handleTitleChange","useCallback","value","prev","next","handleSlugChange","handleSubmit","e","preventDefault","validationErrors","trim","isValidSlug","Object","keys","length","error","console","_form","Error","message","handleCancel","confirmed","window","confirm","slugPreview","getSlugPreview","div","ref","className","button","onClick","aria-expanded","aria-controls","span","aria-hidden","id","opacity","form","role","p","label","htmlFor","input","type","onChange","target","placeholder","required","aria-invalid","aria-describedby","undefined","select","option","code","disabled"],"mappings":"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"}