{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/services/settingsService.homePageUpsert.property.test.ts"],"sourcesContent":["import * as fc from 'fast-check';\nimport { upsertHomePageConfig } from './settingsService';\nimport type { HomePageConfig } from '../schemas/settingsSchemas';\n\n/**\n * Feature: admin-ux-enhancements, Property 2: Home Page Settings Upsert\n * \n * **Validates: Requirements 2.1, 2.2**\n * \n * For any home page configuration update, the API should successfully create or update \n * settings without returning 500 errors, regardless of whether settings previously existed\n */\n\n// Mock the supabase module\njest.mock('../lib/supabase', () => ({\n  supabase: {\n    from: jest.fn(),\n  },\n}));\n\ndescribe('Feature: admin-ux-enhancements, Property 2: Home Page Settings Upsert', () => {\n  let mockSupabase: any;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    const { supabase } = require('../lib/supabase');\n    mockSupabase = supabase;\n  });\n\n  // Arbitrary for valid home page configuration\n  const validHomePageConfigArbitrary = fc.record({\n    title: fc.oneof(\n      fc.constant(null),\n      fc.string({ minLength: 1, maxLength: 200 })\n    ),\n    subtitle: fc.oneof(\n      fc.constant(null),\n      fc.string({ maxLength: 500 })\n    ),\n    welcomeMessage: fc.oneof(\n      fc.constant(null),\n      fc.string({ maxLength: 1000 })\n    ),\n    heroImageUrl: fc.oneof(\n      fc.constant(null),\n      fc.webUrl()\n    ),\n  });\n\n  // Arbitrary for partial home page configuration (at least one field)\n  const partialHomePageConfigArbitrary = fc.oneof(\n    fc.record({ title: fc.oneof(fc.constant(null), fc.string({ minLength: 1, maxLength: 200 })) }),\n    fc.record({ subtitle: fc.oneof(fc.constant(null), fc.string({ maxLength: 500 })) }),\n    fc.record({ welcomeMessage: fc.oneof(fc.constant(null), fc.string({ maxLength: 1000 })) }),\n    fc.record({ heroImageUrl: fc.oneof(fc.constant(null), fc.webUrl()) }),\n    validHomePageConfigArbitrary\n  );\n\n  it('should successfully upsert any valid home page configuration', async () => {\n    await fc.assert(\n      fc.asyncProperty(validHomePageConfigArbitrary, async (config) => {\n        // Mock successful upsert for all settings\n        mockSupabase.from.mockReturnValue({\n          upsert: jest.fn().mockReturnValue({\n            select: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({\n                data: {\n                  id: 'setting-1',\n                  key: 'test_key',\n                  value: 'test_value',\n                  description: 'Test',\n                  category: 'home_page',\n                  is_public: true,\n                  created_at: new Date().toISOString(),\n                  updated_at: new Date().toISOString(),\n                },\n                error: null,\n              }),\n            }),\n          }),\n        });\n\n        const result = await upsertHomePageConfig(config);\n\n        // Property: Should always succeed with valid configuration\n        expect(result.success).toBe(true);\n        \n        if (result.success) {\n          // Property: Returned data should match input\n          expect(result.data.title).toBe(config.title);\n          expect(result.data.subtitle).toBe(config.subtitle);\n          expect(result.data.welcomeMessage).toBe(config.welcomeMessage);\n          expect(result.data.heroImageUrl).toBe(config.heroImageUrl);\n        }\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should successfully upsert partial home page configuration', async () => {\n    await fc.assert(\n      fc.asyncProperty(partialHomePageConfigArbitrary, async (config) => {\n        // Mock successful upsert\n        mockSupabase.from.mockReturnValue({\n          upsert: jest.fn().mockReturnValue({\n            select: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({\n                data: {\n                  id: 'setting-1',\n                  key: 'test_key',\n                  value: 'test_value',\n                  description: 'Test',\n                  category: 'home_page',\n                  is_public: true,\n                  created_at: new Date().toISOString(),\n                  updated_at: new Date().toISOString(),\n                },\n                error: null,\n              }),\n            }),\n          }),\n        });\n\n        const result = await upsertHomePageConfig(config);\n\n        // Property: Should always succeed with partial configuration\n        expect(result.success).toBe(true);\n        \n        if (result.success) {\n          // Property: Only provided fields should be in result\n          if (config.title !== undefined) {\n            expect(result.data.title).toBe(config.title);\n          }\n          if (config.subtitle !== undefined) {\n            expect(result.data.subtitle).toBe(config.subtitle);\n          }\n          if (config.welcomeMessage !== undefined) {\n            expect(result.data.welcomeMessage).toBe(config.welcomeMessage);\n          }\n          if (config.heroImageUrl !== undefined) {\n            expect(result.data.heroImageUrl).toBe(config.heroImageUrl);\n          }\n        }\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should be idempotent - upserting same config multiple times produces same result', async () => {\n    await fc.assert(\n      fc.asyncProperty(validHomePageConfigArbitrary, async (config) => {\n        // Mock successful upsert\n        mockSupabase.from.mockReturnValue({\n          upsert: jest.fn().mockReturnValue({\n            select: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({\n                data: {\n                  id: 'setting-1',\n                  key: 'test_key',\n                  value: 'test_value',\n                  description: 'Test',\n                  category: 'home_page',\n                  is_public: true,\n                  created_at: new Date().toISOString(),\n                  updated_at: new Date().toISOString(),\n                },\n                error: null,\n              }),\n            }),\n          }),\n        });\n\n        // Upsert the same config twice\n        const result1 = await upsertHomePageConfig(config);\n        const result2 = await upsertHomePageConfig(config);\n\n        // Property: Both operations should succeed\n        expect(result1.success).toBe(true);\n        expect(result2.success).toBe(true);\n\n        // Property: Results should be identical\n        if (result1.success && result2.success) {\n          expect(result1.data).toEqual(result2.data);\n        }\n      }),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should reject invalid configurations with VALIDATION_ERROR', async () => {\n    // Arbitrary for invalid configurations\n    const invalidConfigArbitrary = fc.oneof(\n      // Empty title (fails min(1) validation)\n      fc.record({ title: fc.constant('') }),\n      // Title too long (fails max(200) validation)\n      fc.record({ title: fc.string({ minLength: 201, maxLength: 300 }) }),\n      // Subtitle too long (fails max(500) validation)\n      fc.record({ subtitle: fc.string({ minLength: 501, maxLength: 600 }) }),\n      // Invalid URL\n      fc.record({ heroImageUrl: fc.string().filter(s => !s.startsWith('http')) })\n    );\n\n    await fc.assert(\n      fc.asyncProperty(invalidConfigArbitrary, async (config) => {\n        const result = await upsertHomePageConfig(config as HomePageConfig);\n\n        // Property: Invalid configurations should always fail validation\n        expect(result.success).toBe(false);\n        \n        if (!result.success) {\n          expect(result.error.code).toBe('VALIDATION_ERROR');\n          expect(result.error.message).toBe('Invalid home page configuration');\n        }\n      }),\n      { numRuns: 100 }\n    );\n  });\n\n  it('should handle null values correctly without errors', async () => {\n    const nullConfigArbitrary = fc.record({\n      title: fc.constant(null),\n      subtitle: fc.constant(null),\n      welcomeMessage: fc.constant(null),\n      heroImageUrl: fc.constant(null),\n    });\n\n    await fc.assert(\n      fc.asyncProperty(nullConfigArbitrary, async (config) => {\n        // Mock successful upsert\n        mockSupabase.from.mockReturnValue({\n          upsert: jest.fn().mockReturnValue({\n            select: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({\n                data: {\n                  id: 'setting-1',\n                  key: 'test_key',\n                  value: null,\n                  description: 'Test',\n                  category: 'home_page',\n                  is_public: true,\n                  created_at: new Date().toISOString(),\n                  updated_at: new Date().toISOString(),\n                },\n                error: null,\n              }),\n            }),\n          }),\n        });\n\n        const result = await upsertHomePageConfig(config);\n\n        // Property: Null values should be accepted\n        expect(result.success).toBe(true);\n        \n        if (result.success) {\n          expect(result.data.title).toBeNull();\n          expect(result.data.subtitle).toBeNull();\n          expect(result.data.welcomeMessage).toBeNull();\n          expect(result.data.heroImageUrl).toBeNull();\n        }\n      }),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should return DATABASE_ERROR when database operation fails, not 500 error', async () => {\n    await fc.assert(\n      fc.asyncProperty(validHomePageConfigArbitrary, async (config) => {\n        // Mock database failure\n        mockSupabase.from.mockReturnValue({\n          upsert: jest.fn().mockReturnValue({\n            select: jest.fn().mockReturnValue({\n              single: jest.fn().mockResolvedValue({\n                data: null,\n                error: { message: 'Database connection failed', code: 'CONNECTION_ERROR' },\n              }),\n            }),\n          }),\n        });\n\n        const result = await upsertHomePageConfig(config);\n\n        // Property: Database errors should be handled gracefully\n        expect(result.success).toBe(false);\n        \n        if (!result.success) {\n          // Should return structured error, not throw 500\n          expect(result.error.code).toBe('DATABASE_ERROR');\n          expect(result.error.message).toBe('Failed to update some home page settings');\n        }\n      }),\n      { numRuns: 50 }\n    );\n  });\n\n  it('should handle sequential updates correctly', async () => {\n    await fc.assert(\n      fc.asyncProperty(\n        validHomePageConfigArbitrary,\n        validHomePageConfigArbitrary,\n        async (config1, config2) => {\n          // Mock successful upsert\n          mockSupabase.from.mockReturnValue({\n            upsert: jest.fn().mockReturnValue({\n              select: jest.fn().mockReturnValue({\n                single: jest.fn().mockResolvedValue({\n                  data: {\n                    id: 'setting-1',\n                    key: 'test_key',\n                    value: 'test_value',\n                    description: 'Test',\n                    category: 'home_page',\n                    is_public: true,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString(),\n                  },\n                  error: null,\n                }),\n              }),\n            }),\n          });\n\n          // Update with first config\n          const result1 = await upsertHomePageConfig(config1);\n          \n          // Update with second config\n          const result2 = await upsertHomePageConfig(config2);\n\n          // Property: Both operations should succeed\n          expect(result1.success).toBe(true);\n          expect(result2.success).toBe(true);\n\n          // Property: Second result should reflect second config\n          if (result2.success) {\n            expect(result2.data.title).toBe(config2.title);\n            expect(result2.data.subtitle).toBe(config2.subtitle);\n            expect(result2.data.welcomeMessage).toBe(config2.welcomeMessage);\n            expect(result2.data.heroImageUrl).toBe(config2.heroImageUrl);\n          }\n        }\n      ),\n      { numRuns: 50 }\n    );\n  });\n});\n"],"names":["jest","mock","supabase","from","fn","describe","mockSupabase","beforeEach","clearAllMocks","require","validHomePageConfigArbitrary","fc","record","title","oneof","constant","string","minLength","maxLength","subtitle","welcomeMessage","heroImageUrl","webUrl","partialHomePageConfigArbitrary","it","assert","asyncProperty","config","mockReturnValue","upsert","select","single","mockResolvedValue","data","id","key","value","description","category","is_public","created_at","Date","toISOString","updated_at","error","result","upsertHomePageConfig","expect","success","toBe","numRuns","undefined","result1","result2","toEqual","invalidConfigArbitrary","filter","s","startsWith","code","message","nullConfigArbitrary","toBeNull","config1","config2"],"mappings":"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"}