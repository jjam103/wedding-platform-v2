{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/__tests__/regression/photoFieldConsistency.regression.test.ts"],"sourcesContent":["/**\n * Photo Field Name Consistency Regression Tests\n * \n * Purpose: Prevent regression where components use wrong field name for photo URLs\n * \n * Background:\n * - Database schema uses 'photo_url' field (not 'url')\n * - All components must consistently use 'photo_url'\n * - API responses must include 'photo_url'\n * - No components should use deprecated 'url' field\n * \n * This test suite validates:\n * 1. Database schema has photo_url column\n * 2. API responses include photo_url field\n * 3. All photo-related components use photo_url\n * 4. No components use deprecated 'url' field\n */\n\nimport { createClient } from '@supabase/supabase-js';\nimport { readFileSync } from 'fs';\nimport { join } from 'path';\n\n// Test database connection\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\ndescribe('Photo Field Name Consistency Regression Tests', () => {\n  describe('34.9 Database Schema Verification', () => {\n    it('should have photo_url column in photos table', async () => {\n      // Query the information schema to verify column exists\n      const { data, error } = await supabase\n        .from('photos')\n        .select('photo_url')\n        .limit(1);\n\n      // Should not error (column exists)\n      expect(error).toBeNull();\n      \n      // Verify the query structure is correct\n      expect(data).toBeDefined();\n    });\n\n    it('should not have deprecated url column in photos table', async () => {\n      // Try to query a non-existent 'url' column\n      const { error } = await supabase\n        .from('photos')\n        .select('url')\n        .limit(1);\n\n      // Should error because 'url' column doesn't exist\n      expect(error).not.toBeNull();\n      expect(error?.message).toContain('column');\n    });\n\n    it('should have photo_url as TEXT NOT NULL in schema', async () => {\n      // Read the migration file to verify schema definition\n      const migrationPath = join(process.cwd(), 'supabase/migrations/007_create_photos_table.sql');\n      const migrationContent = readFileSync(migrationPath, 'utf-8');\n\n      // Verify photo_url is defined correctly\n      expect(migrationContent).toContain('photo_url TEXT NOT NULL');\n      \n      // Verify no 'url' column exists\n      expect(migrationContent).not.toMatch(/\\burl\\s+TEXT/i);\n    });\n  });\n\n  describe('34.7 API Response Verification', () => {\n    let testPhotoId: string;\n\n    beforeAll(async () => {\n      // Create a test photo for API testing\n      const { data: photo, error } = await supabase\n        .from('photos')\n        .insert({\n          uploader_id: '00000000-0000-0000-0000-000000000000', // Test user\n          photo_url: 'https://test.example.com/test-photo.jpg',\n          storage_type: 'b2',\n          page_type: 'memory',\n          page_id: '00000000-0000-0000-0000-000000000000',\n          caption: 'Test Photo for Field Consistency',\n          alt_text: 'Test photo',\n          moderation_status: 'approved',\n        })\n        .select('id')\n        .single();\n\n      if (photo) {\n        testPhotoId = photo.id;\n      }\n    });\n\n    afterAll(async () => {\n      // Clean up test photo\n      if (testPhotoId) {\n        await supabase.from('photos').delete().eq('id', testPhotoId);\n      }\n    });\n\n    it('should return photo_url field in API response', async () => {\n      if (!testPhotoId) {\n        console.warn('Test photo not created, skipping API test');\n        return;\n      }\n\n      const { data: photo, error } = await supabase\n        .from('photos')\n        .select('*')\n        .eq('id', testPhotoId)\n        .single();\n\n      expect(error).toBeNull();\n      expect(photo).toBeDefined();\n      expect(photo).toHaveProperty('photo_url');\n      expect(typeof photo.photo_url).toBe('string');\n    });\n\n    it('should not return deprecated url field in API response', async () => {\n      if (!testPhotoId) {\n        console.warn('Test photo not created, skipping API test');\n        return;\n      }\n\n      const { data: photo, error } = await supabase\n        .from('photos')\n        .select('*')\n        .eq('id', testPhotoId)\n        .single();\n\n      expect(error).toBeNull();\n      expect(photo).toBeDefined();\n      expect(photo).not.toHaveProperty('url');\n    });\n\n    it('should include photo_url in list responses', async () => {\n      const { data: photos, error } = await supabase\n        .from('photos')\n        .select('id, photo_url, caption')\n        .eq('moderation_status', 'approved')\n        .limit(5);\n\n      expect(error).toBeNull();\n      expect(photos).toBeDefined();\n      \n      if (photos && photos.length > 0) {\n        photos.forEach(photo => {\n          expect(photo).toHaveProperty('photo_url');\n          expect(typeof photo.photo_url).toBe('string');\n          expect(photo).not.toHaveProperty('url');\n        });\n      }\n    });\n  });\n\n  describe('34.2 PhotoGallery Component Verification', () => {\n    it('should use photo_url field in PhotoGallery component', () => {\n      const componentPath = join(process.cwd(), 'components/guest/PhotoGallery.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify photo_url is used in interface\n      expect(componentContent).toContain('photo_url: string');\n      \n      // Verify photo_url is used in Image src\n      expect(componentContent).toContain('src={photo.photo_url}');\n      expect(componentContent).toContain('src={currentPhoto.photo_url}');\n      \n      // Verify no deprecated 'url' field is used\n      expect(componentContent).not.toMatch(/photo\\.url[^_]/);\n      expect(componentContent).not.toMatch(/currentPhoto\\.url[^_]/);\n    });\n\n    it('should define Photo interface with photo_url', () => {\n      const componentPath = join(process.cwd(), 'components/guest/PhotoGallery.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify interface definition\n      const interfaceMatch = componentContent.match(/interface Photo \\{[^}]+\\}/s);\n      expect(interfaceMatch).toBeTruthy();\n      \n      if (interfaceMatch) {\n        const interfaceContent = interfaceMatch[0];\n        expect(interfaceContent).toContain('photo_url: string');\n        expect(interfaceContent).not.toContain('url: string');\n      }\n    });\n  });\n\n  describe('34.4 PhotoPicker Component Verification', () => {\n    it('should use photo_url field in PhotoPicker component', () => {\n      const componentPath = join(process.cwd(), 'components/admin/PhotoPicker.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify photo_url is used in interface\n      expect(componentContent).toContain('photo_url: string');\n      \n      // Verify photo_url is used in img src\n      expect(componentContent).toContain('src={photo.photo_url}');\n      \n      // Verify no deprecated 'url' field is used\n      expect(componentContent).not.toMatch(/photo\\.url[^_]/);\n    });\n\n    it('should display selected photos using photo_url', () => {\n      const componentPath = join(process.cwd(), 'components/admin/PhotoPicker.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify selected photos section uses photo_url\n      const selectedPhotosSection = componentContent.match(/Selected Photos[\\s\\S]*?<\\/div>/);\n      expect(selectedPhotosSection).toBeTruthy();\n      \n      // Verify photo_url is used in the selected photos display\n      expect(componentContent).toContain('src={photo.photo_url}');\n    });\n  });\n\n  describe('34.3 PhotoGalleryPreview Component Verification', () => {\n    it('should use photo_url field if PhotoGalleryPreview component exists', () => {\n      const componentPath = join(process.cwd(), 'components/admin/PhotoGalleryPreview.tsx');\n      \n      try {\n        const componentContent = readFileSync(componentPath, 'utf-8');\n\n        // Verify photo_url is used\n        expect(componentContent).toContain('photo_url');\n        \n        // Verify no deprecated 'url' field is used\n        expect(componentContent).not.toMatch(/photo\\.url[^_]/);\n      } catch (error) {\n        // Component might not exist yet, which is okay\n        console.warn('PhotoGalleryPreview component not found, skipping test');\n      }\n    });\n  });\n\n  describe('34.6 SectionRenderer Component Verification', () => {\n    it('should use photo_url field in SectionRenderer component', () => {\n      const componentPath = join(process.cwd(), 'components/guest/SectionRenderer.tsx');\n      const componentContent = readFileSync(componentPath, 'utf-8');\n\n      // Verify PhotoGallery is used (which uses photo_url)\n      expect(componentContent).toContain('PhotoGallery');\n      expect(componentContent).toContain('photoIds={column.content_data?.photo_ids || []}');\n      \n      // SectionRenderer delegates to PhotoGallery, so it indirectly uses photo_url\n      // No direct photo_url usage expected in SectionRenderer\n    });\n  });\n\n  describe('34.5 RichTextEditor Component Verification', () => {\n    it('should use photo_url field if RichTextEditor handles photos', () => {\n      const componentPath = join(process.cwd(), 'components/admin/RichTextEditor.tsx');\n      \n      try {\n        const componentContent = readFileSync(componentPath, 'utf-8');\n\n        // If RichTextEditor handles photos, it should use photo_url\n        if (componentContent.includes('photo') || componentContent.includes('image')) {\n          // Check for photo_url usage\n          const hasPhotoUrl = componentContent.includes('photo_url');\n          const hasDeprecatedUrl = componentContent.match(/photo\\.url[^_]/);\n          \n          if (hasPhotoUrl || hasDeprecatedUrl) {\n            expect(hasPhotoUrl).toBe(true);\n            expect(hasDeprecatedUrl).toBeFalsy();\n          }\n        }\n      } catch (error) {\n        // Component might not exist yet, which is okay\n        console.warn('RichTextEditor component not found, skipping test');\n      }\n    });\n  });\n\n  describe('34.8 No Deprecated url Field Usage', () => {\n    const componentsToCheck = [\n      'components/guest/PhotoGallery.tsx',\n      'components/admin/PhotoPicker.tsx',\n      'components/guest/SectionRenderer.tsx',\n    ];\n\n    componentsToCheck.forEach(componentPath => {\n      it(`should not use deprecated url field in ${componentPath}`, () => {\n        const fullPath = join(process.cwd(), componentPath);\n        \n        try {\n          const componentContent = readFileSync(fullPath, 'utf-8');\n\n          // Check for deprecated patterns\n          const deprecatedPatterns = [\n            /photo\\.url[^_]/g,  // photo.url (not photo.photo_url)\n            /currentPhoto\\.url[^_]/g,  // currentPhoto.url\n            /\\burl:\\s*string/g,  // url: string in interface (should be photo_url)\n          ];\n\n          deprecatedPatterns.forEach(pattern => {\n            const matches = componentContent.match(pattern);\n            if (matches) {\n              console.error(`Found deprecated pattern in ${componentPath}:`, matches);\n            }\n            expect(matches).toBeNull();\n          });\n        } catch (error) {\n          // Component might not exist, skip\n          console.warn(`Component ${componentPath} not found, skipping test`);\n        }\n      });\n    });\n  });\n\n  describe('34.10 Service Layer Verification', () => {\n    it('should use photo_url field in photoService', () => {\n      const servicePath = join(process.cwd(), 'services/photoService.ts');\n      \n      try {\n        const serviceContent = readFileSync(servicePath, 'utf-8');\n\n        // Verify photo_url is used in service\n        expect(serviceContent).toContain('photo_url');\n        \n        // Check for any deprecated 'url' field usage\n        // Allow 'url' in variable names like 'photoUrl' or 'cdnUrl'\n        const deprecatedMatches = serviceContent.match(/\\burl:\\s*string/g);\n        if (deprecatedMatches) {\n          // Filter out valid uses like 'photo_url' or 'cdnUrl'\n          const invalidMatches = deprecatedMatches.filter(match => \n            !match.includes('photo_url') && \n            !match.includes('cdnUrl') &&\n            !match.includes('storageUrl')\n          );\n          expect(invalidMatches.length).toBe(0);\n        }\n      } catch (error) {\n        console.warn('photoService not found, skipping test');\n      }\n    });\n  });\n\n  describe('Integration: End-to-End Field Consistency', () => {\n    it('should maintain photo_url consistency from database to UI', async () => {\n      // This test verifies the complete data flow:\n      // Database (photo_url) → API → Service → Component\n\n      // 1. Verify database has photo_url\n      const { data: dbPhoto, error: dbError } = await supabase\n        .from('photos')\n        .select('photo_url')\n        .eq('moderation_status', 'approved')\n        .limit(1)\n        .single();\n\n      if (dbError && dbError.code !== 'PGRST116') {\n        // PGRST116 is \"no rows returned\", which is okay\n        expect(dbError).toBeNull();\n      }\n\n      if (dbPhoto) {\n        // 2. Verify photo_url is a valid string\n        expect(dbPhoto).toHaveProperty('photo_url');\n        expect(typeof dbPhoto.photo_url).toBe('string');\n        expect(dbPhoto.photo_url.length).toBeGreaterThan(0);\n\n        // 3. Verify no 'url' field exists\n        expect(dbPhoto).not.toHaveProperty('url');\n      }\n    });\n\n    it('should use consistent field naming across all photo-related files', () => {\n      const filesToCheck = [\n        'components/guest/PhotoGallery.tsx',\n        'components/admin/PhotoPicker.tsx',\n        'components/guest/SectionRenderer.tsx',\n        'supabase/migrations/007_create_photos_table.sql',\n      ];\n\n      const results = filesToCheck.map(filePath => {\n        const fullPath = join(process.cwd(), filePath);\n        try {\n          const content = readFileSync(fullPath, 'utf-8');\n          return {\n            file: filePath,\n            hasPhotoUrl: content.includes('photo_url'),\n            hasDeprecatedUrl: content.match(/\\burl\\s*:/g) !== null,\n          };\n        } catch (error) {\n          return {\n            file: filePath,\n            hasPhotoUrl: false,\n            hasDeprecatedUrl: false,\n            error: 'File not found',\n          };\n        }\n      });\n\n      // All files should use photo_url\n      results.forEach(result => {\n        if (!result.error) {\n          expect(result.hasPhotoUrl).toBe(true);\n        }\n      });\n\n      // Log results for debugging\n      console.log('Field consistency check results:', results);\n    });\n  });\n});\n"],"names":["supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","describe","it","data","error","from","select","limit","expect","toBeNull","toBeDefined","not","message","toContain","migrationPath","join","cwd","migrationContent","readFileSync","toMatch","testPhotoId","beforeAll","photo","insert","uploader_id","photo_url","storage_type","page_type","page_id","caption","alt_text","moderation_status","single","id","afterAll","delete","eq","console","warn","toHaveProperty","toBe","photos","length","forEach","componentPath","componentContent","interfaceMatch","match","toBeTruthy","interfaceContent","selectedPhotosSection","includes","hasPhotoUrl","hasDeprecatedUrl","toBeFalsy","componentsToCheck","fullPath","deprecatedPatterns","pattern","matches","servicePath","serviceContent","deprecatedMatches","invalidMatches","filter","dbPhoto","dbError","code","toBeGreaterThan","filesToCheck","results","map","filePath","content","file","result","log"],"mappings":"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"}