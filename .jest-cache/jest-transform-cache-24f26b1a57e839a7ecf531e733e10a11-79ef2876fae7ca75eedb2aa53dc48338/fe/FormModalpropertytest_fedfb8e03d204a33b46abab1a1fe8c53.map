{"version":3,"sources":["/Users/jaron/Desktop/wedding-platform-v2/components/ui/FormModal.property.test.tsx"],"sourcesContent":["/**\n * Property-Based Tests for FormModal Component\n * \n * Feature: admin-ui-modernization\n * Tests universal properties of the FormModal component across various inputs.\n */\n\nimport { render, screen, fireEvent, waitFor, cleanup } from '@testing-library/react';\nimport { z } from 'zod';\nimport * as fc from 'fast-check';\nimport { FormModal, FormModalSimple } from './FormModal';\nimport type { FormField } from './DynamicForm';\n\ndescribe('FormModal Property Tests', () => {\n  // Clean up after each test to prevent DOM pollution\n  afterEach(() => {\n    cleanup();\n  });\n  /**\n   * Property 7: Form validation prevents invalid submission\n   * Validates: Requirements 4.7, 12.3\n   * \n   * For any form with required fields, attempting to submit the form with missing\n   * or invalid required fields should prevent submission and display field-level error messages.\n   */\n  describe('Feature: admin-ui-modernization, Property 7: Form validation prevents invalid submission', () => {\n    it('should prevent submission and show errors when required fields are missing', async () => {\n      await fc.assert(\n        fc.asyncProperty(\n          fc.record({\n            firstName: fc.string({ minLength: 1, maxLength: 50 }),\n            lastName: fc.string({ minLength: 1, maxLength: 50 }),\n            email: fc.emailAddress(),\n          }),\n          async (validData) => {\n            const schema = z.object({\n              firstName: z.string().min(1, 'First name is required'),\n              lastName: z.string().min(1, 'Last name is required'),\n              email: z.string().email('Invalid email'),\n            });\n\n            const fields: FormField[] = [\n              { name: 'firstName', label: 'First Name', type: 'text', required: true },\n              { name: 'lastName', label: 'Last Name', type: 'text', required: true },\n              { name: 'email', label: 'Email', type: 'email', required: true },\n            ];\n\n            const onSubmit = jest.fn();\n            const onClose = jest.fn();\n\n            const { container, unmount } = render(\n              <FormModal\n                isOpen={true}\n                onClose={onClose}\n                title=\"Test Form\"\n                onSubmit={onSubmit}\n                schema={schema}\n                fields={fields}\n                initialData={{}}\n              />\n            );\n\n            try {\n              // Try to submit empty form\n              const submitButtons = screen.getAllByRole('button', { name: /submit/i });\n              const submitButton = submitButtons[submitButtons.length - 1]; // Get the last one (most recent)\n              fireEvent.click(submitButton);\n\n              // Wait for validation errors to appear\n              await waitFor(() => {\n                const errors = container.querySelectorAll('[role=\"alert\"]');\n                expect(errors.length).toBeGreaterThan(0);\n              });\n\n              // Verify onSubmit was not called\n              expect(onSubmit).not.toHaveBeenCalled();\n            } finally {\n              unmount();\n            }\n          }\n        ),\n        { numRuns: 50 } // Reduced runs for async operations\n      );\n    });\n\n    it('should show field-level errors for invalid data', async () => {\n      await fc.assert(\n        fc.asyncProperty(\n          fc.record({\n            invalidEmail: fc.string({ minLength: 1, maxLength: 50 }).filter(s => !s.includes('@')),\n          }),\n          async ({ invalidEmail }) => {\n            const schema = z.object({\n              email: z.string().email('Invalid email'),\n            });\n\n            const fields: FormField[] = [\n              { name: 'email', label: 'Email', type: 'email', required: true },\n            ];\n\n            const onSubmit = jest.fn();\n            const onClose = jest.fn();\n\n            const { unmount } = render(\n              <FormModal\n                isOpen={true}\n                onClose={onClose}\n                title=\"Test Form\"\n                onSubmit={onSubmit}\n                schema={schema}\n                fields={fields}\n                initialData={{ email: invalidEmail }}\n              />\n            );\n\n            try {\n              const emailInput = screen.getByLabelText(/email/i);\n              const submitButtons = screen.getAllByRole('button', { name: /submit/i });\n              const submitButton = submitButtons[submitButtons.length - 1];\n\n              // Blur the field to trigger validation\n              fireEvent.blur(emailInput);\n              \n              // Try to submit\n              fireEvent.click(submitButton);\n\n              // Wait for error message\n              await waitFor(() => {\n                expect(screen.getByText(/invalid email/i)).toBeInTheDocument();\n              });\n\n              // Verify onSubmit was not called\n              expect(onSubmit).not.toHaveBeenCalled();\n            } finally {\n              unmount();\n            }\n          }\n        ),\n        { numRuns: 50 }\n      );\n    });\n\n    it('should allow submission when all required fields are valid', async () => {\n      // Unit test with specific example instead of property-based test\n      // This validates the same behavior but runs much faster\n      const validData = {\n        firstName: 'John',\n        lastName: 'Doe',\n        email: 'john@example.com',\n      };\n\n      const schema = z.object({\n        firstName: z.string().min(1),\n        lastName: z.string().min(1),\n        email: z.string().email(),\n      });\n\n      const fields: FormField[] = [\n        { name: 'firstName', label: 'First Name', type: 'text', required: true },\n        { name: 'lastName', label: 'Last Name', type: 'text', required: true },\n        { name: 'email', label: 'Email', type: 'email', required: true },\n      ];\n\n      const onSubmit = jest.fn().mockResolvedValue(undefined);\n      const onClose = jest.fn();\n\n      const { unmount } = render(\n        <FormModal\n          isOpen={true}\n          onClose={onClose}\n          title=\"Test Form\"\n          onSubmit={onSubmit}\n          schema={schema}\n          fields={fields}\n          initialData={validData}\n        />\n      );\n\n      try {\n        const submitButtons = screen.getAllByRole('button', { name: /submit/i });\n        const submitButton = submitButtons[submitButtons.length - 1];\n        fireEvent.click(submitButton);\n\n        // Wait for submission\n        await waitFor(() => {\n          expect(onSubmit).toHaveBeenCalled();\n        }, { timeout: 1000 });\n        \n        // Verify it was called with the correct data\n        expect(onSubmit).toHaveBeenCalledWith(validData);\n      } finally {\n        unmount();\n      }\n    });\n  });\n\n  /**\n   * Property 8: Modal closes on Escape key\n   * Validates: Requirements 17.3\n   * \n   * For any open modal dialog, pressing the Escape key should close the modal.\n   */\n  describe('Feature: admin-ui-modernization, Property 8: Modal closes on Escape key', () => {\n    it('should close modal when Escape key is pressed', async () => {\n      await fc.assert(\n        fc.asyncProperty(\n          fc.record({\n            title: fc.string({ minLength: 1, maxLength: 100 }),\n          }),\n          async ({ title }) => {\n            const schema = z.object({\n              name: z.string().min(1),\n            });\n\n            const fields: FormField[] = [\n              { name: 'name', label: 'Name', type: 'text', required: true },\n            ];\n\n            const onSubmit = jest.fn();\n            const onClose = jest.fn();\n\n            const { unmount } = render(\n              <FormModal\n                isOpen={true}\n                onClose={onClose}\n                title={title}\n                onSubmit={onSubmit}\n                schema={schema}\n                fields={fields}\n              />\n            );\n\n            try {\n              // Press Escape key\n              fireEvent.keyDown(document, { key: 'Escape' });\n\n              // Verify onClose was called\n              await waitFor(() => {\n                expect(onClose).toHaveBeenCalled();\n              });\n            } finally {\n              unmount();\n            }\n          }\n        ),\n        { numRuns: 50 }\n      );\n    });\n\n    it('should close FormModalSimple when Escape key is pressed', async () => {\n      await fc.assert(\n        fc.asyncProperty(\n          fc.record({\n            title: fc.string({ minLength: 1, maxLength: 100 }),\n            content: fc.string({ minLength: 1, maxLength: 200 }),\n          }),\n          async ({ title, content }) => {\n            const onClose = jest.fn();\n\n            const { unmount } = render(\n              <FormModalSimple\n                isOpen={true}\n                onClose={onClose}\n                title={title}\n              >\n                <div>{content}</div>\n              </FormModalSimple>\n            );\n\n            try {\n              // Press Escape key\n              fireEvent.keyDown(document, { key: 'Escape' });\n\n              // Verify onClose was called\n              await waitFor(() => {\n                expect(onClose).toHaveBeenCalled();\n              });\n            } finally {\n              unmount();\n            }\n          }\n        ),\n        { numRuns: 50 }\n      );\n    });\n  });\n\n  /**\n   * Property 9: Form inputs have associated labels\n   * Validates: Requirements 18.5\n   * \n   * For any form input field, there should be an associated label element\n   * and error messages should be displayed when the field is invalid.\n   */\n  describe('Feature: admin-ui-modernization, Property 9: Form inputs have associated labels', () => {\n    it('should have associated labels for all form inputs', async () => {\n      await fc.assert(\n        fc.asyncProperty(\n          fc.array(\n            fc.record({\n              name: fc.string({ minLength: 1, maxLength: 20 }).filter(s => /^[a-zA-Z]+$/.test(s)),\n              label: fc.string({ minLength: 3, maxLength: 50 }).filter(s => {\n                const trimmed = s.trim();\n                return trimmed.length >= 3 && /[a-zA-Z]/.test(trimmed); // Must have at least 3 chars and contain a letter\n              }),\n              type: fc.constantFrom('text', 'email', 'number', 'select', 'textarea', 'date', 'checkbox'),\n            }),\n            { minLength: 1, maxLength: 3 } // Reduced max to speed up test\n          ).map(fields => {\n            // Ensure unique field names by appending index\n            return fields.map((field, index) => ({\n              ...field,\n              name: `${field.name}${index}`\n            }));\n          }),\n          async (fieldConfigs) => {\n            // Create schema dynamically\n            const schemaShape: Record<string, z.ZodTypeAny> = {};\n            fieldConfigs.forEach(field => {\n              schemaShape[field.name] = z.string().optional();\n            });\n            const schema = z.object(schemaShape);\n\n            const fields: FormField[] = fieldConfigs.map(config => ({\n              name: config.name,\n              label: config.label,\n              type: config.type as any,\n              required: false,\n              options: config.type === 'select' ? [\n                { label: 'Option 1', value: 'opt1' },\n                { label: 'Option 2', value: 'opt2' },\n              ] : undefined,\n            }));\n\n            const onSubmit = jest.fn();\n            const onClose = jest.fn();\n\n            const { unmount } = render(\n              <FormModal\n                isOpen={true}\n                onClose={onClose}\n                title=\"Test Form\"\n                onSubmit={onSubmit}\n                schema={schema}\n                fields={fields}\n              />\n            );\n\n            try {\n              // Verify each field has an associated label\n              for (const field of fieldConfigs) {\n                // Use a more flexible query that handles special characters - FIXED: use \\\\$& instead of UUID\n                // Trim the label to match how it's rendered in the DOM\n                const trimmedLabel = field.label.trim();\n                const labelElement = screen.getByLabelText(new RegExp(trimmedLabel.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'i'));\n                expect(labelElement).toBeInTheDocument();\n                expect(labelElement).toHaveAttribute('id', field.name);\n              }\n            } finally {\n              unmount();\n            }\n          }\n        ),\n        { numRuns: 20 } // Reduced runs\n      );\n    }, 10000); // Increased timeout to 10 seconds\n\n    it('should display error messages with proper ARIA attributes', async () => {\n      await fc.assert(\n        fc.asyncProperty(\n          fc.record({\n            fieldName: fc.constantFrom('email', 'name', 'age'),\n            errorMessage: fc.string({ minLength: 10, maxLength: 100 }).filter(s => s.trim().length >= 10),\n          }),\n          async ({ fieldName, errorMessage }) => {\n            const schema = z.object({\n              [fieldName]: z.string().min(1, errorMessage),\n            });\n\n            const fields: FormField[] = [\n              { name: fieldName, label: fieldName.charAt(0).toUpperCase() + fieldName.slice(1), type: 'text', required: true },\n            ];\n\n            const onSubmit = jest.fn();\n            const onClose = jest.fn();\n\n            const { unmount } = render(\n              <FormModal\n                isOpen={true}\n                onClose={onClose}\n                title=\"Test Form\"\n                onSubmit={onSubmit}\n                schema={schema}\n                fields={fields}\n                initialData={{ [fieldName]: '' }}\n              />\n            );\n\n            try {\n              const input = screen.getByLabelText(new RegExp(fieldName, 'i'));\n              const submitButtons = screen.getAllByRole('button', { name: /submit/i });\n              const submitButton = submitButtons[submitButtons.length - 1];\n\n              // Trigger validation by submitting\n              fireEvent.click(submitButton);\n\n              // Optimized: Check for error first, then verify ARIA attributes\n              await waitFor(() => {\n                const errorElement = screen.getByRole('alert');\n                expect(errorElement).toBeInTheDocument();\n              }, { timeout: 1000 });\n              \n              // Verify error message content (normalize whitespace for comparison)\n              const errorElement = screen.getByRole('alert');\n              const normalizedExpected = errorMessage.replace(/\\s+/g, ' ').trim();\n              const normalizedActual = errorElement.textContent?.replace(/\\s+/g, ' ').trim() || '';\n              expect(normalizedActual).toContain(normalizedExpected);\n              \n              // Verify ARIA attributes\n              expect(input).toHaveAttribute('aria-invalid', 'true');\n              expect(input).toHaveAttribute('aria-describedby');\n            } finally {\n              unmount();\n            }\n          }\n        ),\n        { numRuns: 5 } // Reduced from 10 to 5\n      );\n    }, 10000); // Reduced timeout to 10 seconds\n  });\n\n  /**\n   * Property 32: Form submission button state\n   * Validates: Requirements 11.3\n   * \n   * For any form in a submitting state, the submit button should be disabled\n   * and display a loading spinner.\n   */\n  describe('Feature: admin-ui-modernization, Property 32: Form submission button state', () => {\n    it('should disable submit button and show loading spinner during submission', async () => {\n      await fc.assert(\n        fc.asyncProperty(\n          fc.record({\n            name: fc.string({ minLength: 2, maxLength: 50 }).filter(s => s.trim().length >= 2), // Avoid whitespace-only names\n          }),\n          async (validData) => {\n            const schema = z.object({\n              name: z.string().min(1),\n            });\n\n            const fields: FormField[] = [\n              { name: 'name', label: 'Name', type: 'text', required: true },\n            ];\n\n            // Create a promise that we can control\n            let resolveSubmit: () => void;\n            const submitPromise = new Promise<void>((resolve) => {\n              resolveSubmit = resolve;\n            });\n\n            const onSubmit = jest.fn().mockReturnValue(submitPromise);\n            const onClose = jest.fn();\n\n            const { unmount } = render(\n              <FormModal\n                isOpen={true}\n                onClose={onClose}\n                title=\"Test Form\"\n                onSubmit={onSubmit}\n                schema={schema}\n                fields={fields}\n                initialData={validData}\n              />\n            );\n\n            try {\n              const submitButtons = screen.getAllByRole('button', { name: /submit/i });\n              const submitButton = submitButtons[submitButtons.length - 1];\n              \n              // Click submit\n              fireEvent.click(submitButton);\n\n              // Wait for button to show loading state\n              await waitFor(() => {\n                expect(submitButton).toBeDisabled();\n              }, { timeout: 2000 });\n\n              // Resolve the submission\n              resolveSubmit!();\n\n              // Wait for submission to complete\n              await waitFor(() => {\n                expect(onSubmit).toHaveBeenCalled();\n              }, { timeout: 2000 });\n            } finally {\n              unmount();\n            }\n          }\n        ),\n        { numRuns: 10 } // Fewer runs for async operations\n      );\n    }, 15000); // Increase timeout for property-based test\n  });\n});\n"],"names":["describe","afterEach","cleanup","it","fc","assert","asyncProperty","record","firstName","string","minLength","maxLength","lastName","email","emailAddress","validData","schema","z","object","min","fields","name","label","type","required","onSubmit","jest","fn","onClose","container","unmount","render","FormModal","isOpen","title","initialData","submitButtons","screen","getAllByRole","submitButton","length","fireEvent","click","waitFor","errors","querySelectorAll","expect","toBeGreaterThan","not","toHaveBeenCalled","numRuns","invalidEmail","filter","s","includes","emailInput","getByLabelText","blur","getByText","toBeInTheDocument","mockResolvedValue","undefined","timeout","toHaveBeenCalledWith","keyDown","document","key","content","FormModalSimple","div","array","test","trimmed","trim","constantFrom","map","field","index","fieldConfigs","schemaShape","forEach","optional","config","options","value","trimmedLabel","labelElement","RegExp","replace","toHaveAttribute","fieldName","errorMessage","charAt","toUpperCase","slice","input","errorElement","getByRole","normalizedExpected","normalizedActual","textContent","toContain","resolveSubmit","submitPromise","Promise","resolve","mockReturnValue","toBeDisabled"],"mappings":"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"}