2d1b9f911ada5b1053569071165e2a84
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "GET", {
    enumerable: true,
    get: function() {
        return GET;
    }
});
const _ssr = require("@supabase/ssr");
const _headers = require("next/headers");
const _server = require("next/server");
const _budgetService = /*#__PURE__*/ _interop_require_wildcard(require("../../../../../services/budgetService"));
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
async function GET() {
    try {
        // Check authentication
        const cookieStore = await (0, _headers.cookies)();
        const supabase = (0, _ssr.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY, {
            cookies: {
                getAll () {
                    return cookieStore.getAll();
                },
                setAll (cookiesToSet) {
                    cookiesToSet.forEach(({ name, value })=>{
                        cookieStore.set(name, value);
                    });
                }
            }
        });
        const { data: { session }, error: authError } = await supabase.auth.getSession();
        if (authError || !session) {
            return _server.NextResponse.json({
                success: false,
                error: {
                    code: 'UNAUTHORIZED',
                    message: 'Authentication required'
                }
            }, {
                status: 401
            });
        }
        // Get budget breakdown
        const result = await _budgetService.calculateTotal({
            includeVendors: true,
            includeActivities: true,
            includeAccommodations: true
        });
        if (!result.success) {
            return _server.NextResponse.json(result, {
                status: 500
            });
        }
        return _server.NextResponse.json(result, {
            status: 200
        });
    } catch (error) {
        return _server.NextResponse.json({
            success: false,
            error: {
                code: 'INTERNAL_ERROR',
                message: error instanceof Error ? error.message : 'Unknown error occurred'
            }
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9idWRnZXQvYnJlYWtkb3duL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVNlcnZlckNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zc3InO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgKiBhcyBidWRnZXRTZXJ2aWNlIGZyb20gJ0Avc2VydmljZXMvYnVkZ2V0U2VydmljZSc7XG5cbi8qKlxuICogR0VUIC9hcGkvYWRtaW4vYnVkZ2V0L2JyZWFrZG93blxuICogXG4gKiBHZXQgY29tcHJlaGVuc2l2ZSBidWRnZXQgYnJlYWtkb3duIGluY2x1ZGluZyB2ZW5kb3JzLCBhY3Rpdml0aWVzLCBhbmQgYWNjb21tb2RhdGlvbnMuXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMTEuMS0xMS44XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoKSB7XG4gIHRyeSB7XG4gICAgLy8gQ2hlY2sgYXV0aGVudGljYXRpb25cbiAgICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXG4gICAgICB7XG4gICAgICAgIGNvb2tpZXM6IHtcbiAgICAgICAgICBnZXRBbGwoKSB7XG4gICAgICAgICAgICByZXR1cm4gY29va2llU3RvcmUuZ2V0QWxsKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXRBbGwoY29va2llc1RvU2V0KSB7XG4gICAgICAgICAgICBjb29raWVzVG9TZXQuZm9yRWFjaCgoeyBuYW1lLCB2YWx1ZSB9KSA9PiB7XG4gICAgICAgICAgICAgIGNvb2tpZVN0b3JlLnNldChuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfVxuICAgICk7XG4gICAgY29uc3Qge1xuICAgICAgZGF0YTogeyBzZXNzaW9uIH0sXG4gICAgICBlcnJvcjogYXV0aEVycm9yLFxuICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnVU5BVVRIT1JJWkVEJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEdldCBidWRnZXQgYnJlYWtkb3duXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYnVkZ2V0U2VydmljZS5jYWxjdWxhdGVUb3RhbCh7XG4gICAgICBpbmNsdWRlVmVuZG9yczogdHJ1ZSxcbiAgICAgIGluY2x1ZGVBY3Rpdml0aWVzOiB0cnVlLFxuICAgICAgaW5jbHVkZUFjY29tbW9kYXRpb25zOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3VsdCwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0LCB7IHN0YXR1czogMjAwIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0lOVEVSTkFMX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiR0VUIiwiY29va2llU3RvcmUiLCJjb29raWVzIiwic3VwYWJhc2UiLCJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJnZXRBbGwiLCJzZXRBbGwiLCJjb29raWVzVG9TZXQiLCJmb3JFYWNoIiwibmFtZSIsInZhbHVlIiwic2V0IiwiZGF0YSIsInNlc3Npb24iLCJlcnJvciIsImF1dGhFcnJvciIsImF1dGgiLCJnZXRTZXNzaW9uIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsInN1Y2Nlc3MiLCJjb2RlIiwibWVzc2FnZSIsInN0YXR1cyIsInJlc3VsdCIsImJ1ZGdldFNlcnZpY2UiLCJjYWxjdWxhdGVUb3RhbCIsImluY2x1ZGVWZW5kb3JzIiwiaW5jbHVkZUFjdGl2aXRpZXMiLCJpbmNsdWRlQWNjb21tb2RhdGlvbnMiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFZc0JBOzs7ZUFBQUE7OztxQkFaYTt5QkFDWDt3QkFDSzt1RUFDRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBU3hCLGVBQWVBO0lBQ3BCLElBQUk7UUFDRix1QkFBdUI7UUFDdkIsTUFBTUMsY0FBYyxNQUFNQyxJQUFBQSxnQkFBTztRQUNqQyxNQUFNQyxXQUFXQyxJQUFBQSx1QkFBa0IsRUFDakNDLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCLEVBQ3BDRixRQUFRQyxHQUFHLENBQUNFLDZCQUE2QixFQUN6QztZQUNFTixTQUFTO2dCQUNQTztvQkFDRSxPQUFPUixZQUFZUSxNQUFNO2dCQUMzQjtnQkFDQUMsUUFBT0MsWUFBWTtvQkFDakJBLGFBQWFDLE9BQU8sQ0FBQyxDQUFDLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFO3dCQUNuQ2IsWUFBWWMsR0FBRyxDQUFDRixNQUFNQztvQkFDeEI7Z0JBQ0Y7WUFDRjtRQUNGO1FBRUYsTUFBTSxFQUNKRSxNQUFNLEVBQUVDLE9BQU8sRUFBRSxFQUNqQkMsT0FBT0MsU0FBUyxFQUNqQixHQUFHLE1BQU1oQixTQUFTaUIsSUFBSSxDQUFDQyxVQUFVO1FBRWxDLElBQUlGLGFBQWEsQ0FBQ0YsU0FBUztZQUN6QixPQUFPSyxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO2dCQUNFQyxTQUFTO2dCQUNUTixPQUFPO29CQUNMTyxNQUFNO29CQUNOQyxTQUFTO2dCQUNYO1lBQ0YsR0FDQTtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsdUJBQXVCO1FBQ3ZCLE1BQU1DLFNBQVMsTUFBTUMsZUFBY0MsY0FBYyxDQUFDO1lBQ2hEQyxnQkFBZ0I7WUFDaEJDLG1CQUFtQjtZQUNuQkMsdUJBQXVCO1FBQ3pCO1FBRUEsSUFBSSxDQUFDTCxPQUFPSixPQUFPLEVBQUU7WUFDbkIsT0FBT0Ysb0JBQVksQ0FBQ0MsSUFBSSxDQUFDSyxRQUFRO2dCQUFFRCxRQUFRO1lBQUk7UUFDakQ7UUFFQSxPQUFPTCxvQkFBWSxDQUFDQyxJQUFJLENBQUNLLFFBQVE7WUFBRUQsUUFBUTtRQUFJO0lBQ2pELEVBQUUsT0FBT1QsT0FBTztRQUNkLE9BQU9JLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7WUFDRUMsU0FBUztZQUNUTixPQUFPO2dCQUNMTyxNQUFNO2dCQUNOQyxTQUFTUixpQkFBaUJnQixRQUFRaEIsTUFBTVEsT0FBTyxHQUFHO1lBQ3BEO1FBQ0YsR0FDQTtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiJ9