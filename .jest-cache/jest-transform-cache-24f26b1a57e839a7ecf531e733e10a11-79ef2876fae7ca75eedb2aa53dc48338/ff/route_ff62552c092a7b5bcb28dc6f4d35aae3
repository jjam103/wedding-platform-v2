1f72525131d9ab0c3b28fc687fc0287b
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "GET", {
    enumerable: true,
    get: function() {
        return GET;
    }
});
const _zod = require("zod");
const _apiHelpers = require("../../../../lib/apiHelpers");
const _rsvpManagementService = /*#__PURE__*/ _interop_require_wildcard(require("../../../../services/rsvpManagementService"));
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
/**
 * GET /api/admin/rsvps
 * 
 * List all RSVPs with filtering, pagination, and statistics
 * 
 * Query Parameters:
 * - page: number (default: 1)
 * - limit: number (default: 50, max: 100)
 * - eventId: string (UUID)
 * - activityId: string (UUID)
 * - status: 'pending' | 'attending' | 'declined' | 'maybe'
 * - guestId: string (UUID)
 * - searchQuery: string (searches guest name and email)
 * 
 * Returns:
 * - data: Array of RSVP view models
 * - pagination: { page, limit, total, totalPages }
 * - statistics: { totalRSVPs, byStatus, totalGuestCount }
 * 
 * **Validates: Requirements 6.2, 6.5**
 */ // Query parameter validation schema
const queryParamsSchema = _zod.z.object({
    page: _zod.z.coerce.number().int().positive().default(1),
    limit: _zod.z.coerce.number().int().positive().max(100).default(50),
    eventId: _zod.z.string().uuid().optional(),
    activityId: _zod.z.string().uuid().optional(),
    status: _zod.z.enum([
        'pending',
        'attending',
        'declined',
        'maybe'
    ]).optional(),
    guestId: _zod.z.string().uuid().optional(),
    searchQuery: _zod.z.string().max(100).optional()
});
/**
 * Map error codes to HTTP status codes
 */ function getStatusCode(errorCode) {
    const statusMap = {
        'VALIDATION_ERROR': 400,
        'INVALID_INPUT': 400,
        'UNAUTHORIZED': 401,
        'AUTHENTICATION_REQUIRED': 401,
        'FORBIDDEN': 403,
        'NOT_FOUND': 404,
        'DATABASE_ERROR': 500,
        'INTERNAL_ERROR': 500,
        'UNKNOWN_ERROR': 500
    };
    return statusMap[errorCode] || 500;
}
async function GET(request) {
    return (0, _apiHelpers.withAuth)(async (userId)=>{
        try {
            // 1. Parse and validate query parameters
            const { searchParams } = new URL(request.url);
            const queryValidation = queryParamsSchema.safeParse({
                page: searchParams.get('page'),
                limit: searchParams.get('limit'),
                eventId: searchParams.get('eventId'),
                activityId: searchParams.get('activityId'),
                status: searchParams.get('status'),
                guestId: searchParams.get('guestId'),
                searchQuery: searchParams.get('searchQuery')
            });
            if (!queryValidation.success) {
                return (0, _apiHelpers.errorResponse)('VALIDATION_ERROR', 'Invalid query parameters', 400, {
                    fields: queryValidation.error.issues
                });
            }
            const { page, limit, ...filters } = queryValidation.data;
            // 2. Call service layer
            const result = await _rsvpManagementService.listRSVPs(filters, {
                page,
                limit
            });
            // 3. Handle service errors
            if (!result.success) {
                return (0, _apiHelpers.errorResponse)(result.error.code, result.error.message, getStatusCode(result.error.code), result.error.details);
            }
            // 4. Return success response
            return (0, _apiHelpers.successResponse)(result.data, 200);
        } catch (error) {
            console.error('GET /api/admin/rsvps error:', {
                error: error instanceof Error ? error.message : 'Unknown error',
                stack: error instanceof Error ? error.stack : undefined
            });
            return (0, _apiHelpers.errorResponse)('INTERNAL_ERROR', 'Failed to fetch RSVPs', 500);
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qYXJvbi9EZXNrdG9wL3dlZGRpbmctcGxhdGZvcm0tdjIvYXBwL2FwaS9hZG1pbi9yc3Zwcy9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyB3aXRoQXV0aCwgZXJyb3JSZXNwb25zZSwgc3VjY2Vzc1Jlc3BvbnNlIH0gZnJvbSAnQC9saWIvYXBpSGVscGVycyc7XG5pbXBvcnQgKiBhcyByc3ZwTWFuYWdlbWVudFNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlcy9yc3ZwTWFuYWdlbWVudFNlcnZpY2UnO1xuXG4vKipcbiAqIEdFVCAvYXBpL2FkbWluL3JzdnBzXG4gKiBcbiAqIExpc3QgYWxsIFJTVlBzIHdpdGggZmlsdGVyaW5nLCBwYWdpbmF0aW9uLCBhbmQgc3RhdGlzdGljc1xuICogXG4gKiBRdWVyeSBQYXJhbWV0ZXJzOlxuICogLSBwYWdlOiBudW1iZXIgKGRlZmF1bHQ6IDEpXG4gKiAtIGxpbWl0OiBudW1iZXIgKGRlZmF1bHQ6IDUwLCBtYXg6IDEwMClcbiAqIC0gZXZlbnRJZDogc3RyaW5nIChVVUlEKVxuICogLSBhY3Rpdml0eUlkOiBzdHJpbmcgKFVVSUQpXG4gKiAtIHN0YXR1czogJ3BlbmRpbmcnIHwgJ2F0dGVuZGluZycgfCAnZGVjbGluZWQnIHwgJ21heWJlJ1xuICogLSBndWVzdElkOiBzdHJpbmcgKFVVSUQpXG4gKiAtIHNlYXJjaFF1ZXJ5OiBzdHJpbmcgKHNlYXJjaGVzIGd1ZXN0IG5hbWUgYW5kIGVtYWlsKVxuICogXG4gKiBSZXR1cm5zOlxuICogLSBkYXRhOiBBcnJheSBvZiBSU1ZQIHZpZXcgbW9kZWxzXG4gKiAtIHBhZ2luYXRpb246IHsgcGFnZSwgbGltaXQsIHRvdGFsLCB0b3RhbFBhZ2VzIH1cbiAqIC0gc3RhdGlzdGljczogeyB0b3RhbFJTVlBzLCBieVN0YXR1cywgdG90YWxHdWVzdENvdW50IH1cbiAqIFxuICogKipWYWxpZGF0ZXM6IFJlcXVpcmVtZW50cyA2LjIsIDYuNSoqXG4gKi9cblxuLy8gUXVlcnkgcGFyYW1ldGVyIHZhbGlkYXRpb24gc2NoZW1hXG5jb25zdCBxdWVyeVBhcmFtc1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgcGFnZTogei5jb2VyY2UubnVtYmVyKCkuaW50KCkucG9zaXRpdmUoKS5kZWZhdWx0KDEpLFxuICBsaW1pdDogei5jb2VyY2UubnVtYmVyKCkuaW50KCkucG9zaXRpdmUoKS5tYXgoMTAwKS5kZWZhdWx0KDUwKSxcbiAgZXZlbnRJZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbiAgYWN0aXZpdHlJZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbiAgc3RhdHVzOiB6LmVudW0oWydwZW5kaW5nJywgJ2F0dGVuZGluZycsICdkZWNsaW5lZCcsICdtYXliZSddKS5vcHRpb25hbCgpLFxuICBndWVzdElkOiB6LnN0cmluZygpLnV1aWQoKS5vcHRpb25hbCgpLFxuICBzZWFyY2hRdWVyeTogei5zdHJpbmcoKS5tYXgoMTAwKS5vcHRpb25hbCgpLFxufSk7XG5cbi8qKlxuICogTWFwIGVycm9yIGNvZGVzIHRvIEhUVFAgc3RhdHVzIGNvZGVzXG4gKi9cbmZ1bmN0aW9uIGdldFN0YXR1c0NvZGUoZXJyb3JDb2RlOiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCBzdGF0dXNNYXA6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgJ1ZBTElEQVRJT05fRVJST1InOiA0MDAsXG4gICAgJ0lOVkFMSURfSU5QVVQnOiA0MDAsXG4gICAgJ1VOQVVUSE9SSVpFRCc6IDQwMSxcbiAgICAnQVVUSEVOVElDQVRJT05fUkVRVUlSRUQnOiA0MDEsXG4gICAgJ0ZPUkJJRERFTic6IDQwMyxcbiAgICAnTk9UX0ZPVU5EJzogNDA0LFxuICAgICdEQVRBQkFTRV9FUlJPUic6IDUwMCxcbiAgICAnSU5URVJOQUxfRVJST1InOiA1MDAsXG4gICAgJ1VOS05PV05fRVJST1InOiA1MDAsXG4gIH07XG4gIFxuICByZXR1cm4gc3RhdHVzTWFwW2Vycm9yQ29kZV0gfHwgNTAwO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHJldHVybiB3aXRoQXV0aChhc3luYyAodXNlcklkKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIDEuIFBhcnNlIGFuZCB2YWxpZGF0ZSBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHF1ZXJ5VmFsaWRhdGlvbiA9IHF1ZXJ5UGFyYW1zU2NoZW1hLnNhZmVQYXJzZSh7XG4gICAgICAgIHBhZ2U6IHNlYXJjaFBhcmFtcy5nZXQoJ3BhZ2UnKSxcbiAgICAgICAgbGltaXQ6IHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JyksXG4gICAgICAgIGV2ZW50SWQ6IHNlYXJjaFBhcmFtcy5nZXQoJ2V2ZW50SWQnKSxcbiAgICAgICAgYWN0aXZpdHlJZDogc2VhcmNoUGFyYW1zLmdldCgnYWN0aXZpdHlJZCcpLFxuICAgICAgICBzdGF0dXM6IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXR1cycpLFxuICAgICAgICBndWVzdElkOiBzZWFyY2hQYXJhbXMuZ2V0KCdndWVzdElkJyksXG4gICAgICAgIHNlYXJjaFF1ZXJ5OiBzZWFyY2hQYXJhbXMuZ2V0KCdzZWFyY2hRdWVyeScpLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcXVlcnlWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2UoXG4gICAgICAgICAgJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgICdJbnZhbGlkIHF1ZXJ5IHBhcmFtZXRlcnMnLFxuICAgICAgICAgIDQwMCxcbiAgICAgICAgICB7IGZpZWxkczogcXVlcnlWYWxpZGF0aW9uLmVycm9yLmlzc3VlcyB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgcGFnZSwgbGltaXQsIC4uLmZpbHRlcnMgfSA9IHF1ZXJ5VmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgICAvLyAyLiBDYWxsIHNlcnZpY2UgbGF5ZXJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJzdnBNYW5hZ2VtZW50U2VydmljZS5saXN0UlNWUHMoXG4gICAgICAgIGZpbHRlcnMsXG4gICAgICAgIHsgcGFnZSwgbGltaXQgfVxuICAgICAgKTtcblxuICAgICAgLy8gMy4gSGFuZGxlIHNlcnZpY2UgZXJyb3JzXG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICAgIHJlc3VsdC5lcnJvci5jb2RlLFxuICAgICAgICAgIHJlc3VsdC5lcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGdldFN0YXR1c0NvZGUocmVzdWx0LmVycm9yLmNvZGUpLFxuICAgICAgICAgIHJlc3VsdC5lcnJvci5kZXRhaWxzXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIDQuIFJldHVybiBzdWNjZXNzIHJlc3BvbnNlXG4gICAgICByZXR1cm4gc3VjY2Vzc1Jlc3BvbnNlKHJlc3VsdC5kYXRhLCAyMDApO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0dFVCAvYXBpL2FkbWluL3JzdnBzIGVycm9yOicsIHtcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlKFxuICAgICAgICAnSU5URVJOQUxfRVJST1InLFxuICAgICAgICAnRmFpbGVkIHRvIGZldGNoIFJTVlBzJyxcbiAgICAgICAgNTAwXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG59XG4iXSwibmFtZXMiOlsiR0VUIiwicXVlcnlQYXJhbXNTY2hlbWEiLCJ6Iiwib2JqZWN0IiwicGFnZSIsImNvZXJjZSIsIm51bWJlciIsImludCIsInBvc2l0aXZlIiwiZGVmYXVsdCIsImxpbWl0IiwibWF4IiwiZXZlbnRJZCIsInN0cmluZyIsInV1aWQiLCJvcHRpb25hbCIsImFjdGl2aXR5SWQiLCJzdGF0dXMiLCJlbnVtIiwiZ3Vlc3RJZCIsInNlYXJjaFF1ZXJ5IiwiZ2V0U3RhdHVzQ29kZSIsImVycm9yQ29kZSIsInN0YXR1c01hcCIsInJlcXVlc3QiLCJ3aXRoQXV0aCIsInVzZXJJZCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInF1ZXJ5VmFsaWRhdGlvbiIsInNhZmVQYXJzZSIsImdldCIsInN1Y2Nlc3MiLCJlcnJvclJlc3BvbnNlIiwiZmllbGRzIiwiZXJyb3IiLCJpc3N1ZXMiLCJmaWx0ZXJzIiwiZGF0YSIsInJlc3VsdCIsInJzdnBNYW5hZ2VtZW50U2VydmljZSIsImxpc3RSU1ZQcyIsImNvZGUiLCJtZXNzYWdlIiwiZGV0YWlscyIsInN1Y2Nlc3NSZXNwb25zZSIsImNvbnNvbGUiLCJFcnJvciIsInN0YWNrIiwidW5kZWZpbmVkIl0sIm1hcHBpbmdzIjoiOzs7OytCQXlEc0JBOzs7ZUFBQUE7OztxQkF4REo7NEJBQ3VDOytFQUNsQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRXZDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQW9CQyxHQUVELG9DQUFvQztBQUNwQyxNQUFNQyxvQkFBb0JDLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO0lBQ2pDQyxNQUFNRixNQUFDLENBQUNHLE1BQU0sQ0FBQ0MsTUFBTSxHQUFHQyxHQUFHLEdBQUdDLFFBQVEsR0FBR0MsT0FBTyxDQUFDO0lBQ2pEQyxPQUFPUixNQUFDLENBQUNHLE1B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