
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts --workers=1

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168mâ–² Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.180.84:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1mâœ“[22m[39m Starting...
[2m[WebServer] [22m[33m[1mâš [22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22mðŸš€ Initializing application services...
[2m[WebServer] [22mâœ… B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mâœ… Application services initialized successfully
[2m[WebServer] [22m[32m[1mâœ“[22m[39m Ready in 1994ms

ðŸš€ E2E Global Setup Starting...

ðŸ“Š Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 1202ms[2m (compile: 816ms, proxy.ts: 168ms, render: 217ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 1205ms[2m (compile: 817ms, proxy.ts: 168ms, render: 220ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 62ms[2m (compile: 10ms, proxy.ts: 15ms, render: 37ms)[22m
âœ… Test database connected

ðŸ§¹ Cleaning up test data...
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ðŸ‘¤ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 2200056b-5689-4fbf-bf9b-e861b6fa944a)
   Created test guest: test@example.com (ID: 05d7681a-a4dc-4720-93a9-e7d14cd524dd)
âœ… Test guest created

ðŸ“¦ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
âœ… Comprehensive test data created

ðŸŒ Verifying Next.js server...
[2m[WebServer] [22m GET / [32m200[39m in 161ms[2m (compile: 3ms, proxy.ts: 16ms, render: 142ms)[22m
âœ… Next.js server is running

ðŸ”¥ Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 82ms[2m (compile: 6ms, proxy.ts: 40ms, render: 36ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
   âœ… Route ready: /api/guest-auth/email-match (attempt 1/5, status: 404)
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 1079ms[2m (compile: 741ms, proxy.ts: 138ms, render: 200ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 1193ms[2m (compile: 912ms, proxy.ts: 40ms, render: 241ms)[22m
   âœ… Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 404)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 327ms[2m (compile: 179ms, proxy.ts: 10ms, render: 138ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 284ms[2m (compile: 127ms, proxy.ts: 18ms, render: 139ms)[22m
   âœ… Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 1167ms[2m (compile: 974ms, proxy.ts: 11ms, render: 182ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 1178ms[2m (compile: 974ms, proxy.ts: 11ms, render: 193ms)[22m
   âœ… Guest auth routes warmup complete
âœ… API routes warmed up

ðŸ” Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 1568ms[2m (compile: 1424ms, proxy.ts: 21ms, render: 123ms)[22m
[2m[WebServer] [22m GET /auth/login [32m200[39m in 1571ms[2m (compile: 1424ms, proxy.ts: 21ms, render: 125ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1mâš [22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m[33m[1mâš [22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 1157ms[2m (compile: 593ms, proxy.ts: 389ms, render: 176ms)[22m
[2m[WebServer] [22m GET /admin [32m200[39m in 1159ms[2m (compile: 594ms, proxy.ts: 387ms, render: 178ms)[22m
   Current URL after submit: http://localhost:3000/admin
   âœ… Successfully logged in via browser
   âœ… Authentication state saved
âœ… Admin authentication saved

âœ¨ E2E Global Setup Complete!


Running 15 tests using 1 worker

[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422439472-gdjsxxj5@example.com'[39m,
  id: [32m'cb45795a-5da3-492d-881d-51b9585393d6'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'fa785141-fdd2-4228-9a43-a4697e474ae4'[39m
}
[Worker 0] âœ… Verified guest exists: {
  email: [32m'test-w0-1770422439472-gdjsxxj5@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 494ms[2m (compile: 377ms, proxy.ts: 9ms, render: 109ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 502ms[2m (compile: 377ms, proxy.ts: 8ms, render: 116ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770422439472-7y5jbfkg@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770422439472-gdjsxxj5@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422439472-7y5jbfkg@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422439472-gdjsxxj5@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'92072183'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'98ea162b-89fb-4b83-a200-27509a2f52bd'[39m,
[2m[WebServer] [22m  sessionId: [32m'34e3f90f-eefd-4e58-bcb3-e51235f33542'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 339ms[2m (compile: 52ms, proxy.ts: 8ms, render: 279ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'22a5a221'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'cb45795a-5da3-492d-881d-51b9585393d6'[39m,
[2m[WebServer] [22m  sessionId: [32m'df71d6f5-252b-48a8-9ed1-c623fed69192'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 369ms[2m (compile: 52ms, proxy.ts: 8ms, render: 309ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '92072183...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '22a5a221...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '92072183'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '22a5a221'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'22a5a221'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'92072183'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'cb45795a-5da3-492d-881d-51b9585393d6'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'98ea162b-89fb-4b83-a200-27509a2f52bd'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422439472-gdjsxxj5@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422439472-gdjsxxj5@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1630ms[2m (compile: 1098ms, proxy.ts: 143ms, render: 389ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422439472-7y5jbfkg@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422439472-7y5jbfkg@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1755ms[2m (compile: 1144ms, proxy.ts: 127ms, render: 484ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '22a5a221...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '22a5a221...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '22a5a221...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '22a5a221...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '92072183...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '92072183...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '92072183...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '92072183...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '22a5a221'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '22a5a221'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '22a5a221'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '92072183'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '92072183'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '92072183'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '92072183'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '22a5a221'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
âœ… Comprehensive cleanup complete
  âœ“   1 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:130:7 â€º Guest Authentication â€º should successfully authenticate with email matching (6.6s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422446276-657xgzim@example.com'[39m,
  id: [32m'e00294ee-7f4d-4a2b-89b3-fa64869e1501'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'24d44cf5-37ff-436f-be60-92db08d03ba6'[39m
}
[Worker 0] âœ… Verified guest exists: {
  email: [32m'test-w0-1770422446276-657xgzim@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 158ms[2m (compile: 11ms, proxy.ts: 7ms, render: 140ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 159ms[2m (compile: 11ms, proxy.ts: 7ms, render: 141ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 148ms[2m (compile: 16ms, proxy.ts: 22ms, render: 110ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 153ms[2m (compile: 16ms, proxy.ts: 22ms, render: 116ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ“   2 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:149:7 â€º Guest Authentication â€º should show error for non-existent email (3.2s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422449468-neae17a0@example.com'[39m,
  id: [32m'eb6d9941-8cf1-4d05-992b-e83a96abf2fb'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'2dd5e23f-71f0-4706-b1ed-057882d6f318'[39m
}
[Worker 0] âœ… Verified guest exists: {
  email: [32m'test-w0-1770422449468-neae17a0@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 81ms[2m (compile: 7ms, proxy.ts: 15ms, render: 58ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 95ms[2m (compile: 26ms, proxy.ts: 11ms, render: 58ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ“   3 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:164:7 â€º Guest Authentication â€º should show error for invalid email format (3.0s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422452496-w1kfy0k9@example.com'[39m,
  id: [32m'6f703ed3-6374-4fbb-9db8-58506822959a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'35a03997-d30d-4a16-bb5b-c4c3b9fb98ce'[39m
}
[Worker 0] âœ… Verified guest exists: {
  email: [32m'test-w0-1770422452496-w1kfy0k9@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 68ms[2m (compile: 3ms, proxy.ts: 12ms, render: 54ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 76ms[2m (compile: 8ms, proxy.ts: 13ms, render: 56ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770422452496-w1kfy0k9@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770422452490-hqutha89@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422452496-w1kfy0k9@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422452490-hqutha89@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'fabe7081'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'6f703ed3-6374-4fbb-9db8-58506822959a'[39m,
[2m[WebServer] [22m  sessionId: [32m'b5de5d92-5694-43fe-8962-bbf93b28932d'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 339ms[2m (compile: 11ms, proxy.ts: 26ms, render: 301ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'87b5da27'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'af03ca62-d2ed-4b4e-ad8d-d8feaec8c168'[39m,
[2m[WebServer] [22m  sessionId: [32m'1740ac46-917d-4091-a098-95e4e3934aee'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 347ms[2m (compile: 11ms, proxy.ts: 26ms, render: 309ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fabe7081...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '87b5da27...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '87b5da27'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fabe7081'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'87b5da27'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'fabe7081'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'6f703ed3-6374-4fbb-9db8-58506822959a'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'af03ca62-d2ed-4b4e-ad8d-d8feaec8c168'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422452496-w1kfy0k9@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422452496-w1kfy0k9@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422452490-hqutha89@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422452490-hqutha89@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 515ms[2m (compile: 7ms, proxy.ts: 116ms, render: 392ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 520ms[2m (compile: 5ms, proxy.ts: 122ms, render: 394ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fabe7081...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fabe7081...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fabe7081...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fabe7081...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '87b5da27...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '87b5da27...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '87b5da27...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '87b5da27...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '87b5da27'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fabe7081'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fabe7081'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fabe7081'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fabe7081'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '87b5da27'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '87b5da27'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '87b5da27'
[2m[WebServer] [22m}
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mAPI Error: {
[2m[WebServer] [22m  path: [32m'http://localhost:3000/api/guest/events'[39m,
[2m[WebServer] [22m  error: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m      at [3mignore-listed frames[23m
[2m[WebServer] [22m}
[2m[WebServer] [22mError fetching wedding info: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mError fetching wedding info: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mError fetching announcements: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mError fetching announcements: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mAPI Error: {
[2m[WebServer] [22m  path: [32m'http://localhost:3000/api/guest/events'[39m,
[2m[WebServer] [22m  error: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m      at [3mignore-listed frames[23m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [31m500[39m in 2.9s[2m (compile: 1914ms, proxy.ts: 155ms, render: 867ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [31m500[39m in 2.9s[2m (compile: 1921ms, proxy.ts: 148ms, render: 867ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [31m500[39m in 2.9s[2m (compile: 1751ms, proxy.ts: 318ms, render: 867ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [31m500[39m in 2.9s[2m (compile: 1921ms, proxy.ts: 149ms, render: 867ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [31m500[39m in 2.9s[2m (compile: 1724ms, proxy.ts: 345ms, render: 867ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [31m500[39m in 2.9s[2m (compile: 1916ms, proxy.ts: 153ms, render: 867ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [31m500[39m in 2.9s[2m (compile: 1892ms, proxy.ts: 177ms, render: 867ms)[22m
[2m[WebServer] [22m GET /api/guest/events [31m500[39m in 2.9s[2m (compile: 1930ms, proxy.ts: 139ms, render: 867ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '87b5da27...',
[2m[WebServer] [22m  allCookies: [
[2m[WebServer] [22m  'sb-olcqaawrpnanioaorfer-auth-token',
[2m[WebServer] [22m  'guest_session',
[2m[WebServer] [22m  '__next_hmr_refresh_hash__'
[2m[WebServer] [22m]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fabe7081...',
[2m[WebServer] [22m  allCookies: [
[2m[WebServer] [22m  'sb-olcqaawrpnanioaorfer-auth-token',
[2m[WebServer] [22m  'guest_session',
[2m[WebServer] [22m  '__next_hmr_refresh_hash__'
[2m[WebServer] [22m]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fabe7081'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '87b5da27'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'fabe7081'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'6f703ed3-6374-4fbb-9db8-58506822959a'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422452496-w1kfy0k9@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422452496-w1kfy0k9@example.com
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'87b5da27'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'af03ca62-d2ed-4b4e-ad8d-d8feaec8c168'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422452490-hqutha89@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422452490-hqutha89@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 267ms[2m (compile: 49ms, proxy.ts: 158ms, render: 60ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 271ms[2m (compile: 79ms, proxy.ts: 164ms, render: 28ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   4 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:177:7 â€º Guest Authentication â€º should show loading state during authentication (13.1s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  override existing env vars with { override: true }
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770422466372-7j6qgqcx@example.com'[39m,
  id: [32m'b8533190-4724-42c1-be4f-a2cc3b481b0b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'cf9025a5-7e94-4359-b94e-ccfce22d4f70'[39m
}
[Worker 1] âœ… Verified guest exists: {
  email: [32m'test-w1-1770422466372-7j6qgqcx@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 125ms[2m (compile: 11ms, proxy.ts: 14ms, render: 100ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 128ms[2m (compile: 11ms, proxy.ts: 14ms, render: 102ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w1-1770422466372-7j6qgqcx@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w1-1770422466372-pfqsb4ik@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770422466372-7j6qgqcx@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770422466372-pfqsb4ik@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'6e6c7617'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'b8533190-4724-42c1-be4f-a2cc3b481b0b'[39m,
[2m[WebServer] [22m  sessionId: [32m'e1b15436-9d5f-4fe9-877d-944636d8e8bc'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 278ms[2m (compile: 6ms, proxy.ts: 8ms, render: 265ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'4ad33ac1'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'b30553ec-05df-4350-964f-6fad2a4a30e0'[39m,
[2m[WebServer] [22m  sessionId: [32m'1ad1c152-fcf9-4a0d-ae41-3f4d7797b6eb'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 296ms[2m (compile: 6ms, proxy.ts: 8ms, render: 282ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6e6c7617...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4ad33ac1...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6e6c7617'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'6e6c7617'[39m }
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4ad33ac1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'4ad33ac1'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'b8533190-4724-42c1-be4f-a2cc3b481b0b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'b30553ec-05df-4350-964f-6fad2a4a30e0'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770422466372-7j6qgqcx@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w1-1770422466372-7j6qgqcx@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 617ms[2m (compile: 3ms, proxy.ts: 126ms, render: 488ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770422466372-pfqsb4ik@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w1-1770422466372-pfqsb4ik@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 707ms[2m (compile: 2ms, proxy.ts: 143ms, render: 561ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6e6c7617...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6e6c7617...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6e6c7617...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6e6c7617...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4ad33ac1...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4ad33ac1...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4ad33ac1...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4ad33ac1...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6e6c7617'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6e6c7617'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6e6c7617'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6e6c7617'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4ad33ac1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4ad33ac1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4ad33ac1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4ad33ac1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
âœ… Comprehensive cleanup complete
  âœ“   5 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:191:7 â€º Guest Authentication â€º should create session cookie on successful authentication (4.8s)
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770422471416-7x5a34ez@example.com'[39m,
  id: [32m'90ae6261-6fd9-4de9-944e-dee661033000'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'54105b69-9539-4cf7-b12b-c51480fcd864'[39m
}
[Worker 1] âœ… Verified guest exists: {
  email: [32m'test-w1-1770422471416-7x5a34ez@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 28ms[2m (compile: 3ms, proxy.ts: 4ms, render: 21ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 28ms[2m (compile: 1383Âµs, proxy.ts: 4ms, render: 22ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 159ms[2m (compile: 5ms, proxy.ts: 12ms, render: 142ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 214ms[2m (compile: 1121Âµs, proxy.ts: 5ms, render: 208ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   6 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:214:7 â€º Guest Authentication â€º should successfully request and verify magic link (13.1s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  suppress all logs with { quiet: true }
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770422485301-gl0nqo9v@example.com'[39m,
  id: [32m'ad1e5c06-ee31-4763-9544-3ce776c9b402'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'd19a6972-eb16-409c-9b6a-d117c1aca46b'[39m
}
[Worker 2] âœ… Verified guest exists: {
  email: [32m'test-w2-1770422485301-gl0nqo9v@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 41ms[2m (compile: 2ms, proxy.ts: 5ms, render: 33ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 51ms[2m (compile: 7ms, proxy.ts: 14ms, render: 29ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 149ms[2m (compile: 1603Âµs, proxy.ts: 14ms, render: 134ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 157ms[2m (compile: 1853Âµs, proxy.ts: 12ms, render: 143ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   7 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:261:7 â€º Guest Authentication â€º should show success message after requesting magic link (13.3s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770422499680-bkd9jv8f@example.com'[39m,
  id: [32m'800c7bad-0157-4dcc-a6ea-3a46a4d31458'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'0d8b2e62-2748-4ffc-8aed-df368fb97867'[39m
}
[Worker 3] âœ… Verified guest exists: {
  email: [32m'test-w3-1770422499680-bkd9jv8f@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=f9df275fa79206a0199caeec898b29604b95617449cbeba14cb6f389a15a5f3b [32m200[39m in 642ms[2m (compile: 518ms, proxy.ts: 8ms, render: 117ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=af5b22ec931a187908de064c5eb4c6f30d6b414146735910da0325e52ea29a33 [32m200[39m in 641ms[2m (compile: 514ms, proxy.ts: 7ms, render: 119ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=af5b22ec931a187908de064c5eb4c6f30d6b414146735910da0325e52ea29a33 [32m200[39m in 70ms[2m (compile: 27ms, proxy.ts: 6ms, render: 37ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=f9df275fa79206a0199caeec898b29604b95617449cbeba14cb6f389a15a5f3b [32m200[39m in 73ms[2m (compile: 27ms, proxy.ts: 6ms, render: 40ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [32m200[39m in 536ms[2m (compile: 407ms, proxy.ts: 12ms, render: 117ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [32m200[39m in 536ms[2m (compile: 407ms, proxy.ts: 12ms, render: 118ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 210ms[2m (compile: 2ms, proxy.ts: 18ms, render: 190ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 210ms[2m (compile: 2ms, proxy.ts: 18ms, render: 191ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 104ms[2m (compile: 2ms, proxy.ts: 11ms, render: 90ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 104ms[2m (compile: 2ms, proxy.ts: 11ms, render: 91ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   8 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:289:7 â€º Guest Authentication â€º should show error for expired magic link (13.9s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  suppress all logs with { quiet: true }
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770422514475-t1003h40@example.com'[39m,
  id: [32m'afbbcd29-9956-4906-8298-44692a3def6a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'9772cea1-9c6e-4612-8f0d-5a427addda45'[39m
}
[Worker 4] âœ… Verified guest exists: {
  email: [32m'test-w4-1770422514475-t1003h40@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 96ms[2m (compile: 11ms, proxy.ts: 10ms, render: 75ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 107ms[2m (compile: 5ms, proxy.ts: 52ms, render: 50ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 172ms[2m (compile: 7ms, proxy.ts: 13ms, render: 153ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 179ms[2m (compile: 7ms, proxy.ts: 13ms, render: 160ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   9 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:325:7 â€º Guest Authentication â€º should show error for already used magic link (13.4s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770422528782-mmjrzzp8@example.com'[39m,
  id: [32m'c47d4f62-716e-4ef4-9d86-ce8dbb78ab4c'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'37068484-c5e8-404a-a5bc-6245a6e1ffa9'[39m
}
[Worker 5] âœ… Verified guest exists: {
  email: [32m'test-w5-1770422528782-mmjrzzp8@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 86ms[2m (compile: 3ms, proxy.ts: 9ms, render: 74ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 90ms[2m (compile: 3ms, proxy.ts: 9ms, render: 78ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 95ms[2m (compile: 1974Âµs, proxy.ts: 9ms, render: 84ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 96ms[2m (compile: 1991Âµs, proxy.ts: 9ms, render: 85ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=47e15a3494c9ab0cc27b9b8e06ab7959e350c7c0679fe986548953846fc4a3fb [32m200[39m in 76ms[2m (compile: 4ms, proxy.ts: 5ms, render: 68ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=3ca518b986bf6b5db9b645575d3262a1bc1f35e589bf2202d106724dbc645f28 [32m200[39m in 75ms[2m (compile: 1137Âµs, proxy.ts: 5ms, render: 69ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 154ms[2m (compile: 4ms, proxy.ts: 17ms, render: 134ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 160ms[2m (compile: 4ms, proxy.ts: 17ms, render: 140ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 81ms[2m (compile: 2ms, proxy.ts: 7ms, render: 72ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 91ms[2m (compile: 8ms, proxy.ts: 31ms, render: 52ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ“  10 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:367:7 â€º Guest Authentication â€º should show error for invalid or missing token (5.8s)
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770422534712-7jd7wiqb@example.com'[39m,
  id: [32m'5fa9a6a7-ca34-49be-a4f5-53136b9218dd'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'9f569ed0-8f6e-4ffb-a773-a583f6460893'[39m
}
[Worker 5] âœ… Verified guest exists: {
  email: [32m'test-w5-1770422534712-7jd7wiqb@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 69ms[2m (compile: 3ms, proxy.ts: 9ms, render: 57ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 69ms[2m (compile: 3ms, proxy.ts: 9ms, render: 57ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w5-1770422534712-7jd7wiqb@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w5-1770422534726-rnlcjuuu@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422534712-7jd7wiqb@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422534726-rnlcjuuu@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'ecf9f13c'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'5fa9a6a7-ca34-49be-a4f5-53136b9218dd'[39m,
[2m[WebServer] [22m  sessionId: [32m'ba246614-785a-4194-ae84-cff5d6e29a4e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 234ms[2m (compile: 9ms, proxy.ts: 13ms, render: 212ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'9dfe77cd'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'89459867-4e61-4a65-a709-e1ac12100772'[39m,
[2m[WebServer] [22m  sessionId: [32m'8c48fabb-dccd-4e15-b17b-b78201df0cb1'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 230ms[2m (compile: 944Âµs, proxy.ts: 12ms, render: 216ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ecf9f13c...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9dfe77cd...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ecf9f13c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'ecf9f13c'[39m }
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9dfe77cd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'9dfe77cd'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'5fa9a6a7-ca34-49be-a4f5-53136b9218dd'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'89459867-4e61-4a65-a709-e1ac12100772'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422534712-7jd7wiqb@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770422534712-7jd7wiqb@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 443ms[2m (compile: 9ms, proxy.ts: 116ms, render: 318ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422534726-rnlcjuuu@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770422534726-rnlcjuuu@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 618ms[2m (compile: 1903Âµs, proxy.ts: 149ms, render: 467ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ecf9f13c...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ecf9f13c...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ecf9f13c...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ecf9f13c...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ecf9f13c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ecf9f13c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ecf9f13c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ecf9f13c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[37m[1mâ—‹[22m[39m Compiling /api/guest/events ...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ecf9f13c...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ecf9f13c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9dfe77cd...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9dfe77cd...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9dfe77cd...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9dfe77cd...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9dfe77cd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9dfe77cd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9dfe77cd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9dfe77cd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError fetching wedding info: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mError fetching announcements: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mAPI Error: {
[2m[WebServer] [22m  path: [32m'http://localhost:3000/api/guest/events'[39m,
[2m[WebServer] [22m  error: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m      at [3mignore-listed frames[23m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/wedding-info [31m500[39m in 5.1s[2m (compile: 4.3s, proxy.ts: 339ms, render: 433ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [31m500[39m in 5.1s[2m (compile: 4.3s, proxy.ts: 342ms, render: 433ms)[22m
[2m[WebServer] [22m GET /api/guest/events [31m500[39m in 5.1s[2m (compile: 4.3s, proxy.ts: 374ms, render: 432ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [31m500[39m in 5.1s[2m (compile: 4.3s, proxy.ts: 343ms, render: 432ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m POST /api/auth/guest/logout [32m200[39m in 5.0s[2m (compile: 4.4s, proxy.ts: 37ms, render: 516ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9dfe77cd...',
[2m[WebServer] [22m  allCookies: [
[2m[WebServer] [22m  'sb-olcqaawrpnanioaorfer-auth-token',
[2m[WebServer] [22m  'guest_session',
[2m[WebServer] [22m  '__next_hmr_refresh_hash__'
[2m[WebServer] [22m]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 1061ms[2m (compile: 439ms, proxy.ts: 70ms, render: 552ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9dfe77cd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 22ms[2m (compile: 3ms, proxy.ts: 6ms, render: 13ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 37ms[2m (compile: 2ms, proxy.ts: 7ms, render: 27ms)[22m
  âœ˜  11 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:396:7 â€º Guest Authentication â€º should complete logout flow (11.3s)
[2m[WebServer] [22m[API] Looking for guest with email: test-w6-1770422545253-zhedj0k9@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770422545253-zhedj0k9@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'3f2e18b3'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'eb62de93-6c5e-400d-a409-126d29f57c6e'[39m,
[2m[WebServer] [22m  sessionId: [32m'deea5bab-c990-492f-8aa4-14115235a4ce'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 228ms[2m (compile: 6ms, proxy.ts: 7ms, render: 215ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[Worker 6] Created test guest: {
  email: [32m'test-w6-1770422546788-hxo1klo9@example.com'[39m,
  id: [32m'7d0c6ac2-3245-4cd7-961a-0d55eb57af99'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'0b8b1331-cff4-4e1c-b713-367a3deb8529'[39m
}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'3f2e18b3'[39m }
[Worker 6] âœ… Verified guest exists: {
  email: [32m'test-w6-1770422546788-hxo1klo9@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'eb62de93-6c5e-400d-a409-126d29f57c6e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770422545253-zhedj0k9@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w6-1770422545253-zhedj0k9@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 403ms[2m (compile: 10ms, proxy.ts: 111ms, render: 282ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 41ms[2m (compile: 1840Âµs, proxy.ts: 11ms, render: 29ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError fetching wedding info: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mError fetching announcements: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mAPI Error: {
[2m[WebServer] [22m  path: [32m'http://localhost:3000/api/guest/events'[39m,
[2m[WebServer] [22m  error: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m      at [3mignore-listed frames[23m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/wedding-info [31m500[39m in 2.2s[2m (compile: 1500ms, proxy.ts: 330ms, render: 414ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [31m500[39m in 2.2s[2m (compile: 1496ms, proxy.ts: 335ms, render: 413ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [31m500[39m in 2.2s[2m (compile: 1499ms, proxy.ts: 333ms, render: 412ms)[22m
[2m[WebServer] [22m GET /api/guest/events [31m500[39m in 2.2s[2m (compile: 1503ms, proxy.ts: 329ms, render: 412ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w6-1770422546788-hxo1klo9@example.com
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770422546788-hxo1klo9@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'3253214c'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'7d0c6ac2-3245-4cd7-961a-0d55eb57af99'[39m,
[2m[WebServer] [22m  sessionId: [32m'58fe1870-0240-436a-8bde-cb7d51194095'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 2.1s[2m (compile: 1414ms, proxy.ts: 23ms, render: 624ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/events [32m200[39m in 2.6s[2m (compile: 1749ms, proxy.ts: 124ms, render: 753ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3253214c...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3253214c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'3253214c'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'7d0c6ac2-3245-4cd7-961a-0d55eb57af99'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770422546788-hxo1klo9@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w6-1770422546788-hxo1klo9@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 431ms[2m (compile: 10ms, proxy.ts: 112ms, render: 308ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 70ms[2m (compile: 9ms, proxy.ts: 13ms, render: 47ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mAPI Error: {
[2m[WebServer] [22m  path: [32m'http://localhost:3000/api/guest/events'[39m,
[2m[WebServer] [22m  error: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m      at [3mignore-listed frames[23m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [31m500[39m in 250ms[2m (compile: 3ms, proxy.ts: 146ms, render: 101ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/events [32m200[39m in 529ms[2m (compile: 5ms, proxy.ts: 255ms, render: 269ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3f2e18b3...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3f2e18b3'
[2m[WebServer] [22m}
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mAPI Error: {
[2m[WebServer] [22m  path: [32m'http://localhost:3000/api/guest/events'[39m,
[2m[WebServer] [22m  error: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m      at [3mignore-listed frames[23m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [31m500[39m in 193ms[2m (compile: 1421Âµs, proxy.ts: 104ms, render: 88ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜  12 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:433:7 â€º Guest Authentication â€º should persist authentication across page refreshes (8.1s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  override existing env vars with { override: true }
[Worker 7] Created test guest: {
  email: [32m'test-w7-1770422555682-5oi8ijg4@example.com'[39m,
  id: [32m'9e3b2de8-5fbd-4246-a1d5-7589ab84c23e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c449338c-ff12-490f-9080-0c8da8cfe129'[39m
}
[Worker 7] âœ… Verified guest exists: {
  email: [32m'test-w7-1770422555682-5oi8ijg4@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 42ms[2m (compile: 1978Âµs, proxy.ts: 6ms, render: 34ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ“  13 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:458:7 â€º Guest Authentication â€º should switch between authentication tabs (3.0s)
[Worker 7] Created test guest: {
  email: [32m'test-w7-1770422558808-qlkuyfnc@example.com'[39m,
  id: [32m'317d1535-eedf-4259-bf78-f0cee5b2dfe2'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'65d24afc-03dc-4bf1-b83a-a22b3f7bb61b'[39m
}
[Worker 7] âœ… Verified guest exists: {
  email: [32m'test-w7-1770422558808-qlkuyfnc@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 36ms[2m (compile: 4ms, proxy.ts: 6ms, render: 26ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 151ms[2m (compile: 1177Âµs, proxy.ts: 6ms, render: 143ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=c13e904906df694bf8017f6e156bbb67f56843aca4062b14fc0da3b7fdf2335f [32m200[39m in 50ms[2m (compile: 7ms, proxy.ts: 7ms, render: 36ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 123ms[2m (compile: 7ms, proxy.ts: 5ms, render: 111ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 50ms[2m (compile: 3ms, proxy.ts: 7ms, render: 40ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 29ms[2m (compile: 1387Âµs, proxy.ts: 4ms, render: 23ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 158ms[2m (compile: 4ms, proxy.ts: 85ms, render: 70ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 184ms[2m (compile: 1973Âµs, proxy.ts: 27ms, render: 156ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
[2m[WebServer] [22m GET /auth/guest-login/verify?token=73df48c40267768545bcb1c9a1ad0023e2cc323161eaaad8e349b37b7ba3f7d3 [32m200[39m in 150ms[2m (compile: 21ms, proxy.ts: 66ms, render: 63ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 177ms[2m (compile: 4ms, proxy.ts: 53ms, render: 120ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 80ms[2m (compile: 6ms, proxy.ts: 5ms, render: 69ms)[22m
âœ… Comprehensive cleanup complete
  âœ˜  14 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:501:7 â€º Guest Authentication â€º should handle authentication errors gracefully (14.2s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
[Worker 8] Created test guest: {
  email: [32m'test-w8-1770422574915-pdp8i0b3@example.com'[39m,
  id: [32m'a9b2e51f-36ad-4982-9c3d-30a153dab378'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'77fda30b-9cdd-4492-a32a-15ad5316d66a'[39m
}
[Worker 8] âœ… Verified guest exists: {
  email: [32m'test-w8-1770422574915-pdp8i0b3@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 181ms[2m (compile: 13ms, proxy.ts: 41ms, render: 126ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w8-1770422574915-pdp8i0b3@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w8-1770422574915-pdp8i0b3@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'8d6c18c8'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'a9b2e51f-36ad-4982-9c3d-30a153dab378'[39m,
[2m[WebServer] [22m  sessionId: [32m'75520aae-5f3c-47e1-9a9f-36f64b34fd3c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 415ms[2m (compile: 3ms, proxy.ts: 9ms, render: 403ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8d6c18c8...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8d6c18c8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'8d6c18c8'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'a9b2e51f-36ad-4982-9c3d-30a153dab378'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w8-1770422574915-pdp8i0b3@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w8-1770422574915-pdp8i0b3@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 844ms[2m (compile: 14ms, proxy.ts: 176ms, render: 654ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8d6c18c8...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8d6c18c8...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8d6c18c8...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8d6c18c8...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8d6c18c8'
[2m[WebServer] [22m}
ðŸ§¹ Running comprehensive test cleanup...
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/wedding-info" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError fetching wedding info: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m GET /api/guest/wedding-info [31m500[39m in 413ms[2m (compile: 1720Âµs, proxy.ts: 124ms, render: 287ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8d6c18c8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8d6c18c8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8d6c18c8'
[2m[WebServer] [22m}
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:14:46)
[2m[WebServer] [22m[0m [90m 12 |[39m [36mexport[39m [36masync[39m [36mfunction[39m [33mGET[39m() {
[2m[WebServer] [22m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 15 |[39m
[2m[WebServer] [22m [90m 16 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 17 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/announcements" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError fetching announcements: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m GET /api/guest/announcements [31m500[39m in 535ms[2m (compile: 5ms, proxy.ts: 427ms, render: 103ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/events" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mAPI Error: {
[2m[WebServer] [22m  path: [32m'http://localhost:3000/api/guest/events'[39m,
[2m[WebServer] [22m  error: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m      at [3mignore-listed frames[23m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [31m500[39m in 691ms[2m (compile: 119ms, proxy.ts: 427ms, render: 145ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:21:46)
[2m[WebServer] [22m[0m [90m 19 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 21 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 22 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 23 |[39m     
[2m[WebServer] [22m [90m 24 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22mError: Route "/api/guest/rsvps" used `cookies().get`. `cookies()` returns a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
[2m[WebServer] [22m    at createCookiesAccessError (../../../src/server/request/cookies.ts:298:10)
[2m[WebServer] [22m    at Promise.get (../../../src/server/request/cookies.ts:257:7)
[2m[WebServer] [22m[0m [90m 296 |[39m ) {
[2m[WebServer] [22m [90m 297 |[39m   [36mconst[39m prefix [33m=[39m route [33m?[39m [32m`Route "${route}" `[39m [33m:[39m [32m'This route '[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 298 |[39m   [36mreturn[39m [36mnew[39m [33mError[39m(
[2m[WebServer] [22m [90m     |[39m          [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 299 |[39m     [32m`${prefix}used ${expression}. `[39m [33m+[39m
[2m[WebServer] [22m [90m 300 |[39m       [32m`\`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. `[39m [33m+[39m
[2m[WebServer] [22m [90m 301 |[39m       [32m`Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`[39m[0m
[2m[WebServer] [22m GET /api/guest/rsvps [31m500[39m in 801ms[2m (compile: 283ms, proxy.ts: 428ms, render: 91ms)[22m
[2m[WebServer] [22mTypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection: TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
[2m[WebServer] [22m[31m[1mâ¨¯[22m[39m unhandledRejection:  TypeError: nextCookies.get is not a function
[2m[WebServer] [22m    at [3mignore-listed frames[23m
âœ… Comprehensive cleanup complete
  âœ˜  15 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:545:7 â€º Guest Authentication â€º should log authentication events in audit log (6.7s)

ðŸ§¹ E2E Global Teardown Starting...

ðŸ—‘ï¸  Cleaning up test data...
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ðŸ”“ Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
âœ… Authentication state removed

ðŸ“Š Execution Summary:
   Duration: 1.50s
   Errors: 0
   Status: âœ… Clean teardown

âœ¨ E2E Global Teardown Complete!



  1) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:177:7 â€º Guest Authentication â€º should show loading state during authentication 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeDisabled[2m([22m[2m)[22m failed

    Locator: locator('button[type="submit"]:has-text("Log In")')
    Expected: disabled
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeDisabled" with timeout 10000ms[22m
    [2m  - waiting for locator('button[type="submit"]:has-text("Log In")')[22m
    [2m    - waiting for" http://localhost:3000/guest/dashboard" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/guest/dashboard"[22m


      186 |
      187 |     // Verify button is disabled during loading
    > 188 |     await expect(submitButton).toBeDisabled();
          |                                ^
      189 |   });
      190 |
      191 |   test('should create session cookie on successful authentication', async ({ page, context }) => {
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:188:32

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/error-context.md

  2) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:214:7 â€º Guest Authentication â€º should successfully request and verify magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      233 |
      234 |     // Wait for success message
    > 235 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      236 |     await expect(page.locator('.text-green-800')).toContainText(/check your email/i);
      237 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      238 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:235:48

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/error-context.md

  3) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:261:7 â€º Guest Authentication â€º should show success message after requesting magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      278 |
      279 |     // Verify success message
    > 280 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      281 |     await expect(page.locator('.text-green-800')).toContainText('Check your email for a login link');
      282 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      283 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:280:48

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/error-context.md

  4) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:289:7 â€º Guest Authentication â€º should show error for expired magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('h1')
    Expected substring: [32m"Link Expired"[39m
    Received string:    [31m"Invalid Link"[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m
    [2m    - waiting for" http://localhost:3000/auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link"[22m
    [2m    3 Ã— locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m      - unexpected value "Verifying Your Link"[22m
    [2m    9 Ã— locator resolved to <h1 class="text-2xl font-bold text-red-800 mb-2">Invalid Link</h1>[22m
    [2m      - unexpected value "Invalid Link"[22m


      312 |
      313 |     // Verify error message with more specific selectors
    > 314 |     await expect(page.locator('h1')).toContainText('Link Expired');
          |                                      ^
      315 |     const errorDescription = page.locator('p.text-gray-600').first();
      316 |     await expect(errorDescription).toContainText('This magic link has expired');
      317 |     const securityNote = page.locator('p.text-sm.text-gray-500');
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:314:38

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-fc3b3-rror-for-expired-magic-link-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-fc3b3-rror-for-expired-magic-link-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-fc3b3-rror-for-expired-magic-link-chromium/error-context.md

  5) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:325:7 â€º Guest Authentication â€º should show error for already used magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      337 |     await page.fill('#magic-link-input', testGuestEmail);
      338 |     await page.click('button[type="submit"]:has-text("Send Magic Link")');
    > 339 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      340 |
      341 |     // Get token from database
      342 |     const { data: tokens } = await supabase
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:339:48

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/error-context.md

  6) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:396:7 â€º Guest Authentication â€º should complete logout flow 

    TimeoutError: page.waitForURL: Timeout 5000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/auth/guest-login" until "load"
      navigated to "http://localhost:3000/auth/guest-login?returnTo=%2Fguest%2Fdashboard"
    ============================================================

      413 |
      414 |     // Step 4: Wait for redirect to login page
    > 415 |     await page.waitForURL('/auth/guest-login', { timeout: 5000 });
          |                ^
      416 |
      417 |     // Step 5: Verify we're on login page
      418 |     await expect(page).toHaveURL('/auth/guest-login');
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:415:16

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/error-context.md

  7) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:433:7 â€º Guest Authentication â€º should persist authentication across page refreshes 

    TimeoutError: page.waitForURL: Timeout 5000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/guest/dashboard" until "load"
      navigated to "http://localhost:3000/auth/guest-login"
      navigated to "http://localhost:3000/auth/guest-login"
    ============================================================

      436 |     await page.fill('#email-matching-input', testGuestEmail);
      437 |     await page.click('button[type="submit"]:has-text("Log In")');
    > 438 |     await page.waitForURL('/guest/dashboard', { timeout: 5000 });
          |                ^
      439 |
      440 |     // Step 2: Navigate to different pages
      441 |     await page.goto('/guest/events');
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:438:16

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/error-context.md

  8) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:501:7 â€º Guest Authentication â€º should handle authentication errors gracefully 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('h1')
    Expected substring: [32m"Link Expired"[39m
    Received string:    [31m"Invalid Link"[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m
    [2m    2 Ã— locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m      - unexpected value "Verifying Your Link"[22m
    [2m    - waiting for" http://localhost:3000/api/guest-auth/magic-link/verify" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link"[22m
    [2m    2 Ã— locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m      - unexpected value "Verifying Your Link"[22m
    [2m    9 Ã— locator resolved to <h1 class="text-2xl font-bold text-red-800 mb-2">Invalid Link</h1>[22m
    [2m      - unexpected value "Invalid Link"[22m


      538 |
      539 |     await page.goto(`/auth/guest-login/verify?token=${token}`);
    > 540 |     await expect(page.locator('h1')).toContainText('Link Expired');
          |                                      ^
      541 |     const expiredDescription = page.locator('p.text-gray-600').first();
      542 |     await expect(expiredDescription).toContainText('This magic link has expired');
      543 |   });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:540:38

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/error-context.md

  9) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:545:7 â€º Guest Authentication â€º should log authentication events in audit log 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoHaveLength[2m([22m[32mexpected[39m[2m)[22m

    Expected length: [32m1[39m
    Received length: [31m0[39m
    Received array:  [31m[][39m

      561 |
      562 |     expect(loginError).toBeNull();
    > 563 |     expect(loginLogs).toHaveLength(1);
          |                       ^
      564 |     expect(loginLogs![0].details.auth_method).toBe('email_matching');
      565 |     expect(loginLogs![0].details.email).toBe(testGuestEmail);
      566 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:563:23

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/error-context.md

  9 failed
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:177:7 â€º Guest Authentication â€º should show loading state during authentication 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:214:7 â€º Guest Authentication â€º should successfully request and verify magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:261:7 â€º Guest Authentication â€º should show success message after requesting magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:289:7 â€º Guest Authentication â€º should show error for expired magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:325:7 â€º Guest Authentication â€º should show error for already used magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:396:7 â€º Guest Authentication â€º should complete logout flow 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:433:7 â€º Guest Authentication â€º should persist authentication across page refreshes 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:501:7 â€º Guest Authentication â€º should handle authentication errors gracefully 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:545:7 â€º Guest Authentication â€º should log authentication events in audit log 
  6 passed (2.7m)

[36m  Serving HTML report at http://localhost:52433. Press Ctrl+C to quit.[39m
