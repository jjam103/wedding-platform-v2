
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168m‚ñ≤ Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.7.238:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Starting...
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22müöÄ Initializing application services...
[2m[WebServer] [22m‚úÖ B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m‚úÖ Application services initialized successfully
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Ready in 3.3s

üöÄ E2E Global Setup Starting...

üìä Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 1356ms[2m (compile: 1022ms, proxy.ts: 160ms, render: 173ms)[22m
‚úÖ Test database connected

üßπ Cleaning up test data...
   Cleaning up leftover test data...
   Test data cleanup complete
‚úÖ Test data cleaned

üë§ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 1783bf0b-4ef2-4fc3-8385-b366dc38d183)
   Created test guest: test@example.com (ID: 9cfc42a1-f6e5-4279-a435-b8b212644df5)
‚úÖ Test guest created

üì¶ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
‚úÖ Comprehensive test data created

üåê Verifying Next.js server...
‚úÖ Next.js server is running

üî• Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 52ms[2m (compile: 4ms, proxy.ts: 21ms, render: 27ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'9dba5c30'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'1783bf0b-4ef2-4fc3-8385-b366dc38d183'[39m,
[2m[WebServer] [22m  sessionId: [32m'0347293d-5e8a-43fd-acf4-f42cb3bfee45'[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1359ms[2m (compile: 917ms, proxy.ts: 7ms, render: 435ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'1783bf0b-4ef2-4fc3-8385-b366dc38d183'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest has wrong auth method: email_matching
   ‚úÖ Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m400[39m in 338ms[2m (compile: 166ms, proxy.ts: 11ms, render: 161ms)[22m
   ‚úÖ Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 949ms[2m (compile: 777ms, proxy.ts: 13ms, render: 159ms)[22m
   ‚úÖ Guest auth routes warmup complete
‚úÖ API routes warmed up

üîê Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 558ms[2m (compile: 451ms, proxy.ts: 7ms, render: 100ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 1077ms[2m (compile: 494ms, proxy.ts: 458ms, render: 125ms)[22m
   Current URL after submit: http://localhost:3000/admin
   ‚úÖ Successfully logged in via browser
   ‚úÖ Authentication state saved
‚úÖ Admin authentication saved

‚ú® E2E Global Setup Complete!


Running 15 tests using 4 workers

  -   1 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:240:8 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770449887638-xbjutlvk@example.com'[39m,
  id: [32m'2b8ca38a-39c5-4eca-926a-20eb7c6d5e06'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'75ddc1c4-a11e-44af-b1d5-781b76cc73c4'[39m
}
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770449887639-9om1y1bw@example.com'[39m,
  id: [32m'ff1d14ae-aee1-4320-a6fa-a12ff8936258'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'a1243888-b323-4017-a6e3-82ed18c499f4'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449887639-o4fye3tr@example.com'[39m,
  id: [32m'faaedef8-f294-49ea-8bef-30711832c307'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'2c52254e-938e-481a-b5c2-66e2311caecf'[39m
}
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449887645-xavdk2ai@example.com'[39m,
  id: [32m'0f503ffe-cccd-49c6-bdfd-958e67f0393d'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'84859747-82dc-494b-9030-ebd118810260'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770449887638-xbjutlvk@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770449887639-9om1y1bw@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449887639-o4fye3tr@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449887645-xavdk2ai@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 469ms[2m (compile: 288ms, proxy.ts: 14ms, render: 167ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 470ms[2m (compile: 288ms, proxy.ts: 14ms, render: 168ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 465ms[2m (compile: 285ms, proxy.ts: 12ms, render: 168ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 473ms[2m (compile: 288ms, proxy.ts: 14ms, render: 172ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] [HMR] connected
[Test] About to click submit button
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770449887645-xavdk2ai@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770449887639-9om1y1bw@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449887645-xavdk2ai@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449887639-9om1y1bw@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 385ms[2m (compile: 88ms, proxy.ts: 33ms, render: 264ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'4d240fbc'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'0f503ffe-cccd-49c6-bdfd-958e67f0393d'[39m,
[2m[WebServer] [22m  sessionId: [32m'0145b4f3-4dc8-419b-a285-7eeb8d3a730a'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 498ms[2m (compile: 87ms, proxy.ts: 37ms, render: 374ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'3b346804'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'ff1d14ae-aee1-4320-a6fa-a12ff8936258'[39m,
[2m[WebServer] [22m  sessionId: [32m'd6c85773-ca42-4cd9-af9b-79e54c945b5b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 494ms[2m (compile: 6ms, proxy.ts: 120ms, render: 368ms)[22m
[Browser warning] Cookie not set yet, waiting additional time...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'3b346804'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'4d240fbc'[39m }
[Browser log] [Fast Refresh] done in 926ms
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'0f503ffe-cccd-49c6-bdfd-958e67f0393d'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'ff1d14ae-aee1-4320-a6fa-a12ff8936258'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449887639-9om1y1bw@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449887639-9om1y1bw@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449887645-xavdk2ai@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449887645-xavdk2ai@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.2s[2m (compile: 1146ms, proxy.ts: 283ms, render: 769ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.2s[2m (compile: 1175ms, proxy.ts: 262ms, render: 769ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 3b346804}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: ff1d14ae-aee1-4320-a6fa-a12ff8936258}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449887639-9om1y1bw@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449887639-9om1y1bw@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 229ms[2m (compile: 25ms, proxy.ts: 66ms, render: 138ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 230ms[2m (compile: 25ms, proxy.ts: 66ms, render: 139ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 471ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 515ms
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'3b346804'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'ff1d14ae-aee1-4320-a6fa-a12ff8936258'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449887639-9om1y1bw@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449887639-9om1y1bw@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 3b346804}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: ff1d14ae-aee1-4320-a6fa-a12ff8936258}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449887639-9om1y1bw@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449887639-9om1y1bw@example.com
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'4d240fbc'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'0f503ffe-cccd-49c6-bdfd-958e67f0393d'[39m
[2m[WebServer] [22m}
  ‚úì   2 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:227:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid email format (8.8s)
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449887645-xavdk2ai@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449887645-xavdk2ai@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 642ms[2m (compile: 161ms, proxy.ts: 254ms, render: 228ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 671ms[2m (compile: 31ms, proxy.ts: 554ms, render: 86ms)[22m
  ‚úì   4 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:212:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for non-existent email (8.8s)
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.3s[2m (compile: 1170ms, proxy.ts: 359ms, render: 779ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.3s[2m (compile: 1170ms, proxy.ts: 358ms, render: 790ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 2.3s[2m (compile: 1254ms, proxy.ts: 273ms, render: 794ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 2.3s[2m (compile: 1273ms, proxy.ts: 256ms, render: 794ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 2.3s[2m (compile: 1170ms, proxy.ts: 358ms, render: 802ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 2.3s[2m (compile: 1254ms, proxy.ts: 274ms, render: 807ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'4d240fbc'[39m }
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449896676-5a7jph77@example.com'[39m,
  id: [32m'cc778f6e-2134-472f-8bbd-a042bd557149'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'579342f5-db9f-4fcd-a226-a33dec8eaa51'[39m
}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.5s[2m (compile: 1252ms, proxy.ts: 276ms, render: 1021ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.6s[2m (compile: 1273ms, proxy.ts: 255ms, render: 1031ms)[22m
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770449896719-4nhe3sb3@example.com'[39m,
  id: [32m'00e19449-32de-4422-983b-7d63f11c5e90'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'2f4e282f-4f37-476f-b8eb-abfdb5c71751'[39m
}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'0f503ffe-cccd-49c6-bdfd-958e67f0393d'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'3b346804'[39m }
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449896676-5a7jph77@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770449896719-4nhe3sb3@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449887645-xavdk2ai@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449887645-xavdk2ai@example.com
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'ff1d14ae-aee1-4320-a6fa-a12ff8936258'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 666ms[2m (compile: 1959¬µs, proxy.ts: 216ms, render: 449ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449887639-9om1y1bw@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449887639-9om1y1bw@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 776ms[2m (compile: 62ms, proxy.ts: 338ms, render: 376ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 135ms[2m (compile: 9ms, proxy.ts: 25ms, render: 101ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '4d240fbc...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 129ms[2m (compile: 41ms, proxy.ts: 43ms, render: 45ms)[22m
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 3b346804}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: ff1d14ae-aee1-4320-a6fa-a12ff8936258}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449887639-9om1y1bw@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449887639-9om1y1bw@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '4d240fbc'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 615ms[2m (compile: 18ms, proxy.ts: 192ms, render: 405ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 673ms[2m (compile: 25ms, proxy.ts: 205ms, render: 442ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 674ms[2m (compile: 23ms, proxy.ts: 203ms, render: 448ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 634ms[2m (compile: 5ms, proxy.ts: 171ms, render: 458ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 652ms[2m (compile: 8ms, proxy.ts: 172ms, render: 472ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 661ms[2m (compile: 1642¬µs, proxy.ts: 156ms, render: 503ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 817ms[2m (compile: 24ms, proxy.ts: 199ms, render: 594ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 837ms[2m (compile: 10ms, proxy.ts: 174ms, render: 652ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w2-1770449896676-5a7jph77@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'cc778f6e-2134-472f-8bbd-a042bd557149'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w2-1770449896676-5a7jph77@example.com: http://localhost:3000/auth/guest-login/verify?token=8449a619e82961f06fef15243f62364dd69e91fcc08b932a2567fd67da1c0ecb
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 295ms[2m (compile: 6ms, proxy.ts: 12ms, render: 278ms)[22m
  ‚úì   5 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:266:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication (11.5s)
[Browser log] [Fast Refresh] rebuilding
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449899397-scb3j9hd@example.com'[39m,
  id: [32m'757b1efa-25c6-47a9-9660-61719164886e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'1b69d03c-481e-4e76-b8cb-e7434ab4c6d8'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449899397-scb3j9hd@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[Browser log] [Fast Refresh] done in 349ms
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w1-1770449896719-4nhe3sb3@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m GET /auth/guest-login/verify?token=8449a619e82961f06fef15243f62364dd69e91fcc08b932a2567fd67da1c0ecb [32m200[39m in 672ms[2m (compile: 538ms, proxy.ts: 5ms, render: 129ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=b7e9811e56385e41635708c79f671d6776987389e4a7d08f9263df919d62d36e [32m200[39m in 36ms[2m (compile: 3ms, proxy.ts: 6ms, render: 26ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'00e19449-32de-4422-983b-7d63f11c5e90'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w1-1770449896719-4nhe3sb3@example.com: http://localhost:3000/auth/guest-login/verify?token=0eee979821690f3556cf204236a4b0d44f6c02a3594c36cd57fc0c9b4a7e68f1
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 449ms[2m (compile: 41ms, proxy.ts: 117ms, render: 291ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 121ms[2m (compile: 21ms, proxy.ts: 26ms, render: 74ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'3b346804'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'ff1d14ae-aee1-4320-a6fa-a12ff8936258'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 149ms[2m (compile: 1255¬µs, proxy.ts: 6ms, render: 142ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 50ms[2m (compile: 7ms, proxy.ts: 6ms, render: 37ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449887639-9om1y1bw@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449887639-9om1y1bw@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 724ms[2m (compile: 18ms, proxy.ts: 171ms, render: 535ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 822ms[2m (compile: 20ms, proxy.ts: 30ms, render: 773ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '94ed6c6a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '94ed6c6a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'94ed6c6a'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'cc778f6e-2134-472f-8bbd-a042bd557149'[39m
[2m[WebServer] [22m}
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770449896676-5a7jph77@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770449896676-5a7jph77@example.com
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 3b346804}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: ff1d14ae-aee1-4320-a6fa-a12ff8936258}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449887639-9om1y1bw@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449887639-9om1y1bw@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 554ms[2m (compile: 6ms, proxy.ts: 168ms, render: 380ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3b346804...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3b346804'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 659ms[2m (compile: 25ms, proxy.ts: 155ms, render: 478ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 773ms[2m (compile: 30ms, proxy.ts: 156ms, render: 586ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 797ms[2m (compile: 39ms, proxy.ts: 160ms, render: 598ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 799ms[2m (compile: 18ms, proxy.ts: 155ms, render: 626ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '94ed6c6a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '94ed6c6a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '94ed6c6a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '94ed6c6a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '94ed6c6a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '94ed6c6a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '94ed6c6a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '94ed6c6a'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 695ms[2m (compile: 1282¬µs, proxy.ts: 272ms, render: 422ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 698ms[2m (compile: 1393¬µs, proxy.ts: 260ms, render: 437ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 710ms[2m (compile: 1376¬µs, proxy.ts: 255ms, render: 454ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 870ms[2m (compile: 1273¬µs, proxy.ts: 266ms, render: 603ms)[22m
  ‚úì   3 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:162:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching (17.4s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770449905294-zfkcb8ao@example.com'[39m,
  id: [32m'6c48dfb7-100b-4c5b-a134-44b9e51439ef'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e6bda548-357d-4981-bfc8-779bdeede18e'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770449905294-zfkcb8ao@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 55ms[2m (compile: 4ms, proxy.ts: 9ms, render: 41ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w0-1770449905294-zfkcb8ao@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'6c48dfb7-100b-4c5b-a134-44b9e51439ef'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w0-1770449905294-zfkcb8ao@example.com: http://localhost:3000/auth/guest-login/verify?token=1ce95075315285302fae7e21859e10a0bf08b595ee495fb9809891a3a0030aeb
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 298ms[2m (compile: 1176¬µs, proxy.ts: 6ms, render: 291ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=1ce95075315285302fae7e21859e10a0bf08b595ee495fb9809891a3a0030aeb [32m200[39m in 84ms[2m (compile: 7ms, proxy.ts: 14ms, render: 63ms)[22m
  ‚úì   6 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:292:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link (11.3s)
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449908010-83ssh49p@example.com'[39m,
  id: [32m'5a8da9aa-f59e-4b2d-acb4-5ae4aeee55da'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c66a7946-b2ec-47f6-93f7-56b9060a06f4'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449908010-83ssh49p@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 81ms[2m (compile: 3ms, proxy.ts: 13ms, render: 64ms)[22m
  ‚úì   8 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:416:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link (9.6s)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 694ms[2m (compile: 1141¬µs, proxy.ts: 5ms, render: 688ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '70d9e062...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '70d9e062'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'70d9e062'[39m }
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449909010-34fszu70@example.com'[39m,
  id: [32m'1d21f5f7-8d3c-41b5-8f84-b5c5b7ec21c9'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'8c27750c-2f6b-4cac-a92a-b1607f1993f7'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449909010-34fszu70@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'6c48dfb7-100b-4c5b-a134-44b9e51439ef'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 82ms[2m (compile: 1260¬µs, proxy.ts: 5ms, render: 76ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449905294-zfkcb8ao@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449905294-zfkcb8ao@example.com
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 104ms[2m (compile: 6ms, proxy.ts: 17ms, render: 81ms)[22m
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 640ms[2m (compile: 2ms, proxy.ts: 139ms, render: 498ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=0279036531dcda6e4e8ea4e7831cad9982d93e19b58d3d7c38d3a91b176e2884 [32m200[39m in 165ms[2m (compile: 4ms, proxy.ts: 13ms, render: 148ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '70d9e062...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '70d9e062...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '70d9e062...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '70d9e062...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=1ce95075315285302fae7e21859e10a0bf08b595ee495fb9809891a3a0030aeb [32m200[39m in 109ms[2m (compile: 2ms, proxy.ts: 47ms, render: 59ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '70d9e062'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '70d9e062'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '70d9e062'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '70d9e062'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770449909010-34fszu70@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449909010-34fszu70@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'baa62ca6'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'1d21f5f7-8d3c-41b5-8f84-b5c5b7ec21c9'[39m,
[2m[WebServer] [22m  sessionId: [32m'6d8e4f24-c115-4812-8aab-9cbaa0e39f42'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 316ms[2m (compile: 8ms, proxy.ts: 12ms, render: 297ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 183ms[2m (compile: 3ms, proxy.ts: 24ms, render: 156ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 55ms[2m (compile: 1823¬µs, proxy.ts: 8ms, render: 46ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 294ms[2m (compile: 1850¬µs, proxy.ts: 12ms, render: 280ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used [32m200[39m in 52ms[2m (compile: 11ms, proxy.ts: 6ms, render: 36ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'baa62ca6...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'baa62ca6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'baa62ca6'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1d21f5f7-8d3c-41b5-8f84-b5c5b7ec21c9'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449909010-34fszu70@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449909010-34fszu70@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 515ms[2m (compile: 2ms, proxy.ts: 180ms, render: 333ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'baa62ca6...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'baa62ca6...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'baa62ca6...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'baa62ca6...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'baa62ca6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'baa62ca6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'baa62ca6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'baa62ca6'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 559ms[2m (compile: 1596¬µs, proxy.ts: 145ms, render: 413ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 565ms[2m (compile: 4ms, proxy.ts: 150ms, render: 410ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 588ms[2m (compile: 6ms, proxy.ts: 154ms, render: 429ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 711ms[2m (compile: 4ms, proxy.ts: 159ms, render: 549ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/logout [32m200[39m in 694ms[2m (compile: 403ms, proxy.ts: 10ms, render: 280ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 86ms[2m (compile: 25ms, proxy.ts: 12ms, render: 49ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: false,
[2m[WebServer] [22m  cookieValue: 'none',
[2m[WebServer] [22m  allCookies: []
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No guest session cookie found - redirecting to login
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 36ms[2m (compile: 2ms, proxy.ts: 6ms, render: 28ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used [32m200[39m in 161ms[2m (compile: 12ms, proxy.ts: 9ms, render: 140ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 162ms[2m (compile: 12ms, proxy.ts: 9ms, render: 141ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 165ms[2m (compile: 35ms, proxy.ts: 9ms, render: 120ms)[22m
  ‚úò   7 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link (19.2s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770449916853-ye5jit86@example.com'[39m,
  id: [32m'351b4932-d20f-4311-a31a-59460bb96a97'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'67b1550d-edd9-4350-974c-ab279b79e4bc'[39m
}
[Worker 4] ‚úÖ Verified guest exists: {
  email: [32m'test-w4-1770449916853-ye5jit86@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 63ms[2m (compile: 1246¬µs, proxy.ts: 11ms, render: 51ms)[22m
  ‚úì   9 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:450:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link (13.0s)
  ‚úì  10 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:512:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token (10.3s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770449918311-4u7u6jpb@example.com'[39m,
  id: [32m'43ca26a4-73d1-4003-ace8-24a34c939f94'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e31b7aa2-14dd-40e8-bbc8-3cd37b026207'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449918357-qqoqppaw@example.com'[39m,
  id: [32m'6765bc64-6cf1-4d5f-9b59-45fd31f98526'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'300e0ea1-c8d4-404c-bda3-e3b990ce8858'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770449918311-4u7u6jpb@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449918357-qqoqppaw@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 57ms[2m (compile: 6ms, proxy.ts: 7ms, render: 44ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 65ms[2m (compile: 6ms, proxy.ts: 25ms, render: 34ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w4-1770449916853-ye5jit86@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770449916853-ye5jit86@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'5675c521'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'351b4932-d20f-4311-a31a-59460bb96a97'[39m,
[2m[WebServer] [22m  sessionId: [32m'49cd3572-9574-48ad-afe2-bf1aa4ff3dcc'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 316ms[2m (compile: 9ms, proxy.ts: 15ms, render: 292ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'5675c521'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'351b4932-d20f-4311-a31a-59460bb96a97'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770449916853-ye5jit86@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w4-1770449916853-ye5jit86@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 615ms[2m (compile: 10ms, proxy.ts: 146ms, render: 459ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 170ms[2m (compile: 4ms, proxy.ts: 10ms, render: 156ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=56013c137a97c8d5f1976abdcfab4aca0f47fdefac9410c52d11cbeb71f2ccd9 [32m200[39m in 685ms[2m (compile: 477ms, proxy.ts: 34ms, render: 174ms)[22m
  ‚úì  11 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:541:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow (13.4s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 138ms[2m (compile: 19ms, proxy.ts: 41ms, render: 78ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 245ms[2m (compile: 20ms, proxy.ts: 185ms, render: 41ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/events [32m200[39m in 1855ms[2m (compile: 1224ms, proxy.ts: 137ms, render: 494ms)[22m
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449922403-sdszmaky@example.com'[39m,
  id: [32m'ba5fe036-42b3-4f27-b35c-aefa03ef213b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'fc544acf-d6c1-47cf-aa32-a3a7e70ff63a'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449922403-sdszmaky@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 120ms[2m (compile: 35ms, proxy.ts: 21ms, render: 65ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 196ms[2m (compile: 17ms, proxy.ts: 22ms, render: 157ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 79ms[2m (compile: 9ms, proxy.ts: 17ms, render: 53ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 526ms[2m (compile: 6ms, proxy.ts: 169ms, render: 350ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 533ms[2m (compile: 13ms, proxy.ts: 160ms, render: 359ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770449922403-sdszmaky@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449922403-sdszmaky@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'0219439b'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'ba5fe036-42b3-4f27-b35c-aefa03ef213b'[39m,
[2m[WebServer] [22m  sessionId: [32m'8742c216-ad45-4d2d-990a-2caaa47b4e3e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 779ms[2m (compile: 5ms, proxy.ts: 5ms, render: 769ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1567ms[2m (compile: 1747¬µs, proxy.ts: 358ms, render: 1208ms)[22m
  ‚úì  13 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:648:7 ‚Ä∫ Guest Authentication ‚Ä∫ should switch between authentication tabs (8.1s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0219439b...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0219439b'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'0219439b'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'ba5fe036-42b3-4f27-b35c-aefa03ef213b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449922403-sdszmaky@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449922403-sdszmaky@example.com
[2m[WebServer] [22m GET /guest/activities [32m200[39m in 3.3s[2m (compile: 1352ms, proxy.ts: 590ms, render: 1366ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.8s[2m (compile: 1207ms, proxy.ts: 246ms, render: 1379ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 165ms[2m (compile: 21ms, proxy.ts: 96ms, render: 48ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0219439b...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0219439b...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0219439b...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0219439b...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '5675c521...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úì  14 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:691:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully (12.2s)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0219439b'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '5675c521'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0219439b'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0219439b'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0219439b'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 932ms[2m (compile: 35ms, proxy.ts: 270ms, render: 627ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 936ms[2m (compile: 27ms, proxy.ts: 270ms, render: 639ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 939ms[2m (compile: 24ms, proxy.ts: 269ms, render: 646ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1113ms[2m (compile: 21ms, proxy.ts: 267ms, render: 826ms)[22m
[2m[WebServer] [22m GET /api/guest/activities [32m200[39m in 1637ms[2m (compile: 783ms, proxy.ts: 269ms, render: 585ms)[22m
Audit log query result: {
  found: [33m0[39m,
  guestId: [32m'ba5fe036-42b3-4f27-b35c-aefa03ef213b'[39m,
  error: [90mundefined[39m
}
‚ö†Ô∏è  No audit logs found - migration 053 may not be applied to E2E database
   This is not a critical failure - audit logging is a nice-to-have feature
  ‚úì  12 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:601:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes (21.1s)
  ‚úì  15 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:748:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log (16.7s)

üßπ E2E Global Teardown Starting...

üóëÔ∏è  Cleaning up test data...
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üîì Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
‚úÖ Authentication state removed

üìä Execution Summary:
   Duration: 2.45s
   Errors: 0
   Status: ‚úÖ Clean teardown

‚ú® E2E Global Teardown Complete!



  1) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      405 |
      406 |     // Verify success message with increased timeout
    > 407 |     await expect(page.locator('.bg-green-50')).toBeVisible({ timeout: 10000 });
          |                                                ^
      408 |     await expect(page.locator('.text-green-800')).toContainText('Check your email for a login link');
      409 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      410 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:407:48

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/error-context.md

  1 failed
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 
  1 skipped
  13 passed (1.2m)

[36m  Serving HTML report at http://localhost:50955. Press Ctrl+C to quit.[39m
