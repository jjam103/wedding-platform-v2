
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts --workers=1

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168mâ–² Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.180.84:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1mâœ“[22m[39m Starting...
[2m[WebServer] [22m[33m[1mâš [22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22mðŸš€ Initializing application services...
[2m[WebServer] [22mâœ… B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mâœ… Application services initialized successfully
[2m[WebServer] [22m[32m[1mâœ“[22m[39m Ready in 3s

ðŸš€ E2E Global Setup Starting...

ðŸ“Š Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 3.3s[2m (compile: 2.9s, proxy.ts: 196ms, render: 210ms)[22m
âœ… Test database connected

ðŸ§¹ Cleaning up test data...
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ðŸ‘¤ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 65dfcaa0-871d-4453-9a2f-006081d6b796)
   Created test guest: test@example.com (ID: 17e3399c-a86d-456c-ba8c-f224272fc7c8)
âœ… Test guest created

ðŸ“¦ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
âœ… Comprehensive test data created

ðŸŒ Verifying Next.js server...
âœ… Next.js server is running

ðŸ”¥ Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 69ms[2m (compile: 4ms, proxy.ts: 38ms, render: 27ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'477509fb'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'65dfcaa0-871d-4453-9a2f-006081d6b796'[39m,
[2m[WebServer] [22m  sessionId: [32m'82030fed-d223-4c18-bb73-938a01734f99'[39m
[2m[WebServer] [22m}
   âœ… Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1777ms[2m (compile: 1219ms, proxy.ts: 10ms, render: 549ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
   âœ… Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 404)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 717ms[2m (compile: 454ms, proxy.ts: 23ms, render: 240ms)[22m
   âœ… Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 2.4s[2m (compile: 2.2s, proxy.ts: 13ms, render: 174ms)[22m
   âœ… Guest auth routes warmup complete
âœ… API routes warmed up

ðŸ” Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET / [32m200[39m in 124ms[2m (compile: 46ms, proxy.ts: 7ms, render: 70ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 36ms[2m (compile: 8ms, proxy.ts: 7ms, render: 20ms)[22m
[2m[WebServer] [22m GET /auth/login [32m200[39m in 1982ms[2m (compile: 1797ms, proxy.ts: 11ms, render: 174ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m GET / [32m200[39m in 89ms[2m (compile: 21ms, proxy.ts: 33ms, render: 35ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /admin [32m200[39m in 2.2s[2m (compile: 1641ms, proxy.ts: 384ms, render: 180ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'96d53053'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'1d3e27b4-6359-4e62-b850-73827d10301a'[39m,
[2m[WebServer] [22m  sessionId: [32m'c937e9e5-2c2f-431d-8376-46165649e0b6'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1935ms[2m (compile: 1593ms, proxy.ts: 37ms, render: 305ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 135ms[2m (compile: 6ms, proxy.ts: 9ms, render: 120ms)[22m
   Current URL after submit: http://localhost:3000/admin
   âœ… Successfully logged in via browser
   âœ… Authentication state saved
âœ… Admin authentication saved

âœ¨ E2E Global Setup Complete!


Running 15 tests using 1 worker

[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 338ms[2m (compile: 20ms, proxy.ts: 203ms, render: 114ms)[22m
[2m[WebServer] [22m GET /auth/login [32m200[39m in 80ms[2m (compile: 7ms, proxy.ts: 15ms, render: 57ms)[22m
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770423302102-g8p5nadr@example.com'[39m,
  id: [32m'c26580d6-2435-43dd-b9c7-410e4e8f2d3d'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'bc5abc67-2b63-414d-a3ac-3011393999d2'[39m
}
[Worker 0] âœ… Verified guest exists: {
  email: [32m'test-w0-1770423302102-g8p5nadr@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m GET /admin [32m200[39m in 1614ms[2m (compile: 736ms, proxy.ts: 680ms, render: 198ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1690ms[2m (compile: 1475ms, proxy.ts: 10ms, render: 206ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770423302102-g8p5nadr@example.com
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770423302102-g8p5nadr@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'12a4c6f6'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'c26580d6-2435-43dd-b9c7-410e4e8f2d3d'[39m,
[2m[WebServer] [22m  sessionId: [32m'f6d7c3c4-7622-49fd-8409-837fea93dff6'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 427ms[2m (compile: 66ms, proxy.ts: 13ms, render: 349ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '12a4c6f6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '12a4c6f6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'12a4c6f6'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'c26580d6-2435-43dd-b9c7-410e4e8f2d3d'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770423302102-g8p5nadr@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770423302102-g8p5nadr@example.com
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 635ms[2m (compile: 261ms, proxy.ts: 103ms, render: 270ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 638ms[2m (compile: 261ms, proxy.ts: 103ms, render: 273ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 639ms[2m (compile: 261ms, proxy.ts: 103ms, render: 275ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 649ms[2m (compile: 261ms, proxy.ts: 103ms, render: 284ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 4.8s[2m (compile: 2.8s, proxy.ts: 127ms, render: 1863ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '12a4c6f6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '12a4c6f6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '12a4c6f6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '12a4c6f6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '12a4c6f6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '12a4c6f6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '12a4c6f6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770423307994-88chx1st@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770423308049-sz93vo71@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '12a4c6f6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 404ms[2m (compile: 181ms, proxy.ts: 54ms, render: 169ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 421ms[2m (compile: 181ms, proxy.ts: 54ms, render: 186ms)[22m
  âœ˜   1 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:130:7 â€º Guest Authentication â€º should successfully authenticate with email matching (11.4s)
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 453ms[2m (compile: 17ms, proxy.ts: 253ms, render: 182ms)[22m
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770423315450-grkpmley@example.com'[39m,
  id: [32m'33ca6f28-2c8e-4633-ad16-c2e2a208e29d'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'78f7787a-53b7-4bd8-90fd-0cbae2414a60'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 90ms[2m (compile: 3ms, proxy.ts: 12ms, render: 75ms)[22m
[Worker 1] âœ… Verified guest exists: {
  email: [32m'test-w1-1770423315450-grkpmley@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 73ms[2m (compile: 2ms, proxy.ts: 14ms, render: 57ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w2-1770423315235-2hpcp15a@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770423315235-2hpcp15a@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'e2b43ab6'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'c10e5eae-f07a-4a2e-8120-d16fa4ca53ef'[39m,
[2m[WebServer] [22m  sessionId: [32m'bd98e0a7-873e-4edb-bc2d-35939af0aa02'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 423ms[2m (compile: 3ms, proxy.ts: 13ms, render: 406ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 109ms[2m (compile: 11ms, proxy.ts: 16ms, render: 82ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2b43ab6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 169ms[2m (compile: 4ms, proxy.ts: 34ms, render: 131ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2b43ab6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e2b43ab6'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'c10e5eae-f07a-4a2e-8120-d16fa4ca53ef'[39m
[2m[WebServer] [22m}
ðŸ§¹ Running comprehensive test cleanup...
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770423315235-2hpcp15a@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770423315235-2hpcp15a@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 573ms[2m (compile: 3ms, proxy.ts: 118ms, render: 451ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 144ms[2m (compile: 12ms, proxy.ts: 14ms, render: 117ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2b43ab6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2b43ab6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2b43ab6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2b43ab6...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2b43ab6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2b43ab6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2b43ab6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2b43ab6'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
âœ… Comprehensive cleanup complete
  âœ“   2 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:149:7 â€º Guest Authentication â€º should show error for non-existent email (4.6s)
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770423320334-zqlug0zx@example.com'[39m,
  id: [32m'acdb8ceb-18c8-4608-b076-40f051ccc7d4'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'56e4fa0a-9c7e-4c4c-9b7f-bb547d096416'[39m
}
[Worker 1] âœ… Verified guest exists: {
  email: [32m'test-w1-1770423320334-zqlug0zx@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 60ms[2m (compile: 4ms, proxy.ts: 15ms, render: 41ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 56ms[2m (compile: 4ms, proxy.ts: 6ms, render: 46ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 133ms[2m (compile: 2ms, proxy.ts: 11ms, render: 120ms)[22m
âœ… Comprehensive cleanup complete
[2m[WebServer] [22m GET /auth/guest-login/verify?token=ef7eff59d3bf61f933b5f9a97f55863f6096071d946f93197d458efa95710a45 [32m200[39m in 720ms[2m (compile: 597ms, proxy.ts: 5ms, render: 118ms)[22m
  âœ“   3 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:164:7 â€º Guest Authentication â€º should show error for invalid email format (2.8s)
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770423323134-yrzodawe@example.com'[39m,
  id: [32m'd7a12c9f-f4be-45e3-82f2-7fe3ab9f669c'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'983fae6c-24e8-4679-91ce-2653979c3609'[39m
}
[Worker 1] âœ… Verified guest exists: {
  email: [32m'test-w1-1770423323134-yrzodawe@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 374ms[2m (compile: 17ms, proxy.ts: 47ms, render: 309ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 376ms[2m (compile: 17ms, proxy.ts: 47ms, render: 311ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 386ms[2m (compile: 17ms, proxy.ts: 47ms, render: 321ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 385ms[2m (compile: 130ms, proxy.ts: 123ms, render: 132ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 316ms[2m (compile: 58ms, proxy.ts: 175ms, render: 83ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 146ms[2m (compile: 24ms, proxy.ts: 56ms, render: 67ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w1-1770423323134-yrzodawe@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 188ms[2m (compile: 10ms, proxy.ts: 16ms, render: 162ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 30ms[2m (compile: 1379Âµs, proxy.ts: 5ms, render: 24ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 128ms[2m (compile: 7ms, proxy.ts: 6ms, render: 115ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 47ms[2m (compile: 5ms, proxy.ts: 9ms, render: 34ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 55ms[2m (compile: 1820Âµs, proxy.ts: 9ms, render: 44ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=a92bcca5d8365d2a71b2d84b8ca7f86a9c0c63a5c0530e2e50b4636f2e2fc94e [32m200[39m in 42ms[2m (compile: 1616Âµs, proxy.ts: 5ms, render: 35ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 157ms[2m (compile: 1426Âµs, proxy.ts: 6ms, render: 149ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 46ms[2m (compile: 2ms, proxy.ts: 5ms, render: 38ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 99ms[2m (compile: 4ms, proxy.ts: 16ms, render: 78ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w7-1770423334445-3vif9rzo@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 138ms[2m (compile: 1555Âµs, proxy.ts: 8ms, render: 129ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 35ms[2m (compile: 1385Âµs, proxy.ts: 4ms, render: 30ms)[22m
âœ… Comprehensive cleanup complete
  âœ˜   4 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:177:7 â€º Guest Authentication â€º should show loading state during authentication (13.9s)
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 58ms[2m (compile: 4ms, proxy.ts: 18ms, render: 35ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w8-1770423336220-657ily8c@example.com
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 131ms[2m (compile: 1752Âµs, proxy.ts: 11ms, render: 117ms)[22m
Failed to create test guest: {
  error: {
    code: [32m'23503'[39m,
    details: [32m'Key (group_id)=(5eb9be44-9093-47cc-a208-0efdef48d1fb) is not present in table "groups".'[39m,
    hint: [1mnull[22m,
    message: [32m'insert or update on table "guests" violates foreign key constraint "guests_group_id_fkey"'[39m
  },
  email: [32m'test-w2-1770423338012-s5rl4tbc@example.com'[39m,
  groupId: [32m'5eb9be44-9093-47cc-a208-0efdef48d1fb'[39m,
  workerIndex: [33m2[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   5 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:191:7 â€º Guest Authentication â€º should create session cookie on successful authentication (1.9s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 42ms[2m (compile: 1983Âµs, proxy.ts: 5ms, render: 35ms)[22m
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770423340511-w4tdd3xq@example.com'[39m,
  id: [32m'd24c921f-9287-41a7-b532-4d75f2732fbf'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'90d5aff3-c488-4c86-b782-5f8825cd594b'[39m
}
[Worker 3] âœ… Verified guest exists: {
  email: [32m'test-w3-1770423340511-w4tdd3xq@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[API] Looking for guest with email: test-w9-1770423339891-ya9lvxrf@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w9-1770423339891-ya9lvxrf@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 28ms[2m (compile: 1415Âµs, proxy.ts: 5ms, render: 22ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'ae4548e7'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'913111da-7ca4-420a-b895-18d689f3f92b'[39m,
[2m[WebServer] [22m  sessionId: [32m'6eabeda0-86df-4801-95bf-adf6e7054aa4'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 235ms[2m (compile: 3ms, proxy.ts: 11ms, render: 221ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ae4548e7...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ae4548e7'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 39ms[2m (compile: 1558Âµs, proxy.ts: 5ms, render: 32ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 142ms[2m (compile: 4ms, proxy.ts: 19ms, render: 119ms)[22m
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   6 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:214:7 â€º Guest Authentication â€º should successfully request and verify magic link (13.3s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770423354622-54afpae5@example.com'[39m,
  id: [32m'202af47c-58fa-41a4-9db1-f3b3a65bd07b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'3a585b2c-ef2e-4fdc-ac18-116bbb25874c'[39m
}
[Worker 4] âœ… Verified guest exists: {
  email: [32m'test-w4-1770423354622-54afpae5@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   7 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:261:7 â€º Guest Authentication â€º should show success message after requesting magic link (2.1s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770423357483-w329vfue@example.com'[39m,
  id: [32m'c7d68857-91df-4d2b-a19b-c63c840d2d24'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'a9efbdf4-621b-4a8b-8190-4e6eeab36404'[39m
}
[Worker 5] âœ… Verified guest exists: {
  email: [32m'test-w5-1770423357483-w329vfue@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   8 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:289:7 â€º Guest Authentication â€º should show error for expired magic link (2.2s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  enable debug logging with { debug: true }
[Worker 6] Created test guest: {
  email: [32m'test-w6-1770423360551-av4ohw0n@example.com'[39m,
  id: [32m'30e57a8b-b21c-4229-9fd2-c54895ac2182'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'2d6cad62-dbf7-4219-b8e0-5f98d8aa254d'[39m
}
[Worker 6] âœ… Verified guest exists: {
  email: [32m'test-w6-1770423360551-av4ohw0n@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜   9 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:325:7 â€º Guest Authentication â€º should show error for already used magic link (2.2s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
[Worker 7] Created test guest: {
  email: [32m'test-w7-1770423363464-2pw5xhvo@example.com'[39m,
  id: [32m'b493d0a9-24e4-4307-afcc-f6505a7bfabc'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'05705756-2b20-42f1-a2c1-54b23ad4af09'[39m
}
[Worker 7] âœ… Verified guest exists: {
  email: [32m'test-w7-1770423363464-2pw5xhvo@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜  10 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:367:7 â€º Guest Authentication â€º should show error for invalid or missing token (2.1s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
[Worker 8] Created test guest: {
  email: [32m'test-w8-1770423366346-15p99wpt@example.com'[39m,
  id: [32m'e3039c03-3df9-4df1-a258-cec388ae523e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'6541b507-e8ac-4391-ba13-696af49c91b2'[39m
}
[Worker 8] âœ… Verified guest exists: {
  email: [32m'test-w8-1770423366346-15p99wpt@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜  11 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:396:7 â€º Guest Authentication â€º should complete logout flow (2.2s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
[Worker 9] Created test guest: {
  email: [32m'test-w9-1770423369413-n0w5lu80@example.com'[39m,
  id: [32m'234b6695-b15e-455e-925f-93313e58a00f'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'd4b52122-f9d1-4a1a-a0d5-ebc1631862be'[39m
}
[Worker 9] âœ… Verified guest exists: {
  email: [32m'test-w9-1770423369413-n0w5lu80@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜  12 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:433:7 â€º Guest Authentication â€º should persist authentication across page refreshes (2.3s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
[Worker 10] Created test guest: {
  email: [32m'test-w10-1770423372438-7opm5ctm@example.com'[39m,
  id: [32m'fb9f8a0e-0151-4f6f-a3f8-8763e597df71'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'1713ba47-f6a0-4400-acde-61500551a146'[39m
}
[Worker 10] âœ… Verified guest exists: {
  email: [32m'test-w10-1770423372438-7opm5ctm@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜  13 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:458:7 â€º Guest Authentication â€º should switch between authentication tabs (2.1s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
[Worker 11] Created test guest: {
  email: [32m'test-w11-1770423375362-b35nnl4j@example.com'[39m,
  id: [32m'06f74216-2e51-4f61-8bfb-fe81a77ccca1'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'3999ac01-86ae-4d4a-b5da-90b31e6ed6ed'[39m
}
[Worker 11] âœ… Verified guest exists: {
  email: [32m'test-w11-1770423375362-b35nnl4j@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜  14 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:501:7 â€º Guest Authentication â€º should handle authentication errors gracefully (2.3s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
[Worker 12] Created test guest: {
  email: [32m'test-w12-1770423378406-jqxo227d@example.com'[39m,
  id: [32m'd9c4b7a8-4e86-4fe3-80dc-0f501cc012bb'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'4cd5247f-fa91-463c-b149-925d6396720e'[39m
}
[Worker 12] âœ… Verified guest exists: {
  email: [32m'test-w12-1770423378406-jqxo227d@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
  âœ˜  15 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:545:7 â€º Guest Authentication â€º should log authentication events in audit log (2.1s)

ðŸ§¹ E2E Global Teardown Starting...

ðŸ—‘ï¸  Cleaning up test data...
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ðŸ”“ Removing authentication state...
   No authentication directory found (already clean)
âœ… Authentication state removed

ðŸ“Š Execution Summary:
   Duration: 1.48s
   Errors: 0
   Status: âœ… Clean teardown

âœ¨ E2E Global Teardown Complete!



  1) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:130:7 â€º Guest Authentication â€º should successfully authenticate with email matching 

    TimeoutError: page.waitForURL: Timeout 5000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/guest/dashboard" until "load"
    ============================================================

      142 |
      143 |     // Wait for redirect to dashboard
    > 144 |     await page.waitForURL('/guest/dashboard', { timeout: 5000 });
          |                ^
      145 |     await expect(page).toHaveURL('/guest/dashboard');
      146 |     await expect(page.locator('h1')).toBeVisible();
      147 |   });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:144:16

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/error-context.md

  2) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:177:7 â€º Guest Authentication â€º should show loading state during authentication 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeDisabled[2m([22m[2m)[22m failed

    Locator:  locator('button[type="submit"]:has-text("Log In")')
    Expected: disabled
    Received: enabled
    Timeout:  10000ms

    Call log:
    [2m  - Expect "toBeDisabled" with timeout 10000ms[22m
    [2m  - waiting for locator('button[type="submit"]:has-text("Log In")')[22m
    [2m    11 Ã— locator resolved to <button type="submit" class="w-full bg-emerald-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">Log In</button>[22m
    [2m       - unexpected value "enabled"[22m


      186 |
      187 |     // Verify button is disabled during loading
    > 188 |     await expect(submitButton).toBeDisabled();
          |                                ^
      189 |   });
      190 |
      191 |   test('should create session cookie on successful authentication', async ({ page, context }) => {
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:188:32

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/error-context.md

  3) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:191:7 â€º Guest Authentication â€º should create session cookie on successful authentication 

    Error: Failed to create test guest: insert or update on table "guests" violates foreign key constraint "guests_group_id_fkey"

      81 |         workerIndex: workerId,
      82 |       });
    > 83 |       throw new Error(`Failed to create test guest: ${guestError?.message || 'No data returned'}`);
         |             ^
      84 |     }
      85 |
      86 |     testGuestId = guest.id;
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:83:13

  4) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:214:7 â€º Guest Authentication â€º should successfully request and verify magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      233 |
      234 |     // Wait for success message
    > 235 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      236 |     await expect(page.locator('.text-green-800')).toContainText(/check your email/i);
      237 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      238 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:235:48

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/error-context.md

  5) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:261:7 â€º Guest Authentication â€º should show success message after requesting magic link 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  6) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:289:7 â€º Guest Authentication â€º should show error for expired magic link 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  7) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:325:7 â€º Guest Authentication â€º should show error for already used magic link 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  8) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:367:7 â€º Guest Authentication â€º should show error for invalid or missing token 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  9) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:396:7 â€º Guest Authentication â€º should complete logout flow 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  10) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:433:7 â€º Guest Authentication â€º should persist authentication across page refreshes 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  11) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:458:7 â€º Guest Authentication â€º should switch between authentication tabs 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  12) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:501:7 â€º Guest Authentication â€º should handle authentication errors gracefully 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  13) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:545:7 â€º Guest Authentication â€º should log authentication events in audit log 

    Error: Error reading storage state from .auth/user.json:
    ENOENT: no such file or directory, open '.auth/user.json'

  13 failed
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:130:7 â€º Guest Authentication â€º should successfully authenticate with email matching 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:177:7 â€º Guest Authentication â€º should show loading state during authentication 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:191:7 â€º Guest Authentication â€º should create session cookie on successful authentication 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:214:7 â€º Guest Authentication â€º should successfully request and verify magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:261:7 â€º Guest Authentication â€º should show success message after requesting magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:289:7 â€º Guest Authentication â€º should show error for expired magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:325:7 â€º Guest Authentication â€º should show error for already used magic link 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:367:7 â€º Guest Authentication â€º should show error for invalid or missing token 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:396:7 â€º Guest Authentication â€º should complete logout flow 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:433:7 â€º Guest Authentication â€º should persist authentication across page refreshes 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:458:7 â€º Guest Authentication â€º should switch between authentication tabs 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:501:7 â€º Guest Authentication â€º should handle authentication errors gracefully 
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:545:7 â€º Guest Authentication â€º should log authentication events in audit log 
  2 passed (1.8m)

[36m  Serving HTML report at http://localhost:53416. Press Ctrl+C to quit.[39m
