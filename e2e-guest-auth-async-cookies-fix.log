
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts --workers=1

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168m‚ñ≤ Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.180.84:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Starting...
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22müöÄ Initializing application services...
[2m[WebServer] [22m‚úÖ B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m‚úÖ Application services initialized successfully
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Ready in 2.5s
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling / ...

üöÄ E2E Global Setup Starting...

üìä Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 4.2s[2m (compile: 3.5s, proxy.ts: 571ms, render: 171ms)[22m
‚úÖ Test database connected

üßπ Cleaning up test data...
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üë§ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 2c92ead6-2391-498b-a6f9-4e80cbb96654)
   Created test guest: test@example.com (ID: 6b88537c-4bc2-4a24-b9bb-4217fd4b273f)
‚úÖ Test guest created

üì¶ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
‚úÖ Comprehensive test data created

üåê Verifying Next.js server...
‚úÖ Next.js server is running

üî• Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 53ms[2m (compile: 3ms, proxy.ts: 12ms, render: 38ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'087b833f'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'2c92ead6-2391-498b-a6f9-4e80cbb96654'[39m,
[2m[WebServer] [22m  sessionId: [32m'34c0f1c7-05fc-4acc-ae9e-b5224680911e'[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 2.6s[2m (compile: 2.3s, proxy.ts: 9ms, render: 307ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 404)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 276ms[2m (compile: 142ms, proxy.ts: 9ms, render: 125ms)[22m
   ‚úÖ Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 1180ms[2m (compile: 1041ms, proxy.ts: 12ms, render: 127ms)[22m
   ‚úÖ Guest auth routes warmup complete
‚úÖ API routes warmed up

üîê Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 918ms[2m (compile: 722ms, proxy.ts: 7ms, render: 188ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 1580ms[2m (compile: 1064ms, proxy.ts: 356ms, render: 160ms)[22m
   Current URL after submit: http://localhost:3000/admin
   ‚úÖ Successfully logged in via browser
   ‚úÖ Authentication state saved
‚úÖ Admin authentication saved

‚ú® E2E Global Setup Complete!


Running 15 tests using 1 worker

[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422687188-9oxtgf4z@example.com'[39m,
  id: [32m'7831a988-123b-415a-9e55-7dc826ef4b66'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'fde0269f-dfcc-4694-9f5a-7d4001c7b2b4'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770422687188-9oxtgf4z@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 444ms[2m (compile: 370ms, proxy.ts: 5ms, render: 69ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770422687188-9oxtgf4z@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422687188-9oxtgf4z@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'a31bb237'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'7831a988-123b-415a-9e55-7dc826ef4b66'[39m,
[2m[WebServer] [22m  sessionId: [32m'dc5d5a7d-8351-4217-833a-a424dd99ac35'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 309ms[2m (compile: 46ms, proxy.ts: 11ms, render: 252ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a31bb237...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a31bb237'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'a31bb237'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'7831a988-123b-415a-9e55-7dc826ef4b66'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422687188-9oxtgf4z@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422687188-9oxtgf4z@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1477ms[2m (compile: 969ms, proxy.ts: 122ms, render: 386ms)[22m
üßπ Running comprehensive test cleanup...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a31bb237...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a31bb237...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a31bb237...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a31bb237...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a31bb237'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a31bb237'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a31bb237'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a31bb237'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
‚úÖ Comprehensive cleanup complete
  ‚úì   1 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:130:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching (6.4s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422693716-8avm2p3n@example.com'[39m,
  id: [32m'2fc40305-757d-4b8b-865c-5e6868e078b2'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'48f38dca-efc1-4090-99cc-78bca4f7ae8d'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770422693716-8avm2p3n@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 49ms[2m (compile: 10ms, proxy.ts: 5ms, render: 35ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 167ms[2m (compile: 19ms, proxy.ts: 13ms, render: 135ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úì   2 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:149:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for non-existent email (3.2s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422696942-1m2udxbv@example.com'[39m,
  id: [32m'a79e3f09-b426-4256-950a-e29ecf9a2880'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'363afef7-a3d6-401e-8ce4-4b9242563ac1'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770422696942-1m2udxbv@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 28ms[2m (compile: 2ms, proxy.ts: 6ms, render: 20ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úì   3 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:164:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid email format (2.7s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770422699669-n1a0alui@example.com'[39m,
  id: [32m'1a504dd3-e2e9-4ecf-9ad5-d4a7dcd723af'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'874e0dbf-92c8-4d86-a114-58432c252aea'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770422699669-n1a0alui@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 36ms[2m (compile: 3ms, proxy.ts: 8ms, render: 26ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770422699669-n1a0alui@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422699669-n1a0alui@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'182c616d'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'1a504dd3-e2e9-4ecf-9ad5-d4a7dcd723af'[39m,
[2m[WebServer] [22m  sessionId: [32m'1aabb378-62aa-4099-aed9-7eab33c68181'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 275ms[2m (compile: 5ms, proxy.ts: 6ms, render: 265ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '182c616d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '182c616d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'182c616d'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1a504dd3-e2e9-4ecf-9ad5-d4a7dcd723af'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422699669-n1a0alui@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422699669-n1a0alui@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 504ms[2m (compile: 4ms, proxy.ts: 118ms, render: 383ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '182c616d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '182c616d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '182c616d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '182c616d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '182c616d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '182c616d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '182c616d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '182c616d'
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/rsvps [33m401[39m in 1286ms[2m (compile: 1011ms, proxy.ts: 136ms, render: 139ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/events [33m401[39m in 1347ms[2m (compile: 1006ms, proxy.ts: 141ms, render: 200ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/wedding-info [33m401[39m in 1407ms[2m (compile: 977ms, proxy.ts: 170ms, render: 260ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/announcements [33m401[39m in 1468ms[2m (compile: 1011ms, proxy.ts: 136ms, render: 321ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '182c616d...',
[2m[WebServer] [22m  allCookies: [
[2m[WebServer] [22m  'sb-olcqaawrpnanioaorfer-auth-token',
[2m[WebServer] [22m  'guest_session',
[2m[WebServer] [22m  '__next_hmr_refresh_hash__'
[2m[WebServer] [22m]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '182c616d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'182c616d'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1a504dd3-e2e9-4ecf-9ad5-d4a7dcd723af'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770422699669-n1a0alui@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770422699669-n1a0alui@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 187ms[2m (compile: 32ms, proxy.ts: 125ms, render: 30ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úò   4 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:177:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication (12.9s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770422713334-rdrrt3qp@example.com'[39m,
  id: [32m'602dd6a2-df3b-439d-9346-e5c76703a7b7'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'd1191181-4c36-4c1a-8ea5-fce0c8fed776'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770422713334-rdrrt3qp@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 77ms[2m (compile: 8ms, proxy.ts: 7ms, render: 62ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w1-1770422713334-rdrrt3qp@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770422713334-rdrrt3qp@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'e2db33b5'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'602dd6a2-df3b-439d-9346-e5c76703a7b7'[39m,
[2m[WebServer] [22m  sessionId: [32m'5bc3e3ef-f73b-43eb-8ff3-b2f7596c400c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 348ms[2m (compile: 5ms, proxy.ts: 10ms, render: 333ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2db33b5...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2db33b5'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e2db33b5'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'602dd6a2-df3b-439d-9346-e5c76703a7b7'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770422713334-rdrrt3qp@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w1-1770422713334-rdrrt3qp@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 452ms[2m (compile: 4ms, proxy.ts: 118ms, render: 330ms)[22m
üßπ Running comprehensive test cleanup...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2db33b5...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2db33b5...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2db33b5...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e2db33b5...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2db33b5'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2db33b5'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2db33b5'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e2db33b5'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
‚úÖ Comprehensive cleanup complete
  ‚úì   5 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:191:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication (4.5s)
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770422718064-99hrsik3@example.com'[39m,
  id: [32m'018e36af-933a-4060-8daa-f35259266252'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'33304783-15ea-4d4b-af6d-99c25fdffbbd'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770422718064-99hrsik3@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 36ms[2m (compile: 1658¬µs, proxy.ts: 5ms, render: 30ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 133ms[2m (compile: 5ms, proxy.ts: 11ms, render: 117ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úò   6 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:214:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link (13.2s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770422731911-kll973iu@example.com'[39m,
  id: [32m'009c4453-67ae-47d4-9053-db1a8aa6328e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e7a4511f-c106-49c5-b486-4dc88c7580a5'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770422731911-kll973iu@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 36ms[2m (compile: 1770¬µs, proxy.ts: 6ms, render: 29ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 147ms[2m (compile: 1654¬µs, proxy.ts: 5ms, render: 140ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úò   7 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:261:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link (13.8s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770422747964-phjh2gut@example.com'[39m,
  id: [32m'191b251d-b5d7-4d33-9292-718af0781fa8'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'322cbe97-42ed-4be2-b6fc-df015b3365ee'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770422747964-phjh2gut@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=38e43c03918a17931572e215a3acdf222f699c1c38158b3c56c9eb251ad03434 [32m200[39m in 856ms[2m (compile: 768ms, proxy.ts: 19ms, render: 70ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=38e43c03918a17931572e215a3acdf222f699c1c38158b3c56c9eb251ad03434 [32m200[39m in 35ms[2m (compile: 18ms, proxy.ts: 4ms, render: 13ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [32m200[39m in 471ms[2m (compile: 391ms, proxy.ts: 7ms, render: 73ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 153ms[2m (compile: 8ms, proxy.ts: 5ms, render: 140ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 43ms[2m (compile: 1439¬µs, proxy.ts: 5ms, render: 36ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úò   8 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:289:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link (14.3s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770422764003-f5v10asi@example.com'[39m,
  id: [32m'2ef959f3-7416-4836-a136-d09dd6fc3b7b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'cb132efc-310f-4a45-a736-f3dff0ca5f08'[39m
}
[Worker 4] ‚úÖ Verified guest exists: {
  email: [32m'test-w4-1770422764003-f5v10asi@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 58ms[2m (compile: 13ms, proxy.ts: 8ms, render: 37ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 166ms[2m (compile: 8ms, proxy.ts: 6ms, render: 152ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úò   9 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:325:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link (13.4s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770422778170-pwr5yte7@example.com'[39m,
  id: [32m'65563578-132e-4d0b-b828-601ef7316c48'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'36e16b23-ba0e-48b4-9f52-0ee99bd716e9'[39m
}
[Worker 5] ‚úÖ Verified guest exists: {
  email: [32m'test-w5-1770422778170-pwr5yte7@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 57ms[2m (compile: 3ms, proxy.ts: 24ms, render: 30ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 39ms[2m (compile: 4ms, proxy.ts: 6ms, render: 29ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=e582aad79db7ff918ba50f799361ef715dd727c423c132a29259ee2c8ef0afd0 [32m200[39m in 40ms[2m (compile: 1566¬µs, proxy.ts: 5ms, render: 33ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 161ms[2m (compile: 2ms, proxy.ts: 6ms, render: 153ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 45ms[2m (compile: 3ms, proxy.ts: 5ms, render: 37ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úì  10 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:367:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token (5.3s)
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770422783670-g45k6xb4@example.com'[39m,
  id: [32m'09ad67de-2eba-4d75-a29c-bfa584dfc4ba'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'1ab75ae1-9927-4d59-8432-785ba6630470'[39m
}
[Worker 5] ‚úÖ Verified guest exists: {
  email: [32m'test-w5-1770422783670-g45k6xb4@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 31ms[2m (compile: 1661¬µs, proxy.ts: 5ms, render: 24ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w5-1770422783670-g45k6xb4@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422783670-g45k6xb4@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'84185a74'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'09ad67de-2eba-4d75-a29c-bfa584dfc4ba'[39m,
[2m[WebServer] [22m  sessionId: [32m'18e256ee-2639-4600-85ae-35785773dd5f'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 261ms[2m (compile: 6ms, proxy.ts: 6ms, render: 248ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '84185a74...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '84185a74'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'84185a74'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'09ad67de-2eba-4d75-a29c-bfa584dfc4ba'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422783670-g45k6xb4@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770422783670-g45k6xb4@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 461ms[2m (compile: 11ms, proxy.ts: 105ms, render: 345ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '84185a74...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '84185a74...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '84185a74...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '84185a74...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '84185a74'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '84185a74'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '84185a74'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '84185a74'
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/events [33m401[39m in 1097ms[2m (compile: 865ms, proxy.ts: 116ms, render: 117ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/wedding-info [33m401[39m in 1156ms[2m (compile: 854ms, proxy.ts: 127ms, render: 175ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/rsvps [33m401[39m in 1219ms[2m (compile: 850ms, proxy.ts: 130ms, render: 239ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/announcements [33m401[39m in 1285ms[2m (compile: 828ms, proxy.ts: 153ms, render: 305ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '84185a74...',
[2m[WebServer] [22m  allCookies: [
[2m[WebServer] [22m  'sb-olcqaawrpnanioaorfer-auth-token',
[2m[WebServer] [22m  'guest_session',
[2m[WebServer] [22m  '__next_hmr_refresh_hash__'
[2m[WebServer] [22m]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '84185a74'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'84185a74'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'09ad67de-2eba-4d75-a29c-bfa584dfc4ba'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422783670-g45k6xb4@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770422783670-g45k6xb4@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 170ms[2m (compile: 19ms, proxy.ts: 115ms, render: 35ms)[22m
[2m[WebServer] [22m POST /api/auth/guest/logout [32m200[39m in 1608ms[2m (compile: 942ms, proxy.ts: 4ms, render: 661ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 67ms[2m (compile: 10ms, proxy.ts: 6ms, render: 51ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: false,
[2m[WebServer] [22m  cookieValue: 'none',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No guest session cookie found - redirecting to login
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 30ms[2m (compile: 1781¬µs, proxy.ts: 6ms, render: 22ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úì  11 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:396:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow (8.1s)
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770422791761-lc194pt5@example.com'[39m,
  id: [32m'ea8f72a8-a2a2-42cd-bdd8-67bd6abfddde'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'07b46782-4879-4f9e-a870-6b99eff60ac1'[39m
}
[Worker 5] ‚úÖ Verified guest exists: {
  email: [32m'test-w5-1770422791761-lc194pt5@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 30ms[2m (compile: 1515¬µs, proxy.ts: 9ms, render: 20ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w5-1770422791761-lc194pt5@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422791761-lc194pt5@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'50745f60'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'ea8f72a8-a2a2-42cd-bdd8-67bd6abfddde'[39m,
[2m[WebServer] [22m  sessionId: [32m'd64b1188-904a-4789-b5e2-63d0a4efe22b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 281ms[2m (compile: 4ms, proxy.ts: 6ms, render: 271ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'50745f60'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'ea8f72a8-a2a2-42cd-bdd8-67bd6abfddde'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770422791761-lc194pt5@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770422791761-lc194pt5@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 467ms[2m (compile: 2ms, proxy.ts: 124ms, render: 341ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/wedding-info [33m401[39m in 1228ms[2m (compile: 931ms, proxy.ts: 155ms, render: 142ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/rsvps [33m401[39m in 1285ms[2m (compile: 963ms, proxy.ts: 123ms, render: 198ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/announcements [33m401[39m in 1334ms[2m (compile: 931ms, proxy.ts: 156ms, render: 247ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/events [33m401[39m in 1391ms[2m (compile: 971ms, proxy.ts: 118ms, render: 303ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 1721ms[2m (compile: 988ms, proxy.ts: 129ms, render: 604ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/events [33m401[39m in 206ms[2m (compile: 1584¬µs, proxy.ts: 128ms, render: 76ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 500ms[2m (compile: 6ms, proxy.ts: 123ms, render: 371ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '50745f60...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '50745f60'
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/events [33m401[39m in 182ms[2m (compile: 1560¬µs, proxy.ts: 128ms, render: 53ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úò  12 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:433:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes (18.4s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[Worker 6] Created test guest: {
  email: [32m'test-w6-1770422810876-9rs1kebe@example.com'[39m,
  id: [32m'708dba03-cd80-4a45-ae69-e1161a58303e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'f889a9e9-46f6-44a3-8b66-d666a1c5728f'[39m
}
[Worker 6] ‚úÖ Verified guest exists: {
  email: [32m'test-w6-1770422810876-9rs1kebe@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 45ms[2m (compile: 8ms, proxy.ts: 8ms, render: 28ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úì  13 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:458:7 ‚Ä∫ Guest Authentication ‚Ä∫ should switch between authentication tabs (2.9s)
[Worker 6] Created test guest: {
  email: [32m'test-w6-1770422814050-9a3juuu8@example.com'[39m,
  id: [32m'cb3e92b8-f79b-470a-8b72-c90cb191e0ff'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'5e01da14-61c6-4193-b740-1ddd8b6c2487'[39m
}
[Worker 6] ‚úÖ Verified guest exists: {
  email: [32m'test-w6-1770422814050-9a3juuu8@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 34ms[2m (compile: 1622¬µs, proxy.ts: 6ms, render: 26ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 167ms[2m (compile: 5ms, proxy.ts: 6ms, render: 155ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=7ba6dbaa5f71ce8b5ae7d78da53cfe713146ca7848866f05988564b8e90a53ff [32m200[39m in 47ms[2m (compile: 9ms, proxy.ts: 4ms, render: 33ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 146ms[2m (compile: 6ms, proxy.ts: 6ms, render: 134ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 210ms[2m (compile: 91ms, proxy.ts: 59ms, render: 61ms)[22m
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
  ‚úò  14 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:501:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully (13.9s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[Worker 7] Created test guest: {
  email: [32m'test-w7-1770422828657-esms0zt4@example.com'[39m,
  id: [32m'85527874-2db1-4360-afe2-e6863ba8e296'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'039f9343-ee0d-478d-90c5-eb581dd1145f'[39m
}
[Worker 7] ‚úÖ Verified guest exists: {
  email: [32m'test-w7-1770422828657-esms0zt4@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 42ms[2m (compile: 3ms, proxy.ts: 5ms, render: 34ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w7-1770422828657-esms0zt4@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w7-1770422828657-esms0zt4@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'1049232d'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'85527874-2db1-4360-afe2-e6863ba8e296'[39m,
[2m[WebServer] [22m  sessionId: [32m'47eb8935-7c5e-4592-b246-bcec00e6fa18'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 278ms[2m (compile: 2ms, proxy.ts: 6ms, render: 270ms)[22m
[2m[WebServer] [22mFailed to log audit event: {
[2m[WebServer] [22m  code: [32m'PGRST204'[39m,
[2m[WebServer] [22m  details: [1mnull[22m,
[2m[WebServer] [22m  hint: [1mnull[22m,
[2m[WebServer] [22m  message: [32m"Could not find the 'details' column of 'audit_logs' in the schema cache"[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '1049232d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '1049232d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'1049232d'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'85527874-2db1-4360-afe2-e6863ba8e296'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w7-1770422828657-esms0zt4@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w7-1770422828657-esms0zt4@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 437ms[2m (compile: 11ms, proxy.ts: 119ms, render: 308ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '1049232d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '1049232d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '1049232d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '1049232d...',
[2m[WebServer] [22m  allCookies: [ 'sb-olcqaawrpnanioaorfer-auth-token', 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '1049232d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '1049232d'
[2m[WebServer] [22m}
üßπ Running comprehensive test cleanup...
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/rsvps/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. Auth check[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/rsvps [33m401[39m in 310ms[2m (compile: 13ms, proxy.ts: 116ms, render: 180ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '1049232d'
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/wedding-info/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/wedding-info [33m401[39m in 370ms[2m (compile: 188ms, proxy.ts: 122ms, render: 60ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '1049232d'
[2m[WebServer] [22m}
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/events/route.ts:22:46)
[2m[WebServer] [22m[0m [90m 20 |[39m     [90m// 1. AUTHENTICATION[39m
[2m[WebServer] [22m [90m 21 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 22 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 23 |[39m     [36mconst[39m { data[33m:[39m { session }[33m,[39m error[33m:[39m authError } [33m=[39m [36mawait[39m supabase[33m.[39mauth[33m.[39mgetSession()[33m;[39m
[2m[WebServer] [22m [90m 24 |[39m     
[2m[WebServer] [22m [90m 25 |[39m     [36mif[39m (authError [33m||[39m [33m![39msession) {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/events [33m401[39m in 436ms[2m (compile: 59ms, proxy.ts: 315ms, render: 62ms)[22m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at GET (app/api/guest/announcements/route.ts:15:46)
[2m[WebServer] [22m[0m [90m 13 |[39m   [36mtry[39m {
[2m[WebServer] [22m [90m 14 |[39m     [36mconst[39m cookieStore [33m=[39m [36mawait[39m cookies()[33m;[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 15 |[39m     [36mconst[39m supabase [33m=[39m createRouteHandlerClient({ cookies[33m:[39m () [33m=>[39m cookieStore })[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                              [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 16 |[39m
[2m[WebServer] [22m [90m 17 |[39m     [90m// Check authentication[39m
[2m[WebServer] [22m [90m 18 |[39m     [36mconst[39m {[0m
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22mFailed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m GET /api/guest/announcements [33m401[39m in 492ms[2m (compile: 4ms, proxy.ts: 372ms, render: 116ms)[22m
‚úÖ Comprehensive cleanup complete
  ‚úò  15 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:545:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log (4.4s)

üßπ E2E Global Teardown Starting...

üóëÔ∏è  Cleaning up test data...
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üîì Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
‚úÖ Authentication state removed

üìä Execution Summary:
   Duration: 1.48s
   Errors: 0
   Status: ‚úÖ Clean teardown

‚ú® E2E Global Teardown Complete!



  1) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:177:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeDisabled[2m([22m[2m)[22m failed

    Locator: locator('button[type="submit"]:has-text("Log In")')
    Expected: disabled
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeDisabled" with timeout 10000ms[22m
    [2m  - waiting for locator('button[type="submit"]:has-text("Log In")')[22m
    [2m    - waiting for" http://localhost:3000/guest/dashboard" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/guest/dashboard"[22m


      186 |
      187 |     // Verify button is disabled during loading
    > 188 |     await expect(submitButton).toBeDisabled();
          |                                ^
      189 |   });
      190 |
      191 |   test('should create session cookie on successful authentication', async ({ page, context }) => {
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:188:32

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-79b6f-state-during-authentication-chromium/error-context.md

  2) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:214:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      233 |
      234 |     // Wait for success message
    > 235 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      236 |     await expect(page.locator('.text-green-800')).toContainText(/check your email/i);
      237 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      238 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:235:48

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/error-context.md

  3) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:261:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      278 |
      279 |     // Verify success message
    > 280 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      281 |     await expect(page.locator('.text-green-800')).toContainText('Check your email for a login link');
      282 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      283 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:280:48

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/error-context.md

  4) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:289:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('h1')
    Expected substring: [32m"Link Expired"[39m
    Received string:    [31m"Invalid Link"[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m
    [2m    2 √ó locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m      - unexpected value "Verifying Your Link"[22m
    [2m    - waiting for" http://localhost:3000/api/guest-auth/magic-link/verify" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/auth/guest-login/verify?token=38e43c03918a17931572e215a3acdf222f699c1c38158b3c56c9eb251ad03434"[22m
    [2m    - waiting for" http://localhost:3000/api/guest-auth/magic-link/verify" navigation to finish...[22m
    [2m    - locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m    - unexpected value "Verifying Your Link"[22m
    [2m    9 √ó locator resolved to <h1 class="text-2xl font-bold text-red-800 mb-2">Invalid Link</h1>[22m
    [2m      - unexpected value "Invalid Link"[22m


      312 |
      313 |     // Verify error message with more specific selectors
    > 314 |     await expect(page.locator('h1')).toContainText('Link Expired');
          |                                      ^
      315 |     const errorDescription = page.locator('p.text-gray-600').first();
      316 |     await expect(errorDescription).toContainText('This magic link has expired');
      317 |     const securityNote = page.locator('p.text-sm.text-gray-500');
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:314:38

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-fc3b3-rror-for-expired-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-fc3b3-rror-for-expired-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-fc3b3-rror-for-expired-magic-link-chromium/error-context.md

  5) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:325:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      337 |     await page.fill('#magic-link-input', testGuestEmail);
      338 |     await page.click('button[type="submit"]:has-text("Send Magic Link")');
    > 339 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      340 |
      341 |     // Get token from database
      342 |     const { data: tokens } = await supabase
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:339:48

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/error-context.md

  6) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:433:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('h1')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m


      448 |     // Step 4: Verify still authenticated
      449 |     await expect(page).toHaveURL('/guest/events');
    > 450 |     await expect(page.locator('h1')).toBeVisible();
          |                                      ^
      451 |
      452 |     // Step 5: Navigate to another page
      453 |     await page.goto('/guest/activities');
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:450:38

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/error-context.md

  7) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:501:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('h1')
    Expected substring: [32m"Link Expired"[39m
    Received string:    [31m"Invalid Link"[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m
    [2m    2 √ó locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m      - unexpected value "Verifying Your Link"[22m
    [2m    - waiting for" http://localhost:3000/api/guest-auth/magic-link/verify" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link"[22m
    [2m    2 √ó locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m      - unexpected value "Verifying Your Link"[22m
    [2m    9 √ó locator resolved to <h1 class="text-2xl font-bold text-red-800 mb-2">Invalid Link</h1>[22m
    [2m      - unexpected value "Invalid Link"[22m


      538 |
      539 |     await page.goto(`/auth/guest-login/verify?token=${token}`);
    > 540 |     await expect(page.locator('h1')).toContainText('Link Expired');
          |                                      ^
      541 |     const expiredDescription = page.locator('p.text-gray-600').first();
      542 |     await expect(expiredDescription).toContainText('This magic link has expired');
      543 |   });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:540:38

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/error-context.md

  8) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:545:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoHaveLength[2m([22m[32mexpected[39m[2m)[22m

    Expected length: [32m1[39m
    Received length: [31m0[39m
    Received array:  [31m[][39m

      561 |
      562 |     expect(loginError).toBeNull();
    > 563 |     expect(loginLogs).toHaveLength(1);
          |                       ^
      564 |     expect(loginLogs![0].details.auth_method).toBe('email_matching');
      565 |     expect(loginLogs![0].details.email).toBe(testGuestEmail);
      566 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:563:23

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/error-context.md

  8 failed
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:177:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:214:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:261:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:289:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:325:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:433:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:501:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:545:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 
  7 passed (2.8m)

[36m  Serving HTML report at http://localhost:52840. Press Ctrl+C to quit.[39m
