
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168m‚ñ≤ Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.7.238:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Starting...
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22müöÄ Initializing application services...
[2m[WebServer] [22m‚úÖ B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m‚úÖ Application services initialized successfully
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Ready in 4s

üöÄ E2E Global Setup Starting...

üìä Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 2.8s[2m (compile: 2.3s, proxy.ts: 171ms, render: 408ms)[22m
‚úÖ Test database connected

üßπ Cleaning up test data...
   Cleaning up leftover test data...
   Test data cleanup complete
‚úÖ Test data cleaned

üë§ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 7bc76ea1-eb1b-499d-96ba-d215477d828b)
   Created test guest: test@example.com (ID: e89fbe1c-9e5b-468a-bbf9-1bf99f8790b9)
‚úÖ Test guest created

üì¶ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
‚úÖ Comprehensive test data created

üåê Verifying Next.js server...
‚úÖ Next.js server is running

üî• Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 41ms[2m (compile: 3ms, proxy.ts: 15ms, render: 23ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'05045898'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'7bc76ea1-eb1b-499d-96ba-d215477d828b'[39m,
[2m[WebServer] [22m  sessionId: [32m'1c3bf60a-5746-4de7-9af7-9c7b24405d14'[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 2.8s[2m (compile: 1563ms, proxy.ts: 6ms, render: 1267ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'7bc76ea1-eb1b-499d-96ba-d215477d828b'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest has wrong auth method: email_matching
   ‚úÖ Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m400[39m in 1306ms[2m (compile: 1072ms, proxy.ts: 18ms, render: 215ms)[22m
   ‚úÖ Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 904ms[2m (compile: 727ms, proxy.ts: 13ms, render: 164ms)[22m
   ‚úÖ Guest auth routes warmup complete
‚úÖ API routes warmed up

üîê Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 771ms[2m (compile: 663ms, proxy.ts: 6ms, render: 102ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 3.3s[2m (compile: 2.7s, proxy.ts: 429ms, render: 151ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 37ms[2m (compile: 7ms, proxy.ts: 8ms, render: 22ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 27ms[2m (compile: 1363¬µs, proxy.ts: 5ms, render: 20ms)[22m
   Current URL after submit: http://localhost:3000/admin
   ‚úÖ Successfully logged in via browser
   ‚úÖ Authentication state saved
‚úÖ Admin authentication saved

‚ú® E2E Global Setup Complete!


Running 15 tests using 4 workers

  -   1 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:240:8 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üì° add observability to secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448175679-r5k100aj@example.com'[39m,
  id: [32m'836460e8-7a4a-4780-9755-7342dc185266'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c0b754ba-192e-439b-9d60-0c6594f9193c'[39m
}
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770448175676-s435hif3@example.com'[39m,
  id: [32m'1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'049a4275-1307-46c4-af83-d31029cfae5e'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770448175687-d60q5tws@example.com'[39m,
  id: [32m'0762db34-2727-4000-a436-c77cfb86b886'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'77da881d-9437-44b3-86b5-edb04b028812'[39m
}
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770448175686-9fqow2w5@example.com'[39m,
  id: [32m'5d19f1f3-4e77-47fe-b29e-5d7be0c4603f'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c2500747-317f-4826-b2dc-7b1491c6036e'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770448175676-s435hif3@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448175679-r5k100aj@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770448175687-d60q5tws@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770448175686-9fqow2w5@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET / [32m200[39m in 664ms[2m (compile: 398ms, proxy.ts: 101ms, render: 165ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1153ms[2m (compile: 943ms, proxy.ts: 10ms, render: 200ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1156ms[2m (compile: 943ms, proxy.ts: 10ms, render: 203ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1157ms[2m (compile: 943ms, proxy.ts: 10ms, render: 204ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1158ms[2m (compile: 943ms, proxy.ts: 10ms, render: 205ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] [HMR] connected
[Test] About to click submit button
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770448175686-9fqow2w5@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770448175676-s435hif3@example.com
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'f21963d3'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'7bc76ea1-eb1b-499d-96ba-d215477d828b'[39m,
[2m[WebServer] [22m  sessionId: [32m'd86e4e16-b07a-4cfe-b902-f12da8de617d'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1313ms[2m (compile: 105ms, proxy.ts: 70ms, render: 1138ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 314ms[2m (compile: 7ms, proxy.ts: 76ms, render: 231ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448175686-9fqow2w5@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448175676-s435hif3@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'6eed9203'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'5d19f1f3-4e77-47fe-b29e-5d7be0c4603f'[39m,
[2m[WebServer] [22m  sessionId: [32m'377842d6-4553-498f-837d-8e0ae341c812'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 480ms[2m (compile: 15ms, proxy.ts: 68ms, render: 398ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'37ed9abb'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c'[39m,
[2m[WebServer] [22m  sessionId: [32m'd3b8f6bc-4914-4744-bb67-9e86588ff4cf'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 438ms[2m (compile: 5ms, proxy.ts: 67ms, render: 366ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'7bc76ea1-eb1b-499d-96ba-d215477d828b'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest has wrong auth method: email_matching
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m400[39m in 164ms[2m (compile: 10ms, proxy.ts: 7ms, render: 147ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 159ms[2m (compile: 8ms, proxy.ts: 5ms, render: 146ms)[22m
[Browser warning] Cookie not set yet, waiting additional time...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/login [32m200[39m in 120ms[2m (compile: 7ms, proxy.ts: 15ms, render: 98ms)[22m
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'6eed9203'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'37ed9abb'[39m }
[Browser log] [Fast Refresh] done in 2328ms
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'5d19f1f3-4e77-47fe-b29e-5d7be0c4603f'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448175686-9fqow2w5@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448175686-9fqow2w5@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448175676-s435hif3@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448175676-s435hif3@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 4.1s[2m (compile: 2.2s, proxy.ts: 211ms, render: 1622ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 4.1s[2m (compile: 2.2s, proxy.ts: 231ms, render: 1638ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 329ms[2m (compile: 54ms, proxy.ts: 48ms, render: 227ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 330ms[2m (compile: 54ms, proxy.ts: 48ms, render: 228ms)[22m
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 37ed9abb}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: 1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448175676-s435hif3@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448175676-s435hif3@example.com
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úì   4 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:227:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid email format (10.0s)
[2m[WebServer] [22m GET /admin [32m200[39m in 696ms[2m (compile: 105ms, proxy.ts: 440ms, render: 151ms)[22m
  ‚úì   2 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:212:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for non-existent email (9.9s)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448185863-vvd8d4bi@example.com'[39m,
  id: [32m'73e04a8d-034c-4aa4-a27f-a50f2650b514'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e7d390fa-cc75-4dee-b4e9-1ce17cea11f3'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770448185847-ax17tm33@example.com'[39m,
  id: [32m'f256e1b9-9e22-4b27-bf39-b248e98cc289'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e1f99911-3418-4228-8a77-6eebe8224b20'[39m
}
[Browser log] [Fast Refresh] rebuilding
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770448185847-ax17tm33@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448185863-vvd8d4bi@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Browser log] [Fast Refresh] done in 551ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 302ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 248ms
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 896ms[2m (compile: 522ms, proxy.ts: 121ms, render: 253ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 900ms[2m (compile: 522ms, proxy.ts: 121ms, render: 256ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'37ed9abb'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448175676-s435hif3@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448175676-s435hif3@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.7s[2m (compile: 1812ms, proxy.ts: 311ms, render: 585ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 2.7s[2m (compile: 1807ms, proxy.ts: 316ms, render: 596ms)[22m
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 37ed9abb}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: 1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448175676-s435hif3@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448175676-s435hif3@example.com
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'6eed9203'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'5d19f1f3-4e77-47fe-b29e-5d7be0c4603f'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448175686-9fqow2w5@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448175686-9fqow2w5@example.com
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 2.8s[2m (compile: 1808ms, proxy.ts: 314ms, render: 692ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 2.8s[2m (compile: 1828ms, proxy.ts: 296ms, render: 699ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 564ms[2m (compile: 39ms, proxy.ts: 344ms, render: 181ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 2.8s[2m (compile: 1808ms, proxy.ts: 315ms, render: 711ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.8s[2m (compile: 1804ms, proxy.ts: 318ms, render: 714ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'6eed9203'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'37ed9abb'[39m }
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.0s[2m (compile: 1808ms, proxy.ts: 314ms, render: 874ms)[22m
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.0s[2m (compile: 1811ms, proxy.ts: 311ms, render: 891ms)[22m
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 841ms[2m (compile: 36ms, proxy.ts: 444ms, render: 361ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'5d19f1f3-4e77-47fe-b29e-5d7be0c4603f'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448175686-9fqow2w5@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448175686-9fqow2w5@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448175676-s435hif3@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448175676-s435hif3@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1406ms[2m (compile: 45ms, proxy.ts: 365ms, render: 996ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1408ms[2m (compile: 53ms, proxy.ts: 356ms, render: 999ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w2-1770448185847-ax17tm33@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w1-1770448185863-vvd8d4bi@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'f256e1b9-9e22-4b27-bf39-b248e98cc289'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
  ‚úì   5 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:266:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication (15.5s)
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'73e04a8d-034c-4aa4-a27f-a50f2650b514'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '6eed9203...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w2-1770448185847-ax17tm33@example.com: http://localhost:3000/auth/guest-login/verify?token=1a75b67d155cfffd5d5e672cbe354c67b8f98dcef15474cea8be879dc53bcca8
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 607ms[2m (compile: 31ms, proxy.ts: 88ms, render: 487ms)[22m
[2m[WebServer] [22mMagic link for test-w1-1770448185863-vvd8d4bi@example.com: http://localhost:3000/auth/guest-login/verify?token=0b1128509f6e3fafeb9e0cd20b2e16cdb7b6a61ac79b5c79af2c8c21aa94e4c1
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 635ms[2m (compile: 55ms, proxy.ts: 161ms, render: 419ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '6eed9203'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770448191338-90tropt0@example.com'[39m,
  id: [32m'6c6a5049-d55c-41b0-8d9a-21b35da306db'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'b330b5fc-3a2e-4fa2-be95-f23f79528946'[39m
}
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 37ed9abb}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: 1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448175676-s435hif3@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448175676-s435hif3@example.com
[Browser log] [HMR] connected
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770448191338-90tropt0@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 1132ms[2m (compile: 39ms, proxy.ts: 171ms, render: 921ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 1206ms[2m (compile: 12ms, proxy.ts: 161ms, render: 1033ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 1210ms[2m (compile: 27ms, proxy.ts: 164ms, render: 1020ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1434ms[2m (compile: 26ms, proxy.ts: 170ms, render: 1238ms)[22m
[Browser log] [Fast Refresh] done in 341ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 202ms
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1310ms[2m (compile: 716ms, proxy.ts: 24ms, render: 570ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1322ms[2m (compile: 708ms, proxy.ts: 24ms, render: 589ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=2e020b661d10e8298444c92e41cc289651835d05a38721c126063703f31d8a35 [32m200[39m in 1857ms[2m (compile: 1226ms, proxy.ts: 47ms, render: 585ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=1a75b67d155cfffd5d5e672cbe354c67b8f98dcef15474cea8be879dc53bcca8 [32m200[39m in 2.2s[2m (compile: 1636ms, proxy.ts: 15ms, render: 587ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1329ms[2m (compile: 709ms, proxy.ts: 24ms, render: 596ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1335ms[2m (compile: 709ms, proxy.ts: 24ms, render: 602ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 870ms[2m (compile: 176ms, proxy.ts: 108ms, render: 586ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'37ed9abb'[39m }
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770448191567-282i5kkl@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770448191389-598596cv@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1407ms[2m (compile: 405ms, proxy.ts: 107ms, render: 894ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448191389-598596cv@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448191567-282i5kkl@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 815ms[2m (compile: 147ms, proxy.ts: 418ms, render: 250ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 1290ms[2m (compile: 417ms, proxy.ts: 306ms, render: 567ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'd53e0df7'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'c9f10b19-b125-4563-8a13-b8abae8ae786'[39m,
[2m[WebServer] [22m  sessionId: [32m'6e22be09-2ca1-4ea3-aed3-7eefd54d4fd4'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1320ms[2m (compile: 417ms, proxy.ts: 305ms, render: 598ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'475b0175'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'85e70644-3571-49c5-a91d-6525d3084f21'[39m,
[2m[WebServer] [22m  sessionId: [32m'a4e32211-33aa-4d5b-9a7c-2bae690af9c8'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1324ms[2m (compile: 417ms, proxy.ts: 305ms, render: 602ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448175676-s435hif3@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448175676-s435hif3@example.com
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 2.1s[2m (compile: 176ms, proxy.ts: 108ms, render: 1776ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ab6f4f64...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.4s[2m (compile: 432ms, proxy.ts: 510ms, render: 1483ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ab6f4f64'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'ab6f4f64'[39m }
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd53e0df7...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '475b0175...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'f256e1b9-9e22-4b27-bf39-b248e98cc289'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '475b0175'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd53e0df7'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448185847-ax17tm33@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770448185847-ax17tm33@example.com
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'475b0175'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'd53e0df7'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'85e70644-3571-49c5-a91d-6525d3084f21'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'c9f10b19-b125-4563-8a13-b8abae8ae786'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448191567-282i5kkl@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448191567-282i5kkl@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448191389-598596cv@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448191389-598596cv@example.com
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 4.1s[2m (compile: 96ms, proxy.ts: 417ms, render: 3.6s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 4.1s[2m (compile: 480ms, proxy.ts: 1308ms, render: 2.3s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 4.1s[2m (compile: 484ms, proxy.ts: 1304ms, render: 2.4s)[22m
  ‚úì   7 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link (17.4s)
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448203334-idyxqwdl@example.com'[39m,
  id: [32m'84189d04-a79b-46e5-bfc6-43a71449fbc2'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'7c473d42-170b-4c87-94b8-af5b3d2e167b'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448203334-idyxqwdl@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 324ms[2m (compile: 25ms, proxy.ts: 112ms, render: 187ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 37ed9abb}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: 1ac9aa78-d2a6-4e8b-a3cd-f4198d837f0c}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448175676-s435hif3@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448175676-s435hif3@example.com
[Browser log] [HMR] connected
  ‚úì   3 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:162:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching (29.5s)
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 656ms[2m (compile: 54ms, proxy.ts: 142ms, render: 460ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '37ed9abb...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '37ed9abb'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770448205455-nkj3ec1v@example.com'[39m,
  id: [32m'2a080b96-d963-47ab-9644-4b55e2054ac6'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'da39fa5a-78f2-4a2a-af6c-630e94dbb972'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770448205455-nkj3ec1v@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ab6f4f64...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd53e0df7...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ab6f4f64...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd53e0df7...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ab6f4f64...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd53e0df7...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ab6f4f64...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd53e0df7...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '475b0175...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '475b0175...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '475b0175...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '475b0175...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ab6f4f64'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd53e0df7'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ab6f4f64'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd53e0df7'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 194ms[2m (compile: 7ms, proxy.ts: 26ms, render: 161ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd53e0df7'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ab6f4f64'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd53e0df7'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ab6f4f64'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '475b0175'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '475b0175'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '475b0175'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '475b0175'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 1064ms[2m (compile: 35ms, proxy.ts: 551ms, render: 479ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 1068ms[2m (compile: 28ms, proxy.ts: 552ms, render: 489ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 156ms[2m (compile: 3ms, proxy.ts: 15ms, render: 139ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 1099ms[2m (compile: 47ms, proxy.ts: 551ms, render: 500ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 832ms[2m (compile: 28ms, proxy.ts: 419ms, render: 385ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 1147ms[2m (compile: 19ms, proxy.ts: 665ms, render: 463ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 1152ms[2m (compile: 30ms, proxy.ts: 668ms, render: 454ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 897ms[2m (compile: 31ms, proxy.ts: 398ms, render: 467ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 935ms[2m (compile: 33ms, proxy.ts: 399ms, render: 504ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 1265ms[2m (compile: 28ms, proxy.ts: 667ms, render: 570ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1283ms[2m (compile: 24ms, proxy.ts: 612ms, render: 647ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1332ms[2m (compile: 20ms, proxy.ts: 667ms, render: 645ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1143ms[2m (compile: 32ms, proxy.ts: 429ms, render: 682ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w2-1770448202953-f3wn5g6o@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w1-1770448203334-idyxqwdl@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'1aee1810-64f1-470b-ad00-2a2a034698e7'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'84189d04-a79b-46e5-bfc6-43a71449fbc2'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w2-1770448202953-f3wn5g6o@example.com: http://localhost:3000/auth/guest-login/verify?token=fecca719af0069729655ae0967523fac719b28c220cabd69833e211155ecd103
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 328ms[2m (compile: 15ms, proxy.ts: 20ms, render: 294ms)[22m
[2m[WebServer] [22mMagic link for test-w1-1770448203334-idyxqwdl@example.com: http://localhost:3000/auth/guest-login/verify?token=892e106c46fc2821ff6fd02c00a280e884c465d2ef8b39e128d50e9379c60c29
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 281ms[2m (compile: 1272¬µs, proxy.ts: 13ms, render: 266ms)[22m
  ‚úì   6 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:292:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link (22.4s)
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 91ms[2m (compile: 1324¬µs, proxy.ts: 9ms, render: 81ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=892e106c46fc2821ff6fd02c00a280e884c465d2ef8b39e128d50e9379c60c29 [32m200[39m in 128ms[2m (compile: 5ms, proxy.ts: 13ms, render: 110ms)[22m
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770448208324-977i77st@example.com'[39m,
  id: [32m'728682b2-6e38-4b80-90b6-a4fe764ce707'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c76790db-2585-4a4c-a0cf-f502089f3ec1'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770448208324-977i77st@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=fecca719af0069729655ae0967523fac719b28c220cabd69833e211155ecd103 [32m200[39m in 129ms[2m (compile: 4ms, proxy.ts: 11ms, render: 114ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w1-1770448205572-543cy0gs@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 131ms[2m (compile: 18ms, proxy.ts: 39ms, render: 74ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'e4a10af7-385f-4f57-a705-bf5517a814d7'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w1-1770448205572-543cy0gs@example.com: http://localhost:3000/auth/guest-login/verify?token=328df047e521bbfbd1729cd57523bf457a2e7cd85d4260c0c3dcd6f085f6e2c5
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 347ms[2m (compile: 8ms, proxy.ts: 40ms, render: 299ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=b69f0fd30200b338d0399ef92e2c7ae6e3764701e1b84cfd999425fdea9ab7cb [32m200[39m in 185ms[2m (compile: 6ms, proxy.ts: 16ms, render: 163ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=e31ffd3bfa3c12f3904053d98f7daf6e7e90882166451f15d0050a063c89798a [32m200[39m in 196ms[2m (compile: 6ms, proxy.ts: 16ms, render: 175ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 930ms[2m (compile: 12ms, proxy.ts: 68ms, render: 850ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w2-1770448208324-977i77st@example.com
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0dbb223d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448208324-977i77st@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0dbb223d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'0dbb223d'[39m }
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'64a8b072'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'728682b2-6e38-4b80-90b6-a4fe764ce707'[39m,
[2m[WebServer] [22m  sessionId: [32m'd966253a-baa9-425a-912f-86f9688bb18c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 451ms[2m (compile: 76ms, proxy.ts: 52ms, render: 323ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'84189d04-a79b-46e5-bfc6-43a71449fbc2'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770448203334-idyxqwdl@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w1-1770448203334-idyxqwdl@example.com
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 1021ms[2m (compile: 14ms, proxy.ts: 36ms, render: 971ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ed122303...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 953ms[2m (compile: 29ms, proxy.ts: 159ms, render: 766ms)[22m
  ‚úì   8 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:410:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link (20.3s)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ed122303'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'ed122303'[39m }
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 291ms[2m (compile: 30ms, proxy.ts: 55ms, render: 206ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 292ms[2m (compile: 30ms, proxy.ts: 55ms, render: 207ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '64a8b072...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'1aee1810-64f1-470b-ad00-2a2a034698e7'[39m
[2m[WebServer] [22m}
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770448211710-x6ndmure@example.com'[39m,
  id: [32m'759c83e2-bf99-4b9a-b4ac-f67875a586e3'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'350784fc-0697-47e4-ab2e-f1d9a72c3fbf'[39m
}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '64a8b072'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448202953-f3wn5g6o@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770448202953-f3wn5g6o@example.com
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770448211710-x6ndmure@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'64a8b072'[39m }
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 773ms[2m (compile: 27ms, proxy.ts: 20ms, render: 726ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 784ms[2m (compile: 27ms, proxy.ts: 20ms, render: 737ms)[22m
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 1193ms[2m (compile: 17ms, proxy.ts: 210ms, render: 966ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'728682b2-6e38-4b80-90b6-a4fe764ce707'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 298ms[2m (compile: 34ms, proxy.ts: 66ms, render: 198ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448208324-977i77st@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770448208324-977i77st@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1307ms[2m (compile: 485ms, proxy.ts: 202ms, render: 620ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0dbb223d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0dbb223d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0dbb223d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0dbb223d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0dbb223d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0dbb223d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0dbb223d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0dbb223d'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=892e106c46fc2821ff6fd02c00a280e884c465d2ef8b39e128d50e9379c60c29 [32m200[39m in 304ms[2m (compile: 33ms, proxy.ts: 56ms, render: 215ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ed122303...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ed122303...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ed122303...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ed122303...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ed122303'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ed122303'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ed122303'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ed122303'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770448211710-x6ndmure@example.com
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '64a8b072...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '64a8b072...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '64a8b072...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '64a8b072...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448211710-x6ndmure@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '64a8b072'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 1017ms[2m (compile: 135ms, proxy.ts: 244ms, render: 639ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '64a8b072'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '64a8b072'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '64a8b072'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'99d19caf'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'759c83e2-bf99-4b9a-b4ac-f67875a586e3'[39m,
[2m[WebServer] [22m  sessionId: [32m'f990b3a5-ad0b-4b3a-8bd7-2e1ffc71448f'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 859ms[2m (compile: 111ms, proxy.ts: 123ms, render: 625ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 1039ms[2m (compile: 82ms, proxy.ts: 240ms, render: 718ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 362ms[2m (compile: 85ms, proxy.ts: 30ms, render: 247ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 1092ms[2m (compile: 131ms, proxy.ts: 228ms, render: 733ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1190ms[2m (compile: 99ms, proxy.ts: 246ms, render: 845ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 904ms[2m (compile: 50ms, proxy.ts: 413ms, render: 441ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 1160ms[2m (compile: 52ms, proxy.ts: 417ms, render: 691ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 1164ms[2m (compile: 100ms, proxy.ts: 354ms, render: 711ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1319ms[2m (compile: 49ms, proxy.ts: 424ms, render: 846ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'99d19caf'[39m }
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 331ms[2m (compile: 1606¬µs, proxy.ts: 15ms, render: 314ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'759c83e2-bf99-4b9a-b4ac-f67875a586e3'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used [32m200[39m in 144ms[2m (compile: 6ms, proxy.ts: 15ms, render: 123ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448211710-x6ndmure@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448211710-x6ndmure@example.com
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 164ms[2m (compile: 14ms, proxy.ts: 23ms, render: 127ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 638ms[2m (compile: 10ms, proxy.ts: 154ms, render: 474ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w0-1770448215480-wd0q8y0g@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'3f31d01a-5356-46ed-a39c-a12c8c9a4180'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w0-1770448215480-wd0q8y0g@example.com: http://localhost:3000/auth/guest-login/verify?token=49fe40088fb4d6fb40b5744d600a181faae97c17930ef1a2d62daa78cfee9851
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 1013ms[2m (compile: 5ms, proxy.ts: 29ms, render: 979ms)[22m
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /guest/events ...
  ‚úì  10 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:506:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token (20.7s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770448226234-qhghup6s@example.com'[39m,
  id: [32m'189b6e6e-9354-4382-8ce6-40b79d530592'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'636fd687-652d-4751-839c-c54d3511f8f3'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770448226234-qhghup6s@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
  ‚úò  11 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow (22.6s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770448232993-u9cv0v1u@example.com'[39m,
  id: [32m'54e1c049-d761-4e10-89fd-247573d83b3a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'696bfd7b-ca55-4dbb-8a52-9c35c93c1cd2'[39m
}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[Worker 4] ‚úÖ Verified guest exists: {
  email: [32m'test-w4-1770448232993-u9cv0v1u@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
  ‚úò   9 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:444:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link (33.2s)
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 8.4s[2m (compile: 7.6s, proxy.ts: 173ms, render: 687ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=49fe40088fb4d6fb40b5744d600a181faae97c17930ef1a2d62daa78cfee9851 [32m200[39m in 11.7s[2m (compile: 10.5s, proxy.ts: 450ms, render: 687ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 16.7s[2m (compile: 16.0s, proxy.ts: 78ms, render: 689ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 8.4s[2m (compile: 7.6s, proxy.ts: 172ms, render: 691ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 2.1s[2m (compile: 1338ms, proxy.ts: 89ms, render: 697ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 5.6s[2m (compile: 4.7s, proxy.ts: 194ms, render: 703ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 5.0s[2m (compile: 2.4s, proxy.ts: 1600ms, render: 978ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 5.3s[2m (compile: 2.4s, proxy.ts: 1617ms, render: 1248ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 5.3s[2m (compile: 2.3s, proxy.ts: 1693ms, render: 1261ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 5.4s[2m (compile: 2.4s, proxy.ts: 1613ms, render: 1365ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 18.8s[2m (compile: 17.0s, proxy.ts: 202ms, render: 1536ms)[22m
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770448227217-beutktka@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w2-1770448218856-2sr556zf@example.com
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770448242816-4lru9mte@example.com'[39m,
  id: [32m'c5ea12f1-faa6-48f5-8871-e7e8a49dbb76'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'b1b0f781-c44b-4b4d-8ef0-b7cf9bf3c87a'[39m
}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448227217-beutktka@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[Worker 5] ‚úÖ Verified guest exists: {
  email: [32m'test-w5-1770448242816-4lru9mte@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448218856-2sr556zf@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'9d135612'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'fc883483-e662-472d-976d-ecf39845bf9f'[39m,
[2m[WebServer] [22m  sessionId: [32m'628abc04-d76a-46b8-9d02-eec6bf335910'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 3.3s[2m (compile: 792ms, proxy.ts: 1341ms, render: 1118ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=82aee439da7b5c21ce657034d8cff00a208f4df3b0c6cff75421b7bdd5e6bcd4 [32m200[39m in 3.4s[2m (compile: 1222ms, proxy.ts: 1209ms, render: 951ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'76959f96'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'6a22afe6-5571-4a7e-b296-0f7a8f98ac7c'[39m,
[2m[WebServer] [22m  sessionId: [32m'342c0b9b-b1b3-4a55-a90f-35729a5f1c0f'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 2.7s[2m (compile: 1307ms, proxy.ts: 728ms, render: 685ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 2.5s[2m (compile: 228ms, proxy.ts: 1866ms, render: 357ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.9s[2m (compile: 752ms, proxy.ts: 1562ms, render: 1583ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 4.3s[2m (compile: 1224ms, proxy.ts: 728ms, render: 2.4s)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9d135612...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '76959f96...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '23cd29d1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/events [32m200[39m in 4.5s[2m (compile: 841ms, proxy.ts: 1580ms, render: 2.0s)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '76959f96'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9d135612'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '23cd29d1'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 436ms[2m (compile: 45ms, proxy.ts: 85ms, render: 305ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'76959f96'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'9d135612'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'23cd29d1'[39m }
[2m[WebServer] [22m GET /auth/guest-login/verify?token=8efb9c84453270be1e404970ed6080509a5967793891ce0c163d1ed62f9f8020 [32m200[39m in 689ms[2m (compile: 96ms, proxy.ts: 73ms, render: 520ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'6a22afe6-5571-4a7e-b296-0f7a8f98ac7c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'3f31d01a-5356-46ed-a39c-a12c8c9a4180'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'fc883483-e662-472d-976d-ecf39845bf9f'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448218856-2sr556zf@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770448218856-2sr556zf@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448215480-wd0q8y0g@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448215480-wd0q8y0g@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448227217-beutktka@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448227217-beutktka@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.2s[2m (compile: 199ms, proxy.ts: 291ms, render: 1683ms)[22m
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 2.2s[2m (compile: 181ms, proxy.ts: 309ms, render: 1717ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.3s[2m (compile: 183ms, proxy.ts: 307ms, render: 1810ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9d135612...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9d135612'
[2m[WebServer] [22m}
  ‚úì  13 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:631:7 ‚Ä∫ Guest Authentication ‚Ä∫ should switch between authentication tabs (23.1s)
[2m[WebServer] [22m GET /guest/events [32m200[39m in 1865ms[2m (compile: 67ms, proxy.ts: 385ms, render: 1412ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 397ms[2m (compile: 44ms, proxy.ts: 143ms, render: 210ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 686ms[2m (compile: 134ms, proxy.ts: 73ms, render: 479ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 630ms[2m (compile: 98ms, proxy.ts: 39ms, render: 494ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1895ms[2m (compile: 450ms, proxy.ts: 308ms, render: 1138ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '23cd29d1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '23cd29d1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '23cd29d1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '23cd29d1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w5-1770448242816-4lru9mte@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '23cd29d1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '23cd29d1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '23cd29d1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '76959f96...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '76959f96...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '76959f96...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '76959f96...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '23cd29d1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770448242816-4lru9mte@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '76959f96'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '76959f96'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '76959f96'
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 1640ms[2m (compile: 134ms, proxy.ts: 496ms, render: 1010ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '76959f96'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'bd4f324f'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'c5ea12f1-faa6-48f5-8871-e7e8a49dbb76'[39m,
[2m[WebServer] [22m  sessionId: [32m'7cc31e27-1ea7-4449-beaf-6070d136923e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1980ms[2m (compile: 81ms, proxy.ts: 496ms, render: 1403ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 2.0s[2m (compile: 165ms, proxy.ts: 747ms, render: 1136ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.0s[2m (compile: 144ms, proxy.ts: 849ms, render: 1058ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 3.2s[2m (compile: 165ms, proxy.ts: 727ms, render: 2.3s)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 3.4s[2m (compile: 68ms, proxy.ts: 1017ms, render: 2.3s)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 4.1s[2m (compile: 620ms, proxy.ts: 967ms, render: 2.5s)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 3.5s[2m (compile: 122ms, proxy.ts: 1062ms, render: 2.4s)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'bd4f324f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 4.1s[2m (compile: 67ms, proxy.ts: 1046ms, render: 3.0s)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 4.1s[2m (compile: 150ms, proxy.ts: 1276ms, render: 2.7s)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'bd4f324f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /guest/activities ...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9d135612...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9d135612...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9d135612'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9d135612'
[2m[WebServer] [22m}
Navigation failed, current URL: http://localhost:3000/auth/guest-login
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'bd4f324f'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'c5ea12f1-faa6-48f5-8871-e7e8a49dbb76'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 4.9s[2m (compile: 3.8s, proxy.ts: 226ms, render: 939ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 8.3s[2m (compile: 6.5s, proxy.ts: 891ms, render: 945ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1648ms[2m (compile: 607ms, proxy.ts: 92ms, render: 949ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770448242816-4lru9mte@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770448242816-4lru9mte@example.com
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 13.2s[2m (compile: 11.2s, proxy.ts: 729ms, render: 1270ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 13.7s[2m (compile: 11.4s, proxy.ts: 583ms, render: 1725ms)[22m
[2m[WebServer] [22m GET /guest/activities [32m200[39m in 19.5s[2m (compile: 16.8s, proxy.ts: 981ms, render: 1737ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9d135612...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '99d19caf...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1041ms[2m (compile: 67ms, proxy.ts: 100ms, render: 875ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '99d19caf'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9d135612'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 387ms[2m (compile: 66ms, proxy.ts: 103ms, render: 219ms)[22m
  ‚úò  14 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:674:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully (40.9s)
  ‚úò  15 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:719:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log (36.3s)
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /api/guest/activities ...
  ‚úò  12 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:603:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes (1.1m)

üßπ E2E Global Teardown Starting...

üóëÔ∏è  Cleaning up test data...
üßπ Running comprehensive test cleanup...
[2m[WebServer] [22m GET /api/guest/activities [32m200[39m in 3.9s[2m (compile: 3.6s, proxy.ts: 230ms, render: 110ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=9148546f1a14c73a4d48cf9b34ee2136341f9d2fb286750b36f4ad9bb5a2cbfb [32m200[39m in 2.9s[2m (compile: 1940ms, proxy.ts: 811ms, render: 136ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9d135612...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9d135612'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 197ms[2m (compile: 45ms, proxy.ts: 23ms, render: 129ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 4.5s[2m (compile: 3.5s, proxy.ts: 304ms, render: 735ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w6-1770448273577-9wuu6diq@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770448273577-9wuu6diq@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fevents [32m200[39m in 213ms[2m (compile: 8ms, proxy.ts: 67ms, render: 138ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '9d135612...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '9d135612'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'f6256c55'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'fd2c9094-21d6-450e-9e70-d788c3cb293a'[39m,
[2m[WebServer] [22m  sessionId: [32m'e18766cc-9da7-47d2-8ce0-8bf000885ddd'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 531ms[2m (compile: 27ms, proxy.ts: 52ms, render: 453ms)[22m
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Factivities [32m200[39m in 208ms[2m (compile: 19ms, proxy.ts: 22ms, render: 167ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 231ms[2m (compile: 16ms, proxy.ts: 57ms, render: 158ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 72ms[2m (compile: 6ms, proxy.ts: 11ms, render: 55ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'f6256c55...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'f6256c55'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üîì Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
‚úÖ Authentication state removed

üìä Execution Summary:
   Duration: 2.24s
   Errors: 0
   Status: ‚úÖ Clean teardown

‚ú® E2E Global Teardown Complete!



  1) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:444:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('h1')
    Expected substring: [32m"Link Already Used"[39m
    Received string:    [31m"Verifying Your Link"[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m
    [2m    - waiting for" http://localhost:3000/auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used"[22m
    [2m    12 √ó locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m       - unexpected value "Verifying Your Link"[22m


      497 |
      498 |     // Verify error message with more specific selectors
    > 499 |     await expect(page.locator('h1')).toContainText('Link Already Used');
          |                                      ^
      500 |     const errorDescription = page.locator('p.text-gray-600').first();
      501 |     await expect(errorDescription).toContainText('This magic link has already been used');
      502 |     const securityNote = page.locator('p.text-sm.text-gray-500');
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:499:38

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/error-context.md

  2) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow 

    TimeoutError: page.waitForURL: Timeout 10000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/auth/guest-login" until "domcontentloaded"
      navigated to "http://localhost:3000/guest/dashboard"
    ============================================================

      573 |     // The logout button triggers a client-side redirect via window.location.href
      574 |     await Promise.all([
    > 575 |       page.waitForURL('/auth/guest-login', { 
          |            ^
      576 |         timeout: 10000,
      577 |         waitUntil: 'domcontentloaded'
      578 |       }),
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:575:12

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/error-context.md

  3) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:603:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes 

    [31mTest timeout of 60000ms exceeded.[39m

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('h1')
    Expected: visible
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m


      626 |     await page.goto('/guest/activities');
      627 |     await expect(page).toHaveURL('/guest/activities');
    > 628 |     await expect(page.locator('h1')).toBeVisible();
          |                                      ^
      629 |   });
      630 |
      631 |   test('should switch between authentication tabs', async ({ page }) => {
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:628:38

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/error-context.md

  4) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:674:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('h1')
    Expected substring: [32m"[7mInvalid[27m Link"[39m
    Received string:    [31m"[7mVerifying Your[27m Link"[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m
    [2m    - waiting for" http://localhost:3000/api/guest-auth/magic-link/verify" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link"[22m
    [2m    12 √ó locator resolved to <h1 class="text-2xl font-bold text-jungle-800 mb-2">Verifying Your Link</h1>[22m
    [2m       - unexpected value "Verifying Your Link"[22m


      712 |     await page.goto(`/auth/guest-login/verify?token=${token}`);
      713 |     // Backend returns "Invalid Link" for expired tokens
    > 714 |     await expect(page.locator('h1')).toContainText('Invalid Link');
          |                                      ^
      715 |     const expiredDescription = page.locator('p.text-gray-600').first();
      716 |     await expect(expiredDescription).toContainText(/expired|invalid/i);
      717 |   });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:714:38

    attachment #1: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-90796-ntication-errors-gracefully-chromium/error-context.md

  5) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:719:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 

    Error: Authentication failed - still on login page

      736 |       // If we're still on login page, authentication failed
      737 |       if (currentUrl.includes('/auth/guest-login')) {
    > 738 |         throw new Error('Authentication failed - still on login page');
          |               ^
      739 |       }
      740 |     }
      741 |     
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:738:15

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/error-context.md

  5 failed
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:444:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:603:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:674:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:719:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 
  1 skipped
  9 passed (2.2m)

[36m  Serving HTML report at http://localhost:49213. Press Ctrl+C to quit.[39m
