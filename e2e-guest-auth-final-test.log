
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts --grep should complete logout flow|should log authentication events

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168m‚ñ≤ Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.7.238:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Starting...
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /instrumentation ...
[2m[WebServer] [22müöÄ Initializing application services...
[2m[WebServer] [22m‚úÖ B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m‚úÖ Application services initialized successfully
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Ready in 6.4s
[2m[WebServer] [22m<w> [webpack.cache.PackFileCacheStrategy] Serializing big strings (133kiB) impacts deserialization performance (consider using Buffer instead and decode when needed)
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling / ...

üöÄ E2E Global Setup Starting...

üìä Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 5.6s[2m (compile: 4.5s, proxy.ts: 171ms, render: 885ms)[22m
‚úÖ Test database connected

üßπ Cleaning up test data...
   Cleaning up leftover test data...
   Test data cleanup complete
‚úÖ Test data cleaned

üë§ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 8e9428ae-5504-4017-b21f-f1f32e62d44e)
   Created test guest: test@example.com (ID: 0bc7069a-6723-4ae7-87c3-f48cfba79f6b)
‚úÖ Test guest created

üì¶ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
‚úÖ Comprehensive test data created

üåê Verifying Next.js server...
‚úÖ Next.js server is running

üî• Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 40ms[2m (compile: 3ms, proxy.ts: 13ms, render: 24ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'338557d4'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'8e9428ae-5504-4017-b21f-f1f32e62d44e'[39m,
[2m[WebServer] [22m  sessionId: [32m'66a4004b-fbd1-47d6-be15-9883db289241'[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1166ms[2m (compile: 579ms, proxy.ts: 14ms, render: 573ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'8e9428ae-5504-4017-b21f-f1f32e62d44e'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest has wrong auth method: email_matching
   ‚úÖ Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m400[39m in 714ms[2m (compile: 521ms, proxy.ts: 8ms, render: 185ms)[22m
   ‚úÖ Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 2.5s[2m (compile: 2.3s, proxy.ts: 20ms, render: 192ms)[22m
   ‚úÖ Guest auth routes warmup complete
‚úÖ API routes warmed up

üîê Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 1115ms[2m (compile: 992ms, proxy.ts: 13ms, render: 109ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 1188ms[2m (compile: 494ms, proxy.ts: 437ms, render: 256ms)[22m
   Current URL after submit: http://localhost:3000/admin
   ‚úÖ Successfully logged in via browser
   ‚úÖ Authentication state saved
‚úÖ Admin authentication saved

‚ú® E2E Global Setup Complete!

[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a

Running 2 tests using 2 workers

[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770449216274-lr8kji0r@example.com'[39m,
  id: [32m'fb475971-6a84-4fa8-a65a-0254117b2354'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'0fd45920-7518-4a25-9ed2-141a680f7917'[39m
}
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770449216274-aprylxax@example.com'[39m,
  id: [32m'14f9b3eb-75c7-4f89-9e15-c2d1c966155a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'25c922f7-a21e-4d0f-9089-628fe9eb63f7'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770449216274-lr8kji0r@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770449216274-aprylxax@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1101ms[2m (compile: 754ms, proxy.ts: 34ms, render: 313ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1110ms[2m (compile: 762ms, proxy.ts: 34ms, render: 314ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w1-1770449216274-lr8kji0r@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770449216274-aprylxax@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770449216274-lr8kji0r@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449216274-aprylxax@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'ff5308f8'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'fb475971-6a84-4fa8-a65a-0254117b2354'[39m,
[2m[WebServer] [22m  sessionId: [32m'2c87e981-cfe0-4abc-9a1a-b5b7740301f2'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 765ms[2m (compile: 203ms, proxy.ts: 18ms, render: 545ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'0f11c749'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'14f9b3eb-75c7-4f89-9e15-c2d1c966155a'[39m,
[2m[WebServer] [22m  sessionId: [32m'4048003d-590f-4d7a-b0f8-50ddb25bb97c'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 445ms[2m (compile: 23ms, proxy.ts: 30ms, render: 392ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ff5308f8...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0f11c749...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0f11c749'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ff5308f8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /guest/dashboard ...
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'ff5308f8'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'0f11c749'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'fb475971-6a84-4fa8-a65a-0254117b2354'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'14f9b3eb-75c7-4f89-9e15-c2d1c966155a'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449216274-aprylxax@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449216274-aprylxax@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770449216274-lr8kji0r@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w1-1770449216274-lr8kji0r@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 6.3s[2m (compile: 4.3s, proxy.ts: 140ms, render: 1864ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 6.3s[2m (compile: 4.3s, proxy.ts: 172ms, render: 1870ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ff5308f8...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0f11c749...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0f11c749...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0f11c749...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0f11c749...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ff5308f8...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ff5308f8...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ff5308f8...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0f11c749'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ff5308f8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0f11c749'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0f11c749'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0f11c749'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ff5308f8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ff5308f8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ff5308f8'
[2m[WebServer] [22m}
Audit log query result: {
  found: [33m0[39m,
  guestId: [32m'fb475971-6a84-4fa8-a65a-0254117b2354'[39m,
  error: [90mundefined[39m
}
‚ö†Ô∏è  No audit logs found - migration 053 may not be applied to E2E database
   This is not a critical failure - audit logging is a nice-to-have feature
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /api/guest/announcements ...
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 9.1s[2m (compile: 5.5s, proxy.ts: 304ms, render: 3.3s)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 9.1s[2m (compile: 5.7s, proxy.ts: 186ms, render: 3.3s)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 9.1s[2m (compile: 5.6s, proxy.ts: 218ms, render: 3.3s)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 9.1s[2m (compile: 5.6s, proxy.ts: 294ms, render: 3.3s)[22m
  ‚úì  2 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:736:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log (21.2s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0f11c749...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ff5308f8...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ff5308f8'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0f11c749'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'0f11c749'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'14f9b3eb-75c7-4f89-9e15-c2d1c966155a'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449216274-aprylxax@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449216274-aprylxax@example.com
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 9.8s[2m (compile: 5.7s, proxy.ts: 181ms, render: 3.9s)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 9.8s[2m (compile: 5.6s, proxy.ts: 213ms, render: 3.9s)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 9.8s[2m (compile: 5.6s, proxy.ts: 215ms, render: 3.9s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1114ms[2m (compile: 52ms, proxy.ts: 829ms, render: 233ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 9.9s[2m (compile: 5.6s, proxy.ts: 214ms, render: 4.1s)[22m
[2m[WebServer] [22m POST /api/guest-auth/logout [32m200[39m in 807ms[2m (compile: 516ms, proxy.ts: 6ms, render: 285ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 105ms[2m (compile: 24ms, proxy.ts: 5ms, render: 76ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: false,
[2m[WebServer] [22m  cookieValue: 'none',
[2m[WebServer] [22m  allCookies: [ '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No guest session cookie found - redirecting to login
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 47ms[2m (compile: 1746¬µs, proxy.ts: 7ms, render: 38ms)[22m
  ‚úì  1 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow (31.4s)

üßπ E2E Global Teardown Starting...

üóëÔ∏è  Cleaning up test data...
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üîì Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
‚úÖ Authentication state removed

üìä Execution Summary:
   Duration: 2.11s
   Errors: 0
   Status: ‚úÖ Clean teardown

‚ú® E2E Global Teardown Complete!


  2 passed (1.1m)

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m
