
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts --reporter=list

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168m‚ñ≤ Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.7.238:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Starting...
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22müöÄ Initializing application services...
[2m[WebServer] [22m‚úÖ B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m‚úÖ Application services initialized successfully
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Ready in 2.4s

üöÄ E2E Global Setup Starting...

üìä Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 2.8s[2m (compile: 2.5s, proxy.ts: 168ms, render: 176ms)[22m
‚úÖ Test database connected

üßπ Cleaning up test data...
   Cleaning up leftover test data...
   Test data cleanup complete
‚úÖ Test data cleaned

üë§ Creating test guest...
   Created warmup guest: warmup@example.com (ID: aeb3f1bb-2c16-4eff-b013-f206494004bc)
   Created test guest: test@example.com (ID: 2dc80166-0229-4b23-92fe-b3ba12505fe2)
‚úÖ Test guest created

üì¶ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
‚úÖ Comprehensive test data created

üåê Verifying Next.js server...
‚úÖ Next.js server is running

üî• Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 43ms[2m (compile: 3ms, proxy.ts: 17ms, render: 23ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'75c0531a'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'aeb3f1bb-2c16-4eff-b013-f206494004bc'[39m,
[2m[WebServer] [22m  sessionId: [32m'2eb9e046-df3b-4fa1-8e77-0e431b31063a'[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1631ms[2m (compile: 1209ms, proxy.ts: 7ms, render: 414ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'aeb3f1bb-2c16-4eff-b013-f206494004bc'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest has wrong auth method: email_matching
   ‚úÖ Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m400[39m in 325ms[2m (compile: 146ms, proxy.ts: 10ms, render: 169ms)[22m
   ‚úÖ Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 889ms[2m (compile: 717ms, proxy.ts: 11ms, render: 161ms)[22m
   ‚úÖ Guest auth routes warmup complete
‚úÖ API routes warmed up

üîê Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 580ms[2m (compile: 468ms, proxy.ts: 7ms, render: 104ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 1101ms[2m (compile: 607ms, proxy.ts: 352ms, render: 142ms)[22m
   Current URL after submit: http://localhost:3000/admin
   ‚úÖ Successfully logged in via browser
   ‚úÖ Authentication state saved
‚úÖ Admin authentication saved

‚ú® E2E Global Setup Complete!


Running 15 tests using 4 workers

  -   1 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:240:8 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üì° add observability to secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449699994-uokgnlba@example.com'[39m,
  id: [32m'9408ce7a-30ed-4688-a6a7-23d63e167872'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'4ddeaa04-9a06-49f1-a536-0319b49f9f85'[39m
}
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770449699991-lasziri1@example.com'[39m,
  id: [32m'acb8d3be-2ef8-48cd-9c23-4f0cb635845e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e5abe1e2-9bfb-496a-9faf-087887873a49'[39m
}
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449699993-qdwbnu9k@example.com'[39m,
  id: [32m'a48096ed-8b64-4c42-b159-31fe7ddbf20b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'02a7ba92-bcf0-4f4a-98ea-fe7e20e675be'[39m
}
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770449699993-fh3nadrj@example.com'[39m,
  id: [32m'64aec221-abdc-4950-b008-de3c2b0d730b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'50624600-50b3-4fdd-81fb-8afdd2da25e0'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449699994-uokgnlba@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770449699991-lasziri1@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449699993-qdwbnu9k@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770449699993-fh3nadrj@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 541ms[2m (compile: 346ms, proxy.ts: 23ms, render: 172ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 550ms[2m (compile: 346ms, proxy.ts: 23ms, render: 181ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 534ms[2m (compile: 331ms, proxy.ts: 21ms, render: 182ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 552ms[2m (compile: 346ms, proxy.ts: 23ms, render: 183ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] [HMR] connected
[Test] About to click submit button
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770449699993-qdwbnu9k@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770449699991-lasziri1@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449699993-qdwbnu9k@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'cf562d4f'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'a48096ed-8b64-4c42-b159-31fe7ddbf20b'[39m,
[2m[WebServer] [22m  sessionId: [32m'2160eb4e-f292-45c5-9d9f-e0633648f046'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 460ms[2m (compile: 113ms, proxy.ts: 22ms, render: 325ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449699991-lasziri1@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 297ms[2m (compile: 1964¬µs, proxy.ts: 33ms, render: 262ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'e6e4ee6d'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'acb8d3be-2ef8-48cd-9c23-4f0cb635845e'[39m,
[2m[WebServer] [22m  sessionId: [32m'9e874c39-4867-4653-8af5-459be61482dc'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 430ms[2m (compile: 2ms, proxy.ts: 33ms, render: 394ms)[22m
[Browser warning] Cookie not set yet, waiting additional time...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e6e4ee6d'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'cf562d4f'[39m }
[Browser log] [Fast Refresh] done in 561ms
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'acb8d3be-2ef8-48cd-9c23-4f0cb635845e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'a48096ed-8b64-4c42-b159-31fe7ddbf20b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449699991-lasziri1@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449699991-lasziri1@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1260ms[2m (compile: 590ms, proxy.ts: 181ms, render: 490ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449699993-qdwbnu9k@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449699993-qdwbnu9k@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1505ms[2m (compile: 741ms, proxy.ts: 175ms, render: 588ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: e6e4ee6d}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: acb8d3be-2ef8-48cd-9c23-4f0cb635845e}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449699991-lasziri1@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449699991-lasziri1@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 219ms[2m (compile: 40ms, proxy.ts: 65ms, render: 115ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 221ms[2m (compile: 40ms, proxy.ts: 65ms, render: 116ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 332ms
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] done in 574ms
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 2.3s[2m (compile: 1380ms, proxy.ts: 220ms, render: 653ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.5s[2m (compile: 1304ms, proxy.ts: 297ms, render: 944ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 2.6s[2m (compile: 1309ms, proxy.ts: 291ms, render: 954ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.6s[2m (compile: 1298ms, proxy.ts: 304ms, render: 966ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 2.6s[2m (compile: 1394ms, proxy.ts: 207ms, render: 975ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 3.4s[2m (compile: 1425ms, proxy.ts: 176ms, render: 1840ms)[22m
  ‚úì   4 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:227:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid email format (9.3s)
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.5s[2m (compile: 1400ms, proxy.ts: 201ms, render: 1938ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.7s[2m (compile: 1403ms, proxy.ts: 199ms, render: 2.1s)[22m
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449709528-281rutzk@example.com'[39m,
  id: [32m'425caebb-5b7f-4c09-ad21-5d302a7b212a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e9ae2eda-f363-4456-a0e7-8f74b97bc90b'[39m
}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'cf562d4f'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'a48096ed-8b64-4c42-b159-31fe7ddbf20b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449699993-qdwbnu9k@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449699993-qdwbnu9k@example.com
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e6e4ee6d'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'acb8d3be-2ef8-48cd-9c23-4f0cb635845e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449699991-lasziri1@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449699991-lasziri1@example.com
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: e6e4ee6d}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: acb8d3be-2ef8-48cd-9c23-4f0cb635845e}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449699991-lasziri1@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449699991-lasziri1@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.3s[2m (compile: 1819ms, proxy.ts: 307ms, render: 174ms)[22m
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449709528-281rutzk@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.3s[2m (compile: 1482ms, proxy.ts: 645ms, render: 187ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
  ‚úì   3 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:212:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for non-existent email (9.9s)
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e6e4ee6d'[39m }
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'cf562d4f'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'acb8d3be-2ef8-48cd-9c23-4f0cb635845e'[39m
[2m[WebServer] [22m}
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770449710118-aor4xm12@example.com'[39m,
  id: [32m'89475051-86b8-4a48-b891-083310f5213a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c5f76429-610e-48ea-9410-5563a570d147'[39m
}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449699991-lasziri1@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449699991-lasziri1@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 916ms[2m (compile: 10ms, proxy.ts: 530ms, render: 376ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'a48096ed-8b64-4c42-b159-31fe7ddbf20b'[39m
[2m[WebServer] [22m}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770449710118-aor4xm12@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770449699993-qdwbnu9k@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770449699993-qdwbnu9k@example.com
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 127ms[2m (compile: 8ms, proxy.ts: 7ms, render: 113ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 1220ms[2m (compile: 5ms, proxy.ts: 616ms, render: 599ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: e6e4ee6d}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: acb8d3be-2ef8-48cd-9c23-4f0cb635845e}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449699991-lasziri1@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449699991-lasziri1@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 98ms[2m (compile: 3ms, proxy.ts: 32ms, render: 63ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cf562d4f...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
  ‚úì   2 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:266:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication (11.4s)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w2-1770449709528-281rutzk@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cf562d4f'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 707ms[2m (compile: 120ms, proxy.ts: 169ms, render: 419ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'425caebb-5b7f-4c09-ad21-5d302a7b212a'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449711694-wqyxwxt4@example.com'[39m,
  id: [32m'3e61cc80-c901-4c8b-a0ce-2bcca74e0b72'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'78eda793-6824-4ef5-9c0e-48ac53dba3b1'[39m
}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 832ms[2m (compile: 41ms, proxy.ts: 281ms, render: 510ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 879ms[2m (compile: 16ms, proxy.ts: 155ms, render: 708ms)[22m
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449711694-wqyxwxt4@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22mMagic link for test-w2-1770449709528-281rutzk@example.com: http://localhost:3000/auth/guest-login/verify?token=24a9d9df0722e58cec1983ba2c546df37e21c02311021586a04ddbd6852f46e0
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 349ms[2m (compile: 26ms, proxy.ts: 38ms, render: 285ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 1051ms[2m (compile: 109ms, proxy.ts: 295ms, render: 647ms)[22m
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[Browser log] [Fast Refresh] done in 536ms
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w1-1770449710118-aor4xm12@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m GET /auth/guest-login/verify?token=e6a24518cec22e0119363e05a5e2c7c77f54df3fd35681cc8ffed90fa35afe72 [32m200[39m in 811ms[2m (compile: 551ms, proxy.ts: 68ms, render: 193ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=24a9d9df0722e58cec1983ba2c546df37e21c02311021586a04ddbd6852f46e0 [32m200[39m in 1078ms[2m (compile: 852ms, proxy.ts: 31ms, render: 194ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'89475051-86b8-4a48-b891-083310f5213a'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w1-1770449710118-aor4xm12@example.com: http://localhost:3000/auth/guest-login/verify?token=834fe4bb9464cd155b4c32019b1d7f0bed768349bbb26bea5bddad239adea614
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 488ms[2m (compile: 63ms, proxy.ts: 137ms, render: 288ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 173ms[2m (compile: 23ms, proxy.ts: 40ms, render: 110ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e6e4ee6d'[39m }
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 261ms[2m (compile: 28ms, proxy.ts: 76ms, render: 157ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'acb8d3be-2ef8-48cd-9c23-4f0cb635845e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 68ms[2m (compile: 4ms, proxy.ts: 5ms, render: 58ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449699991-lasziri1@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449699991-lasziri1@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 567ms[2m (compile: 13ms, proxy.ts: 177ms, render: 376ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 786ms[2m (compile: 28ms, proxy.ts: 76ms, render: 683ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c57128b1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c57128b1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'c57128b1'[39m }
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: e6e4ee6d}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: acb8d3be-2ef8-48cd-9c23-4f0cb635845e}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770449699991-lasziri1@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770449699991-lasziri1@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'425caebb-5b7f-4c09-ad21-5d302a7b212a'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e6e4ee6d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770449709528-281rutzk@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770449709528-281rutzk@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e6e4ee6d'
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 629ms[2m (compile: 15ms, proxy.ts: 171ms, render: 443ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 617ms[2m (compile: 28ms, proxy.ts: 171ms, render: 418ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 630ms[2m (compile: 22ms, proxy.ts: 171ms, render: 437ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 636ms[2m (compile: 32ms, proxy.ts: 148ms, render: 455ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c57128b1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c57128b1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c57128b1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c57128b1...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 753ms[2m (compile: 16ms, proxy.ts: 143ms, render: 594ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c57128b1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c57128b1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c57128b1'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c57128b1'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 579ms[2m (compile: 1208¬µs, proxy.ts: 167ms, render: 410ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 604ms[2m (compile: 1266¬µs, proxy.ts: 152ms, render: 451ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 626ms[2m (compile: 1478¬µs, proxy.ts: 181ms, render: 443ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 744ms[2m (compile: 1298¬µs, proxy.ts: 160ms, render: 583ms)[22m
  ‚úì   5 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:162:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching (18.4s)
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770449718619-f4vu6opp@example.com'[39m,
  id: [32m'b0ac8585-a9f0-4e0b-ab79-fa428d28dff9'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'8a5bd4ee-439e-4299-b130-e30974a77a93'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770449718619-f4vu6opp@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 52ms[2m (compile: 4ms, proxy.ts: 13ms, render: 35ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w0-1770449718619-f4vu6opp@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'b0ac8585-a9f0-4e0b-ab79-fa428d28dff9'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w0-1770449718619-f4vu6opp@example.com: http://localhost:3000/auth/guest-login/verify?token=c24961a02f024f68ff17f543bac98ca31adf2936434f81be38eee6c854380886
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 308ms[2m (compile: 1423¬µs, proxy.ts: 6ms, render: 301ms)[22m
  ‚úì   8 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:410:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link (9.4s)
[2m[WebServer] [22m GET /auth/guest-login/verify?token=c24961a02f024f68ff17f543bac98ca31adf2936434f81be38eee6c854380886 [32m200[39m in 176ms[2m (compile: 4ms, proxy.ts: 12ms, render: 159ms)[22m
  ‚úì   6 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:292:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link (11.6s)
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449721144-lku8abi9@example.com'[39m,
  id: [32m'0e6a675b-1b2e-46a2-a40a-3baafabbf6db'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c2d709cb-f64b-4ccd-b0ae-e61e5de15589'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449721190-0trj9qrt@example.com'[39m,
  id: [32m'0c2f68e9-020b-4098-8a5b-612f8bff6806'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'217e3d52-d981-47b7-b4f0-6a244d0b3c2f'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449721144-lku8abi9@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449721190-0trj9qrt@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 73ms[2m (compile: 4ms, proxy.ts: 16ms, render: 53ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 74ms[2m (compile: 14ms, proxy.ts: 16ms, render: 44ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 761ms[2m (compile: 5ms, proxy.ts: 11ms, render: 746ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c0e06738...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c0e06738'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'c0e06738'[39m }
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 131ms[2m (compile: 2ms, proxy.ts: 87ms, render: 42ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'b0ac8585-a9f0-4e0b-ab79-fa428d28dff9'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w2-1770449721190-0trj9qrt@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770449721190-0trj9qrt@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770449718619-f4vu6opp@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770449718619-f4vu6opp@example.com
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 680ms[2m (compile: 15ms, proxy.ts: 192ms, render: 472ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'02025e01'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'0c2f68e9-020b-4098-8a5b-612f8bff6806'[39m,
[2m[WebServer] [22m  sessionId: [32m'3c092f3b-6ab4-490d-a4bf-d47f59829674'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 289ms[2m (compile: 5ms, proxy.ts: 9ms, render: 275ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=756af1ddcebdd66db2d1a8ade7dbbef38cf0954bc0645e8236fed93cbd9b78b9 [32m200[39m in 74ms[2m (compile: 1881¬µs, proxy.ts: 12ms, render: 61ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c0e06738...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c0e06738...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c0e06738...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'c0e06738...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '02025e01...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=c24961a02f024f68ff17f543bac98ca31adf2936434f81be38eee6c854380886 [32m200[39m in 101ms[2m (compile: 9ms, proxy.ts: 25ms, render: 68ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c0e06738'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c0e06738'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c0e06738'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'c0e06738'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '02025e01'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'02025e01'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'0c2f68e9-020b-4098-8a5b-612f8bff6806'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 154ms[2m (compile: 3ms, proxy.ts: 10ms, render: 142ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 57ms[2m (compile: 1552¬µs, proxy.ts: 6ms, render: 50ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770449721190-0trj9qrt@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770449721190-0trj9qrt@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 663ms[2m (compile: 4ms, proxy.ts: 266ms, render: 394ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 303ms[2m (compile: 2ms, proxy.ts: 24ms, render: 277ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used [32m200[39m in 146ms[2m (compile: 10ms, proxy.ts: 18ms, render: 119ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '02025e01...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '02025e01...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '02025e01...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '02025e01...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '02025e01'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '02025e01'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '02025e01'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '02025e01'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 548ms[2m (compile: 9ms, proxy.ts: 149ms, render: 390ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 558ms[2m (compile: 8ms, proxy.ts: 149ms, render: 401ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 597ms[2m (compile: 7ms, proxy.ts: 154ms, render: 437ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 690ms[2m (compile: 1613¬µs, proxy.ts: 140ms, render: 548ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/logout [32m200[39m in 675ms[2m (compile: 396ms, proxy.ts: 5ms, render: 274ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 75ms[2m (compile: 19ms, proxy.ts: 9ms, render: 47ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: false,
[2m[WebServer] [22m  cookieValue: 'none',
[2m[WebServer] [22m  allCookies: []
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No guest session cookie found - redirecting to login
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 35ms[2m (compile: 2ms, proxy.ts: 7ms, render: 26ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 218ms[2m (compile: 5ms, proxy.ts: 24ms, render: 189ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 223ms[2m (compile: 36ms, proxy.ts: 24ms, render: 163ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used [32m200[39m in 229ms[2m (compile: 36ms, proxy.ts: 24ms, render: 168ms)[22m
  ‚úò   7 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link (18.9s)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770449729781-je4opd29@example.com'[39m,
  id: [32m'bdadcfec-6ca3-41a1-b32c-83c922dcb1a1'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'9b844027-c1f1-42cb-9377-d915019fe07a'[39m
}
[Worker 4] ‚úÖ Verified guest exists: {
  email: [32m'test-w4-1770449729781-je4opd29@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 35ms[2m (compile: 1579¬µs, proxy.ts: 8ms, render: 26ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w4-1770449729781-je4opd29@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770449729781-je4opd29@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
  ‚úì   9 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:444:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link (13.1s)
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'd828b336'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'bdadcfec-6ca3-41a1-b32c-83c922dcb1a1'[39m,
[2m[WebServer] [22m  sessionId: [32m'0fd68dcd-406d-4bfc-ab52-640eb2964938'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 295ms[2m (compile: 9ms, proxy.ts: 6ms, render: 281ms)[22m
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770449731707-o7mj8vs7@example.com'[39m,
  id: [32m'10d0871a-2004-4307-b39b-aa3ea598dfe5'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'd534a23e-62f8-4fda-aa36-58a75ba6e8bb'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770449731707-o7mj8vs7@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
  ‚úì  10 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:506:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token (11.0s)
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 34ms[2m (compile: 9ms, proxy.ts: 4ms, render: 21ms)[22m
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770449732164-ji1gl793@example.com'[39m,
  id: [32m'8febf97d-5507-405e-93a5-b88e08f73c7e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'874b8599-0def-4d6d-9186-15e8434c62dc'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770449732164-ji1gl793@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'd828b336'[39m }
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 114ms[2m (compile: 2ms, proxy.ts: 9ms, render: 102ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'bdadcfec-6ca3-41a1-b32c-83c922dcb1a1'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770449729781-je4opd29@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w4-1770449729781-je4opd29@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 646ms[2m (compile: 24ms, proxy.ts: 171ms, render: 450ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
  ‚úì  11 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow (13.6s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770449734807-a05w4do1@example.com'[39m,
  id: [32m'd90f0682-43ed-4db5-b66e-62ae29d2b1f1'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'67257b5e-3a37-43c4-a7bf-e091b60863f9'[39m
}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 267ms[2m (compile: 10ms, proxy.ts: 20ms, render: 237ms)[22m
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770449734807-a05w4do1@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 362ms[2m (compile: 25ms, proxy.ts: 169ms, render: 169ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 362ms[2m (compile: 5ms, proxy.ts: 255ms, render: 103ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 363ms[2m (compile: 11ms, proxy.ts: 168ms, render: 184ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 363ms[2m (compile: 6ms, proxy.ts: 246ms, render: 111ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 1994ms[2m (compile: 1337ms, proxy.ts: 153ms, render: 504ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 82ms[2m (compile: 17ms, proxy.ts: 13ms, render: 52ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=23d9cb415c43c6868f149c6516235efcdc4090e495054e222a170186ce448368 [32m200[39m in 92ms[2m (compile: 23ms, proxy.ts: 21ms, render: 48ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 194ms[2m (compile: 10ms, proxy.ts: 43ms, render: 141ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 162ms[2m (compile: 9ms, proxy.ts: 16ms, render: 138ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 55ms[2m (compile: 4ms, proxy.ts: 7ms, render: 44ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 613ms[2m (compile: 6ms, proxy.ts: 244ms, render: 363ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 575ms[2m (compile: 4ms, proxy.ts: 232ms, render: 339ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w2-1770449734807-a05w4do1@example.com
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 803ms[2m (compile: 1457¬µs, proxy.ts: 142ms, render: 659ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770449734807-a05w4do1@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'ad586323'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'd90f0682-43ed-4db5-b66e-62ae29d2b1f1'[39m,
[2m[WebServer] [22m  sessionId: [32m'cc9c47ae-b8b2-4664-a045-6f60862ae638'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 299ms[2m (compile: 3ms, proxy.ts: 6ms, render: 289ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
  ‚úì  13 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:642:7 ‚Ä∫ Guest Authentication ‚Ä∫ should switch between authentication tabs (7.1s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'ad586323'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'd90f0682-43ed-4db5-b66e-62ae29d2b1f1'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/activities [32m200[39m in 1693ms[2m (compile: 1114ms, proxy.ts: 144ms, render: 435ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770449734807-a05w4do1@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770449734807-a05w4do1@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 871ms[2m (compile: 21ms, proxy.ts: 496ms, render: 354ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 148ms[2m (compile: 14ms, proxy.ts: 15ms, render: 119ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 791ms[2m (compile: 35ms, proxy.ts: 196ms, render: 560ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 960ms[2m (compile: 22ms, proxy.ts: 194ms, render: 745ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 1983ms[2m (compile: 1167ms, proxy.ts: 282ms, render: 534ms)[22m
[2m[WebServer] [22m GET /api/guest/activities [32m200[39m in 1985ms[2m (compile: 1255ms, proxy.ts: 195ms, render: 535ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 1992ms[2m (compile: 1249ms, proxy.ts: 200ms, render: 542ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'ad586323'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'd90f0682-43ed-4db5-b66e-62ae29d2b1f1'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/activities [32m200[39m in 534ms[2m (compile: 19ms, proxy.ts: 157ms, render: 358ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770449734807-a05w4do1@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770449734807-a05w4do1@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 664ms[2m (compile: 18ms, proxy.ts: 235ms, render: 411ms)[22m
  ‚úì  14 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:685:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully (11.0s)
Audit log query result: {
  found: [33m0[39m,
  guestId: [32m'd90f0682-43ed-4db5-b66e-62ae29d2b1f1'[39m,
  error: [90mundefined[39m
}
‚ö†Ô∏è  No audit logs found - migration 053 may not be applied to E2E database
   This is not a critical failure - audit logging is a nice-to-have feature
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd828b336...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'ad586323...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd828b336'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'ad586323'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/activities [32m200[39m in 545ms[2m (compile: 1372¬µs, proxy.ts: 147ms, render: 397ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 572ms[2m (compile: 1037¬µs, proxy.ts: 151ms, render: 420ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 576ms[2m (compile: 4ms, proxy.ts: 141ms, render: 431ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 578ms[2m (compile: 6ms, proxy.ts: 142ms, render: 430ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 731ms[2m (compile: 4ms, proxy.ts: 158ms, render: 569ms)[22m
  ‚úì  15 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:742:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log (14.5s)
  ‚úì  12 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:595:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes (20.8s)

üßπ E2E Global Teardown Starting...

üóëÔ∏è  Cleaning up test data...
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üîì Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
‚úÖ Authentication state removed

üìä Execution Summary:
   Duration: 2.21s
   Errors: 0
   Status: ‚úÖ Clean teardown

‚ú® E2E Global Teardown Complete!



  1) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m
    [2m    - waiting for" http://localhost:3000/auth/guest-login" navigation to finish...[22m
    [2m    - navigated to "http://localhost:3000/auth/guest-login"[22m


      399 |
      400 |     // Verify success message
    > 401 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      402 |     await expect(page.locator('.text-green-800')).toContainText('Check your email for a login link');
      403 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      404 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:401:48

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/error-context.md

  1 failed
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 
  1 skipped
  13 passed (1.2m)
