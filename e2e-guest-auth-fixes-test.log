
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168m‚ñ≤ Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.7.238:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Starting...
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Ready in 1176ms
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /_not-found ...
[2m[WebServer] [22m GET / [33m404[39m in 4.0s[2m (compile: 3.9s, render: 76ms)[22m
[2m[WebServer] [22m GET /index.html [33m404[39m in 122ms[2m (compile: 9ms, proxy.ts: 97ms, render: 16ms)[22m
[2m[WebServer] [22m<w> [webpack.cache.PackFileCacheStrategy] Serializing big strings (133kiB) impacts deserialization performance (consider using Buffer instead and decode when needed)

üöÄ E2E Global Setup Starting...

üìä Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 843ms[2m (compile: 777ms, proxy.ts: 12ms, render: 54ms)[22m
‚úÖ Test database connected

üßπ Cleaning up test data...
   Cleaning up leftover test data...
   Test data cleanup complete
‚úÖ Test data cleaned

üë§ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 8eba8e59-d250-4a55-8c15-528cae41b4bb)
   Created test guest: test@example.com (ID: f2e2ce9c-12f3-4d88-8392-8b51bc23baef)
‚úÖ Test guest created

üì¶ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
‚úÖ Comprehensive test data created

üåê Verifying Next.js server...
‚úÖ Next.js server is running

üî• Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 27ms[2m (compile: 1919¬µs, proxy.ts: 8ms, render: 17ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'warmup@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'1905286b'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'8eba8e59-d250-4a55-8c15-528cae41b4bb'[39m,
[2m[WebServer] [22m  sessionId: [32m'1c750b08-1668-462c-ba8c-888e4e9f5709'[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 868ms[2m (compile: 427ms, proxy.ts: 9ms, render: 432ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'8eba8e59-d250-4a55-8c15-528cae41b4bb'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest has wrong auth method: email_matching
   ‚úÖ Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m400[39m in 504ms[2m (compile: 157ms, proxy.ts: 7ms, render: 341ms)[22m
   ‚úÖ Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 2.7s[2m (compile: 2.5s, proxy.ts: 5ms, render: 235ms)[22m
   ‚úÖ Guest auth routes warmup complete
‚úÖ API routes warmed up

üîê Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 2.3s[2m (compile: 2.2s, proxy.ts: 10ms, render: 118ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 1186ms[2m (compile: 511ms, proxy.ts: 564ms, render: 111ms)[22m
   Current URL after submit: http://localhost:3000/admin
   ‚úÖ Successfully logged in via browser
   ‚úÖ Authentication state saved
‚úÖ Admin authentication saved

‚ú® E2E Global Setup Complete!


Running 15 tests using 4 workers

  -   1 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:240:8 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üì° add observability to secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448913593-w4uc83b7@example.com'[39m,
  id: [32m'bec81904-54e7-4387-ad1d-691e0eec3ddf'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'f2d8aeb0-fd58-4b01-b649-b1fff852a0ac'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770448913592-okfeezmj@example.com'[39m,
  id: [32m'd2e478b1-fb77-47c5-ba04-f512978474dd'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'46bbecc0-48a5-45d0-8f69-3724b1907230'[39m
}
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770448913593-wk3p05f0@example.com'[39m,
  id: [32m'7a58a78a-4cb3-4f74-bc7d-9b9cb1cb3395'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'89142b64-aaec-4df5-a639-3671d711821c'[39m
}
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770448913593-mrxdty4s@example.com'[39m,
  id: [32m'f7f03306-a9d7-48ff-9e66-42aebc915c50'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'30b26a13-e44b-48e3-a71a-9b9bee9b7ccc'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770448913593-wk3p05f0@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770448913592-okfeezmj@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448913593-w4uc83b7@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770448913593-mrxdty4s@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 619ms[2m (compile: 414ms, proxy.ts: 22ms, render: 183ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 627ms[2m (compile: 414ms, proxy.ts: 22ms, render: 191ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 629ms[2m (compile: 414ms, proxy.ts: 22ms, render: 193ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 620ms[2m (compile: 396ms, proxy.ts: 30ms, render: 193ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] [HMR] connected
[Test] About to click submit button
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770448913593-wk3p05f0@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770448913593-mrxdty4s@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 437ms[2m (compile: 146ms, proxy.ts: 20ms, render: 271ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448913593-wk3p05f0@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448913593-mrxdty4s@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'cb9fbd06'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'7a58a78a-4cb3-4f74-bc7d-9b9cb1cb3395'[39m,
[2m[WebServer] [22m  sessionId: [32m'6cef6150-90a0-470f-b466-f385b068a17b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 589ms[2m (compile: 146ms, proxy.ts: 19ms, render: 424ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'133b799a'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'f7f03306-a9d7-48ff-9e66-42aebc915c50'[39m,
[2m[WebServer] [22m  sessionId: [32m'd5057bb5-266e-47cc-b230-1f0283fa2efa'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 532ms[2m (compile: 2ms, proxy.ts: 16ms, render: 514ms)[22m
[Browser warning] Cookie not set yet, waiting additional time...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cb9fbd06...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cb9fbd06'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'133b799a'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'cb9fbd06'[39m }
[Browser log] [Fast Refresh] done in 1738ms
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'7a58a78a-4cb3-4f74-bc7d-9b9cb1cb3395'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'f7f03306-a9d7-48ff-9e66-42aebc915c50'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448913593-wk3p05f0@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448913593-wk3p05f0@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448913593-mrxdty4s@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448913593-mrxdty4s@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.9s[2m (compile: 1965ms, proxy.ts: 176ms, render: 723ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.8s[2m (compile: 1765ms, proxy.ts: 218ms, render: 769ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 133b799a}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: f7f03306-a9d7-48ff-9e66-42aebc915c50}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448913593-mrxdty4s@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448913593-mrxdty4s@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cb9fbd06...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cb9fbd06...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cb9fbd06...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cb9fbd06...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úì   3 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:227:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid email format (8.7s)
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 180ms[2m (compile: 12ms, proxy.ts: 64ms, render: 104ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cb9fbd06'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cb9fbd06'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cb9fbd06'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cb9fbd06'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
  ‚úì   2 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:212:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for non-existent email (9.0s)
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770448922552-aip887z7@example.com'[39m,
  id: [32m'b1147f7e-956b-466d-8675-633d55ebba1f'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'088152c3-39fb-4512-8355-7aebcf714ec5'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770448922552-aip887z7@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448922907-v8rdzy5l@example.com'[39m,
  id: [32m'1a5b6757-678a-4fc5-805b-8e419f261a81'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'2a89dfa5-e567-449c-8f60-2d97c8716320'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448922907-v8rdzy5l@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 508ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 371ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 237ms
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'cb9fbd06...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1513ms[2m (compile: 1269ms, proxy.ts: 28ms, render: 215ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1340ms[2m (compile: 1028ms, proxy.ts: 89ms, render: 223ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'cb9fbd06'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'cb9fbd06'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'7a58a78a-4cb3-4f74-bc7d-9b9cb1cb3395'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448913593-wk3p05f0@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448913593-wk3p05f0@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'133b799a'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'f7f03306-a9d7-48ff-9e66-42aebc915c50'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448913593-mrxdty4s@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448913593-mrxdty4s@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 358ms[2m (compile: 11ms, proxy.ts: 256ms, render: 91ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 402ms[2m (compile: 10ms, proxy.ts: 322ms, render: 70ms)[22m
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 133b799a}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: f7f03306-a9d7-48ff-9e66-42aebc915c50}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448913593-mrxdty4s@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448913593-mrxdty4s@example.com
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 3.4s[2m (compile: 2.5s, proxy.ts: 215ms, render: 651ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 3.5s[2m (compile: 2.5s, proxy.ts: 230ms, render: 743ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 3.5s[2m (compile: 2.6s, proxy.ts: 205ms, render: 749ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 3.5s[2m (compile: 2.4s, proxy.ts: 374ms, render: 767ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 3.5s[2m (compile: 2.4s, proxy.ts: 376ms, render: 774ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 3.5s[2m (compile: 2.5s, proxy.ts: 232ms, render: 782ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.8s[2m (compile: 2.5s, proxy.ts: 214ms, render: 1027ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.9s[2m (compile: 2.4s, proxy.ts: 373ms, render: 1117ms)[22m
  ‚úì   5 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:266:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication (12.8s)
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770448926601-9yn6ou4u@example.com'[39m,
  id: [32m'63b103e1-95f8-4731-bf8c-c092bcb04680'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'dcbeae5d-606c-46ba-adfd-e20e5954661d'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770448926601-9yn6ou4u@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'133b799a'[39m }
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w2-1770448922552-aip887z7@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w1-1770448922907-v8rdzy5l@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'f7f03306-a9d7-48ff-9e66-42aebc915c50'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'b1147f7e-956b-466d-8675-633d55ebba1f'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'1a5b6757-678a-4fc5-805b-8e419f261a81'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448913593-mrxdty4s@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448913593-mrxdty4s@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 599ms[2m (compile: 4ms, proxy.ts: 183ms, render: 413ms)[22m
[2m[WebServer] [22mMagic link for test-w1-1770448922907-v8rdzy5l@example.com: http://localhost:3000/auth/guest-login/verify?token=9a24ef925866fb6594f5e3c87bcc3f2f2eeb83483910aead1b143583ed52ba57
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 309ms[2m (compile: 10ms, proxy.ts: 12ms, render: 287ms)[22m
[2m[WebServer] [22mMagic link for test-w2-1770448922552-aip887z7@example.com: http://localhost:3000/auth/guest-login/verify?token=58a285faa756747bdef0cf15182bc10e06b09d57ad72db8b705bf094b2495822
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 315ms[2m (compile: 10ms, proxy.ts: 12ms, render: 293ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 133b799a}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: f7f03306-a9d7-48ff-9e66-42aebc915c50}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448913593-mrxdty4s@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448913593-mrxdty4s@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[Browser log] [Fast Refresh] done in 370ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 225ms
[2m[WebServer] [22m GET /auth/guest-login/verify?token=5c1d0dc22ab2f1bb6f7ac733c0832f402299d41fa33d5198a9b62ed672433f7e [32m200[39m in 1934ms[2m (compile: 1746ms, proxy.ts: 16ms, render: 173ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=58a285faa756747bdef0cf15182bc10e06b09d57ad72db8b705bf094b2495822 [32m200[39m in 1119ms[2m (compile: 890ms, proxy.ts: 51ms, render: 177ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 1516ms[2m (compile: 645ms, proxy.ts: 269ms, render: 603ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 1527ms[2m (compile: 647ms, proxy.ts: 267ms, render: 614ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 1548ms[2m (compile: 646ms, proxy.ts: 268ms, render: 633ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 1849ms[2m (compile: 647ms, proxy.ts: 266ms, render: 936ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 99ms[2m (compile: 31ms, proxy.ts: 19ms, render: 49ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 165ms[2m (compile: 11ms, proxy.ts: 20ms, render: 134ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'133b799a'[39m }
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 136ms[2m (compile: 11ms, proxy.ts: 17ms, render: 108ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'f7f03306-a9d7-48ff-9e66-42aebc915c50'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448913593-mrxdty4s@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448913593-mrxdty4s@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 686ms[2m (compile: 48ms, proxy.ts: 229ms, render: 409ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 828ms[2m (compile: 11ms, proxy.ts: 20ms, render: 797ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e02438db...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e02438db'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e02438db'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'b1147f7e-956b-466d-8675-633d55ebba1f'[39m
[2m[WebServer] [22m}
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 133b799a}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: f7f03306-a9d7-48ff-9e66-42aebc915c50}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770448913593-mrxdty4s@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770448913593-mrxdty4s@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '133b799a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session', '__next_hmr_refresh_hash__' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448922552-aip887z7@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770448922552-aip887z7@example.com
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 650ms[2m (compile: 8ms, proxy.ts: 223ms, render: 419ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '133b799a'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 615ms[2m (compile: 4ms, proxy.ts: 178ms, render: 434ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e02438db...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e02438db...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e02438db...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e02438db...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 688ms[2m (compile: 1309¬µs, proxy.ts: 193ms, render: 494ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 704ms[2m (compile: 2ms, proxy.ts: 256ms, render: 445ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 715ms[2m (compile: 2ms, proxy.ts: 177ms, render: 536ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e02438db'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e02438db'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e02438db'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e02438db'
[2m[WebServer] [22m}
  ‚úì   4 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:162:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching (18.8s)
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 614ms[2m (compile: 1854¬µs, proxy.ts: 160ms, render: 453ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 642ms[2m (compile: 3ms, proxy.ts: 166ms, render: 473ms)[22m
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770448932650-gk0glob9@example.com'[39m,
  id: [32m'63840e65-0c01-4196-94c1-6252d80018cb'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'9ce03902-7875-4e97-83f1-e0bb98011015'[39m
}
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 777ms[2m (compile: 1463¬µs, proxy.ts: 246ms, render: 530ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 780ms[2m (compile: 1355¬µs, proxy.ts: 155ms, render: 624ms)[22m
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770448932650-gk0glob9@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
  ‚úì   7 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:362:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link (10.7s)
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 40ms[2m (compile: 2ms, proxy.ts: 7ms, render: 31ms)[22m
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448933643-njf27vjm@example.com'[39m,
  id: [32m'4818bd76-4ba0-4da8-9070-bdae8177573f'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'785e1e12-56d8-495d-8d0e-e8b77868495c'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448933643-njf27vjm@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 63ms[2m (compile: 4ms, proxy.ts: 10ms, render: 49ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w0-1770448932650-gk0glob9@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'63840e65-0c01-4196-94c1-6252d80018cb'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w0-1770448932650-gk0glob9@example.com: http://localhost:3000/auth/guest-login/verify?token=60851f9e685a10caa5aeddb1c3e7223b88cc458178ff5932e60d24622986e56d
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 322ms[2m (compile: 12ms, proxy.ts: 7ms, render: 303ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 35ms[2m (compile: 1308¬µs, proxy.ts: 4ms, render: 30ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=60851f9e685a10caa5aeddb1c3e7223b88cc458178ff5932e60d24622986e56d [32m200[39m in 43ms[2m (compile: 1359¬µs, proxy.ts: 5ms, render: 37ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=0f7c8b7442edf6994710c6ca88540992c8f42a08a50d920c9a58d970c03fc1d4 [32m200[39m in 40ms[2m (compile: 1286¬µs, proxy.ts: 4ms, render: 35ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 136ms[2m (compile: 1603¬µs, proxy.ts: 6ms, render: 129ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 41ms[2m (compile: 1797¬µs, proxy.ts: 7ms, render: 32ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 1302ms[2m (compile: 1413¬µs, proxy.ts: 5ms, render: 1296ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '200eefda...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '200eefda'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'200eefda'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'63840e65-0c01-4196-94c1-6252d80018cb'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770448932650-gk0glob9@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770448932650-gk0glob9@example.com
  ‚úì   8 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:410:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link (10.8s)
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 615ms[2m (compile: 4ms, proxy.ts: 169ms, render: 443ms)[22m
  ‚úì   6 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:292:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link (15.2s)
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770448937412-noxv6akx@example.com'[39m,
  id: [32m'bf307887-2ac6-4113-b7a8-ff0ee4fa2024'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c5ac228e-5209-4d44-b897-90bb52e7eab4'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770448937412-noxv6akx@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770448937764-5w85s0s3@example.com'[39m,
  id: [32m'3b1b7592-c516-4669-a3da-2519d2d79191'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'63b06fb7-d439-495a-95c0-add7cab80cd5'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770448937764-5w85s0s3@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '200eefda...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '200eefda...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '200eefda...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '200eefda...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=60851f9e685a10caa5aeddb1c3e7223b88cc458178ff5932e60d24622986e56d [32m200[39m in 100ms[2m (compile: 7ms, proxy.ts: 34ms, render: 59ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 56ms[2m (compile: 7ms, proxy.ts: 20ms, render: 30ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '200eefda'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '200eefda'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '200eefda'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 80ms[2m (compile: 13ms, proxy.ts: 6ms, render: 61ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '200eefda'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770448937412-noxv6akx@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w2-1770448937764-5w85s0s3@example.com
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 397ms[2m (compile: 4ms, proxy.ts: 40ms, render: 353ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used [32m200[39m in 53ms[2m (compile: 2ms, proxy.ts: 8ms, render: 43ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448937412-noxv6akx@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448937764-5w85s0s3@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'3ab72d82'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'bf307887-2ac6-4113-b7a8-ff0ee4fa2024'[39m,
[2m[WebServer] [22m  sessionId: [32m'c1a6ac44-7335-4440-86a0-5205357e6ae1'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 337ms[2m (compile: 7ms, proxy.ts: 5ms, render: 325ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'90fb73ba'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'3b1b7592-c516-4669-a3da-2519d2d79191'[39m,
[2m[WebServer] [22m  sessionId: [32m'd4f033e1-c34f-4d5c-af41-1bdba69201a1'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 282ms[2m (compile: 3ms, proxy.ts: 5ms, render: 273ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3ab72d82...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3ab72d82'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'3ab72d82'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'90fb73ba'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'3b1b7592-c516-4669-a3da-2519d2d79191'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'bf307887-2ac6-4113-b7a8-ff0ee4fa2024'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w2-1770448937764-5w85s0s3@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w2-1770448937764-5w85s0s3@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 609ms[2m (compile: 2ms, proxy.ts: 226ms, render: 381ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770448937412-noxv6akx@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770448937412-noxv6akx@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 690ms[2m (compile: 3ms, proxy.ts: 241ms, render: 447ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
  ‚úì  10 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:506:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token (9.6s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448943229-4eu1upji@example.com'[39m,
  id: [32m'ae5dcd4a-3126-4c20-b84c-013a64b39627'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'fe951712-e19a-4b21-b663-19b7b8a6fc1c'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448943229-4eu1upji@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /guest/events ...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3ab72d82...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3ab72d82...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3ab72d82...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '3ab72d82...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3ab72d82'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3ab72d82'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3ab72d82'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '3ab72d82'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?error=TOKEN_USED&message=This+magic+link+has+already+been+used [32m200[39m in 1903ms[2m (compile: 1392ms, proxy.ts: 272ms, render: 239ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1640ms[2m (compile: 1308ms, proxy.ts: 91ms, render: 241ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 2.4s[2m (compile: 1151ms, proxy.ts: 511ms, render: 776ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 2.6s[2m (compile: 1145ms, proxy.ts: 517ms, render: 889ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 3.4s[2m (compile: 2.1s, proxy.ts: 346ms, render: 907ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 3.4s[2m (compile: 2.2s, proxy.ts: 344ms, render: 942ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 2.6s[2m (compile: 1153ms, proxy.ts: 510ms, render: 954ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 3.5s[2m (compile: 2.2s, proxy.ts: 345ms, render: 958ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.7s[2m (compile: 1158ms, proxy.ts: 505ms, render: 1060ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 3.6s[2m (compile: 2.1s, proxy.ts: 347ms, render: 1067ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 5.8s[2m (compile: 4.5s, proxy.ts: 140ms, render: 1157ms)[22m
  ‚úì   9 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:444:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link (14.2s)
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770448946858-l9h565nm@example.com'[39m,
  id: [32m'0ed3bd32-b3cb-4255-b885-7a99fed071b6'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'628f40f8-1f92-46aa-9867-b5f47b54c4b8'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770448946858-l9h565nm@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1268ms[2m (compile: 906ms, proxy.ts: 194ms, render: 168ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/logout [32m200[39m in 2.2s[2m (compile: 1921ms, proxy.ts: 7ms, render: 305ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 104ms[2m (compile: 2ms, proxy.ts: 12ms, render: 89ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.2s[2m (compile: 1241ms, proxy.ts: 484ms, render: 506ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: false,
[2m[WebServer] [22m  cookieValue: 'none',
[2m[WebServer] [22m  allCookies: []
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No guest session cookie found - redirecting to login
[2m[WebServer] [22m GET /guest/events [32m200[39m in 2.3s[2m (compile: 1238ms, proxy.ts: 486ms, render: 579ms)[22m
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 97ms[2m (compile: 7ms, proxy.ts: 17ms, render: 74ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 124ms[2m (compile: 15ms, proxy.ts: 25ms, render: 84ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 192ms[2m (compile: 9ms, proxy.ts: 23ms, render: 160ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 767ms[2m (compile: 4ms, proxy.ts: 178ms, render: 586ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=5dfb7432f4c076ff73c228378e4588b0ba456ddbc96367eba0e3328e97a4beff [32m200[39m in 68ms[2m (compile: 20ms, proxy.ts: 10ms, render: 38ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
  ‚úì  13 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:642:7 ‚Ä∫ Guest Authentication ‚Ä∫ should switch between authentication tabs (9.5s)
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770448952784-aolck71d@example.com'[39m,
  id: [32m'dccdf2b8-1054-4c46-9991-6d564d409537'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'47cadfdd-0757-48a7-b8a6-5616314b1e7a'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770448952784-aolck71d@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1509ms[2m (compile: 1094ms, proxy.ts: 325ms, render: 90ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 2.3s[2m (compile: 2.1s, proxy.ts: 40ms, render: 176ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 80ms[2m (compile: 13ms, proxy.ts: 15ms, render: 53ms)[22m
[2m[WebServer] [22m GET /guest/activities [32m200[39m in 3.2s[2m (compile: 2.6s, proxy.ts: 146ms, render: 463ms)[22m
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 133ms[2m (compile: 17ms, proxy.ts: 22ms, render: 94ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w1-1770448952784-aolck71d@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770448952784-aolck71d@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'e278ceb9'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'dccdf2b8-1054-4c46-9991-6d564d409537'[39m,
[2m[WebServer] [22m  sessionId: [32m'2bd69a60-9c81-454b-a3ea-9405c521133d'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 332ms[2m (compile: 6ms, proxy.ts: 19ms, render: 307ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e278ceb9...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e278ceb9'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'e278ceb9'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'dccdf2b8-1054-4c46-9991-6d564d409537'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/activities [32m200[39m in 1674ms[2m (compile: 991ms, proxy.ts: 167ms, render: 516ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w1-1770448952784-aolck71d@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w1-1770448952784-aolck71d@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 749ms[2m (compile: 22ms, proxy.ts: 168ms, render: 559ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e278ceb9...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e278ceb9...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e278ceb9...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'e278ceb9...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 176ms[2m (compile: 11ms, proxy.ts: 12ms, render: 153ms)[22m
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fdashboard [32m200[39m in 183ms[2m (compile: 52ms, proxy.ts: 12ms, render: 119ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e278ceb9'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e278ceb9'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e278ceb9'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'e278ceb9'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 618ms[2m (compile: 7ms, proxy.ts: 190ms, render: 420ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 662ms[2m (compile: 9ms, proxy.ts: 208ms, render: 445ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 769ms[2m (compile: 18ms, proxy.ts: 209ms, render: 542ms)[22m
[2m[WebServer] [22m GET /guest/activities [32m200[39m in 906ms[2m (compile: 22ms, proxy.ts: 176ms, render: 709ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 952ms[2m (compile: 25ms, proxy.ts: 210ms, render: 717ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '90fb73ba...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '90fb73ba'
[2m[WebServer] [22m}
Audit log query result: {
  found: [33m0[39m,
  guestId: [32m'dccdf2b8-1054-4c46-9991-6d564d409537'[39m,
  error: [90mundefined[39m
}
[2m[WebServer] [22m GET /api/guest/activities [32m200[39m in 601ms[2m (compile: 1433¬µs, proxy.ts: 166ms, render: 434ms)[22m
  ‚úì  14 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:685:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully (15.0s)
  ‚úò  11 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow (24.9s)
  ‚úì  12 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:595:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes (26.0s)
  ‚úò  15 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:736:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log (13.4s)

üßπ E2E Global Teardown Starting...

üóëÔ∏è  Cleaning up test data...
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üîì Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
‚úÖ Authentication state removed

üìä Execution Summary:
   Duration: 2.60s
   Errors: 0
   Status: ‚úÖ Clean teardown

‚ú® E2E Global Teardown Complete!



  1) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow 

    TimeoutError: page.waitForURL: Timeout 5000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/auth/guest-login" until "domcontentloaded"
      navigated to "http://localhost:3000/auth/guest-login?returnTo=%2Fguest%2Fdashboard"
      navigated to "http://localhost:3000/auth/guest-login?returnTo=%2Fguest%2Fdashboard"
    ============================================================

      585 |     
      586 |     // Wait for redirect to login page (middleware should redirect)
    > 587 |     await page.waitForURL('/auth/guest-login', { 
          |                ^
      588 |       timeout: 5000,
      589 |       waitUntil: 'domcontentloaded'
      590 |     });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:587:16

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/error-context.md

  2) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:736:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoHaveLength[2m([22m[32mexpected[39m[2m)[22m

    Expected length: [32m1[39m
    Received length: [31m0[39m
    Received array:  [31m[][39m

      803 |
      804 |     expect(loginError).toBeNull();
    > 805 |     expect(loginLogs).toHaveLength(1);
          |                       ^
      806 |     expect(loginLogs![0].details.auth_method).toBe('email_matching');
      807 |     expect(loginLogs![0].details.email).toBe(testGuestEmail);
      808 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:805:23

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/error-context.md

  2 failed
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:535:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:736:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 
  1 skipped
  12 passed (1.3m)

[36m  Serving HTML report at http://localhost:50079. Press Ctrl+C to quit.[39m
