
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: âš™ï¸  suppress all logs with { quiet: true }

ðŸš€ E2E Global Setup Starting...

ðŸ“Š Verifying test database connection...
âœ… Test database connected

ðŸ§¹ Cleaning up test data...
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ðŸ‘¤ Creating test guest...
   Created test guest: test@example.com (ID: 14e31456-f797-42a5-93ea-4f9a00116cc7)
âœ… Test guest created

ðŸ“¦ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
âœ… Comprehensive test data created

ðŸŒ Verifying Next.js server...
âœ… Next.js server is running

ðŸ”¥ Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
   â³ Route not ready: /api/guest-auth/email-match (attempt 1/5, got 404)
   â³ Route not ready: /api/guest-auth/email-match (attempt 2/5, got 404)
   â³ Route not ready: /api/guest-auth/email-match (attempt 3/5, got 404)
   â³ Route not ready: /api/guest-auth/email-match (attempt 4/5, got 404)
   â³ Route not ready: /api/guest-auth/email-match (attempt 5/5, got 404)
   âš ï¸  Warning: Route /api/guest-auth/email-match still not ready after 5 attempts
   â„¹ï¸  Tests may fail if this route is needed
   â³ Route not ready: /api/guest-auth/magic-link/request (attempt 1/5, got 404)
   â³ Route not ready: /api/guest-auth/magic-link/request (attempt 2/5, got 404)
   â³ Route not ready: /api/guest-auth/magic-link/request (attempt 3/5, got 404)
   â³ Route not ready: /api/guest-auth/magic-link/request (attempt 4/5, got 404)
   â³ Route not ready: /api/guest-auth/magic-link/request (attempt 5/5, got 404)
   âš ï¸  Warning: Route /api/guest-auth/magic-link/request still not ready after 5 attempts
   â„¹ï¸  Tests may fail if this route is needed
   âœ… Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
   âœ… Guest auth routes warmup complete
âœ… API routes warmed up

ðŸ” Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   Navigating to http://localhost:3000/auth/login...
   Page loaded, filling form...
   Form filled, submitting...
   Current URL after submit: http://localhost:3000/auth/login
   âš ï¸  Browser login did not redirect to /admin
   âš ï¸  Tests will need to handle their own authentication
   â„¹ï¸  Created empty auth state file
âœ… Admin authentication saved

âœ¨ E2E Global Setup Complete!


Running 16 tests using 4 workers

[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
Setting up authentication for E2E tests...
Credentials filled, clicking submit button...
Browser console [log]: === LOGIN ATTEMPT ===
Browser console [log]: Supabase URL: https://bwthjirvpdypmbvpsjtl.supabase.co
Browser console [error]: Failed to load resource: the server responded with a status of 400 ()
Browser console [error]: âŒ Login error: AuthApiError: Invalid login credentials
    at handleError (webpack-internal:///(app-pages-browser)/./node_modules/@supabase/auth-js/dist/module/lib/fetch.js:71:11)
    at async _handleRequest (webpack-internal:///(app-pages-browser)/./node_modules/@supabase/auth-js/dist/module/lib/fetch.js:114:9)
    at async _request (webpack-internal:///(app-pages-browser)/./node_modules/@supabase/auth-js/dist/module/lib/fetch.js:96:18)
    at async SupabaseAuthClient.signInWithPassword (webpack-internal:///(app-pages-browser)/./node_modules/@supabase/auth-js/dist/module/GoTrueClient.js:456:23)
    at async handleLogin (webpack-internal:///(app-pages-browser)/./app/auth/login/page.tsx:36:37)
âŒ Login failed with error: Invalid login credentials (Status: 400)
  âœ˜   1 [setup] â€º __tests__/e2e/auth.setup.ts:16:6 â€º authenticate as admin (21.4s)

ðŸ§¹ E2E Global Teardown Starting...

ðŸ—‘ï¸  Cleaning up test data...
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ðŸ”“ Removing authentication state...
   Removed: .auth/user.json
   Removed empty .auth directory
âœ… Authentication state removed

ðŸ“Š Execution Summary:
   Duration: 1.83s
   Errors: 0
   Status: âœ… Clean teardown

âœ¨ E2E Global Teardown Complete!



  1) [setup] â€º __tests__/e2e/auth.setup.ts:16:6 â€º authenticate as admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error: Login failed: Invalid login credentials (Status: 400)

      72 |       const errorText = await errorDiv.textContent();
      73 |       console.error('âŒ Login failed with error:', errorText);
    > 74 |       throw new Error(`Login failed: ${errorText}`);
         |             ^
      75 |     }
      76 |     
      77 |     // Check current URL
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth.setup.ts:74:13

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth.setup.ts-authenticate-as-admin-setup/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth.setup.ts-authenticate-as-admin-setup/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth.setup.ts-authenticate-as-admin-setup/error-context.md

  1 failed
    [setup] â€º __tests__/e2e/auth.setup.ts:16:6 â€º authenticate as admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  15 did not run

[36m  Serving HTML report at http://localhost:64936. Press Ctrl+C to quit.[39m
