
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: âš™ï¸  override existing env vars with { override: true }

ğŸš€ E2E Global Setup Starting...

ğŸ“Š Verifying test database connection...
âœ… Test database connected

ğŸ§¹ Cleaning up test data...
ğŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ğŸ‘¤ Creating test guest...
   Created test guest: test@example.com (ID: 57267b70-26ac-483d-9564-0500de41fec7)
âœ… Test guest created

ğŸ“¦ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
âœ… Comprehensive test data created

ğŸŒ Verifying Next.js server...
âœ… Next.js server is running

ğŸ” Setting up admin authentication...
   Authenticating admin via API: admin@example.com
   Created .auth directory: /Users/jaron/Desktop/wedding-platform-v2/.auth
   âœ… API authentication successful
   Creating browser context with auth session...
   âœ… Auth session injected into localStorage
   âŒ Failed to verify authentication: Error: Authentication session not working - redirected to login

âŒ E2E Global Setup Failed: Error: Authentication session not working - redirected to login
    at createAdminAuthState (/Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/global-setup.ts:823:13)
    at globalSetup (/Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/global-setup.ts:52:5)
    at Object.setup (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/runner/tasks.js:174:27)
    at taskLoop (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/runner/taskRunner.js:62:11)
    at TaskRunner.runDeferCleanup (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/runner/taskRunner.js:78:5)
    at TaskRunner.run (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/runner/taskRunner.js:42:33)
    at runTasks (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/runner/tasks.js:80:18)
    at runAllTestsWithConfig (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/runner/testRunner.js:388:18)
    at runTests (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/program.js:242:18)
    at i.<anonymous> (/Users/jaron/Desktop/wedding-platform-v2/node_modules/playwright/lib/program.js:70:7)
Error: Authentication session not working - redirected to login

   at global-setup.ts:823

  821 |     const currentURL = page.url();
  822 |     if (currentURL.includes('/auth/login')) {
> 823 |       throw new Error('Authentication session not working - redirected to login');
      |             ^
  824 |     }
  825 |     
  826 |     console.log(`   âœ… Browser authentication verified at ${currentURL}`);
    at createAdminAuthState (/Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/global-setup.ts:823:13)
    at globalSetup (/Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/global-setup.ts:52:5)

ğŸ§¹ E2E Global Teardown Starting...

ğŸ—‘ï¸  Cleaning up test data...
ğŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ğŸ”“ Removing authentication state...
   No authentication files found (already clean)
   Removed empty .auth directory
âœ… Authentication state removed

ğŸ“Š Execution Summary:
   Duration: 1.84s
   Errors: 0
   Status: âœ… Clean teardown

âœ¨ E2E Global Teardown Complete!



To open last HTML report run:
[36m[39m
[36m  npx playwright show-report[39m
[36m[39m
