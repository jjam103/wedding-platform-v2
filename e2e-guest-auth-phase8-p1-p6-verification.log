
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: üì° add observability to secrets: https://dotenvx.com/ops
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168m‚ñ≤ Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://192.168.7.238:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Starting...
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22müöÄ Initializing application services...
[2m[WebServer] [22m‚úÖ B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m‚úÖ Application services initialized successfully
[2m[WebServer] [22m[32m[1m‚úì[22m[39m Ready in 3.7s
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling / ...

üöÄ E2E Global Setup Starting...

üìä Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 618ms[2m (compile: 222ms, proxy.ts: 15ms, render: 381ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 5.5s[2m (compile: 4.9s, proxy.ts: 231ms, render: 385ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 39ms[2m (compile: 7ms, proxy.ts: 8ms, render: 24ms)[22m
‚úÖ Test database connected

üßπ Cleaning up test data...
   Cleaning up leftover test data...
   Test data cleanup complete
‚úÖ Test data cleaned

üë§ Creating test guest...
   Created warmup guest: warmup@example.com (ID: 3127da85-a53b-496c-8ccf-85cbd7801e8a)
   Created test guest: test@example.com (ID: 07b24b67-b816-467c-b6a8-4471498511fb)
‚úÖ Test guest created

üì¶ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
‚úÖ Comprehensive test data created

üåê Verifying Next.js server...
‚úÖ Next.js server is running

üî• Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
[2m[WebServer] [22m GET / [32m200[39m in 98ms[2m (compile: 6ms, proxy.ts: 20ms, render: 72ms)[22m
[2m[WebServer] [22m GET / [32m200[39m in 98ms[2m (compile: 12ms, proxy.ts: 27ms, render: 59ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Looking for guest with email: warmup@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 1065ms[2m (compile: 712ms, proxy.ts: 71ms, render: 283ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
   ‚úÖ Route ready: /api/guest-auth/email-match (attempt 1/5, status: 404)
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 1160ms[2m (compile: 845ms, proxy.ts: 27ms, render: 288ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Processing request for email: warmup@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  guestId: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'JSON object requested, multiple (or no) rows returned'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest not found
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 1408ms[2m (compile: 1156ms, proxy.ts: 9ms, render: 243ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  guestId: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'JSON object requested, multiple (or no) rows returned'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Magic Link Request] Guest not found
   ‚úÖ Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 404)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [33m404[39m in 1405ms[2m (compile: 1145ms, proxy.ts: 14ms, render: 246ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 1462ms[2m (compile: 1260ms, proxy.ts: 12ms, render: 190ms)[22m
   ‚úÖ Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [33m400[39m in 1480ms[2m (compile: 1260ms, proxy.ts: 12ms, render: 207ms)[22m
   ‚úÖ Guest auth routes warmup complete
‚úÖ API routes warmed up

üîê Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Navigating to http://localhost:3000/auth/login...
[2m[WebServer] [22m GET /auth/login [32m200[39m in 2.5s[2m (compile: 2.1s, proxy.ts: 17ms, render: 287ms)[22m
[2m[WebServer] [22m GET /auth/login [32m200[39m in 2.5s[2m (compile: 2.1s, proxy.ts: 17ms, render: 288ms)[22m
   Page loaded, filling form...
   Form filled, submitting...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m[33m[1m‚ö†[22m[39m Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[2m[WebServer] [22m GET /admin [32m200[39m in 1520ms[2m (compile: 846ms, proxy.ts: 483ms, render: 191ms)[22m
[2m[WebServer] [22m GET /admin [32m200[39m in 1522ms[2m (compile: 855ms, proxy.ts: 474ms, render: 193ms)[22m
   Current URL after submit: http://localhost:3000/admin
   ‚úÖ Successfully logged in via browser
   ‚úÖ Authentication state saved
‚úÖ Admin authentication saved

‚ú® E2E Global Setup Complete!


Running 15 tests using 4 workers

  -   1 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:235:8 ‚Ä∫ Guest Authentication ‚Ä∫ should show loading state during authentication
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[Worker 3] Created test guest: {
  email: [32m'test-w3-1770446480221-iazg7kpd@example.com'[39m,
  id: [32m'c1d961bc-ce88-4f78-814c-eb76f921811e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'30ce166d-1e3f-41b9-ae32-83fe755457ce'[39m
}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770446480180-qxmjqpee@example.com'[39m,
  id: [32m'c9cdbabc-fc75-40bd-a1bd-a2462bb3bc32'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'd7b1ad7c-ed46-453b-83e7-a2f0200b9db4'[39m
}
[Worker 3] ‚úÖ Verified guest exists: {
  email: [32m'test-w3-1770446480221-iazg7kpd@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770446480192-ar1opn5r@example.com'[39m,
  id: [32m'69e3b237-ef38-4249-bd41-1613d0a23f2f'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'75cdf18f-0662-447e-abc0-21d44d1fe8b7'[39m
}
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770446480261-u7i9t55m@example.com'[39m,
  id: [32m'14625049-bf89-4fec-9a64-d65f255b9c52'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'8f2d2be0-f252-4e77-93f1-080576ddd313'[39m
}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770446480180-qxmjqpee@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 0] ‚úÖ Verified guest exists: {
  email: [32m'test-w0-1770446480261-u7i9t55m@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770446480192-ar1opn5r@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1851ms[2m (compile: 1043ms, proxy.ts: 65ms, render: 743ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1856ms[2m (compile: 1042ms, proxy.ts: 65ms, render: 748ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1554ms[2m (compile: 732ms, proxy.ts: 64ms, render: 758ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1555ms[2m (compile: 732ms, proxy.ts: 65ms, render: 759ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1869ms[2m (compile: 1043ms, proxy.ts: 65ms, render: 761ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1870ms[2m (compile: 1042ms, proxy.ts: 65ms, render: 762ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1875ms[2m (compile: 1043ms, proxy.ts: 65ms, render: 767ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1918ms[2m (compile: 1083ms, proxy.ts: 53ms, render: 782ms)[22m
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] [HMR] connected
[Test] About to click submit button
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770446480221-iazg7kpd@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770446480261-u7i9t55m@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770446480221-iazg7kpd@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: test-w0-1770446480165-oc96bk10@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w3-1770446480521-4bsifict@example.com
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'7a5fd8da'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'c1d961bc-ce88-4f78-814c-eb76f921811e'[39m,
[2m[WebServer] [22m  sessionId: [32m'3347acff-d4dc-445f-a3b0-73196389524e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 5.7s[2m (compile: 2.0s, proxy.ts: 291ms, render: 3.4s)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 5.8s[2m (compile: 33ms, proxy.ts: 3.9s, render: 1859ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770446480261-u7i9t55m@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'0309d20a'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'14625049-bf89-4fec-9a64-d65f255b9c52'[39m,
[2m[WebServer] [22m  sessionId: [32m'5c6127b4-774d-4e66-829d-32a90e26b1f4'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 6.2s[2m (compile: 33ms, proxy.ts: 3.9s, render: 2.3s)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770446480165-oc96bk10@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 2.5s[2m (compile: 232ms, proxy.ts: 300ms, render: 1960ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770446480521-4bsifict@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'f78b26e4'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'788ff537-4814-46bb-a8a3-53ffc35f08b1'[39m,
[2m[WebServer] [22m  sessionId: [32m'9f8d0a56-1382-4a8e-bde8-24a6c427c3e8'[39m
[2m[WebServer] [22m}
[Browser warning] Cookie not set yet, waiting additional time...
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 2.9s[2m (compile: 232ms, proxy.ts: 300ms, render: 2.4s)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'bf24b65b'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'f6952256-45df-4c90-ace8-7bd323435c97'[39m,
[2m[WebServer] [22m  sessionId: [32m'4054164d-b27a-4fd9-b4c0-f60e74a5767e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 3.0s[2m (compile: 232ms, proxy.ts: 300ms, render: 2.4s)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '7a5fd8da...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0309d20a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úì   2 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:222:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid email format (12.9s)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0309d20a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '7a5fd8da'
[2m[WebServer] [22m}
[Worker 2] Created test guest: {
  email: [32m'test-w2-1770446493689-97douahm@example.com'[39m,
  id: [32m'd3f4ef7a-9b33-4889-bce8-553d965a5f3a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'a0129d20-2c4d-4057-b1e9-35b2de148b77'[39m
}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'f78b26e4...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[Worker 2] ‚úÖ Verified guest exists: {
  email: [32m'test-w2-1770446493689-97douahm@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'f78b26e4'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'bf24b65b...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úì   4 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:207:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for non-existent email (14.1s)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'bf24b65b'
[2m[WebServer] [22m}
[Worker 1] Created test guest: {
  email: [32m'test-w1-1770446494727-h5l11zad@example.com'[39m,
  id: [32m'b66c8d8b-23d0-4cae-a34f-5466324ab20b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'd7415ea0-cc2e-4748-9f0a-a21da9535195'[39m
}
[Worker 1] ‚úÖ Verified guest exists: {
  email: [32m'test-w1-1770446494727-h5l11zad@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Browser log] [Fast Refresh] rebuilding
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /guest/dashboard ...
[Browser log] [Fast Refresh] done in 1573ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 456ms
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'0309d20a'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'7a5fd8da'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'f78b26e4'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'bf24b65b'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'14625049-bf89-4fec-9a64-d65f255b9c52'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'c1d961bc-ce88-4f78-814c-eb76f921811e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'788ff537-4814-46bb-a8a3-53ffc35f08b1'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'f6952256-45df-4c90-ace8-7bd323435c97'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 5.1s[2m (compile: 3.1s, proxy.ts: 78ms, render: 2.0s)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 4.2s[2m (compile: 1318ms, proxy.ts: 847ms, render: 2.0s)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 5.6s[2m (compile: 3.2s, proxy.ts: 364ms, render: 2.0s)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 3.4s[2m (compile: 1183ms, proxy.ts: 138ms, render: 2.0s)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770446480261-u7i9t55m@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770446480261-u7i9t55m@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770446480221-iazg7kpd@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770446480221-iazg7kpd@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w3-1770446480521-4bsifict@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w3-1770446480521-4bsifict@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w0-1770446480165-oc96bk10@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w0-1770446480165-oc96bk10@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 7.8s[2m (compile: 4.3s, proxy.ts: 662ms, render: 2.8s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 7.7s[2m (compile: 4.3s, proxy.ts: 572ms, render: 2.8s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 7.1s[2m (compile: 3.5s, proxy.ts: 737ms, render: 2.9s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 7.1s[2m (compile: 3.9s, proxy.ts: 311ms, render: 2.9s)[22m
=== Navigation failed, dumping console logs ===
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] [HMR] connected
[Browser warning] Cookie not set yet, waiting additional time...
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 1573ms
[Browser log] [Fast Refresh] rebuilding
[Browser log] [Fast Refresh] done in 456ms
=== Current URL === http://localhost:3000/guest/dashboard
  ‚úò   3 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:261:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication (21.2s)
[Browser info] %cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold
[Browser log] %c%s%c [GuestDashboard] Session check: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {hasToken: true, tokenPrefix: 0309d20a}
[Browser log] %c%s%c [GuestDashboard] Session query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, guestId: 14625049-bf89-4fec-9a64-d65f255b9c52}
[Browser log] %c%s%c [GuestDashboard] Guest query result: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {found: true, email: test-w0-1770446480261-u7i9t55m@example.com}
[Browser log] %c%s%c [GuestDashboard] Rendering dashboard for guest: background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   test-w0-1770446480261-u7i9t55m@example.com
[Browser log] [HMR] connected
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0309d20a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0309d20a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0309d20a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '0309d20a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0309d20a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[Browser error] Failed to load resource: the server responded with a status of 401 (Unauthorized)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0309d20a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0309d20a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '0309d20a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'f78b26e4...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'f78b26e4...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'f78b26e4...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'f78b26e4...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úò   5 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:157:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching (24.5s)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'f78b26e4'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'f78b26e4'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'f78b26e4'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'f78b26e4'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /api/guest/wedding-info ...
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770446508971-8x5fl2xf@example.com'[39m,
  id: [32m'07cfb217-70f1-4a9d-ab61-3a0b7451e5b3'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'1a0ac99a-c42d-46b7-a546-a0ec63adb22c'[39m
}
[Worker 4] ‚úÖ Verified guest exists: {
  email: [32m'test-w4-1770446508971-8x5fl2xf@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[Worker 5] Created test guest: {
  email: [32m'test-w5-1770446510414-vs6xzcsx@example.com'[39m,
  id: [32m'48f3a936-28b4-4d54-8b80-43f01cddbf1e'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'c87a4e3e-88b2-4f46-b24e-fd27b3dd70b7'[39m
}
[Worker 5] ‚úÖ Verified guest exists: {
  email: [32m'test-w5-1770446510414-vs6xzcsx@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
  ‚úò   6 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:287:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link (21.4s)
  ‚úò   7 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:351:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link (20.4s)
[2m[WebServer] [22mMagic link request error: SyntaxError: Unexpected end of JSON input
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at POST (app/api/guest-auth/magic-link/request/route.ts:40:34)
[2m[WebServer] [22m[0m [90m 38 |[39m     } [36melse[39m {
[2m[WebServer] [22m [90m 39 |[39m       [90m// JSON from API/tests[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 40 |[39m       [36mconst[39m body [33m=[39m [36mawait[39m request[33m.[39mjson()[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                  [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 41 |[39m       email [33m=[39m body[33m.[39memail[33m;[39m
[2m[WebServer] [22m [90m 42 |[39m     }
[2m[WebServer] [22m [90m 43 |[39m     [0m
[2m[WebServer] [22mMagic link request error: SyntaxError: Unexpected end of JSON input
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at POST (app/api/guest-auth/magic-link/request/route.ts:40:34)
[2m[WebServer] [22m[0m [90m 38 |[39m     } [36melse[39m {
[2m[WebServer] [22m [90m 39 |[39m       [90m// JSON from API/tests[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 40 |[39m       [36mconst[39m body [33m=[39m [36mawait[39m request[33m.[39mjson()[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                  [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 41 |[39m       email [33m=[39m body[33m.[39memail[33m;[39m
[2m[WebServer] [22m [90m 42 |[39m     }
[2m[WebServer] [22m [90m 43 |[39m     [0m
[2m[WebServer] [22mMagic link request error: SyntaxError: Unexpected end of JSON input
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at POST (app/api/guest-auth/magic-link/request/route.ts:40:34)
[2m[WebServer] [22m[0m [90m 38 |[39m     } [36melse[39m {
[2m[WebServer] [22m [90m 39 |[39m       [90m// JSON from API/tests[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 40 |[39m       [36mconst[39m body [33m=[39m [36mawait[39m request[33m.[39mjson()[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                  [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 41 |[39m       email [33m=[39m body[33m.[39memail[33m;[39m
[2m[WebServer] [22m [90m 42 |[39m     }
[2m[WebServer] [22m [90m 43 |[39m     [0m
[2m[WebServer] [22mMagic link request error: SyntaxError: Unexpected end of JSON input
[2m[WebServer] [22m    at JSON.parse (<anonymous>)
[2m[WebServer] [22m    at POST (app/api/guest-auth/magic-link/request/route.ts:40:34)
[2m[WebServer] [22m[0m [90m 38 |[39m     } [36melse[39m {
[2m[WebServer] [22m [90m 39 |[39m       [90m// JSON from API/tests[39m
[2m[WebServer] [22m[31m[1m>[22m[39m[90m 40 |[39m       [36mconst[39m body [33m=[39m [36mawait[39m request[33m.[39mjson()[33m;[39m
[2m[WebServer] [22m [90m    |[39m                                  [31m[1m^[22m[39m
[2m[WebServer] [22m [90m 41 |[39m       email [33m=[39m body[33m.[39memail[33m;[39m
[2m[WebServer] [22m [90m 42 |[39m     }
[2m[WebServer] [22m [90m 43 |[39m     [0m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 3.1s[2m (compile: 1385ms, proxy.ts: 657ms, render: 1034ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 3.1s[2m (compile: 1385ms, proxy.ts: 657ms, render: 1037ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=4a25ca645a521940234b8cb7a0531a307d9fe15f11c177baffea67f587e7cb38 [32m200[39m in 5.4s[2m (compile: 4.2s, proxy.ts: 108ms, render: 1037ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=8fca32f2c5db38339dfb6821960ddfed31c5e54cfde3bf95c850c3e7df3be7a4 [32m200[39m in 5.4s[2m (compile: 4.2s, proxy.ts: 108ms, render: 1039ms)[22m
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 347ms[2m (compile: 17ms, proxy.ts: 89ms, render: 242ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w5-1770446511023-fin89m7b@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[Worker 7] Created test guest: {
  email: [32m'test-w7-1770446518379-wx3viy0z@example.com'[39m,
  id: [32m'ae256582-6f81-4d07-807f-83a372dfe956'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'd71b97d4-76a5-4b67-a657-c4257592d6be'[39m
}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 735ms[2m (compile: 51ms, proxy.ts: 317ms, render: 367ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'0a426a2d-8b0f-4b5f-b785-8264218cddde'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[Worker 7] ‚úÖ Verified guest exists: {
  email: [32m'test-w7-1770446518379-wx3viy0z@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[Worker 6] Created test guest: {
  email: [32m'test-w6-1770446518310-tgrfhffv@example.com'[39m,
  id: [32m'2ef124fd-ac02-4754-bd87-3dc0424df3c8'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'cfe2b170-f971-4551-a706-4398fa9857d1'[39m
}
[2m[WebServer] [22mMagic link for test-w5-1770446511023-fin89m7b@example.com: http://localhost:3000/auth/guest-login/verify?token=89e67618839d425cbef200ea8107c23da256adbf5a378d1fee28b6d9e405fcdd
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 874ms[2m (compile: 38ms, proxy.ts: 303ms, render: 532ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 910ms[2m (compile: 48ms, proxy.ts: 304ms, render: 558ms)[22m
[Worker 6] ‚úÖ Verified guest exists: {
  email: [32m'test-w6-1770446518310-tgrfhffv@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 990ms[2m (compile: 57ms, proxy.ts: 151ms, render: 783ms)[22m
[2m[WebServer] [22m[Magic Link Request] Processing request for email: test-w5-1770446510414-vs6xzcsx@example.com
[2m[WebServer] [22m[Magic Link Request] Looking for guest by email...
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 1425ms[2m (compile: 99ms, proxy.ts: 494ms, render: 832ms)[22m
[2m[WebServer] [22m[Magic Link Request] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  guestId: [32m'48f3a936-28b4-4d54-8b80-43f01cddbf1e'[39m,
[2m[WebServer] [22m  authMethod: [32m'magic_link'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mMagic link for test-w5-1770446510414-vs6xzcsx@example.com: http://localhost:3000/auth/guest-login/verify?token=87ebc345d9307b4a0f298c20c11ae95229075795177c1577e7fd63066d1e8788
[2m[WebServer] [22m POST /api/guest-auth/magic-link/request [32m200[39m in 1383ms[2m (compile: 498ms, proxy.ts: 69ms, render: 816ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=invalid-token [32m200[39m in 1817ms[2m (compile: 84ms, proxy.ts: 316ms, render: 1417ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=89e67618839d425cbef200ea8107c23da256adbf5a378d1fee28b6d9e405fcdd [32m200[39m in 1613ms[2m (compile: 52ms, proxy.ts: 68ms, render: 1493ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 2.0s[2m (compile: 67ms, proxy.ts: 551ms, render: 1417ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1464ms[2m (compile: 73ms, proxy.ts: 478ms, render: 913ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=87ebc345d9307b4a0f298c20c11ae95229075795177c1577e7fd63066d1e8788 [32m200[39m in 1426ms[2m (compile: 575ms, proxy.ts: 120ms, render: 731ms)[22m
  ‚úì   8 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:393:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for expired magic link (20.0s)
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 1004ms[2m (compile: 315ms, proxy.ts: 90ms, render: 599ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w6-1770446518310-tgrfhffv@example.com
[2m[WebServer] [22m[API] Looking for guest with email: test-w7-1770446518820-65394njd@example.com
[2m[WebServer] [22m GET /auth/guest-login/verify [32m200[39m in 1181ms[2m (compile: 367ms, proxy.ts: 368ms, render: 446ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770446518310-tgrfhffv@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[Worker 4] Created test guest: {
  email: [32m'test-w4-1770446529579-e56o6kq4@example.com'[39m,
  id: [32m'736c8193-7ed4-4fa4-b822-bd4e17dcceba'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'a56a33b4-b2fe-48c9-927a-be95d86aa4ce'[39m
}
[Worker 4] ‚úÖ Verified guest exists: {
  email: [32m'test-w4-1770446529579-e56o6kq4@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w7-1770446518820-65394njd@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'a1767345'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'2ef124fd-ac02-4754-bd87-3dc0424df3c8'[39m,
[2m[WebServer] [22m  sessionId: [32m'26c07c00-6046-44b3-a7a3-cfedbb200392'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1133ms[2m (compile: 181ms, proxy.ts: 189ms, render: 762ms)[22m
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'06141515'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'32a91af3-f33f-4cb7-a30a-28d6eed9befe'[39m,
[2m[WebServer] [22m  sessionId: [32m'b89bd34c-3edb-4efe-bd58-d491dc5e2505'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1368ms[2m (compile: 181ms, proxy.ts: 189ms, render: 997ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 2.2s[2m (compile: 24ms, proxy.ts: 71ms, render: 2.1s)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fe0e399c...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fe0e399c'
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 2.1s[2m (compile: 211ms, proxy.ts: 189ms, render: 1688ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'fe0e399c'[39m }
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 1063ms[2m (compile: 36ms, proxy.ts: 76ms, render: 951ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd07c3861...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a1767345...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '06141515...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'0a426a2d-8b0f-4b5f-b785-8264218cddde'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a1767345'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd07c3861'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '06141515'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'a1767345'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'06141515'[39m }
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'd07c3861'[39m }
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 881ms[2m (compile: 51ms, proxy.ts: 363ms, render: 467ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'2ef124fd-ac02-4754-bd87-3dc0424df3c8'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'32a91af3-f33f-4cb7-a30a-28d6eed9befe'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'48f3a936-28b4-4d54-8b80-43f01cddbf1e'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770446511023-fin89m7b@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770446511023-fin89m7b@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770446518310-tgrfhffv@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w6-1770446518310-tgrfhffv@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w7-1770446518820-65394njd@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w7-1770446518820-65394njd@example.com
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w5-1770446510414-vs6xzcsx@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w5-1770446510414-vs6xzcsx@example.com
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 4.2s[2m (compile: 474ms, proxy.ts: 377ms, render: 3.3s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 3.5s[2m (compile: 84ms, proxy.ts: 508ms, render: 2.9s)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 3.2s[2m (compile: 48ms, proxy.ts: 219ms, render: 2.9s)[22m
[2m[WebServer] [22m POST /guest/dashboard [32m200[39m in 3.7s[2m (compile: 77ms, proxy.ts: 515ms, render: 3.1s)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a1767345...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '06141515...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a1767345'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'a1767345'[39m }
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '06141515'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'2ef124fd-ac02-4754-bd87-3dc0424df3c8'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'06141515'[39m }
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w6-1770446518310-tgrfhffv@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w6-1770446518310-tgrfhffv@example.com
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'32a91af3-f33f-4cb7-a30a-28d6eed9befe'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w7-1770446518820-65394njd@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w7-1770446518820-65394njd@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.3s[2m (compile: 113ms, proxy.ts: 378ms, render: 1840ms)[22m
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.4s[2m (compile: 545ms, proxy.ts: 592ms, render: 1302ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=4187664a892e43eb4e3ccdadb075d8b81b566ae49019890a9514fd1417135dd8 [32m200[39m in 1266ms[2m (compile: 174ms, proxy.ts: 660ms, render: 432ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=a798ceaa956a6523661b83dbfd40c01e3b1af05a2a78b1e000614c4403829ad2 [32m200[39m in 813ms[2m (compile: 181ms, proxy.ts: 248ms, render: 384ms)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w4-1770446529579-e56o6kq4@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770446529579-e56o6kq4@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'023eabdd'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'736c8193-7ed4-4fa4-b822-bd4e17dcceba'[39m,
[2m[WebServer] [22m  sessionId: [32m'de5f52d3-ee1f-464e-9487-ecd69aece2ab'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 2.1s[2m (compile: 254ms, proxy.ts: 281ms, render: 1594ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fe0e399c...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fe0e399c...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fe0e399c...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'fe0e399c...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fe0e399c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[API] Looking for guest with email: test-w4-1770446530508-ocr4qtbh@example.com
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd07c3861...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd07c3861...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd07c3861...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'd07c3861...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770446530508-ocr4qtbh@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'437022ae'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'22cd77ec-555c-4f38-a4aa-926cbaf429d0'[39m,
[2m[WebServer] [22m  sessionId: [32m'cdf66cea-b20e-4559-b880-62d0b72431c8'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 3.8s[2m (compile: 227ms, proxy.ts: 2.5s, render: 1121ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fe0e399c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd07c3861'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd07c3861'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fe0e399c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'fe0e399c'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd07c3861'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'd07c3861'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'023eabdd'[39m }
  ‚úò   9 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:427:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link (38.4s)
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'736c8193-7ed4-4fa4-b822-bd4e17dcceba'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770446529579-e56o6kq4@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w4-1770446529579-e56o6kq4@example.com
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'437022ae'[39m }
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'22cd77ec-555c-4f38-a4aa-926cbaf429d0'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 4.3s[2m (compile: 42ms, proxy.ts: 2.3s, render: 1921ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w4-1770446530508-ocr4qtbh@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w4-1770446530508-ocr4qtbh@example.com
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 2.8s[2m (compile: 132ms, proxy.ts: 505ms, render: 2.2s)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /guest/events ...
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '06141515...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '06141515...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '06141515...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '06141515...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '06141515'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a1767345...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a1767345...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a1767345...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a1767345'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '06141515'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '06141515'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '06141515'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: 'a1767345...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a1767345'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a1767345'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: 'a1767345'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
  ‚úò  11 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:512:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow (41.3s)
[Worker 8] Created test guest: {
  email: [32m'test-w8-1770446561560-lbckgnvm@example.com'[39m,
  id: [32m'34888bcb-5492-4fd3-be0e-c75aee62bc6a'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'ec018ec5-aa4d-4c0c-b7cd-fecf7829a713'[39m
}
[Worker 8] ‚úÖ Verified guest exists: {
  email: [32m'test-w8-1770446561560-lbckgnvm@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[Worker 9] Created test guest: {
  email: [32m'test-w9-1770446565377-q1je1a36@example.com'[39m,
  id: [32m'8b25273c-e96c-4b26-88b8-1ff1de79d46b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'6ae4e89d-4e51-4a94-8086-ab94ad138185'[39m
}
[Worker 9] ‚úÖ Verified guest exists: {
  email: [32m'test-w9-1770446565377-q1je1a36@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 7.8s[2m (compile: 6.8s, proxy.ts: 130ms, render: 902ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 12.6s[2m (compile: 11.2s, proxy.ts: 432ms, render: 910ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 12.2s[2m (compile: 11.0s, proxy.ts: 266ms, render: 912ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 7.9s[2m (compile: 6.8s, proxy.ts: 130ms, render: 961ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=4187664a892e43eb4e3ccdadb075d8b81b566ae49019890a9514fd1417135dd8 [32m200[39m in 3.8s[2m (compile: 2.7s, proxy.ts: 149ms, render: 965ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=a798ceaa956a6523661b83dbfd40c01e3b1af05a2a78b1e000614c4403829ad2 [32m200[39m in 3.8s[2m (compile: 2.7s, proxy.ts: 149ms, render: 967ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 4.0s[2m (compile: 2.3s, proxy.ts: 521ms, render: 1168ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 4.1s[2m (compile: 2.4s, proxy.ts: 518ms, render: 1233ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 4.1s[2m (compile: 2.3s, proxy.ts: 523ms, render: 1234ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 4.1s[2m (compile: 2.4s, proxy.ts: 504ms, render: 1234ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 4.1s[2m (compile: 2.4s, proxy.ts: 491ms, render: 1252ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 4.2s[2m (compile: 2.4s, proxy.ts: 495ms, render: 1288ms)[22m
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 4.2s[2m (compile: 2.3s, proxy.ts: 520ms, render: 1303ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 4.2s[2m (compile: 2.4s, proxy.ts: 471ms, render: 1360ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 25.9s[2m (compile: 22.9s, proxy.ts: 1212ms, render: 1797ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 24.5s[2m (compile: 19.8s, proxy.ts: 2.9s, render: 1814ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 518ms[2m (compile: 32ms, proxy.ts: 212ms, render: 273ms)[22m
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Looking for guest with email: nonexistent@example.com
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 1367ms[2m (compile: 762ms, proxy.ts: 231ms, render: 375ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mfalse[39m,
[2m[WebServer] [22m  email: [90mundefined[39m,
[2m[WebServer] [22m  authMethod: [90mundefined[39m,
[2m[WebServer] [22m  error: [32m'Cannot coerce the result to a single JSON object'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [33m404[39m in 1552ms[2m (compile: 765ms, proxy.ts: 231ms, render: 556ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 1619ms[2m (compile: 797ms, proxy.ts: 232ms, render: 591ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.8s[2m (compile: 349ms, proxy.ts: 504ms, render: 1918ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.7s[2m (compile: 209ms, proxy.ts: 832ms, render: 1612ms)[22m
  ‚úì  13 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:607:7 ‚Ä∫ Guest Authentication ‚Ä∫ should switch between authentication tabs (19.9s)
[2m[WebServer] [22m GET /guest/events [32m200[39m in 3.1s[2m (compile: 286ms, proxy.ts: 1011ms, render: 1801ms)[22m
[2m[WebServer] [22m GET /guest/events [32m200[39m in 2.9s[2m (compile: 265ms, proxy.ts: 801ms, render: 1803ms)[22m
[Worker 8] Created test guest: {
  email: [32m'test-w8-1770446582162-jyfksbkp@example.com'[39m,
  id: [32m'ae433e47-9e84-412b-886c-cc38a97a864b'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'a54a3ac5-609c-4d3b-a5fc-0d947c0838c1'[39m
}
[Worker 8] ‚úÖ Verified guest exists: {
  email: [32m'test-w8-1770446582162-jyfksbkp@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
[2m[WebServer] [22m GET /auth/guest-login/verify?token=f2405b3713ef57302104e59840b55babb087a9db803f6b1405affbde381c6656 [32m200[39m in 93ms[2m (compile: 1843¬µs, proxy.ts: 8ms, render: 83ms)[22m
[2m[WebServer] [22m GET /auth/guest-login/verify?token=d2bf1ec85dca53fd20cf83ebf9b1216784da62be1f50f364bbba507b9d1975b5 [32m200[39m in 204ms[2m (compile: 14ms, proxy.ts: 38ms, render: 151ms)[22m
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 148ms[2m (compile: 19ms, proxy.ts: 31ms, render: 98ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.3s[2m (compile: 5ms, proxy.ts: 230ms, render: 2.0s)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 2.3s[2m (compile: 25ms, proxy.ts: 210ms, render: 2.1s)[22m
[2m[WebServer] [22m[API] Looking for guest with email: test-w8-1770446582162-jyfksbkp@example.com
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 170ms[2m (compile: 16ms, proxy.ts: 111ms, render: 44ms)[22m
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w8-1770446582162-jyfksbkp@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 1882ms[2m (compile: 89ms, proxy.ts: 907ms, render: 886ms)[22m
[2m[WebServer] [22m POST /api/guest-auth/magic-link/verify [34m307[39m in 1889ms[2m (compile: 89ms, proxy.ts: 907ms, render: 893ms)[22m
  ‚úò  10 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:483:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token (1.1m)
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'1008141d'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'ae433e47-9e84-412b-886c-cc38a97a864b'[39m,
[2m[WebServer] [22m  sessionId: [32m'fb9f94aa-9561-41a4-8970-33a19ce342f0'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 1161ms[2m (compile: 18ms, proxy.ts: 741ms, render: 402ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 181ms[2m (compile: 8ms, proxy.ts: 9ms, render: 165ms)[22m
[2m[WebServer] [22m POST /auth/guest-login/verify?error=INVALID_TOKEN&message=Invalid+or+expired+magic+link [32m200[39m in 184ms[2m (compile: 8ms, proxy.ts: 9ms, render: 168ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/activities',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '1008141d...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '1008141d'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '023eabdd...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '023eabdd'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[37m[1m‚óã[22m[39m Compiling /guest/activities ...
[2m[WebServer] [22m[API] Looking for guest with email: test-w10-1770446584675-6btf4hu7@example.com
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'1008141d'[39m }
[2m[WebServer] [22m[API] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  email: [32m'test-w10-1770446584675-6btf4hu7@example.com'[39m,
[2m[WebServer] [22m  authMethod: [32m'email_matching'[39m,
[2m[WebServer] [22m  error: [90mundefined[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /auth/guest-login [32m200[39m in 2.0s[2m (compile: 1616ms, proxy.ts: 88ms, render: 329ms)[22m
[2m[WebServer] [22m GET /auth/guest-login?returnTo=%2Fguest%2Fevents [32m200[39m in 1515ms[2m (compile: 974ms, proxy.ts: 211ms, render: 331ms)[22m
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'ae433e47-9e84-412b-886c-cc38a97a864b'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[API] Setting guest session cookie: {
[2m[WebServer] [22m  tokenPrefix: [32m'8251538a'[39m,
[2m[WebServer] [22m  cookieOptions: {
[2m[WebServer] [22m    httpOnly: [33mtrue[39m,
[2m[WebServer] [22m    secure: [33mfalse[39m,
[2m[WebServer] [22m    sameSite: [32m'lax'[39m,
[2m[WebServer] [22m    maxAge: [33m86400[39m,
[2m[WebServer] [22m    path: [32m'/'[39m
[2m[WebServer] [22m  },
[2m[WebServer] [22m  guestId: [32m'c6a8366f-db10-4e2c-9a6c-d48a7cad0504'[39m,
[2m[WebServer] [22m  sessionId: [32m'dedeeb34-7142-4a4c-a2c5-0d73dcd9db10'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m POST /api/guest-auth/email-match [32m200[39m in 2.1s[2m (compile: 1574ms, proxy.ts: 106ms, render: 422ms)[22m
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w8-1770446582162-jyfksbkp@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w8-1770446582162-jyfksbkp@example.com
[2m[WebServer] [22m GET /guest/events [32m200[39m in 2.4s[2m (compile: 1318ms, proxy.ts: 387ms, render: 695ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/guest/dashboard',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8251538a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úò  12 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:579:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes (1.1m)
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8251538a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Session check: { hasToken: [33mtrue[39m, tokenPrefix: [32m'8251538a'[39m }
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '437022ae...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
  ‚úì  14 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:650:7 ‚Ä∫ Guest Authentication ‚Ä∫ should handle authentication errors gracefully (28.2s)
[2m[WebServer] [22m[GuestDashboard] Session query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  guestId: [32m'c6a8366f-db10-4e2c-9a6c-d48a7cad0504'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 0,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '437022ae'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] No session found in database for token
[2m[WebServer] [22m[GuestDashboard] Guest query result: {
[2m[WebServer] [22m  found: [33mtrue[39m,
[2m[WebServer] [22m  error: [90mundefined[39m,
[2m[WebServer] [22m  email: [32m'test-w10-1770446584675-6btf4hu7@example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22m[GuestDashboard] Rendering dashboard for guest: test-w10-1770446584675-6btf4hu7@example.com
[2m[WebServer] [22m GET /guest/dashboard [32m200[39m in 579ms[2m (compile: 23ms, proxy.ts: 186ms, render: 370ms)[22m
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/rsvps',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8251538a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/announcements',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8251538a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/events',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8251538a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Guest auth check: {
[2m[WebServer] [22m  path: '/api/guest/wedding-info',
[2m[WebServer] [22m  hasCookie: true,
[2m[WebServer] [22m  cookieValue: '8251538a...',
[2m[WebServer] [22m  allCookies: [ 'guest_session' ]
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8251538a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8251538a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8251538a'
[2m[WebServer] [22m}
[2m[WebServer] [22m[Middleware] Session query result: {
[2m[WebServer] [22m  sessionsFound: 1,
[2m[WebServer] [22m  hasError: false,
[2m[WebServer] [22m  errorMessage: undefined,
[2m[WebServer] [22m  tokenPrefix: '8251538a'
[2m[WebServer] [22m}
[2m[WebServer] [22m GET /api/guest/wedding-info [32m200[39m in 670ms[2m (compile: 5ms, proxy.ts: 139ms, render: 526ms)[22m
[2m[WebServer] [22m GET /api/guest/announcements [32m200[39m in 684ms[2m (compile: 13ms, proxy.ts: 139ms, render: 532ms)[22m
[2m[WebServer] [22m GET /api/guest/rsvps [32m200[39m in 710ms[2m (compile: 25ms, proxy.ts: 140ms, render: 545ms)[22m
[2m[WebServer] [22m GET /api/guest/events [32m200[39m in 823ms[2m (compile: 5ms, proxy.ts: 172ms, render: 646ms)[22m
Navigation failed, current URL: http://localhost:3000/auth/guest-login
  ‚úò  15 [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:695:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log (20.7s)

üßπ E2E Global Teardown Starting...

üóëÔ∏è  Cleaning up test data...
üßπ Running comprehensive test cleanup...
‚úÖ Comprehensive cleanup complete
‚úÖ Test data cleaned

üîì Removing authentication state...
   No authentication directory found (already clean)
‚úÖ Authentication state removed

üìä Execution Summary:
   Duration: 2.69s
   Errors: 0
   Status: ‚úÖ Clean teardown

‚ú® E2E Global Teardown Complete!



  1) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:157:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching 

    TimeoutError: page.waitForURL: Timeout 15000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/guest/dashboard" until "networkidle"
      navigated to "http://localhost:3000/guest/dashboard"
      "domcontentloaded" event fired
    ============================================================

      187 |     try {
      188 |       await Promise.all([
    > 189 |         page.waitForURL('/guest/dashboard', { 
          |              ^
      190 |           timeout: 15000,
      191 |           waitUntil: 'networkidle'
      192 |         }),
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:189:14

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/error-context.md

  2) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:261:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication 

    TimeoutError: page.waitForURL: Timeout 10000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/guest/dashboard" until "domcontentloaded"
    ============================================================

      267 |
      268 |     // Wait for redirect
    > 269 |     await page.waitForURL('/guest/dashboard', { 
          |                ^
      270 |       timeout: 10000,
      271 |       waitUntil: 'domcontentloaded'
      272 |     });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:269:16

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-8c77d-n-successful-authentication-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-8c77d-n-successful-authentication-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-8c77d-n-successful-authentication-chromium/error-context.md

  3) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:287:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      320 |
      321 |     // Wait for success message
    > 322 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      323 |     await expect(page.locator('.text-green-800')).toContainText(/check your email/i);
      324 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      325 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:322:48

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-1c592-quest-and-verify-magic-link-chromium/error-context.md

  4) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:351:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('.bg-green-50')
    Expected: visible
    Timeout: 10000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 10000ms[22m
    [2m  - waiting for locator('.bg-green-50')[22m


      382 |
      383 |     // Verify success message
    > 384 |     await expect(page.locator('.bg-green-50')).toBeVisible();
          |                                                ^
      385 |     await expect(page.locator('.text-green-800')).toContainText('Check your email for a login link');
      386 |     await expect(page.locator('.text-green-800')).toContainText('15 minutes');
      387 |
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:384:48

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-71b1d-after-requesting-magic-link-chromium/error-context.md

  5) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:427:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link 

    TimeoutError: page.waitForURL: Timeout 10000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/guest/dashboard" until "load"
      navigated to "http://localhost:3000/auth/guest-login/verify?token=87ebc345d9307b4a0f298c20c11ae95229075795177c1577e7fd63066d1e8788"
      navigated to "http://localhost:3000/guest/dashboard"
      "domcontentloaded" event fired
    ============================================================

      468 |     // Use the token once
      469 |     await page.goto(`/auth/guest-login/verify?token=${token}`);
    > 470 |     await page.waitForURL('/guest/dashboard', { timeout: 10000 });
          |                ^
      471 |
      472 |     // Try to use the same token again
      473 |     await page.goto(`/auth/guest-login/verify?token=${token}`);
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:470:16

    Error Context: test-results/auth-guestAuth-Guest-Authe-fb7a8-for-already-used-magic-link-chromium/error-context.md

  6) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:483:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoContainText[2m([22m[32mexpected[39m[2m)[22m failed

    Locator: locator('h1')
    Expected substring: [32m"Invalid Link"[39m
    Received string:    [31m""[39m
    Timeout: 10000ms

    Call log:
    [2m  - Expect "toContainText" with timeout 10000ms[22m
    [2m  - waiting for locator('h1')[22m


      501 |
      502 |     await page.goto(`/auth/guest-login/verify?token=${token}`);
    > 503 |     await expect(page.locator('h1')).toContainText('Invalid Link');
          |                                      ^
      504 |     const nonExistentDescription = page.locator('p.text-gray-600').first();
      505 |     await expect(nonExistentDescription).toContainText(/invalid|expired/i);
      506 |   });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:503:38

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-ce12c-or-invalid-or-missing-token-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-ce12c-or-invalid-or-missing-token-chromium/error-context.md

  7) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:512:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected substring: [32m"/auth/guest-login"[39m
    Received string:    [31m"http://localhost:3000/guest/dashboard"[39m

      562 |     // Step 5: Verify we're on login page or redirected to it
      563 |     const finalUrl = page.url();
    > 564 |     expect(finalUrl).toContain('/auth/guest-login');
          |                      ^
      565 |     await expect(page.locator('h1')).toContainText('Welcome to Our Wedding');
      566 |
      567 |     // Step 6: Verify session cookie was cleared
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:564:22

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-b7d01-should-complete-logout-flow-chromium/error-context.md

  8) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:579:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes 

    [31mTest timeout of 60000ms exceeded.[39m

    Error: page.goto: net::ERR_ABORTED at http://localhost:3000/guest/activities
    Call log:
    [2m  - navigating to "http://localhost:3000/guest/activities", waiting until "load"[22m


      600 |
      601 |     // Step 5: Navigate to another page
    > 602 |     await page.goto('/guest/activities');
          |                ^
      603 |     await expect(page).toHaveURL('/guest/activities');
      604 |     await expect(page.locator('h1')).toBeVisible();
      605 |   });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:602:16

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    attachment #2: video (video/webm) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/video.webm
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-2d8a3-ation-across-page-refreshes-chromium/error-context.md

  9) [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:695:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 

    Error: Authentication failed - still on login page

      712 |       // If we're still on login page, authentication failed
      713 |       if (currentUrl.includes('/auth/guest-login')) {
    > 714 |         throw new Error('Authentication failed - still on login page');
          |               ^
      715 |       }
      716 |     }
      717 |     
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:714:15

    attachment #1: screenshot (image/png) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/test-failed-1.png
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    Error Context: test-results/auth-guestAuth-Guest-Authe-c413d-ication-events-in-audit-log-chromium/error-context.md

  9 failed
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:157:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully authenticate with email matching 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:261:7 ‚Ä∫ Guest Authentication ‚Ä∫ should create session cookie on successful authentication 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:287:7 ‚Ä∫ Guest Authentication ‚Ä∫ should successfully request and verify magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:351:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show success message after requesting magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:427:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for already used magic link 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:483:7 ‚Ä∫ Guest Authentication ‚Ä∫ should show error for invalid or missing token 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:512:7 ‚Ä∫ Guest Authentication ‚Ä∫ should complete logout flow 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:579:7 ‚Ä∫ Guest Authentication ‚Ä∫ should persist authentication across page refreshes 
    [chromium] ‚Ä∫ __tests__/e2e/auth/guestAuth.spec.ts:695:7 ‚Ä∫ Guest Authentication ‚Ä∫ should log authentication events in audit log 
  1 skipped
  5 passed (2.6m)

[36m  Serving HTML report at http://localhost:63160. Press Ctrl+C to quit.[39m
