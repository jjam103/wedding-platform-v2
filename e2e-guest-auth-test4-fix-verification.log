
> destination-wedding-platform@0.1.0 test:e2e
> playwright test __tests__/e2e/auth/guestAuth.spec.ts --grep should successfully authenticate with email matching

[dotenv@17.2.4] injecting env (24) from .env.e2e -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

ðŸš€ E2E Global Setup Starting...

ðŸ“Š Verifying test database connection...
âœ… Test database connected

ðŸ§¹ Cleaning up test data...
   Cleaning up leftover test data...
   Cleaned up sessions for 6 test guests
   Test data cleanup complete
âœ… Test data cleaned

ðŸ‘¤ Creating test guest...
   Warmup guest already exists: warmup@example.com
   Created test guest: test@example.com (ID: c9e50743-cb1d-4de3-8583-823762b3199f)
âœ… Test guest created

ðŸ“¦ Creating comprehensive test data...
   Creating location hierarchy...
   Location hierarchy already exists
   Creating events...
   Events already exist
   Creating activities...
   Warning: Could not create comprehensive test data: Failed to create ceremony activity: Could not find the 'cost_per_guest' column of 'activities' in the schema cache
   Some E2E tests may fail due to missing data
âœ… Comprehensive test data created

ðŸŒ Verifying Next.js server...
âœ… Next.js server is running

ðŸ”¥ Warming up API routes...
   Warming up 3 guest auth routes with retry logic...
   âœ… Route ready: /api/guest-auth/email-match (attempt 1/5, status: 200)
   âœ… Route ready: /api/guest-auth/magic-link/request (attempt 1/5, status: 400)
   âœ… Route ready: /api/guest-auth/magic-link/verify (attempt 1/5, status: 400)
   âœ… Guest auth routes warmup complete
âœ… API routes warmed up

ðŸ” Setting up admin authentication...
   Attempting browser-based admin login: admin@example.com
   Navigating to http://localhost:3000/auth/login...
   Page loaded, filling form...
   Form filled, submitting...
   Current URL after submit: http://localhost:3000/admin
   âœ… Successfully logged in via browser
   âœ… Authentication state saved
âœ… Admin authentication saved

âœ¨ E2E Global Setup Complete!


Running 1 test using 1 worker

[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  enable debug logging with { debug: true }
[Worker 0] Created test guest: {
  email: [32m'test-w0-1770445828743-1elifhgj@example.com'[39m,
  id: [32m'be87dda9-7c6b-43f1-8f85-5abfe5134134'[39m,
  authMethod: [32m'email_matching'[39m,
  groupId: [32m'e3962c9c-fa6f-41f2-9bdc-239c6e3005f8'[39m
}
[Worker 0] âœ… Verified guest exists: {
  email: [32m'test-w0-1770445828743-1elifhgj@example.com'[39m,
  authMethod: [32m'email_matching'[39m
}
  âœ˜  1 [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:157:7 â€º Guest Authentication â€º should successfully authenticate with email matching (17.2s)

ðŸ§¹ E2E Global Teardown Starting...

ðŸ—‘ï¸  Cleaning up test data...
ðŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ðŸ”“ Removing authentication state...
   No authentication directory found (already clean)
âœ… Authentication state removed

ðŸ“Š Execution Summary:
   Duration: 2.25s
   Errors: 0
   Status: âœ… Clean teardown

âœ¨ E2E Global Teardown Complete!



  1) [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:157:7 â€º Guest Authentication â€º should successfully authenticate with email matching 

    TimeoutError: page.waitForURL: Timeout 15000ms exceeded.
    =========================== logs ===========================
    waiting for navigation to "/guest/dashboard" until "networkidle"
    ============================================================

      168 |
      169 |     // Set up navigation promise BEFORE clicking to catch the navigation event
    > 170 |     const navigationPromise = page.waitForURL('/guest/dashboard', { 
          |                                    ^
      171 |       timeout: 15000,  // Increased from 10s - API takes ~450ms + 200ms delay + 2.5s render
      172 |       waitUntil: 'networkidle'  // Wait for all network requests to complete
      173 |     });
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/auth/guestAuth.spec.ts:170:36

    attachment #1: screenshot (image/png) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/test-failed-1.png
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    attachment #2: video (video/webm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/video.webm
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error Context: test-results/auth-guestAuth-Guest-Authe-1ea91-nticate-with-email-matching-chromium/error-context.md

  1 failed
    [chromium] â€º __tests__/e2e/auth/guestAuth.spec.ts:157:7 â€º Guest Authentication â€º should successfully authenticate with email matching 

[36m  Serving HTML report at http://localhost:61486. Press Ctrl+C to quit.[39m
