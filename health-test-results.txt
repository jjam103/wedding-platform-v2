[dotenv@17.2.4] injecting env (27) from .env.e2e -- tip: âš™ï¸  suppress all logs with { quiet: true }
[2m[WebServer] [22m
[2m[WebServer] [22m> destination-wedding-platform@0.1.0 dev
[2m[WebServer] [22m> next dev --webpack
[2m[WebServer] [22m
[2m[WebServer] [22m[1m[38;2;173;127;168mâ–² Next.js 16.1.1[39m[22m (webpack)
[2m[WebServer] [22m- Local:         http://localhost:3000
[2m[WebServer] [22m- Network:       http://172.24.68.44:3000
[2m[WebServer] [22m- Environments: .env.test
[2m[WebServer] [22m
[2m[WebServer] [22m[32m[1mâœ“[22m[39m Starting...
[2m[WebServer] [22m[33m[1mâš [22m[39m The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
[2m[WebServer] [22mğŸš€ Initializing application services...
[2m[WebServer] [22mâœ… B2 client initialized successfully {
[2m[WebServer] [22m  endpoint: [32m'https://s3.us-west-004.backblazeb2.com'[39m,
[2m[WebServer] [22m  region: [32m'us-west-004'[39m,
[2m[WebServer] [22m  bucket: [32m'test-bucket'[39m,
[2m[WebServer] [22m  cdnDomain: [32m'https://test-cdn.example.com'[39m
[2m[WebServer] [22m}
[2m[WebServer] [22mâœ… Application services initialized successfully
[2m[WebServer] [22m[32m[1mâœ“[22m[39m Ready in 1773ms

ğŸš€ E2E Global Setup Starting...

ğŸ“Š Verifying test database connection...
[2m[WebServer] [22m GET / [32m200[39m in 2.5s[2m (compile: 2.2s, proxy.ts: 163ms, render: 209ms)[22m
âœ… Test database connected

ğŸ§¹ Cleaning up test data...
ğŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ğŸŒ Verifying Next.js server...
âœ… Next.js server is running

ğŸ” Setting up admin authentication...
[2m[WebServer] [22m GET / [32m200[39m in 33ms[2m (compile: 2ms, proxy.ts: 13ms, render: 18ms)[22m
   Warning: Could not ensure admin user exists: Failed to create auth user: A user with this email address has already been registered
   Continuing with setup - login may fail if user does not exist
   Authenticating via Supabase API...
   âœ… API authentication successful (User ID: e7f5ae65-376e-4d05-a18c-10a91295727a)
   Creating storage state from API session...
   âœ… Storage state created from API session
   Auth state saved to: .auth/admin.json
   Verifying authentication...
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m GET /admin [32m200[39m in 1524ms[2m (compile: 1049ms, proxy.ts: 343ms, render: 132ms)[22m
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
   Current URL: http://localhost:3000/admin
   âœ… Admin UI is visible
   âœ… Authentication verified
   Logged in as: admin@example.com
âœ… Admin authentication saved

âœ¨ E2E Global Setup Complete!


Running 34 tests using 4 workers

[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] User authenticated: e7f5ae65-376e-4d05-a18c-10a91295727a
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m[Middleware] Admin user data query result: { userData: { role: 'owner', status: 'active' }, userError: null }
[2m[WebServer] [22m[Middleware] Access granted for admin role: owner
[2m[WebServer] [22m GET /api/admin/locations [32m200[39m in 1499ms[2m (compile: 1020ms, proxy.ts: 302ms, render: 176ms)[22m
[2m[WebServer] [22m POST /api/auth/logout [32m200[39m in 1510ms[2m (compile: 1309ms, proxy.ts: 19ms, render: 182ms)[22m
  âœ“   3 [chromium] â€º __tests__/e2e/system/health.spec.ts:37:7 â€º API Health Checks â€º logout endpoint should exist and respond (1.5s)
[2m[WebServer] [22m GET /api/admin/locations [32m200[39m in 1524ms[2m (compile: 956ms, proxy.ts: 352ms, render: 216ms)[22m
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“   5 [chromium] â€º __tests__/e2e/system/health.spec.ts:121:7 â€º API Response Format â€º should set proper content-type headers for JSON endpoints (138ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /api/health [33m404[39m in 1819ms[2m (compile: 1720ms, proxy.ts: 18ms, render: 81ms)[22m
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“   1 [chromium] â€º __tests__/e2e/system/health.spec.ts:30:7 â€º API Health Checks â€º should respond to health check endpoint (1.9s)
  âœ˜   6 [chromium] â€º __tests__/e2e/system/health.spec.ts:133:7 â€º API Response Format â€º invalid endpoints should return 404 or redirect (152ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“   2 [chromium] â€º __tests__/e2e/system/health.spec.ts:85:7 â€º API Response Format â€º all API responses should have consistent Result<T> format (1.9s)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“   7 [chromium] â€º __tests__/e2e/system/health.spec.ts:140:7 â€º API Response Format â€º invalid methods should return 405 or 401 (146ms)
  âœ“   4 [chromium] â€º __tests__/e2e/system/health.spec.ts:51:7 â€º API Health Checks â€º admin endpoints should respond (2.0s)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“   8 [chromium] â€º __tests__/e2e/system/health.spec.ts:153:7 â€º Guests API - Query Parameter Handling â€º should handle request with no query parameters (145ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“  10 [chromium] â€º __tests__/e2e/system/health.spec.ts:200:7 â€º Guests API - Query Parameter Handling â€º should handle pagination parameters (146ms)
  âœ“  11 [chromium] â€º __tests__/e2e/system/health.spec.ts:224:7 â€º Guests API - Query Parameter Handling â€º should handle multiple filter parameters (132ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“  12 [chromium] â€º __tests__/e2e/system/health.spec.ts:260:7 â€º Guests API - Query Parameter Handling â€º should handle search parameter (143ms)
  âœ“   9 [chromium] â€º __tests__/e2e/system/health.spec.ts:177:7 â€º Guests API - Query Parameter Handling â€º should handle empty and valid filter parameters (313ms)
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: âš™ï¸  enable debug logging with { debug: true }
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
Guests API response time: 119ms
  âœ“  14 [chromium] â€º __tests__/e2e/system/health.spec.ts:279:7 â€º API Performance â€º should respond within acceptable time (123ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“  13 [chromium] â€º __tests__/e2e/system/health.spec.ts:244:7 â€º Guests API - Query Parameter Handling â€º should handle invalid parameters gracefully (286ms)
  âœ“  15 [chromium] â€º __tests__/e2e/system/health.spec.ts:293:7 â€º API Performance â€º should handle large page sizes efficiently (143ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“  16 [chromium] â€º __tests__/e2e/system/health.spec.ts:315:7 â€º API Security â€º should require authentication for admin endpoints (29ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
  âœ“  19 [chromium] â€º __tests__/e2e/system/health.spec.ts:344:7 â€º API Security â€º should handle XSS attempts in parameters (158ms)
  âœ“  18 [chromium] â€º __tests__/e2e/system/health.spec.ts:333:7 â€º API Security â€º should sanitize query parameters against SQL injection (172ms)
  âœ˜  17 [chromium] â€º __tests__/e2e/system/health.spec.ts:133:7 â€º API Response Format â€º invalid endpoints should return 404 or redirect (retry #1) (194ms)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[dotenv@17.2.4] injecting env (0) from .env.e2e -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin [32m200[39m in 759ms[2m (compile: 545ms, proxy.ts: 18ms, render: 195ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fguests [32m200[39m in 445ms[2m (compile: 203ms, proxy.ts: 44ms, render: 197ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fevents [32m200[39m in 445ms[2m (compile: 203ms, proxy.ts: 44ms, render: 197ms)[22m
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Factivities [32m200[39m in 77ms[2m (compile: 5ms, proxy.ts: 16ms, render: 56ms)[22m
  âœ“  20 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Dashboard page should load without errors (1.9s)
  âœ“  22 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Events page should load without errors (1.8s)
  âœ“  21 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Guests page should load without errors (1.8s)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Flocations [32m200[39m in 98ms[2m (compile: 4ms, proxy.ts: 11ms, render: 83ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Faccommodations [32m200[39m in 191ms[2m (compile: 9ms, proxy.ts: 29ms, render: 153ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fvendors [32m200[39m in 188ms[2m (compile: 3ms, proxy.ts: 32ms, render: 154ms)[22m
  âœ“  23 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Activities page should load without errors (2.1s)
  âœ“  26 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Vendors page should load without errors (1.3s)
  âœ“  25 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Accommodations page should load without errors (1.3s)
  âœ“  24 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Locations page should load without errors (1.4s)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fbudget [32m200[39m in 36ms[2m (compile: 1522Âµs, proxy.ts: 8ms, render: 27ms)[22m
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fphotos [32m200[39m in 99ms[2m (compile: 5ms, proxy.ts: 13ms, render: 81ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Ftransportation [32m200[39m in 101ms[2m (compile: 5ms, proxy.ts: 13ms, render: 83ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Femails [32m200[39m in 98ms[2m (compile: 12ms, proxy.ts: 39ms, render: 47ms)[22m
  âœ“  28 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Transportation page should load without errors (1.2s)
  âœ“  27 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Budget page should load without errors (1.3s)
  âœ“  30 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Emails page should load without errors (1.2s)
  âœ“  29 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Photos page should load without errors (1.2s)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Frsvp-analytics [32m200[39m in 84ms[2m (compile: 2ms, proxy.ts: 9ms, render: 73ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fcontent-pages [32m200[39m in 130ms[2m (compile: 13ms, proxy.ts: 31ms, render: 87ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fhome-page [32m200[39m in 142ms[2m (compile: 16ms, proxy.ts: 46ms, render: 80ms)[22m
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Faudit-logs [32m200[39m in 134ms[2m (compile: 14ms, proxy.ts: 58ms, render: 62ms)[22m
  âœ“  34 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Audit Logs page should load without errors (1.3s)
  âœ“  33 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º RSVP Analytics page should load without errors (1.3s)
  âœ“  32 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Home Page page should load without errors (1.4s)
  âœ“  31 [chromium] â€º __tests__/e2e/system/health.spec.ts:384:9 â€º Admin Pages Smoke Tests â€º Content Pages page should load without errors (1.4s)
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fevents [32m200[39m in 36ms[2m (compile: 2ms, proxy.ts: 10ms, render: 24ms)[22m
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Fguests [32m200[39m in 45ms[2m (compile: 2ms, proxy.ts: 8ms, render: 35ms)[22m
[2m[WebServer] [22m[Middleware] No user found: Auth session missing!
[2m[WebServer] [22m GET /auth/login?returnTo=%2Fadmin%2Factivities [32m200[39m in 46ms[2m (compile: 2ms, proxy.ts: 10ms, render: 34ms)[22m
  âœ“  35 [chromium] â€º __tests__/e2e/system/health.spec.ts:429:7 â€º Admin Pages Smoke Tests â€º should not have duplicate React keys (2.0s)

ğŸ§¹ E2E Global Teardown Starting...

ğŸ—‘ï¸  Cleaning up test data...
ğŸ§¹ Running comprehensive test cleanup...
âœ… Comprehensive cleanup complete
âœ… Test data cleaned

ğŸ”“ Keeping authentication state for debugging...
   Auth files preserved in .auth/ directory
   Run "rm -rf .auth" to clean up manually

ğŸ“Š Execution Summary:
   Duration: 1.58s
   Errors: 0
   Status: âœ… Clean teardown

âœ¨ E2E Global Teardown Complete!



  1) [chromium] â€º __tests__/e2e/system/health.spec.ts:133:7 â€º API Response Format â€º invalid endpoints should return 404 or redirect 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected value: [32m401[39m
    Received array: [31m[200, 404][39m

      135 |     
      136 |     // Should be 404 or 200 (if Next.js catches it)
    > 137 |     expect([200, 404]).toContain(response.status());
          |                        ^
      138 |   });
      139 |
      140 |   test('invalid methods should return 405 or 401', async ({ request }) => {
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/system/health.spec.ts:137:24

    Retry #1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected value: [32m401[39m
    Received array: [31m[200, 404][39m

      135 |     
      136 |     // Should be 404 or 200 (if Next.js catches it)
    > 137 |     expect([200, 404]).toContain(response.status());
          |                        ^
      138 |   });
      139 |
      140 |   test('invalid methods should return 405 or 401', async ({ request }) => {
        at /Users/jaron/Desktop/wedding-platform-v2/__tests__/e2e/system/health.spec.ts:137:24

    attachment #1: trace (application/zip) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results/system-health-API-Response-00fa3-ould-return-404-or-redirect-chromium-retry1/trace.zip
    Usage:

        npx playwright show-trace test-results/system-health-API-Response-00fa3-ould-return-404-or-redirect-chromium-retry1/trace.zip

    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1 failed
    [chromium] â€º __tests__/e2e/system/health.spec.ts:133:7 â€º API Response Format â€º invalid endpoints should return 404 or redirect 
  33 passed (25.1s)
